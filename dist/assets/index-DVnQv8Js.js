function JS(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in t)){const o=Object.getOwnPropertyDescriptor(r,a);o&&Object.defineProperty(t,a,o.get?o:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function xf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function YS(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}),n}var gd={exports:{}},Ca={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rg;function KS(){if(rg)return Ca;rg=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,a,o){var c=null;if(o!==void 0&&(c=""+o),a.key!==void 0&&(c=""+a.key),"key"in a){o={};for(var d in a)d!=="key"&&(o[d]=a[d])}else o=a;return a=o.ref,{$$typeof:t,type:r,key:c,ref:a!==void 0?a:null,props:o}}return Ca.Fragment=e,Ca.jsx=n,Ca.jsxs=n,Ca}var ig;function QS(){return ig||(ig=1,gd.exports=KS()),gd.exports}var f=QS(),yd={exports:{}},De={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ag;function XS(){if(ag)return De;ag=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),w=Symbol.iterator;function _(D){return D===null||typeof D!="object"?null:(D=w&&D[w]||D["@@iterator"],typeof D=="function"?D:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,I={};function P(D,L,Q){this.props=D,this.context=L,this.refs=I,this.updater=Q||E}P.prototype.isReactComponent={},P.prototype.setState=function(D,L){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,L,"setState")},P.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function U(){}U.prototype=P.prototype;function R(D,L,Q){this.props=D,this.context=L,this.refs=I,this.updater=Q||E}var A=R.prototype=new U;A.constructor=R,N(A,P.prototype),A.isPureReactComponent=!0;var k=Array.isArray;function q(){}var V={H:null,A:null,T:null,S:null},W=Object.prototype.hasOwnProperty;function J(D,L,Q){var re=Q.ref;return{$$typeof:t,type:D,key:L,ref:re!==void 0?re:null,props:Q}}function $(D,L){return J(D.type,L,D.props)}function ce(D){return typeof D=="object"&&D!==null&&D.$$typeof===t}function ue(D){var L={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(Q){return L[Q]})}var Ce=/\/+/g;function _e(D,L){return typeof D=="object"&&D!==null&&D.key!=null?ue(""+D.key):L.toString(36)}function Ve(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(q,q):(D.status="pending",D.then(function(L){D.status==="pending"&&(D.status="fulfilled",D.value=L)},function(L){D.status==="pending"&&(D.status="rejected",D.reason=L)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function M(D,L,Q,re,de){var ge=typeof D;(ge==="undefined"||ge==="boolean")&&(D=null);var te=!1;if(D===null)te=!0;else switch(ge){case"bigint":case"string":case"number":te=!0;break;case"object":switch(D.$$typeof){case t:case e:te=!0;break;case x:return te=D._init,M(te(D._payload),L,Q,re,de)}}if(te)return de=de(D),te=re===""?"."+_e(D,0):re,k(de)?(Q="",te!=null&&(Q=te.replace(Ce,"$&/")+"/"),M(de,L,Q,"",function(ke){return ke})):de!=null&&(ce(de)&&(de=$(de,Q+(de.key==null||D&&D.key===de.key?"":(""+de.key).replace(Ce,"$&/")+"/")+te)),L.push(de)),1;te=0;var K=re===""?".":re+":";if(k(D))for(var he=0;he<D.length;he++)re=D[he],ge=K+_e(re,he),te+=M(re,L,Q,ge,de);else if(he=_(D),typeof he=="function")for(D=he.call(D),he=0;!(re=D.next()).done;)re=re.value,ge=K+_e(re,he++),te+=M(re,L,Q,ge,de);else if(ge==="object"){if(typeof D.then=="function")return M(Ve(D),L,Q,re,de);throw L=String(D),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return te}function G(D,L,Q){if(D==null)return D;var re=[],de=0;return M(D,re,"","",function(ge){return L.call(Q,ge,de++)}),re}function Z(D){if(D._status===-1){var L=D._result;L=L(),L.then(function(Q){(D._status===0||D._status===-1)&&(D._status=1,D._result=Q)},function(Q){(D._status===0||D._status===-1)&&(D._status=2,D._result=Q)}),D._status===-1&&(D._status=0,D._result=L)}if(D._status===1)return D._result.default;throw D._result}var oe=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(L))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)},se={map:G,forEach:function(D,L,Q){G(D,function(){L.apply(this,arguments)},Q)},count:function(D){var L=0;return G(D,function(){L++}),L},toArray:function(D){return G(D,function(L){return L})||[]},only:function(D){if(!ce(D))throw Error("React.Children.only expected to receive a single React element child.");return D}};return De.Activity=v,De.Children=se,De.Component=P,De.Fragment=n,De.Profiler=a,De.PureComponent=R,De.StrictMode=r,De.Suspense=p,De.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=V,De.__COMPILER_RUNTIME={__proto__:null,c:function(D){return V.H.useMemoCache(D)}},De.cache=function(D){return function(){return D.apply(null,arguments)}},De.cacheSignal=function(){return null},De.cloneElement=function(D,L,Q){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var re=N({},D.props),de=D.key;if(L!=null)for(ge in L.key!==void 0&&(de=""+L.key),L)!W.call(L,ge)||ge==="key"||ge==="__self"||ge==="__source"||ge==="ref"&&L.ref===void 0||(re[ge]=L[ge]);var ge=arguments.length-2;if(ge===1)re.children=Q;else if(1<ge){for(var te=Array(ge),K=0;K<ge;K++)te[K]=arguments[K+2];re.children=te}return J(D.type,de,re)},De.createContext=function(D){return D={$$typeof:c,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:o,_context:D},D},De.createElement=function(D,L,Q){var re,de={},ge=null;if(L!=null)for(re in L.key!==void 0&&(ge=""+L.key),L)W.call(L,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(de[re]=L[re]);var te=arguments.length-2;if(te===1)de.children=Q;else if(1<te){for(var K=Array(te),he=0;he<te;he++)K[he]=arguments[he+2];de.children=K}if(D&&D.defaultProps)for(re in te=D.defaultProps,te)de[re]===void 0&&(de[re]=te[re]);return J(D,ge,de)},De.createRef=function(){return{current:null}},De.forwardRef=function(D){return{$$typeof:d,render:D}},De.isValidElement=ce,De.lazy=function(D){return{$$typeof:x,_payload:{_status:-1,_result:D},_init:Z}},De.memo=function(D,L){return{$$typeof:h,type:D,compare:L===void 0?null:L}},De.startTransition=function(D){var L=V.T,Q={};V.T=Q;try{var re=D(),de=V.S;de!==null&&de(Q,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(q,oe)}catch(ge){oe(ge)}finally{L!==null&&Q.types!==null&&(L.types=Q.types),V.T=L}},De.unstable_useCacheRefresh=function(){return V.H.useCacheRefresh()},De.use=function(D){return V.H.use(D)},De.useActionState=function(D,L,Q){return V.H.useActionState(D,L,Q)},De.useCallback=function(D,L){return V.H.useCallback(D,L)},De.useContext=function(D){return V.H.useContext(D)},De.useDebugValue=function(){},De.useDeferredValue=function(D,L){return V.H.useDeferredValue(D,L)},De.useEffect=function(D,L){return V.H.useEffect(D,L)},De.useEffectEvent=function(D){return V.H.useEffectEvent(D)},De.useId=function(){return V.H.useId()},De.useImperativeHandle=function(D,L,Q){return V.H.useImperativeHandle(D,L,Q)},De.useInsertionEffect=function(D,L){return V.H.useInsertionEffect(D,L)},De.useLayoutEffect=function(D,L){return V.H.useLayoutEffect(D,L)},De.useMemo=function(D,L){return V.H.useMemo(D,L)},De.useOptimistic=function(D,L){return V.H.useOptimistic(D,L)},De.useReducer=function(D,L,Q){return V.H.useReducer(D,L,Q)},De.useRef=function(D){return V.H.useRef(D)},De.useState=function(D){return V.H.useState(D)},De.useSyncExternalStore=function(D,L,Q){return V.H.useSyncExternalStore(D,L,Q)},De.useTransition=function(){return V.H.useTransition()},De.version="19.2.0",De}var og;function vf(){return og||(og=1,yd.exports=XS()),yd.exports}var C=vf();const Rx=xf(C);var xd={exports:{}},Aa={},vd={exports:{}},bd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lg;function WS(){return lg||(lg=1,(function(t){function e(M,G){var Z=M.length;M.push(G);e:for(;0<Z;){var oe=Z-1>>>1,se=M[oe];if(0<a(se,G))M[oe]=G,M[Z]=se,Z=oe;else break e}}function n(M){return M.length===0?null:M[0]}function r(M){if(M.length===0)return null;var G=M[0],Z=M.pop();if(Z!==G){M[0]=Z;e:for(var oe=0,se=M.length,D=se>>>1;oe<D;){var L=2*(oe+1)-1,Q=M[L],re=L+1,de=M[re];if(0>a(Q,Z))re<se&&0>a(de,Q)?(M[oe]=de,M[re]=Z,oe=re):(M[oe]=Q,M[L]=Z,oe=L);else if(re<se&&0>a(de,Z))M[oe]=de,M[re]=Z,oe=re;else break e}}return G}function a(M,G){var Z=M.sortIndex-G.sortIndex;return Z!==0?Z:M.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,d=c.now();t.unstable_now=function(){return c.now()-d}}var p=[],h=[],x=1,v=null,w=3,_=!1,E=!1,N=!1,I=!1,P=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function A(M){for(var G=n(h);G!==null;){if(G.callback===null)r(h);else if(G.startTime<=M)r(h),G.sortIndex=G.expirationTime,e(p,G);else break;G=n(h)}}function k(M){if(N=!1,A(M),!E)if(n(p)!==null)E=!0,q||(q=!0,ue());else{var G=n(h);G!==null&&Ve(k,G.startTime-M)}}var q=!1,V=-1,W=5,J=-1;function $(){return I?!0:!(t.unstable_now()-J<W)}function ce(){if(I=!1,q){var M=t.unstable_now();J=M;var G=!0;try{e:{E=!1,N&&(N=!1,U(V),V=-1),_=!0;var Z=w;try{t:{for(A(M),v=n(p);v!==null&&!(v.expirationTime>M&&$());){var oe=v.callback;if(typeof oe=="function"){v.callback=null,w=v.priorityLevel;var se=oe(v.expirationTime<=M);if(M=t.unstable_now(),typeof se=="function"){v.callback=se,A(M),G=!0;break t}v===n(p)&&r(p),A(M)}else r(p);v=n(p)}if(v!==null)G=!0;else{var D=n(h);D!==null&&Ve(k,D.startTime-M),G=!1}}break e}finally{v=null,w=Z,_=!1}G=void 0}}finally{G?ue():q=!1}}}var ue;if(typeof R=="function")ue=function(){R(ce)};else if(typeof MessageChannel<"u"){var Ce=new MessageChannel,_e=Ce.port2;Ce.port1.onmessage=ce,ue=function(){_e.postMessage(null)}}else ue=function(){P(ce,0)};function Ve(M,G){V=P(function(){M(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(M){M.callback=null},t.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<M?Math.floor(1e3/M):5},t.unstable_getCurrentPriorityLevel=function(){return w},t.unstable_next=function(M){switch(w){case 1:case 2:case 3:var G=3;break;default:G=w}var Z=w;w=G;try{return M()}finally{w=Z}},t.unstable_requestPaint=function(){I=!0},t.unstable_runWithPriority=function(M,G){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var Z=w;w=M;try{return G()}finally{w=Z}},t.unstable_scheduleCallback=function(M,G,Z){var oe=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?oe+Z:oe):Z=oe,M){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=Z+se,M={id:x++,callback:G,priorityLevel:M,startTime:Z,expirationTime:se,sortIndex:-1},Z>oe?(M.sortIndex=Z,e(h,M),n(p)===null&&M===n(h)&&(N?(U(V),V=-1):N=!0,Ve(k,Z-oe))):(M.sortIndex=se,e(p,M),E||_||(E=!0,q||(q=!0,ue()))),M},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(M){var G=w;return function(){var Z=w;w=G;try{return M.apply(this,arguments)}finally{w=Z}}}})(bd)),bd}var cg;function ZS(){return cg||(cg=1,vd.exports=WS()),vd.exports}var wd={exports:{}},jt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ug;function eE(){if(ug)return jt;ug=1;var t=vf();function e(p){var h="https://react.dev/errors/"+p;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)h+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+p+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(p,h,x){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:p,containerInfo:h,implementation:x}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(p,h){if(p==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return jt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,jt.createPortal=function(p,h){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return o(p,h,null,x)},jt.flushSync=function(p){var h=c.T,x=r.p;try{if(c.T=null,r.p=2,p)return p()}finally{c.T=h,r.p=x,r.d.f()}},jt.preconnect=function(p,h){typeof p=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(p,h))},jt.prefetchDNS=function(p){typeof p=="string"&&r.d.D(p)},jt.preinit=function(p,h){if(typeof p=="string"&&h&&typeof h.as=="string"){var x=h.as,v=d(x,h.crossOrigin),w=typeof h.integrity=="string"?h.integrity:void 0,_=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;x==="style"?r.d.S(p,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:v,integrity:w,fetchPriority:_}):x==="script"&&r.d.X(p,{crossOrigin:v,integrity:w,fetchPriority:_,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},jt.preinitModule=function(p,h){if(typeof p=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var x=d(h.as,h.crossOrigin);r.d.M(p,{crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(p)},jt.preload=function(p,h){if(typeof p=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var x=h.as,v=d(x,h.crossOrigin);r.d.L(p,x,{crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},jt.preloadModule=function(p,h){if(typeof p=="string")if(h){var x=d(h.as,h.crossOrigin);r.d.m(p,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(p)},jt.requestFormReset=function(p){r.d.r(p)},jt.unstable_batchedUpdates=function(p,h){return p(h)},jt.useFormState=function(p,h,x){return c.H.useFormState(p,h,x)},jt.useFormStatus=function(){return c.H.useHostTransitionStatus()},jt.version="19.2.0",jt}var dg;function tE(){if(dg)return wd.exports;dg=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),wd.exports=eE(),wd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fg;function nE(){if(fg)return Aa;fg=1;var t=ZS(),e=vf(),n=tE();function r(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function c(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function d(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function p(s){if(o(s)!==s)throw Error(r(188))}function h(s){var i=s.alternate;if(!i){if(i=o(s),i===null)throw Error(r(188));return i!==s?null:s}for(var l=s,u=i;;){var y=l.return;if(y===null)break;var b=y.alternate;if(b===null){if(u=y.return,u!==null){l=u;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===l)return p(y),s;if(b===u)return p(y),i;b=b.sibling}throw Error(r(188))}if(l.return!==u.return)l=y,u=b;else{for(var S=!1,T=y.child;T;){if(T===l){S=!0,l=y,u=b;break}if(T===u){S=!0,u=y,l=b;break}T=T.sibling}if(!S){for(T=b.child;T;){if(T===l){S=!0,l=b,u=y;break}if(T===u){S=!0,u=b,l=y;break}T=T.sibling}if(!S)throw Error(r(189))}}if(l.alternate!==u)throw Error(r(190))}if(l.tag!==3)throw Error(r(188));return l.stateNode.current===l?s:i}function x(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=x(s),i!==null)return i;s=s.sibling}return null}var v=Object.assign,w=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),U=Symbol.for("react.consumer"),R=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),J=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),ce=Symbol.iterator;function ue(s){return s===null||typeof s!="object"?null:(s=ce&&s[ce]||s["@@iterator"],typeof s=="function"?s:null)}var Ce=Symbol.for("react.client.reference");function _e(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Ce?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case N:return"Fragment";case P:return"Profiler";case I:return"StrictMode";case k:return"Suspense";case q:return"SuspenseList";case J:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case E:return"Portal";case R:return s.displayName||"Context";case U:return(s._context.displayName||"Context")+".Consumer";case A:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case V:return i=s.displayName||null,i!==null?i:_e(s.type)||"Memo";case W:i=s._payload,s=s._init;try{return _e(s(i))}catch{}}return null}var Ve=Array.isArray,M=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},oe=[],se=-1;function D(s){return{current:s}}function L(s){0>se||(s.current=oe[se],oe[se]=null,se--)}function Q(s,i){se++,oe[se]=s.current,s.current=i}var re=D(null),de=D(null),ge=D(null),te=D(null);function K(s,i){switch(Q(ge,i),Q(de,s),Q(re,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?C0(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=C0(i),s=A0(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}L(re),Q(re,s)}function he(){L(re),L(de),L(ge)}function ke(s){s.memoizedState!==null&&Q(te,s);var i=re.current,l=A0(i,s.type);i!==l&&(Q(de,s),Q(re,l))}function ye(s){de.current===s&&(L(re),L(de)),te.current===s&&(L(te),Sa._currentValue=Z)}var Ee,ze;function Ke(s){if(Ee===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);Ee=i&&i[1]||"",ze=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ee+s+ze}var st=!1;function Ue(s,i){if(!s||st)return"";st=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(i){var ne=function(){throw Error()};if(Object.defineProperty(ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ne,[])}catch(Y){var F=Y}Reflect.construct(s,[],ne)}else{try{ne.call()}catch(Y){F=Y}s.call(ne.prototype)}}else{try{throw Error()}catch(Y){F=Y}(ne=s())&&typeof ne.catch=="function"&&ne.catch(function(){})}}catch(Y){if(Y&&F&&typeof Y.stack=="string")return[Y.stack,F.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=u.DetermineComponentFrameRoot(),S=b[0],T=b[1];if(S&&T){var j=S.split(`
`),z=T.split(`
`);for(y=u=0;u<j.length&&!j[u].includes("DetermineComponentFrameRoot");)u++;for(;y<z.length&&!z[y].includes("DetermineComponentFrameRoot");)y++;if(u===j.length||y===z.length)for(u=j.length-1,y=z.length-1;1<=u&&0<=y&&j[u]!==z[y];)y--;for(;1<=u&&0<=y;u--,y--)if(j[u]!==z[y]){if(u!==1||y!==1)do if(u--,y--,0>y||j[u]!==z[y]){var X=`
`+j[u].replace(" at new "," at ");return s.displayName&&X.includes("<anonymous>")&&(X=X.replace("<anonymous>",s.displayName)),X}while(1<=u&&0<=y);break}}}finally{st=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?Ke(l):""}function it(s,i){switch(s.tag){case 26:case 27:case 5:return Ke(s.type);case 16:return Ke("Lazy");case 13:return s.child!==i&&i!==null?Ke("Suspense Fallback"):Ke("Suspense");case 19:return Ke("SuspenseList");case 0:case 15:return Ue(s.type,!1);case 11:return Ue(s.type.render,!1);case 1:return Ue(s.type,!0);case 31:return Ke("Activity");default:return""}}function wt(s){try{var i="",l=null;do i+=it(s,l),l=s,s=s.return;while(s);return i}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var At=Object.prototype.hasOwnProperty,jn=t.unstable_scheduleCallback,On=t.unstable_cancelCallback,Qt=t.unstable_shouldYield,ae=t.unstable_requestPaint,ie=t.unstable_now,Ne=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,Fn=t.unstable_UserBlockingPriority,Ie=t.unstable_NormalPriority,Et=t.unstable_LowPriority,Ln=t.unstable_IdlePriority,nc=t.log,sc=t.unstable_setDisableYieldValue,Ui=null,Xt=null;function ys(s){if(typeof nc=="function"&&sc(s),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(Ui,s)}catch{}}var Wt=Math.clz32?Math.clz32:Pw,Dw=Math.log,Mw=Math.LN2;function Pw(s){return s>>>=0,s===0?32:31-(Dw(s)/Mw|0)|0}var Ja=256,Ya=262144,Ka=4194304;function Ks(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Qa(s,i,l){var u=s.pendingLanes;if(u===0)return 0;var y=0,b=s.suspendedLanes,S=s.pingedLanes;s=s.warmLanes;var T=u&134217727;return T!==0?(u=T&~b,u!==0?y=Ks(u):(S&=T,S!==0?y=Ks(S):l||(l=T&~s,l!==0&&(y=Ks(l))))):(T=u&~b,T!==0?y=Ks(T):S!==0?y=Ks(S):l||(l=u&~s,l!==0&&(y=Ks(l)))),y===0?0:i!==0&&i!==y&&(i&b)===0&&(b=y&-y,l=i&-i,b>=l||b===32&&(l&4194048)!==0)?i:y}function ji(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function kw(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lh(){var s=Ka;return Ka<<=1,(Ka&62914560)===0&&(Ka=4194304),s}function rc(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Oi(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Uw(s,i,l,u,y,b){var S=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var T=s.entanglements,j=s.expirationTimes,z=s.hiddenUpdates;for(l=S&~l;0<l;){var X=31-Wt(l),ne=1<<X;T[X]=0,j[X]=-1;var F=z[X];if(F!==null)for(z[X]=null,X=0;X<F.length;X++){var Y=F[X];Y!==null&&(Y.lane&=-536870913)}l&=~ne}u!==0&&ch(s,u,0),b!==0&&y===0&&s.tag!==0&&(s.suspendedLanes|=b&~(S&~i))}function ch(s,i,l){s.pendingLanes|=i,s.suspendedLanes&=~i;var u=31-Wt(i);s.entangledLanes|=i,s.entanglements[u]=s.entanglements[u]|1073741824|l&261930}function uh(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var u=31-Wt(l),y=1<<u;y&i|s[u]&i&&(s[u]|=i),l&=~y}}function dh(s,i){var l=i&-i;return l=(l&42)!==0?1:ic(l),(l&(s.suspendedLanes|i))!==0?0:l}function ic(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function ac(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function fh(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:X0(s.type))}function hh(s,i){var l=G.p;try{return G.p=s,i()}finally{G.p=l}}var xs=Math.random().toString(36).slice(2),It="__reactFiber$"+xs,Ht="__reactProps$"+xs,Nr="__reactContainer$"+xs,oc="__reactEvents$"+xs,jw="__reactListeners$"+xs,Ow="__reactHandles$"+xs,ph="__reactResources$"+xs,Li="__reactMarker$"+xs;function lc(s){delete s[It],delete s[Ht],delete s[oc],delete s[jw],delete s[Ow]}function Cr(s){var i=s[It];if(i)return i;for(var l=s.parentNode;l;){if(i=l[Nr]||l[It]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=U0(s);s!==null;){if(l=s[It])return l;s=U0(s)}return i}s=l,l=s.parentNode}return null}function Ar(s){if(s=s[It]||s[Nr]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function qi(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(r(33))}function Ir(s){var i=s[ph];return i||(i=s[ph]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Tt(s){s[Li]=!0}var mh=new Set,gh={};function Qs(s,i){Rr(s,i),Rr(s+"Capture",i)}function Rr(s,i){for(gh[s]=i,s=0;s<i.length;s++)mh.add(i[s])}var Lw=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),yh={},xh={};function qw(s){return At.call(xh,s)?!0:At.call(yh,s)?!1:Lw.test(s)?xh[s]=!0:(yh[s]=!0,!1)}function Xa(s,i,l){if(qw(i))if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var u=i.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+l)}}function Wa(s,i,l){if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+l)}}function $n(s,i,l,u){if(u===null)s.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(i,l,""+u)}}function fn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function vh(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Bw(s,i,l){var u=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var y=u.get,b=u.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return y.call(this)},set:function(S){l=""+S,b.call(this,S)}}),Object.defineProperty(s,i,{enumerable:u.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function cc(s){if(!s._valueTracker){var i=vh(s)?"checked":"value";s._valueTracker=Bw(s,i,""+s[i])}}function bh(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),u="";return s&&(u=vh(s)?s.checked?"true":"false":s.value),s=u,s!==l?(i.setValue(s),!0):!1}function Za(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Vw=/[\n"\\]/g;function hn(s){return s.replace(Vw,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function uc(s,i,l,u,y,b,S,T){s.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?s.type=S:s.removeAttribute("type"),i!=null?S==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+fn(i)):s.value!==""+fn(i)&&(s.value=""+fn(i)):S!=="submit"&&S!=="reset"||s.removeAttribute("value"),i!=null?dc(s,S,fn(i)):l!=null?dc(s,S,fn(l)):u!=null&&s.removeAttribute("value"),y==null&&b!=null&&(s.defaultChecked=!!b),y!=null&&(s.checked=y&&typeof y!="function"&&typeof y!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?s.name=""+fn(T):s.removeAttribute("name")}function wh(s,i,l,u,y,b,S,T){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.type=b),i!=null||l!=null){if(!(b!=="submit"&&b!=="reset"||i!=null)){cc(s);return}l=l!=null?""+fn(l):"",i=i!=null?""+fn(i):l,T||i===s.value||(s.value=i),s.defaultValue=i}u=u??y,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=T?s.checked:!!u,s.defaultChecked=!!u,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(s.name=S),cc(s)}function dc(s,i,l){i==="number"&&Za(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function Dr(s,i,l,u){if(s=s.options,i){i={};for(var y=0;y<l.length;y++)i["$"+l[y]]=!0;for(l=0;l<s.length;l++)y=i.hasOwnProperty("$"+s[l].value),s[l].selected!==y&&(s[l].selected=y),y&&u&&(s[l].defaultSelected=!0)}else{for(l=""+fn(l),i=null,y=0;y<s.length;y++){if(s[y].value===l){s[y].selected=!0,u&&(s[y].defaultSelected=!0);return}i!==null||s[y].disabled||(i=s[y])}i!==null&&(i.selected=!0)}}function _h(s,i,l){if(i!=null&&(i=""+fn(i),i!==s.value&&(s.value=i),l==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=l!=null?""+fn(l):""}function Sh(s,i,l,u){if(i==null){if(u!=null){if(l!=null)throw Error(r(92));if(Ve(u)){if(1<u.length)throw Error(r(93));u=u[0]}l=u}l==null&&(l=""),i=l}l=fn(i),s.defaultValue=l,u=s.textContent,u===l&&u!==""&&u!==null&&(s.value=u),cc(s)}function Mr(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var Gw=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Eh(s,i,l){var u=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":u?s.setProperty(i,l):typeof l!="number"||l===0||Gw.has(i)?i==="float"?s.cssFloat=l:s[i]=(""+l).trim():s[i]=l+"px"}function Th(s,i,l){if(i!=null&&typeof i!="object")throw Error(r(62));if(s=s.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||i!=null&&i.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var y in i)u=i[y],i.hasOwnProperty(y)&&l[y]!==u&&Eh(s,y,u)}else for(var b in i)i.hasOwnProperty(b)&&Eh(s,b,i[b])}function fc(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hw=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zw=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function eo(s){return zw.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Jn(){}var hc=null;function pc(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Pr=null,kr=null;function Nh(s){var i=Ar(s);if(i&&(s=i.stateNode)){var l=s[Ht]||null;e:switch(s=i.stateNode,i.type){case"input":if(uc(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+hn(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var u=l[i];if(u!==s&&u.form===s.form){var y=u[Ht]||null;if(!y)throw Error(r(90));uc(u,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(i=0;i<l.length;i++)u=l[i],u.form===s.form&&bh(u)}break e;case"textarea":_h(s,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&Dr(s,!!l.multiple,i,!1)}}}var mc=!1;function Ch(s,i,l){if(mc)return s(i,l);mc=!0;try{var u=s(i);return u}finally{if(mc=!1,(Pr!==null||kr!==null)&&(Go(),Pr&&(i=Pr,s=kr,kr=Pr=null,Nh(i),s)))for(i=0;i<s.length;i++)Nh(s[i])}}function Bi(s,i){var l=s.stateNode;if(l===null)return null;var u=l[Ht]||null;if(u===null)return null;l=u[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(r(231,i,typeof l));return l}var Yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gc=!1;if(Yn)try{var Vi={};Object.defineProperty(Vi,"passive",{get:function(){gc=!0}}),window.addEventListener("test",Vi,Vi),window.removeEventListener("test",Vi,Vi)}catch{gc=!1}var vs=null,yc=null,to=null;function Ah(){if(to)return to;var s,i=yc,l=i.length,u,y="value"in vs?vs.value:vs.textContent,b=y.length;for(s=0;s<l&&i[s]===y[s];s++);var S=l-s;for(u=1;u<=S&&i[l-u]===y[b-u];u++);return to=y.slice(s,1<u?1-u:void 0)}function no(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function so(){return!0}function Ih(){return!1}function zt(s){function i(l,u,y,b,S){this._reactName=l,this._targetInst=y,this.type=u,this.nativeEvent=b,this.target=S,this.currentTarget=null;for(var T in s)s.hasOwnProperty(T)&&(l=s[T],this[T]=l?l(b):b[T]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?so:Ih,this.isPropagationStopped=Ih,this}return v(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=so)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=so)},persist:function(){},isPersistent:so}),i}var Xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ro=zt(Xs),Gi=v({},Xs,{view:0,detail:0}),Fw=zt(Gi),xc,vc,Hi,io=v({},Gi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Hi&&(Hi&&s.type==="mousemove"?(xc=s.screenX-Hi.screenX,vc=s.screenY-Hi.screenY):vc=xc=0,Hi=s),xc)},movementY:function(s){return"movementY"in s?s.movementY:vc}}),Rh=zt(io),$w=v({},io,{dataTransfer:0}),Jw=zt($w),Yw=v({},Gi,{relatedTarget:0}),bc=zt(Yw),Kw=v({},Xs,{animationName:0,elapsedTime:0,pseudoElement:0}),Qw=zt(Kw),Xw=v({},Xs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Ww=zt(Xw),Zw=v({},Xs,{data:0}),Dh=zt(Zw),e_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},t_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},n_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function s_(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=n_[s])?!!i[s]:!1}function wc(){return s_}var r_=v({},Gi,{key:function(s){if(s.key){var i=e_[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=no(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?t_[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wc,charCode:function(s){return s.type==="keypress"?no(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?no(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),i_=zt(r_),a_=v({},io,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mh=zt(a_),o_=v({},Gi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wc}),l_=zt(o_),c_=v({},Xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),u_=zt(c_),d_=v({},io,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),f_=zt(d_),h_=v({},Xs,{newState:0,oldState:0}),p_=zt(h_),m_=[9,13,27,32],_c=Yn&&"CompositionEvent"in window,zi=null;Yn&&"documentMode"in document&&(zi=document.documentMode);var g_=Yn&&"TextEvent"in window&&!zi,Ph=Yn&&(!_c||zi&&8<zi&&11>=zi),kh=" ",Uh=!1;function jh(s,i){switch(s){case"keyup":return m_.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Oh(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ur=!1;function y_(s,i){switch(s){case"compositionend":return Oh(i);case"keypress":return i.which!==32?null:(Uh=!0,kh);case"textInput":return s=i.data,s===kh&&Uh?null:s;default:return null}}function x_(s,i){if(Ur)return s==="compositionend"||!_c&&jh(s,i)?(s=Ah(),to=yc=vs=null,Ur=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Ph&&i.locale!=="ko"?null:i.data;default:return null}}var v_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lh(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!v_[s.type]:i==="textarea"}function qh(s,i,l,u){Pr?kr?kr.push(u):kr=[u]:Pr=u,i=Ko(i,"onChange"),0<i.length&&(l=new ro("onChange","change",null,l,u),s.push({event:l,listeners:i}))}var Fi=null,$i=null;function b_(s){w0(s,0)}function ao(s){var i=qi(s);if(bh(i))return s}function Bh(s,i){if(s==="change")return i}var Vh=!1;if(Yn){var Sc;if(Yn){var Ec="oninput"in document;if(!Ec){var Gh=document.createElement("div");Gh.setAttribute("oninput","return;"),Ec=typeof Gh.oninput=="function"}Sc=Ec}else Sc=!1;Vh=Sc&&(!document.documentMode||9<document.documentMode)}function Hh(){Fi&&(Fi.detachEvent("onpropertychange",zh),$i=Fi=null)}function zh(s){if(s.propertyName==="value"&&ao($i)){var i=[];qh(i,$i,s,pc(s)),Ch(b_,i)}}function w_(s,i,l){s==="focusin"?(Hh(),Fi=i,$i=l,Fi.attachEvent("onpropertychange",zh)):s==="focusout"&&Hh()}function __(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return ao($i)}function S_(s,i){if(s==="click")return ao(i)}function E_(s,i){if(s==="input"||s==="change")return ao(i)}function T_(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var Zt=typeof Object.is=="function"?Object.is:T_;function Ji(s,i){if(Zt(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),u=Object.keys(i);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var y=l[u];if(!At.call(i,y)||!Zt(s[y],i[y]))return!1}return!0}function Fh(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function $h(s,i){var l=Fh(s);s=0;for(var u;l;){if(l.nodeType===3){if(u=s+l.textContent.length,s<=i&&u>=i)return{node:l,offset:i-s};s=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Fh(l)}}function Jh(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?Jh(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function Yh(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=Za(s.document);i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=Za(s.document)}return i}function Tc(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var N_=Yn&&"documentMode"in document&&11>=document.documentMode,jr=null,Nc=null,Yi=null,Cc=!1;function Kh(s,i,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Cc||jr==null||jr!==Za(u)||(u=jr,"selectionStart"in u&&Tc(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Yi&&Ji(Yi,u)||(Yi=u,u=Ko(Nc,"onSelect"),0<u.length&&(i=new ro("onSelect","select",null,i,l),s.push({event:i,listeners:u}),i.target=jr)))}function Ws(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var Or={animationend:Ws("Animation","AnimationEnd"),animationiteration:Ws("Animation","AnimationIteration"),animationstart:Ws("Animation","AnimationStart"),transitionrun:Ws("Transition","TransitionRun"),transitionstart:Ws("Transition","TransitionStart"),transitioncancel:Ws("Transition","TransitionCancel"),transitionend:Ws("Transition","TransitionEnd")},Ac={},Qh={};Yn&&(Qh=document.createElement("div").style,"AnimationEvent"in window||(delete Or.animationend.animation,delete Or.animationiteration.animation,delete Or.animationstart.animation),"TransitionEvent"in window||delete Or.transitionend.transition);function Zs(s){if(Ac[s])return Ac[s];if(!Or[s])return s;var i=Or[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in Qh)return Ac[s]=i[l];return s}var Xh=Zs("animationend"),Wh=Zs("animationiteration"),Zh=Zs("animationstart"),C_=Zs("transitionrun"),A_=Zs("transitionstart"),I_=Zs("transitioncancel"),ep=Zs("transitionend"),tp=new Map,Ic="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ic.push("scrollEnd");function Tn(s,i){tp.set(s,i),Qs(i,[s])}var oo=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},pn=[],Lr=0,Rc=0;function lo(){for(var s=Lr,i=Rc=Lr=0;i<s;){var l=pn[i];pn[i++]=null;var u=pn[i];pn[i++]=null;var y=pn[i];pn[i++]=null;var b=pn[i];if(pn[i++]=null,u!==null&&y!==null){var S=u.pending;S===null?y.next=y:(y.next=S.next,S.next=y),u.pending=y}b!==0&&np(l,y,b)}}function co(s,i,l,u){pn[Lr++]=s,pn[Lr++]=i,pn[Lr++]=l,pn[Lr++]=u,Rc|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function Dc(s,i,l,u){return co(s,i,l,u),uo(s)}function er(s,i){return co(s,null,null,i),uo(s)}function np(s,i,l){s.lanes|=l;var u=s.alternate;u!==null&&(u.lanes|=l);for(var y=!1,b=s.return;b!==null;)b.childLanes|=l,u=b.alternate,u!==null&&(u.childLanes|=l),b.tag===22&&(s=b.stateNode,s===null||s._visibility&1||(y=!0)),s=b,b=b.return;return s.tag===3?(b=s.stateNode,y&&i!==null&&(y=31-Wt(l),s=b.hiddenUpdates,u=s[y],u===null?s[y]=[i]:u.push(i),i.lane=l|536870912),b):null}function uo(s){if(50<ga)throw ga=0,Bu=null,Error(r(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var qr={};function R_(s,i,l,u){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function en(s,i,l,u){return new R_(s,i,l,u)}function Mc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Kn(s,i){var l=s.alternate;return l===null?(l=en(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function sp(s,i){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function fo(s,i,l,u,y,b){var S=0;if(u=s,typeof s=="function")Mc(s)&&(S=1);else if(typeof s=="string")S=US(s,l,re.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case J:return s=en(31,l,i,y),s.elementType=J,s.lanes=b,s;case N:return tr(l.children,y,b,i);case I:S=8,y|=24;break;case P:return s=en(12,l,i,y|2),s.elementType=P,s.lanes=b,s;case k:return s=en(13,l,i,y),s.elementType=k,s.lanes=b,s;case q:return s=en(19,l,i,y),s.elementType=q,s.lanes=b,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case R:S=10;break e;case U:S=9;break e;case A:S=11;break e;case V:S=14;break e;case W:S=16,u=null;break e}S=29,l=Error(r(130,s===null?"null":typeof s,"")),u=null}return i=en(S,l,i,y),i.elementType=s,i.type=u,i.lanes=b,i}function tr(s,i,l,u){return s=en(7,s,u,i),s.lanes=l,s}function Pc(s,i,l){return s=en(6,s,null,i),s.lanes=l,s}function rp(s){var i=en(18,null,null,0);return i.stateNode=s,i}function kc(s,i,l){return i=en(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var ip=new WeakMap;function mn(s,i){if(typeof s=="object"&&s!==null){var l=ip.get(s);return l!==void 0?l:(i={value:s,source:i,stack:wt(i)},ip.set(s,i),i)}return{value:s,source:i,stack:wt(i)}}var Br=[],Vr=0,ho=null,Ki=0,gn=[],yn=0,bs=null,qn=1,Bn="";function Qn(s,i){Br[Vr++]=Ki,Br[Vr++]=ho,ho=s,Ki=i}function ap(s,i,l){gn[yn++]=qn,gn[yn++]=Bn,gn[yn++]=bs,bs=s;var u=qn;s=Bn;var y=32-Wt(u)-1;u&=~(1<<y),l+=1;var b=32-Wt(i)+y;if(30<b){var S=y-y%5;b=(u&(1<<S)-1).toString(32),u>>=S,y-=S,qn=1<<32-Wt(i)+y|l<<y|u,Bn=b+s}else qn=1<<b|l<<y|u,Bn=s}function Uc(s){s.return!==null&&(Qn(s,1),ap(s,1,0))}function jc(s){for(;s===ho;)ho=Br[--Vr],Br[Vr]=null,Ki=Br[--Vr],Br[Vr]=null;for(;s===bs;)bs=gn[--yn],gn[yn]=null,Bn=gn[--yn],gn[yn]=null,qn=gn[--yn],gn[yn]=null}function op(s,i){gn[yn++]=qn,gn[yn++]=Bn,gn[yn++]=bs,qn=i.id,Bn=i.overflow,bs=s}var Rt=null,at=null,Ge=!1,ws=null,xn=!1,Oc=Error(r(519));function _s(s){var i=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Qi(mn(i,s)),Oc}function lp(s){var i=s.stateNode,l=s.type,u=s.memoizedProps;switch(i[It]=s,i[Ht]=u,l){case"dialog":Oe("cancel",i),Oe("close",i);break;case"iframe":case"object":case"embed":Oe("load",i);break;case"video":case"audio":for(l=0;l<xa.length;l++)Oe(xa[l],i);break;case"source":Oe("error",i);break;case"img":case"image":case"link":Oe("error",i),Oe("load",i);break;case"details":Oe("toggle",i);break;case"input":Oe("invalid",i),wh(i,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":Oe("invalid",i);break;case"textarea":Oe("invalid",i),Sh(i,u.value,u.defaultValue,u.children)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||u.suppressHydrationWarning===!0||T0(i.textContent,l)?(u.popover!=null&&(Oe("beforetoggle",i),Oe("toggle",i)),u.onScroll!=null&&Oe("scroll",i),u.onScrollEnd!=null&&Oe("scrollend",i),u.onClick!=null&&(i.onclick=Jn),i=!0):i=!1,i||_s(s,!0)}function cp(s){for(Rt=s.return;Rt;)switch(Rt.tag){case 5:case 31:case 13:xn=!1;return;case 27:case 3:xn=!0;return;default:Rt=Rt.return}}function Gr(s){if(s!==Rt)return!1;if(!Ge)return cp(s),Ge=!0,!1;var i=s.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||td(s.type,s.memoizedProps)),l=!l),l&&at&&_s(s),cp(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));at=k0(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));at=k0(s)}else i===27?(i=at,js(s.type)?(s=ad,ad=null,at=s):at=i):at=Rt?bn(s.stateNode.nextSibling):null;return!0}function nr(){at=Rt=null,Ge=!1}function Lc(){var s=ws;return s!==null&&(Yt===null?Yt=s:Yt.push.apply(Yt,s),ws=null),s}function Qi(s){ws===null?ws=[s]:ws.push(s)}var qc=D(null),sr=null,Xn=null;function Ss(s,i,l){Q(qc,i._currentValue),i._currentValue=l}function Wn(s){s._currentValue=qc.current,L(qc)}function Bc(s,i,l){for(;s!==null;){var u=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,u!==null&&(u.childLanes|=i)):u!==null&&(u.childLanes&i)!==i&&(u.childLanes|=i),s===l)break;s=s.return}}function Vc(s,i,l,u){var y=s.child;for(y!==null&&(y.return=s);y!==null;){var b=y.dependencies;if(b!==null){var S=y.child;b=b.firstContext;e:for(;b!==null;){var T=b;b=y;for(var j=0;j<i.length;j++)if(T.context===i[j]){b.lanes|=l,T=b.alternate,T!==null&&(T.lanes|=l),Bc(b.return,l,s),u||(S=null);break e}b=T.next}}else if(y.tag===18){if(S=y.return,S===null)throw Error(r(341));S.lanes|=l,b=S.alternate,b!==null&&(b.lanes|=l),Bc(S,l,s),S=null}else S=y.child;if(S!==null)S.return=y;else for(S=y;S!==null;){if(S===s){S=null;break}if(y=S.sibling,y!==null){y.return=S.return,S=y;break}S=S.return}y=S}}function Hr(s,i,l,u){s=null;for(var y=i,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var S=y.alternate;if(S===null)throw Error(r(387));if(S=S.memoizedProps,S!==null){var T=y.type;Zt(y.pendingProps.value,S.value)||(s!==null?s.push(T):s=[T])}}else if(y===te.current){if(S=y.alternate,S===null)throw Error(r(387));S.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(s!==null?s.push(Sa):s=[Sa])}y=y.return}s!==null&&Vc(i,s,l,u),i.flags|=262144}function po(s){for(s=s.firstContext;s!==null;){if(!Zt(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function rr(s){sr=s,Xn=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Dt(s){return up(sr,s)}function mo(s,i){return sr===null&&rr(s),up(s,i)}function up(s,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},Xn===null){if(s===null)throw Error(r(308));Xn=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else Xn=Xn.next=i;return l}var D_=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(l,u){s.push(u)}};this.abort=function(){i.aborted=!0,s.forEach(function(l){return l()})}},M_=t.unstable_scheduleCallback,P_=t.unstable_NormalPriority,mt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gc(){return{controller:new D_,data:new Map,refCount:0}}function Xi(s){s.refCount--,s.refCount===0&&M_(P_,function(){s.controller.abort()})}var Wi=null,Hc=0,zr=0,Fr=null;function k_(s,i){if(Wi===null){var l=Wi=[];Hc=0,zr=$u(),Fr={status:"pending",value:void 0,then:function(u){l.push(u)}}}return Hc++,i.then(dp,dp),i}function dp(){if(--Hc===0&&Wi!==null){Fr!==null&&(Fr.status="fulfilled");var s=Wi;Wi=null,zr=0,Fr=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function U_(s,i){var l=[],u={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return s.then(function(){u.status="fulfilled",u.value=i;for(var y=0;y<l.length;y++)(0,l[y])(i)},function(y){for(u.status="rejected",u.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),u}var fp=M.S;M.S=function(s,i){Km=ie(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&k_(s,i),fp!==null&&fp(s,i)};var ir=D(null);function zc(){var s=ir.current;return s!==null?s:nt.pooledCache}function go(s,i){i===null?Q(ir,ir.current):Q(ir,i.pool)}function hp(){var s=zc();return s===null?null:{parent:mt._currentValue,pool:s}}var $r=Error(r(460)),Fc=Error(r(474)),yo=Error(r(542)),xo={then:function(){}};function pp(s){return s=s.status,s==="fulfilled"||s==="rejected"}function mp(s,i,l){switch(l=s[l],l===void 0?s.push(i):l!==i&&(i.then(Jn,Jn),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,yp(s),s;default:if(typeof i.status=="string")i.then(Jn,Jn);else{if(s=nt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=i,s.status="pending",s.then(function(u){if(i.status==="pending"){var y=i;y.status="fulfilled",y.value=u}},function(u){if(i.status==="pending"){var y=i;y.status="rejected",y.reason=u}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,yp(s),s}throw or=i,$r}}function ar(s){try{var i=s._init;return i(s._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(or=l,$r):l}}var or=null;function gp(){if(or===null)throw Error(r(459));var s=or;return or=null,s}function yp(s){if(s===$r||s===yo)throw Error(r(483))}var Jr=null,Zi=0;function vo(s){var i=Zi;return Zi+=1,Jr===null&&(Jr=[]),mp(Jr,s,i)}function ea(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function bo(s,i){throw i.$$typeof===w?Error(r(525)):(s=Object.prototype.toString.call(i),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function xp(s){function i(B,O){if(s){var H=B.deletions;H===null?(B.deletions=[O],B.flags|=16):H.push(O)}}function l(B,O){if(!s)return null;for(;O!==null;)i(B,O),O=O.sibling;return null}function u(B){for(var O=new Map;B!==null;)B.key!==null?O.set(B.key,B):O.set(B.index,B),B=B.sibling;return O}function y(B,O){return B=Kn(B,O),B.index=0,B.sibling=null,B}function b(B,O,H){return B.index=H,s?(H=B.alternate,H!==null?(H=H.index,H<O?(B.flags|=67108866,O):H):(B.flags|=67108866,O)):(B.flags|=1048576,O)}function S(B){return s&&B.alternate===null&&(B.flags|=67108866),B}function T(B,O,H,ee){return O===null||O.tag!==6?(O=Pc(H,B.mode,ee),O.return=B,O):(O=y(O,H),O.return=B,O)}function j(B,O,H,ee){var Se=H.type;return Se===N?X(B,O,H.props.children,ee,H.key):O!==null&&(O.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===W&&ar(Se)===O.type)?(O=y(O,H.props),ea(O,H),O.return=B,O):(O=fo(H.type,H.key,H.props,null,B.mode,ee),ea(O,H),O.return=B,O)}function z(B,O,H,ee){return O===null||O.tag!==4||O.stateNode.containerInfo!==H.containerInfo||O.stateNode.implementation!==H.implementation?(O=kc(H,B.mode,ee),O.return=B,O):(O=y(O,H.children||[]),O.return=B,O)}function X(B,O,H,ee,Se){return O===null||O.tag!==7?(O=tr(H,B.mode,ee,Se),O.return=B,O):(O=y(O,H),O.return=B,O)}function ne(B,O,H){if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return O=Pc(""+O,B.mode,H),O.return=B,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case _:return H=fo(O.type,O.key,O.props,null,B.mode,H),ea(H,O),H.return=B,H;case E:return O=kc(O,B.mode,H),O.return=B,O;case W:return O=ar(O),ne(B,O,H)}if(Ve(O)||ue(O))return O=tr(O,B.mode,H,null),O.return=B,O;if(typeof O.then=="function")return ne(B,vo(O),H);if(O.$$typeof===R)return ne(B,mo(B,O),H);bo(B,O)}return null}function F(B,O,H,ee){var Se=O!==null?O.key:null;if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return Se!==null?null:T(B,O,""+H,ee);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case _:return H.key===Se?j(B,O,H,ee):null;case E:return H.key===Se?z(B,O,H,ee):null;case W:return H=ar(H),F(B,O,H,ee)}if(Ve(H)||ue(H))return Se!==null?null:X(B,O,H,ee,null);if(typeof H.then=="function")return F(B,O,vo(H),ee);if(H.$$typeof===R)return F(B,O,mo(B,H),ee);bo(B,H)}return null}function Y(B,O,H,ee,Se){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return B=B.get(H)||null,T(O,B,""+ee,Se);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case _:return B=B.get(ee.key===null?H:ee.key)||null,j(O,B,ee,Se);case E:return B=B.get(ee.key===null?H:ee.key)||null,z(O,B,ee,Se);case W:return ee=ar(ee),Y(B,O,H,ee,Se)}if(Ve(ee)||ue(ee))return B=B.get(H)||null,X(O,B,ee,Se,null);if(typeof ee.then=="function")return Y(B,O,H,vo(ee),Se);if(ee.$$typeof===R)return Y(B,O,H,mo(O,ee),Se);bo(O,ee)}return null}function me(B,O,H,ee){for(var Se=null,Fe=null,xe=O,Pe=O=0,qe=null;xe!==null&&Pe<H.length;Pe++){xe.index>Pe?(qe=xe,xe=null):qe=xe.sibling;var $e=F(B,xe,H[Pe],ee);if($e===null){xe===null&&(xe=qe);break}s&&xe&&$e.alternate===null&&i(B,xe),O=b($e,O,Pe),Fe===null?Se=$e:Fe.sibling=$e,Fe=$e,xe=qe}if(Pe===H.length)return l(B,xe),Ge&&Qn(B,Pe),Se;if(xe===null){for(;Pe<H.length;Pe++)xe=ne(B,H[Pe],ee),xe!==null&&(O=b(xe,O,Pe),Fe===null?Se=xe:Fe.sibling=xe,Fe=xe);return Ge&&Qn(B,Pe),Se}for(xe=u(xe);Pe<H.length;Pe++)qe=Y(xe,B,Pe,H[Pe],ee),qe!==null&&(s&&qe.alternate!==null&&xe.delete(qe.key===null?Pe:qe.key),O=b(qe,O,Pe),Fe===null?Se=qe:Fe.sibling=qe,Fe=qe);return s&&xe.forEach(function(Vs){return i(B,Vs)}),Ge&&Qn(B,Pe),Se}function Te(B,O,H,ee){if(H==null)throw Error(r(151));for(var Se=null,Fe=null,xe=O,Pe=O=0,qe=null,$e=H.next();xe!==null&&!$e.done;Pe++,$e=H.next()){xe.index>Pe?(qe=xe,xe=null):qe=xe.sibling;var Vs=F(B,xe,$e.value,ee);if(Vs===null){xe===null&&(xe=qe);break}s&&xe&&Vs.alternate===null&&i(B,xe),O=b(Vs,O,Pe),Fe===null?Se=Vs:Fe.sibling=Vs,Fe=Vs,xe=qe}if($e.done)return l(B,xe),Ge&&Qn(B,Pe),Se;if(xe===null){for(;!$e.done;Pe++,$e=H.next())$e=ne(B,$e.value,ee),$e!==null&&(O=b($e,O,Pe),Fe===null?Se=$e:Fe.sibling=$e,Fe=$e);return Ge&&Qn(B,Pe),Se}for(xe=u(xe);!$e.done;Pe++,$e=H.next())$e=Y(xe,B,Pe,$e.value,ee),$e!==null&&(s&&$e.alternate!==null&&xe.delete($e.key===null?Pe:$e.key),O=b($e,O,Pe),Fe===null?Se=$e:Fe.sibling=$e,Fe=$e);return s&&xe.forEach(function($S){return i(B,$S)}),Ge&&Qn(B,Pe),Se}function et(B,O,H,ee){if(typeof H=="object"&&H!==null&&H.type===N&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case _:e:{for(var Se=H.key;O!==null;){if(O.key===Se){if(Se=H.type,Se===N){if(O.tag===7){l(B,O.sibling),ee=y(O,H.props.children),ee.return=B,B=ee;break e}}else if(O.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===W&&ar(Se)===O.type){l(B,O.sibling),ee=y(O,H.props),ea(ee,H),ee.return=B,B=ee;break e}l(B,O);break}else i(B,O);O=O.sibling}H.type===N?(ee=tr(H.props.children,B.mode,ee,H.key),ee.return=B,B=ee):(ee=fo(H.type,H.key,H.props,null,B.mode,ee),ea(ee,H),ee.return=B,B=ee)}return S(B);case E:e:{for(Se=H.key;O!==null;){if(O.key===Se)if(O.tag===4&&O.stateNode.containerInfo===H.containerInfo&&O.stateNode.implementation===H.implementation){l(B,O.sibling),ee=y(O,H.children||[]),ee.return=B,B=ee;break e}else{l(B,O);break}else i(B,O);O=O.sibling}ee=kc(H,B.mode,ee),ee.return=B,B=ee}return S(B);case W:return H=ar(H),et(B,O,H,ee)}if(Ve(H))return me(B,O,H,ee);if(ue(H)){if(Se=ue(H),typeof Se!="function")throw Error(r(150));return H=Se.call(H),Te(B,O,H,ee)}if(typeof H.then=="function")return et(B,O,vo(H),ee);if(H.$$typeof===R)return et(B,O,mo(B,H),ee);bo(B,H)}return typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint"?(H=""+H,O!==null&&O.tag===6?(l(B,O.sibling),ee=y(O,H),ee.return=B,B=ee):(l(B,O),ee=Pc(H,B.mode,ee),ee.return=B,B=ee),S(B)):l(B,O)}return function(B,O,H,ee){try{Zi=0;var Se=et(B,O,H,ee);return Jr=null,Se}catch(xe){if(xe===$r||xe===yo)throw xe;var Fe=en(29,xe,null,B.mode);return Fe.lanes=ee,Fe.return=B,Fe}finally{}}}var lr=xp(!0),vp=xp(!1),Es=!1;function $c(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Jc(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ts(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ns(s,i,l){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,(Ye&2)!==0){var y=u.pending;return y===null?i.next=i:(i.next=y.next,y.next=i),u.pending=i,i=uo(s),np(s,null,l),i}return co(s,u,i,l),uo(s)}function ta(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var u=i.lanes;u&=s.pendingLanes,l|=u,i.lanes=l,uh(s,l)}}function Yc(s,i){var l=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var y=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var S={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};b===null?y=b=S:b=b.next=S,l=l.next}while(l!==null);b===null?y=b=i:b=b.next=i}else y=b=i;l={baseState:u.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:u.shared,callbacks:u.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}var Kc=!1;function na(){if(Kc){var s=Fr;if(s!==null)throw s}}function sa(s,i,l,u){Kc=!1;var y=s.updateQueue;Es=!1;var b=y.firstBaseUpdate,S=y.lastBaseUpdate,T=y.shared.pending;if(T!==null){y.shared.pending=null;var j=T,z=j.next;j.next=null,S===null?b=z:S.next=z,S=j;var X=s.alternate;X!==null&&(X=X.updateQueue,T=X.lastBaseUpdate,T!==S&&(T===null?X.firstBaseUpdate=z:T.next=z,X.lastBaseUpdate=j))}if(b!==null){var ne=y.baseState;S=0,X=z=j=null,T=b;do{var F=T.lane&-536870913,Y=F!==T.lane;if(Y?(Le&F)===F:(u&F)===F){F!==0&&F===zr&&(Kc=!0),X!==null&&(X=X.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var me=s,Te=T;F=i;var et=l;switch(Te.tag){case 1:if(me=Te.payload,typeof me=="function"){ne=me.call(et,ne,F);break e}ne=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=Te.payload,F=typeof me=="function"?me.call(et,ne,F):me,F==null)break e;ne=v({},ne,F);break e;case 2:Es=!0}}F=T.callback,F!==null&&(s.flags|=64,Y&&(s.flags|=8192),Y=y.callbacks,Y===null?y.callbacks=[F]:Y.push(F))}else Y={lane:F,tag:T.tag,payload:T.payload,callback:T.callback,next:null},X===null?(z=X=Y,j=ne):X=X.next=Y,S|=F;if(T=T.next,T===null){if(T=y.shared.pending,T===null)break;Y=T,T=Y.next,Y.next=null,y.lastBaseUpdate=Y,y.shared.pending=null}}while(!0);X===null&&(j=ne),y.baseState=j,y.firstBaseUpdate=z,y.lastBaseUpdate=X,b===null&&(y.shared.lanes=0),Ds|=S,s.lanes=S,s.memoizedState=ne}}function bp(s,i){if(typeof s!="function")throw Error(r(191,s));s.call(i)}function wp(s,i){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)bp(l[s],i)}var Yr=D(null),wo=D(0);function _p(s,i){s=os,Q(wo,s),Q(Yr,i),os=s|i.baseLanes}function Qc(){Q(wo,os),Q(Yr,Yr.current)}function Xc(){os=wo.current,L(Yr),L(wo)}var tn=D(null),vn=null;function Cs(s){var i=s.alternate;Q(ht,ht.current&1),Q(tn,s),vn===null&&(i===null||Yr.current!==null||i.memoizedState!==null)&&(vn=s)}function Wc(s){Q(ht,ht.current),Q(tn,s),vn===null&&(vn=s)}function Sp(s){s.tag===22?(Q(ht,ht.current),Q(tn,s),vn===null&&(vn=s)):As()}function As(){Q(ht,ht.current),Q(tn,tn.current)}function nn(s){L(tn),vn===s&&(vn=null),L(ht)}var ht=D(0);function _o(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||rd(l)||id(l)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Zn=0,Me=null,We=null,gt=null,So=!1,Kr=!1,cr=!1,Eo=0,ra=0,Qr=null,j_=0;function dt(){throw Error(r(321))}function Zc(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!Zt(s[l],i[l]))return!1;return!0}function eu(s,i,l,u,y,b){return Zn=b,Me=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,M.H=s===null||s.memoizedState===null?am:mu,cr=!1,b=l(u,y),cr=!1,Kr&&(b=Tp(i,l,u,y)),Ep(s),b}function Ep(s){M.H=oa;var i=We!==null&&We.next!==null;if(Zn=0,gt=We=Me=null,So=!1,ra=0,Qr=null,i)throw Error(r(300));s===null||yt||(s=s.dependencies,s!==null&&po(s)&&(yt=!0))}function Tp(s,i,l,u){Me=s;var y=0;do{if(Kr&&(Qr=null),ra=0,Kr=!1,25<=y)throw Error(r(301));if(y+=1,gt=We=null,s.updateQueue!=null){var b=s.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}M.H=om,b=i(l,u)}while(Kr);return b}function O_(){var s=M.H,i=s.useState()[0];return i=typeof i.then=="function"?ia(i):i,s=s.useState()[0],(We!==null?We.memoizedState:null)!==s&&(Me.flags|=1024),i}function tu(){var s=Eo!==0;return Eo=0,s}function nu(s,i,l){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~l}function su(s){if(So){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}So=!1}Zn=0,gt=We=Me=null,Kr=!1,ra=Eo=0,Qr=null}function qt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?Me.memoizedState=gt=s:gt=gt.next=s,gt}function pt(){if(We===null){var s=Me.alternate;s=s!==null?s.memoizedState:null}else s=We.next;var i=gt===null?Me.memoizedState:gt.next;if(i!==null)gt=i,We=s;else{if(s===null)throw Me.alternate===null?Error(r(467)):Error(r(310));We=s,s={memoizedState:We.memoizedState,baseState:We.baseState,baseQueue:We.baseQueue,queue:We.queue,next:null},gt===null?Me.memoizedState=gt=s:gt=gt.next=s}return gt}function To(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ia(s){var i=ra;return ra+=1,Qr===null&&(Qr=[]),s=mp(Qr,s,i),i=Me,(gt===null?i.memoizedState:gt.next)===null&&(i=i.alternate,M.H=i===null||i.memoizedState===null?am:mu),s}function No(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return ia(s);if(s.$$typeof===R)return Dt(s)}throw Error(r(438,String(s)))}function ru(s){var i=null,l=Me.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var u=Me.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(i={data:u.data.map(function(y){return y.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=To(),Me.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(s),u=0;u<s;u++)l[u]=$;return i.index++,l}function es(s,i){return typeof i=="function"?i(s):i}function Co(s){var i=pt();return iu(i,We,s)}function iu(s,i,l){var u=s.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=l;var y=s.baseQueue,b=u.pending;if(b!==null){if(y!==null){var S=y.next;y.next=b.next,b.next=S}i.baseQueue=y=b,u.pending=null}if(b=s.baseState,y===null)s.memoizedState=b;else{i=y.next;var T=S=null,j=null,z=i,X=!1;do{var ne=z.lane&-536870913;if(ne!==z.lane?(Le&ne)===ne:(Zn&ne)===ne){var F=z.revertLane;if(F===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),ne===zr&&(X=!0);else if((Zn&F)===F){z=z.next,F===zr&&(X=!0);continue}else ne={lane:0,revertLane:z.revertLane,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},j===null?(T=j=ne,S=b):j=j.next=ne,Me.lanes|=F,Ds|=F;ne=z.action,cr&&l(b,ne),b=z.hasEagerState?z.eagerState:l(b,ne)}else F={lane:ne,revertLane:z.revertLane,gesture:z.gesture,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},j===null?(T=j=F,S=b):j=j.next=F,Me.lanes|=ne,Ds|=ne;z=z.next}while(z!==null&&z!==i);if(j===null?S=b:j.next=T,!Zt(b,s.memoizedState)&&(yt=!0,X&&(l=Fr,l!==null)))throw l;s.memoizedState=b,s.baseState=S,s.baseQueue=j,u.lastRenderedState=b}return y===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function au(s){var i=pt(),l=i.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=s;var u=l.dispatch,y=l.pending,b=i.memoizedState;if(y!==null){l.pending=null;var S=y=y.next;do b=s(b,S.action),S=S.next;while(S!==y);Zt(b,i.memoizedState)||(yt=!0),i.memoizedState=b,i.baseQueue===null&&(i.baseState=b),l.lastRenderedState=b}return[b,u]}function Np(s,i,l){var u=Me,y=pt(),b=Ge;if(b){if(l===void 0)throw Error(r(407));l=l()}else l=i();var S=!Zt((We||y).memoizedState,l);if(S&&(y.memoizedState=l,yt=!0),y=y.queue,cu(Ip.bind(null,u,y,s),[s]),y.getSnapshot!==i||S||gt!==null&&gt.memoizedState.tag&1){if(u.flags|=2048,Xr(9,{destroy:void 0},Ap.bind(null,u,y,l,i),null),nt===null)throw Error(r(349));b||(Zn&127)!==0||Cp(u,i,l)}return l}function Cp(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=Me.updateQueue,i===null?(i=To(),Me.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function Ap(s,i,l,u){i.value=l,i.getSnapshot=u,Rp(i)&&Dp(s)}function Ip(s,i,l){return l(function(){Rp(i)&&Dp(s)})}function Rp(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!Zt(s,l)}catch{return!0}}function Dp(s){var i=er(s,2);i!==null&&Kt(i,s,2)}function ou(s){var i=qt();if(typeof s=="function"){var l=s;if(s=l(),cr){ys(!0);try{l()}finally{ys(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:es,lastRenderedState:s},i}function Mp(s,i,l,u){return s.baseState=l,iu(s,We,typeof u=="function"?u:es)}function L_(s,i,l,u,y){if(Ro(s))throw Error(r(485));if(s=i.action,s!==null){var b={payload:y,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){b.listeners.push(S)}};M.T!==null?l(!0):b.isTransition=!1,u(b),l=i.pending,l===null?(b.next=i.pending=b,Pp(i,b)):(b.next=l.next,i.pending=l.next=b)}}function Pp(s,i){var l=i.action,u=i.payload,y=s.state;if(i.isTransition){var b=M.T,S={};M.T=S;try{var T=l(y,u),j=M.S;j!==null&&j(S,T),kp(s,i,T)}catch(z){lu(s,i,z)}finally{b!==null&&S.types!==null&&(b.types=S.types),M.T=b}}else try{b=l(y,u),kp(s,i,b)}catch(z){lu(s,i,z)}}function kp(s,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){Up(s,i,u)},function(u){return lu(s,i,u)}):Up(s,i,l)}function Up(s,i,l){i.status="fulfilled",i.value=l,jp(i),s.state=l,i=s.pending,i!==null&&(l=i.next,l===i?s.pending=null:(l=l.next,i.next=l,Pp(s,l)))}function lu(s,i,l){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do i.status="rejected",i.reason=l,jp(i),i=i.next;while(i!==u)}s.action=null}function jp(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function Op(s,i){return i}function Lp(s,i){if(Ge){var l=nt.formState;if(l!==null){e:{var u=Me;if(Ge){if(at){t:{for(var y=at,b=xn;y.nodeType!==8;){if(!b){y=null;break t}if(y=bn(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){at=bn(y.nextSibling),u=y.data==="F!";break e}}_s(u)}u=!1}u&&(i=l[0])}}return l=qt(),l.memoizedState=l.baseState=i,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Op,lastRenderedState:i},l.queue=u,l=sm.bind(null,Me,u),u.dispatch=l,u=ou(!1),b=pu.bind(null,Me,!1,u.queue),u=qt(),y={state:i,dispatch:null,action:s,pending:null},u.queue=y,l=L_.bind(null,Me,y,b,l),y.dispatch=l,u.memoizedState=s,[i,l,!1]}function qp(s){var i=pt();return Bp(i,We,s)}function Bp(s,i,l){if(i=iu(s,i,Op)[0],s=Co(es)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var u=ia(i)}catch(S){throw S===$r?yo:S}else u=i;i=pt();var y=i.queue,b=y.dispatch;return l!==i.memoizedState&&(Me.flags|=2048,Xr(9,{destroy:void 0},q_.bind(null,y,l),null)),[u,b,s]}function q_(s,i){s.action=i}function Vp(s){var i=pt(),l=We;if(l!==null)return Bp(i,l,s);pt(),i=i.memoizedState,l=pt();var u=l.queue.dispatch;return l.memoizedState=s,[i,u,!1]}function Xr(s,i,l,u){return s={tag:s,create:l,deps:u,inst:i,next:null},i=Me.updateQueue,i===null&&(i=To(),Me.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=s.next=s:(u=l.next,l.next=s,s.next=u,i.lastEffect=s),s}function Gp(){return pt().memoizedState}function Ao(s,i,l,u){var y=qt();Me.flags|=s,y.memoizedState=Xr(1|i,{destroy:void 0},l,u===void 0?null:u)}function Io(s,i,l,u){var y=pt();u=u===void 0?null:u;var b=y.memoizedState.inst;We!==null&&u!==null&&Zc(u,We.memoizedState.deps)?y.memoizedState=Xr(i,b,l,u):(Me.flags|=s,y.memoizedState=Xr(1|i,b,l,u))}function Hp(s,i){Ao(8390656,8,s,i)}function cu(s,i){Io(2048,8,s,i)}function B_(s){Me.flags|=4;var i=Me.updateQueue;if(i===null)i=To(),Me.updateQueue=i,i.events=[s];else{var l=i.events;l===null?i.events=[s]:l.push(s)}}function zp(s){var i=pt().memoizedState;return B_({ref:i,nextImpl:s}),function(){if((Ye&2)!==0)throw Error(r(440));return i.impl.apply(void 0,arguments)}}function Fp(s,i){return Io(4,2,s,i)}function $p(s,i){return Io(4,4,s,i)}function Jp(s,i){if(typeof i=="function"){s=s();var l=i(s);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function Yp(s,i,l){l=l!=null?l.concat([s]):null,Io(4,4,Jp.bind(null,i,s),l)}function uu(){}function Kp(s,i){var l=pt();i=i===void 0?null:i;var u=l.memoizedState;return i!==null&&Zc(i,u[1])?u[0]:(l.memoizedState=[s,i],s)}function Qp(s,i){var l=pt();i=i===void 0?null:i;var u=l.memoizedState;if(i!==null&&Zc(i,u[1]))return u[0];if(u=s(),cr){ys(!0);try{s()}finally{ys(!1)}}return l.memoizedState=[u,i],u}function du(s,i,l){return l===void 0||(Zn&1073741824)!==0&&(Le&261930)===0?s.memoizedState=i:(s.memoizedState=l,s=Xm(),Me.lanes|=s,Ds|=s,l)}function Xp(s,i,l,u){return Zt(l,i)?l:Yr.current!==null?(s=du(s,l,u),Zt(s,i)||(yt=!0),s):(Zn&42)===0||(Zn&1073741824)!==0&&(Le&261930)===0?(yt=!0,s.memoizedState=l):(s=Xm(),Me.lanes|=s,Ds|=s,i)}function Wp(s,i,l,u,y){var b=G.p;G.p=b!==0&&8>b?b:8;var S=M.T,T={};M.T=T,pu(s,!1,i,l);try{var j=y(),z=M.S;if(z!==null&&z(T,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var X=U_(j,u);aa(s,i,X,an(s))}else aa(s,i,u,an(s))}catch(ne){aa(s,i,{then:function(){},status:"rejected",reason:ne},an())}finally{G.p=b,S!==null&&T.types!==null&&(S.types=T.types),M.T=S}}function V_(){}function fu(s,i,l,u){if(s.tag!==5)throw Error(r(476));var y=Zp(s).queue;Wp(s,y,i,Z,l===null?V_:function(){return em(s),l(u)})}function Zp(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:es,lastRenderedState:Z},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:es,lastRenderedState:l},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function em(s){var i=Zp(s);i.next===null&&(i=s.alternate.memoizedState),aa(s,i.next.queue,{},an())}function hu(){return Dt(Sa)}function tm(){return pt().memoizedState}function nm(){return pt().memoizedState}function G_(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var l=an();s=Ts(l);var u=Ns(i,s,l);u!==null&&(Kt(u,i,l),ta(u,i,l)),i={cache:Gc()},s.payload=i;return}i=i.return}}function H_(s,i,l){var u=an();l={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Ro(s)?rm(i,l):(l=Dc(s,i,l,u),l!==null&&(Kt(l,s,u),im(l,i,u)))}function sm(s,i,l){var u=an();aa(s,i,l,u)}function aa(s,i,l,u){var y={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Ro(s))rm(i,y);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=i.lastRenderedReducer,b!==null))try{var S=i.lastRenderedState,T=b(S,l);if(y.hasEagerState=!0,y.eagerState=T,Zt(T,S))return co(s,i,y,0),nt===null&&lo(),!1}catch{}finally{}if(l=Dc(s,i,y,u),l!==null)return Kt(l,s,u),im(l,i,u),!0}return!1}function pu(s,i,l,u){if(u={lane:2,revertLane:$u(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Ro(s)){if(i)throw Error(r(479))}else i=Dc(s,l,u,2),i!==null&&Kt(i,s,2)}function Ro(s){var i=s.alternate;return s===Me||i!==null&&i===Me}function rm(s,i){Kr=So=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function im(s,i,l){if((l&4194048)!==0){var u=i.lanes;u&=s.pendingLanes,l|=u,i.lanes=l,uh(s,l)}}var oa={readContext:Dt,use:No,useCallback:dt,useContext:dt,useEffect:dt,useImperativeHandle:dt,useLayoutEffect:dt,useInsertionEffect:dt,useMemo:dt,useReducer:dt,useRef:dt,useState:dt,useDebugValue:dt,useDeferredValue:dt,useTransition:dt,useSyncExternalStore:dt,useId:dt,useHostTransitionStatus:dt,useFormState:dt,useActionState:dt,useOptimistic:dt,useMemoCache:dt,useCacheRefresh:dt};oa.useEffectEvent=dt;var am={readContext:Dt,use:No,useCallback:function(s,i){return qt().memoizedState=[s,i===void 0?null:i],s},useContext:Dt,useEffect:Hp,useImperativeHandle:function(s,i,l){l=l!=null?l.concat([s]):null,Ao(4194308,4,Jp.bind(null,i,s),l)},useLayoutEffect:function(s,i){return Ao(4194308,4,s,i)},useInsertionEffect:function(s,i){Ao(4,2,s,i)},useMemo:function(s,i){var l=qt();i=i===void 0?null:i;var u=s();if(cr){ys(!0);try{s()}finally{ys(!1)}}return l.memoizedState=[u,i],u},useReducer:function(s,i,l){var u=qt();if(l!==void 0){var y=l(i);if(cr){ys(!0);try{l(i)}finally{ys(!1)}}}else y=i;return u.memoizedState=u.baseState=y,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:y},u.queue=s,s=s.dispatch=H_.bind(null,Me,s),[u.memoizedState,s]},useRef:function(s){var i=qt();return s={current:s},i.memoizedState=s},useState:function(s){s=ou(s);var i=s.queue,l=sm.bind(null,Me,i);return i.dispatch=l,[s.memoizedState,l]},useDebugValue:uu,useDeferredValue:function(s,i){var l=qt();return du(l,s,i)},useTransition:function(){var s=ou(!1);return s=Wp.bind(null,Me,s.queue,!0,!1),qt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,l){var u=Me,y=qt();if(Ge){if(l===void 0)throw Error(r(407));l=l()}else{if(l=i(),nt===null)throw Error(r(349));(Le&127)!==0||Cp(u,i,l)}y.memoizedState=l;var b={value:l,getSnapshot:i};return y.queue=b,Hp(Ip.bind(null,u,b,s),[s]),u.flags|=2048,Xr(9,{destroy:void 0},Ap.bind(null,u,b,l,i),null),l},useId:function(){var s=qt(),i=nt.identifierPrefix;if(Ge){var l=Bn,u=qn;l=(u&~(1<<32-Wt(u)-1)).toString(32)+l,i="_"+i+"R_"+l,l=Eo++,0<l&&(i+="H"+l.toString(32)),i+="_"}else l=j_++,i="_"+i+"r_"+l.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:hu,useFormState:Lp,useActionState:Lp,useOptimistic:function(s){var i=qt();i.memoizedState=i.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=pu.bind(null,Me,!0,l),l.dispatch=i,[s,i]},useMemoCache:ru,useCacheRefresh:function(){return qt().memoizedState=G_.bind(null,Me)},useEffectEvent:function(s){var i=qt(),l={impl:s};return i.memoizedState=l,function(){if((Ye&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}},mu={readContext:Dt,use:No,useCallback:Kp,useContext:Dt,useEffect:cu,useImperativeHandle:Yp,useInsertionEffect:Fp,useLayoutEffect:$p,useMemo:Qp,useReducer:Co,useRef:Gp,useState:function(){return Co(es)},useDebugValue:uu,useDeferredValue:function(s,i){var l=pt();return Xp(l,We.memoizedState,s,i)},useTransition:function(){var s=Co(es)[0],i=pt().memoizedState;return[typeof s=="boolean"?s:ia(s),i]},useSyncExternalStore:Np,useId:tm,useHostTransitionStatus:hu,useFormState:qp,useActionState:qp,useOptimistic:function(s,i){var l=pt();return Mp(l,We,s,i)},useMemoCache:ru,useCacheRefresh:nm};mu.useEffectEvent=zp;var om={readContext:Dt,use:No,useCallback:Kp,useContext:Dt,useEffect:cu,useImperativeHandle:Yp,useInsertionEffect:Fp,useLayoutEffect:$p,useMemo:Qp,useReducer:au,useRef:Gp,useState:function(){return au(es)},useDebugValue:uu,useDeferredValue:function(s,i){var l=pt();return We===null?du(l,s,i):Xp(l,We.memoizedState,s,i)},useTransition:function(){var s=au(es)[0],i=pt().memoizedState;return[typeof s=="boolean"?s:ia(s),i]},useSyncExternalStore:Np,useId:tm,useHostTransitionStatus:hu,useFormState:Vp,useActionState:Vp,useOptimistic:function(s,i){var l=pt();return We!==null?Mp(l,We,s,i):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:ru,useCacheRefresh:nm};om.useEffectEvent=zp;function gu(s,i,l,u){i=s.memoizedState,l=l(u,i),l=l==null?i:v({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var yu={enqueueSetState:function(s,i,l){s=s._reactInternals;var u=an(),y=Ts(u);y.payload=i,l!=null&&(y.callback=l),i=Ns(s,y,u),i!==null&&(Kt(i,s,u),ta(i,s,u))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var u=an(),y=Ts(u);y.tag=1,y.payload=i,l!=null&&(y.callback=l),i=Ns(s,y,u),i!==null&&(Kt(i,s,u),ta(i,s,u))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=an(),u=Ts(l);u.tag=2,i!=null&&(u.callback=i),i=Ns(s,u,l),i!==null&&(Kt(i,s,l),ta(i,s,l))}};function lm(s,i,l,u,y,b,S){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,b,S):i.prototype&&i.prototype.isPureReactComponent?!Ji(l,u)||!Ji(y,b):!0}function cm(s,i,l,u){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,u),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,u),i.state!==s&&yu.enqueueReplaceState(i,i.state,null)}function ur(s,i){var l=i;if("ref"in i){l={};for(var u in i)u!=="ref"&&(l[u]=i[u])}if(s=s.defaultProps){l===i&&(l=v({},l));for(var y in s)l[y]===void 0&&(l[y]=s[y])}return l}function um(s){oo(s)}function dm(s){console.error(s)}function fm(s){oo(s)}function Do(s,i){try{var l=s.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(u){setTimeout(function(){throw u})}}function hm(s,i,l){try{var u=s.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function xu(s,i,l){return l=Ts(l),l.tag=3,l.payload={element:null},l.callback=function(){Do(s,i)},l}function pm(s){return s=Ts(s),s.tag=3,s}function mm(s,i,l,u){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var b=u.value;s.payload=function(){return y(b)},s.callback=function(){hm(i,l,u)}}var S=l.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(s.callback=function(){hm(i,l,u),typeof y!="function"&&(Ms===null?Ms=new Set([this]):Ms.add(this));var T=u.stack;this.componentDidCatch(u.value,{componentStack:T!==null?T:""})})}function z_(s,i,l,u,y){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(i=l.alternate,i!==null&&Hr(i,l,y,!0),l=tn.current,l!==null){switch(l.tag){case 31:case 13:return vn===null?Ho():l.alternate===null&&ft===0&&(ft=3),l.flags&=-257,l.flags|=65536,l.lanes=y,u===xo?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([u]):i.add(u),Hu(s,u,y)),!1;case 22:return l.flags|=65536,u===xo?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([u]):l.add(u)),Hu(s,u,y)),!1}throw Error(r(435,l.tag))}return Hu(s,u,y),Ho(),!1}if(Ge)return i=tn.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=y,u!==Oc&&(s=Error(r(422),{cause:u}),Qi(mn(s,l)))):(u!==Oc&&(i=Error(r(423),{cause:u}),Qi(mn(i,l))),s=s.current.alternate,s.flags|=65536,y&=-y,s.lanes|=y,u=mn(u,l),y=xu(s.stateNode,u,y),Yc(s,y),ft!==4&&(ft=2)),!1;var b=Error(r(520),{cause:u});if(b=mn(b,l),ma===null?ma=[b]:ma.push(b),ft!==4&&(ft=2),i===null)return!0;u=mn(u,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,s=y&-y,l.lanes|=s,s=xu(l.stateNode,u,s),Yc(l,s),!1;case 1:if(i=l.type,b=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ms===null||!Ms.has(b))))return l.flags|=65536,y&=-y,l.lanes|=y,y=pm(y),mm(y,s,l,u),Yc(l,y),!1}l=l.return}while(l!==null);return!1}var vu=Error(r(461)),yt=!1;function Mt(s,i,l,u){i.child=s===null?vp(i,null,l,u):lr(i,s.child,l,u)}function gm(s,i,l,u,y){l=l.render;var b=i.ref;if("ref"in u){var S={};for(var T in u)T!=="ref"&&(S[T]=u[T])}else S=u;return rr(i),u=eu(s,i,l,S,b,y),T=tu(),s!==null&&!yt?(nu(s,i,y),ts(s,i,y)):(Ge&&T&&Uc(i),i.flags|=1,Mt(s,i,u,y),i.child)}function ym(s,i,l,u,y){if(s===null){var b=l.type;return typeof b=="function"&&!Mc(b)&&b.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=b,xm(s,i,b,u,y)):(s=fo(l.type,null,u,i,i.mode,y),s.ref=i.ref,s.return=i,i.child=s)}if(b=s.child,!Cu(s,y)){var S=b.memoizedProps;if(l=l.compare,l=l!==null?l:Ji,l(S,u)&&s.ref===i.ref)return ts(s,i,y)}return i.flags|=1,s=Kn(b,u),s.ref=i.ref,s.return=i,i.child=s}function xm(s,i,l,u,y){if(s!==null){var b=s.memoizedProps;if(Ji(b,u)&&s.ref===i.ref)if(yt=!1,i.pendingProps=u=b,Cu(s,y))(s.flags&131072)!==0&&(yt=!0);else return i.lanes=s.lanes,ts(s,i,y)}return bu(s,i,l,u,y)}function vm(s,i,l,u){var y=u.children,b=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((i.flags&128)!==0){if(b=b!==null?b.baseLanes|l:l,s!==null){for(u=i.child=s.child,y=0;u!==null;)y=y|u.lanes|u.childLanes,u=u.sibling;u=y&~b}else u=0,i.child=null;return bm(s,i,b,l,u)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&go(i,b!==null?b.cachePool:null),b!==null?_p(i,b):Qc(),Sp(i);else return u=i.lanes=536870912,bm(s,i,b!==null?b.baseLanes|l:l,l,u)}else b!==null?(go(i,b.cachePool),_p(i,b),As(),i.memoizedState=null):(s!==null&&go(i,null),Qc(),As());return Mt(s,i,y,l),i.child}function la(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function bm(s,i,l,u,y){var b=zc();return b=b===null?null:{parent:mt._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},s!==null&&go(i,null),Qc(),Sp(i),s!==null&&Hr(s,i,u,!0),i.childLanes=y,null}function Mo(s,i){return i=ko({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function wm(s,i,l){return lr(i,s.child,null,l),s=Mo(i,i.pendingProps),s.flags|=2,nn(i),i.memoizedState=null,s}function F_(s,i,l){var u=i.pendingProps,y=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(Ge){if(u.mode==="hidden")return s=Mo(i,u),i.lanes=536870912,la(null,s);if(Wc(i),(s=at)?(s=P0(s,xn),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:bs!==null?{id:qn,overflow:Bn}:null,retryLane:536870912,hydrationErrors:null},l=rp(s),l.return=i,i.child=l,Rt=i,at=null)):s=null,s===null)throw _s(i);return i.lanes=536870912,null}return Mo(i,u)}var b=s.memoizedState;if(b!==null){var S=b.dehydrated;if(Wc(i),y)if(i.flags&256)i.flags&=-257,i=wm(s,i,l);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(r(558));else if(yt||Hr(s,i,l,!1),y=(l&s.childLanes)!==0,yt||y){if(u=nt,u!==null&&(S=dh(u,l),S!==0&&S!==b.retryLane))throw b.retryLane=S,er(s,S),Kt(u,s,S),vu;Ho(),i=wm(s,i,l)}else s=b.treeContext,at=bn(S.nextSibling),Rt=i,Ge=!0,ws=null,xn=!1,s!==null&&op(i,s),i=Mo(i,u),i.flags|=4096;return i}return s=Kn(s.child,{mode:u.mode,children:u.children}),s.ref=i.ref,i.child=s,s.return=i,s}function Po(s,i){var l=i.ref;if(l===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(r(284));(s===null||s.ref!==l)&&(i.flags|=4194816)}}function bu(s,i,l,u,y){return rr(i),l=eu(s,i,l,u,void 0,y),u=tu(),s!==null&&!yt?(nu(s,i,y),ts(s,i,y)):(Ge&&u&&Uc(i),i.flags|=1,Mt(s,i,l,y),i.child)}function _m(s,i,l,u,y,b){return rr(i),i.updateQueue=null,l=Tp(i,u,l,y),Ep(s),u=tu(),s!==null&&!yt?(nu(s,i,b),ts(s,i,b)):(Ge&&u&&Uc(i),i.flags|=1,Mt(s,i,l,b),i.child)}function Sm(s,i,l,u,y){if(rr(i),i.stateNode===null){var b=qr,S=l.contextType;typeof S=="object"&&S!==null&&(b=Dt(S)),b=new l(u,b),i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=yu,i.stateNode=b,b._reactInternals=i,b=i.stateNode,b.props=u,b.state=i.memoizedState,b.refs={},$c(i),S=l.contextType,b.context=typeof S=="object"&&S!==null?Dt(S):qr,b.state=i.memoizedState,S=l.getDerivedStateFromProps,typeof S=="function"&&(gu(i,l,S,u),b.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(S=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),S!==b.state&&yu.enqueueReplaceState(b,b.state,null),sa(i,u,b,y),na(),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308),u=!0}else if(s===null){b=i.stateNode;var T=i.memoizedProps,j=ur(l,T);b.props=j;var z=b.context,X=l.contextType;S=qr,typeof X=="object"&&X!==null&&(S=Dt(X));var ne=l.getDerivedStateFromProps;X=typeof ne=="function"||typeof b.getSnapshotBeforeUpdate=="function",T=i.pendingProps!==T,X||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(T||z!==S)&&cm(i,b,u,S),Es=!1;var F=i.memoizedState;b.state=F,sa(i,u,b,y),na(),z=i.memoizedState,T||F!==z||Es?(typeof ne=="function"&&(gu(i,l,ne,u),z=i.memoizedState),(j=Es||lm(i,l,j,u,F,z,S))?(X||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=u,i.memoizedState=z),b.props=u,b.state=z,b.context=S,u=j):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),u=!1)}else{b=i.stateNode,Jc(s,i),S=i.memoizedProps,X=ur(l,S),b.props=X,ne=i.pendingProps,F=b.context,z=l.contextType,j=qr,typeof z=="object"&&z!==null&&(j=Dt(z)),T=l.getDerivedStateFromProps,(z=typeof T=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(S!==ne||F!==j)&&cm(i,b,u,j),Es=!1,F=i.memoizedState,b.state=F,sa(i,u,b,y),na();var Y=i.memoizedState;S!==ne||F!==Y||Es||s!==null&&s.dependencies!==null&&po(s.dependencies)?(typeof T=="function"&&(gu(i,l,T,u),Y=i.memoizedState),(X=Es||lm(i,l,X,u,F,Y,j)||s!==null&&s.dependencies!==null&&po(s.dependencies))?(z||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(u,Y,j),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(u,Y,j)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=1024),i.memoizedProps=u,i.memoizedState=Y),b.props=u,b.state=Y,b.context=j,u=X):(typeof b.componentDidUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=1024),u=!1)}return b=u,Po(s,i),u=(i.flags&128)!==0,b||u?(b=i.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:b.render(),i.flags|=1,s!==null&&u?(i.child=lr(i,s.child,null,y),i.child=lr(i,null,l,y)):Mt(s,i,l,y),i.memoizedState=b.state,s=i.child):s=ts(s,i,y),s}function Em(s,i,l,u){return nr(),i.flags|=256,Mt(s,i,l,u),i.child}var wu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _u(s){return{baseLanes:s,cachePool:hp()}}function Su(s,i,l){return s=s!==null?s.childLanes&~l:0,i&&(s|=rn),s}function Tm(s,i,l){var u=i.pendingProps,y=!1,b=(i.flags&128)!==0,S;if((S=b)||(S=s!==null&&s.memoizedState===null?!1:(ht.current&2)!==0),S&&(y=!0,i.flags&=-129),S=(i.flags&32)!==0,i.flags&=-33,s===null){if(Ge){if(y?Cs(i):As(),(s=at)?(s=P0(s,xn),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:bs!==null?{id:qn,overflow:Bn}:null,retryLane:536870912,hydrationErrors:null},l=rp(s),l.return=i,i.child=l,Rt=i,at=null)):s=null,s===null)throw _s(i);return id(s)?i.lanes=32:i.lanes=536870912,null}var T=u.children;return u=u.fallback,y?(As(),y=i.mode,T=ko({mode:"hidden",children:T},y),u=tr(u,y,l,null),T.return=i,u.return=i,T.sibling=u,i.child=T,u=i.child,u.memoizedState=_u(l),u.childLanes=Su(s,S,l),i.memoizedState=wu,la(null,u)):(Cs(i),Eu(i,T))}var j=s.memoizedState;if(j!==null&&(T=j.dehydrated,T!==null)){if(b)i.flags&256?(Cs(i),i.flags&=-257,i=Tu(s,i,l)):i.memoizedState!==null?(As(),i.child=s.child,i.flags|=128,i=null):(As(),T=u.fallback,y=i.mode,u=ko({mode:"visible",children:u.children},y),T=tr(T,y,l,null),T.flags|=2,u.return=i,T.return=i,u.sibling=T,i.child=u,lr(i,s.child,null,l),u=i.child,u.memoizedState=_u(l),u.childLanes=Su(s,S,l),i.memoizedState=wu,i=la(null,u));else if(Cs(i),id(T)){if(S=T.nextSibling&&T.nextSibling.dataset,S)var z=S.dgst;S=z,u=Error(r(419)),u.stack="",u.digest=S,Qi({value:u,source:null,stack:null}),i=Tu(s,i,l)}else if(yt||Hr(s,i,l,!1),S=(l&s.childLanes)!==0,yt||S){if(S=nt,S!==null&&(u=dh(S,l),u!==0&&u!==j.retryLane))throw j.retryLane=u,er(s,u),Kt(S,s,u),vu;rd(T)||Ho(),i=Tu(s,i,l)}else rd(T)?(i.flags|=192,i.child=s.child,i=null):(s=j.treeContext,at=bn(T.nextSibling),Rt=i,Ge=!0,ws=null,xn=!1,s!==null&&op(i,s),i=Eu(i,u.children),i.flags|=4096);return i}return y?(As(),T=u.fallback,y=i.mode,j=s.child,z=j.sibling,u=Kn(j,{mode:"hidden",children:u.children}),u.subtreeFlags=j.subtreeFlags&65011712,z!==null?T=Kn(z,T):(T=tr(T,y,l,null),T.flags|=2),T.return=i,u.return=i,u.sibling=T,i.child=u,la(null,u),u=i.child,T=s.child.memoizedState,T===null?T=_u(l):(y=T.cachePool,y!==null?(j=mt._currentValue,y=y.parent!==j?{parent:j,pool:j}:y):y=hp(),T={baseLanes:T.baseLanes|l,cachePool:y}),u.memoizedState=T,u.childLanes=Su(s,S,l),i.memoizedState=wu,la(s.child,u)):(Cs(i),l=s.child,s=l.sibling,l=Kn(l,{mode:"visible",children:u.children}),l.return=i,l.sibling=null,s!==null&&(S=i.deletions,S===null?(i.deletions=[s],i.flags|=16):S.push(s)),i.child=l,i.memoizedState=null,l)}function Eu(s,i){return i=ko({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function ko(s,i){return s=en(22,s,null,i),s.lanes=0,s}function Tu(s,i,l){return lr(i,s.child,null,l),s=Eu(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function Nm(s,i,l){s.lanes|=i;var u=s.alternate;u!==null&&(u.lanes|=i),Bc(s.return,i,l)}function Nu(s,i,l,u,y,b){var S=s.memoizedState;S===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:y,treeForkCount:b}:(S.isBackwards=i,S.rendering=null,S.renderingStartTime=0,S.last=u,S.tail=l,S.tailMode=y,S.treeForkCount=b)}function Cm(s,i,l){var u=i.pendingProps,y=u.revealOrder,b=u.tail;u=u.children;var S=ht.current,T=(S&2)!==0;if(T?(S=S&1|2,i.flags|=128):S&=1,Q(ht,S),Mt(s,i,u,l),u=Ge?Ki:0,!T&&s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Nm(s,l,i);else if(s.tag===19)Nm(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(y){case"forwards":for(l=i.child,y=null;l!==null;)s=l.alternate,s!==null&&_o(s)===null&&(y=l),l=l.sibling;l=y,l===null?(y=i.child,i.child=null):(y=l.sibling,l.sibling=null),Nu(i,!1,y,l,b,u);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=i.child,i.child=null;y!==null;){if(s=y.alternate,s!==null&&_o(s)===null){i.child=y;break}s=y.sibling,y.sibling=l,l=y,y=s}Nu(i,!0,l,null,b,u);break;case"together":Nu(i,!1,null,null,void 0,u);break;default:i.memoizedState=null}return i.child}function ts(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),Ds|=i.lanes,(l&i.childLanes)===0)if(s!==null){if(Hr(s,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(r(153));if(i.child!==null){for(s=i.child,l=Kn(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=Kn(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function Cu(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&po(s)))}function $_(s,i,l){switch(i.tag){case 3:K(i,i.stateNode.containerInfo),Ss(i,mt,s.memoizedState.cache),nr();break;case 27:case 5:ke(i);break;case 4:K(i,i.stateNode.containerInfo);break;case 10:Ss(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,Wc(i),null;break;case 13:var u=i.memoizedState;if(u!==null)return u.dehydrated!==null?(Cs(i),i.flags|=128,null):(l&i.child.childLanes)!==0?Tm(s,i,l):(Cs(i),s=ts(s,i,l),s!==null?s.sibling:null);Cs(i);break;case 19:var y=(s.flags&128)!==0;if(u=(l&i.childLanes)!==0,u||(Hr(s,i,l,!1),u=(l&i.childLanes)!==0),y){if(u)return Cm(s,i,l);i.flags|=128}if(y=i.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),Q(ht,ht.current),u)break;return null;case 22:return i.lanes=0,vm(s,i,l,i.pendingProps);case 24:Ss(i,mt,s.memoizedState.cache)}return ts(s,i,l)}function Am(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps)yt=!0;else{if(!Cu(s,l)&&(i.flags&128)===0)return yt=!1,$_(s,i,l);yt=(s.flags&131072)!==0}else yt=!1,Ge&&(i.flags&1048576)!==0&&ap(i,Ki,i.index);switch(i.lanes=0,i.tag){case 16:e:{var u=i.pendingProps;if(s=ar(i.elementType),i.type=s,typeof s=="function")Mc(s)?(u=ur(s,u),i.tag=1,i=Sm(null,i,s,u,l)):(i.tag=0,i=bu(null,i,s,u,l));else{if(s!=null){var y=s.$$typeof;if(y===A){i.tag=11,i=gm(null,i,s,u,l);break e}else if(y===V){i.tag=14,i=ym(null,i,s,u,l);break e}}throw i=_e(s)||s,Error(r(306,i,""))}}return i;case 0:return bu(s,i,i.type,i.pendingProps,l);case 1:return u=i.type,y=ur(u,i.pendingProps),Sm(s,i,u,y,l);case 3:e:{if(K(i,i.stateNode.containerInfo),s===null)throw Error(r(387));u=i.pendingProps;var b=i.memoizedState;y=b.element,Jc(s,i),sa(i,u,null,l);var S=i.memoizedState;if(u=S.cache,Ss(i,mt,u),u!==b.cache&&Vc(i,[mt],l,!0),na(),u=S.element,b.isDehydrated)if(b={element:u,isDehydrated:!1,cache:S.cache},i.updateQueue.baseState=b,i.memoizedState=b,i.flags&256){i=Em(s,i,u,l);break e}else if(u!==y){y=mn(Error(r(424)),i),Qi(y),i=Em(s,i,u,l);break e}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(at=bn(s.firstChild),Rt=i,Ge=!0,ws=null,xn=!0,l=vp(i,null,u,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(nr(),u===y){i=ts(s,i,l);break e}Mt(s,i,u,l)}i=i.child}return i;case 26:return Po(s,i),s===null?(l=q0(i.type,null,i.pendingProps,null))?i.memoizedState=l:Ge||(l=i.type,s=i.pendingProps,u=Qo(ge.current).createElement(l),u[It]=i,u[Ht]=s,Pt(u,l,s),Tt(u),i.stateNode=u):i.memoizedState=q0(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return ke(i),s===null&&Ge&&(u=i.stateNode=j0(i.type,i.pendingProps,ge.current),Rt=i,xn=!0,y=at,js(i.type)?(ad=y,at=bn(u.firstChild)):at=y),Mt(s,i,i.pendingProps.children,l),Po(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&Ge&&((y=u=at)&&(u=_S(u,i.type,i.pendingProps,xn),u!==null?(i.stateNode=u,Rt=i,at=bn(u.firstChild),xn=!1,y=!0):y=!1),y||_s(i)),ke(i),y=i.type,b=i.pendingProps,S=s!==null?s.memoizedProps:null,u=b.children,td(y,b)?u=null:S!==null&&td(y,S)&&(i.flags|=32),i.memoizedState!==null&&(y=eu(s,i,O_,null,null,l),Sa._currentValue=y),Po(s,i),Mt(s,i,u,l),i.child;case 6:return s===null&&Ge&&((s=l=at)&&(l=SS(l,i.pendingProps,xn),l!==null?(i.stateNode=l,Rt=i,at=null,s=!0):s=!1),s||_s(i)),null;case 13:return Tm(s,i,l);case 4:return K(i,i.stateNode.containerInfo),u=i.pendingProps,s===null?i.child=lr(i,null,u,l):Mt(s,i,u,l),i.child;case 11:return gm(s,i,i.type,i.pendingProps,l);case 7:return Mt(s,i,i.pendingProps,l),i.child;case 8:return Mt(s,i,i.pendingProps.children,l),i.child;case 12:return Mt(s,i,i.pendingProps.children,l),i.child;case 10:return u=i.pendingProps,Ss(i,i.type,u.value),Mt(s,i,u.children,l),i.child;case 9:return y=i.type._context,u=i.pendingProps.children,rr(i),y=Dt(y),u=u(y),i.flags|=1,Mt(s,i,u,l),i.child;case 14:return ym(s,i,i.type,i.pendingProps,l);case 15:return xm(s,i,i.type,i.pendingProps,l);case 19:return Cm(s,i,l);case 31:return F_(s,i,l);case 22:return vm(s,i,l,i.pendingProps);case 24:return rr(i),u=Dt(mt),s===null?(y=zc(),y===null&&(y=nt,b=Gc(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=l),y=b),i.memoizedState={parent:u,cache:y},$c(i),Ss(i,mt,y)):((s.lanes&l)!==0&&(Jc(s,i),sa(i,null,null,l),na()),y=s.memoizedState,b=i.memoizedState,y.parent!==u?(y={parent:u,cache:u},i.memoizedState=y,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=y),Ss(i,mt,u)):(u=b.cache,Ss(i,mt,u),u!==y.cache&&Vc(i,[mt],l,!0))),Mt(s,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(r(156,i.tag))}function ns(s){s.flags|=4}function Au(s,i,l,u,y){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(y&335544128)===y)if(s.stateNode.complete)s.flags|=8192;else if(t0())s.flags|=8192;else throw or=xo,Fc}else s.flags&=-16777217}function Im(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!z0(i))if(t0())s.flags|=8192;else throw or=xo,Fc}function Uo(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?lh():536870912,s.lanes|=i,ti|=i)}function ca(s,i){if(!Ge)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function ot(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,u=0;if(i)for(var y=s.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags&65011712,u|=y.flags&65011712,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags,u|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=u,s.childLanes=l,i}function J_(s,i,l){var u=i.pendingProps;switch(jc(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ot(i),null;case 1:return ot(i),null;case 3:return l=i.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),i.memoizedState.cache!==u&&(i.flags|=2048),Wn(mt),he(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(Gr(i)?ns(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Lc())),ot(i),null;case 26:var y=i.type,b=i.memoizedState;return s===null?(ns(i),b!==null?(ot(i),Im(i,b)):(ot(i),Au(i,y,null,u,l))):b?b!==s.memoizedState?(ns(i),ot(i),Im(i,b)):(ot(i),i.flags&=-16777217):(s=s.memoizedProps,s!==u&&ns(i),ot(i),Au(i,y,s,u,l)),null;case 27:if(ye(i),l=ge.current,y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&ns(i);else{if(!u){if(i.stateNode===null)throw Error(r(166));return ot(i),null}s=re.current,Gr(i)?lp(i):(s=j0(y,u,l),i.stateNode=s,ns(i))}return ot(i),null;case 5:if(ye(i),y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&ns(i);else{if(!u){if(i.stateNode===null)throw Error(r(166));return ot(i),null}if(b=re.current,Gr(i))lp(i);else{var S=Qo(ge.current);switch(b){case 1:b=S.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=S.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=S.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=S.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=S.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof u.is=="string"?S.createElement("select",{is:u.is}):S.createElement("select"),u.multiple?b.multiple=!0:u.size&&(b.size=u.size);break;default:b=typeof u.is=="string"?S.createElement(y,{is:u.is}):S.createElement(y)}}b[It]=i,b[Ht]=u;e:for(S=i.child;S!==null;){if(S.tag===5||S.tag===6)b.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===i)break e;for(;S.sibling===null;){if(S.return===null||S.return===i)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}i.stateNode=b;e:switch(Pt(b,y,u),y){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&ns(i)}}return ot(i),Au(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,l),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==u&&ns(i);else{if(typeof u!="string"&&i.stateNode===null)throw Error(r(166));if(s=ge.current,Gr(i)){if(s=i.stateNode,l=i.memoizedProps,u=null,y=Rt,y!==null)switch(y.tag){case 27:case 5:u=y.memoizedProps}s[It]=i,s=!!(s.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||T0(s.nodeValue,l)),s||_s(i,!0)}else s=Qo(s).createTextNode(u),s[It]=i,i.stateNode=s}return ot(i),null;case 31:if(l=i.memoizedState,s===null||s.memoizedState!==null){if(u=Gr(i),l!==null){if(s===null){if(!u)throw Error(r(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[It]=i}else nr(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ot(i),s=!1}else l=Lc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=l),s=!0;if(!s)return i.flags&256?(nn(i),i):(nn(i),null);if((i.flags&128)!==0)throw Error(r(558))}return ot(i),null;case 13:if(u=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(y=Gr(i),u!==null&&u.dehydrated!==null){if(s===null){if(!y)throw Error(r(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[It]=i}else nr(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ot(i),y=!1}else y=Lc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),y=!0;if(!y)return i.flags&256?(nn(i),i):(nn(i),null)}return nn(i),(i.flags&128)!==0?(i.lanes=l,i):(l=u!==null,s=s!==null&&s.memoizedState!==null,l&&(u=i.child,y=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(y=u.alternate.memoizedState.cachePool.pool),b=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(b=u.memoizedState.cachePool.pool),b!==y&&(u.flags|=2048)),l!==s&&l&&(i.child.flags|=8192),Uo(i,i.updateQueue),ot(i),null);case 4:return he(),s===null&&Qu(i.stateNode.containerInfo),ot(i),null;case 10:return Wn(i.type),ot(i),null;case 19:if(L(ht),u=i.memoizedState,u===null)return ot(i),null;if(y=(i.flags&128)!==0,b=u.rendering,b===null)if(y)ca(u,!1);else{if(ft!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(b=_o(s),b!==null){for(i.flags|=128,ca(u,!1),s=b.updateQueue,i.updateQueue=s,Uo(i,s),i.subtreeFlags=0,s=l,l=i.child;l!==null;)sp(l,s),l=l.sibling;return Q(ht,ht.current&1|2),Ge&&Qn(i,u.treeForkCount),i.child}s=s.sibling}u.tail!==null&&ie()>Bo&&(i.flags|=128,y=!0,ca(u,!1),i.lanes=4194304)}else{if(!y)if(s=_o(b),s!==null){if(i.flags|=128,y=!0,s=s.updateQueue,i.updateQueue=s,Uo(i,s),ca(u,!0),u.tail===null&&u.tailMode==="hidden"&&!b.alternate&&!Ge)return ot(i),null}else 2*ie()-u.renderingStartTime>Bo&&l!==536870912&&(i.flags|=128,y=!0,ca(u,!1),i.lanes=4194304);u.isBackwards?(b.sibling=i.child,i.child=b):(s=u.last,s!==null?s.sibling=b:i.child=b,u.last=b)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=ie(),s.sibling=null,l=ht.current,Q(ht,y?l&1|2:l&1),Ge&&Qn(i,u.treeForkCount),s):(ot(i),null);case 22:case 23:return nn(i),Xc(),u=i.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(i.flags|=8192):u&&(i.flags|=8192),u?(l&536870912)!==0&&(i.flags&128)===0&&(ot(i),i.subtreeFlags&6&&(i.flags|=8192)):ot(i),l=i.updateQueue,l!==null&&Uo(i,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),u=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),u!==l&&(i.flags|=2048),s!==null&&L(ir),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Wn(mt),ot(i),null;case 25:return null;case 30:return null}throw Error(r(156,i.tag))}function Y_(s,i){switch(jc(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Wn(mt),he(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return ye(i),null;case 31:if(i.memoizedState!==null){if(nn(i),i.alternate===null)throw Error(r(340));nr()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(nn(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(r(340));nr()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return L(ht),null;case 4:return he(),null;case 10:return Wn(i.type),null;case 22:case 23:return nn(i),Xc(),s!==null&&L(ir),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Wn(mt),null;case 25:return null;default:return null}}function Rm(s,i){switch(jc(i),i.tag){case 3:Wn(mt),he();break;case 26:case 27:case 5:ye(i);break;case 4:he();break;case 31:i.memoizedState!==null&&nn(i);break;case 13:nn(i);break;case 19:L(ht);break;case 10:Wn(i.type);break;case 22:case 23:nn(i),Xc(),s!==null&&L(ir);break;case 24:Wn(mt)}}function ua(s,i){try{var l=i.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var y=u.next;l=y;do{if((l.tag&s)===s){u=void 0;var b=l.create,S=l.inst;u=b(),S.destroy=u}l=l.next}while(l!==y)}}catch(T){Xe(i,i.return,T)}}function Is(s,i,l){try{var u=i.updateQueue,y=u!==null?u.lastEffect:null;if(y!==null){var b=y.next;u=b;do{if((u.tag&s)===s){var S=u.inst,T=S.destroy;if(T!==void 0){S.destroy=void 0,y=i;var j=l,z=T;try{z()}catch(X){Xe(y,j,X)}}}u=u.next}while(u!==b)}}catch(X){Xe(i,i.return,X)}}function Dm(s){var i=s.updateQueue;if(i!==null){var l=s.stateNode;try{wp(i,l)}catch(u){Xe(s,s.return,u)}}}function Mm(s,i,l){l.props=ur(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(u){Xe(s,i,u)}}function da(s,i){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var u=s.stateNode;break;case 30:u=s.stateNode;break;default:u=s.stateNode}typeof l=="function"?s.refCleanup=l(u):l.current=u}}catch(y){Xe(s,i,y)}}function Vn(s,i){var l=s.ref,u=s.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(y){Xe(s,i,y)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){Xe(s,i,y)}else l.current=null}function Pm(s){var i=s.type,l=s.memoizedProps,u=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(y){Xe(s,s.return,y)}}function Iu(s,i,l){try{var u=s.stateNode;gS(u,s.type,l,i),u[Ht]=i}catch(y){Xe(s,s.return,y)}}function km(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&js(s.type)||s.tag===4}function Ru(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||km(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&js(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Du(s,i,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(s),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=Jn));else if(u!==4&&(u===27&&js(s.type)&&(l=s.stateNode,i=null),s=s.child,s!==null))for(Du(s,i,l),s=s.sibling;s!==null;)Du(s,i,l),s=s.sibling}function jo(s,i,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(u!==4&&(u===27&&js(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(jo(s,i,l),s=s.sibling;s!==null;)jo(s,i,l),s=s.sibling}function Um(s){var i=s.stateNode,l=s.memoizedProps;try{for(var u=s.type,y=i.attributes;y.length;)i.removeAttributeNode(y[0]);Pt(i,u,l),i[It]=s,i[Ht]=l}catch(b){Xe(s,s.return,b)}}var ss=!1,xt=!1,Mu=!1,jm=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function K_(s,i){if(s=s.containerInfo,Zu=sl,s=Yh(s),Tc(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var y=u.anchorOffset,b=u.focusNode;u=u.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break e}var S=0,T=-1,j=-1,z=0,X=0,ne=s,F=null;t:for(;;){for(var Y;ne!==l||y!==0&&ne.nodeType!==3||(T=S+y),ne!==b||u!==0&&ne.nodeType!==3||(j=S+u),ne.nodeType===3&&(S+=ne.nodeValue.length),(Y=ne.firstChild)!==null;)F=ne,ne=Y;for(;;){if(ne===s)break t;if(F===l&&++z===y&&(T=S),F===b&&++X===u&&(j=S),(Y=ne.nextSibling)!==null)break;ne=F,F=ne.parentNode}ne=Y}l=T===-1||j===-1?null:{start:T,end:j}}else l=null}l=l||{start:0,end:0}}else l=null;for(ed={focusedElem:s,selectionRange:l},sl=!1,Nt=i;Nt!==null;)if(i=Nt,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,Nt=s;else for(;Nt!==null;){switch(i=Nt,b=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(l=0;l<s.length;l++)y=s[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&b!==null){s=void 0,l=i,y=b.memoizedProps,b=b.memoizedState,u=l.stateNode;try{var me=ur(l.type,y);s=u.getSnapshotBeforeUpdate(me,b),u.__reactInternalSnapshotBeforeUpdate=s}catch(Te){Xe(l,l.return,Te)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,l=s.nodeType,l===9)sd(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":sd(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=i.sibling,s!==null){s.return=i.return,Nt=s;break}Nt=i.return}}function Om(s,i,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:is(s,l),u&4&&ua(5,l);break;case 1:if(is(s,l),u&4)if(s=l.stateNode,i===null)try{s.componentDidMount()}catch(S){Xe(l,l.return,S)}else{var y=ur(l.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(y,i,s.__reactInternalSnapshotBeforeUpdate)}catch(S){Xe(l,l.return,S)}}u&64&&Dm(l),u&512&&da(l,l.return);break;case 3:if(is(s,l),u&64&&(s=l.updateQueue,s!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{wp(s,i)}catch(S){Xe(l,l.return,S)}}break;case 27:i===null&&u&4&&Um(l);case 26:case 5:is(s,l),i===null&&u&4&&Pm(l),u&512&&da(l,l.return);break;case 12:is(s,l);break;case 31:is(s,l),u&4&&Bm(s,l);break;case 13:is(s,l),u&4&&Vm(s,l),u&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=rS.bind(null,l),ES(s,l))));break;case 22:if(u=l.memoizedState!==null||ss,!u){i=i!==null&&i.memoizedState!==null||xt,y=ss;var b=xt;ss=u,(xt=i)&&!b?as(s,l,(l.subtreeFlags&8772)!==0):is(s,l),ss=y,xt=b}break;case 30:break;default:is(s,l)}}function Lm(s){var i=s.alternate;i!==null&&(s.alternate=null,Lm(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&lc(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var ct=null,Ft=!1;function rs(s,i,l){for(l=l.child;l!==null;)qm(s,i,l),l=l.sibling}function qm(s,i,l){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(Ui,l)}catch{}switch(l.tag){case 26:xt||Vn(l,i),rs(s,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:xt||Vn(l,i);var u=ct,y=Ft;js(l.type)&&(ct=l.stateNode,Ft=!1),rs(s,i,l),ba(l.stateNode),ct=u,Ft=y;break;case 5:xt||Vn(l,i);case 6:if(u=ct,y=Ft,ct=null,rs(s,i,l),ct=u,Ft=y,ct!==null)if(Ft)try{(ct.nodeType===9?ct.body:ct.nodeName==="HTML"?ct.ownerDocument.body:ct).removeChild(l.stateNode)}catch(b){Xe(l,i,b)}else try{ct.removeChild(l.stateNode)}catch(b){Xe(l,i,b)}break;case 18:ct!==null&&(Ft?(s=ct,D0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),ci(s)):D0(ct,l.stateNode));break;case 4:u=ct,y=Ft,ct=l.stateNode.containerInfo,Ft=!0,rs(s,i,l),ct=u,Ft=y;break;case 0:case 11:case 14:case 15:Is(2,l,i),xt||Is(4,l,i),rs(s,i,l);break;case 1:xt||(Vn(l,i),u=l.stateNode,typeof u.componentWillUnmount=="function"&&Mm(l,i,u)),rs(s,i,l);break;case 21:rs(s,i,l);break;case 22:xt=(u=xt)||l.memoizedState!==null,rs(s,i,l),xt=u;break;default:rs(s,i,l)}}function Bm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{ci(s)}catch(l){Xe(i,i.return,l)}}}function Vm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{ci(s)}catch(l){Xe(i,i.return,l)}}function Q_(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new jm),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new jm),i;default:throw Error(r(435,s.tag))}}function Oo(s,i){var l=Q_(s);i.forEach(function(u){if(!l.has(u)){l.add(u);var y=iS.bind(null,s,u);u.then(y,y)}})}function $t(s,i){var l=i.deletions;if(l!==null)for(var u=0;u<l.length;u++){var y=l[u],b=s,S=i,T=S;e:for(;T!==null;){switch(T.tag){case 27:if(js(T.type)){ct=T.stateNode,Ft=!1;break e}break;case 5:ct=T.stateNode,Ft=!1;break e;case 3:case 4:ct=T.stateNode.containerInfo,Ft=!0;break e}T=T.return}if(ct===null)throw Error(r(160));qm(b,S,y),ct=null,Ft=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)Gm(i,s),i=i.sibling}var Nn=null;function Gm(s,i){var l=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:$t(i,s),Jt(s),u&4&&(Is(3,s,s.return),ua(3,s),Is(5,s,s.return));break;case 1:$t(i,s),Jt(s),u&512&&(xt||l===null||Vn(l,l.return)),u&64&&ss&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var y=Nn;if($t(i,s),Jt(s),u&512&&(xt||l===null||Vn(l,l.return)),u&4){var b=l!==null?l.memoizedState:null;if(u=s.memoizedState,l===null)if(u===null)if(s.stateNode===null){e:{u=s.type,l=s.memoizedProps,y=y.ownerDocument||y;t:switch(u){case"title":b=y.getElementsByTagName("title")[0],(!b||b[Li]||b[It]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(u),y.head.insertBefore(b,y.querySelector("head > title"))),Pt(b,u,l),b[It]=s,Tt(b),u=b;break e;case"link":var S=G0("link","href",y).get(u+(l.href||""));if(S){for(var T=0;T<S.length;T++)if(b=S[T],b.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&b.getAttribute("rel")===(l.rel==null?null:l.rel)&&b.getAttribute("title")===(l.title==null?null:l.title)&&b.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){S.splice(T,1);break t}}b=y.createElement(u),Pt(b,u,l),y.head.appendChild(b);break;case"meta":if(S=G0("meta","content",y).get(u+(l.content||""))){for(T=0;T<S.length;T++)if(b=S[T],b.getAttribute("content")===(l.content==null?null:""+l.content)&&b.getAttribute("name")===(l.name==null?null:l.name)&&b.getAttribute("property")===(l.property==null?null:l.property)&&b.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&b.getAttribute("charset")===(l.charSet==null?null:l.charSet)){S.splice(T,1);break t}}b=y.createElement(u),Pt(b,u,l),y.head.appendChild(b);break;default:throw Error(r(468,u))}b[It]=s,Tt(b),u=b}s.stateNode=u}else H0(y,s.type,s.stateNode);else s.stateNode=V0(y,u,s.memoizedProps);else b!==u?(b===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):b.count--,u===null?H0(y,s.type,s.stateNode):V0(y,u,s.memoizedProps)):u===null&&s.stateNode!==null&&Iu(s,s.memoizedProps,l.memoizedProps)}break;case 27:$t(i,s),Jt(s),u&512&&(xt||l===null||Vn(l,l.return)),l!==null&&u&4&&Iu(s,s.memoizedProps,l.memoizedProps);break;case 5:if($t(i,s),Jt(s),u&512&&(xt||l===null||Vn(l,l.return)),s.flags&32){y=s.stateNode;try{Mr(y,"")}catch(me){Xe(s,s.return,me)}}u&4&&s.stateNode!=null&&(y=s.memoizedProps,Iu(s,y,l!==null?l.memoizedProps:y)),u&1024&&(Mu=!0);break;case 6:if($t(i,s),Jt(s),u&4){if(s.stateNode===null)throw Error(r(162));u=s.memoizedProps,l=s.stateNode;try{l.nodeValue=u}catch(me){Xe(s,s.return,me)}}break;case 3:if(Zo=null,y=Nn,Nn=Xo(i.containerInfo),$t(i,s),Nn=y,Jt(s),u&4&&l!==null&&l.memoizedState.isDehydrated)try{ci(i.containerInfo)}catch(me){Xe(s,s.return,me)}Mu&&(Mu=!1,Hm(s));break;case 4:u=Nn,Nn=Xo(s.stateNode.containerInfo),$t(i,s),Jt(s),Nn=u;break;case 12:$t(i,s),Jt(s);break;case 31:$t(i,s),Jt(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Oo(s,u)));break;case 13:$t(i,s),Jt(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(qo=ie()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Oo(s,u)));break;case 22:y=s.memoizedState!==null;var j=l!==null&&l.memoizedState!==null,z=ss,X=xt;if(ss=z||y,xt=X||j,$t(i,s),xt=X,ss=z,Jt(s),u&8192)e:for(i=s.stateNode,i._visibility=y?i._visibility&-2:i._visibility|1,y&&(l===null||j||ss||xt||dr(s)),l=null,i=s;;){if(i.tag===5||i.tag===26){if(l===null){j=l=i;try{if(b=j.stateNode,y)S=b.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{T=j.stateNode;var ne=j.memoizedProps.style,F=ne!=null&&ne.hasOwnProperty("display")?ne.display:null;T.style.display=F==null||typeof F=="boolean"?"":(""+F).trim()}}catch(me){Xe(j,j.return,me)}}}else if(i.tag===6){if(l===null){j=i;try{j.stateNode.nodeValue=y?"":j.memoizedProps}catch(me){Xe(j,j.return,me)}}}else if(i.tag===18){if(l===null){j=i;try{var Y=j.stateNode;y?M0(Y,!0):M0(j.stateNode,!1)}catch(me){Xe(j,j.return,me)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}u&4&&(u=s.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,Oo(s,l))));break;case 19:$t(i,s),Jt(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Oo(s,u)));break;case 30:break;case 21:break;default:$t(i,s),Jt(s)}}function Jt(s){var i=s.flags;if(i&2){try{for(var l,u=s.return;u!==null;){if(km(u)){l=u;break}u=u.return}if(l==null)throw Error(r(160));switch(l.tag){case 27:var y=l.stateNode,b=Ru(s);jo(s,b,y);break;case 5:var S=l.stateNode;l.flags&32&&(Mr(S,""),l.flags&=-33);var T=Ru(s);jo(s,T,S);break;case 3:case 4:var j=l.stateNode.containerInfo,z=Ru(s);Du(s,z,j);break;default:throw Error(r(161))}}catch(X){Xe(s,s.return,X)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Hm(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Hm(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function is(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Om(s,i.alternate,i),i=i.sibling}function dr(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:Is(4,i,i.return),dr(i);break;case 1:Vn(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&Mm(i,i.return,l),dr(i);break;case 27:ba(i.stateNode);case 26:case 5:Vn(i,i.return),dr(i);break;case 22:i.memoizedState===null&&dr(i);break;case 30:dr(i);break;default:dr(i)}s=s.sibling}}function as(s,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var u=i.alternate,y=s,b=i,S=b.flags;switch(b.tag){case 0:case 11:case 15:as(y,b,l),ua(4,b);break;case 1:if(as(y,b,l),u=b,y=u.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(z){Xe(u,u.return,z)}if(u=b,y=u.updateQueue,y!==null){var T=u.stateNode;try{var j=y.shared.hiddenCallbacks;if(j!==null)for(y.shared.hiddenCallbacks=null,y=0;y<j.length;y++)bp(j[y],T)}catch(z){Xe(u,u.return,z)}}l&&S&64&&Dm(b),da(b,b.return);break;case 27:Um(b);case 26:case 5:as(y,b,l),l&&u===null&&S&4&&Pm(b),da(b,b.return);break;case 12:as(y,b,l);break;case 31:as(y,b,l),l&&S&4&&Bm(y,b);break;case 13:as(y,b,l),l&&S&4&&Vm(y,b);break;case 22:b.memoizedState===null&&as(y,b,l),da(b,b.return);break;case 30:break;default:as(y,b,l)}i=i.sibling}}function Pu(s,i){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&Xi(l))}function ku(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Xi(s))}function Cn(s,i,l,u){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)zm(s,i,l,u),i=i.sibling}function zm(s,i,l,u){var y=i.flags;switch(i.tag){case 0:case 11:case 15:Cn(s,i,l,u),y&2048&&ua(9,i);break;case 1:Cn(s,i,l,u);break;case 3:Cn(s,i,l,u),y&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Xi(s)));break;case 12:if(y&2048){Cn(s,i,l,u),s=i.stateNode;try{var b=i.memoizedProps,S=b.id,T=b.onPostCommit;typeof T=="function"&&T(S,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(j){Xe(i,i.return,j)}}else Cn(s,i,l,u);break;case 31:Cn(s,i,l,u);break;case 13:Cn(s,i,l,u);break;case 23:break;case 22:b=i.stateNode,S=i.alternate,i.memoizedState!==null?b._visibility&2?Cn(s,i,l,u):fa(s,i):b._visibility&2?Cn(s,i,l,u):(b._visibility|=2,Wr(s,i,l,u,(i.subtreeFlags&10256)!==0||!1)),y&2048&&Pu(S,i);break;case 24:Cn(s,i,l,u),y&2048&&ku(i.alternate,i);break;default:Cn(s,i,l,u)}}function Wr(s,i,l,u,y){for(y=y&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var b=s,S=i,T=l,j=u,z=S.flags;switch(S.tag){case 0:case 11:case 15:Wr(b,S,T,j,y),ua(8,S);break;case 23:break;case 22:var X=S.stateNode;S.memoizedState!==null?X._visibility&2?Wr(b,S,T,j,y):fa(b,S):(X._visibility|=2,Wr(b,S,T,j,y)),y&&z&2048&&Pu(S.alternate,S);break;case 24:Wr(b,S,T,j,y),y&&z&2048&&ku(S.alternate,S);break;default:Wr(b,S,T,j,y)}i=i.sibling}}function fa(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=s,u=i,y=u.flags;switch(u.tag){case 22:fa(l,u),y&2048&&Pu(u.alternate,u);break;case 24:fa(l,u),y&2048&&ku(u.alternate,u);break;default:fa(l,u)}i=i.sibling}}var ha=8192;function Zr(s,i,l){if(s.subtreeFlags&ha)for(s=s.child;s!==null;)Fm(s,i,l),s=s.sibling}function Fm(s,i,l){switch(s.tag){case 26:Zr(s,i,l),s.flags&ha&&s.memoizedState!==null&&jS(l,Nn,s.memoizedState,s.memoizedProps);break;case 5:Zr(s,i,l);break;case 3:case 4:var u=Nn;Nn=Xo(s.stateNode.containerInfo),Zr(s,i,l),Nn=u;break;case 22:s.memoizedState===null&&(u=s.alternate,u!==null&&u.memoizedState!==null?(u=ha,ha=16777216,Zr(s,i,l),ha=u):Zr(s,i,l));break;default:Zr(s,i,l)}}function $m(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function pa(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var u=i[l];Nt=u,Ym(u,s)}$m(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Jm(s),s=s.sibling}function Jm(s){switch(s.tag){case 0:case 11:case 15:pa(s),s.flags&2048&&Is(9,s,s.return);break;case 3:pa(s);break;case 12:pa(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,Lo(s)):pa(s);break;default:pa(s)}}function Lo(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var u=i[l];Nt=u,Ym(u,s)}$m(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:Is(8,i,i.return),Lo(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,Lo(i));break;default:Lo(i)}s=s.sibling}}function Ym(s,i){for(;Nt!==null;){var l=Nt;switch(l.tag){case 0:case 11:case 15:Is(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Xi(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,Nt=u;else e:for(l=s;Nt!==null;){u=Nt;var y=u.sibling,b=u.return;if(Lm(u),u===l){Nt=null;break e}if(y!==null){y.return=b,Nt=y;break e}Nt=b}}}var X_={getCacheForType:function(s){var i=Dt(mt),l=i.data.get(s);return l===void 0&&(l=s(),i.data.set(s,l)),l},cacheSignal:function(){return Dt(mt).controller.signal}},W_=typeof WeakMap=="function"?WeakMap:Map,Ye=0,nt=null,je=null,Le=0,Qe=0,sn=null,Rs=!1,ei=!1,Uu=!1,os=0,ft=0,Ds=0,fr=0,ju=0,rn=0,ti=0,ma=null,Yt=null,Ou=!1,qo=0,Km=0,Bo=1/0,Vo=null,Ms=null,_t=0,Ps=null,ni=null,ls=0,Lu=0,qu=null,Qm=null,ga=0,Bu=null;function an(){return(Ye&2)!==0&&Le!==0?Le&-Le:M.T!==null?$u():fh()}function Xm(){if(rn===0)if((Le&536870912)===0||Ge){var s=Ya;Ya<<=1,(Ya&3932160)===0&&(Ya=262144),rn=s}else rn=536870912;return s=tn.current,s!==null&&(s.flags|=32),rn}function Kt(s,i,l){(s===nt&&(Qe===2||Qe===9)||s.cancelPendingCommit!==null)&&(si(s,0),ks(s,Le,rn,!1)),Oi(s,l),((Ye&2)===0||s!==nt)&&(s===nt&&((Ye&2)===0&&(fr|=l),ft===4&&ks(s,Le,rn,!1)),Gn(s))}function Wm(s,i,l){if((Ye&6)!==0)throw Error(r(327));var u=!l&&(i&127)===0&&(i&s.expiredLanes)===0||ji(s,i),y=u?tS(s,i):Gu(s,i,!0),b=u;do{if(y===0){ei&&!u&&ks(s,i,0,!1);break}else{if(l=s.current.alternate,b&&!Z_(l)){y=Gu(s,i,!1),b=!1;continue}if(y===2){if(b=i,s.errorRecoveryDisabledLanes&b)var S=0;else S=s.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){i=S;e:{var T=s;y=ma;var j=T.current.memoizedState.isDehydrated;if(j&&(si(T,S).flags|=256),S=Gu(T,S,!1),S!==2){if(Uu&&!j){T.errorRecoveryDisabledLanes|=b,fr|=b,y=4;break e}b=Yt,Yt=y,b!==null&&(Yt===null?Yt=b:Yt.push.apply(Yt,b))}y=S}if(b=!1,y!==2)continue}}if(y===1){si(s,0),ks(s,i,0,!0);break}e:{switch(u=s,b=y,b){case 0:case 1:throw Error(r(345));case 4:if((i&4194048)!==i)break;case 6:ks(u,i,rn,!Rs);break e;case 2:Yt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((i&62914560)===i&&(y=qo+300-ie(),10<y)){if(ks(u,i,rn,!Rs),Qa(u,0,!0)!==0)break e;ls=i,u.timeoutHandle=I0(Zm.bind(null,u,l,Yt,Vo,Ou,i,rn,fr,ti,Rs,b,"Throttled",-0,0),y);break e}Zm(u,l,Yt,Vo,Ou,i,rn,fr,ti,Rs,b,null,-0,0)}}break}while(!0);Gn(s)}function Zm(s,i,l,u,y,b,S,T,j,z,X,ne,F,Y){if(s.timeoutHandle=-1,ne=i.subtreeFlags,ne&8192||(ne&16785408)===16785408){ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Jn},Fm(i,b,ne);var me=(b&62914560)===b?qo-ie():(b&4194048)===b?Km-ie():0;if(me=OS(ne,me),me!==null){ls=b,s.cancelPendingCommit=me(o0.bind(null,s,i,b,l,u,y,S,T,j,X,ne,null,F,Y)),ks(s,b,S,!z);return}}o0(s,i,b,l,u,y,S,T,j)}function Z_(s){for(var i=s;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var y=l[u],b=y.getSnapshot;y=y.value;try{if(!Zt(b(),y))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ks(s,i,l,u){i&=~ju,i&=~fr,s.suspendedLanes|=i,s.pingedLanes&=~i,u&&(s.warmLanes|=i),u=s.expirationTimes;for(var y=i;0<y;){var b=31-Wt(y),S=1<<b;u[b]=-1,y&=~S}l!==0&&ch(s,l,i)}function Go(){return(Ye&6)===0?(ya(0),!1):!0}function Vu(){if(je!==null){if(Qe===0)var s=je.return;else s=je,Xn=sr=null,su(s),Jr=null,Zi=0,s=je;for(;s!==null;)Rm(s.alternate,s),s=s.return;je=null}}function si(s,i){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,vS(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),ls=0,Vu(),nt=s,je=l=Kn(s.current,null),Le=i,Qe=0,sn=null,Rs=!1,ei=ji(s,i),Uu=!1,ti=rn=ju=fr=Ds=ft=0,Yt=ma=null,Ou=!1,(i&8)!==0&&(i|=i&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=i;0<u;){var y=31-Wt(u),b=1<<y;i|=s[y],u&=~b}return os=i,lo(),l}function e0(s,i){Me=null,M.H=oa,i===$r||i===yo?(i=gp(),Qe=3):i===Fc?(i=gp(),Qe=4):Qe=i===vu?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,sn=i,je===null&&(ft=1,Do(s,mn(i,s.current)))}function t0(){var s=tn.current;return s===null?!0:(Le&4194048)===Le?vn===null:(Le&62914560)===Le||(Le&536870912)!==0?s===vn:!1}function n0(){var s=M.H;return M.H=oa,s===null?oa:s}function s0(){var s=M.A;return M.A=X_,s}function Ho(){ft=4,Rs||(Le&4194048)!==Le&&tn.current!==null||(ei=!0),(Ds&134217727)===0&&(fr&134217727)===0||nt===null||ks(nt,Le,rn,!1)}function Gu(s,i,l){var u=Ye;Ye|=2;var y=n0(),b=s0();(nt!==s||Le!==i)&&(Vo=null,si(s,i)),i=!1;var S=ft;e:do try{if(Qe!==0&&je!==null){var T=je,j=sn;switch(Qe){case 8:Vu(),S=6;break e;case 3:case 2:case 9:case 6:tn.current===null&&(i=!0);var z=Qe;if(Qe=0,sn=null,ri(s,T,j,z),l&&ei){S=0;break e}break;default:z=Qe,Qe=0,sn=null,ri(s,T,j,z)}}eS(),S=ft;break}catch(X){e0(s,X)}while(!0);return i&&s.shellSuspendCounter++,Xn=sr=null,Ye=u,M.H=y,M.A=b,je===null&&(nt=null,Le=0,lo()),S}function eS(){for(;je!==null;)r0(je)}function tS(s,i){var l=Ye;Ye|=2;var u=n0(),y=s0();nt!==s||Le!==i?(Vo=null,Bo=ie()+500,si(s,i)):ei=ji(s,i);e:do try{if(Qe!==0&&je!==null){i=je;var b=sn;t:switch(Qe){case 1:Qe=0,sn=null,ri(s,i,b,1);break;case 2:case 9:if(pp(b)){Qe=0,sn=null,i0(i);break}i=function(){Qe!==2&&Qe!==9||nt!==s||(Qe=7),Gn(s)},b.then(i,i);break e;case 3:Qe=7;break e;case 4:Qe=5;break e;case 7:pp(b)?(Qe=0,sn=null,i0(i)):(Qe=0,sn=null,ri(s,i,b,7));break;case 5:var S=null;switch(je.tag){case 26:S=je.memoizedState;case 5:case 27:var T=je;if(S?z0(S):T.stateNode.complete){Qe=0,sn=null;var j=T.sibling;if(j!==null)je=j;else{var z=T.return;z!==null?(je=z,zo(z)):je=null}break t}}Qe=0,sn=null,ri(s,i,b,5);break;case 6:Qe=0,sn=null,ri(s,i,b,6);break;case 8:Vu(),ft=6;break e;default:throw Error(r(462))}}nS();break}catch(X){e0(s,X)}while(!0);return Xn=sr=null,M.H=u,M.A=y,Ye=l,je!==null?0:(nt=null,Le=0,lo(),ft)}function nS(){for(;je!==null&&!Qt();)r0(je)}function r0(s){var i=Am(s.alternate,s,os);s.memoizedProps=s.pendingProps,i===null?zo(s):je=i}function i0(s){var i=s,l=i.alternate;switch(i.tag){case 15:case 0:i=_m(l,i,i.pendingProps,i.type,void 0,Le);break;case 11:i=_m(l,i,i.pendingProps,i.type.render,i.ref,Le);break;case 5:su(i);default:Rm(l,i),i=je=sp(i,os),i=Am(l,i,os)}s.memoizedProps=s.pendingProps,i===null?zo(s):je=i}function ri(s,i,l,u){Xn=sr=null,su(i),Jr=null,Zi=0;var y=i.return;try{if(z_(s,y,i,l,Le)){ft=1,Do(s,mn(l,s.current)),je=null;return}}catch(b){if(y!==null)throw je=y,b;ft=1,Do(s,mn(l,s.current)),je=null;return}i.flags&32768?(Ge||u===1?s=!0:ei||(Le&536870912)!==0?s=!1:(Rs=s=!0,(u===2||u===9||u===3||u===6)&&(u=tn.current,u!==null&&u.tag===13&&(u.flags|=16384))),a0(i,s)):zo(i)}function zo(s){var i=s;do{if((i.flags&32768)!==0){a0(i,Rs);return}s=i.return;var l=J_(i.alternate,i,os);if(l!==null){je=l;return}if(i=i.sibling,i!==null){je=i;return}je=i=s}while(i!==null);ft===0&&(ft=5)}function a0(s,i){do{var l=Y_(s.alternate,s);if(l!==null){l.flags&=32767,je=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(s=s.sibling,s!==null)){je=s;return}je=s=l}while(s!==null);ft=6,je=null}function o0(s,i,l,u,y,b,S,T,j){s.cancelPendingCommit=null;do Fo();while(_t!==0);if((Ye&6)!==0)throw Error(r(327));if(i!==null){if(i===s.current)throw Error(r(177));if(b=i.lanes|i.childLanes,b|=Rc,Uw(s,l,b,S,T,j),s===nt&&(je=nt=null,Le=0),ni=i,Ps=s,ls=l,Lu=b,qu=y,Qm=u,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,aS(Ie,function(){return f0(),null})):(s.callbackNode=null,s.callbackPriority=0),u=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||u){u=M.T,M.T=null,y=G.p,G.p=2,S=Ye,Ye|=4;try{K_(s,i,l)}finally{Ye=S,G.p=y,M.T=u}}_t=1,l0(),c0(),u0()}}function l0(){if(_t===1){_t=0;var s=Ps,i=ni,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=M.T,M.T=null;var u=G.p;G.p=2;var y=Ye;Ye|=4;try{Gm(i,s);var b=ed,S=Yh(s.containerInfo),T=b.focusedElem,j=b.selectionRange;if(S!==T&&T&&T.ownerDocument&&Jh(T.ownerDocument.documentElement,T)){if(j!==null&&Tc(T)){var z=j.start,X=j.end;if(X===void 0&&(X=z),"selectionStart"in T)T.selectionStart=z,T.selectionEnd=Math.min(X,T.value.length);else{var ne=T.ownerDocument||document,F=ne&&ne.defaultView||window;if(F.getSelection){var Y=F.getSelection(),me=T.textContent.length,Te=Math.min(j.start,me),et=j.end===void 0?Te:Math.min(j.end,me);!Y.extend&&Te>et&&(S=et,et=Te,Te=S);var B=$h(T,Te),O=$h(T,et);if(B&&O&&(Y.rangeCount!==1||Y.anchorNode!==B.node||Y.anchorOffset!==B.offset||Y.focusNode!==O.node||Y.focusOffset!==O.offset)){var H=ne.createRange();H.setStart(B.node,B.offset),Y.removeAllRanges(),Te>et?(Y.addRange(H),Y.extend(O.node,O.offset)):(H.setEnd(O.node,O.offset),Y.addRange(H))}}}}for(ne=[],Y=T;Y=Y.parentNode;)Y.nodeType===1&&ne.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<ne.length;T++){var ee=ne[T];ee.element.scrollLeft=ee.left,ee.element.scrollTop=ee.top}}sl=!!Zu,ed=Zu=null}finally{Ye=y,G.p=u,M.T=l}}s.current=i,_t=2}}function c0(){if(_t===2){_t=0;var s=Ps,i=ni,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=M.T,M.T=null;var u=G.p;G.p=2;var y=Ye;Ye|=4;try{Om(s,i.alternate,i)}finally{Ye=y,G.p=u,M.T=l}}_t=3}}function u0(){if(_t===4||_t===3){_t=0,ae();var s=Ps,i=ni,l=ls,u=Qm;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?_t=5:(_t=0,ni=Ps=null,d0(s,s.pendingLanes));var y=s.pendingLanes;if(y===0&&(Ms=null),ac(l),i=i.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(Ui,i,void 0,(i.current.flags&128)===128)}catch{}if(u!==null){i=M.T,y=G.p,G.p=2,M.T=null;try{for(var b=s.onRecoverableError,S=0;S<u.length;S++){var T=u[S];b(T.value,{componentStack:T.stack})}}finally{M.T=i,G.p=y}}(ls&3)!==0&&Fo(),Gn(s),y=s.pendingLanes,(l&261930)!==0&&(y&42)!==0?s===Bu?ga++:(ga=0,Bu=s):ga=0,ya(0)}}function d0(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,Xi(i)))}function Fo(){return l0(),c0(),u0(),f0()}function f0(){if(_t!==5)return!1;var s=Ps,i=Lu;Lu=0;var l=ac(ls),u=M.T,y=G.p;try{G.p=32>l?32:l,M.T=null,l=qu,qu=null;var b=Ps,S=ls;if(_t=0,ni=Ps=null,ls=0,(Ye&6)!==0)throw Error(r(331));var T=Ye;if(Ye|=4,Jm(b.current),zm(b,b.current,S,l),Ye=T,ya(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(Ui,b)}catch{}return!0}finally{G.p=y,M.T=u,d0(s,i)}}function h0(s,i,l){i=mn(l,i),i=xu(s.stateNode,i,2),s=Ns(s,i,2),s!==null&&(Oi(s,2),Gn(s))}function Xe(s,i,l){if(s.tag===3)h0(s,s,l);else for(;i!==null;){if(i.tag===3){h0(i,s,l);break}else if(i.tag===1){var u=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Ms===null||!Ms.has(u))){s=mn(l,s),l=pm(2),u=Ns(i,l,2),u!==null&&(mm(l,u,i,s),Oi(u,2),Gn(u));break}}i=i.return}}function Hu(s,i,l){var u=s.pingCache;if(u===null){u=s.pingCache=new W_;var y=new Set;u.set(i,y)}else y=u.get(i),y===void 0&&(y=new Set,u.set(i,y));y.has(l)||(Uu=!0,y.add(l),s=sS.bind(null,s,i,l),i.then(s,s))}function sS(s,i,l){var u=s.pingCache;u!==null&&u.delete(i),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,nt===s&&(Le&l)===l&&(ft===4||ft===3&&(Le&62914560)===Le&&300>ie()-qo?(Ye&2)===0&&si(s,0):ju|=l,ti===Le&&(ti=0)),Gn(s)}function p0(s,i){i===0&&(i=lh()),s=er(s,i),s!==null&&(Oi(s,i),Gn(s))}function rS(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),p0(s,l)}function iS(s,i){var l=0;switch(s.tag){case 31:case 13:var u=s.stateNode,y=s.memoizedState;y!==null&&(l=y.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(r(314))}u!==null&&u.delete(i),p0(s,l)}function aS(s,i){return jn(s,i)}var $o=null,ii=null,zu=!1,Jo=!1,Fu=!1,Us=0;function Gn(s){s!==ii&&s.next===null&&(ii===null?$o=ii=s:ii=ii.next=s),Jo=!0,zu||(zu=!0,lS())}function ya(s,i){if(!Fu&&Jo){Fu=!0;do for(var l=!1,u=$o;u!==null;){if(s!==0){var y=u.pendingLanes;if(y===0)var b=0;else{var S=u.suspendedLanes,T=u.pingedLanes;b=(1<<31-Wt(42|s)+1)-1,b&=y&~(S&~T),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(l=!0,x0(u,b))}else b=Le,b=Qa(u,u===nt?b:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(b&3)===0||ji(u,b)||(l=!0,x0(u,b));u=u.next}while(l);Fu=!1}}function oS(){m0()}function m0(){Jo=zu=!1;var s=0;Us!==0&&xS()&&(s=Us);for(var i=ie(),l=null,u=$o;u!==null;){var y=u.next,b=g0(u,i);b===0?(u.next=null,l===null?$o=y:l.next=y,y===null&&(ii=l)):(l=u,(s!==0||(b&3)!==0)&&(Jo=!0)),u=y}_t!==0&&_t!==5||ya(s),Us!==0&&(Us=0)}function g0(s,i){for(var l=s.suspendedLanes,u=s.pingedLanes,y=s.expirationTimes,b=s.pendingLanes&-62914561;0<b;){var S=31-Wt(b),T=1<<S,j=y[S];j===-1?((T&l)===0||(T&u)!==0)&&(y[S]=kw(T,i)):j<=i&&(s.expiredLanes|=T),b&=~T}if(i=nt,l=Le,l=Qa(s,s===i?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u=s.callbackNode,l===0||s===i&&(Qe===2||Qe===9)||s.cancelPendingCommit!==null)return u!==null&&u!==null&&On(u),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||ji(s,l)){if(i=l&-l,i===s.callbackPriority)return i;switch(u!==null&&On(u),ac(l)){case 2:case 8:l=Fn;break;case 32:l=Ie;break;case 268435456:l=Ln;break;default:l=Ie}return u=y0.bind(null,s),l=jn(l,u),s.callbackPriority=i,s.callbackNode=l,i}return u!==null&&u!==null&&On(u),s.callbackPriority=2,s.callbackNode=null,2}function y0(s,i){if(_t!==0&&_t!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(Fo()&&s.callbackNode!==l)return null;var u=Le;return u=Qa(s,s===nt?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u===0?null:(Wm(s,u,i),g0(s,ie()),s.callbackNode!=null&&s.callbackNode===l?y0.bind(null,s):null)}function x0(s,i){if(Fo())return null;Wm(s,i,!0)}function lS(){bS(function(){(Ye&6)!==0?jn(He,oS):m0()})}function $u(){if(Us===0){var s=zr;s===0&&(s=Ja,Ja<<=1,(Ja&261888)===0&&(Ja=256)),Us=s}return Us}function v0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:eo(""+s)}function b0(s,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,s.id&&l.setAttribute("form",s.id),i.parentNode.insertBefore(l,i),s=new FormData(s),l.parentNode.removeChild(l),s}function cS(s,i,l,u,y){if(i==="submit"&&l&&l.stateNode===y){var b=v0((y[Ht]||null).action),S=u.submitter;S&&(i=(i=S[Ht]||null)?v0(i.formAction):S.getAttribute("formAction"),i!==null&&(b=i,S=null));var T=new ro("action","action",null,u,y);s.push({event:T,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(Us!==0){var j=S?b0(y,S):new FormData(y);fu(l,{pending:!0,data:j,method:y.method,action:b},null,j)}}else typeof b=="function"&&(T.preventDefault(),j=S?b0(y,S):new FormData(y),fu(l,{pending:!0,data:j,method:y.method,action:b},b,j))},currentTarget:y}]})}}for(var Ju=0;Ju<Ic.length;Ju++){var Yu=Ic[Ju],uS=Yu.toLowerCase(),dS=Yu[0].toUpperCase()+Yu.slice(1);Tn(uS,"on"+dS)}Tn(Xh,"onAnimationEnd"),Tn(Wh,"onAnimationIteration"),Tn(Zh,"onAnimationStart"),Tn("dblclick","onDoubleClick"),Tn("focusin","onFocus"),Tn("focusout","onBlur"),Tn(C_,"onTransitionRun"),Tn(A_,"onTransitionStart"),Tn(I_,"onTransitionCancel"),Tn(ep,"onTransitionEnd"),Rr("onMouseEnter",["mouseout","mouseover"]),Rr("onMouseLeave",["mouseout","mouseover"]),Rr("onPointerEnter",["pointerout","pointerover"]),Rr("onPointerLeave",["pointerout","pointerover"]),Qs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(xa));function w0(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var u=s[l],y=u.event;u=u.listeners;e:{var b=void 0;if(i)for(var S=u.length-1;0<=S;S--){var T=u[S],j=T.instance,z=T.currentTarget;if(T=T.listener,j!==b&&y.isPropagationStopped())break e;b=T,y.currentTarget=z;try{b(y)}catch(X){oo(X)}y.currentTarget=null,b=j}else for(S=0;S<u.length;S++){if(T=u[S],j=T.instance,z=T.currentTarget,T=T.listener,j!==b&&y.isPropagationStopped())break e;b=T,y.currentTarget=z;try{b(y)}catch(X){oo(X)}y.currentTarget=null,b=j}}}}function Oe(s,i){var l=i[oc];l===void 0&&(l=i[oc]=new Set);var u=s+"__bubble";l.has(u)||(_0(i,s,2,!1),l.add(u))}function Ku(s,i,l){var u=0;i&&(u|=4),_0(l,s,u,i)}var Yo="_reactListening"+Math.random().toString(36).slice(2);function Qu(s){if(!s[Yo]){s[Yo]=!0,mh.forEach(function(l){l!=="selectionchange"&&(fS.has(l)||Ku(l,!1,s),Ku(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[Yo]||(i[Yo]=!0,Ku("selectionchange",!1,i))}}function _0(s,i,l,u){switch(X0(i)){case 2:var y=BS;break;case 8:y=VS;break;default:y=dd}l=y.bind(null,i,l,s),y=void 0,!gc||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(y=!0),u?y!==void 0?s.addEventListener(i,l,{capture:!0,passive:y}):s.addEventListener(i,l,!0):y!==void 0?s.addEventListener(i,l,{passive:y}):s.addEventListener(i,l,!1)}function Xu(s,i,l,u,y){var b=u;if((i&1)===0&&(i&2)===0&&u!==null)e:for(;;){if(u===null)return;var S=u.tag;if(S===3||S===4){var T=u.stateNode.containerInfo;if(T===y)break;if(S===4)for(S=u.return;S!==null;){var j=S.tag;if((j===3||j===4)&&S.stateNode.containerInfo===y)return;S=S.return}for(;T!==null;){if(S=Cr(T),S===null)return;if(j=S.tag,j===5||j===6||j===26||j===27){u=b=S;continue e}T=T.parentNode}}u=u.return}Ch(function(){var z=b,X=pc(l),ne=[];e:{var F=tp.get(s);if(F!==void 0){var Y=ro,me=s;switch(s){case"keypress":if(no(l)===0)break e;case"keydown":case"keyup":Y=i_;break;case"focusin":me="focus",Y=bc;break;case"focusout":me="blur",Y=bc;break;case"beforeblur":case"afterblur":Y=bc;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=Rh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=Jw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=l_;break;case Xh:case Wh:case Zh:Y=Qw;break;case ep:Y=u_;break;case"scroll":case"scrollend":Y=Fw;break;case"wheel":Y=f_;break;case"copy":case"cut":case"paste":Y=Ww;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=Mh;break;case"toggle":case"beforetoggle":Y=p_}var Te=(i&4)!==0,et=!Te&&(s==="scroll"||s==="scrollend"),B=Te?F!==null?F+"Capture":null:F;Te=[];for(var O=z,H;O!==null;){var ee=O;if(H=ee.stateNode,ee=ee.tag,ee!==5&&ee!==26&&ee!==27||H===null||B===null||(ee=Bi(O,B),ee!=null&&Te.push(va(O,ee,H))),et)break;O=O.return}0<Te.length&&(F=new Y(F,me,null,l,X),ne.push({event:F,listeners:Te}))}}if((i&7)===0){e:{if(F=s==="mouseover"||s==="pointerover",Y=s==="mouseout"||s==="pointerout",F&&l!==hc&&(me=l.relatedTarget||l.fromElement)&&(Cr(me)||me[Nr]))break e;if((Y||F)&&(F=X.window===X?X:(F=X.ownerDocument)?F.defaultView||F.parentWindow:window,Y?(me=l.relatedTarget||l.toElement,Y=z,me=me?Cr(me):null,me!==null&&(et=o(me),Te=me.tag,me!==et||Te!==5&&Te!==27&&Te!==6)&&(me=null)):(Y=null,me=z),Y!==me)){if(Te=Rh,ee="onMouseLeave",B="onMouseEnter",O="mouse",(s==="pointerout"||s==="pointerover")&&(Te=Mh,ee="onPointerLeave",B="onPointerEnter",O="pointer"),et=Y==null?F:qi(Y),H=me==null?F:qi(me),F=new Te(ee,O+"leave",Y,l,X),F.target=et,F.relatedTarget=H,ee=null,Cr(X)===z&&(Te=new Te(B,O+"enter",me,l,X),Te.target=H,Te.relatedTarget=et,ee=Te),et=ee,Y&&me)t:{for(Te=hS,B=Y,O=me,H=0,ee=B;ee;ee=Te(ee))H++;ee=0;for(var Se=O;Se;Se=Te(Se))ee++;for(;0<H-ee;)B=Te(B),H--;for(;0<ee-H;)O=Te(O),ee--;for(;H--;){if(B===O||O!==null&&B===O.alternate){Te=B;break t}B=Te(B),O=Te(O)}Te=null}else Te=null;Y!==null&&S0(ne,F,Y,Te,!1),me!==null&&et!==null&&S0(ne,et,me,Te,!0)}}e:{if(F=z?qi(z):window,Y=F.nodeName&&F.nodeName.toLowerCase(),Y==="select"||Y==="input"&&F.type==="file")var Fe=Bh;else if(Lh(F))if(Vh)Fe=E_;else{Fe=__;var xe=w_}else Y=F.nodeName,!Y||Y.toLowerCase()!=="input"||F.type!=="checkbox"&&F.type!=="radio"?z&&fc(z.elementType)&&(Fe=Bh):Fe=S_;if(Fe&&(Fe=Fe(s,z))){qh(ne,Fe,l,X);break e}xe&&xe(s,F,z),s==="focusout"&&z&&F.type==="number"&&z.memoizedProps.value!=null&&dc(F,"number",F.value)}switch(xe=z?qi(z):window,s){case"focusin":(Lh(xe)||xe.contentEditable==="true")&&(jr=xe,Nc=z,Yi=null);break;case"focusout":Yi=Nc=jr=null;break;case"mousedown":Cc=!0;break;case"contextmenu":case"mouseup":case"dragend":Cc=!1,Kh(ne,l,X);break;case"selectionchange":if(N_)break;case"keydown":case"keyup":Kh(ne,l,X)}var Pe;if(_c)e:{switch(s){case"compositionstart":var qe="onCompositionStart";break e;case"compositionend":qe="onCompositionEnd";break e;case"compositionupdate":qe="onCompositionUpdate";break e}qe=void 0}else Ur?jh(s,l)&&(qe="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(qe="onCompositionStart");qe&&(Ph&&l.locale!=="ko"&&(Ur||qe!=="onCompositionStart"?qe==="onCompositionEnd"&&Ur&&(Pe=Ah()):(vs=X,yc="value"in vs?vs.value:vs.textContent,Ur=!0)),xe=Ko(z,qe),0<xe.length&&(qe=new Dh(qe,s,null,l,X),ne.push({event:qe,listeners:xe}),Pe?qe.data=Pe:(Pe=Oh(l),Pe!==null&&(qe.data=Pe)))),(Pe=g_?y_(s,l):x_(s,l))&&(qe=Ko(z,"onBeforeInput"),0<qe.length&&(xe=new Dh("onBeforeInput","beforeinput",null,l,X),ne.push({event:xe,listeners:qe}),xe.data=Pe)),cS(ne,s,z,l,X)}w0(ne,i)})}function va(s,i,l){return{instance:s,listener:i,currentTarget:l}}function Ko(s,i){for(var l=i+"Capture",u=[];s!==null;){var y=s,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=Bi(s,l),y!=null&&u.unshift(va(s,y,b)),y=Bi(s,i),y!=null&&u.push(va(s,y,b))),s.tag===3)return u;s=s.return}return[]}function hS(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function S0(s,i,l,u,y){for(var b=i._reactName,S=[];l!==null&&l!==u;){var T=l,j=T.alternate,z=T.stateNode;if(T=T.tag,j!==null&&j===u)break;T!==5&&T!==26&&T!==27||z===null||(j=z,y?(z=Bi(l,b),z!=null&&S.unshift(va(l,z,j))):y||(z=Bi(l,b),z!=null&&S.push(va(l,z,j)))),l=l.return}S.length!==0&&s.push({event:i,listeners:S})}var pS=/\r\n?/g,mS=/\u0000|\uFFFD/g;function E0(s){return(typeof s=="string"?s:""+s).replace(pS,`
`).replace(mS,"")}function T0(s,i){return i=E0(i),E0(s)===i}function Ze(s,i,l,u,y,b){switch(l){case"children":typeof u=="string"?i==="body"||i==="textarea"&&u===""||Mr(s,u):(typeof u=="number"||typeof u=="bigint")&&i!=="body"&&Mr(s,""+u);break;case"className":Wa(s,"class",u);break;case"tabIndex":Wa(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":Wa(s,l,u);break;case"style":Th(s,u,b);break;case"data":if(i!=="object"){Wa(s,"data",u);break}case"src":case"href":if(u===""&&(i!=="a"||l!=="href")){s.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=eo(""+u),s.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(l==="formAction"?(i!=="input"&&Ze(s,i,"name",y.name,y,null),Ze(s,i,"formEncType",y.formEncType,y,null),Ze(s,i,"formMethod",y.formMethod,y,null),Ze(s,i,"formTarget",y.formTarget,y,null)):(Ze(s,i,"encType",y.encType,y,null),Ze(s,i,"method",y.method,y,null),Ze(s,i,"target",y.target,y,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=eo(""+u),s.setAttribute(l,u);break;case"onClick":u!=null&&(s.onclick=Jn);break;case"onScroll":u!=null&&Oe("scroll",s);break;case"onScrollEnd":u!=null&&Oe("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(l=u.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}l=eo(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""+u):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":u===!0?s.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,u):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(l,u):s.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(l):s.setAttribute(l,u);break;case"popover":Oe("beforetoggle",s),Oe("toggle",s),Xa(s,"popover",u);break;case"xlinkActuate":$n(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":$n(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":$n(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":$n(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":$n(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":$n(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":$n(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":$n(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":$n(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Xa(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Hw.get(l)||l,Xa(s,l,u))}}function Wu(s,i,l,u,y,b){switch(l){case"style":Th(s,u,b);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(l=u.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"children":typeof u=="string"?Mr(s,u):(typeof u=="number"||typeof u=="bigint")&&Mr(s,""+u);break;case"onScroll":u!=null&&Oe("scroll",s);break;case"onScrollEnd":u!=null&&Oe("scrollend",s);break;case"onClick":u!=null&&(s.onclick=Jn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!gh.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),i=l.slice(2,y?l.length-7:void 0),b=s[Ht]||null,b=b!=null?b[l]:null,typeof b=="function"&&s.removeEventListener(i,b,y),typeof u=="function")){typeof b!="function"&&b!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(i,u,y);break e}l in s?s[l]=u:u===!0?s.setAttribute(l,""):Xa(s,l,u)}}}function Pt(s,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oe("error",s),Oe("load",s);var u=!1,y=!1,b;for(b in l)if(l.hasOwnProperty(b)){var S=l[b];if(S!=null)switch(b){case"src":u=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Ze(s,i,b,S,l,null)}}y&&Ze(s,i,"srcSet",l.srcSet,l,null),u&&Ze(s,i,"src",l.src,l,null);return;case"input":Oe("invalid",s);var T=b=S=y=null,j=null,z=null;for(u in l)if(l.hasOwnProperty(u)){var X=l[u];if(X!=null)switch(u){case"name":y=X;break;case"type":S=X;break;case"checked":j=X;break;case"defaultChecked":z=X;break;case"value":b=X;break;case"defaultValue":T=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(r(137,i));break;default:Ze(s,i,u,X,l,null)}}wh(s,b,T,j,z,S,y,!1);return;case"select":Oe("invalid",s),u=S=b=null;for(y in l)if(l.hasOwnProperty(y)&&(T=l[y],T!=null))switch(y){case"value":b=T;break;case"defaultValue":S=T;break;case"multiple":u=T;default:Ze(s,i,y,T,l,null)}i=b,l=S,s.multiple=!!u,i!=null?Dr(s,!!u,i,!1):l!=null&&Dr(s,!!u,l,!0);return;case"textarea":Oe("invalid",s),b=y=u=null;for(S in l)if(l.hasOwnProperty(S)&&(T=l[S],T!=null))switch(S){case"value":u=T;break;case"defaultValue":y=T;break;case"children":b=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(r(91));break;default:Ze(s,i,S,T,l,null)}Sh(s,u,y,b);return;case"option":for(j in l)if(l.hasOwnProperty(j)&&(u=l[j],u!=null))switch(j){case"selected":s.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:Ze(s,i,j,u,l,null)}return;case"dialog":Oe("beforetoggle",s),Oe("toggle",s),Oe("cancel",s),Oe("close",s);break;case"iframe":case"object":Oe("load",s);break;case"video":case"audio":for(u=0;u<xa.length;u++)Oe(xa[u],s);break;case"image":Oe("error",s),Oe("load",s);break;case"details":Oe("toggle",s);break;case"embed":case"source":case"link":Oe("error",s),Oe("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(z in l)if(l.hasOwnProperty(z)&&(u=l[z],u!=null))switch(z){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Ze(s,i,z,u,l,null)}return;default:if(fc(i)){for(X in l)l.hasOwnProperty(X)&&(u=l[X],u!==void 0&&Wu(s,i,X,u,l,void 0));return}}for(T in l)l.hasOwnProperty(T)&&(u=l[T],u!=null&&Ze(s,i,T,u,l,null))}function gS(s,i,l,u){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,S=null,T=null,j=null,z=null,X=null;for(Y in l){var ne=l[Y];if(l.hasOwnProperty(Y)&&ne!=null)switch(Y){case"checked":break;case"value":break;case"defaultValue":j=ne;default:u.hasOwnProperty(Y)||Ze(s,i,Y,null,u,ne)}}for(var F in u){var Y=u[F];if(ne=l[F],u.hasOwnProperty(F)&&(Y!=null||ne!=null))switch(F){case"type":b=Y;break;case"name":y=Y;break;case"checked":z=Y;break;case"defaultChecked":X=Y;break;case"value":S=Y;break;case"defaultValue":T=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(r(137,i));break;default:Y!==ne&&Ze(s,i,F,Y,u,ne)}}uc(s,S,T,j,z,X,b,y);return;case"select":Y=S=T=F=null;for(b in l)if(j=l[b],l.hasOwnProperty(b)&&j!=null)switch(b){case"value":break;case"multiple":Y=j;default:u.hasOwnProperty(b)||Ze(s,i,b,null,u,j)}for(y in u)if(b=u[y],j=l[y],u.hasOwnProperty(y)&&(b!=null||j!=null))switch(y){case"value":F=b;break;case"defaultValue":T=b;break;case"multiple":S=b;default:b!==j&&Ze(s,i,y,b,u,j)}i=T,l=S,u=Y,F!=null?Dr(s,!!l,F,!1):!!u!=!!l&&(i!=null?Dr(s,!!l,i,!0):Dr(s,!!l,l?[]:"",!1));return;case"textarea":Y=F=null;for(T in l)if(y=l[T],l.hasOwnProperty(T)&&y!=null&&!u.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:Ze(s,i,T,null,u,y)}for(S in u)if(y=u[S],b=l[S],u.hasOwnProperty(S)&&(y!=null||b!=null))switch(S){case"value":F=y;break;case"defaultValue":Y=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==b&&Ze(s,i,S,y,u,b)}_h(s,F,Y);return;case"option":for(var me in l)if(F=l[me],l.hasOwnProperty(me)&&F!=null&&!u.hasOwnProperty(me))switch(me){case"selected":s.selected=!1;break;default:Ze(s,i,me,null,u,F)}for(j in u)if(F=u[j],Y=l[j],u.hasOwnProperty(j)&&F!==Y&&(F!=null||Y!=null))switch(j){case"selected":s.selected=F&&typeof F!="function"&&typeof F!="symbol";break;default:Ze(s,i,j,F,u,Y)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Te in l)F=l[Te],l.hasOwnProperty(Te)&&F!=null&&!u.hasOwnProperty(Te)&&Ze(s,i,Te,null,u,F);for(z in u)if(F=u[z],Y=l[z],u.hasOwnProperty(z)&&F!==Y&&(F!=null||Y!=null))switch(z){case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(r(137,i));break;default:Ze(s,i,z,F,u,Y)}return;default:if(fc(i)){for(var et in l)F=l[et],l.hasOwnProperty(et)&&F!==void 0&&!u.hasOwnProperty(et)&&Wu(s,i,et,void 0,u,F);for(X in u)F=u[X],Y=l[X],!u.hasOwnProperty(X)||F===Y||F===void 0&&Y===void 0||Wu(s,i,X,F,u,Y);return}}for(var B in l)F=l[B],l.hasOwnProperty(B)&&F!=null&&!u.hasOwnProperty(B)&&Ze(s,i,B,null,u,F);for(ne in u)F=u[ne],Y=l[ne],!u.hasOwnProperty(ne)||F===Y||F==null&&Y==null||Ze(s,i,ne,F,u,Y)}function N0(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function yS(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,l=performance.getEntriesByType("resource"),u=0;u<l.length;u++){var y=l[u],b=y.transferSize,S=y.initiatorType,T=y.duration;if(b&&T&&N0(S)){for(S=0,T=y.responseEnd,u+=1;u<l.length;u++){var j=l[u],z=j.startTime;if(z>T)break;var X=j.transferSize,ne=j.initiatorType;X&&N0(ne)&&(j=j.responseEnd,S+=X*(j<T?1:(T-z)/(j-z)))}if(--u,i+=8*(b+S)/(y.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Zu=null,ed=null;function Qo(s){return s.nodeType===9?s:s.ownerDocument}function C0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function A0(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function td(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var nd=null;function xS(){var s=window.event;return s&&s.type==="popstate"?s===nd?!1:(nd=s,!0):(nd=null,!1)}var I0=typeof setTimeout=="function"?setTimeout:void 0,vS=typeof clearTimeout=="function"?clearTimeout:void 0,R0=typeof Promise=="function"?Promise:void 0,bS=typeof queueMicrotask=="function"?queueMicrotask:typeof R0<"u"?function(s){return R0.resolve(null).then(s).catch(wS)}:I0;function wS(s){setTimeout(function(){throw s})}function js(s){return s==="head"}function D0(s,i){var l=i,u=0;do{var y=l.nextSibling;if(s.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(u===0){s.removeChild(y),ci(i);return}u--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")u++;else if(l==="html")ba(s.ownerDocument.documentElement);else if(l==="head"){l=s.ownerDocument.head,ba(l);for(var b=l.firstChild;b;){var S=b.nextSibling,T=b.nodeName;b[Li]||T==="SCRIPT"||T==="STYLE"||T==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=S}}else l==="body"&&ba(s.ownerDocument.body);l=y}while(l);ci(i)}function M0(s,i){var l=s;s=0;do{var u=l.nextSibling;if(l.nodeType===1?i?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(i?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),u&&u.nodeType===8)if(l=u.data,l==="/$"){if(s===0)break;s--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||s++;l=u}while(l)}function sd(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":sd(l),lc(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function _S(s,i,l,u){for(;s.nodeType===1;){var y=l;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[Li])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(b=s.getAttribute("rel"),b==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(b!==y.rel||s.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||s.getAttribute("title")!==(y.title==null?null:y.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(b=s.getAttribute("src"),(b!==(y.src==null?null:y.src)||s.getAttribute("type")!==(y.type==null?null:y.type)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&s.getAttribute("name")===b)return s}else return s;if(s=bn(s.nextSibling),s===null)break}return null}function SS(s,i,l){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=bn(s.nextSibling),s===null))return null;return s}function P0(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=bn(s.nextSibling),s===null))return null;return s}function rd(s){return s.data==="$?"||s.data==="$~"}function id(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function ES(s,i){var l=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||l.readyState!=="loading")i();else{var u=function(){i(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),s._reactRetry=u}}function bn(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var ad=null;function k0(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"||l==="/&"){if(i===0)return bn(s.nextSibling);i--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||i++}s=s.nextSibling}return null}function U0(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(i===0)return s;i--}else l!=="/$"&&l!=="/&"||i++}s=s.previousSibling}return null}function j0(s,i,l){switch(i=Qo(l),s){case"html":if(s=i.documentElement,!s)throw Error(r(452));return s;case"head":if(s=i.head,!s)throw Error(r(453));return s;case"body":if(s=i.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function ba(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);lc(s)}var wn=new Map,O0=new Set;function Xo(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var cs=G.d;G.d={f:TS,r:NS,D:CS,C:AS,L:IS,m:RS,X:MS,S:DS,M:PS};function TS(){var s=cs.f(),i=Go();return s||i}function NS(s){var i=Ar(s);i!==null&&i.tag===5&&i.type==="form"?em(i):cs.r(s)}var ai=typeof document>"u"?null:document;function L0(s,i,l){var u=ai;if(u&&typeof i=="string"&&i){var y=hn(i);y='link[rel="'+s+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),O0.has(y)||(O0.add(y),s={rel:s,crossOrigin:l,href:i},u.querySelector(y)===null&&(i=u.createElement("link"),Pt(i,"link",s),Tt(i),u.head.appendChild(i)))}}function CS(s){cs.D(s),L0("dns-prefetch",s,null)}function AS(s,i){cs.C(s,i),L0("preconnect",s,i)}function IS(s,i,l){cs.L(s,i,l);var u=ai;if(u&&s&&i){var y='link[rel="preload"][as="'+hn(i)+'"]';i==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+hn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+hn(l.imageSizes)+'"]')):y+='[href="'+hn(s)+'"]';var b=y;switch(i){case"style":b=oi(s);break;case"script":b=li(s)}wn.has(b)||(s=v({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:s,as:i},l),wn.set(b,s),u.querySelector(y)!==null||i==="style"&&u.querySelector(wa(b))||i==="script"&&u.querySelector(_a(b))||(i=u.createElement("link"),Pt(i,"link",s),Tt(i),u.head.appendChild(i)))}}function RS(s,i){cs.m(s,i);var l=ai;if(l&&s){var u=i&&typeof i.as=="string"?i.as:"script",y='link[rel="modulepreload"][as="'+hn(u)+'"][href="'+hn(s)+'"]',b=y;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=li(s)}if(!wn.has(b)&&(s=v({rel:"modulepreload",href:s},i),wn.set(b,s),l.querySelector(y)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(_a(b)))return}u=l.createElement("link"),Pt(u,"link",s),Tt(u),l.head.appendChild(u)}}}function DS(s,i,l){cs.S(s,i,l);var u=ai;if(u&&s){var y=Ir(u).hoistableStyles,b=oi(s);i=i||"default";var S=y.get(b);if(!S){var T={loading:0,preload:null};if(S=u.querySelector(wa(b)))T.loading=5;else{s=v({rel:"stylesheet",href:s,"data-precedence":i},l),(l=wn.get(b))&&od(s,l);var j=S=u.createElement("link");Tt(j),Pt(j,"link",s),j._p=new Promise(function(z,X){j.onload=z,j.onerror=X}),j.addEventListener("load",function(){T.loading|=1}),j.addEventListener("error",function(){T.loading|=2}),T.loading|=4,Wo(S,i,u)}S={type:"stylesheet",instance:S,count:1,state:T},y.set(b,S)}}}function MS(s,i){cs.X(s,i);var l=ai;if(l&&s){var u=Ir(l).hoistableScripts,y=li(s),b=u.get(y);b||(b=l.querySelector(_a(y)),b||(s=v({src:s,async:!0},i),(i=wn.get(y))&&ld(s,i),b=l.createElement("script"),Tt(b),Pt(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},u.set(y,b))}}function PS(s,i){cs.M(s,i);var l=ai;if(l&&s){var u=Ir(l).hoistableScripts,y=li(s),b=u.get(y);b||(b=l.querySelector(_a(y)),b||(s=v({src:s,async:!0,type:"module"},i),(i=wn.get(y))&&ld(s,i),b=l.createElement("script"),Tt(b),Pt(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},u.set(y,b))}}function q0(s,i,l,u){var y=(y=ge.current)?Xo(y):null;if(!y)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=oi(l.href),l=Ir(y).hoistableStyles,u=l.get(i),u||(u={type:"style",instance:null,count:0,state:null},l.set(i,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=oi(l.href);var b=Ir(y).hoistableStyles,S=b.get(s);if(S||(y=y.ownerDocument||y,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(s,S),(b=y.querySelector(wa(s)))&&!b._p&&(S.instance=b,S.state.loading=5),wn.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},wn.set(s,l),b||kS(y,s,l,S.state))),i&&u===null)throw Error(r(528,""));return S}if(i&&u!==null)throw Error(r(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=li(l),l=Ir(y).hoistableScripts,u=l.get(i),u||(u={type:"script",instance:null,count:0,state:null},l.set(i,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function oi(s){return'href="'+hn(s)+'"'}function wa(s){return'link[rel="stylesheet"]['+s+"]"}function B0(s){return v({},s,{"data-precedence":s.precedence,precedence:null})}function kS(s,i,l,u){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?u.loading=1:(i=s.createElement("link"),u.preload=i,i.addEventListener("load",function(){return u.loading|=1}),i.addEventListener("error",function(){return u.loading|=2}),Pt(i,"link",l),Tt(i),s.head.appendChild(i))}function li(s){return'[src="'+hn(s)+'"]'}function _a(s){return"script[async]"+s}function V0(s,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var u=s.querySelector('style[data-href~="'+hn(l.href)+'"]');if(u)return i.instance=u,Tt(u),u;var y=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),Tt(u),Pt(u,"style",y),Wo(u,l.precedence,s),i.instance=u;case"stylesheet":y=oi(l.href);var b=s.querySelector(wa(y));if(b)return i.state.loading|=4,i.instance=b,Tt(b),b;u=B0(l),(y=wn.get(y))&&od(u,y),b=(s.ownerDocument||s).createElement("link"),Tt(b);var S=b;return S._p=new Promise(function(T,j){S.onload=T,S.onerror=j}),Pt(b,"link",u),i.state.loading|=4,Wo(b,l.precedence,s),i.instance=b;case"script":return b=li(l.src),(y=s.querySelector(_a(b)))?(i.instance=y,Tt(y),y):(u=l,(y=wn.get(b))&&(u=v({},l),ld(u,y)),s=s.ownerDocument||s,y=s.createElement("script"),Tt(y),Pt(y,"link",u),s.head.appendChild(y),i.instance=y);case"void":return null;default:throw Error(r(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(u=i.instance,i.state.loading|=4,Wo(u,l.precedence,s));return i.instance}function Wo(s,i,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=u.length?u[u.length-1]:null,b=y,S=0;S<u.length;S++){var T=u[S];if(T.dataset.precedence===i)b=T;else if(b!==y)break}b?b.parentNode.insertBefore(s,b.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(s,i.firstChild))}function od(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function ld(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var Zo=null;function G0(s,i,l){if(Zo===null){var u=new Map,y=Zo=new Map;y.set(l,u)}else y=Zo,u=y.get(l),u||(u=new Map,y.set(l,u));if(u.has(s))return u;for(u.set(s,null),l=l.getElementsByTagName(s),y=0;y<l.length;y++){var b=l[y];if(!(b[Li]||b[It]||s==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var S=b.getAttribute(i)||"";S=s+S;var T=u.get(S);T?T.push(b):u.set(S,[b])}}return u}function H0(s,i,l){s=s.ownerDocument||s,s.head.insertBefore(l,i==="title"?s.querySelector("head > title"):null)}function US(s,i,l){if(l===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function z0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function jS(s,i,l,u){if(l.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=oi(u.href),b=i.querySelector(wa(y));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=el.bind(s),i.then(s,s)),l.state.loading|=4,l.instance=b,Tt(b);return}b=i.ownerDocument||i,u=B0(u),(y=wn.get(y))&&od(u,y),b=b.createElement("link"),Tt(b);var S=b;S._p=new Promise(function(T,j){S.onload=T,S.onerror=j}),Pt(b,"link",u),l.instance=b}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(l,i),(i=l.state.preload)&&(l.state.loading&3)===0&&(s.count++,l=el.bind(s),i.addEventListener("load",l),i.addEventListener("error",l))}}var cd=0;function OS(s,i){return s.stylesheets&&s.count===0&&nl(s,s.stylesheets),0<s.count||0<s.imgCount?function(l){var u=setTimeout(function(){if(s.stylesheets&&nl(s,s.stylesheets),s.unsuspend){var b=s.unsuspend;s.unsuspend=null,b()}},6e4+i);0<s.imgBytes&&cd===0&&(cd=62500*yS());var y=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&nl(s,s.stylesheets),s.unsuspend)){var b=s.unsuspend;s.unsuspend=null,b()}},(s.imgBytes>cd?50:800)+i);return s.unsuspend=l,function(){s.unsuspend=null,clearTimeout(u),clearTimeout(y)}}:null}function el(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)nl(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var tl=null;function nl(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,tl=new Map,i.forEach(LS,s),tl=null,el.call(s))}function LS(s,i){if(!(i.state.loading&4)){var l=tl.get(s);if(l)var u=l.get(null);else{l=new Map,tl.set(s,l);for(var y=s.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var S=y[b];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(l.set(S.dataset.precedence,S),u=S)}u&&l.set(null,u)}y=i.instance,S=y.getAttribute("data-precedence"),b=l.get(S)||u,b===u&&l.set(null,y),l.set(S,y),this.count++,u=el.bind(this),y.addEventListener("load",u),y.addEventListener("error",u),b?b.parentNode.insertBefore(y,b.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(y,s.firstChild)),i.state.loading|=4}}var Sa={$$typeof:R,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function qS(s,i,l,u,y,b,S,T,j){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=rc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rc(0),this.hiddenUpdates=rc(null),this.identifierPrefix=u,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function F0(s,i,l,u,y,b,S,T,j,z,X,ne){return s=new qS(s,i,l,S,j,z,X,ne,T),i=1,b===!0&&(i|=24),b=en(3,null,null,i),s.current=b,b.stateNode=s,i=Gc(),i.refCount++,s.pooledCache=i,i.refCount++,b.memoizedState={element:u,isDehydrated:l,cache:i},$c(b),s}function $0(s){return s?(s=qr,s):qr}function J0(s,i,l,u,y,b){y=$0(y),u.context===null?u.context=y:u.pendingContext=y,u=Ts(i),u.payload={element:l},b=b===void 0?null:b,b!==null&&(u.callback=b),l=Ns(s,u,i),l!==null&&(Kt(l,s,i),ta(l,s,i))}function Y0(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function ud(s,i){Y0(s,i),(s=s.alternate)&&Y0(s,i)}function K0(s){if(s.tag===13||s.tag===31){var i=er(s,67108864);i!==null&&Kt(i,s,67108864),ud(s,67108864)}}function Q0(s){if(s.tag===13||s.tag===31){var i=an();i=ic(i);var l=er(s,i);l!==null&&Kt(l,s,i),ud(s,i)}}var sl=!0;function BS(s,i,l,u){var y=M.T;M.T=null;var b=G.p;try{G.p=2,dd(s,i,l,u)}finally{G.p=b,M.T=y}}function VS(s,i,l,u){var y=M.T;M.T=null;var b=G.p;try{G.p=8,dd(s,i,l,u)}finally{G.p=b,M.T=y}}function dd(s,i,l,u){if(sl){var y=fd(u);if(y===null)Xu(s,i,u,rl,l),W0(s,u);else if(HS(y,s,i,l,u))u.stopPropagation();else if(W0(s,u),i&4&&-1<GS.indexOf(s)){for(;y!==null;){var b=Ar(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var S=Ks(b.pendingLanes);if(S!==0){var T=b;for(T.pendingLanes|=2,T.entangledLanes|=2;S;){var j=1<<31-Wt(S);T.entanglements[1]|=j,S&=~j}Gn(b),(Ye&6)===0&&(Bo=ie()+500,ya(0))}}break;case 31:case 13:T=er(b,2),T!==null&&Kt(T,b,2),Go(),ud(b,2)}if(b=fd(u),b===null&&Xu(s,i,u,rl,l),b===y)break;y=b}y!==null&&u.stopPropagation()}else Xu(s,i,u,null,l)}}function fd(s){return s=pc(s),hd(s)}var rl=null;function hd(s){if(rl=null,s=Cr(s),s!==null){var i=o(s);if(i===null)s=null;else{var l=i.tag;if(l===13){if(s=c(i),s!==null)return s;s=null}else if(l===31){if(s=d(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return rl=s,null}function X0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ne()){case He:return 2;case Fn:return 8;case Ie:case Et:return 32;case Ln:return 268435456;default:return 32}default:return 32}}var pd=!1,Os=null,Ls=null,qs=null,Ea=new Map,Ta=new Map,Bs=[],GS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function W0(s,i){switch(s){case"focusin":case"focusout":Os=null;break;case"dragenter":case"dragleave":Ls=null;break;case"mouseover":case"mouseout":qs=null;break;case"pointerover":case"pointerout":Ea.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ta.delete(i.pointerId)}}function Na(s,i,l,u,y,b){return s===null||s.nativeEvent!==b?(s={blockedOn:i,domEventName:l,eventSystemFlags:u,nativeEvent:b,targetContainers:[y]},i!==null&&(i=Ar(i),i!==null&&K0(i)),s):(s.eventSystemFlags|=u,i=s.targetContainers,y!==null&&i.indexOf(y)===-1&&i.push(y),s)}function HS(s,i,l,u,y){switch(i){case"focusin":return Os=Na(Os,s,i,l,u,y),!0;case"dragenter":return Ls=Na(Ls,s,i,l,u,y),!0;case"mouseover":return qs=Na(qs,s,i,l,u,y),!0;case"pointerover":var b=y.pointerId;return Ea.set(b,Na(Ea.get(b)||null,s,i,l,u,y)),!0;case"gotpointercapture":return b=y.pointerId,Ta.set(b,Na(Ta.get(b)||null,s,i,l,u,y)),!0}return!1}function Z0(s){var i=Cr(s.target);if(i!==null){var l=o(i);if(l!==null){if(i=l.tag,i===13){if(i=c(l),i!==null){s.blockedOn=i,hh(s.priority,function(){Q0(l)});return}}else if(i===31){if(i=d(l),i!==null){s.blockedOn=i,hh(s.priority,function(){Q0(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function il(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=fd(s.nativeEvent);if(l===null){l=s.nativeEvent;var u=new l.constructor(l.type,l);hc=u,l.target.dispatchEvent(u),hc=null}else return i=Ar(l),i!==null&&K0(i),s.blockedOn=l,!1;i.shift()}return!0}function eg(s,i,l){il(s)&&l.delete(i)}function zS(){pd=!1,Os!==null&&il(Os)&&(Os=null),Ls!==null&&il(Ls)&&(Ls=null),qs!==null&&il(qs)&&(qs=null),Ea.forEach(eg),Ta.forEach(eg)}function al(s,i){s.blockedOn===i&&(s.blockedOn=null,pd||(pd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,zS)))}var ol=null;function tg(s){ol!==s&&(ol=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){ol===s&&(ol=null);for(var i=0;i<s.length;i+=3){var l=s[i],u=s[i+1],y=s[i+2];if(typeof u!="function"){if(hd(u||l)===null)continue;break}var b=Ar(l);b!==null&&(s.splice(i,3),i-=3,fu(b,{pending:!0,data:y,method:l.method,action:u},u,y))}}))}function ci(s){function i(j){return al(j,s)}Os!==null&&al(Os,s),Ls!==null&&al(Ls,s),qs!==null&&al(qs,s),Ea.forEach(i),Ta.forEach(i);for(var l=0;l<Bs.length;l++){var u=Bs[l];u.blockedOn===s&&(u.blockedOn=null)}for(;0<Bs.length&&(l=Bs[0],l.blockedOn===null);)Z0(l),l.blockedOn===null&&Bs.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var y=l[u],b=l[u+1],S=y[Ht]||null;if(typeof b=="function")S||tg(l);else if(S){var T=null;if(b&&b.hasAttribute("formAction")){if(y=b,S=b[Ht]||null)T=S.formAction;else if(hd(y)!==null)continue}else T=S.action;typeof T=="function"?l[u+1]=T:(l.splice(u,3),u-=3),tg(l)}}}function ng(){function s(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(S){return y=S})},focusReset:"manual",scroll:"manual"})}function i(){y!==null&&(y(),y=null),u||setTimeout(l,20)}function l(){if(!u&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,y=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(l,100),function(){u=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),y!==null&&(y(),y=null)}}}function md(s){this._internalRoot=s}ll.prototype.render=md.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(r(409));var l=i.current,u=an();J0(l,u,s,i,null,null)},ll.prototype.unmount=md.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;J0(s.current,2,null,s,null,null),Go(),i[Nr]=null}};function ll(s){this._internalRoot=s}ll.prototype.unstable_scheduleHydration=function(s){if(s){var i=fh();s={blockedOn:null,target:s,priority:i};for(var l=0;l<Bs.length&&i!==0&&i<Bs[l].priority;l++);Bs.splice(l,0,s),l===0&&Z0(s)}};var sg=e.version;if(sg!=="19.2.0")throw Error(r(527,sg,"19.2.0"));G.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=h(i),s=s!==null?x(s):null,s=s===null?null:s.stateNode,s};var FS={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:M,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cl.isDisabled&&cl.supportsFiber)try{Ui=cl.inject(FS),Xt=cl}catch{}}return Aa.createRoot=function(s,i){if(!a(s))throw Error(r(299));var l=!1,u="",y=um,b=dm,S=fm;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onUncaughtError!==void 0&&(y=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(S=i.onRecoverableError)),i=F0(s,1,!1,null,null,l,u,null,y,b,S,ng),s[Nr]=i.current,Qu(s),new md(i)},Aa.hydrateRoot=function(s,i,l){if(!a(s))throw Error(r(299));var u=!1,y="",b=um,S=dm,T=fm,j=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(S=l.onCaughtError),l.onRecoverableError!==void 0&&(T=l.onRecoverableError),l.formState!==void 0&&(j=l.formState)),i=F0(s,1,!0,i,l??null,u,y,j,b,S,T,ng),i.context=$0(null),l=i.current,u=an(),u=ic(u),y=Ts(u),y.callback=null,Ns(l,y,u),l=u,i.current.lanes=l,Oi(i,l),Gn(i),s[Nr]=i.current,Qu(s),new ll(i)},Aa.version="19.2.0",Aa}var hg;function sE(){if(hg)return xd.exports;hg=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),xd.exports=nE(),xd.exports}var rE=sE();const iE=xf(rE);var Tl={isNone:function(){return!0},orElse:function(t){return t},orCall:function(t){return t()},orNull:function(){return null},orThrow:function(t){throw t===void 0&&(t="Unexpected null value"),new TypeError(t)},map:function(){return Tl},get:function(){return Tl}},Dx=(function(){function t(e){this.value=e}return t.prototype.isNone=function(){return!1},t.prototype.orElse=function(){return this.value},t.prototype.orCall=function(){return this.value},t.prototype.orNull=function(){return this.value},t.prototype.orThrow=function(){return this.value},t.prototype.map=function(e){return ve(e(this.value))},t.prototype.get=function(e){return this.map(function(n){return n[e]})},t})();function aE(t){return t===Tl||t instanceof Dx}function ve(t){return aE(t)?t:t==null?Tl:oE(t)}function oE(t){if(t==null)throw new TypeError("some() does not accept null or undefined");return new Dx(t)}let Nl=class extends Error{constructor(e){super(e.statusText),Object.setPrototypeOf(this,new.target.prototype),this.headers=e.headers,this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.data=e.data}},qd,Mx;"rawJSON"in JSON&&(qd=function(t,e,n){if(Number.isInteger(e)&&!Number.isSafeInteger(e))try{return BigInt(n.source)}catch{return e}return e},Mx=function(t,e){return typeof e=="bigint"?JSON.rawJSON(String(e)):e});const bf=t=>t==="post"||t==="put"||t==="patch"||t==="delete";function lE(t){const e=[],n=(r,a)=>`${encodeURIComponent(r)}=${encodeURIComponent(String(a))}`;return Object.keys(t).forEach(r=>{const a=t[r];a!=null&&(Array.isArray(a)?a.forEach(o=>e.push(n(r,o))):e.push(n(r,a)))}),e.length>0?`?${e.join("&")}`:""}function cE(t,e){return t.replace(/\{([^}]+)\}/g,(n,r)=>{const a=encodeURIComponent(e[r]);return delete e[r],a})}function uE(t,e,n){let r={};return bf(t)?n.forEach(a=>{r[a]=e[a],delete e[a]}):r={...e},lE(r)}function dE(t,e){const n=new Headers(e);return t!==void 0&&!(t instanceof FormData)&&!n.has("Content-Type")&&n.append("Content-Type","application/json"),n.has("Accept")||n.append("Accept","application/json"),n}function fE(t,e){if(!bf(t))return;const n=e instanceof FormData?e:JSON.stringify(e,Mx);return t==="delete"&&n==="{}"?void 0:n}function hE(t,e){const n=new Headers(t==null?void 0:t.headers),r=new Headers(e==null?void 0:e.headers);for(const a of r.keys()){const o=r.get(a);o!=null&&n.set(a,o)}return{...t,...e,headers:n}}function pE(t){var p,h;const e=Object.assign(Array.isArray(t.payload)?[]:{},t.payload),n=cE(t.path,e),r=uE(t.method,e,t.queryParams),a=fE(t.method,e),o=bf(t.method)?dE(a,(p=t.init)==null?void 0:p.headers):new Headers((h=t.init)==null?void 0:h.headers),c=t.baseUrl+n+r,d={...t.init,method:t.method.toUpperCase(),headers:o,body:a};return{url:c,init:d}}async function mE(t){if(t.status===204)return;const e=t.headers.get("content-type"),n=await t.text();if(e&&e.includes("application/json"))return JSON.parse(n,qd);try{return JSON.parse(n,qd)}catch{return n}}async function gE(t,e){const n=await fetch(t,e),r=await mE(n),a={headers:n.headers,url:n.url,ok:n.ok,status:n.status,statusText:n.statusText,data:r};if(a.ok)return a;throw new Nl(a)}function yE(t,e){const n=async(r,a,o)=>{if(t==null||r===t.length)return e(a,o);const c=t[r];return await c(a,o,(d,p)=>n(r+1,d,p))};return(r,a)=>n(0,r,a)}async function xE(t){const{url:e,init:n}=pE(t);return await t.fetch(e,n)}function vE(t){const e=async(n,r)=>{try{return await t(n,r)}catch(a){throw a instanceof Nl?new e.Error(a):a}};return e.Error=class extends Nl{constructor(n){super(n),Object.setPrototypeOf(this,new.target.prototype)}getActualType(){return{status:this.status,data:this.data}}},e}function bE(){let t="",e={};const n=[],r=yE(n,gE);return{configure:a=>{t=a.baseUrl||"",e=a.init||{},n.splice(0),n.push(...a.use||[])},use:a=>n.push(a),path:a=>({method:o=>({create:(c=>vE((d,p)=>xE({baseUrl:t||"",path:a,method:o,queryParams:Object.keys(c||{}),payload:d,init:hE(e,p),fetch:r})))})})}}const wE={for:()=>bE()},_E=200;class Ua extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class wf extends Ua{static forResponse(e){const n=`${e.status}`,r=e.statusText?`(${e.statusText})`:"(Unrecognized Status Code)",a=`${n} ${r}`.trim(),o=e.data?JSON.stringify(e.data,null,2):null;let c="";o&&(c=o.length<=_E?o:o.slice(0,-4)+" ...");const d=`Raw response content:
${c}`;return new wf(`Unexpected Response: ${a}
${d}`)}}class ul extends Ua{}class SE extends Ua{}class EE extends Ua{constructor(e,n){super(e);const r=Number(n);if(isNaN(r))throw new Ua(`Invalid retryAfter value: ${n}`);this.retry_after=r,Object.setPrototypeOf(this,new.target.prototype)}}function TE(t){return{createShardKey:t.path("/collections/{collection_name}/shards").method("put").create({timeout:!0}),deleteShardKey:t.path("/collections/{collection_name}/shards/delete").method("post").create({timeout:!0}),root:t.path("/").method("get").create(),telemetry:t.path("/telemetry").method("get").create(),metrics:t.path("/metrics").method("get").create(),getLocks:t.path("/locks").method("get").create(),postLocks:t.path("/locks").method("post").create(),healthz:t.path("/healthz").method("get").create(),livez:t.path("/livez").method("get").create(),readyz:t.path("/readyz").method("get").create(),getIssues:t.path("/issues").method("get").create(),clearIssues:t.path("/issues").method("delete").create(),clusterStatus:t.path("/cluster").method("get").create(),recoverCurrentPeer:t.path("/cluster/recover").method("post").create(),removePeer:t.path("/cluster/peer/{peer_id}").method("delete").create({force:!0}),getCollections:t.path("/collections").method("get").create(),getCollection:t.path("/collections/{collection_name}").method("get").create(),createCollection:t.path("/collections/{collection_name}").method("put").create({timeout:!0}),deleteCollection:t.path("/collections/{collection_name}").method("delete").create({timeout:!0}),updateCollection:t.path("/collections/{collection_name}").method("patch").create({timeout:!0}),updateAliases:t.path("/collections/aliases").method("post").create({timeout:!0}),createFieldIndex:t.path("/collections/{collection_name}/index").method("put").create({wait:!0,ordering:!0}),collectionExists:t.path("/collections/{collection_name}/exists").method("get").create(),deleteFieldIndex:t.path("/collections/{collection_name}/index/{field_name}").method("delete").create({wait:!0,ordering:!0}),collectionClusterInfo:t.path("/collections/{collection_name}/cluster").method("get").create(),updateCollectionCluster:t.path("/collections/{collection_name}/cluster").method("post").create({timeout:!0}),getCollectionAliases:t.path("/collections/{collection_name}/aliases").method("get").create(),getCollectionsAliases:t.path("/aliases").method("get").create(),recoverFromUploadedSnapshot:t.path("/collections/{collection_name}/snapshots/upload").method("post").create({wait:!0,priority:!0,checksum:!0}),recoverFromSnapshot:t.path("/collections/{collection_name}/snapshots/recover").method("put").create({wait:!0}),listSnapshots:t.path("/collections/{collection_name}/snapshots").method("get").create(),createSnapshot:t.path("/collections/{collection_name}/snapshots").method("post").create({wait:!0}),getSnapshot:t.path("/collections/{collection_name}/snapshots/{snapshot_name}").method("get").create(),deleteSnapshot:t.path("/collections/{collection_name}/snapshots/{snapshot_name}").method("delete").create({wait:!0}),listFullSnapshots:t.path("/snapshots").method("get").create(),createFullSnapshot:t.path("/snapshots").method("post").create({wait:!0}),getFullSnapshot:t.path("/snapshots/{snapshot_name}").method("get").create(),deleteFullSnapshot:t.path("/snapshots/{snapshot_name}").method("delete").create({wait:!0}),recoverShardFromUploadedSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/upload").method("post").create({wait:!0,priority:!0,checksum:!0}),recoverShardFromSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/recover").method("put").create({wait:!0}),listShardSnapshots:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots").method("get").create(),createShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots").method("post").create({wait:!0}),getShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/{snapshot_name}").method("get").create(),deleteShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/{snapshot_name}").method("delete").create({wait:!0}),getPoint:t.path("/collections/{collection_name}/points/{id}").method("get").create(),upsertPoints:t.path("/collections/{collection_name}/points").method("put").create({wait:!0,ordering:!0}),getPoints:t.path("/collections/{collection_name}/points").method("post").create({consistency:!0,timeout:!0}),deletePoints:t.path("/collections/{collection_name}/points/delete").method("post").create({wait:!0,ordering:!0}),updateVectors:t.path("/collections/{collection_name}/points/vectors").method("put").create({wait:!0,ordering:!0}),deleteVectors:t.path("/collections/{collection_name}/points/vectors/delete").method("post").create({wait:!0,ordering:!0}),overwritePayload:t.path("/collections/{collection_name}/points/payload").method("put").create({wait:!0,ordering:!0}),setPayload:t.path("/collections/{collection_name}/points/payload").method("post").create({wait:!0,ordering:!0}),deletePayload:t.path("/collections/{collection_name}/points/payload/delete").method("post").create({wait:!0,ordering:!0}),clearPayload:t.path("/collections/{collection_name}/points/payload/clear").method("post").create({wait:!0,ordering:!0}),batchUpdate:t.path("/collections/{collection_name}/points/batch").method("post").create({wait:!0,ordering:!0}),scrollPoints:t.path("/collections/{collection_name}/points/scroll").method("post").create({consistency:!0,timeout:!0}),searchPoints:t.path("/collections/{collection_name}/points/search").method("post").create({consistency:!0,timeout:!0}),searchBatchPoints:t.path("/collections/{collection_name}/points/search/batch").method("post").create({consistency:!0,timeout:!0}),searchPointGroups:t.path("/collections/{collection_name}/points/search/groups").method("post").create({consistency:!0,timeout:!0}),recommendPoints:t.path("/collections/{collection_name}/points/recommend").method("post").create({consistency:!0,timeout:!0}),recommendBatchPoints:t.path("/collections/{collection_name}/points/recommend/batch").method("post").create({consistency:!0,timeout:!0}),recommendPointGroups:t.path("/collections/{collection_name}/points/recommend/groups").method("post").create({consistency:!0,timeout:!0}),discoverPoints:t.path("/collections/{collection_name}/points/discover").method("post").create({consistency:!0,timeout:!0}),discoverBatchPoints:t.path("/collections/{collection_name}/points/discover/batch").method("post").create({consistency:!0,timeout:!0}),countPoints:t.path("/collections/{collection_name}/points/count").method("post").create({timeout:!0}),facet:t.path("/collections/{collection_name}/facet").method("post").create({timeout:!0,consistency:!0}),queryPoints:t.path("/collections/{collection_name}/points/query").method("post").create({consistency:!0,timeout:!0}),queryBatchPoints:t.path("/collections/{collection_name}/points/query/batch").method("post").create({consistency:!0,timeout:!0}),queryPointsGroups:t.path("/collections/{collection_name}/points/query/groups").method("post").create({consistency:!0,timeout:!0}),searchMatrixPairs:t.path("/collections/{collection_name}/points/search/matrix/pairs").method("post").create({consistency:!0,timeout:!0}),searchMatrixOffsets:t.path("/collections/{collection_name}/points/search/matrix/offsets").method("post").create({consistency:!0,timeout:!0})}}function NE(t,e){const n=CE(t,e);return TE(n)}function CE(t,{headers:e,timeout:n,connections:r}){const a=[];Number.isFinite(n)&&a.push(async(c,d,p)=>{const h=new AbortController,x=setTimeout(()=>h.abort(),n);try{return await p(c,Object.assign(d,{signal:h.signal}))}catch(v){throw v instanceof Error&&v.name==="AbortError"?new SE(v.message):v}finally{clearTimeout(x)}}),a.push(async(c,d,p)=>{var x;let h;try{if(h=await p(c,d),h.status===200||h.status===201)return h}catch(v){if(v instanceof Nl&&v.status===429){const w=(x=v.headers.get("retry-after"))==null?void 0:x[0];if(w)throw new EE(v.message,w)}throw v}throw wf.forResponse(h)});const o=wE.for();return o.configure({baseUrl:t,init:{headers:e,dispatcher:void 0},use:a}),o}const _d="1.15.1",Bd={parseVersion(t){if(!t)throw new Error("Version is null");let e,n;if([e,n]=t.split(".",2),e=parseInt(e,10),n=parseInt(n,10),isNaN(e)||isNaN(n))throw new Error(`Unable to parse version, expected format: x.y[.z], found: ${t}`);return{major:e,minor:n}},isCompatible(t,e){if(!t||!e)return console.debug(`Unable to compare versions with null values. Client: ${t}, Server: ${e}`),!1;if(t===e)return!0;try{const n=Bd.parseVersion(t),r=Bd.parseVersion(e);return n.major===r.major&&Math.abs(n.minor-r.minor)<=1}catch(n){return console.debug(`Unable to compare versions: ${n}`),!1}}};class AE{constructor({url:e,host:n,apiKey:r,https:a,prefix:o,port:c=6333,timeout:d=3e5,checkCompatibility:p=!0,...h}={}){if(this._https=a??typeof r=="string",this._scheme=this._https?"https":"http",this._prefix=o??"",this._prefix.length>0&&!this._prefix.startsWith("/")&&(this._prefix=`/${this._prefix}`),e&&n)throw new ul(`Only one of \`url\`, \`host\` params can be set. Url is ${e}, host is ${n}`);if(n&&(n.startsWith("http://")||n.startsWith("https://")||/:\d+$/.test(n)))throw new ul("The `host` param is not expected to contain neither protocol (http:// or https://) nor port (:6333).\nTry to use the `url` parameter instead.");if(e){if(!(e.startsWith("http://")||e.startsWith("https://")))throw new ul("The `url` param expected to contain a valid URL starting with a protocol (http:// or https://).");const N=new URL(e);if(this._host=N.hostname,this._port=N.port?Number(N.port):c,this._scheme=N.protocol.replace(":",""),this._prefix.length>0&&N.pathname!=="/")throw new ul(`Prefix can be set either in \`url\` or in \`prefix\`.
url is ${e}, prefix is ${N.pathname}`)}else this._port=c,this._host=n??"127.0.0.1";const x=new Headers([["user-agent","qdrant-js/"+String(_d)]]),v=h.headers??{};Object.keys(v).forEach(N=>{v[N]&&x.set(N,String(v[N]))}),typeof r=="string"&&(this._scheme==="http"&&console.warn("Api key is used with unsecure connection."),x.set("api-key",r));const w=this._port?`${this._host}:${this._port}`:this._host;this._restUri=`${this._scheme}://${w}${this._prefix}`;const _=h.maxConnections,E={headers:x,timeout:d,connections:_};this._openApiClient=NE(this._restUri,E),p&&this._openApiClient.root({}).then(N=>{const I=N.data.version;Bd.isCompatible(_d,I)||console.warn(`Client version ${_d} is incompatible with server version ${I}. Major versions should match and minor version difference must not exceed 1. Set checkCompatibility=false to skip version check.`)}).catch(()=>{console.warn("Failed to obtain server version. Unable to check client-server compatibility. Set checkCompatibility=false to skip version check.")})}api(){return this._openApiClient}async searchBatch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.searchBatchPoints({collection_name:e,consistency:r,timeout:a,searches:n});return ve(o.data.result).orThrow("Search batch returned empty")}async search(e,{shard_key:n,vector:r,limit:a=10,offset:o=0,filter:c,params:d,with_payload:p=!0,with_vector:h=!1,score_threshold:x,consistency:v,timeout:w}){const _=await this._openApiClient.searchPoints({collection_name:e,consistency:v,timeout:w,shard_key:n,vector:r,limit:a,offset:o,filter:c,params:d,with_payload:p,with_vector:h,score_threshold:x});return ve(_.data.result).orThrow("Search returned empty")}async recommendBatch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.recommendBatchPoints({collection_name:e,searches:n,consistency:r,timeout:a});return ve(o.data.result).orElse([])}async recommend_batch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.recommendBatchPoints({collection_name:e,searches:n,consistency:r,timeout:a});return ve(o.data.result).orElse([])}async recommend(e,{shard_key:n,positive:r,negative:a,strategy:o,filter:c,params:d,limit:p=10,offset:h=0,with_payload:x=!0,with_vector:v=!1,score_threshold:w,using:_,lookup_from:E,consistency:N,timeout:I}){const P=await this._openApiClient.recommendPoints({collection_name:e,limit:p,shard_key:n,positive:r,negative:a,strategy:o,filter:c,params:d,offset:h,with_payload:x,with_vector:v,score_threshold:w,using:_,lookup_from:E,consistency:N,timeout:I});return ve(P.data.result).orThrow("Recommend points API returned empty")}async scroll(e,{shard_key:n,filter:r,consistency:a,timeout:o,limit:c=10,offset:d,with_payload:p=!0,with_vector:h=!1,order_by:x}={}){const v=await this._openApiClient.scrollPoints({collection_name:e,shard_key:n,limit:c,offset:d,filter:r,with_payload:p,with_vector:h,order_by:x,consistency:a,timeout:o});return ve(v.data.result).orThrow("Scroll points API returned empty")}async count(e,{shard_key:n,filter:r,exact:a=!0,timeout:o}={}){const c=await this._openApiClient.countPoints({collection_name:e,shard_key:n,filter:r,exact:a,timeout:o});return ve(c.data.result).orThrow("Count points returned empty")}async collectionClusterInfo(e){const n=await this._openApiClient.collectionClusterInfo({collection_name:e});return ve(n.data.result).orThrow("Collection cluster info returned empty")}async updateCollectionCluster(e,{timeout:n,...r}){const a=await this._openApiClient.updateCollectionCluster({collection_name:e,timeout:n,...r});return ve(a.data.result).orThrow("Update collection cluster returned empty")}async updateVectors(e,{wait:n=!0,ordering:r,points:a,shard_key:o}){const c=await this._openApiClient.updateVectors({collection_name:e,wait:n,ordering:r,points:a,shard_key:o});return ve(c.data.result).orThrow("Update vectors returned empty")}async deleteVectors(e,{wait:n=!0,ordering:r,points:a,filter:o,vector:c,shard_key:d}){const p=await this._openApiClient.deleteVectors({collection_name:e,wait:n,ordering:r,points:a,filter:o,vector:c,shard_key:d});return ve(p.data.result).orThrow("Delete vectors returned empty")}async searchPointGroups(e,{consistency:n,timeout:r,shard_key:a,vector:o,filter:c,params:d,with_payload:p=null,with_vector:h=null,score_threshold:x,group_by:v,group_size:w,limit:_}){const E=await this._openApiClient.searchPointGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,vector:o,filter:c,params:d,with_payload:p,with_vector:h,score_threshold:x,group_by:v,group_size:w,limit:_});return ve(E.data.result).orThrow("Search point groups returned empty")}async recommendPointGroups(e,{consistency:n,timeout:r,shard_key:a,positive:o,strategy:c,negative:d=[],filter:p,params:h,with_payload:x=null,with_vector:v=null,score_threshold:w,using:_=null,lookup_from:E=null,group_by:N,group_size:I,limit:P}){const U=await this._openApiClient.recommendPointGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,positive:o,negative:d,strategy:c,filter:p,params:h,with_payload:x,with_vector:v,score_threshold:w,using:_,lookup_from:E,group_by:N,group_size:I,limit:P});return ve(U.data.result).orThrow("Recommend point groups API returned empty")}async upsert(e,{wait:n=!0,ordering:r,...a}){const o=await this._openApiClient.upsertPoints({collection_name:e,wait:n,ordering:r,...a});return ve(o.data.result).orThrow("Upsert returned empty")}async retrieve(e,{shard_key:n,ids:r,with_payload:a=!0,with_vector:o,consistency:c,timeout:d}){const p=await this._openApiClient.getPoints({collection_name:e,shard_key:n,ids:r,with_payload:a,with_vector:o,consistency:c,timeout:d});return ve(p.data.result).orThrow("Retrieve API returned empty")}async delete(e,{wait:n,ordering:r,...a}){const o=await this._openApiClient.deletePoints({collection_name:e,wait:n,ordering:r,...a});return ve(o.data.result).orThrow("Delete points returned empty")}async setPayload(e,{payload:n,points:r,filter:a,shard_key:o,key:c,ordering:d,wait:p=!0}){const h=await this._openApiClient.setPayload({collection_name:e,payload:n,points:r,filter:a,shard_key:o,key:c,wait:p,ordering:d});return ve(h.data.result).orThrow("Set payload returned empty")}async overwritePayload(e,{ordering:n,payload:r,points:a,filter:o,shard_key:c,key:d,wait:p=!0}){const h=await this._openApiClient.overwritePayload({collection_name:e,payload:r,points:a,filter:o,shard_key:c,key:d,wait:p,ordering:n});return ve(h.data.result).orThrow("Overwrite payload returned empty")}async deletePayload(e,{ordering:n,keys:r,points:a,filter:o,shard_key:c,wait:d=!0}){const p=await this._openApiClient.deletePayload({collection_name:e,keys:r,points:a,filter:o,shard_key:c,wait:d,ordering:n});return ve(p.data.result).orThrow("Delete payload returned empty")}async clearPayload(e,{ordering:n,wait:r=!0,...a}){const o=await this._openApiClient.clearPayload({collection_name:e,wait:r,ordering:n,...a});return ve(o.data.result).orThrow("Clear payload returned empty")}async updateCollectionAliases({actions:e,timeout:n}){const r=await this._openApiClient.updateAliases({actions:e,timeout:n});return ve(r.data.result).orThrow("Update aliases returned empty")}async getCollectionAliases(e){const n=await this._openApiClient.getCollectionAliases({collection_name:e});return ve(n.data.result).orThrow("Get collection aliases returned empty")}async getAliases(){const e=await this._openApiClient.getCollectionsAliases({});return ve(e.data.result).orThrow("Get aliases returned empty")}async getCollections(){const e=await this._openApiClient.getCollections({});return ve(e.data.result).orThrow("Get collections returned empty")}async getCollection(e){const n=await this._openApiClient.getCollection({collection_name:e});return ve(n.data.result).orThrow("Get collection returned empty")}async updateCollection(e,n){const r=await this._openApiClient.updateCollection({collection_name:e,...n});return ve(r.data.result).orThrow("Update collection returned empty")}async deleteCollection(e,n){const r=await this._openApiClient.deleteCollection({collection_name:e,...n});return ve(r.data.result).orThrow("Delete collection returned empty")}async createCollection(e,{timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N}){const I=await this._openApiClient.createCollection({collection_name:e,timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N});return ve(I.data.result).orThrow("Create collection returned empty")}async recreateCollection(e,{timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N}){ve(await this._openApiClient.deleteCollection({collection_name:e,timeout:n})).get("ok").orThrow("Delete collection returned failed");const I=await this._openApiClient.createCollection({collection_name:e,timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N});return ve(I).orThrow("Create collection returned empty")}async createPayloadIndex(e,{wait:n,ordering:r,field_name:a,field_schema:o}){const c=await this._openApiClient.createFieldIndex({collection_name:e,field_name:a,field_schema:o,wait:n,ordering:r});return ve(c.data.result).orThrow("Create field index returned empty")}async deletePayloadIndex(e,n,{wait:r=!0,ordering:a}={}){const o=await this._openApiClient.deleteFieldIndex({collection_name:e,field_name:n,wait:r,ordering:a});return ve(o.data.result).orThrow("Delete field index returned empty")}async listSnapshots(e){const n=await this._openApiClient.listSnapshots({collection_name:e});return ve(n.data.result).orThrow("List snapshots API returned empty")}async createSnapshot(e,n){const r=await this._openApiClient.createSnapshot({collection_name:e,...n});return ve(r.data.result).orNull()}async deleteSnapshot(e,n,r){const a=await this._openApiClient.deleteSnapshot({collection_name:e,snapshot_name:n,...r});return ve(a.data.result).orThrow("Delete snapshot API returned empty")}async listFullSnapshots(){const e=await this._openApiClient.listFullSnapshots({});return ve(e.data.result).orThrow("List full snapshots API returned empty")}async createFullSnapshot(e){const n=await this._openApiClient.createFullSnapshot(e??{});return ve(n.data.result).orThrow("Create full snapshot API returned empty")}async deleteFullSnapshot(e,n){const r=await this._openApiClient.deleteFullSnapshot({snapshot_name:e,...n});return ve(r.data.result).orThrow("Delete full snapshot API returned empty")}async recoverSnapshot(e,{location:n,priority:r,checksum:a,api_key:o}){const c=await this._openApiClient.recoverFromSnapshot({collection_name:e,location:n,priority:r,checksum:a,api_key:o});return ve(c.data.result).orThrow("Recover from snapshot API returned empty")}async lockStorage(e){const n=await this._openApiClient.postLocks({write:!0,error_message:e});return ve(n.data.result).orThrow("Lock storage returned empty")}async unlockStorage(){const e=await this._openApiClient.postLocks({write:!1});return ve(e.data.result).orThrow("Post locks returned empty")}async getLocks(){const e=await this._openApiClient.getLocks({});return ve(e.data.result).orThrow("Get locks returned empty")}async batchUpdate(e,{wait:n=!0,ordering:r,...a}){const o=await this._openApiClient.batchUpdate({collection_name:e,wait:n,ordering:r,...a});return ve(o.data.result).orThrow("Batch update returned empty")}async recoverShardFromSnapshot(e,n,{wait:r=!0,...a}){const o=await this._openApiClient.recoverShardFromSnapshot({collection_name:e,shard_id:n,wait:r,...a});return ve(o.data.result).orThrow("Recover shard from snapshot returned empty")}async listShardSnapshots(e,n){const r=await this._openApiClient.listShardSnapshots({collection_name:e,shard_id:n});return ve(r.data.result).orThrow("List shard snapshots returned empty")}async createShardSnapshot(e,n,{wait:r=!0}){const a=await this._openApiClient.createShardSnapshot({collection_name:e,shard_id:n,wait:r});return ve(a.data.result).orThrow("Create shard snapshot returned empty")}async deleteShardSnapshot(e,n,r,{wait:a=!0}){const o=await this._openApiClient.deleteShardSnapshot({collection_name:e,shard_id:n,snapshot_name:r,wait:a});return ve(o.data.result).orThrow("Create shard snapshot returned empty")}async createShardKey(e,{shard_key:n,shards_number:r,replication_factor:a,placement:o,timeout:c}){const d=await this._openApiClient.createShardKey({collection_name:e,shard_key:n,shards_number:r,replication_factor:a,placement:o,timeout:c});return ve(d.data.result).orThrow("Create shard key returned empty")}async deleteShardKey(e,{shard_key:n,timeout:r}){const a=await this._openApiClient.deleteShardKey({collection_name:e,shard_key:n,timeout:r});return ve(a.data.result).orThrow("Create shard key returned empty")}async discoverPoints(e,{consistency:n,timeout:r,shard_key:a,target:o,context:c,params:d,limit:p,offset:h,with_payload:x,with_vector:v,using:w,lookup_from:_}){const E=await this._openApiClient.discoverPoints({collection_name:e,consistency:n,timeout:r,shard_key:a,target:o,context:c,params:d,limit:p,offset:h,with_payload:x,with_vector:v,using:w,lookup_from:_});return ve(E.data.result).orThrow("Discover points returned empty")}async discoverBatchPoints(e,{consistency:n,timeout:r,searches:a}){const o=await this._openApiClient.discoverBatchPoints({collection_name:e,consistency:n,timeout:r,searches:a});return ve(o.data.result).orThrow("Discover batch points returned empty")}async versionInfo(){const e=await this._openApiClient.root({});return ve(e.data).orThrow("Version Info returned empty")}async collectionExists(e){const n=await this._openApiClient.collectionExists({collection_name:e});return ve(n.data.result).orThrow("Collection exists returned empty")}async query(e,{consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,limit:v,offset:w,with_vector:_,with_payload:E,lookup_from:N}){const I=await this._openApiClient.queryPoints({collection_name:e,consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,limit:v,offset:w,with_vector:_,with_payload:E,lookup_from:N});return ve(I.data.result).orThrow("Query points returned empty")}async queryBatch(e,{consistency:n,timeout:r,searches:a}){const o=await this._openApiClient.queryBatchPoints({collection_name:e,consistency:n,timeout:r,searches:a});return ve(o.data.result).orThrow("Query points returned empty")}async queryGroups(e,{consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,with_vector:v,with_payload:w,group_by:_,group_size:E,limit:N,with_lookup:I}){const P=await this._openApiClient.queryPointsGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,with_vector:v,with_payload:w,group_by:_,group_size:E,limit:N,with_lookup:I});return ve(P.data.result).orThrow("Query groups returned empty")}async facet(e,{consistency:n,timeout:r,shard_key:a,key:o,limit:c,filter:d,exact:p}){const h=await this._openApiClient.facet({collection_name:e,consistency:n,timeout:r,shard_key:a,key:o,limit:c,filter:d,exact:p});return ve(h.data.result).orThrow("Facet returned empty")}async searchMatrixPairs(e,{consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p}){const h=await this._openApiClient.searchMatrixPairs({collection_name:e,consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p});return ve(h.data.result).orThrow("Search points matrix pairs returned empty")}async searchMatrixOffsets(e,{consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p}){const h=await this._openApiClient.searchMatrixOffsets({collection_name:e,consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p});return ve(h.data.result).orThrow("Search points matrix offsets returned empty")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let IE,RE;function DE(){return{geminiUrl:IE,vertexUrl:RE}}function ME(t,e,n,r){var a,o;if(!(t!=null&&t.baseUrl)){const c=DE();return e?(a=c.vertexUrl)!==null&&a!==void 0?a:n:(o=c.geminiUrl)!==null&&o!==void 0?o:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ps{}function fe(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,a)=>{if(Object.prototype.hasOwnProperty.call(e,a)){const o=e[a];return o!=null?String(o):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function g(t,e,n){for(let o=0;o<e.length-1;o++){const c=e[o];if(c.endsWith("[]")){const d=c.slice(0,-2);if(!(d in t))if(Array.isArray(n))t[d]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(t[d])){const p=t[d];if(Array.isArray(n))for(let h=0;h<p.length;h++){const x=p[h];g(x,e.slice(o+1),n[h])}else for(const h of p)g(h,e.slice(o+1),n)}return}else if(c.endsWith("[0]")){const d=c.slice(0,-3);d in t||(t[d]=[{}]);const p=t[d];g(p[0],e.slice(o+1),n);return}(!t[c]||typeof t[c]!="object")&&(t[c]={}),t=t[c]}const r=e[e.length-1],a=t[r];if(a!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===a)return;if(typeof a=="object"&&typeof n=="object"&&a!==null&&n!==null)Object.assign(a,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function m(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const a=e[r];if(a.endsWith("[]")){const o=a.slice(0,-2);if(o in t){const c=t[o];return Array.isArray(c)?c.map(d=>m(d,e.slice(r+1),n)):n}else return n}else t=t[a]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function PE(t,e){for(const[n,r]of Object.entries(e)){const a=n.split("."),o=r.split("."),c=new Set;let d=-1;for(let p=0;p<a.length;p++)if(a[p]==="*"){d=p;break}if(d!==-1&&o.length>d)for(let p=d;p<o.length;p++){const h=o[p];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&c.add(h)}Vd(t,a,o,0,c)}}function Vd(t,e,n,r,a){if(r>=e.length||typeof t!="object"||t===null)return;const o=e[r];if(o.endsWith("[]")){const c=o.slice(0,-2),d=t;if(c in d&&Array.isArray(d[c]))for(const p of d[c])Vd(p,e,n,r+1,a)}else if(o==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const c=t,d=Object.keys(c).filter(h=>!h.startsWith("_")&&!a.has(h)),p={};for(const h of d)p[h]=c[h];for(const[h,x]of Object.entries(p)){const v=[];for(const w of n.slice(r))w==="*"?v.push(h):v.push(w);g(c,v,x)}for(const h of d)delete c[h]}}else{const c=t;o in c&&Vd(c[o],e,n,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _f(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function kE(t){const e={},n=m(t,["operationName"]);n!=null&&g(e,["operationName"],n);const r=m(t,["resourceName"]);return r!=null&&g(e,["_url","resourceName"],r),e}function UE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response","generateVideoResponse"]);return c!=null&&g(e,["response"],OE(c)),e}function jE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],LE(c)),e}function OE(t){const e={},n=m(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>qE(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function LE(t){const e={},n=m(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>BE(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function qE(t){const e={},n=m(t,["video"]);return n!=null&&g(e,["video"],$E(n)),e}function BE(t){const e={},n=m(t,["_self"]);return n!=null&&g(e,["video"],JE(n)),e}function VE(t){const e={},n=m(t,["operationName"]);return n!=null&&g(e,["_url","operationName"],n),e}function GE(t){const e={},n=m(t,["operationName"]);return n!=null&&g(e,["_url","operationName"],n),e}function HE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],zE(c)),e}function zE(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function Px(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],FE(c)),e}function FE(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function $E(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["encodedVideo"]);r!=null&&g(e,["videoBytes"],_f(r));const a=m(t,["encoding"]);return a!=null&&g(e,["mimeType"],a),e}function JE(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["uri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["videoBytes"],_f(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var pg;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(pg||(pg={}));var mg;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(mg||(mg={}));var gg;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(gg||(gg={}));var Re;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Re||(Re={}));var yg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(yg||(yg={}));var xg;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(xg||(xg={}));var vg;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(vg||(vg={}));var bg;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(bg||(bg={}));var wg;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(wg||(wg={}));var _g;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(_g||(_g={}));var Sg;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Sg||(Sg={}));var Eg;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Eg||(Eg={}));var Tg;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(Tg||(Tg={}));var Ng;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Ng||(Ng={}));var Cg;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Cg||(Cg={}));var Ag;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Ag||(Ag={}));var Ig;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(Ig||(Ig={}));var Rg;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Rg||(Rg={}));var Cl;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Cl||(Cl={}));var Dg;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Dg||(Dg={}));var Mg;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Mg||(Mg={}));var Pg;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Pg||(Pg={}));var Gd;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Gd||(Gd={}));var kg;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(kg||(kg={}));var Ug;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Ug||(Ug={}));var jg;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(jg||(jg={}));var Og;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Og||(Og={}));var Lg;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Lg||(Lg={}));var qg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(qg||(qg={}));var Bg;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Bg||(Bg={}));var Vg;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Vg||(Vg={}));var Gg;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Gg||(Gg={}));var Hg;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Hg||(Hg={}));var zg;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(zg||(zg={}));var Fg;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Fg||(Fg={}));var $g;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})($g||($g={}));var Jg;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Jg||(Jg={}));var Yg;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Yg||(Yg={}));var Kg;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Kg||(Kg={}));var Qg;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Qg||(Qg={}));var Xg;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Xg||(Xg={}));var Wg;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Wg||(Wg={}));var Zg;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(Zg||(Zg={}));var ey;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(ey||(ey={}));var ty;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(ty||(ty={}));var ny;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(ny||(ny={}));var sy;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(sy||(sy={}));var ry;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(ry||(ry={}));var iy;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(iy||(iy={}));var ay;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(ay||(ay={}));var oy;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(oy||(oy={}));var ly;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(ly||(ly={}));var vi;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(vi||(vi={}));class Hd{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Ia{get text(){var e,n,r,a,o,c,d,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",x=!1;const v=[];for(const w of(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[_,E]of Object.entries(w))_!=="text"&&_!=="thought"&&_!=="thoughtSignature"&&(E!==null||E!==void 0)&&v.push(_);if(typeof w.text=="string"){if(typeof w.thought=="boolean"&&w.thought)continue;x=!0,h+=w.text}}return v.length>0&&console.warn(`there are non-text parts ${v} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),x?h:void 0}get data(){var e,n,r,a,o,c,d,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const x=[];for(const v of(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[w,_]of Object.entries(v))w!=="inlineData"&&(_!==null||_!==void 0)&&x.push(w);v.inlineData&&typeof v.inlineData.data=="string"&&(h+=atob(v.inlineData.data))}return x.length>0&&console.warn(`there are non-data parts ${x} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,n,r,a,o,c,d,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(x=>x.functionCall).map(x=>x.functionCall).filter(x=>x!==void 0);if((h==null?void 0:h.length)!==0)return h}get executableCode(){var e,n,r,a,o,c,d,p,h;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const x=(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(v=>v.executableCode).map(v=>v.executableCode).filter(v=>v!==void 0);if((x==null?void 0:x.length)!==0)return(h=x==null?void 0:x[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,n,r,a,o,c,d,p,h;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const x=(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(v=>v.codeExecutionResult).map(v=>v.codeExecutionResult).filter(v=>v!==void 0);if((x==null?void 0:x.length)!==0)return(h=x==null?void 0:x[0])===null||h===void 0?void 0:h.output}}class cy{}class uy{}class YE{}class KE{}class QE{}class XE{}class dy{}class fy{}class hy{}class WE{}class Al{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Al;let a;const o=e;return n?a=jE(o):a=UE(o),Object.assign(r,a),r}}class py{}class my{}class gy{}class ZE{}class eT{}class tT{}class Sf{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Sf,o=HE(e);return Object.assign(r,o),r}}class nT{}class sT{}class rT{}class yy{}class iT{get text(){var e,n,r;let a="",o=!1;const c=[];for(const d of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[p,h]of Object.entries(d))p!=="text"&&p!=="thought"&&h!==null&&c.push(p);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;o=!0,a+=d.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?a:void 0}get data(){var e,n,r;let a="";const o=[];for(const c of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[d,p]of Object.entries(c))d!=="inlineData"&&p!==null&&o.push(d);c.inlineData&&typeof c.inlineData.data=="string"&&(a+=atob(c.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class aT{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Ef{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Ef,o=Px(e);return Object.assign(r,o),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Je(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function kx(t,e){const n=Je(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function Ux(t){return Array.isArray(t)?t.map(e=>Il(e)):[Il(t)]}function Il(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function jx(t){const e=Il(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ox(t){const e=Il(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function xy(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Lx(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>xy(e)):[xy(t)]}function zd(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function vy(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function by(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Lt(t){if(t==null)throw new Error("ContentUnion is required");return zd(t)?t:{role:"user",parts:Lx(t)}}function Tf(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=Lt(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=Lt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Lt(n)):[Lt(e)]}function En(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(vy(t)||by(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Lt(t)]}const e=[],n=[],r=zd(t[0]);for(const a of t){const o=zd(a);if(o!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(a);else{if(vy(a)||by(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(a)}}return r||e.push({role:"user",parts:Lx(n)}),e}function oT(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(Re).includes(n[0].toUpperCase())?n[0].toUpperCase():Re.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(Re).includes(r.toUpperCase())?r.toUpperCase():Re.TYPE_UNSPECIFIED})}}function bi(t){const e={},n=["items"],r=["anyOf"],a=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&oT(t.type,e);for(const[c,d]of Object.entries(t))if(d!=null)if(c=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(Re).includes(d.toUpperCase())?d.toUpperCase():Re.TYPE_UNSPECIFIED}else if(n.includes(c))e[c]=bi(d);else if(r.includes(c)){const p=[];for(const h of d){if(h.type=="null"){e.nullable=!0;continue}p.push(bi(h))}e[c]=p}else if(a.includes(c)){const p={};for(const[h,x]of Object.entries(d))p[h]=bi(x);e[c]=p}else{if(c==="additionalProperties")continue;e[c]=d}return e}function Nf(t){return bi(t)}function Cf(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Af(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Ci(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=bi(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=bi(e.response));return t}function Ai(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function lT(t,e,n,r=1){const a=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:a?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:a?`${n}/${e}`:e}function ms(t,e){if(typeof e!="string")throw new Error("name must be a string");return lT(t,e,"cachedContents")}function qx(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function $s(t){return _f(t)}function cT(t){return t!=null&&typeof t=="object"&&"name"in t}function uT(t){return t!=null&&typeof t=="object"&&"video"in t}function dT(t){return t!=null&&typeof t=="object"&&"uri"in t}function Bx(t){var e;let n;if(cT(t)&&(n=t.name),!(dT(t)&&(n=t.uri,n===void 0))&&!(uT(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const a=n.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${n}`);n=a[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Vx(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function Gx(t){for(const e of["models","tunedModels","publisherModels"])if(fT(t,e))return t[e];return[]}function fT(t,e){return t!==null&&typeof t=="object"&&e in t}function hT(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function pT(t,e={}){const n=[],r=new Set;for(const a of t){const o=a.name;if(r.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);r.add(o);const c=hT(a,e);c.functionDeclarations&&n.push(...c.functionDeclarations)}return{functionDeclarations:n}}function Hx(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,a=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function mT(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function zx(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const a=n.inlinedResponses;if(!Array.isArray(a)||a.length===0)return t;let o=!1;for(const c of a){if(typeof c!="object"||c===null)continue;const p=c.response;if(typeof p!="object"||p===null)continue;if(p.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Ii(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Fx(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gT(t){const e={},n=m(t,["responsesFile"]);n!=null&&g(e,["fileName"],n);const r=m(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>JT(c))),g(e,["inlinedResponses"],o)}const a=m(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["inlinedEmbedContentResponses"],o)}return e}function yT(t){const e={},n=m(t,["predictionsFormat"]);n!=null&&g(e,["format"],n);const r=m(t,["gcsDestination","outputUriPrefix"]);r!=null&&g(e,["gcsUri"],r);const a=m(t,["bigqueryDestination","outputUri"]);return a!=null&&g(e,["bigqueryUri"],a),e}function xT(t){const e={},n=m(t,["format"]);n!=null&&g(e,["predictionsFormat"],n);const r=m(t,["gcsUri"]);r!=null&&g(e,["gcsDestination","outputUriPrefix"],r);const a=m(t,["bigqueryUri"]);if(a!=null&&g(e,["bigqueryDestination","outputUri"],a),m(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(m(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Sl(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata","displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["metadata","state"]);a!=null&&g(e,["state"],Fx(a));const o=m(t,["metadata","createTime"]);o!=null&&g(e,["createTime"],o);const c=m(t,["metadata","endTime"]);c!=null&&g(e,["endTime"],c);const d=m(t,["metadata","updateTime"]);d!=null&&g(e,["updateTime"],d);const p=m(t,["metadata","model"]);p!=null&&g(e,["model"],p);const h=m(t,["metadata","output"]);return h!=null&&g(e,["dest"],gT(zx(h))),e}function Fd(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["state"]);a!=null&&g(e,["state"],Fx(a));const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["createTime"]);c!=null&&g(e,["createTime"],c);const d=m(t,["startTime"]);d!=null&&g(e,["startTime"],d);const p=m(t,["endTime"]);p!=null&&g(e,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(e,["updateTime"],h);const x=m(t,["model"]);x!=null&&g(e,["model"],x);const v=m(t,["inputConfig"]);v!=null&&g(e,["src"],vT(v));const w=m(t,["outputConfig"]);w!=null&&g(e,["dest"],yT(zx(w)));const _=m(t,["completionStats"]);return _!=null&&g(e,["completionStats"],_),e}function vT(t){const e={},n=m(t,["instancesFormat"]);n!=null&&g(e,["format"],n);const r=m(t,["gcsSource","uris"]);r!=null&&g(e,["gcsUri"],r);const a=m(t,["bigquerySource","inputUri"]);return a!=null&&g(e,["bigqueryUri"],a),e}function bT(t,e){const n={};if(m(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(m(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=m(e,["fileName"]);r!=null&&g(n,["fileName"],r);const a=m(e,["inlinedRequests"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>$T(t,c))),g(n,["requests","requests"],o)}return n}function wT(t){const e={},n=m(t,["format"]);n!=null&&g(e,["instancesFormat"],n);const r=m(t,["gcsUri"]);r!=null&&g(e,["gcsSource","uris"],r);const a=m(t,["bigqueryUri"]);if(a!=null&&g(e,["bigquerySource","inputUri"],a),m(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function _T(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function ST(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ii(t,r)),n}function ET(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ii(t,r)),n}function TT(t){const e={},n=m(t,["content"]);n!=null&&g(e,["content"],n);const r=m(t,["citationMetadata"]);r!=null&&g(e,["citationMetadata"],NT(r));const a=m(t,["tokenCount"]);a!=null&&g(e,["tokenCount"],a);const o=m(t,["finishReason"]);o!=null&&g(e,["finishReason"],o);const c=m(t,["avgLogprobs"]);c!=null&&g(e,["avgLogprobs"],c);const d=m(t,["groundingMetadata"]);d!=null&&g(e,["groundingMetadata"],d);const p=m(t,["index"]);p!=null&&g(e,["index"],p);const h=m(t,["logprobsResult"]);h!=null&&g(e,["logprobsResult"],h);const x=m(t,["safetyRatings"]);if(x!=null){let w=x;Array.isArray(w)&&(w=w.map(_=>_)),g(e,["safetyRatings"],w)}const v=m(t,["urlContextMetadata"]);return v!=null&&g(e,["urlContextMetadata"],v),e}function NT(t){const e={},n=m(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["citations"],r)}return e}function $x(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>eN(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function CT(t,e){const n={},r=m(t,["displayName"]);if(e!==void 0&&r!=null&&g(e,["batch","displayName"],r),m(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function AT(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["dest"]);return e!==void 0&&a!=null&&g(e,["outputConfig"],xT(mT(a))),n}function wy(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["src"]);a!=null&&g(n,["batch","inputConfig"],bT(t,Hx(t,a)));const o=m(e,["config"]);return o!=null&&CT(o,n),n}function IT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],Je(t,r));const a=m(e,["src"]);a!=null&&g(n,["inputConfig"],wT(Hx(t,a)));const o=m(e,["config"]);return o!=null&&AT(o,n),n}function RT(t,e){const n={},r=m(t,["displayName"]);return e!==void 0&&r!=null&&g(e,["batch","displayName"],r),n}function DT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["src"]);a!=null&&g(n,["batch","inputConfig"],LT(t,a));const o=m(e,["config"]);return o!=null&&RT(o,n),n}function MT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ii(t,r)),n}function PT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ii(t,r)),n}function kT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);return o!=null&&g(e,["error"],o),e}function UT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);return o!=null&&g(e,["error"],o),e}function jT(t,e){const n={},r=m(e,["contents"]);if(r!=null){let o=Tf(t,r);Array.isArray(o)&&(o=o.map(c=>c)),g(n,["requests[]","request","content"],o)}const a=m(e,["config"]);return a!=null&&(g(n,["_self"],OT(a,n)),PE(n,{"requests[].*":"requests[].request.*"})),n}function OT(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["requests[]","taskType"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["requests[]","title"],a);const o=m(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&g(e,["requests[]","outputDimensionality"],o),m(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function LT(t,e){const n={},r=m(e,["fileName"]);r!=null&&g(n,["file_name"],r);const a=m(e,["inlinedRequests"]);return a!=null&&g(n,["requests"],jT(t,a)),n}function qT(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function BT(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],$x(Lt(a)));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const d=m(e,["topK"]);d!=null&&g(r,["topK"],d);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const N=m(e,["seed"]);N!=null&&g(r,["seed"],N);const I=m(e,["responseMimeType"]);I!=null&&g(r,["responseMimeType"],I);const P=m(e,["responseSchema"]);P!=null&&g(r,["responseSchema"],Nf(P));const U=m(e,["responseJsonSchema"]);if(U!=null&&g(r,["responseJsonSchema"],U),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=m(e,["safetySettings"]);if(n!==void 0&&R!=null){let ue=R;Array.isArray(ue)&&(ue=ue.map(Ce=>tN(Ce))),g(n,["safetySettings"],ue)}const A=m(e,["tools"]);if(n!==void 0&&A!=null){let ue=Ai(A);Array.isArray(ue)&&(ue=ue.map(Ce=>nN(Ci(Ce)))),g(n,["tools"],ue)}const k=m(e,["toolConfig"]);if(n!==void 0&&k!=null&&g(n,["toolConfig"],k),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const q=m(e,["cachedContent"]);n!==void 0&&q!=null&&g(n,["cachedContent"],ms(t,q));const V=m(e,["responseModalities"]);V!=null&&g(r,["responseModalities"],V);const W=m(e,["mediaResolution"]);W!=null&&g(r,["mediaResolution"],W);const J=m(e,["speechConfig"]);if(J!=null&&g(r,["speechConfig"],Cf(J)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const $=m(e,["thinkingConfig"]);$!=null&&g(r,["thinkingConfig"],$);const ce=m(e,["imageConfig"]);return ce!=null&&g(r,["imageConfig"],ce),r}function VT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(h=>TT(h))),g(e,["candidates"],p)}const a=m(t,["modelVersion"]);a!=null&&g(e,["modelVersion"],a);const o=m(t,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);const c=m(t,["responseId"]);c!=null&&g(e,["responseId"],c);const d=m(t,["usageMetadata"]);return d!=null&&g(e,["usageMetadata"],d),e}function GT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ii(t,r)),n}function HT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ii(t,r)),n}function zT(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function FT(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function $T(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["request","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let d=En(a);Array.isArray(d)&&(d=d.map(p=>$x(p))),g(n,["request","contents"],d)}const o=m(e,["metadata"]);o!=null&&g(n,["metadata"],o);const c=m(e,["config"]);return c!=null&&g(n,["request","generationConfig"],BT(t,c,m(n,["request"],{}))),n}function JT(t){const e={},n=m(t,["response"]);n!=null&&g(e,["response"],VT(n));const r=m(t,["error"]);return r!=null&&g(e,["error"],r),e}function YT(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);if(e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),m(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function KT(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);e!==void 0&&a!=null&&g(e,["_query","pageToken"],a);const o=m(t,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function QT(t){const e={},n=m(t,["config"]);return n!=null&&YT(n,e),e}function XT(t){const e={},n=m(t,["config"]);return n!=null&&KT(n,e),e}function WT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["operations"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>Sl(c))),g(e,["batchJobs"],o)}return e}function ZT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["batchPredictionJobs"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>Fd(c))),g(e,["batchJobs"],o)}return e}function eN(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],qT(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],_T(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function tN(t){const e={},n=m(t,["category"]);if(n!=null&&g(e,["category"],n),m(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(t,["threshold"]);return r!=null&&g(e,["threshold"],r),e}function nN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],zT(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],FT(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var fs;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(fs||(fs={}));class Er{constructor(e,n,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,a)}init(e,n,r){var a,o;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!r||Object.keys(r).length===0?c={config:{}}:typeof r=="object"?c=Object.assign({},r):c=r,c.config&&(c.config.pageToken=n.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(o=(a=c.config)===null||a===void 0?void 0:a.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sN extends ps{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new Er(fs.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=wy(this.apiClient,e),r=n._url,a=fe("{model}:batchGenerateContent",r),d=n.batch.inputConfig.requests,p=d.requests,h=[];for(const x of p){const v=Object.assign({},x);if(v.systemInstruction){const w=v.systemInstruction;delete v.systemInstruction;const _=v.request;_.systemInstruction=w,v.request=_}h.push(v)}return d.requests=h,delete n.config,delete n._url,delete n._query,{path:a,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const o=this.getGcsUri(e),c=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?r.dest=`${o.slice(0,-6)}/dest`:r.dest=`${o}_dest_${a}`;else if(c)r.dest=`${c}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=IT(this.apiClient,e);return d=fe("batchPredictionJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Fd(x))}else{const h=wy(this.apiClient,e);return d=fe("{model}:batchGenerateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Sl(x))}}async createEmbeddingsInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=DT(this.apiClient,e);return o=fe("{model}:asyncBatchEmbedContent",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>Sl(p))}}async get(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=HT(this.apiClient,e);return d=fe("batchPredictionJobs/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Fd(x))}else{const h=GT(this.apiClient,e);return d=fe("batches/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Sl(x))}}async cancel(e){var n,r,a,o;let c="",d={};if(this.apiClient.isVertexAI()){const p=ET(this.apiClient,e);c=fe("batchPredictionJobs/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const p=ST(this.apiClient,e);c=fe("batches/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=XT(e);return d=fe("batchPredictionJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=ZT(x),w=new yy;return Object.assign(w,v),w})}else{const h=QT(e);return d=fe("batches",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=WT(x),w=new yy;return Object.assign(w,v),w})}}async delete(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=PT(this.apiClient,e);return d=fe("batchPredictionJobs/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>UT(x))}else{const h=MT(this.apiClient,e);return d=fe("batches/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>kT(x))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rN(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function _y(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>TN(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function iN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);e!==void 0&&a!=null&&g(e,["expireTime"],a);const o=m(t,["displayName"]);e!==void 0&&o!=null&&g(e,["displayName"],o);const c=m(t,["contents"]);if(e!==void 0&&c!=null){let x=En(c);Array.isArray(x)&&(x=x.map(v=>_y(v))),g(e,["contents"],x)}const d=m(t,["systemInstruction"]);e!==void 0&&d!=null&&g(e,["systemInstruction"],_y(Lt(d)));const p=m(t,["tools"]);if(e!==void 0&&p!=null){let x=p;Array.isArray(x)&&(x=x.map(v=>NN(v))),g(e,["tools"],x)}const h=m(t,["toolConfig"]);if(e!==void 0&&h!=null&&g(e,["toolConfig"],h),m(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function aN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);e!==void 0&&a!=null&&g(e,["expireTime"],a);const o=m(t,["displayName"]);e!==void 0&&o!=null&&g(e,["displayName"],o);const c=m(t,["contents"]);if(e!==void 0&&c!=null){let v=En(c);Array.isArray(v)&&(v=v.map(w=>w)),g(e,["contents"],v)}const d=m(t,["systemInstruction"]);e!==void 0&&d!=null&&g(e,["systemInstruction"],Lt(d));const p=m(t,["tools"]);if(e!==void 0&&p!=null){let v=p;Array.isArray(v)&&(v=v.map(w=>CN(w))),g(e,["tools"],v)}const h=m(t,["toolConfig"]);e!==void 0&&h!=null&&g(e,["toolConfig"],h);const x=m(t,["kmsKeyName"]);return e!==void 0&&x!=null&&g(e,["encryption_spec","kmsKeyName"],x),n}function oN(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],kx(t,r));const a=m(e,["config"]);return a!=null&&iN(a,n),n}function lN(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],kx(t,r));const a=m(e,["config"]);return a!=null&&aN(a,n),n}function cN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],ms(t,r)),n}function uN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],ms(t,r)),n}function dN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function fN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function hN(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function pN(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const d=m(t,["responseJsonSchema"]);return d!=null&&g(e,["responseJsonSchema"],d),e}function mN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],ms(t,r)),n}function gN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],ms(t,r)),n}function yN(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function xN(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function vN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function bN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function wN(t){const e={},n=m(t,["config"]);return n!=null&&vN(n,e),e}function _N(t){const e={},n=m(t,["config"]);return n!=null&&bN(n,e),e}function SN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["cachedContents"],o)}return e}function EN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["cachedContents"],o)}return e}function TN(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],hN(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],rN(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function NN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],yN(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],xN(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function CN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>pN(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const d=m(t,["enterpriseWebSearch"]);d!=null&&g(e,["enterpriseWebSearch"],d);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function AN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);return e!==void 0&&a!=null&&g(e,["expireTime"],a),n}function IN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);return e!==void 0&&a!=null&&g(e,["expireTime"],a),n}function RN(t,e){const n={},r=m(e,["name"]);r!=null&&g(n,["_url","name"],ms(t,r));const a=m(e,["config"]);return a!=null&&AN(a,n),n}function DN(t,e){const n={},r=m(e,["name"]);r!=null&&g(n,["_url","name"],ms(t,r));const a=m(e,["config"]);return a!=null&&IN(a,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class MN extends ps{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Er(fs.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=lN(this.apiClient,e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=oN(this.apiClient,e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async get(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=gN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=mN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async delete(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=uN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=fN(x),w=new my;return Object.assign(w,v),w})}else{const h=cN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=dN(x),w=new my;return Object.assign(w,v),w})}}async update(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=DN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=RN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=_N(e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=EN(x),w=new gy;return Object.assign(w,v),w})}else{const h=wN(e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=SN(x),w=new gy;return Object.assign(w,v),w})}}}function Sy(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function lt(t){return this instanceof lt?(this.v=t,this):new lt(t)}function wi(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(_){return function(E){return Promise.resolve(E).then(_,v)}}function d(_,E){r[_]&&(a[_]=function(N){return new Promise(function(I,P){o.push([_,N,I,P])>1||p(_,N)})},E&&(a[_]=E(a[_])))}function p(_,E){try{h(r[_](E))}catch(N){w(o[0][3],N)}}function h(_){_.value instanceof lt?Promise.resolve(_.value.v).then(x,v):w(o[0][2],_)}function x(_){p("next",_)}function v(_){p("throw",_)}function w(_,E){_(E),o.shift(),o.length&&p(o[0][0],o[0][1])}}function Da(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Sy=="function"?Sy(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(d,p){c=t[o](c),a(d,p,c.done,c.value)})}}function a(o,c,d,p){Promise.resolve(p).then(function(h){o({value:h,done:d})},c)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function PN(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:Jx(n)}function Jx(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function kN(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Ey(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const a=[];let o=!0;for(;r<n&&t[r].role==="model";)a.push(t[r]),o&&!Jx(t[r])&&(o=!1),r++;o?e.push(...a):e.pop()}return e}class UN{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new jN(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class jN{constructor(e,n,r,a={},o=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=a,this.history=o,this.sendPromise=Promise.resolve(),kN(o)}async sendMessage(e){var n;await this.sendPromise;const r=Lt(e.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,c,d;const p=await a,h=(c=(o=p.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content,x=p.automaticFunctionCallingHistory,v=this.getHistory(!0).length;let w=[];x!=null&&(w=(d=x.slice(v))!==null&&d!==void 0?d:[]);const _=h?[h]:[];this.recordHistory(r,_,w)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(e){var n;await this.sendPromise;const r=Lt(e.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const o=await a;return this.processStreamResponse(o,r)}getHistory(e=!1){const n=e?Ey(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var r,a;return wi(this,arguments,function*(){var c,d,p,h;const x=[];try{for(var v=!0,w=Da(e),_;_=yield lt(w.next()),c=_.done,!c;v=!0){h=_.value,v=!1;const E=h;if(PN(E)){const N=(a=(r=E.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content;N!==void 0&&x.push(N)}yield yield lt(E)}}catch(E){d={error:E}}finally{try{!v&&!c&&(p=w.return)&&(yield lt(p.call(w)))}finally{if(d)throw d.error}}this.recordHistory(n,x)})}recordHistory(e,n,r){let a=[];n.length>0&&n.every(o=>o.role!==void 0)?a=n:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Ey(r)):this.history.push(e),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Gl extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Gl.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ON(t){const e={},n=m(t,["file"]);return n!=null&&g(e,["file"],n),e}function LN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function qN(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","file"],Bx(n)),e}function BN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function VN(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","file"],Bx(n)),e}function GN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function HN(t){const e={},n=m(t,["config"]);return n!=null&&GN(n,e),e}function zN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["files"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class FN extends ps{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Er(fs.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=HN(e);return o=fe("files",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=zN(p),x=new nT;return Object.assign(x,h),x})}}async createInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=ON(e);return o=fe("upload/v1beta/files",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=LN(p),x=new sT;return Object.assign(x,h),x})}}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=VN(e);return o=fe("files/{file}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=qN(e);return o=fe("files/{file}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=BN(p),x=new rT;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function El(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function $N(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>oC(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function JN(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function YN(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const d=m(t,["responseJsonSchema"]);return d!=null&&g(e,["responseJsonSchema"],d),e}function KN(t){const e={},n=m(t,["modelSelectionConfig"]);n!=null&&g(e,["modelConfig"],n);const r=m(t,["responseJsonSchema"]);r!=null&&g(e,["responseJsonSchema"],r);const a=m(t,["audioTimestamp"]);a!=null&&g(e,["audioTimestamp"],a);const o=m(t,["candidateCount"]);o!=null&&g(e,["candidateCount"],o);const c=m(t,["enableAffectiveDialog"]);c!=null&&g(e,["enableAffectiveDialog"],c);const d=m(t,["frequencyPenalty"]);d!=null&&g(e,["frequencyPenalty"],d);const p=m(t,["logprobs"]);p!=null&&g(e,["logprobs"],p);const h=m(t,["maxOutputTokens"]);h!=null&&g(e,["maxOutputTokens"],h);const x=m(t,["mediaResolution"]);x!=null&&g(e,["mediaResolution"],x);const v=m(t,["presencePenalty"]);v!=null&&g(e,["presencePenalty"],v);const w=m(t,["responseLogprobs"]);w!=null&&g(e,["responseLogprobs"],w);const _=m(t,["responseMimeType"]);_!=null&&g(e,["responseMimeType"],_);const E=m(t,["responseModalities"]);E!=null&&g(e,["responseModalities"],E);const N=m(t,["responseSchema"]);N!=null&&g(e,["responseSchema"],N);const I=m(t,["routingConfig"]);I!=null&&g(e,["routingConfig"],I);const P=m(t,["seed"]);P!=null&&g(e,["seed"],P);const U=m(t,["speechConfig"]);U!=null&&g(e,["speechConfig"],Yx(U));const R=m(t,["stopSequences"]);R!=null&&g(e,["stopSequences"],R);const A=m(t,["temperature"]);A!=null&&g(e,["temperature"],A);const k=m(t,["thinkingConfig"]);k!=null&&g(e,["thinkingConfig"],k);const q=m(t,["topK"]);q!=null&&g(e,["topK"],q);const V=m(t,["topP"]);if(V!=null&&g(e,["topP"],V),m(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function QN(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function XN(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function WN(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],r);const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const d=m(t,["topK"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","topK"],d);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],Af(v));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],$N(Lt(E)));const N=m(t,["tools"]);if(e!==void 0&&N!=null){let q=Ai(N);Array.isArray(q)&&(q=q.map(V=>cC(Ci(V)))),g(e,["setup","tools"],q)}const I=m(t,["sessionResumption"]);e!==void 0&&I!=null&&g(e,["setup","sessionResumption"],lC(I));const P=m(t,["inputAudioTranscription"]);e!==void 0&&P!=null&&g(e,["setup","inputAudioTranscription"],P);const U=m(t,["outputAudioTranscription"]);e!==void 0&&U!=null&&g(e,["setup","outputAudioTranscription"],U);const R=m(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&g(e,["setup","realtimeInputConfig"],R);const A=m(t,["contextWindowCompression"]);e!==void 0&&A!=null&&g(e,["setup","contextWindowCompression"],A);const k=m(t,["proactivity"]);return e!==void 0&&k!=null&&g(e,["setup","proactivity"],k),n}function ZN(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],KN(r));const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const d=m(t,["topK"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","topK"],d);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],Yx(Af(v)));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],Lt(E));const N=m(t,["tools"]);if(e!==void 0&&N!=null){let q=Ai(N);Array.isArray(q)&&(q=q.map(V=>uC(Ci(V)))),g(e,["setup","tools"],q)}const I=m(t,["sessionResumption"]);e!==void 0&&I!=null&&g(e,["setup","sessionResumption"],I);const P=m(t,["inputAudioTranscription"]);e!==void 0&&P!=null&&g(e,["setup","inputAudioTranscription"],P);const U=m(t,["outputAudioTranscription"]);e!==void 0&&U!=null&&g(e,["setup","outputAudioTranscription"],U);const R=m(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&g(e,["setup","realtimeInputConfig"],R);const A=m(t,["contextWindowCompression"]);e!==void 0&&A!=null&&g(e,["setup","contextWindowCompression"],A);const k=m(t,["proactivity"]);return e!==void 0&&k!=null&&g(e,["setup","proactivity"],k),n}function eC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],WN(a,n)),n}function tC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],ZN(a,n)),n}function nC(t){const e={},n=m(t,["musicGenerationConfig"]);return n!=null&&g(e,["musicGenerationConfig"],n),e}function sC(t){const e={},n=m(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["weightedPrompts"],r)}return e}function rC(t){const e={},n=m(t,["media"]);if(n!=null){let h=Ux(n);Array.isArray(h)&&(h=h.map(x=>El(x))),g(e,["mediaChunks"],h)}const r=m(t,["audio"]);r!=null&&g(e,["audio"],El(Ox(r)));const a=m(t,["audioStreamEnd"]);a!=null&&g(e,["audioStreamEnd"],a);const o=m(t,["video"]);o!=null&&g(e,["video"],El(jx(o)));const c=m(t,["text"]);c!=null&&g(e,["text"],c);const d=m(t,["activityStart"]);d!=null&&g(e,["activityStart"],d);const p=m(t,["activityEnd"]);return p!=null&&g(e,["activityEnd"],p),e}function iC(t){const e={},n=m(t,["media"]);if(n!=null){let h=Ux(n);Array.isArray(h)&&(h=h.map(x=>x)),g(e,["mediaChunks"],h)}const r=m(t,["audio"]);r!=null&&g(e,["audio"],Ox(r));const a=m(t,["audioStreamEnd"]);a!=null&&g(e,["audioStreamEnd"],a);const o=m(t,["video"]);o!=null&&g(e,["video"],jx(o));const c=m(t,["text"]);c!=null&&g(e,["text"],c);const d=m(t,["activityStart"]);d!=null&&g(e,["activityStart"],d);const p=m(t,["activityEnd"]);return p!=null&&g(e,["activityEnd"],p),e}function aC(t){const e={},n=m(t,["setupComplete"]);n!=null&&g(e,["setupComplete"],n);const r=m(t,["serverContent"]);r!=null&&g(e,["serverContent"],r);const a=m(t,["toolCall"]);a!=null&&g(e,["toolCall"],a);const o=m(t,["toolCallCancellation"]);o!=null&&g(e,["toolCallCancellation"],o);const c=m(t,["usageMetadata"]);c!=null&&g(e,["usageMetadata"],dC(c));const d=m(t,["goAway"]);d!=null&&g(e,["goAway"],d);const p=m(t,["sessionResumptionUpdate"]);return p!=null&&g(e,["sessionResumptionUpdate"],p),e}function oC(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],JN(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],El(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function lC(t){const e={},n=m(t,["handle"]);if(n!=null&&g(e,["handle"],n),m(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Yx(t){const e={},n=m(t,["languageCode"]);n!=null&&g(e,["languageCode"],n);const r=m(t,["voiceConfig"]);if(r!=null&&g(e,["voiceConfig"],r),m(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function cC(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],QN(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],XN(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function uC(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>YN(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const d=m(t,["enterpriseWebSearch"]);d!=null&&g(e,["enterpriseWebSearch"],d);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function dC(t){const e={},n=m(t,["promptTokenCount"]);n!=null&&g(e,["promptTokenCount"],n);const r=m(t,["cachedContentTokenCount"]);r!=null&&g(e,["cachedContentTokenCount"],r);const a=m(t,["candidatesTokenCount"]);a!=null&&g(e,["responseTokenCount"],a);const o=m(t,["toolUsePromptTokenCount"]);o!=null&&g(e,["toolUsePromptTokenCount"],o);const c=m(t,["thoughtsTokenCount"]);c!=null&&g(e,["thoughtsTokenCount"],c);const d=m(t,["totalTokenCount"]);d!=null&&g(e,["totalTokenCount"],d);const p=m(t,["promptTokensDetails"]);if(p!=null){let _=p;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["promptTokensDetails"],_)}const h=m(t,["cacheTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["cacheTokensDetails"],_)}const x=m(t,["candidatesTokensDetails"]);if(x!=null){let _=x;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["responseTokensDetails"],_)}const v=m(t,["toolUsePromptTokensDetails"]);if(v!=null){let _=v;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["toolUsePromptTokensDetails"],_)}const w=m(t,["trafficType"]);return w!=null&&g(e,["trafficType"],w),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fC(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function hC(t){const e={},n=m(t,["content"]);n!=null&&g(e,["content"],n);const r=m(t,["citationMetadata"]);r!=null&&g(e,["citationMetadata"],pC(r));const a=m(t,["tokenCount"]);a!=null&&g(e,["tokenCount"],a);const o=m(t,["finishReason"]);o!=null&&g(e,["finishReason"],o);const c=m(t,["avgLogprobs"]);c!=null&&g(e,["avgLogprobs"],c);const d=m(t,["groundingMetadata"]);d!=null&&g(e,["groundingMetadata"],d);const p=m(t,["index"]);p!=null&&g(e,["index"],p);const h=m(t,["logprobsResult"]);h!=null&&g(e,["logprobsResult"],h);const x=m(t,["safetyRatings"]);if(x!=null){let w=x;Array.isArray(w)&&(w=w.map(_=>_)),g(e,["safetyRatings"],w)}const v=m(t,["urlContextMetadata"]);return v!=null&&g(e,["urlContextMetadata"],v),e}function pC(t){const e={},n=m(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["citations"],r)}return e}function mC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let o=En(a);Array.isArray(o)&&(o=o.map(c=>c)),g(n,["contents"],o)}return n}function gC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(e,["tokensInfo"],a)}return e}function yC(t){const e={},n=m(t,["values"]);n!=null&&g(e,["values"],n);const r=m(t,["statistics"]);return r!=null&&g(e,["statistics"],xC(r)),e}function xC(t){const e={},n=m(t,["truncated"]);n!=null&&g(e,["truncated"],n);const r=m(t,["token_count"]);return r!=null&&g(e,["tokenCount"],r),e}function Hl(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>S1(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function vC(t){const e={},n=m(t,["controlType"]);n!=null&&g(e,["controlType"],n);const r=m(t,["enableControlImageComputation"]);return r!=null&&g(e,["computeControl"],r),e}function bC(t){const e={};if(m(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(m(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(m(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function wC(t,e){const n={},r=m(t,["systemInstruction"]);e!==void 0&&r!=null&&g(e,["systemInstruction"],Lt(r));const a=m(t,["tools"]);if(e!==void 0&&a!=null){let c=a;Array.isArray(c)&&(c=c.map(d=>Zx(d))),g(e,["tools"],c)}const o=m(t,["generationConfig"]);return e!==void 0&&o!=null&&g(e,["generationConfig"],u1(o)),n}function _C(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(d=>Hl(d))),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&bC(o),n}function SC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(d=>d)),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&wC(o,n),n}function EC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["totalTokens"]);r!=null&&g(e,["totalTokens"],r);const a=m(t,["cachedContentTokenCount"]);return a!=null&&g(e,["cachedContentTokenCount"],a),e}function TC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["totalTokens"]);return r!=null&&g(e,["totalTokens"],r),e}function NC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function CC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function AC(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function IC(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function RC(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["negativePrompt"]);e!==void 0&&a!=null&&g(e,["parameters","negativePrompt"],a);const o=m(t,["numberOfImages"]);e!==void 0&&o!=null&&g(e,["parameters","sampleCount"],o);const c=m(t,["aspectRatio"]);e!==void 0&&c!=null&&g(e,["parameters","aspectRatio"],c);const d=m(t,["guidanceScale"]);e!==void 0&&d!=null&&g(e,["parameters","guidanceScale"],d);const p=m(t,["seed"]);e!==void 0&&p!=null&&g(e,["parameters","seed"],p);const h=m(t,["safetyFilterLevel"]);e!==void 0&&h!=null&&g(e,["parameters","safetySetting"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&g(e,["parameters","includeSafetyAttributes"],v);const w=m(t,["includeRaiReason"]);e!==void 0&&w!=null&&g(e,["parameters","includeRaiReason"],w);const _=m(t,["language"]);e!==void 0&&_!=null&&g(e,["parameters","language"],_);const E=m(t,["outputMimeType"]);e!==void 0&&E!=null&&g(e,["parameters","outputOptions","mimeType"],E);const N=m(t,["outputCompressionQuality"]);e!==void 0&&N!=null&&g(e,["parameters","outputOptions","compressionQuality"],N);const I=m(t,["addWatermark"]);e!==void 0&&I!=null&&g(e,["parameters","addWatermark"],I);const P=m(t,["labels"]);e!==void 0&&P!=null&&g(e,["labels"],P);const U=m(t,["editMode"]);e!==void 0&&U!=null&&g(e,["parameters","editMode"],U);const R=m(t,["baseSteps"]);return e!==void 0&&R!=null&&g(e,["parameters","editConfig","baseSteps"],R),n}function DC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["referenceImages"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>I1(p))),g(n,["instances[0]","referenceImages"],d)}const c=m(e,["config"]);return c!=null&&RC(c,n),n}function MC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>zl(o))),g(e,["generatedImages"],a)}return e}function PC(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["requests[]","taskType"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["requests[]","title"],a);const o=m(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&g(e,["requests[]","outputDimensionality"],o),m(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function kC(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["instances[]","task_type"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["instances[]","title"],a);const o=m(t,["outputDimensionality"]);e!==void 0&&o!=null&&g(e,["parameters","outputDimensionality"],o);const c=m(t,["mimeType"]);e!==void 0&&c!=null&&g(e,["instances[]","mimeType"],c);const d=m(t,["autoTruncate"]);return e!==void 0&&d!=null&&g(e,["parameters","autoTruncate"],d),n}function UC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let d=Tf(t,a);Array.isArray(d)&&(d=d.map(p=>p)),g(n,["requests[]","content"],d)}const o=m(e,["config"]);o!=null&&PC(o,n);const c=m(e,["model"]);return c!==void 0&&g(n,["requests[]","model"],Je(t,c)),n}function jC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=Tf(t,a);Array.isArray(c)&&(c=c.map(d=>d)),g(n,["instances[]","content"],c)}const o=m(e,["config"]);return o!=null&&kC(o,n),n}function OC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["embeddings"],o)}const a=m(t,["metadata"]);return a!=null&&g(e,["metadata"],a),e}function LC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>yC(c))),g(e,["embeddings"],o)}const a=m(t,["metadata"]);return a!=null&&g(e,["metadata"],a),e}function qC(t){const e={},n=m(t,["endpoint"]);n!=null&&g(e,["name"],n);const r=m(t,["deployedModelId"]);return r!=null&&g(e,["deployedModelId"],r),e}function BC(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function VC(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const d=m(t,["responseJsonSchema"]);return d!=null&&g(e,["responseJsonSchema"],d),e}function GC(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],Hl(Lt(a)));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const d=m(e,["topK"]);d!=null&&g(r,["topK"],d);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const N=m(e,["seed"]);N!=null&&g(r,["seed"],N);const I=m(e,["responseMimeType"]);I!=null&&g(r,["responseMimeType"],I);const P=m(e,["responseSchema"]);P!=null&&g(r,["responseSchema"],Nf(P));const U=m(e,["responseJsonSchema"]);if(U!=null&&g(r,["responseJsonSchema"],U),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const R=m(e,["safetySettings"]);if(n!==void 0&&R!=null){let ue=R;Array.isArray(ue)&&(ue=ue.map(Ce=>R1(Ce))),g(n,["safetySettings"],ue)}const A=m(e,["tools"]);if(n!==void 0&&A!=null){let ue=Ai(A);Array.isArray(ue)&&(ue=ue.map(Ce=>j1(Ci(Ce)))),g(n,["tools"],ue)}const k=m(e,["toolConfig"]);if(n!==void 0&&k!=null&&g(n,["toolConfig"],k),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const q=m(e,["cachedContent"]);n!==void 0&&q!=null&&g(n,["cachedContent"],ms(t,q));const V=m(e,["responseModalities"]);V!=null&&g(r,["responseModalities"],V);const W=m(e,["mediaResolution"]);W!=null&&g(r,["mediaResolution"],W);const J=m(e,["speechConfig"]);if(J!=null&&g(r,["speechConfig"],Cf(J)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const $=m(e,["thinkingConfig"]);$!=null&&g(r,["thinkingConfig"],$);const ce=m(e,["imageConfig"]);return ce!=null&&g(r,["imageConfig"],ce),r}function HC(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],Lt(a));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const d=m(e,["topK"]);d!=null&&g(r,["topK"],d);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const N=m(e,["seed"]);N!=null&&g(r,["seed"],N);const I=m(e,["responseMimeType"]);I!=null&&g(r,["responseMimeType"],I);const P=m(e,["responseSchema"]);P!=null&&g(r,["responseSchema"],Nf(P));const U=m(e,["responseJsonSchema"]);U!=null&&g(r,["responseJsonSchema"],U);const R=m(e,["routingConfig"]);R!=null&&g(r,["routingConfig"],R);const A=m(e,["modelSelectionConfig"]);A!=null&&g(r,["modelConfig"],A);const k=m(e,["safetySettings"]);if(n!==void 0&&k!=null){let M=k;Array.isArray(M)&&(M=M.map(G=>G)),g(n,["safetySettings"],M)}const q=m(e,["tools"]);if(n!==void 0&&q!=null){let M=Ai(q);Array.isArray(M)&&(M=M.map(G=>Zx(Ci(G)))),g(n,["tools"],M)}const V=m(e,["toolConfig"]);n!==void 0&&V!=null&&g(n,["toolConfig"],V);const W=m(e,["labels"]);n!==void 0&&W!=null&&g(n,["labels"],W);const J=m(e,["cachedContent"]);n!==void 0&&J!=null&&g(n,["cachedContent"],ms(t,J));const $=m(e,["responseModalities"]);$!=null&&g(r,["responseModalities"],$);const ce=m(e,["mediaResolution"]);ce!=null&&g(r,["mediaResolution"],ce);const ue=m(e,["speechConfig"]);ue!=null&&g(r,["speechConfig"],Wx(Cf(ue)));const Ce=m(e,["audioTimestamp"]);Ce!=null&&g(r,["audioTimestamp"],Ce);const _e=m(e,["thinkingConfig"]);_e!=null&&g(r,["thinkingConfig"],_e);const Ve=m(e,["imageConfig"]);return Ve!=null&&g(r,["imageConfig"],Ve),r}function Ty(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(d=>Hl(d))),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&g(n,["generationConfig"],GC(t,o,n)),n}function Ny(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(d=>d)),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&g(n,["generationConfig"],HC(t,o,n)),n}function Cy(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(h=>hC(h))),g(e,["candidates"],p)}const a=m(t,["modelVersion"]);a!=null&&g(e,["modelVersion"],a);const o=m(t,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);const c=m(t,["responseId"]);c!=null&&g(e,["responseId"],c);const d=m(t,["usageMetadata"]);return d!=null&&g(e,["usageMetadata"],d),e}function Ay(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let h=r;Array.isArray(h)&&(h=h.map(x=>x)),g(e,["candidates"],h)}const a=m(t,["createTime"]);a!=null&&g(e,["createTime"],a);const o=m(t,["modelVersion"]);o!=null&&g(e,["modelVersion"],o);const c=m(t,["promptFeedback"]);c!=null&&g(e,["promptFeedback"],c);const d=m(t,["responseId"]);d!=null&&g(e,["responseId"],d);const p=m(t,["usageMetadata"]);return p!=null&&g(e,["usageMetadata"],p),e}function zC(t,e){const n={};if(m(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=m(t,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["aspectRatio"]);e!==void 0&&a!=null&&g(e,["parameters","aspectRatio"],a);const o=m(t,["guidanceScale"]);if(e!==void 0&&o!=null&&g(e,["parameters","guidanceScale"],o),m(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=m(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);const d=m(t,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);const p=m(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&g(e,["parameters","includeSafetyAttributes"],p);const h=m(t,["includeRaiReason"]);e!==void 0&&h!=null&&g(e,["parameters","includeRaiReason"],h);const x=m(t,["language"]);e!==void 0&&x!=null&&g(e,["parameters","language"],x);const v=m(t,["outputMimeType"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","mimeType"],v);const w=m(t,["outputCompressionQuality"]);if(e!==void 0&&w!=null&&g(e,["parameters","outputOptions","compressionQuality"],w),m(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _=m(t,["imageSize"]);if(e!==void 0&&_!=null&&g(e,["parameters","sampleImageSize"],_),m(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function FC(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["negativePrompt"]);e!==void 0&&a!=null&&g(e,["parameters","negativePrompt"],a);const o=m(t,["numberOfImages"]);e!==void 0&&o!=null&&g(e,["parameters","sampleCount"],o);const c=m(t,["aspectRatio"]);e!==void 0&&c!=null&&g(e,["parameters","aspectRatio"],c);const d=m(t,["guidanceScale"]);e!==void 0&&d!=null&&g(e,["parameters","guidanceScale"],d);const p=m(t,["seed"]);e!==void 0&&p!=null&&g(e,["parameters","seed"],p);const h=m(t,["safetyFilterLevel"]);e!==void 0&&h!=null&&g(e,["parameters","safetySetting"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&g(e,["parameters","includeSafetyAttributes"],v);const w=m(t,["includeRaiReason"]);e!==void 0&&w!=null&&g(e,["parameters","includeRaiReason"],w);const _=m(t,["language"]);e!==void 0&&_!=null&&g(e,["parameters","language"],_);const E=m(t,["outputMimeType"]);e!==void 0&&E!=null&&g(e,["parameters","outputOptions","mimeType"],E);const N=m(t,["outputCompressionQuality"]);e!==void 0&&N!=null&&g(e,["parameters","outputOptions","compressionQuality"],N);const I=m(t,["addWatermark"]);e!==void 0&&I!=null&&g(e,["parameters","addWatermark"],I);const P=m(t,["labels"]);e!==void 0&&P!=null&&g(e,["labels"],P);const U=m(t,["imageSize"]);e!==void 0&&U!=null&&g(e,["parameters","sampleImageSize"],U);const R=m(t,["enhancePrompt"]);return e!==void 0&&R!=null&&g(e,["parameters","enhancePrompt"],R),n}function $C(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["config"]);return o!=null&&zC(o,n),n}function JC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["config"]);return o!=null&&FC(o,n),n}function YC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>a1(c))),g(e,["generatedImages"],o)}const a=m(t,["positivePromptSafetyAttributes"]);return a!=null&&g(e,["positivePromptSafetyAttributes"],Qx(a)),e}function KC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>zl(c))),g(e,["generatedImages"],o)}const a=m(t,["positivePromptSafetyAttributes"]);return a!=null&&g(e,["positivePromptSafetyAttributes"],Xx(a)),e}function QC(t,e){const n={},r=m(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r),m(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=m(t,["durationSeconds"]);if(e!==void 0&&a!=null&&g(e,["parameters","durationSeconds"],a),m(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=m(t,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);const c=m(t,["resolution"]);e!==void 0&&c!=null&&g(e,["parameters","resolution"],c);const d=m(t,["personGeneration"]);if(e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d),m(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const p=m(t,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);const h=m(t,["enhancePrompt"]);if(e!==void 0&&h!=null&&g(e,["parameters","enhancePrompt"],h),m(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const x=m(t,["lastFrame"]);e!==void 0&&x!=null&&g(e,["instances[0]","lastFrame"],Fl(x));const v=m(t,["referenceImages"]);if(e!==void 0&&v!=null){let w=v;Array.isArray(w)&&(w=w.map(_=>K1(_))),g(e,["instances[0]","referenceImages"],w)}if(m(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(m(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function XC(t,e){const n={},r=m(t,["numberOfVideos"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["outputGcsUri"]);e!==void 0&&a!=null&&g(e,["parameters","storageUri"],a);const o=m(t,["fps"]);e!==void 0&&o!=null&&g(e,["parameters","fps"],o);const c=m(t,["durationSeconds"]);e!==void 0&&c!=null&&g(e,["parameters","durationSeconds"],c);const d=m(t,["seed"]);e!==void 0&&d!=null&&g(e,["parameters","seed"],d);const p=m(t,["aspectRatio"]);e!==void 0&&p!=null&&g(e,["parameters","aspectRatio"],p);const h=m(t,["resolution"]);e!==void 0&&h!=null&&g(e,["parameters","resolution"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["pubsubTopic"]);e!==void 0&&v!=null&&g(e,["parameters","pubsubTopic"],v);const w=m(t,["negativePrompt"]);e!==void 0&&w!=null&&g(e,["parameters","negativePrompt"],w);const _=m(t,["enhancePrompt"]);e!==void 0&&_!=null&&g(e,["parameters","enhancePrompt"],_);const E=m(t,["generateAudio"]);e!==void 0&&E!=null&&g(e,["parameters","generateAudio"],E);const N=m(t,["lastFrame"]);e!==void 0&&N!=null&&g(e,["instances[0]","lastFrame"],Pn(N));const I=m(t,["referenceImages"]);if(e!==void 0&&I!=null){let R=I;Array.isArray(R)&&(R=R.map(A=>Q1(A))),g(e,["instances[0]","referenceImages"],R)}const P=m(t,["mask"]);e!==void 0&&P!=null&&g(e,["instances[0]","mask"],Y1(P));const U=m(t,["compressionQuality"]);return e!==void 0&&U!=null&&g(e,["parameters","compressionQuality"],U),n}function WC(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response","generateVideoResponse"]);return c!=null&&g(e,["response"],n1(c)),e}function ZC(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],s1(c)),e}function e1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["image"]);o!=null&&g(n,["instances[0]","image"],Fl(o));const c=m(e,["video"]);c!=null&&g(n,["instances[0]","video"],ev(c));const d=m(e,["source"]);d!=null&&r1(d,n);const p=m(e,["config"]);return p!=null&&QC(p,n),n}function t1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["image"]);o!=null&&g(n,["instances[0]","image"],Pn(o));const c=m(e,["video"]);c!=null&&g(n,["instances[0]","video"],tv(c));const d=m(e,["source"]);d!=null&&i1(d,n);const p=m(e,["config"]);return p!=null&&XC(p,n),n}function n1(t){const e={},n=m(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>l1(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function s1(t){const e={},n=m(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>c1(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function r1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Fl(a));const o=m(t,["video"]);return e!==void 0&&o!=null&&g(e,["instances[0]","video"],ev(o)),n}function i1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Pn(a));const o=m(t,["video"]);return e!==void 0&&o!=null&&g(e,["instances[0]","video"],tv(o)),n}function a1(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["image"],m1(n));const r=m(t,["raiFilteredReason"]);r!=null&&g(e,["raiFilteredReason"],r);const a=m(t,["_self"]);return a!=null&&g(e,["safetyAttributes"],Qx(a)),e}function zl(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["image"],Kx(n));const r=m(t,["raiFilteredReason"]);r!=null&&g(e,["raiFilteredReason"],r);const a=m(t,["_self"]);a!=null&&g(e,["safetyAttributes"],Xx(a));const o=m(t,["prompt"]);return o!=null&&g(e,["enhancedPrompt"],o),e}function o1(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["mask"],Kx(n));const r=m(t,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(e,["labels"],a)}return e}function l1(t){const e={},n=m(t,["video"]);return n!=null&&g(e,["video"],$1(n)),e}function c1(t){const e={},n=m(t,["_self"]);return n!=null&&g(e,["video"],J1(n)),e}function u1(t){const e={},n=m(t,["modelSelectionConfig"]);n!=null&&g(e,["modelConfig"],n);const r=m(t,["responseJsonSchema"]);r!=null&&g(e,["responseJsonSchema"],r);const a=m(t,["audioTimestamp"]);a!=null&&g(e,["audioTimestamp"],a);const o=m(t,["candidateCount"]);o!=null&&g(e,["candidateCount"],o);const c=m(t,["enableAffectiveDialog"]);c!=null&&g(e,["enableAffectiveDialog"],c);const d=m(t,["frequencyPenalty"]);d!=null&&g(e,["frequencyPenalty"],d);const p=m(t,["logprobs"]);p!=null&&g(e,["logprobs"],p);const h=m(t,["maxOutputTokens"]);h!=null&&g(e,["maxOutputTokens"],h);const x=m(t,["mediaResolution"]);x!=null&&g(e,["mediaResolution"],x);const v=m(t,["presencePenalty"]);v!=null&&g(e,["presencePenalty"],v);const w=m(t,["responseLogprobs"]);w!=null&&g(e,["responseLogprobs"],w);const _=m(t,["responseMimeType"]);_!=null&&g(e,["responseMimeType"],_);const E=m(t,["responseModalities"]);E!=null&&g(e,["responseModalities"],E);const N=m(t,["responseSchema"]);N!=null&&g(e,["responseSchema"],N);const I=m(t,["routingConfig"]);I!=null&&g(e,["routingConfig"],I);const P=m(t,["seed"]);P!=null&&g(e,["seed"],P);const U=m(t,["speechConfig"]);U!=null&&g(e,["speechConfig"],Wx(U));const R=m(t,["stopSequences"]);R!=null&&g(e,["stopSequences"],R);const A=m(t,["temperature"]);A!=null&&g(e,["temperature"],A);const k=m(t,["thinkingConfig"]);k!=null&&g(e,["thinkingConfig"],k);const q=m(t,["topK"]);q!=null&&g(e,["topK"],q);const V=m(t,["topP"]);if(V!=null&&g(e,["topP"],V),m(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function d1(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function f1(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function h1(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function p1(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function m1(t){const e={},n=m(t,["bytesBase64Encoded"]);n!=null&&g(e,["imageBytes"],$s(n));const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function Kx(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["imageBytes"],$s(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function Fl(t){const e={};if(m(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=m(t,["imageBytes"]);n!=null&&g(e,["bytesBase64Encoded"],$s(n));const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function Pn(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["imageBytes"]);r!=null&&g(e,["bytesBase64Encoded"],$s(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function g1(t,e,n){const r={},a=m(e,["pageSize"]);n!==void 0&&a!=null&&g(n,["_query","pageSize"],a);const o=m(e,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const c=m(e,["filter"]);n!==void 0&&c!=null&&g(n,["_query","filter"],c);const d=m(e,["queryBase"]);return n!==void 0&&d!=null&&g(n,["_url","models_url"],Vx(t,d)),r}function y1(t,e,n){const r={},a=m(e,["pageSize"]);n!==void 0&&a!=null&&g(n,["_query","pageSize"],a);const o=m(e,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const c=m(e,["filter"]);n!==void 0&&c!=null&&g(n,["_query","filter"],c);const d=m(e,["queryBase"]);return n!==void 0&&d!=null&&g(n,["_url","models_url"],Vx(t,d)),r}function x1(t,e){const n={},r=m(e,["config"]);return r!=null&&g1(t,r,n),n}function v1(t,e){const n={},r=m(e,["config"]);return r!=null&&y1(t,r,n),n}function b1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["_self"]);if(a!=null){let o=Gx(a);Array.isArray(o)&&(o=o.map(c=>$d(c))),g(e,["models"],o)}return e}function w1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["_self"]);if(a!=null){let o=Gx(a);Array.isArray(o)&&(o=o.map(c=>Jd(c))),g(e,["models"],o)}return e}function _1(t){const e={},n=m(t,["maskMode"]);n!=null&&g(e,["maskMode"],n);const r=m(t,["segmentationClasses"]);r!=null&&g(e,["maskClasses"],r);const a=m(t,["maskDilation"]);return a!=null&&g(e,["dilation"],a),e}function $d(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);a!=null&&g(e,["description"],a);const o=m(t,["version"]);o!=null&&g(e,["version"],o);const c=m(t,["_self"]);c!=null&&g(e,["tunedModelInfo"],O1(c));const d=m(t,["inputTokenLimit"]);d!=null&&g(e,["inputTokenLimit"],d);const p=m(t,["outputTokenLimit"]);p!=null&&g(e,["outputTokenLimit"],p);const h=m(t,["supportedGenerationMethods"]);h!=null&&g(e,["supportedActions"],h);const x=m(t,["temperature"]);x!=null&&g(e,["temperature"],x);const v=m(t,["maxTemperature"]);v!=null&&g(e,["maxTemperature"],v);const w=m(t,["topP"]);w!=null&&g(e,["topP"],w);const _=m(t,["topK"]);_!=null&&g(e,["topK"],_);const E=m(t,["thinking"]);return E!=null&&g(e,["thinking"],E),e}function Jd(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);a!=null&&g(e,["description"],a);const o=m(t,["versionId"]);o!=null&&g(e,["version"],o);const c=m(t,["deployedModels"]);if(c!=null){let v=c;Array.isArray(v)&&(v=v.map(w=>qC(w))),g(e,["endpoints"],v)}const d=m(t,["labels"]);d!=null&&g(e,["labels"],d);const p=m(t,["_self"]);p!=null&&g(e,["tunedModelInfo"],L1(p));const h=m(t,["defaultCheckpointId"]);h!=null&&g(e,["defaultCheckpointId"],h);const x=m(t,["checkpoints"]);if(x!=null){let v=x;Array.isArray(v)&&(v=v.map(w=>w)),g(e,["checkpoints"],v)}return e}function S1(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],BC(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],fC(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function E1(t){const e={},n=m(t,["productImage"]);return n!=null&&g(e,["image"],Pn(n)),e}function T1(t,e){const n={},r=m(t,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["baseSteps"]);e!==void 0&&a!=null&&g(e,["parameters","baseSteps"],a);const o=m(t,["outputGcsUri"]);e!==void 0&&o!=null&&g(e,["parameters","storageUri"],o);const c=m(t,["seed"]);e!==void 0&&c!=null&&g(e,["parameters","seed"],c);const d=m(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&g(e,["parameters","safetySetting"],d);const p=m(t,["personGeneration"]);e!==void 0&&p!=null&&g(e,["parameters","personGeneration"],p);const h=m(t,["addWatermark"]);e!==void 0&&h!=null&&g(e,["parameters","addWatermark"],h);const x=m(t,["outputMimeType"]);e!==void 0&&x!=null&&g(e,["parameters","outputOptions","mimeType"],x);const v=m(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);const w=m(t,["enhancePrompt"]);e!==void 0&&w!=null&&g(e,["parameters","enhancePrompt"],w);const _=m(t,["labels"]);return e!==void 0&&_!=null&&g(e,["labels"],_),n}function N1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["source"]);a!=null&&A1(a,n);const o=m(e,["config"]);return o!=null&&T1(o,n),n}function C1(t){const e={},n=m(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>zl(a))),g(e,["generatedImages"],r)}return e}function A1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["personImage"]);e!==void 0&&a!=null&&g(e,["instances[0]","personImage","image"],Pn(a));const o=m(t,["productImages"]);if(e!==void 0&&o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>E1(d))),g(e,["instances[0]","productImages"],c)}return n}function I1(t){const e={},n=m(t,["referenceImage"]);n!=null&&g(e,["referenceImage"],Pn(n));const r=m(t,["referenceId"]);r!=null&&g(e,["referenceId"],r);const a=m(t,["referenceType"]);a!=null&&g(e,["referenceType"],a);const o=m(t,["maskImageConfig"]);o!=null&&g(e,["maskImageConfig"],_1(o));const c=m(t,["controlImageConfig"]);c!=null&&g(e,["controlImageConfig"],vC(c));const d=m(t,["styleImageConfig"]);d!=null&&g(e,["styleImageConfig"],d);const p=m(t,["subjectImageConfig"]);return p!=null&&g(e,["subjectImageConfig"],p),e}function Qx(t){const e={},n=m(t,["safetyAttributes","categories"]);n!=null&&g(e,["categories"],n);const r=m(t,["safetyAttributes","scores"]);r!=null&&g(e,["scores"],r);const a=m(t,["contentType"]);return a!=null&&g(e,["contentType"],a),e}function Xx(t){const e={},n=m(t,["safetyAttributes","categories"]);n!=null&&g(e,["categories"],n);const r=m(t,["safetyAttributes","scores"]);r!=null&&g(e,["scores"],r);const a=m(t,["contentType"]);return a!=null&&g(e,["contentType"],a),e}function R1(t){const e={},n=m(t,["category"]);if(n!=null&&g(e,["category"],n),m(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(t,["threshold"]);return r!=null&&g(e,["threshold"],r),e}function D1(t){const e={},n=m(t,["image"]);return n!=null&&g(e,["image"],Pn(n)),e}function M1(t,e){const n={},r=m(t,["mode"]);e!==void 0&&r!=null&&g(e,["parameters","mode"],r);const a=m(t,["maxPredictions"]);e!==void 0&&a!=null&&g(e,["parameters","maxPredictions"],a);const o=m(t,["confidenceThreshold"]);e!==void 0&&o!=null&&g(e,["parameters","confidenceThreshold"],o);const c=m(t,["maskDilation"]);e!==void 0&&c!=null&&g(e,["parameters","maskDilation"],c);const d=m(t,["binaryColorThreshold"]);e!==void 0&&d!=null&&g(e,["parameters","binaryColorThreshold"],d);const p=m(t,["labels"]);return e!==void 0&&p!=null&&g(e,["labels"],p),n}function P1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["source"]);a!=null&&U1(a,n);const o=m(e,["config"]);return o!=null&&M1(o,n),n}function k1(t){const e={},n=m(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>o1(a))),g(e,["generatedMasks"],r)}return e}function U1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Pn(a));const o=m(t,["scribbleImage"]);return e!==void 0&&o!=null&&g(e,["instances[0]","scribble"],D1(o)),n}function Wx(t){const e={},n=m(t,["languageCode"]);n!=null&&g(e,["languageCode"],n);const r=m(t,["voiceConfig"]);if(r!=null&&g(e,["voiceConfig"],r),m(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function j1(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],h1(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],p1(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function Zx(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>VC(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const d=m(t,["enterpriseWebSearch"]);d!=null&&g(e,["enterpriseWebSearch"],d);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function O1(t){const e={},n=m(t,["baseModel"]);n!=null&&g(e,["baseModel"],n);const r=m(t,["createTime"]);r!=null&&g(e,["createTime"],r);const a=m(t,["updateTime"]);return a!=null&&g(e,["updateTime"],a),e}function L1(t){const e={},n=m(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&g(e,["baseModel"],n);const r=m(t,["createTime"]);r!=null&&g(e,["createTime"],r);const a=m(t,["updateTime"]);return a!=null&&g(e,["updateTime"],a),e}function q1(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);e!==void 0&&a!=null&&g(e,["description"],a);const o=m(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&g(e,["defaultCheckpointId"],o),n}function B1(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);e!==void 0&&a!=null&&g(e,["description"],a);const o=m(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&g(e,["defaultCheckpointId"],o),n}function V1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","name"],Je(t,r));const a=m(e,["config"]);return a!=null&&q1(a,n),n}function G1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&B1(a,n),n}function H1(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);const o=m(t,["personGeneration"]);e!==void 0&&o!=null&&g(e,["parameters","personGeneration"],o);const c=m(t,["includeRaiReason"]);e!==void 0&&c!=null&&g(e,["parameters","includeRaiReason"],c);const d=m(t,["outputMimeType"]);e!==void 0&&d!=null&&g(e,["parameters","outputOptions","mimeType"],d);const p=m(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p);const h=m(t,["enhanceInputImage"]);e!==void 0&&h!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],h);const x=m(t,["imagePreservationFactor"]);e!==void 0&&x!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],x);const v=m(t,["labels"]);e!==void 0&&v!=null&&g(e,["labels"],v);const w=m(t,["numberOfImages"]);e!==void 0&&w!=null&&g(e,["parameters","sampleCount"],w);const _=m(t,["mode"]);return e!==void 0&&_!=null&&g(e,["parameters","mode"],_),n}function z1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["image"]);a!=null&&g(n,["instances[0]","image"],Pn(a));const o=m(e,["upscaleFactor"]);o!=null&&g(n,["parameters","upscaleConfig","upscaleFactor"],o);const c=m(e,["config"]);return c!=null&&H1(c,n),n}function F1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>zl(o))),g(e,["generatedImages"],a)}return e}function $1(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["encodedVideo"]);r!=null&&g(e,["videoBytes"],$s(r));const a=m(t,["encoding"]);return a!=null&&g(e,["mimeType"],a),e}function J1(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["uri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["videoBytes"],$s(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function Y1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["_self"],Pn(n));const r=m(t,["maskMode"]);return r!=null&&g(e,["maskMode"],r),e}function K1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["image"],Fl(n));const r=m(t,["referenceType"]);return r!=null&&g(e,["referenceType"],r),e}function Q1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["image"],Pn(n));const r=m(t,["referenceType"]);return r!=null&&g(e,["referenceType"],r),e}function ev(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["videoBytes"]);r!=null&&g(e,["encodedVideo"],$s(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["encoding"],a),e}function tv(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["videoBytes"]);r!=null&&g(e,["bytesBase64Encoded"],$s(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const X1="Content-Type",W1="X-Server-Timeout",Z1="User-Agent",Yd="x-goog-api-client",eA="1.29.1",tA=`google-genai-sdk/${eA}`,nA="v1beta1",sA="v1beta",Iy=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class rA{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:nA,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:sA,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const a=[this.getRequestUrlInternal(n)];return r&&a.push(this.getBaseResourcePath()),e!==""&&a.push(e),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[c,d]of Object.entries(e.queryParams))a.searchParams.append(c,String(d));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,a.toString(),e.abortSignal),this.unaryApiCall(a,o,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[a,o]of Object.entries(n))typeof o=="object"?r[a]=Object.assign(Object.assign({},r[a]),o):o!==void 0&&(r[a]=o);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,n,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,a.toString(),e.abortSignal),this.streamApiCall(a,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,a){if(n&&n.timeout||a){const o=new AbortController,c=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>o.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}a&&a.addEventListener("abort",()=>{o.abort()}),e.signal=c}return n&&n.extraBody!==null&&iA(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await Ry(a),new Hd(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await Ry(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(e){var n;return wi(this,arguments,function*(){const a=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let c="";for(;;){const{done:d,value:p}=yield lt(a.read());if(d){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const h=o.decode(p,{stream:!0});try{const v=JSON.parse(h);if("error"in v){const w=JSON.parse(JSON.stringify(v.error)),_=w.status,E=w.code,N=`got status: ${_}. ${JSON.stringify(v)}`;if(E>=400&&E<600)throw new Gl({message:N,status:E})}}catch(v){if(v.name==="ApiError")throw v}c+=h;let x=c.match(Iy);for(;x;){const v=x[1];try{const w=new Response(v,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield lt(new Hd(w)),c=c.slice(x[0].length),x=c.match(Iy)}catch(w){throw new Error(`exception parsing stream chunk ${v}. ${w}`)}}}}finally{a.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=tA+" "+this.clientOptions.userAgentExtra;return e[Z1]=n,e[Yd]=n,e[X1]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[a,o]of Object.entries(e.headers))r.append(a,o);e.timeout&&e.timeout>0&&r.append(W1,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const a={};n!=null&&(a.mimeType=n.mimeType,a.name=n.name,a.displayName=n.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const o=this.clientOptions.uploader,c=await o.stat(e);a.sizeBytes=String(c.size);const d=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:c.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=d;const p={file:a},h=this.getFileName(e),x=fe("upload/v1beta/files",p._url),v=await this.fetchUploadUrl(x,a.sizeBytes,a.mimeType,h,p,n==null?void 0:n.httpOptions);return o.upload(e,v,this)}async uploadFileToFileSearchStore(e,n,r){var a;const o=this.clientOptions.uploader,c=await o.stat(n),d=String(c.size),p=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:c.type;if(p===void 0||p==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${e}:uploadToFileSearchStore`,x=this.getFileName(n),v={};r!=null&&r.customMetadata&&(v.customMetadata=r.customMetadata),r!=null&&r.chunkingConfig&&(v.chunkingConfig=r.chunkingConfig);const w=await this.fetchUploadUrl(h,d,p,x,v,r==null?void 0:r.httpOptions);return o.uploadToFileSearchStore(n,w,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,a,o,c){var d;let p={};c?p=c:p={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const h=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:p});if(!h||!(h!=null&&h.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const x=(d=h==null?void 0:h.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(x===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return x}}async function Ry(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const a=JSON.stringify(r);throw n>=400&&n<600?new Gl({message:a,status:n}):new Error(a)}}function iA(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(o,c){const d=Object.assign({},o);for(const p in c)if(Object.prototype.hasOwnProperty.call(c,p)){const h=c[p],x=d[p];h&&typeof h=="object"&&!Array.isArray(h)&&x&&typeof x=="object"&&!Array.isArray(x)?d[p]=r(x,h):(x&&h&&typeof x!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${p}". Original type: ${typeof x}, New type: ${typeof h}. Overwriting.`),d[p]=h)}return d}const a=r(n,e);t.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aA="mcp_used/unknown";let oA=!1;function nv(t){for(const e of t)if(lA(e)||typeof e=="object"&&"inputSchema"in e)return!0;return oA}function sv(t){var e;const n=(e=t[Yd])!==null&&e!==void 0?e:"";t[Yd]=(n+` ${aA}`).trimStart()}function lA(t){return t!==null&&typeof t=="object"&&t instanceof If}function cA(t,e=100){return wi(this,arguments,function*(){let r,a=0;for(;a<e;){const o=yield lt(t.listTools({cursor:r}));for(const c of o.tools)yield yield lt(c),a++;if(!o.nextCursor)break;r=o.nextCursor}})}class If{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new If(e,n)}async initialize(){var e,n,r,a;if(this.mcpTools.length>0)return;const o={},c=[];for(const x of this.mcpClients)try{for(var d=!0,p=(n=void 0,Da(cA(x))),h;h=await p.next(),e=h.done,!e;d=!0){a=h.value,d=!1;const v=a;c.push(v);const w=v.name;if(o[w])throw new Error(`Duplicate function name ${w} found in MCP tools. Please ensure function names are unique.`);o[w]=x}}catch(v){n={error:v}}finally{try{!d&&!e&&(r=p.return)&&await r.call(p)}finally{if(n)throw n.error}}this.mcpTools=c,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),pT(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const c=await a.callTool({name:r.name,arguments:r.args},void 0,o);n.push({functionResponse:{name:r.name,response:c.isError?{error:c}:c}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function uA(t,e,n){const r=new aT;let a;n.data instanceof Blob?a=JSON.parse(await n.data.text()):a=JSON.parse(n.data),Object.assign(r,a),e(r)}class dA{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),c=pA(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),p=`${a}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${d}`;let h=()=>{};const x=new Promise(R=>{h=R}),v=e.callbacks,w=function(){h({})},_=this.apiClient,E={onopen:w,onmessage:R=>{uA(_,v.onmessage,R)},onerror:(n=v==null?void 0:v.onerror)!==null&&n!==void 0?n:function(R){},onclose:(r=v==null?void 0:v.onclose)!==null&&r!==void 0?r:function(R){}},N=this.webSocketFactory.create(p,hA(c),E);N.connect(),await x;const U={setup:{model:Je(this.apiClient,e.model)}};return N.send(JSON.stringify(U)),new fA(N,this.apiClient)}}class fA{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=sC(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=nC(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(vi.PLAY)}pause(){this.sendPlaybackControl(vi.PAUSE)}stop(){this.sendPlaybackControl(vi.STOP)}resetContext(){this.sendPlaybackControl(vi.RESET_CONTEXT)}close(){this.conn.close()}}function hA(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function pA(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mA="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function gA(t,e,n){const r=new iT;let a;n.data instanceof Blob?a=await n.data.text():n.data instanceof ArrayBuffer?a=new TextDecoder().decode(n.data):a=n.data;const o=JSON.parse(a);if(t.isVertexAI()){const c=aC(o);Object.assign(r,c)}else Object.assign(r,o);e(r)}class yA{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new dA(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,a,o,c,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const p=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let x;const v=this.apiClient.getHeaders();e.config&&e.config.tools&&nv(e.config.tools)&&sv(v);const w=wA(v);if(this.apiClient.isVertexAI())x=`${p}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(w,x);else{const J=this.apiClient.getApiKey();let $="BidiGenerateContent",ce="key";J!=null&&J.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),$="BidiGenerateContentConstrained",ce="access_token"),x=`${p}/ws/google.ai.generativelanguage.${h}.GenerativeService.${$}?${ce}=${J}`}let _=()=>{};const E=new Promise(J=>{_=J}),N=e.callbacks,I=function(){var J;(J=N==null?void 0:N.onopen)===null||J===void 0||J.call(N),_({})},P=this.apiClient,U={onopen:I,onmessage:J=>{gA(P,N.onmessage,J)},onerror:(n=N==null?void 0:N.onerror)!==null&&n!==void 0?n:function(J){},onclose:(r=N==null?void 0:N.onclose)!==null&&r!==void 0?r:function(J){}},R=this.webSocketFactory.create(x,bA(w),U);R.connect(),await E;let A=Je(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&A.startsWith("publishers/")){const J=this.apiClient.getProject(),$=this.apiClient.getLocation();A=`projects/${J}/locations/${$}/`+A}let k={};this.apiClient.isVertexAI()&&((a=e.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Cl.AUDIO]}:e.config.responseModalities=[Cl.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const q=(d=(c=e.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[],V=[];for(const J of q)if(this.isCallableTool(J)){const $=J;V.push(await $.tool())}else V.push(J);V.length>0&&(e.config.tools=V);const W={model:A,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?k=tC(this.apiClient,W):k=eC(this.apiClient,W),delete k.config,R.send(JSON.stringify(k)),new vA(R,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const xA={turnComplete:!0};class vA{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=En(n.turns),e.isVertexAI()||(r=r.map(a=>Hl(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(mA)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},xA),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:iC(e)}:n={realtimeInput:rC(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function bA(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function wA(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Dy=10;function My(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let a=!1;for(const c of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(_i(c)){a=!0;break}if(!a)return!0;const o=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function _i(t){return"callTool"in t&&typeof t.callTool=="function"}function _A(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(a=>_i(a)))!==null&&r!==void 0?r:!1}function Py(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,a)=>{if(_i(r))return;const o=r;o.functionDeclarations&&o.functionDeclarations.length>0&&n.push(a)}),n}function ky(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class SA extends ps{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,a,o,c,d;const p=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!_A(n)||My(n.config))return await this.generateContentInternal(p);const h=Py(n);if(h.length>0){const N=h.map(I=>`tools[${I}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${N}.`)}let x,v;const w=En(p.contents),_=(o=(a=(r=p.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&o!==void 0?o:Dy;let E=0;for(;E<_&&(x=await this.generateContentInternal(p),!(!x.functionCalls||x.functionCalls.length===0));){const N=x.candidates[0].content,I=[];for(const P of(d=(c=n.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[])if(_i(P)){const R=await P.callTool(x.functionCalls);I.push(...R)}E++,v={role:"user",parts:I},p.contents=En(p.contents),p.contents.push(N),p.contents.push(v),ky(p.config)&&(w.push(N),w.push(v))}return ky(p.config)&&(x.automaticFunctionCallingHistory=w),x},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),My(n.config)){const a=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(a)}const r=Py(n);if(r.length>0){const a=r.map(o=>`tools[${o}]`).join(", ");throw new Error(`Incompatible tools found at ${a}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var a;let o;const c=[];if(r!=null&&r.generatedImages)for(const p of r.generatedImages)p&&(p!=null&&p.safetyAttributes)&&((a=p==null?void 0:p.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?o=p==null?void 0:p.safetyAttributes:c.push(p);let d;return o?d={generatedImages:c,positivePromptSafetyAttributes:o,sdkHttpResponse:r.sdkHttpResponse}:d={generatedImages:c,sdkHttpResponse:r.sdkHttpResponse},d}),this.list=async n=>{var r;const c={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((r=c.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new Er(fs.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(c),c)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const a={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async n=>{var r,a,o,c,d,p;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((a=n.video)===null||a===void 0)&&a.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((c=(o=n.source)===null||o===void 0?void 0:o.video)===null||c===void 0)&&c.uri&&(!((p=(d=n.source)===null||d===void 0?void 0:d.video)===null||p===void 0)&&p.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,a;const o=(n=e.config)===null||n===void 0?void 0:n.tools;if(!o)return e;const c=await Promise.all(o.map(async p=>_i(p)?await p.tool():p)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:c})};if(d.config.tools=c,e.config&&e.config.tools&&nv(e.config.tools)){const p=(a=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let h=Object.assign({},p);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),sv(h),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return d}async initAfcToolsMap(e){var n,r,a;const o=new Map;for(const c of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(_i(c)){const d=c,p=await d.tool();for(const h of(a=p.functionDeclarations)!==null&&a!==void 0?a:[]){if(!h.name)throw new Error("Function declaration name is required.");if(o.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);o.set(h.name,d)}}return o}async processAfcStream(e){var n,r,a;const o=(a=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:Dy;let c=!1,d=0;const p=await this.initAfcToolsMap(e);return(function(h,x,v){var w,_;return wi(this,arguments,function*(){for(var E,N,I,P;d<o;){c&&(d++,c=!1);const k=yield lt(h.processParamsMaybeAddMcpUsage(v)),q=yield lt(h.generateContentStreamInternal(k)),V=[],W=[];try{for(var U=!0,R=(N=void 0,Da(q)),A;A=yield lt(R.next()),E=A.done,!E;U=!0){P=A.value,U=!1;const J=P;if(yield yield lt(J),J.candidates&&(!((w=J.candidates[0])===null||w===void 0)&&w.content)){W.push(J.candidates[0].content);for(const $ of(_=J.candidates[0].content.parts)!==null&&_!==void 0?_:[])if(d<o&&$.functionCall){if(!$.functionCall.name)throw new Error("Function call name was not returned by the model.");if(x.has($.functionCall.name)){const ce=yield lt(x.get($.functionCall.name).callTool([$.functionCall]));V.push(...ce)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${x.keys()}, mising tool: ${$.functionCall.name}`)}}}}catch(J){N={error:J}}finally{try{!U&&!E&&(I=R.return)&&(yield lt(I.call(R)))}finally{if(N)throw N.error}}if(V.length>0){c=!0;const J=new Ia;J.candidates=[{content:{role:"user",parts:V}}],yield yield lt(J);const $=[];$.push(...W),$.push({role:"user",parts:V});const ce=En(v.contents).concat($);v.contents=ce}else break}})})(this,p,e)}async generateContentInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=Ny(this.apiClient,e);return d=fe("{model}:generateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=Ay(x),w=new Ia;return Object.assign(w,v),w})}else{const h=Ty(this.apiClient,e);return d=fe("{model}:generateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=Cy(x),w=new Ia;return Object.assign(w,v),w})}}async generateContentStreamInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=Ny(this.apiClient,e);return d=fe("{model}:streamGenerateContent?alt=sse",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),c.then(function(v){return wi(this,arguments,function*(){var w,_,E,N;try{for(var I=!0,P=Da(v),U;U=yield lt(P.next()),w=U.done,!w;I=!0){N=U.value,I=!1;const R=N,A=Ay(yield lt(R.json()));A.sdkHttpResponse={headers:R.headers};const k=new Ia;Object.assign(k,A),yield yield lt(k)}}catch(R){_={error:R}}finally{try{!I&&!w&&(E=P.return)&&(yield lt(E.call(P)))}finally{if(_)throw _.error}}})})}else{const h=Ty(this.apiClient,e);return d=fe("{model}:streamGenerateContent?alt=sse",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),c.then(function(v){return wi(this,arguments,function*(){var w,_,E,N;try{for(var I=!0,P=Da(v),U;U=yield lt(P.next()),w=U.done,!w;I=!0){N=U.value,I=!1;const R=N,A=Cy(yield lt(R.json()));A.sdkHttpResponse={headers:R.headers};const k=new Ia;Object.assign(k,A),yield yield lt(k)}}catch(R){_={error:R}}finally{try{!I&&!w&&(E=P.return)&&(yield lt(E.call(P)))}finally{if(_)throw _.error}}})})}}async embedContent(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=jC(this.apiClient,e);return d=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=LC(x),w=new cy;return Object.assign(w,v),w})}else{const h=UC(this.apiClient,e);return d=fe("{model}:batchEmbedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=OC(x),w=new cy;return Object.assign(w,v),w})}}async generateImagesInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=JC(this.apiClient,e);return d=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=KC(x),w=new uy;return Object.assign(w,v),w})}else{const h=$C(this.apiClient,e);return d=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=YC(x),w=new uy;return Object.assign(w,v),w})}}async editImageInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=DC(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=MC(p),x=new YE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=z1(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=F1(p),x=new KE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=N1(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=C1(p),x=new QE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=P1(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=k1(p),x=new XE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=f1(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Jd(x))}else{const h=d1(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>$d(x))}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=v1(this.apiClient,e);return d=fe("{models_url}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=w1(x),w=new dy;return Object.assign(w,v),w})}else{const h=x1(this.apiClient,e);return d=fe("{models_url}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=b1(x),w=new dy;return Object.assign(w,v),w})}}async update(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=G1(this.apiClient,e);return d=fe("{model}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Jd(x))}else{const h=V1(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>$d(x))}}async delete(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=CC(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=IC(x),w=new fy;return Object.assign(w,v),w})}else{const h=NC(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=AC(x),w=new fy;return Object.assign(w,v),w})}}async countTokens(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=SC(this.apiClient,e);return d=fe("{model}:countTokens",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=TC(x),w=new hy;return Object.assign(w,v),w})}else{const h=_C(this.apiClient,e);return d=fe("{model}:countTokens",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=EC(x),w=new hy;return Object.assign(w,v),w})}}async computeTokens(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=mC(this.apiClient,e);return o=fe("{model}:computeTokens",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=gC(p),x=new WE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=t1(this.apiClient,e);return d=fe("{model}:predictLongRunning",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>{const v=ZC(x),w=new Al;return Object.assign(w,v),w})}else{const h=e1(this.apiClient,e);return d=fe("{model}:predictLongRunning",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>{const v=WC(x),w=new Al;return Object.assign(w,v),w})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class EA extends ps{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=GE(e);return d=fe("{operationName}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c}else{const h=VE(e);return d=fe("{operationName}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c}}async fetchPredictVideosOperationInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=kE(e);return o=fe("{resourceName}:fetchPredictOperation",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function TA(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function NA(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>kA(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function CA(t,e,n){const r={},a=m(e,["expireTime"]);n!==void 0&&a!=null&&g(n,["expireTime"],a);const o=m(e,["newSessionExpireTime"]);n!==void 0&&o!=null&&g(n,["newSessionExpireTime"],o);const c=m(e,["uses"]);n!==void 0&&c!=null&&g(n,["uses"],c);const d=m(e,["liveConnectConstraints"]);n!==void 0&&d!=null&&g(n,["bidiGenerateContentSetup"],PA(t,d));const p=m(e,["lockAdditionalFields"]);return n!==void 0&&p!=null&&g(n,["fieldMask"],p),r}function AA(t,e){const n={},r=m(e,["config"]);return r!=null&&g(n,["config"],CA(t,r,n)),n}function IA(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function RA(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function DA(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function MA(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],r);const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const d=m(t,["topK"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","topK"],d);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],Af(v));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],NA(Lt(E)));const N=m(t,["tools"]);if(e!==void 0&&N!=null){let q=Ai(N);Array.isArray(q)&&(q=q.map(V=>jA(Ci(V)))),g(e,["setup","tools"],q)}const I=m(t,["sessionResumption"]);e!==void 0&&I!=null&&g(e,["setup","sessionResumption"],UA(I));const P=m(t,["inputAudioTranscription"]);e!==void 0&&P!=null&&g(e,["setup","inputAudioTranscription"],P);const U=m(t,["outputAudioTranscription"]);e!==void 0&&U!=null&&g(e,["setup","outputAudioTranscription"],U);const R=m(t,["realtimeInputConfig"]);e!==void 0&&R!=null&&g(e,["setup","realtimeInputConfig"],R);const A=m(t,["contextWindowCompression"]);e!==void 0&&A!=null&&g(e,["setup","contextWindowCompression"],A);const k=m(t,["proactivity"]);return e!==void 0&&k!=null&&g(e,["setup","proactivity"],k),n}function PA(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],MA(a,n)),n}function kA(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],IA(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],TA(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function UA(t){const e={},n=m(t,["handle"]);if(n!=null&&g(e,["handle"],n),m(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function jA(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],RA(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],DA(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function OA(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(o=>`${n}.${o}`);e.push(...a)}else e.push(n)}return e.join(",")}function LA(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const o=r.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,n=o):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const a=t.fieldMask;if(n){const o=OA(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?t.fieldMask=o:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];a.length>0&&(d=a.map(h=>c.includes(h)?`generationConfig.${h}`:h));const p=[];o&&p.push(o),d.length>0&&p.push(...d),p.length>0?t.fieldMask=p.join(","):delete t.fieldMask}else delete t.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?t.fieldMask=a.join(","):delete t.fieldMask;return t}class qA extends ps{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=AA(this.apiClient,e);o=fe("auth_tokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query;const p=LA(d,e.config);return a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),a.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function BA(t,e){const n={},r=m(t,["displayName"]);return e!==void 0&&r!=null&&g(e,["displayName"],r),n}function VA(t){const e={},n=m(t,["config"]);return n!=null&&BA(n,e),e}function GA(t,e){const n={},r=m(t,["force"]);return e!==void 0&&r!=null&&g(e,["_query","force"],r),n}function HA(t){const e={},n=m(t,["name"]);n!=null&&g(e,["_url","name"],n);const r=m(t,["config"]);return r!=null&&GA(r,e),e}function zA(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","name"],n),e}function FA(t,e){const n={},r=m(t,["customMetadata"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["customMetadata"],o)}const a=m(t,["chunkingConfig"]);return e!==void 0&&a!=null&&g(e,["chunkingConfig"],a),n}function $A(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],YA(c)),e}function JA(t){const e={},n=m(t,["fileSearchStoreName"]);n!=null&&g(e,["_url","file_search_store_name"],n);const r=m(t,["fileName"]);r!=null&&g(e,["fileName"],r);const a=m(t,["config"]);return a!=null&&FA(a,e),e}function YA(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function KA(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function QA(t){const e={},n=m(t,["config"]);return n!=null&&KA(n,e),e}function XA(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["fileSearchStores"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["fileSearchStores"],o)}return e}function WA(t,e){const n={},r=m(t,["mimeType"]);e!==void 0&&r!=null&&g(e,["mimeType"],r);const a=m(t,["displayName"]);e!==void 0&&a!=null&&g(e,["displayName"],a);const o=m(t,["customMetadata"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>p)),g(e,["customMetadata"],d)}const c=m(t,["chunkingConfig"]);return e!==void 0&&c!=null&&g(e,["chunkingConfig"],c),n}function ZA(t){const e={},n=m(t,["fileSearchStoreName"]);n!=null&&g(e,["_url","file_search_store_name"],n);const r=m(t,["config"]);return r!=null&&WA(r,e),e}function e2(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function t2(t,e){const n={},r=m(t,["force"]);return e!==void 0&&r!=null&&g(e,["_query","force"],r),n}function n2(t){const e={},n=m(t,["name"]);n!=null&&g(e,["_url","name"],n);const r=m(t,["config"]);return r!=null&&t2(r,e),e}function s2(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","name"],n),e}function r2(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function i2(t){const e={},n=m(t,["parent"]);n!=null&&g(e,["_url","parent"],n);const r=m(t,["config"]);return r!=null&&r2(r,e),e}function a2(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["documents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class o2 extends ps{constructor(e){super(),this.apiClient=e,this.list=async n=>new Er(fs.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=s2(e);return o=fe("{name}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=n2(e);a=fe("{name}",c._url),o=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=i2(e);return o=fe("{parent}/documents",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=a2(p),x=new ZE;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class l2 extends ps{constructor(e,n=new o2(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new Er(fs.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=VA(e);return o=fe("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=zA(e);return o=fe("{name}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=HA(e);a=fe("{name}",c._url),o=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=QA(e);return o=fe("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=XA(p),x=new eT;return Object.assign(x,h),x})}}async uploadToFileSearchStoreInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=ZA(e);return o=fe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=e2(p),x=new tT;return Object.assign(x,h),x})}}async importFile(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=JA(e);return o=fe("{file_search_store_name}:importFile",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=$A(p),x=new Sf;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function c2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function u2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function d2(t,e,n){const r={};if(m(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=m(t,["tunedModelDisplayName"]);if(e!==void 0&&a!=null&&g(e,["displayName"],a),m(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=m(t,["epochCount"]);e!==void 0&&o!=null&&g(e,["tuningTask","hyperparameters","epochCount"],o);const c=m(t,["learningRateMultiplier"]);if(c!=null&&g(r,["tuningTask","hyperparameters","learningRateMultiplier"],c),m(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(m(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(m(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=m(t,["batchSize"]);e!==void 0&&d!=null&&g(e,["tuningTask","hyperparameters","batchSize"],d);const p=m(t,["learningRate"]);if(e!==void 0&&p!=null&&g(e,["tuningTask","hyperparameters","learningRate"],p),m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(m(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function f2(t,e,n){const r={};let a=m(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const _=m(t,["validationDataset"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec"],Uy(_))}else if(a==="PREFERENCE_TUNING"){const _=m(t,["validationDataset"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec"],Uy(_))}const o=m(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&g(e,["tunedModelDisplayName"],o);const c=m(t,["description"]);e!==void 0&&c!=null&&g(e,["description"],c);let d=m(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const _=m(t,["epochCount"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],_)}else if(d==="PREFERENCE_TUNING"){const _=m(t,["epochCount"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],_)}let p=m(n,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const _=m(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],_)}else if(p==="PREFERENCE_TUNING"){const _=m(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],_)}let h=m(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const _=m(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],_)}else if(h==="PREFERENCE_TUNING"){const _=m(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],_)}let x=m(n,["config","method"]);if(x===void 0&&(x="SUPERVISED_FINE_TUNING"),x==="SUPERVISED_FINE_TUNING"){const _=m(t,["adapterSize"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],_)}else if(x==="PREFERENCE_TUNING"){const _=m(t,["adapterSize"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],_)}if(m(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(m(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const v=m(t,["labels"]);e!==void 0&&v!=null&&g(e,["labels"],v);const w=m(t,["beta"]);return e!==void 0&&w!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],w),r}function h2(t,e){const n={},r=m(t,["baseModel"]);r!=null&&g(n,["baseModel"],r);const a=m(t,["preTunedModel"]);a!=null&&g(n,["preTunedModel"],a);const o=m(t,["trainingDataset"]);o!=null&&E2(o);const c=m(t,["config"]);return c!=null&&d2(c,n),n}function p2(t,e){const n={},r=m(t,["baseModel"]);r!=null&&g(n,["baseModel"],r);const a=m(t,["preTunedModel"]);a!=null&&g(n,["preTunedModel"],a);const o=m(t,["trainingDataset"]);o!=null&&T2(o,n,e);const c=m(t,["config"]);return c!=null&&f2(c,n,e),n}function m2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function g2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function y2(t,e,n){const r={},a=m(t,["pageSize"]);e!==void 0&&a!=null&&g(e,["_query","pageSize"],a);const o=m(t,["pageToken"]);e!==void 0&&o!=null&&g(e,["_query","pageToken"],o);const c=m(t,["filter"]);return e!==void 0&&c!=null&&g(e,["_query","filter"],c),r}function x2(t,e,n){const r={},a=m(t,["pageSize"]);e!==void 0&&a!=null&&g(e,["_query","pageSize"],a);const o=m(t,["pageToken"]);e!==void 0&&o!=null&&g(e,["_query","pageToken"],o);const c=m(t,["filter"]);return e!==void 0&&c!=null&&g(e,["_query","filter"],c),r}function v2(t,e){const n={},r=m(t,["config"]);return r!=null&&y2(r,n),n}function b2(t,e){const n={},r=m(t,["config"]);return r!=null&&x2(r,n),n}function w2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["nextPageToken"]);a!=null&&g(n,["nextPageToken"],a);const o=m(t,["tunedModels"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>rv(d))),g(n,["tuningJobs"],c)}return n}function _2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["nextPageToken"]);a!=null&&g(n,["nextPageToken"],a);const o=m(t,["tuningJobs"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>Kd(d))),g(n,["tuningJobs"],c)}return n}function S2(t,e){const n={},r=m(t,["name"]);r!=null&&g(n,["model"],r);const a=m(t,["name"]);return a!=null&&g(n,["endpoint"],a),n}function E2(t,e){const n={};if(m(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=m(t,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(n,["examples","examples"],a)}return n}function T2(t,e,n){const r={};let a=m(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const c=m(t,["gcsUri"]);e!==void 0&&c!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(a==="PREFERENCE_TUNING"){const c=m(t,["gcsUri"]);e!==void 0&&c!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}let o=m(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const c=m(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(o==="PREFERENCE_TUNING"){const c=m(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}if(m(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function rv(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["state"]);o!=null&&g(n,["state"],qx(o));const c=m(t,["createTime"]);c!=null&&g(n,["createTime"],c);const d=m(t,["tuningTask","startTime"]);d!=null&&g(n,["startTime"],d);const p=m(t,["tuningTask","completeTime"]);p!=null&&g(n,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(n,["updateTime"],h);const x=m(t,["description"]);x!=null&&g(n,["description"],x);const v=m(t,["baseModel"]);v!=null&&g(n,["baseModel"],v);const w=m(t,["_self"]);return w!=null&&g(n,["tunedModel"],S2(w)),n}function Kd(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["state"]);o!=null&&g(n,["state"],qx(o));const c=m(t,["createTime"]);c!=null&&g(n,["createTime"],c);const d=m(t,["startTime"]);d!=null&&g(n,["startTime"],d);const p=m(t,["endTime"]);p!=null&&g(n,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(n,["updateTime"],h);const x=m(t,["error"]);x!=null&&g(n,["error"],x);const v=m(t,["description"]);v!=null&&g(n,["description"],v);const w=m(t,["baseModel"]);w!=null&&g(n,["baseModel"],w);const _=m(t,["tunedModel"]);_!=null&&g(n,["tunedModel"],_);const E=m(t,["preTunedModel"]);E!=null&&g(n,["preTunedModel"],E);const N=m(t,["supervisedTuningSpec"]);N!=null&&g(n,["supervisedTuningSpec"],N);const I=m(t,["preferenceOptimizationSpec"]);I!=null&&g(n,["preferenceOptimizationSpec"],I);const P=m(t,["tuningDataStats"]);P!=null&&g(n,["tuningDataStats"],P);const U=m(t,["encryptionSpec"]);U!=null&&g(n,["encryptionSpec"],U);const R=m(t,["partnerModelTuningSpec"]);R!=null&&g(n,["partnerModelTuningSpec"],R);const A=m(t,["customBaseModel"]);A!=null&&g(n,["customBaseModel"],A);const k=m(t,["experiment"]);k!=null&&g(n,["experiment"],k);const q=m(t,["labels"]);q!=null&&g(n,["labels"],q);const V=m(t,["outputUri"]);V!=null&&g(n,["outputUri"],V);const W=m(t,["pipelineJob"]);W!=null&&g(n,["pipelineJob"],W);const J=m(t,["serviceAccount"]);J!=null&&g(n,["serviceAccount"],J);const $=m(t,["tunedModelDisplayName"]);$!=null&&g(n,["tunedModelDisplayName"],$);const ce=m(t,["veoTuningSpec"]);return ce!=null&&g(n,["veoTuningSpec"],ce),n}function N2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["metadata"]);o!=null&&g(n,["metadata"],o);const c=m(t,["done"]);c!=null&&g(n,["done"],c);const d=m(t,["error"]);return d!=null&&g(n,["error"],d),n}function Uy(t,e){const n={},r=m(t,["gcsUri"]);r!=null&&g(n,["validationDatasetUri"],r);const a=m(t,["vertexDatasetResource"]);return a!=null&&g(n,["validationDatasetUri"],a),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class C2 extends ps{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new Er(fs.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const a={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=n.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},n),{preTunedModel:a});return o.baseModel=void 0,await this.tuneInternal(o)}else{const a=Object.assign({},n);return await this.tuneInternal(a)}else{const a=Object.assign({},n),o=await this.tuneMldevInternal(a);let c="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?c=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(c=o.name.split("/operations/")[0]),{name:c,state:Gd.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=g2(e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>Kd(x))}else{const h=m2(e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>rv(x))}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=b2(e);return d=fe("tuningJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=_2(x),w=new py;return Object.assign(w,v),w})}else{const h=v2(e);return d=fe("tunedModels",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=w2(x),w=new py;return Object.assign(w,v),w})}}async cancel(e){var n,r,a,o;let c="",d={};if(this.apiClient.isVertexAI()){const p=u2(e);c=fe("{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const p=c2(e);c=fe("{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=p2(e,e);return o=fe("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>Kd(p))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=h2(e);return o=fe("tunedModels",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>N2(p))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class A2{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const I2=1024*1024*8,R2=3,D2=1e3,M2=2,Rl="x-goog-upload-status";async function P2(t,e,n){var r;const a=await iv(t,e,n),o=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[Rl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function k2(t,e,n){var r;const a=await iv(t,e,n),o=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[Rl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const c=Px(o),d=new Ef;return Object.assign(d,c),d}async function iv(t,e,n){var r,a;let o=0,c=0,d=new Hd(new Response),p="upload";for(o=t.size;c<o;){const h=Math.min(I2,o-c),x=t.slice(c,c+h);c+h>=o&&(p+=", finalize");let v=0,w=D2;for(;v<R2&&(d=await n.request({path:"",body:x,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(c),"Content-Length":String(h)}}}),!(!((r=d==null?void 0:d.headers)===null||r===void 0)&&r[Rl]));)v++,await j2(w),w=w*M2;if(c+=h,((a=d==null?void 0:d.headers)===null||a===void 0?void 0:a[Rl])!=="active")break;if(o<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function U2(t){return{size:t.size,type:t.type}}function j2(t){return new Promise(e=>setTimeout(e,t))}class O2{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await P2(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await k2(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await U2(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class L2{create(e,n,r){return new q2(e,n,r)}}class q2{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jy="x-goog-api-key";class B2{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(jy)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(jy,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const V2="gl-node/";class un{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=ME(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const a=new B2(this.apiKey);this.apiClient=new rA({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:V2+"web",uploader:new O2,downloader:new A2}),this.models=new SA(this.apiClient),this.live=new yA(this.apiClient,a,new L2),this.batches=new sN(this.apiClient),this.chats=new UN(this.models,this.apiClient),this.caches=new MN(this.apiClient),this.files=new FN(this.apiClient),this.operations=new EA(this.apiClient),this.authTokens=new qA(this.apiClient),this.tunings=new C2(this.apiClient),this.fileSearchStores=new l2(this.apiClient)}}const av="text-embedding-004",Fs=768,G2=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>{const o=r.result.split(",")[1];e({inlineData:{data:o,mimeType:t.type}})},r.onerror=a=>n(a)}),kn=async t=>{var e,n;if(!t||t.trim()==="")return new Array(Fs).fill(0);try{const a=await new un({apiKey:"AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c"}).models.embedContent({model:av,contents:[{parts:[{text:t}]}]});if((n=(e=a.embeddings)==null?void 0:e[0])!=null&&n.values)return a.embeddings[0].values;throw new Error("No embedding values returned from embedding service.")}catch(r){return console.error("Error generating embedding:",r),new Array(Fs).fill(0)}},H2=async t=>{var e,n;try{const r=new un({apiKey:"AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c"}),a=await G2(t),o=await r.models.embedContent({model:av,contents:[{parts:[a]}]});if((n=(e=o.embeddings)==null?void 0:e[0])!=null&&n.values)return o.embeddings[0].values;throw new Error("No embedding values returned from image embedding service.")}catch(r){return console.error("Error generating image embedding:",r),new Array(Fs).fill(0)}},z2=async(t,e,n=.7,r=.3)=>{const a=await kn(t);if(!e)return a;const o=await H2(e);return a.map((c,d)=>c*n+o[d]*r)},Sd=["users","shops","customers","suppliers","products","items","inventory","batches","sales","drivers","visual","marketplace","dan_inventory"],F2="58fc3ff2-2f13-11ef-b75e-0242ac110002",Dl={size:Fs,distance:"Cosine"},$2=t=>{var n,r,a;let e=t.trim();for(;e.endsWith("/");)e=e.slice(0,-1);if((e.includes(":6333")||e.includes("localhost:6333")||e.includes("127.0.0.1:6333"))&&console.warn("[Qdrant Core] Detected port 6333 in URL - this is the default Qdrant port and may not work in production:",e),e&&!e.startsWith("http://")&&!e.startsWith("https://"))if(typeof window<"u"&&window.location){const o=window.location.origin,c=e.startsWith("/")?e:`/${e}`;e=`${o}${c}`,console.log("[Qdrant Core] Converted relative URL to absolute:",t,"->",e)}else if(console.warn("[Qdrant Core] Relative URL detected but window.location not available. Raw URL:",t),typeof window<"u")try{const o=((n=window.location)==null?void 0:n.origin)||((r=window.location)!=null&&r.protocol&&((a=window.location)!=null&&a.host)?`${window.location.protocol}//${window.location.host}`:"https://localhost"),c=e.startsWith("/")?e:`/${e}`;e=`${o}${c}`,console.log("[Qdrant Core] Fallback URL conversion:",t,"->",e)}catch(o){console.error("[Qdrant Core] Failed to convert relative URL, using localhost fallback:",o),e=`http://localhost:8787${e.startsWith("/")?e:`/${e}`}`}else e=`http://localhost:8787${e.startsWith("/")?e:`/${e}`}`;return e},J2=()=>"/qdrant";let dl=null,Oy=!1;const Ed=()=>{if(dl)return dl;if(Oy)return null;Oy=!0;const t=J2(),e=$2(t);if(!e)return console.error("[Qdrant Core] No Qdrant URL provided"),null;if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.error("[Qdrant Core] Invalid Qdrant URL - must start with http:// or https://:",e),null;try{const n=new URL(e);console.log("[Qdrant Core] Initializing Qdrant client with URL:",e),console.log("[Qdrant Core] URL breakdown - protocol:",n.protocol,"host:",n.host,"pathname:",n.pathname);let r=e;if(!r.endsWith("/qdrant")&&!r.endsWith("/qdrant/")){const a=new URL(e);a.pathname==="/"||a.pathname===""?a.pathname="/qdrant":a.pathname.endsWith("/qdrant")||(a.pathname=a.pathname.replace(/\/$/,"")+"/qdrant"),r=a.toString(),console.log("[Qdrant Core] Adjusted URL to ensure /qdrant path:",r)}return dl=new AE({url:r}),console.log("[Qdrant Core] QdrantClient created successfully with URL:",r),console.log("[Qdrant Core] Client will make requests to:",r+"/collections"),dl}catch(n){return console.error("[Qdrant Core] Failed to create Qdrant client - invalid URL:",e,n),null}},pe=new Proxy({},{get(t,e){const n=Ed();if(!n)return;const r=n[e];return typeof r=="function"?r.bind(n):r},has(t,e){const n=Ed();return n?e in n:!1},ownKeys(t){const e=Ed();return e?Object.keys(e):[]}});let le=null,Ri=null,za=null;const Ly=t=>{const e=le;le=(t==null?void 0:t.id)||null,Ri=(t==null?void 0:t.name)||null,t!=null&&t.contactEmail,t!=null&&t.location,za=(t==null?void 0:t.qdrantNamespace)||null,e!==le&&console.log(`[Core] setActiveShopContext: ${e||"null"} -> ${le||"null"}`)},Y2={users:{userId:{type:"keyword"},displayName:{type:"keyword"},contactEmail:{type:"keyword"},email:{type:"keyword"},shopId:{type:"keyword"},isVerified:{type:"bool"},isDriverVerified:{type:"bool"}},shops:{shopId:{type:"keyword"},userId:{type:"keyword"},name:{type:"keyword"}},suppliers:{supplierId:{type:"keyword"},shopId:{type:"keyword"},linkedUserId:{type:"keyword"},name:{type:"keyword"}},products:{productId:{type:"keyword"},category:{type:"keyword"},manufacturer:{type:"keyword"},defaultSupplierId:{type:"keyword"}},items:{inventoryUuid:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"},batchId:{type:"keyword"},supplierId:{type:"keyword"},status:{type:"keyword"},quantity:{type:"integer"},expiration:{type:"keyword"}},batches:{batchId:{type:"keyword"},shopId:{type:"keyword"},supplierId:{type:"keyword"},deliveryDate:{type:"keyword"},inventoryDate:{type:"keyword"}},sales:{saleId:{type:"keyword"},shopId:{type:"keyword"},timestamp:{type:"keyword"}},customers:{customerId:{type:"keyword"},userId:{type:"keyword"},name:{type:"keyword"}},drivers:{driverId:{type:"keyword"},userId:{type:"keyword"},status:{type:"keyword"}},visual:{shopId:{type:"keyword"},productId:{type:"keyword"},fieldName:{type:"keyword"}},marketplace:{listingId:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"}},dan_inventory:{inventoryUuid:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"},productName:{type:"keyword"},locationBucket:{type:"keyword"},shareScope:{type:"keyword"},expirationDate:{type:"keyword"}}},_n=new Map,Si=t=>t?typeof t=="string"?t:t.message||t.statusText||JSON.stringify(t):"Unknown error",Bt=(t,e)=>{new Date().toISOString();const n=`[Qdrant] ${e}`;t==="error"?console.error(n):t==="warn"?console.warn(n):console.info(n)},K2=t=>{if(!t)return{params:null,named:!1,vectorName:null};if(typeof t.size=="number")return{params:t,named:!1,vectorName:null};const e=Object.keys(t||{});if("default"in t&&t.default&&typeof t.default.size=="number"){const n=e.some(r=>r!=="default");return{params:t.default,named:n,vectorName:n?"default":null}}if(e.length>=1){const n=e.find(r=>t[r]&&typeof t[r].size=="number");if(n)return{params:t[n],named:n!=="default",vectorName:n}}return{params:null,named:!0,vectorName:null}},Q2=async t=>{if(!pe)return!1;const e=Y2[t];if(!e)return!0;try{const n=await pe.getCollection(t),r=(n==null?void 0:n.payload_schema)||{};for(const[a,o]of Object.entries(e)){const c=r==null?void 0:r[a],d=c==null?void 0:c.data_type;if(d!==o.type){if(c&&d!==o.type)try{await pe.deletePayloadIndex(t,a),Bt("info",`Deleted existing index '${t}.${a}' (wrong type)`)}catch(p){Bt("warn",`Failed to delete index '${t}.${a}': ${Si(p)}`)}try{await pe.createPayloadIndex(t,{field_name:a,field_schema:o}),Bt("info",`Created index '${t}.${a}' (${o.type})`)}catch(p){Bt("error",`Failed to create index '${t}.${a}': ${Si(p)}`)}}}return!0}catch(n){return Bt("error",`Failed to ensure indexes for '${t}': ${Si(n)}`),!1}},X2=async t=>{var e,n;if(!pe)return{exists:!1,valid:!1,vectorConfig:null};try{const r=await pe.getCollection(t),{params:a,named:o,vectorName:c}=K2((n=(e=r==null?void 0:r.config)==null?void 0:e.params)==null?void 0:n.vectors),d=(a==null?void 0:a.size)===Dl.size&&(a==null?void 0:a.distance)===Dl.distance;return{exists:!0,valid:d,vectorConfig:d?{named:o,vectorName:o?c||"default":null}:null}}catch(r){return r.status===404?{exists:!1,valid:!1,vectorConfig:null}:(Bt("error",`Error verifying collection '${t}': ${Si(r)}`),{exists:!1,valid:!1,vectorConfig:null})}},ov=async t=>{if(!pe)return!1;const e=_n.get(t);if(e!=null&&e.ready)return!0;if(e!=null&&e.promise)return e.promise;e||_n.set(t,{ready:!1,promise:null,vectorConfig:null});const n=(async()=>{try{const{exists:r,valid:a,vectorConfig:o}=await X2(t);return r?a?(_n.set(t,{ready:!1,promise:null,vectorConfig:o}),await Q2(t)?(_n.set(t,{ready:!0,promise:null,vectorConfig:o}),Bt("info",`Collection '${t}' is ready`),!0):(_n.set(t,{ready:!1,promise:null,vectorConfig:o}),!1)):(Bt("error",`Collection '${t}' has invalid configuration. Expected: size=${Dl.size}, distance=${Dl.distance}`),_n.set(t,{ready:!1,promise:null,vectorConfig:null}),!1):(Bt("error",`Collection '${t}' does not exist. Please run setup script first.`),_n.set(t,{ready:!1,promise:null,vectorConfig:null}),!1)}catch(r){return Bt("error",`Failed to ensure collection '${t}': ${Si(r)}`),_n.set(t,{ready:!1,promise:null,vectorConfig:null}),!1}finally{const r=_n.get(t);r&&(r.promise=null)}})();return _n.set(t,{ready:!1,promise:n,vectorConfig:null}),n},lv=async()=>{if(!pe){Bt("warn","Qdrant client not available");return}Bt("info","Ensuring all base collections are ready...");const t=await Promise.allSettled(Sd.map(r=>ov(r))),e=[],n=[];t.forEach((r,a)=>{const o=Sd[a];if(r.status==="fulfilled"&&r.value)e.push(o);else{n.push(o);const c=r.status==="rejected"?Si(r.reason):"Not ready";Bt("warn",`Collection '${o}' failed: ${c}`)}}),Bt("info",`Collections ready: ${e.length}/${Sd.length}. Ready: ${e.join(", ")}${n.length>0?` | Failed: ${n.join(", ")}`:""}`)},cv=t=>{var e;return((e=_n.get(t))==null?void 0:e.vectorConfig)||null},uv=t=>{var e;return((e=_n.get(t))==null?void 0:e.ready)||!1},tt=async t=>{const e=await ov(t);return e||Bt("warn",`Collection '${t}' is not ready  operation will be skipped`),e},W2=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Z2(t){return typeof t=="string"&&W2.test(t)}function qy(t){if(!Z2(t))throw TypeError("Invalid UUID");let e;return Uint8Array.of((e=parseInt(t.slice(0,8),16))>>>24,e>>>16&255,e>>>8&255,e&255,(e=parseInt(t.slice(9,13),16))>>>8,e&255,(e=parseInt(t.slice(14,18),16))>>>8,e&255,(e=parseInt(t.slice(19,23),16))>>>8,e&255,(e=parseInt(t.slice(24,36),16))/1099511627776&255,e/4294967296&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255)}const kt=[];for(let t=0;t<256;++t)kt.push((t+256).toString(16).slice(1));function dv(t,e=0){return(kt[t[e+0]]+kt[t[e+1]]+kt[t[e+2]]+kt[t[e+3]]+"-"+kt[t[e+4]]+kt[t[e+5]]+"-"+kt[t[e+6]]+kt[t[e+7]]+"-"+kt[t[e+8]]+kt[t[e+9]]+"-"+kt[t[e+10]]+kt[t[e+11]]+kt[t[e+12]]+kt[t[e+13]]+kt[t[e+14]]+kt[t[e+15]]).toLowerCase()}let Td;const eI=new Uint8Array(16);function tI(){if(!Td){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Td=crypto.getRandomValues.bind(crypto)}return Td(eI)}function nI(t){t=unescape(encodeURIComponent(t));const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e}const sI="6ba7b810-9dad-11d1-80b4-00c04fd430c8",rI="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function iI(t,e,n,r,a,o){const c=typeof n=="string"?nI(n):n,d=typeof r=="string"?qy(r):r;if(typeof r=="string"&&(r=qy(r)),(r==null?void 0:r.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let p=new Uint8Array(16+c.length);if(p.set(d),p.set(c,d.length),p=e(p),p[6]=p[6]&15|t,p[8]=p[8]&63|128,a){o=o||0;for(let h=0;h<16;++h)a[o+h]=p[h];return a}return dv(p)}const aI=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),By={randomUUID:aI};function oI(t,e,n){var a;t=t||{};const r=t.random??((a=t.rng)==null?void 0:a.call(t))??tI();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,dv(r)}function Ct(t,e,n){return By.randomUUID&&!t?By.randomUUID():oI(t)}function lI(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}}function Nd(t,e){return t<<e|t>>>32-e}function cI(t){const e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520],r=new Uint8Array(t.length+1);r.set(t),r[t.length]=128,t=r;const a=t.length/4+2,o=Math.ceil(a/16),c=new Array(o);for(let d=0;d<o;++d){const p=new Uint32Array(16);for(let h=0;h<16;++h)p[h]=t[d*64+h*4]<<24|t[d*64+h*4+1]<<16|t[d*64+h*4+2]<<8|t[d*64+h*4+3];c[d]=p}c[o-1][14]=(t.length-1)*8/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=(t.length-1)*8&4294967295;for(let d=0;d<o;++d){const p=new Uint32Array(80);for(let E=0;E<16;++E)p[E]=c[d][E];for(let E=16;E<80;++E)p[E]=Nd(p[E-3]^p[E-8]^p[E-14]^p[E-16],1);let h=n[0],x=n[1],v=n[2],w=n[3],_=n[4];for(let E=0;E<80;++E){const N=Math.floor(E/20),I=Nd(h,5)+lI(N,x,v,w)+_+e[N]+p[E]>>>0;_=w,w=v,v=Nd(x,30)>>>0,x=h,h=I}n[0]=n[0]+h>>>0,n[1]=n[1]+x>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+w>>>0,n[4]=n[4]+_>>>0}return Uint8Array.of(n[0]>>24,n[0]>>16,n[0]>>8,n[0],n[1]>>24,n[1]>>16,n[1]>>8,n[1],n[2]>>24,n[2]>>16,n[2]>>8,n[2],n[3]>>24,n[3]>>16,n[3]>>8,n[3],n[4]>>24,n[4]>>16,n[4]>>8,n[4])}function Rf(t,e,n,r){return iI(80,cI,t,e,n,r)}Rf.DNS=sI;Rf.URL=rI;const Vt=(t,e)=>Rf(`${t}:${e}`,F2),zn=t=>{const e=String(t||"default"),n=new Array(Fs).fill(0);for(let r=0;r<Fs;r++)n[r]=(e.charCodeAt(r%e.length)||0)%100/1e3;return n},Gt=(t,e,n)=>{const r=()=>zn(e);if(!Array.isArray(t))return r();if(t.length!==Fs)return console.warn(`[Qdrant] ${n}: Vector length ${t.length} != ${Fs}. Using placeholder.`),r();for(let a=0;a<t.length;a++){const o=t[a];if(typeof o!="number"||!Number.isFinite(o))return console.warn(`[Qdrant] ${n}: Invalid vector value at index ${a}: ${o}. Using placeholder.`),r()}return t},dn=(t,e)=>{const n=cv(t);return n!=null&&n.named?{vectors:{[n.vectorName||"default"]:e}}:{vector:e}},uI=(t,e)=>{const n=cv(t);return n!=null&&n.named?{name:n.vectorName||"default",vector:e}:e},fv=(t,e)=>e?{key:"shopId",match:{value:e}}:null,bt=async(t,e)=>{if(!pe)return[];if(!uv(t)&&!await tt(t))return[];const n=[];let r,a=3,o=null;e&&(typeof e=="string"?o=e:typeof e=="object"&&e!==null&&"id"in e?(o=e.id||null,console.warn(`[Qdrant] fetchAllPoints received shopFilter as object instead of string. Extracted id: ${o}`)):console.warn(`[Qdrant] fetchAllPoints received invalid shopFilter type: ${typeof e}`));const c=fv(t,o),d=c?{must:[c]}:void 0,p=1e3;do{try{const h=await pe.scroll(t,{with_payload:!0,limit:p,offset:r??void 0,filter:d}),x=(h==null?void 0:h.points)??[];n.push(...x),r=(h==null?void 0:h.next_page_offset)??void 0}catch(h){if((h==null?void 0:h.status)===400&&o&&t==="items"&&a>0){console.warn(`[Qdrant] Filter failed for 'items' collection with shopId filter. This may indicate a data structure issue. Error: ${h.message}`),console.warn("[Qdrant] Falling back to JavaScript filtering for 'items' collection (inefficient)");const x=[];let v;do try{const _=await pe.scroll(t,{with_payload:!0,limit:p,offset:v??void 0});x.push(...(_==null?void 0:_.points)??[]),v=(_==null?void 0:_.next_page_offset)??void 0}catch(_){console.error("[Qdrant] Error in JavaScript filter fallback:",_);break}while(v);return x.filter(_=>{var N;const E=(N=_.payload)==null?void 0:N.shopId;return typeof E=="string"?E===o:E&&typeof E=="object"&&"id"in E?E.id===o:!1})}if(console.error(`[Qdrant] Scroll error in '${t}' (Retry ${a}, Filter: ${JSON.stringify(d)}):`,h),(h==null?void 0:h.status)===400&&a>0){console.info(`[Qdrant] Retrying scroll in '${t}'...`),a--,await new Promise(x=>setTimeout(x,1e3));continue}r=void 0}if(!r||n.length>1e5)break}while(r);return n},dI=async(t,e,n,r=10)=>{if(!pe)return[];if(!uv(t)&&!await tt(t))return[];const a=[];if(n.shopId){const o=typeof n.shopId=="string"?n.shopId:n.shopId&&typeof n.shopId=="object"&&n.shopId!==null&&"id"in n.shopId?n.shopId.id:null;if(o){const c=fv(t,o);c&&a.push(c)}}n.status&&a.push({key:"status",match:{value:n.status}}),n.quantityMin!==void 0&&a.push({key:"quantity",range:{gt:n.quantityMin}}),Object.entries(n).forEach(([o,c])=>{!["shopId","status","quantityMin"].includes(o)&&c!==void 0&&a.push({key:o,match:{value:c}})});try{const o=await pe.search(t,{vector:e,limit:r,with_payload:!0,filter:a.length>0?{must:a}:void 0});return Array.isArray(o)?o:(o==null?void 0:o.points)??[]}catch(o){return console.error(`[Qdrant] Search failed in '${t}':`,o),[]}},hv=t=>{const e=t.payload;return{id:(e==null?void 0:e.productId)||String(t.id),name:(e==null?void 0:e.name)||"Unnamed Product",manufacturer:(e==null?void 0:e.manufacturer)||"",category:(e==null?void 0:e.category)||"",description:(e==null?void 0:e.description)||"",defaultSupplierId:(e==null?void 0:e.defaultSupplierId)||null,images:(e==null?void 0:e.images)||[],audit:(e==null?void 0:e.audit)||[],embeddings:(e==null?void 0:e.embeddings)||void 0}},Fa=async()=>pe?(await bt("products",null)).map(hv):[],Df=async(t,e)=>{if(!pe||!await tt("products"))return;const n=Array.isArray(t.embeddings)&&t.embeddings.length>0,r=Gt(n?t.embeddings:null,t.id,`products:${t.id}`),a=n&&r===t.embeddings?r:void 0,o=Vt("products",t.id),c={productId:t.id,name:t.name,manufacturer:t.manufacturer,category:t.category,description:t.description||"",defaultSupplierId:t.defaultSupplierId||null,images:t.images||[],audit:e?[...t.audit||[],e]:t.audit||[],embeddings:a};await pe.upsert("products",{wait:!0,points:[{id:o,...dn("products",r),payload:c}]})},Di=async t=>{var r;const e={id:Ct(),name:t.name.trim(),manufacturer:t.manufacturer.trim(),category:t.category.trim(),description:((r=t.description)==null?void 0:r.trim())||"",defaultSupplierId:t.defaultSupplierId||null,images:t.images||[],audit:[],embeddings:t.embeddings||(t.name?await kn(t.name):zn(Ct()))},n=le?{userId:le,shopId:le,action:"create",timestamp:new Date().toISOString()}:void 0;return await Df(e,n),e},pv=async(t,e)=>{var d,p,h;const r=(await Fa()).find(x=>x.id===t);if(!r)throw new Error(`Product with ID ${t} not found`);const a=e.embeddings||(e.name&&e.name!==r.name?await kn(e.name):r.embeddings),o={...r,name:((d=e.name)==null?void 0:d.trim())||r.name,manufacturer:((p=e.manufacturer)==null?void 0:p.trim())||r.manufacturer,category:((h=e.category)==null?void 0:h.trim())||r.category,description:e.description!==void 0?e.description.trim():r.description,defaultSupplierId:e.defaultSupplierId!==void 0?e.defaultSupplierId:r.defaultSupplierId,images:e.images!==void 0?e.images:r.images,embeddings:a},c=le?{userId:le,shopId:le,action:"update",timestamp:new Date().toISOString()}:void 0;return await Df(o,c),o},mv=async t=>{pe&&await tt("products")&&await pe.delete("products",{wait:!0,points:[Vt("products",t)]})},gv=async(t,e=24)=>{if(!pe)return[];const n=t.trim();if(!n)return(await Fa()).slice(0,e);if(!await tt("products"))return[];const r=await kn(n),a=Gt(r,`products:search:${n}`,`products-search:${Date.now()}`);return(await pe.search("products",{vector:a,limit:e,with_payload:!0})).map(hv).filter(c=>!!c.name)},yv=async t=>pe?(await bt("batches",t)).map(n=>{const r=n.payload;return{id:(r==null?void 0:r.batchId)||String(n.id),shopId:r==null?void 0:r.shopId,supplierId:r==null?void 0:r.supplierId,deliveryDate:r==null?void 0:r.deliveryDate,inventoryDate:r==null?void 0:r.inventoryDate,invoiceNumber:r==null?void 0:r.invoiceNumber,documents:(r==null?void 0:r.documents)||[],lineItems:(r==null?void 0:r.lineItems)||[],createdAt:r==null?void 0:r.createdAt,createdByUserId:r==null?void 0:r.createdByUserId}}):[],xv=async()=>le?yv(le):[],Mf=async t=>{if(!pe||!await tt("batches"))return;const e=Gt(zn(t.id),t.id,`batches:${t.id}`),n=Vt("batches",t.id),r={batchId:t.id,shopId:t.shopId,supplierId:t.supplierId||null,deliveryDate:t.deliveryDate,inventoryDate:t.inventoryDate||null,invoiceNumber:t.invoiceNumber||null,documents:t.documents||[],lineItems:t.lineItems||[],createdAt:t.createdAt,createdByUserId:t.createdByUserId};await pe.upsert("batches",{wait:!0,points:[{id:n,...dn("batches",e),payload:r}]})},Tr=async t=>{if(!pe||!await tt("users"))return;const e=t.qdrantUserId||t.userId,n=Vt("users",e);let r={};try{const c=await pe.retrieve("users",{ids:[n],with_payload:!0});if(c.points&&c.points.length>0){const d=c.points[0].payload;r={isVerified:d.isVerified,isDriverVerified:d.isDriverVerified}}}catch{}const a={userId:t.userId,displayName:t.displayName||t.email||t.userId,contactEmail:t.contactEmail||t.email||"",email:t.email||t.contactEmail||"",shopId:t.shopId||le||null,isVerified:t.isVerified!==void 0?t.isVerified:r.isVerified,isDriverVerified:t.isDriverVerified!==void 0?t.isDriverVerified:r.isDriverVerified},o=Gt(zn(e),e,`users:${e}`);await pe.upsert("users",{wait:!0,points:[{id:n,payload:a,...dn("users",o)}]})},vv=async()=>{},bv=async t=>{if(!pe||!await tt("shops"))return;const e=Gt(zn(t.id),t.id,`shops:${t.id}`),n=Vt("shops",t.id),r={shopId:t.id,userId:t.userId||"",name:t.name,contact:t.contactEmail||"",contactEmail:t.contactEmail||"",qdrantNamespace:t.qdrantNamespace||null,metadata:t.location?{location:t.location}:{}};await pe.upsert("shops",{wait:!0,points:[{id:n,...dn("shops",e),payload:r}]})},wv=async t=>{if(!pe||!await tt("customers"))return;const e=Gt(zn(t.id),t.id,`customers:${t.id}`),n=Vt("customers",t.id);await pe.upsert("customers",{wait:!0,points:[{id:n,...dn("customers",e),payload:{customerId:t.id,userId:t.userId||null,name:t.fullName,contact:t.contactEmail||""}}]})},$l=async t=>{if(!pe||!await tt("drivers"))return;const e=Gt(zn(t.id),t.id,`drivers:${t.id}`),n=Vt("drivers",t.id);await pe.upsert("drivers",{wait:!0,points:[{id:n,...dn("drivers",e),payload:{driverId:t.id,userId:t.userId||null,name:t.fullName,contact:t.contactEmail||"",status:t.status||"pending"}}]})},Pf=async t=>{if(!pe||!await tt("suppliers"))return;const e=t.name?await kn(t.name):null,n=Gt(e,t.id,`suppliers:${t.id}`),r=Vt("suppliers",t.id),a={supplierId:t.id,name:t.name,contact:t.contactEmail||"",contactEmail:t.contactEmail||"",shopId:t.shopId||null,linkedUserId:t.linkedUserId||t.userId||null,metadata:t.metadata||{},embeddings:n};await pe.upsert("suppliers",{wait:!0,points:[{id:r,...dn("suppliers",n),payload:a}]})},Js=async()=>!pe||!le?[]:(await bt("suppliers",null)).map(e=>{const n=e.payload;return{id:(n==null?void 0:n.supplierId)||String(e.id),shopId:(n==null?void 0:n.shopId)||null,linkedUserId:(n==null?void 0:n.linkedUserId)||(n==null?void 0:n.userId)||null,name:(n==null?void 0:n.name)||"Supplier",contact:(n==null?void 0:n.contact)||"",contactEmail:(n==null?void 0:n.contact)||(n==null?void 0:n.contactEmail)||"",metadata:(n==null?void 0:n.metadata)||{}}}).filter(e=>e.shopId===le||e.linkedUserId!==null),Mi=async t=>{if(!le)throw new Error("No shop selected.");const e=Ct();return await Pf({id:e,name:t.name,contactEmail:t.contactEmail,shopId:le,linkedUserId:null}),{id:e,shopId:le,linkedUserId:null,name:t.name,contact:t.contactEmail,contactEmail:t.contactEmail,metadata:{}}},_v=async()=>pe?await tt("shops")?(await bt("shops",null)).map(e=>{const n=e.payload;return{id:n.shopId,name:n.name,contactEmail:n.contactEmail||n.contact}}):[]:[],Sv=async t=>{if(!pe||!await tt("shops"))return null;try{const e=Vt("shops",t),n=await pe.retrieve("shops",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;return{id:r.shopId,name:r.name,contactEmail:r.contactEmail||r.contact}}return null}catch(e){return console.error("[Users] Error validating shop:",e),null}},Cd=new Map,Ev=async t=>{if(Cd.has(t))return Cd.get(t).name;const n=(await bt("products",null)).find(r=>{var a;return((a=r.payload)==null?void 0:a.productId)===t});if(n){const r=n.payload;return Cd.set(t,{name:r.name||"unknown product",manufacturer:r.manufacturer||"",category:r.category||""}),r.name||"unknown product"}return"unknown product"},Jl=async(t,e)=>{if(!pe||!le||!await tt("items"))return;const n=t.inventoryUuid||t.qdrantId||Ct();t.inventoryUuid||(t.inventoryUuid=n),t.qdrantId||(t.qdrantId=n);const r=new Date().toISOString(),a=t.status||(t.quantity>0?"ACTIVE":"EMPTY"),o=await Ev(t.productId),c=await kn(o),d=Gt(c,n,`items:${n}`),p=e||t.scanMetadata||null,h=t.buyPrice??t.costPerUnit??null,x=t.sellPrice??(h?h*1.4:null),v=t.shareScope||["local"],w={inventoryUuid:n,shopId:le,productId:t.productId,batchId:t.batchId||"",supplierId:t.supplierId||void 0,buyPrice:h??void 0,sellPrice:x??void 0,quantity:t.quantity||0,expiration:t.expirationDate||r,location:t.location||void 0,status:a,images:t.images||[],scanMetadata:p,createdByUserId:le,createdAt:t.createdAt||r,updatedAt:t.updatedAt||r,embeddings:d,shareScope:v,shareProofHash:t.shareProofHash};await pe.upsert("items",{wait:!0,points:[{id:n,...dn("items",d),payload:w}]})},Tv=async t=>{if(!pe)return;const e=t.inventoryUuid||t.qdrantId;if(e){await pe.delete("items",{wait:!0,points:[e]});return}le&&await pe.delete("items",{wait:!0,filter:{must:[{key:"shopId",match:{value:le}},{key:"productId",match:{value:t.productId}}]}})},fI=async(t,e,n)=>{if(!pe||!le||!await tt("items"))return;const r=new Date().toISOString(),a=new Date(t.deliveryDate),o=new Date(a.setFullYear(a.getFullYear()+1)).toISOString().split("T")[0],c=await Promise.all(e.filter(d=>d.productId&&d.quantity>0).map(async d=>{const p=Ct(),h=d.cost||0,x=h*1.4,v=await Ev(d.productId),w=await kn(v),_=Gt(w,p,`items:${p}`),E=n==null?void 0:n.get(d.productId),N={inventoryUuid:p,shopId:le,productId:d.productId,batchId:t.id,supplierId:t.supplierId||void 0,buyPrice:h,sellPrice:x,quantity:d.quantity,expiration:o,location:void 0,status:"ACTIVE",images:(E==null?void 0:E.images)||[],scanMetadata:(E==null?void 0:E.scanMetadata)||null,createdByUserId:le,createdAt:r,updatedAt:r,embeddings:_,shareScope:["local"]};return{id:p,...dn("items",_),payload:N}}));c.length>0&&(await pe.upsert("items",{wait:!0,points:c}),console.log(`[Inventory] Added ${c.length} inventory items from batch ${t.id}`))},kf=async(t,e,n=10)=>{if(!pe||!e)return[];if(!await tt("items"))return[];const r=Gt(t,`${e}-query`,`search:${e}`),a=uI("items",r);return(await dI("items",a,{shopId:e,quantityMin:0,status:"ACTIVE"},n)).map(c=>{const d=c.payload,p=d==null?void 0:d.shopId,h=typeof p=="string"?p:p&&typeof p=="object"&&p!==null&&"id"in p?p.id:e;return{id:Date.now()+Math.random(),inventoryUuid:d.inventoryUuid||String(c.id),shopId:h,productId:d.productId,batchId:d.batchId,expirationDate:d.expiration,quantity:d.quantity,costPerUnit:d.buyPrice||0,location:d.location||void 0,supplierId:d.supplierId||void 0,buyPrice:d.buyPrice,sellPrice:d.sellPrice,images:d.images||[],scanMetadata:d.scanMetadata,qdrantId:d.inventoryUuid||String(c.id),status:d.status,createdByUserId:d.createdByUserId,createdAt:d.createdAt,updatedAt:d.updatedAt,shareScope:d.shareScope||["local"],shareProofHash:d.shareProofHash}})},Nv=async t=>(await bt("items",t)).map(n=>{const r=n.payload,a=r==null?void 0:r.shopId,o=typeof a=="string"?a:a&&typeof a=="object"&&a!==null&&"id"in a?a.id:t;return{id:Date.now()+Math.random(),inventoryUuid:r.inventoryUuid||String(n.id),shopId:o,productId:r.productId,batchId:r.batchId,expirationDate:r.expiration,quantity:r.quantity,costPerUnit:r.buyPrice||0,location:r.location||void 0,supplierId:r.supplierId||void 0,buyPrice:r.buyPrice,sellPrice:r.sellPrice,images:r.images||[],scanMetadata:r.scanMetadata,qdrantId:r.inventoryUuid||String(n.id),status:r.status,createdByUserId:r.createdByUserId,createdAt:r.createdAt,updatedAt:r.updatedAt,shareScope:r.shareScope||["local"],shareProofHash:r.shareProofHash}}).filter(n=>n.quantity>0&&n.status!=="EMPTY"&&n.status!=="EXPIRED"),Uf=async t=>{if(!pe||!le||!await tt("sales"))return;const e=Gt(zn(t.id),t.id,`sales:${t.id}`),n=Vt("sales",t.id),r=dn("sales",e);await pe.upsert("sales",{wait:!0,points:[{id:n,...r,payload:{saleId:t.id,shopId:le,timestamp:t.timestamp,lineItems:t.items,totalAmount:t.totalAmount}}]})},hI=async(t,e)=>{if(!le)throw new Error("No shop selected.");const n=[];let r=0;const a=1.4,o=[],c=[],d=await Nv(le);for(const h of t){let x=h.quantity;const v=e.get(h.productName);if(!v)continue;const w=d.filter(_=>_.productId===v.id&&_.quantity>0).sort((_,E)=>new Date(_.expirationDate).getTime()-new Date(E.expirationDate).getTime());for(const _ of w){if(x<=0)break;const E=Math.min(_.quantity,x);_.quantity-=E,x-=E;const N=_.costPerUnit*a;n.push({productId:v.id,quantity:E,priceAtSale:N}),r+=E*N,_.quantity===0?c.push(_):o.push(_)}}const p={id:Date.now(),timestamp:new Date().toISOString(),items:n,totalAmount:r};for(const h of o)await Jl(h);return await Promise.all(c.map(Tv)),await Uf(p),console.log(`[Sales] Recorded sale ${p.id} with total $${r.toFixed(2)}.`),p},Cv=async t=>(await bt("sales",t)).map(n=>{const r=n.payload;return{id:r.saleId,timestamp:r.timestamp,items:r.lineItems||[],totalAmount:r.totalAmount||0}}),Qd=new Map,pI=async t=>{if(!pe||!le||!await tt("marketplace"))return;const e=Gt(zn(t.id),t.id,`marketplace:${t.id}`),n=Vt("marketplace",t.id);await pe.upsert("marketplace",{wait:!0,points:[{id:n,...dn("marketplace",e),payload:{shopId:le,listingId:t.id,productId:t.productId,productName:t.productName,quantity:t.quantity,price:t.price}}]})},Av=async t=>{if(!le)throw new Error("No shop selected.");const e={...t,id:Date.now()};Qd.set(e.id,e),await pI(e),console.info(`[Marketplace] Listed ${e.quantity} of ${e.productName}.`)},Iv=async()=>Qd.size>0?Array.from(Qd.values()):le?(await bt("marketplace",le)).map(e=>{const n=e.payload;return{id:n.listingId||Date.now(),productId:n.productId,productName:n.productName,quantity:n.quantity,price:n.price}}):[],mI=async(t,e,n,r)=>{if(!le)throw new Error("No shop selected.");const a=new Date().toISOString().split("T")[0],o={supplier:t.seller.name,deliveryDate:a,inventoryDate:a},c={productName:t.productName,manufacturer:t.manufacturer,category:t.category,expirationDate:"2025-12-31",quantity:e,quantityType:t.quantityType,costPerUnit:t.price,location:"Marketplace Intake"};await n(o,[c]);const d={id:Date.now(),timestamp:new Date().toISOString(),items:[{productId:t.productName.toLowerCase().trim().replace(/\s+/g,"-"),quantity:e,priceAtSale:t.price}],totalAmount:t.price*e,source:{type:"marketplace",supplierName:t.seller.name,listingId:t.listingId}};await r(d),console.info(`[Marketplace] Purchased ${e} of ${t.productName} from ${t.seller.name}.`)},gI=new Map,Rv=t=>t.toLowerCase().trim().replace(/\s+/g,"-"),yI=t=>`${le||"global"}:${t}`,xI=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(r.result.split(",")[1]),r.onerror=a=>n(a)}),vI=(t,e)=>t&&t.trim().length>0?t.trim():e?Rv(e):"unlabeled-product",jf=async(t,e,n,r)=>{const a=vI(r==null?void 0:r.productId,t),o=yI(a),c=await xI(n),d=`${o}-${e}`;if(gI.set(d,{imageBase64:c,mimeType:n.type}),!pe||!le||!await tt("visual"))return d;const p=Gt(zn(d),d,`visual:${d}`);try{await pe.upsert("visual",{wait:!0,points:[{id:Vt("visual",d),...dn("visual",p),payload:{shopId:le,productId:o,fieldName:e,imageBase64:c,mimeType:n.type,source:(r==null?void 0:r.source)||"manual",batchId:(r==null?void 0:r.batchId)||null,metadata:(r==null?void 0:r.metadata)||null,capturedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}]})}catch(h){console.error("[Qdrant] Failed to upsert visual feature:",h)}return d},Vy=t=>{const e=le||"global";return t.startsWith(`${e}:`)?t:`${e}:${t}`},Dv=async t=>{const e=new Map;if(!le||!pe)return e;const n=new Set;t.includes(":")?n.add(t):(n.add(Vy(t)),n.add(Vy(Rv(t))));const r=async a=>{let o;do{const c=await pe.scroll("visual",{filter:{must:[{key:"shopId",match:{value:le}},{key:"productId",match:{value:a}}]},with_payload:!0,limit:50,offset:o??void 0});((c==null?void 0:c.points)??[]).forEach(p=>{const h=p.payload;h!=null&&h.fieldName&&(h!=null&&h.imageBase64)&&(h!=null&&h.mimeType)&&e.set(h.fieldName,{imageBase64:h.imageBase64,mimeType:h.mimeType})}),o=(c==null?void 0:c.next_page_offset)??void 0}while(o)};for(const a of n)if(await r(a),e.size>0)break;return e},br="dan_inventory",Mv=async t=>{if(!pe||!await tt(br))return;const e=t.vector||await kn(`${t.productName} ${t.locationBucket||""} ${t.quantity}`),n=Gt(e,t.inventoryUuid,`${br}:${t.inventoryUuid}`),r={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:t.productName,quantity:t.quantity,expirationDate:t.expirationDate,locationBucket:t.locationBucket||null,sellPrice:t.sellPrice??null,shopId:t.shopId,shopName:t.shopName||null,shareScope:t.shareScope,proofHash:t.proofHash,updatedAt:t.updatedAt||new Date().toISOString()};await pe.upsert(br,{wait:!0,points:[{id:t.inventoryUuid,...dn(br,n),payload:r}]})},bI=async t=>{pe&&await tt(br)&&await pe.delete(br,{wait:!0,points:[t]})},wI=async()=>(await bt(br,null)).map(e=>{var r;const n=e.payload;return{inventoryUuid:(n==null?void 0:n.inventoryUuid)||String(e.id),shopId:(n==null?void 0:n.shopId)||"",shopName:(n==null?void 0:n.shopName)||null,productId:(n==null?void 0:n.productId)||"",productName:(n==null?void 0:n.productName)||"",quantity:(n==null?void 0:n.quantity)||0,expirationDate:(n==null?void 0:n.expirationDate)||"",locationBucket:(n==null?void 0:n.locationBucket)||null,sellPrice:(n==null?void 0:n.sellPrice)??null,shareScope:(n==null?void 0:n.shareScope)||["local"],proofHash:n==null?void 0:n.proofHash,updatedAt:(n==null?void 0:n.updatedAt)||((r=e.payload)==null?void 0:r.updatedAt)||""}}).filter(e=>e.quantity>0).sort((e,n)=>{const r=new Date(e.expirationDate).getTime(),a=new Date(n.expirationDate).getTime();return r-a}),Be={products:new Map,batches:new Map,stockItems:new Map,salesTransactions:new Map,productVisualFeatures:new Map,marketplaceListings:new Map};let Xd=!1;const Pv=t=>{Xd=t},Wd=t=>t.toLowerCase().trim().replace(/\s+/g,"-"),_I=async(t,e)=>{const n=new Map,r=await t();for(const d of r){if(d.quantity<=0||d.status==="EMPTY"||d.status==="EXPIRED"||d.status&&d.status!=="ACTIVE")continue;const p=Be.products.get(d.productId);if(!p)continue;const h=n.get(p.id);if(h)h.totalQuantity+=d.quantity,d.expirationDate<h.earliestExpiration&&(h.earliestExpiration=d.expirationDate),d.supplierId&&h.supplierIdsSet.add(d.supplierId),h.batches.push({batchId:String(d.batchId),quantity:d.quantity,expirationDate:d.expirationDate}),h.totalCost+=d.costPerUnit*d.quantity,h.itemCount+=d.quantity;else{const x=new Set;d.supplierId&&x.add(d.supplierId),n.set(p.id,{productId:p.id,productName:p.name,manufacturer:p.manufacturer,category:p.category,totalQuantity:d.quantity,quantityType:"units",earliestExpiration:d.expirationDate,supplierIdsSet:x,batches:[{batchId:String(d.batchId),quantity:d.quantity,expirationDate:d.expirationDate}],totalCost:d.costPerUnit*d.quantity,itemCount:d.quantity,averageCostPerUnit:0})}}const a=await e(),o=new Set(a.map(d=>d.id)),c=[];return n.forEach(d=>{if(!(d.supplierIdsSet.size===0||Array.from(d.supplierIdsSet).some(_=>o.has(_))))return;const{totalCost:h,itemCount:x,supplierIdsSet:v,...w}=d;c.push({...w,supplierIds:Array.from(v).filter(_=>o.has(_)),averageCostPerUnit:x>0?h/x:0})}),c.sort((d,p)=>d.productName.localeCompare(p.productName))},kv=()=>{Be.products.clear(),Be.batches.clear(),Be.stockItems.clear(),Be.salesTransactions.clear(),Be.marketplaceListings.clear(),Be.productVisualFeatures.clear()},Ml=async()=>{if(console.log("[DataLoader] loadDataFromQdrant called, activeShopId:",le),!le){console.warn("[DataLoader] activeShopId is not set, cannot load data");return}const t=typeof le=="string"?le:le&&typeof le=="object"&&le!==null&&"id"in le?(()=>{const x=le;return console.warn(`[DataLoader] activeShopId is an object instead of string. Extracting id: ${x.id}`),x.id})():null;if(!t){console.warn("[DataLoader] Could not extract shopIdString from activeShopId");return}console.log(`[DataLoader] Loading data for shopId: ${t}`);const[e,n,r,a,o,c]=await Promise.all([bt("suppliers",t),bt("products",null),bt("batches",t),bt("items",t),bt("sales",t),bt("marketplace",t)]);console.log(`[DataLoader] Fetched from Qdrant: ${a.length} items, ${n.length} products, ${r.length} batches`),a.length===0&&console.warn(`[DataLoader] No items found for shopId: ${t}. This may be normal if the shop has no inventory yet.`),kv(),n.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.productId)||String(x.id);w&&Be.products.set(w,{id:w,name:(v==null?void 0:v.name)||"Unnamed Product",manufacturer:(v==null?void 0:v.manufacturer)||"",category:(v==null?void 0:v.category)||""})}),r.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.batchId)||String(x.id);w&&Be.batches.set(String(w),{id:String(w),supplier:(v==null?void 0:v.supplierId)||"Unknown Supplier",deliveryDate:(v==null?void 0:v.deliveryDate)||"",inventoryDate:(v==null?void 0:v.inventoryDate)||(v==null?void 0:v.deliveryDate)||""})});let d=0,p=0;const h={};a.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.productId)||(v==null?void 0:v.itemId),_=(v==null?void 0:v.inventoryUuid)||String(x.id);if(!_||!w){p++,h.missing_uuid_or_productId=(h.missing_uuid_or_productId||0)+1;return}const E=v.quantity||0,N=v.status||(E>0?"ACTIVE":"EMPTY");if(E<=0||N==="EMPTY"||N==="EXPIRED"){p++;const R=E<=0?"quantity_zero":N.toLowerCase();h[R]=(h[R]||0)+1;return}const I=typeof v.shopId=="string"?v.shopId:v.shopId&&typeof v.shopId=="object"&&"id"in v.shopId?v.shopId.id:null;I&&I!==t&&console.warn(`[DataLoader] Item ${_} has shopId "${I}" but expected "${t}"`);const U={id:v.inventoryId||Date.now()+Math.random(),inventoryUuid:_,shopId:I||t||"",productId:w,batchId:v.batchId,expirationDate:v.expiration||v.expirationDate||"",quantity:E,costPerUnit:v.costPerUnit||v.buyPrice||0,location:v.location||void 0,supplierId:v.supplierId||void 0,buyPrice:v.buyPrice??v.costPerUnit,sellPrice:v.sellPrice??void 0,images:v.images||[],scanMetadata:v.scanMetadata||null,createdByUserId:v.createdByUserId||void 0,createdAt:v.createdAt,updatedAt:v.updatedAt,qdrantId:_,status:N};Be.stockItems.set(U.id,U),d++}),console.log(`[DataLoader] Loaded ${d} items into cache, skipped ${p} items:`,h),o.forEach(x=>{const v=x.payload;v!=null&&v.saleId&&Be.salesTransactions.set(v.saleId,{id:v.saleId,timestamp:v.timestamp,items:v.lineItems||[],totalAmount:v.totalAmount||0})}),c.forEach(x=>{const v=x.payload;v!=null&&v.listingId&&Be.marketplaceListings.set(v.listingId,{id:v.listingId,productId:v.productId,productName:v.productName,quantity:v.quantity,price:v.price})})};var Zd=function(t,e){return Zd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])},Zd(t,e)};function Uv(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Zd(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Pl=function(){return Pl=Object.assign||function(e){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Pl.apply(this,arguments)};function Pi(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function jv(t,e,n,r){var a=arguments.length,o=a<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,r);else for(var d=t.length-1;d>=0;d--)(c=t[d])&&(o=(a<3?c(o):a>3?c(e,n,o):c(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o}function Ov(t,e){return function(n,r){e(n,r,t)}}function Lv(t,e,n,r,a,o){function c(P){if(P!==void 0&&typeof P!="function")throw new TypeError("Function expected");return P}for(var d=r.kind,p=d==="getter"?"get":d==="setter"?"set":"value",h=!e&&t?r.static?t:t.prototype:null,x=e||(h?Object.getOwnPropertyDescriptor(h,r.name):{}),v,w=!1,_=n.length-1;_>=0;_--){var E={};for(var N in r)E[N]=N==="access"?{}:r[N];for(var N in r.access)E.access[N]=r.access[N];E.addInitializer=function(P){if(w)throw new TypeError("Cannot add initializers after decoration has completed");o.push(c(P||null))};var I=(0,n[_])(d==="accessor"?{get:x.get,set:x.set}:x[p],E);if(d==="accessor"){if(I===void 0)continue;if(I===null||typeof I!="object")throw new TypeError("Object expected");(v=c(I.get))&&(x.get=v),(v=c(I.set))&&(x.set=v),(v=c(I.init))&&a.unshift(v)}else(v=c(I))&&(d==="field"?a.unshift(v):x[p]=v)}h&&Object.defineProperty(h,r.name,x),w=!0}function qv(t,e,n){for(var r=arguments.length>2,a=0;a<e.length;a++)n=r?e[a].call(t,n):e[a].call(t);return r?n:void 0}function Bv(t){return typeof t=="symbol"?t:"".concat(t)}function Vv(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function Gv(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function be(t,e,n,r){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(x){try{h(r.next(x))}catch(v){c(v)}}function p(x){try{h(r.throw(x))}catch(v){c(v)}}function h(x){x.done?o(x.value):a(x.value).then(d,p)}h((r=r.apply(t,e||[])).next())})}function Hv(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,a,o,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=d(0),c.throw=d(1),c.return=d(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function d(h){return function(x){return p([h,x])}}function p(h){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,h[0]&&(n=0)),n;)try{if(r=1,a&&(o=h[0]&2?a.return:h[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,h[1])).done)return o;switch(a=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,a=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){n.label=h[1];break}if(h[0]===6&&n.label<o[1]){n.label=o[1],o=h;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(h);break}o[2]&&n.ops.pop(),n.trys.pop();continue}h=e.call(t,n)}catch(x){h=[6,x],a=0}finally{r=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var Yl=Object.create?(function(t,e,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]});function zv(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Yl(e,t,n)}function kl(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Of(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),a,o=[],c;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)o.push(a.value)}catch(d){c={error:d}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return o}function Fv(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Of(arguments[e]));return t}function $v(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),a=0,e=0;e<n;e++)for(var o=arguments[e],c=0,d=o.length;c<d;c++,a++)r[a]=o[c];return r}function Jv(t,e,n){if(n||arguments.length===2)for(var r=0,a=e.length,o;r<a;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function Ni(t){return this instanceof Ni?(this.v=t,this):new Ni(t)}function Yv(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(_){return function(E){return Promise.resolve(E).then(_,v)}}function d(_,E){r[_]&&(a[_]=function(N){return new Promise(function(I,P){o.push([_,N,I,P])>1||p(_,N)})},E&&(a[_]=E(a[_])))}function p(_,E){try{h(r[_](E))}catch(N){w(o[0][3],N)}}function h(_){_.value instanceof Ni?Promise.resolve(_.value.v).then(x,v):w(o[0][2],_)}function x(_){p("next",_)}function v(_){p("throw",_)}function w(_,E){_(E),o.shift(),o.length&&p(o[0][0],o[0][1])}}function Kv(t){var e,n;return e={},r("next"),r("throw",function(a){throw a}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(a,o){e[a]=t[a]?function(c){return(n=!n)?{value:Ni(t[a](c)),done:!1}:o?o(c):c}:o}}function Qv(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof kl=="function"?kl(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(d,p){c=t[o](c),a(d,p,c.done,c.value)})}}function a(o,c,d,p){Promise.resolve(p).then(function(h){o({value:h,done:d})},c)}}function Xv(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var SI=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},ef=function(t){return ef=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},ef(t)};function Wv(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=ef(t),r=0;r<n.length;r++)n[r]!=="default"&&Yl(e,t,n[r]);return SI(e,t),e}function Zv(t){return t&&t.__esModule?t:{default:t}}function eb(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function tb(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n}function nb(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function sb(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,a;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(a=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");a&&(r=function(){try{a.call(this)}catch(o){return Promise.reject(o)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var EI=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function rb(t){function e(o){t.error=t.hasError?new EI(o,t.error,"An error was suppressed during disposal."):o,t.hasError=!0}var n,r=0;function a(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(a);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(o).then(a,function(c){return e(c),a()})}else r|=1}catch(c){e(c)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}function ib(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,a,o,c){return r?e?".jsx":".js":a&&(!o||!c)?n:a+o+"."+c.toLowerCase()+"js"}):t}const TI={__extends:Uv,__assign:Pl,__rest:Pi,__decorate:jv,__param:Ov,__esDecorate:Lv,__runInitializers:qv,__propKey:Bv,__setFunctionName:Vv,__metadata:Gv,__awaiter:be,__generator:Hv,__createBinding:Yl,__exportStar:zv,__values:kl,__read:Of,__spread:Fv,__spreadArrays:$v,__spreadArray:Jv,__await:Ni,__asyncGenerator:Yv,__asyncDelegator:Kv,__asyncValues:Qv,__makeTemplateObject:Xv,__importStar:Wv,__importDefault:Zv,__classPrivateFieldGet:eb,__classPrivateFieldSet:tb,__classPrivateFieldIn:nb,__addDisposableResource:sb,__disposeResources:rb,__rewriteRelativeImportExtension:ib},NI=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:sb,get __assign(){return Pl},__asyncDelegator:Kv,__asyncGenerator:Yv,__asyncValues:Qv,__await:Ni,__awaiter:be,__classPrivateFieldGet:eb,__classPrivateFieldIn:nb,__classPrivateFieldSet:tb,__createBinding:Yl,__decorate:jv,__disposeResources:rb,__esDecorate:Lv,__exportStar:zv,__extends:Uv,__generator:Hv,__importDefault:Zv,__importStar:Wv,__makeTemplateObject:Xv,__metadata:Gv,__param:Ov,__propKey:Bv,__read:Of,__rest:Pi,__rewriteRelativeImportExtension:ib,__runInitializers:qv,__setFunctionName:Vv,__spread:Fv,__spreadArray:Jv,__spreadArrays:$v,__values:kl,default:TI},Symbol.toStringTag,{value:"Module"})),CI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Lf extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class AI extends Lf{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Gy extends Lf{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Hy extends Lf{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var tf;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(tf||(tf={}));class II{constructor(e,{headers:n={},customFetch:r,region:a=tf.Any}={}){this.url=e,this.headers=n,this.region=a,this.fetch=CI(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return be(this,arguments,void 0,function*(n,r={}){var a;let o,c;try{const{headers:d,method:p,body:h,signal:x,timeout:v}=r;let w={},{region:_}=r;_||(_=this.region);const E=new URL(`${this.url}/${n}`);_&&_!=="any"&&(w["x-region"]=_,E.searchParams.set("forceFunctionRegion",_));let N;h&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(w["Content-Type"]="application/octet-stream",N=h):typeof h=="string"?(w["Content-Type"]="text/plain",N=h):typeof FormData<"u"&&h instanceof FormData?N=h:(w["Content-Type"]="application/json",N=JSON.stringify(h)):N=h;let I=x;v&&(c=new AbortController,o=setTimeout(()=>c.abort(),v),x?(I=c.signal,x.addEventListener("abort",()=>c.abort())):I=c.signal);const P=yield this.fetch(E.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},w),this.headers),d),body:N,signal:I}).catch(k=>{throw new AI(k)}),U=P.headers.get("x-relay-error");if(U&&U==="true")throw new Gy(P);if(!P.ok)throw new Hy(P);let R=((a=P.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),A;return R==="application/json"?A=yield P.json():R==="application/octet-stream"||R==="application/pdf"?A=yield P.blob():R==="text/event-stream"?A=P:R==="multipart/form-data"?A=yield P.formData():A=yield P.text(),{data:A,error:null,response:P}}catch(d){return{data:null,error:d,response:d instanceof Hy||d instanceof Gy?d.context:void 0}}finally{o&&clearTimeout(o)}})}}var Ot={};const ki=YS(NI);var fl={},hl={},pl={},ml={},gl={},yl={},zy;function ab(){if(zy)return yl;zy=1,Object.defineProperty(yl,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return yl.default=t,yl}var Fy;function ob(){if(Fy)return gl;Fy=1,Object.defineProperty(gl,"__esModule",{value:!0});const e=ki.__importDefault(ab());class n{constructor(a){var o,c;this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=new Headers(a.headers),this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=(o=a.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=a.signal,this.isMaybeSingle=(c=a.isMaybeSingle)!==null&&c!==void 0?c:!1,a.fetch?this.fetch=a.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,o){return this.headers=new Headers(this.headers),this.headers.set(a,o),this}then(a,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let d=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async p=>{var h,x,v,w;let _=null,E=null,N=null,I=p.status,P=p.statusText;if(p.ok){if(this.method!=="HEAD"){const k=await p.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((h=this.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text"))?E=k:E=JSON.parse(k))}const R=(x=this.headers.get("Prefer"))===null||x===void 0?void 0:x.match(/count=(exact|planned|estimated)/),A=(v=p.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");R&&A&&A.length>1&&(N=parseInt(A[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(E)&&(E.length>1?(_={code:"PGRST116",details:`Results contain ${E.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},E=null,N=null,I=406,P="Not Acceptable"):E.length===1?E=E[0]:E=null)}else{const R=await p.text();try{_=JSON.parse(R),Array.isArray(_)&&p.status===404&&(E=[],_=null,I=200,P="OK")}catch{p.status===404&&R===""?(I=204,P="No Content"):_={message:R}}if(_&&this.isMaybeSingle&&(!((w=_==null?void 0:_.details)===null||w===void 0)&&w.includes("0 rows"))&&(_=null,I=200,P="OK"),_&&this.shouldThrowOnError)throw new e.default(_)}return{error:_,data:E,count:N,status:I,statusText:P}});return this.shouldThrowOnError||(d=d.catch(p=>{var h,x,v;return{error:{message:`${(h=p==null?void 0:p.name)!==null&&h!==void 0?h:"FetchError"}: ${p==null?void 0:p.message}`,details:`${(x=p==null?void 0:p.stack)!==null&&x!==void 0?x:""}`,hint:"",code:`${(v=p==null?void 0:p.code)!==null&&v!==void 0?v:""}`},data:null,count:null,status:0,statusText:""}})),d.then(a,o)}returns(){return this}overrideTypes(){return this}}return gl.default=n,gl}var $y;function lb(){if($y)return ml;$y=1,Object.defineProperty(ml,"__esModule",{value:!0});const e=ki.__importDefault(ob());class n extends e.default{select(a){let o=!1;const c=(a??"*").split("").map(d=>/\s/.test(d)&&!o?"":(d==='"'&&(o=!o),d)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:o=!0,nullsFirst:c,foreignTable:d,referencedTable:p=d}={}){const h=p?`${p}.order`:"order",x=this.url.searchParams.get(h);return this.url.searchParams.set(h,`${x?`${x},`:""}${a}.${o?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:o,referencedTable:c=o}={}){const d=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${a}`),this}range(a,o,{foreignTable:c,referencedTable:d=c}={}){const p=typeof d>"u"?"offset":`${d}.offset`,h=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(p,`${a}`),this.url.searchParams.set(h,`${o-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:o=!1,settings:c=!1,buffers:d=!1,wal:p=!1,format:h="text"}={}){var x;const v=[a?"analyze":null,o?"verbose":null,c?"settings":null,d?"buffers":null,p?"wal":null].filter(Boolean).join("|"),w=(x=this.headers.get("Accept"))!==null&&x!==void 0?x:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${h}; for="${w}"; options=${v};`),h==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}}return ml.default=n,ml}var Jy;function qf(){if(Jy)return pl;Jy=1,Object.defineProperty(pl,"__esModule",{value:!0});const e=ki.__importDefault(lb()),n=new RegExp("[,()]");class r extends e.default{eq(o,c){return this.url.searchParams.append(o,`eq.${c}`),this}neq(o,c){return this.url.searchParams.append(o,`neq.${c}`),this}gt(o,c){return this.url.searchParams.append(o,`gt.${c}`),this}gte(o,c){return this.url.searchParams.append(o,`gte.${c}`),this}lt(o,c){return this.url.searchParams.append(o,`lt.${c}`),this}lte(o,c){return this.url.searchParams.append(o,`lte.${c}`),this}like(o,c){return this.url.searchParams.append(o,`like.${c}`),this}likeAllOf(o,c){return this.url.searchParams.append(o,`like(all).{${c.join(",")}}`),this}likeAnyOf(o,c){return this.url.searchParams.append(o,`like(any).{${c.join(",")}}`),this}ilike(o,c){return this.url.searchParams.append(o,`ilike.${c}`),this}ilikeAllOf(o,c){return this.url.searchParams.append(o,`ilike(all).{${c.join(",")}}`),this}ilikeAnyOf(o,c){return this.url.searchParams.append(o,`ilike(any).{${c.join(",")}}`),this}is(o,c){return this.url.searchParams.append(o,`is.${c}`),this}in(o,c){const d=Array.from(new Set(c)).map(p=>typeof p=="string"&&n.test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(o,`in.(${d})`),this}contains(o,c){return typeof c=="string"?this.url.searchParams.append(o,`cs.${c}`):Array.isArray(c)?this.url.searchParams.append(o,`cs.{${c.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(c)}`),this}containedBy(o,c){return typeof c=="string"?this.url.searchParams.append(o,`cd.${c}`):Array.isArray(c)?this.url.searchParams.append(o,`cd.{${c.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(c)}`),this}rangeGt(o,c){return this.url.searchParams.append(o,`sr.${c}`),this}rangeGte(o,c){return this.url.searchParams.append(o,`nxl.${c}`),this}rangeLt(o,c){return this.url.searchParams.append(o,`sl.${c}`),this}rangeLte(o,c){return this.url.searchParams.append(o,`nxr.${c}`),this}rangeAdjacent(o,c){return this.url.searchParams.append(o,`adj.${c}`),this}overlaps(o,c){return typeof c=="string"?this.url.searchParams.append(o,`ov.${c}`):this.url.searchParams.append(o,`ov.{${c.join(",")}}`),this}textSearch(o,c,{config:d,type:p}={}){let h="";p==="plain"?h="pl":p==="phrase"?h="ph":p==="websearch"&&(h="w");const x=d===void 0?"":`(${d})`;return this.url.searchParams.append(o,`${h}fts${x}.${c}`),this}match(o){return Object.entries(o).forEach(([c,d])=>{this.url.searchParams.append(c,`eq.${d}`)}),this}not(o,c,d){return this.url.searchParams.append(o,`not.${c}.${d}`),this}or(o,{foreignTable:c,referencedTable:d=c}={}){const p=d?`${d}.or`:"or";return this.url.searchParams.append(p,`(${o})`),this}filter(o,c,d){return this.url.searchParams.append(o,`${c}.${d}`),this}}return pl.default=r,pl}var Yy;function cb(){if(Yy)return hl;Yy=1,Object.defineProperty(hl,"__esModule",{value:!0});const e=ki.__importDefault(qf());class n{constructor(a,{headers:o={},schema:c,fetch:d}){this.url=a,this.headers=new Headers(o),this.schema=c,this.fetch=d}select(a,o){const{head:c=!1,count:d}=o??{},p=c?"HEAD":"GET";let h=!1;const x=(a??"*").split("").map(v=>/\s/.test(v)&&!h?"":(v==='"'&&(h=!h),v)).join("");return this.url.searchParams.set("select",x),d&&this.headers.append("Prefer",`count=${d}`),new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:o,defaultToNull:c=!0}={}){var d;const p="POST";if(o&&this.headers.append("Prefer",`count=${o}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const h=a.reduce((x,v)=>x.concat(Object.keys(v)),[]);if(h.length>0){const x=[...new Set(h)].map(v=>`"${v}"`);this.url.searchParams.set("columns",x.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}upsert(a,{onConflict:o,ignoreDuplicates:c=!1,count:d,defaultToNull:p=!0}={}){var h;const x="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),d&&this.headers.append("Prefer",`count=${d}`),p||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const v=a.reduce((w,_)=>w.concat(Object.keys(_)),[]);if(v.length>0){const w=[...new Set(v)].map(_=>`"${_}"`);this.url.searchParams.set("columns",w.join(","))}}return new e.default({method:x,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}update(a,{count:o}={}){var c;const d="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:a}={}){var o;const c="DELETE";return a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return hl.default=n,hl}var Ky;function RI(){if(Ky)return fl;Ky=1,Object.defineProperty(fl,"__esModule",{value:!0});const t=ki,e=t.__importDefault(cb()),n=t.__importDefault(qf());class r{constructor(o,{headers:c={},schema:d,fetch:p}={}){this.url=o,this.headers=new Headers(c),this.schemaName=d,this.fetch=p}from(o){const c=new URL(`${this.url}/${o}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new r(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,c={},{head:d=!1,get:p=!1,count:h}={}){var x;let v;const w=new URL(`${this.url}/rpc/${o}`);let _;d||p?(v=d?"HEAD":"GET",Object.entries(c).filter(([N,I])=>I!==void 0).map(([N,I])=>[N,Array.isArray(I)?`{${I.join(",")}}`:`${I}`]).forEach(([N,I])=>{w.searchParams.append(N,I)})):(v="POST",_=c);const E=new Headers(this.headers);return h&&E.set("Prefer",`count=${h}`),new n.default({method:v,url:w,headers:E,schema:this.schemaName,body:_,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}}return fl.default=r,fl}var Qy;function DI(){if(Qy)return Ot;Qy=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.PostgrestError=Ot.PostgrestBuilder=Ot.PostgrestTransformBuilder=Ot.PostgrestFilterBuilder=Ot.PostgrestQueryBuilder=Ot.PostgrestClient=void 0;const t=ki,e=t.__importDefault(RI());Ot.PostgrestClient=e.default;const n=t.__importDefault(cb());Ot.PostgrestQueryBuilder=n.default;const r=t.__importDefault(qf());Ot.PostgrestFilterBuilder=r.default;const a=t.__importDefault(lb());Ot.PostgrestTransformBuilder=a.default;const o=t.__importDefault(ob());Ot.PostgrestBuilder=o.default;const c=t.__importDefault(ab());return Ot.PostgrestError=c.default,Ot.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:o.default,PostgrestError:c.default},Ot}var ub=DI();const db=xf(ub),MI=JS({__proto__:null,default:db},[ub]),{PostgrestClient:PI,PostgrestQueryBuilder:G3,PostgrestFilterBuilder:H3,PostgrestTransformBuilder:z3,PostgrestBuilder:F3,PostgrestError:$3}=db||MI;class kI{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,a=parseInt(r.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const UI="2.81.1",jI=`realtime-js/${UI}`,fb="1.0.0",OI="2.0.0",Xy=fb,nf=1e4,LI=1e3,qI=100;var yr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(yr||(yr={}));var St;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(St||(St={}));var Sn;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Sn||(Sn={}));var sf;(function(t){t.websocket="websocket"})(sf||(sf={}));var xr;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(xr||(xr={}));class BI{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,n){if(this._isArrayBuffer(e.payload))return n(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodePush(e){const{join_ref:n,ref:r,event:a,topic:o,payload:c}=e,d=this.META_LENGTH+n.length+r.length+o.length+a.length,p=new ArrayBuffer(this.HEADER_LENGTH+d);let h=new DataView(p),x=0;h.setUint8(x++,this.KINDS.push),h.setUint8(x++,n.length),h.setUint8(x++,r.length),h.setUint8(x++,o.length),h.setUint8(x++,a.length),Array.from(n,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(r,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(o,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(a,w=>h.setUint8(x++,w.charCodeAt(0)));var v=new Uint8Array(p.byteLength+c.byteLength);return v.set(new Uint8Array(p),0),v.set(new Uint8Array(c),p.byteLength),v.buffer}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const{join_ref:a,ref:o,topic:c}=e,d=e.payload.event,p=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0),h=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+c.length+d.length,x=new ArrayBuffer(this.HEADER_LENGTH+h);let v=new DataView(x),w=0;v.setUint8(w++,this.KINDS.userBroadcastPush),v.setUint8(w++,a.length),v.setUint8(w++,o.length),v.setUint8(w++,c.length),v.setUint8(w++,d.length),v.setUint8(w++,this.BINARY_ENCODING),Array.from(a,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(o,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(c,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(d,E=>v.setUint8(w++,E.charCodeAt(0)));var _=new Uint8Array(x.byteLength+p.byteLength);return _.set(new Uint8Array(x),0),_.set(new Uint8Array(p),x.byteLength),_.buffer}_encodeJsonUserBroadcastPush(e){var n,r;const{join_ref:a,ref:o,topic:c}=e,d=e.payload.event,p=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},x=new TextEncoder().encode(JSON.stringify(p)).buffer,v=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+c.length+d.length,w=new ArrayBuffer(this.HEADER_LENGTH+v);let _=new DataView(w),E=0;_.setUint8(E++,this.KINDS.userBroadcastPush),_.setUint8(E++,a.length),_.setUint8(E++,o.length),_.setUint8(E++,c.length),_.setUint8(E++,d.length),_.setUint8(E++,this.JSON_ENCODING),Array.from(a,I=>_.setUint8(E++,I.charCodeAt(0))),Array.from(o,I=>_.setUint8(E++,I.charCodeAt(0))),Array.from(c,I=>_.setUint8(E++,I.charCodeAt(0))),Array.from(d,I=>_.setUint8(E++,I.charCodeAt(0)));var N=new Uint8Array(w.byteLength+x.byteLength);return N.set(new Uint8Array(w),0),N.set(new Uint8Array(x),w.byteLength),N.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[a,o,c,d,p]=r;return n({join_ref:a,ref:o,topic:c,event:d,payload:p})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),a=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,n,a);case this.KINDS.reply:return this._decodeReply(e,n,a);case this.KINDS.broadcast:return this._decodeBroadcast(e,n,a);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,a)}}_decodePush(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3);let d=this.HEADER_LENGTH+this.META_LENGTH-1;const p=r.decode(e.slice(d,d+a));d=d+a;const h=r.decode(e.slice(d,d+o));d=d+o;const x=r.decode(e.slice(d,d+c));d=d+c;const v=JSON.parse(r.decode(e.slice(d,e.byteLength)));return{join_ref:p,ref:null,topic:h,event:x,payload:v}}_decodeReply(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3),d=n.getUint8(4);let p=this.HEADER_LENGTH+this.META_LENGTH;const h=r.decode(e.slice(p,p+a));p=p+a;const x=r.decode(e.slice(p,p+o));p=p+o;const v=r.decode(e.slice(p,p+c));p=p+c;const w=r.decode(e.slice(p,p+d));p=p+d;const _=JSON.parse(r.decode(e.slice(p,e.byteLength))),E={status:w,response:_};return{join_ref:h,ref:x,topic:v,event:Sn.reply,payload:E}}_decodeBroadcast(e,n,r){const a=n.getUint8(1),o=n.getUint8(2);let c=this.HEADER_LENGTH+2;const d=r.decode(e.slice(c,c+a));c=c+a;const p=r.decode(e.slice(c,c+o));c=c+o;const h=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{join_ref:null,ref:null,topic:d,event:p,payload:h}}_decodeUserBroadcast(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3),d=n.getUint8(4);let p=this.HEADER_LENGTH+4;const h=r.decode(e.slice(p,p+a));p=p+a;const x=r.decode(e.slice(p,p+o));p=p+o;const v=r.decode(e.slice(p,p+c));p=p+c;const w=e.slice(p,e.byteLength),_=d===this.JSON_ENCODING?JSON.parse(r.decode(w)):w,E={type:this.BROADCAST,event:x,payload:_};return c>0&&(E.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST,payload:E}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}}class hb{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var rt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(rt||(rt={}));const Wy=(t,e,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((o,c)=>(o[c]=VI(c,t,e,a),o),{}):{}},VI=(t,e,n,r)=>{const a=e.find(d=>d.name===t),o=a==null?void 0:a.type,c=n[t];return o&&!r.includes(o)?pb(o,c):rf(c)},pb=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return FI(e,n)}switch(t){case rt.bool:return GI(e);case rt.float4:case rt.float8:case rt.int2:case rt.int4:case rt.int8:case rt.numeric:case rt.oid:return HI(e);case rt.json:case rt.jsonb:return zI(e);case rt.timestamp:return $I(e);case rt.abstime:case rt.date:case rt.daterange:case rt.int4range:case rt.int8range:case rt.money:case rt.reltime:case rt.text:case rt.time:case rt.timestamptz:case rt.timetz:case rt.tsrange:case rt.tstzrange:return rf(e);default:return rf(e)}},rf=t=>t,GI=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},HI=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},zI=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},FI=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let o;const c=t.slice(1,n);try{o=JSON.parse("["+c+"]")}catch{o=c?c.split(","):[]}return o.map(d=>pb(e,d))}return t},$I=t=>typeof t=="string"?t.replace(" ","T"):t,mb=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Ad{constructor(e,n,r={},a=nf){this.channel=e,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Zy;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Zy||(Zy={}));class Ma{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:o,onLeave:c,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ma.syncState(this.state,a,o,c),this.pendingDiffs.forEach(p=>{this.state=Ma.syncDiff(this.state,p,o,c)}),this.pendingDiffs=[],d()}),this.channel._on(r.diff,{},a=>{const{onJoin:o,onLeave:c,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Ma.syncDiff(this.state,a,o,c),d())}),this.onJoin((a,o,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:c})}),this.onLeave((a,o,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,a){const o=this.cloneDeep(e),c=this.transformState(n),d={},p={};return this.map(o,(h,x)=>{c[h]||(p[h]=x)}),this.map(c,(h,x)=>{const v=o[h];if(v){const w=x.map(I=>I.presence_ref),_=v.map(I=>I.presence_ref),E=x.filter(I=>_.indexOf(I.presence_ref)<0),N=v.filter(I=>w.indexOf(I.presence_ref)<0);E.length>0&&(d[h]=E),N.length>0&&(p[h]=N)}else d[h]=x}),this.syncDiff(o,{joins:d,leaves:p},r,a)}static syncDiff(e,n,r,a){const{joins:o,leaves:c}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(o,(d,p)=>{var h;const x=(h=e[d])!==null&&h!==void 0?h:[];if(e[d]=this.cloneDeep(p),x.length>0){const v=e[d].map(_=>_.presence_ref),w=x.filter(_=>v.indexOf(_.presence_ref)<0);e[d].unshift(...w)}r(d,x,p)}),this.map(c,(d,p)=>{let h=e[d];if(!h)return;const x=p.map(v=>v.presence_ref);h=h.filter(v=>x.indexOf(v.presence_ref)<0),e[d]=h,a(d,h,p),h.length===0&&delete e[d]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const a=e[r];return"metas"in a?n[r]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):n[r]=a,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ex;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(ex||(ex={}));var Pa;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Pa||(Pa={}));var us;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(us||(us={}));class Bf{constructor(e,n={config:{}},r){var a,o;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=St.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ad(this,Sn.join,this.params,this.timeout),this.rejoinTimer=new hb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=St.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=St.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=St.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=St.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=St.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Sn.reply,{},(c,d)=>{this._trigger(this._replyEventName(d),c)}),this.presence=new Ma(this),this.broadcastEndpointURL=mb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,a,o;if(this.socket.isConnected()||this.socket.connect(),this.state==St.closed){const{config:{broadcast:c,presence:d,private:p}}=this.params,h=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(_=>_.filter))!==null&&a!==void 0?a:[],x=!!this.bindings[Pa.PRESENCE]&&this.bindings[Pa.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,v={},w={broadcast:c,presence:Object.assign(Object.assign({},d),{enabled:x}),postgres_changes:h,private:p};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(_=>e==null?void 0:e(us.CHANNEL_ERROR,_)),this._onClose(()=>e==null?void 0:e(us.CLOSED)),this.updateJoinPayload(Object.assign({config:w},v)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:_})=>{var E;if(this.socket.setAuth(),_===void 0){e==null||e(us.SUBSCRIBED);return}else{const N=this.bindings.postgres_changes,I=(E=N==null?void 0:N.length)!==null&&E!==void 0?E:0,P=[];for(let U=0;U<I;U++){const R=N[U],{filter:{event:A,schema:k,table:q,filter:V}}=R,W=_&&_[U];if(W&&W.event===A&&W.schema===k&&W.table===q&&W.filter===V)P.push(Object.assign(Object.assign({},R),{id:W.id}));else{this.unsubscribe(),this.state=St.errored,e==null||e(us.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=P,e&&e(us.SUBSCRIBED);return}}).receive("error",_=>{this.state=St.errored,e==null||e(us.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(_).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(us.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===St.joined&&e===Pa.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var a;const o=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const c={method:"POST",headers:{Authorization:o,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(d.status===202)return{success:!0};let p=d.statusText;try{const h=await d.json();p=h.error||h.message||p}catch{}return Promise.reject(new Error(p))}async send(e,n={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:c}=e,p={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:c,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=h.body)===null||a===void 0?void 0:a.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var c,d,p;const h=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(d=(c=this.params)===null||c===void 0?void 0:c.config)===null||d===void 0?void 0:d.broadcast)===null||p===void 0)&&p.ack)&&o("ok"),h.receive("ok",()=>o("ok")),h.receive("error",()=>o("error")),h.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=St.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Sn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new Ad(this,Sn.leave,{},e),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=St.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const a=new AbortController,o=setTimeout(()=>a.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(o),c}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Ad(this,e,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>qI){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var a,o;const c=e.toLocaleLowerCase(),{close:d,error:p,leave:h,join:x}=Sn;if(r&&[d,p,h,x].indexOf(c)>=0&&r!==this._joinRef())return;let w=this._onMessage(c,n,r);if(n&&!w)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(_=>{var E,N,I;return((E=_.filter)===null||E===void 0?void 0:E.event)==="*"||((I=(N=_.filter)===null||N===void 0?void 0:N.event)===null||I===void 0?void 0:I.toLocaleLowerCase())===c}).map(_=>_.callback(w,r)):(o=this.bindings[c])===null||o===void 0||o.filter(_=>{var E,N,I,P,U,R;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in _){const A=_.id,k=(E=_.filter)===null||E===void 0?void 0:E.event;return A&&((N=n.ids)===null||N===void 0?void 0:N.includes(A))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((I=n.data)===null||I===void 0?void 0:I.type.toLocaleLowerCase()))}else{const A=(U=(P=_==null?void 0:_.filter)===null||P===void 0?void 0:P.event)===null||U===void 0?void 0:U.toLocaleLowerCase();return A==="*"||A===((R=n==null?void 0:n.event)===null||R===void 0?void 0:R.toLocaleLowerCase())}else return _.type.toLocaleLowerCase()===c}).map(_=>{if(typeof w=="object"&&"ids"in w){const E=w.data,{schema:N,table:I,commit_timestamp:P,type:U,errors:R}=E;w=Object.assign(Object.assign({},{schema:N,table:I,commit_timestamp:P,eventType:U,new:{},old:{},errors:R}),this._getPayloadRecords(E))}_.callback(w,r)})}_isClosed(){return this.state===St.closed}_isJoined(){return this.state===St.joined}_isJoining(){return this.state===St.joining}_isLeaving(){return this.state===St.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const a=e.toLocaleLowerCase(),o={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Bf.isEqual(a.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Sn.close,{},e)}_onError(e){this._on(Sn.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=St.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Wy(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Wy(e.columns,e.old_record)),n}}const Id=()=>{},xl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},JI=[1e3,2e3,5e3,1e4],YI=1e4,KI=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class QI{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=nf,this.transport=null,this.heartbeatIntervalMs=xl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Id,this.ref=0,this.reconnectTimer=null,this.vsn=Xy,this.logger=Id,this.conn=null,this.sendBuffer=[],this.serializer=new BI,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>a?(...o)=>a(...o):(...o)=>fetch(...o),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${sf.websocket}`,this.httpEndpoint=mb(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=kI.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case yr.connecting:return xr.Connecting;case yr.open:return xr.Open;case yr.closing:return xr.Closing;default:return xr.Closed}}isConnected(){return this.connectionState()===xr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(o=>o.topic===r);if(a)return a;{const o=new Bf(`realtime:${e}`,n,this);return this.channels.push(o),o}}push(e){const{topic:n,event:r,payload:a,ref:o}=e,c=()=>{this.encode(e,d=>{var p;(p=this.conn)===null||p===void 0||p.send(d)})};this.log("push",`${n} ${r} (${o})`,a),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(LI,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},xl.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(h){this.log("error","error in heartbeat callback",h)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:o,ref:c}=n,d=c?`(${c})`:"",p=o.status||"";this.log("receive",`${p} ${r} ${a} ${d}`.trim(),o),this.channels.filter(h=>h._isMember(r)).forEach(h=>h._trigger(a,o,c)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===yr.open||this.conn.readyState===yr.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Sn.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${e}${r}${a}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([KI],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const a={access_token:n,version:jI};n&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(Sn.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new hb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},xl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,a,o,c,d,p,h,x,v,w,_;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:nf,this.heartbeatIntervalMs=(a=e==null?void 0:e.heartbeatIntervalMs)!==null&&a!==void 0?a:xl.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(c=e==null?void 0:e.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(d=e==null?void 0:e.heartbeatCallback)!==null&&d!==void 0?d:Id,this.vsn=(p=e==null?void 0:e.vsn)!==null&&p!==void 0?p:Xy,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e==null?void 0:e.reconnectAfterMs)!==null&&h!==void 0?h:(E=>JI[E-1]||YI),this.vsn){case fb:this.encode=(x=e==null?void 0:e.encode)!==null&&x!==void 0?x:((E,N)=>N(JSON.stringify(E))),this.decode=(v=e==null?void 0:e.decode)!==null&&v!==void 0?v:((E,N)=>N(JSON.parse(E)));break;case OI:this.encode=(w=e==null?void 0:e.encode)!==null&&w!==void 0?w:this.serializer.encode.bind(this.serializer),this.decode=(_=e==null?void 0:e.decode)!==null&&_!==void 0?_:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Vf extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ut(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class XI extends Vf{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class af extends Vf{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const Gf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),WI=()=>Response,of=t=>{if(Array.isArray(t))return t.map(n=>of(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[a]=of(r)}),e},ZI=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Rd=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},eR=(t,e,n)=>be(void 0,void 0,void 0,function*(){const r=yield WI();t instanceof r&&!(n!=null&&n.noResolveJson)?t.json().then(a=>{const o=t.status||500,c=(a==null?void 0:a.statusCode)||o+"";e(new XI(Rd(a),o,c))}).catch(a=>{e(new af(Rd(a),a))}):e(new af(Rd(t),t))}),tR=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?a:(ZI(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,e!=null&&e.duplex&&(a.duplex=e.duplex),Object.assign(Object.assign({},a),n))};function $a(t,e,n,r,a,o){return be(this,void 0,void 0,function*(){return new Promise((c,d)=>{t(n,tR(e,r,a,o)).then(p=>{if(!p.ok)throw p;return r!=null&&r.noResolveJson?p:p.json()}).then(p=>c(p)).catch(p=>eR(p,d,r))})})}function ja(t,e,n,r){return be(this,void 0,void 0,function*(){return $a(t,"GET",e,n,r)})}function Rn(t,e,n,r,a){return be(this,void 0,void 0,function*(){return $a(t,"POST",e,r,a,n)})}function lf(t,e,n,r,a){return be(this,void 0,void 0,function*(){return $a(t,"PUT",e,r,a,n)})}function nR(t,e,n,r){return be(this,void 0,void 0,function*(){return $a(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Hf(t,e,n,r,a){return be(this,void 0,void 0,function*(){return $a(t,"DELETE",e,r,a,n)})}class sR{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return be(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ut(e))return{data:null,error:e};throw e}})}}var gb;class rR{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[gb]="BlobDownloadBuilder",this.promise=null}asStream(){return new sR(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return be(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ut(e))return{data:null,error:e};throw e}})}}gb=Symbol.toStringTag;const iR={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},tx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class aR{constructor(e,n={},r,a){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=Gf(a)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,a){return be(this,void 0,void 0,function*(){try{let o;const c=Object.assign(Object.assign({},tx),a);let d=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const p=c.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",c.cacheControl),p&&o.append("metadata",this.encodeMetadata(p)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.has("cacheControl")||o.append("cacheControl",c.cacheControl),p&&!o.has("metadata")&&o.append("metadata",this.encodeMetadata(p))):(o=r,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType,p&&(d["x-metadata"]=this.toBase64(this.encodeMetadata(p))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!c.duplex&&(c.duplex="half")),a!=null&&a.headers&&(d=Object.assign(Object.assign({},d),a.headers));const h=this._removeEmptyFolders(n),x=this._getFinalPath(h),v=yield(e=="PUT"?lf:Rn)(this.fetch,`${this.url}/object/${x}`,o,Object.assign({headers:d},c!=null&&c.duplex?{duplex:c.duplex}:{}));return{data:{path:h,id:v.Id,fullPath:v.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(ut(o))return{data:null,error:o};throw o}})}upload(e,n,r){return be(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,a){return be(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),c=this._getFinalPath(o),d=new URL(this.url+`/object/upload/sign/${c}`);d.searchParams.set("token",n);try{let p;const h=Object.assign({upsert:tx.upsert},a),x=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(p=new FormData,p.append("cacheControl",h.cacheControl),p.append("",r)):typeof FormData<"u"&&r instanceof FormData?(p=r,p.append("cacheControl",h.cacheControl)):(p=r,x["cache-control"]=`max-age=${h.cacheControl}`,x["content-type"]=h.contentType);const v=yield lf(this.fetch,d.toString(),p,{headers:x});return{data:{path:o,fullPath:v.Key},error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(ut(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e,n){return be(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const a=Object.assign({},this.headers);n!=null&&n.upsert&&(a["x-upsert"]="true");const o=yield Rn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),c=new URL(this.url+o.url),d=c.searchParams.get("token");if(!d)throw new Vf("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:d},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}update(e,n,r){return be(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return be(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}copy(e,n,r){return be(this,void 0,void 0,function*(){try{return{data:{path:(yield Rn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}createSignedUrl(e,n,r){return be(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),o=yield Rn(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${c}`)},{data:o,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}createSignedUrls(e,n,r){return be(this,void 0,void 0,function*(){try{const a=yield Rn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${o}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}download(e,n){const a=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),c=o?`?${o}`:"",d=this._getFinalPath(e),p=()=>ja(this.fetch,`${this.url}/${a}/${d}${c}`,{headers:this.headers,noResolveJson:!0});return new rR(p,this.shouldThrowOnError)}info(e){return be(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield ja(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:of(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}exists(e){return be(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield nR(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r)&&r instanceof af){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),a=[],o=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";o!==""&&a.push(o);const d=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",p=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});p!==""&&a.push(p);let h=a.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${r}${h}`)}}}remove(e){return be(this,void 0,void 0,function*(){try{return{data:yield Hf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}list(e,n,r){return be(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},iR),n),{prefix:e||""});return{data:yield Rn(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}listV2(e,n){return be(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Rn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const yb="2.81.1",xb={"X-Client-Info":`storage-js/${yb}`};class oR{constructor(e,n={},r,a){this.shouldThrowOnError=!1;const o=new URL(e);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},xb),n),this.fetch=Gf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return be(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield ja(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}getBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield ja(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}createBucket(e){return be(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield Rn(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}updateBucket(e,n){return be(this,void 0,void 0,function*(){try{return{data:yield lf(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}emptyBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}deleteBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield Hf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class lR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},xb),n),this.fetch=Gf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}listBuckets(e){return be(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),a=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield ja(this.fetch,a,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}deleteBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield Hf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}}const zf={"X-Client-Info":`storage-js/${yb}`,"Content-Type":"application/json"};class vb extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function on(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class Dd extends vb{constructor(e,n,r){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class cR extends vb{constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var nx;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(nx||(nx={}));const Ff=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),uR=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},sx=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),dR=(t,e,n)=>be(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const a=t.status||500,o=t;if(typeof o.json=="function")o.json().then(c=>{const d=(c==null?void 0:c.statusCode)||(c==null?void 0:c.code)||a+"";e(new Dd(sx(c),a,d))}).catch(()=>{const c=a+"",d=o.statusText||`HTTP ${a} error`;e(new Dd(d,a,c))});else{const c=a+"",d=o.statusText||`HTTP ${a} error`;e(new Dd(d,a,c))}}else e(new cR(sx(t),t))}),fR=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return r?(uR(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,Object.assign(Object.assign({},a),n)):a};function hR(t,e,n,r,a,o){return be(this,void 0,void 0,function*(){return new Promise((c,d)=>{t(n,fR(e,r,a,o)).then(p=>{if(!p.ok)throw p;if(r!=null&&r.noResolveJson)return p;const h=p.headers.get("content-type");return!h||!h.includes("application/json")?{}:p.json()}).then(p=>c(p)).catch(p=>dR(p,d,r))})})}function ln(t,e,n,r,a){return be(this,void 0,void 0,function*(){return hR(t,"POST",e,r,a,n)})}class pR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zf),n),this.fetch=Ff(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return be(this,void 0,void 0,function*(){try{return{data:(yield ln(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}getIndex(e,n){return be(this,void 0,void 0,function*(){try{return{data:yield ln(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(on(r))return{data:null,error:r};throw r}})}listIndexes(e){return be(this,void 0,void 0,function*(){try{return{data:yield ln(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return be(this,void 0,void 0,function*(){try{return{data:(yield ln(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(on(r))return{data:null,error:r};throw r}})}}class mR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zf),n),this.fetch=Ff(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return be(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield ln(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}getVectors(e){return be(this,void 0,void 0,function*(){try{return{data:yield ln(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}listVectors(e){return be(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield ln(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}queryVectors(e){return be(this,void 0,void 0,function*(){try{return{data:yield ln(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}deleteVectors(e){return be(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield ln(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}}class gR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zf),n),this.fetch=Ff(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return be(this,void 0,void 0,function*(){try{return{data:(yield ln(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}getBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield ln(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}listBuckets(){return be(this,arguments,void 0,function*(e={}){try{return{data:yield ln(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}deleteBucket(e){return be(this,void 0,void 0,function*(){try{return{data:(yield ln(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(on(n))return{data:null,error:n};throw n}})}}class yR extends gR{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new xR(this.url,this.headers,e,this.fetch)}}class xR extends pR{constructor(e,n,r,a){super(e,n,a),this.vectorBucketName=r}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return be(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return be(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return be(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return be(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new vR(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class vR extends mR{constructor(e,n,r,a,o){super(e,n,o),this.vectorBucketName=r,this.indexName=a}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return be(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return be(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return be(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return be(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return be(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class bR extends oR{constructor(e,n={},r,a){super(e,n,r,a)}from(e){return new aR(this.url,this.headers,e,this.fetch)}get vectors(){return new yR(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new lR(this.url+"/iceberg",this.headers,this.fetch)}}const wR="2.81.1";let Ra="";typeof Deno<"u"?Ra="deno":typeof document<"u"?Ra="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ra="react-native":Ra="node";const _R={"X-Client-Info":`supabase-js-${Ra}/${wR}`},SR={headers:_R},ER={schema:"public"},TR={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},NR={},CR=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),AR=()=>Headers,IR=(t,e,n)=>{const r=CR(n),a=AR();return async(o,c)=>{var d;const p=(d=await e())!==null&&d!==void 0?d:t;let h=new a(c==null?void 0:c.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${p}`),r(o,Object.assign(Object.assign({},c),{headers:h}))}};function RR(t){return t.endsWith("/")?t:t+"/"}function DR(t,e){var n,r;const{db:a,auth:o,realtime:c,global:d}=t,{db:p,auth:h,realtime:x,global:v}=e,w={db:Object.assign(Object.assign({},p),a),auth:Object.assign(Object.assign({},h),o),realtime:Object.assign(Object.assign({},x),c),storage:{},global:Object.assign(Object.assign(Object.assign({},v),d),{headers:Object.assign(Object.assign({},(n=v==null?void 0:v.headers)!==null&&n!==void 0?n:{}),(r=d==null?void 0:d.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?w.accessToken=t.accessToken:delete w.accessToken,w}function MR(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(RR(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const bb="2.81.1",gi=30*1e3,cf=3,Md=cf*gi,PR="http://localhost:9999",kR="supabase.auth.token",UR={"X-Client-Info":`gotrue-js/${bb}`},uf="X-Supabase-Api-Version",wb={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},jR=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,OR=600*1e3;class Oa extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function we(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class LR extends Oa{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function qR(t){return we(t)&&t.name==="AuthApiError"}class vr extends Oa{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Ys extends Oa{constructor(e,n,r,a){super(e,r,a),this.name=n,this.status=r}}class An extends Ys{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function BR(t){return we(t)&&t.name==="AuthSessionMissingError"}class ui extends Ys{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class vl extends Ys{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class bl extends Ys{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function VR(t){return we(t)&&t.name==="AuthImplicitGrantRedirectError"}class rx extends Ys{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class df extends Ys{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Pd(t){return we(t)&&t.name==="AuthRetryableFetchError"}class ix extends Ys{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class ff extends Ys{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ul="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ax=` 	
\r=`.split(""),GR=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<ax.length;e+=1)t[ax[e].charCodeAt(0)]=-2;for(let e=0;e<Ul.length;e+=1)t[Ul[e].charCodeAt(0)]=e;return t})();function ox(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ul[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ul[r]),e.queuedBits-=6}}function _b(t,e,n){const r=GR[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function lx(t){const e=[],n=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},o=c=>{FR(c,r,n)};for(let c=0;c<t.length;c+=1)_b(t.charCodeAt(c),a,o);return e.join("")}function HR(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function zR(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}HR(r,e)}}function FR(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Ei(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<t.length;a+=1)_b(t.charCodeAt(a),n,r);return new Uint8Array(e)}function $R(t){const e=[];return zR(t,n=>e.push(n)),new Uint8Array(e)}function wr(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};return t.forEach(a=>ox(a,n,r)),ox(null,n,r),e.join("")}function JR(t){return Math.round(Date.now()/1e3)+t}function YR(){return Symbol("auth-callback")}const Ut=()=>typeof window<"u"&&typeof document<"u",hr={tested:!1,writable:!1},Sb=()=>{if(!Ut())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(hr.tested)return hr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),hr.tested=!0,hr.writable=!0}catch{hr.tested=!0,hr.writable=!1}return hr.writable};function KR(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,o)=>{e[o]=a})}catch{}return n.searchParams.forEach((r,a)=>{e[a]=r}),e}const Eb=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),QR=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",yi=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},pr=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Gs=async(t,e)=>{await t.removeItem(e)};class Kl{constructor(){this.promise=new Kl.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Kl.promiseConstructor=Promise;function kd(t){const e=t.split(".");if(e.length!==3)throw new ff("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!jR.test(e[r]))throw new ff("JWT not in base64url format");return{header:JSON.parse(lx(e[0])),payload:JSON.parse(lx(e[1])),signature:Ei(e[2]),raw:{header:e[0],payload:e[1]}}}async function XR(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function WR(t,e){return new Promise((r,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const c=await t(o);if(!e(o,null,c)){r(c);return}}catch(c){if(!e(o,c)){a(c);return}}})()})}function ZR(t){return("0"+t.toString(16)).substr(-2)}function e4(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let o=0;o<56;o++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,ZR).join("")}async function t4(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}async function n4(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await t4(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function di(t,e,n=!1){const r=e4();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await yi(t,`${e}-code-verifier`,a);const o=await n4(r);return[o,r===o?"plain":"s256"]}const s4=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function r4(t){const e=t.headers.get(uf);if(!e||!e.match(s4))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function i4(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function a4(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const o4=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fi(t){if(!o4.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ud(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function l4(t,e){return new Proxy(t,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const o=r.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,a)}})}function cx(t){return JSON.parse(JSON.stringify(t))}const gr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),c4=[502,503,504];async function ux(t){var e;if(!QR(t))throw new df(gr(t),0);if(c4.includes(t.status))throw new df(gr(t),t.status);let n;try{n=await t.json()}catch(o){throw new vr(gr(o),o)}let r;const a=r4(t);if(a&&a.getTime()>=wb["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new ix(gr(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new An}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((o,c)=>o&&typeof c=="string",!0))throw new ix(gr(n),t.status,n.weak_password.reasons);throw new LR(gr(n),t.status||500,r)}const u4=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function Ae(t,e,n,r){var a;const o=Object.assign({},r==null?void 0:r.headers);o[uf]||(o[uf]=wb["2024-01-01"].name),r!=null&&r.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const c=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(c.redirect_to=r.redirectTo);const d=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",p=await d4(t,e,n+d,{headers:o,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(p):{data:Object.assign({},p),error:null}}async function d4(t,e,n,r,a,o){const c=u4(e,r,a,o);let d;try{d=await t(n,Object.assign({},c))}catch(p){throw console.error(p),new df(gr(p),0)}if(d.ok||await ux(d),r!=null&&r.noResolveJson)return d;try{return await d.json()}catch(p){await ux(p)}}function In(t){var e;let n=null;p4(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=JR(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function dx(t){const e=In(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function zs(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function f4(t){return{data:t,error:null}}function h4(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:o}=t,c=Pi(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),d={action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:o},p=Object.assign({},c);return{data:{properties:d,user:p},error:null}}function fx(t){return t}function p4(t){return t.access_token&&t.refresh_token&&t.expires_in}const jd=["global","local","others"];class m4{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=Eb(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=jd[0]){if(jd.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${jd.join(", ")}`);try{return await Ae(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(we(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await Ae(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:zs})}catch(r){if(we(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Pi(e,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await Ae(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:h4,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(we(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:zs})}catch(n){if(we(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,a,o,c,d,p;try{const h={nextPage:null,lastPage:0,total:0},x=await Ae(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:fx});if(x.error)throw x.error;const v=await x.json(),w=(c=x.headers.get("x-total-count"))!==null&&c!==void 0?c:0,_=(p=(d=x.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&p!==void 0?p:[];return _.length>0&&(_.forEach(E=>{const N=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(E.split(";")[1].split("=")[1]);h[`${I}Page`]=N}),h.total=parseInt(w)),{data:Object.assign(Object.assign({},v),h),error:null}}catch(h){if(we(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){fi(e);try{return await Ae(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:zs})}catch(n){if(we(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){fi(e);try{return await Ae(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:zs})}catch(r){if(we(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){fi(e);try{return await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:zs})}catch(r){if(we(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){fi(e.userId);try{const{data:n,error:r}=await Ae(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(we(n))return{data:null,error:n};throw n}}async _deleteFactor(e){fi(e.userId),fi(e.id);try{return{data:await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(we(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,a,o,c,d,p;try{const h={nextPage:null,lastPage:0,total:0},x=await Ae(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:fx});if(x.error)throw x.error;const v=await x.json(),w=(c=x.headers.get("x-total-count"))!==null&&c!==void 0?c:0,_=(p=(d=x.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&p!==void 0?p:[];return _.length>0&&(_.forEach(E=>{const N=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(E.split(";")[1].split("=")[1]);h[`${I}Page`]=N}),h.total=parseInt(w)),{data:Object.assign(Object.assign({},v),h),error:null}}catch(h){if(we(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(we(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Ae(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(we(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Ae(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(we(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await Ae(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(we(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(we(n))return{data:null,error:n};throw n}}}function hx(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const hi={debug:!!(globalThis&&Sb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Tb extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class g4 extends Tb{}async function y4(t,e,n){hi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),hi.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){hi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await n()}finally{hi.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(e===0)throw hi.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new g4(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(hi.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function x4(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Nb(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function v4(t){return parseInt(t,16)}function b4(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function w4(t){var e;const{chainId:n,domain:r,expirationTime:a,issuedAt:o=new Date,nonce:c,notBefore:d,requestId:p,resources:h,scheme:x,uri:v,version:w}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(w!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${w}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const _=Nb(t.address),E=x?`${x}://${r}`:r,N=t.statement?`${t.statement}
`:"",I=`${E} wants you to sign in with your Ethereum account:
${_}

${N}`;let P=`URI: ${v}
Version: ${w}
Chain ID: ${n}${c?`
Nonce: ${c}`:""}
Issued At: ${o.toISOString()}`;if(a&&(P+=`
Expiration Time: ${a.toISOString()}`),d&&(P+=`
Not Before: ${d.toISOString()}`),p&&(P+=`
Request ID: ${p}`),h){let U=`
Resources:`;for(const R of h){if(!R||typeof R!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${R}`);U+=`
- ${R}`}P+=U}return`${I}
${P}`}class vt extends Error{constructor({message:e,code:n,cause:r,name:a}){var o;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(o=a??(r instanceof Error?r.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=n}}class jl extends vt{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function _4({error:t,options:e}){var n,r,a;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new vt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=o.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new vt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new vt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=o.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new vt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new vt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new vt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return o.pubKeyCredParams.filter(d=>d.type==="public-key").length===0?new vt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new vt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const c=window.location.hostname;if(Cb(c)){if(o.rp.id!==c)return new vt({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new vt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new vt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new vt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new vt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function S4({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new vt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new vt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(Cb(r)){if(n.rpId!==r)return new vt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new vt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new vt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new vt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class E4{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const T4=new E4;function N4(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,a=Pi(t,["challenge","user","excludeCredentials"]),o=Ei(e).buffer,c=Object.assign(Object.assign({},n),{id:Ei(n.id).buffer}),d=Object.assign(Object.assign({},a),{challenge:o,user:c});if(r&&r.length>0){d.excludeCredentials=new Array(r.length);for(let p=0;p<r.length;p++){const h=r[p];d.excludeCredentials[p]=Object.assign(Object.assign({},h),{id:Ei(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return d}function C4(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Pi(t,["challenge","allowCredentials"]),a=Ei(e).buffer,o=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){o.allowCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const d=n[c];o.allowCredentials[c]=Object.assign(Object.assign({},d),{id:Ei(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return o}function A4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:wr(new Uint8Array(t.response.attestationObject)),clientDataJSON:wr(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function I4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:wr(new Uint8Array(a.authenticatorData)),clientDataJSON:wr(new Uint8Array(a.clientDataJSON)),signature:wr(new Uint8Array(a.signature)),userHandle:a.userHandle?wr(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Cb(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function px(){var t,e;return!!(Ut()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function R4(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new jl("Browser returned unexpected credential type",e)}:{data:null,error:new jl("Empty credential response",e)}}catch(e){return{data:null,error:_4({error:e,options:t})}}}async function D4(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new jl("Browser returned unexpected credential type",e)}:{data:null,error:new jl("Empty credential response",e)}}catch(e){return{data:null,error:S4({error:e,options:t})}}}const M4={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},P4={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ol(...t){const e=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of t)if(a)for(const o in a){const c=a[o];if(c!==void 0)if(Array.isArray(c))r[o]=c;else if(n(c))r[o]=c;else if(e(c)){const d=r[o];e(d)?r[o]=Ol(d,c):r[o]=Ol(c)}else r[o]=c}return r}function k4(t,e){return Ol(M4,t,e||{})}function U4(t,e){return Ol(P4,t,e||{})}class j4{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:a},o){try{const{data:c,error:d}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!c)return{data:null,error:d};const p=a??T4.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:h}=c.webauthn.credential_options.publicKey;h.name||(h.name=`${h.id}:${r}`),h.displayName||(h.displayName=h.name)}switch(c.webauthn.type){case"create":{const h=k4(c.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:x,error:v}=await R4({publicKey:h,signal:p});return x?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:x}},error:null}:{data:null,error:v}}case"request":{const h=U4(c.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:x,error:v}=await D4(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:h,signal:p}));return x?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:x}},error:null}:{data:null,error:v}}}}catch(c){return we(c)?{data:null,error:c}:{data:null,error:new vr("Unexpected error in challenge",c)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!n)return{data:null,error:new Oa("rpId is required for WebAuthn authentication")};try{if(!px())return{data:null,error:new vr("Browser does not support WebAuthn",null)};const{data:c,error:d}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:o});if(!c)return{data:null,error:d};const{webauthn:p}=c;return this._verify({factorId:e,challengeId:c.challengeId,webauthn:{type:p.type,rpId:n,rpOrigins:r,credential_response:p.credential_response}})}catch(c){return we(c)?{data:null,error:c}:{data:null,error:new vr("Unexpected error in authenticate",c)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!n)return{data:null,error:new Oa("rpId is required for WebAuthn registration")};try{if(!px())return{data:null,error:new vr("Browser does not support WebAuthn",null)};const{data:c,error:d}=await this._enroll({friendlyName:e});if(!c)return await this.client.mfa.listFactors().then(x=>{var v;return(v=x.data)===null||v===void 0?void 0:v.all.find(w=>w.factor_type==="webauthn"&&w.friendly_name===e&&w.status!=="unverified")}).then(x=>x?this.client.mfa.unenroll({factorId:x==null?void 0:x.id}):void 0),{data:null,error:d};const{data:p,error:h}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:o});return p?this._verify({factorId:c.id,challengeId:p.challengeId,webauthn:{rpId:n,rpOrigins:r,type:p.webauthn.type,credential_response:p.webauthn.credential_response}}):{data:null,error:h}}catch(c){return we(c)?{data:null,error:c}:{data:null,error:new vr("Unexpected error in register",c)}}}}x4();const O4={url:PR,storageKey:kR,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:UR,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function mx(t,e,n){return await n()}const pi={};class La{get jwks(){var e,n;return(n=(e=pi[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){pi[this.storageKey]=Object.assign(Object.assign({},pi[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=pi[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){pi[this.storageKey]=Object.assign(Object.assign({},pi[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},O4),e);if(this.storageKey=o.storageKey,this.instanceID=(n=La.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,La.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&Ut()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new m4({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Eb(o.fetch),this.lock=o.lock||mx,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:Ut()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=y4:this.lock=mx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new j4(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Sb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=hx(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=hx(this.memoryStorage)),Ut()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c),await this._notifyAllSubscribers(c.data.event,c.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${bb}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Ut()&&(n=KR(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Ut()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:o}=await this._getSessionFromURL(n,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),VR(o)){const p=(e=o.details)===null||e===void 0?void 0:e.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:c,redirectType:d}=a;return this._debug("#_initialize()","detected session in URL",c,"redirect type",d),await this._saveSession(c),setTimeout(async()=>{d==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return we(n)?this._returnResult({error:n}):this._returnResult({error:new vr("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,a;try{const o=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e==null?void 0:e.options)===null||a===void 0?void 0:a.captchaToken}},xform:In}),{data:c,error:d}=o;if(d||!c)return this._returnResult({data:{user:null,session:null},error:d});const p=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(o){if(we(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var n,r,a;try{let o;if("email"in e){const{email:x,password:v,options:w}=e;let _=null,E=null;this.flowType==="pkce"&&([_,E]=await di(this.storage,this.storageKey)),o=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:w==null?void 0:w.emailRedirectTo,body:{email:x,password:v,data:(n=w==null?void 0:w.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},code_challenge:_,code_challenge_method:E},xform:In})}else if("phone"in e){const{phone:x,password:v,options:w}=e;o=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:x,password:v,data:(r=w==null?void 0:w.data)!==null&&r!==void 0?r:{},channel:(a=w==null?void 0:w.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken}},xform:In})}else throw new vl("You must provide either an email or phone number and a password");const{data:c,error:d}=o;if(d||!c)return this._returnResult({data:{user:null,session:null},error:d});const p=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(o){if(we(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let n;if("email"in e){const{email:o,password:c,options:d}=e;n=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:dx})}else if("phone"in e){const{phone:o,password:c,options:d}=e;n=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:dx})}else throw new vl("You must provide either an email or phone number and a password");const{data:r,error:a}=n;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!r||!r.session||!r.user){const o=new ui;return this._returnResult({data:{user:null,session:null},error:o})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,a,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,a,o,c,d,p,h,x,v,w;let _,E;if("message"in e)_=e.message,E=e.signature;else{const{chain:N,wallet:I,statement:P,options:U}=e;let R;if(Ut())if(typeof I=="object")R=I;else{const J=window;if("ethereum"in J&&typeof J.ethereum=="object"&&"request"in J.ethereum&&typeof J.ethereum.request=="function")R=J.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof I!="object"||!(U!=null&&U.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=I}const A=new URL((n=U==null?void 0:U.url)!==null&&n!==void 0?n:window.location.href),k=await R.request({method:"eth_requestAccounts"}).then(J=>J).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!k||k.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const q=Nb(k[0]);let V=(r=U==null?void 0:U.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!V){const J=await R.request({method:"eth_chainId"});V=v4(J)}const W={domain:A.host,address:q,statement:P,uri:A.href,version:"1",chainId:V,nonce:(a=U==null?void 0:U.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(c=(o=U==null?void 0:U.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(d=U==null?void 0:U.signInWithEthereum)===null||d===void 0?void 0:d.expirationTime,notBefore:(p=U==null?void 0:U.signInWithEthereum)===null||p===void 0?void 0:p.notBefore,requestId:(h=U==null?void 0:U.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(x=U==null?void 0:U.signInWithEthereum)===null||x===void 0?void 0:x.resources};_=w4(W),E=await R.request({method:"personal_sign",params:[b4(_),q]})}try{const{data:N,error:I}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:_,signature:E},!((v=e.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(w=e.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:In});if(I)throw I;if(!N||!N.session||!N.user){const P=new ui;return this._returnResult({data:{user:null,session:null},error:P})}return N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),this._returnResult({data:Object.assign({},N),error:I})}catch(N){if(we(N))return this._returnResult({data:{user:null,session:null},error:N});throw N}}async signInWithSolana(e){var n,r,a,o,c,d,p,h,x,v,w,_;let E,N;if("message"in e)E=e.message,N=e.signature;else{const{chain:I,wallet:P,statement:U,options:R}=e;let A;if(Ut())if(typeof P=="object")A=P;else{const q=window;if("solana"in q&&typeof q.solana=="object"&&("signIn"in q.solana&&typeof q.solana.signIn=="function"||"signMessage"in q.solana&&typeof q.solana.signMessage=="function"))A=q.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof P!="object"||!(R!=null&&R.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");A=P}const k=new URL((n=R==null?void 0:R.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in A&&A.signIn){const q=await A.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},R==null?void 0:R.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),U?{statement:U}:null));let V;if(Array.isArray(q)&&q[0]&&typeof q[0]=="object")V=q[0];else if(q&&typeof q=="object"&&"signedMessage"in q&&"signature"in q)V=q;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in V&&"signature"in V&&(typeof V.signedMessage=="string"||V.signedMessage instanceof Uint8Array)&&V.signature instanceof Uint8Array)E=typeof V.signedMessage=="string"?V.signedMessage:new TextDecoder().decode(V.signedMessage),N=V.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in A)||typeof A.signMessage!="function"||!("publicKey"in A)||typeof A!="object"||!A.publicKey||!("toBase58"in A.publicKey)||typeof A.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${k.host} wants you to sign in with your Solana account:`,A.publicKey.toBase58(),...U?["",U,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(a=(r=R==null?void 0:R.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((o=R==null?void 0:R.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${R.signInWithSolana.notBefore}`]:[],...!((c=R==null?void 0:R.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${R.signInWithSolana.expirationTime}`]:[],...!((d=R==null?void 0:R.signInWithSolana)===null||d===void 0)&&d.chainId?[`Chain ID: ${R.signInWithSolana.chainId}`]:[],...!((p=R==null?void 0:R.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${R.signInWithSolana.nonce}`]:[],...!((h=R==null?void 0:R.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${R.signInWithSolana.requestId}`]:[],...!((v=(x=R==null?void 0:R.signInWithSolana)===null||x===void 0?void 0:x.resources)===null||v===void 0)&&v.length?["Resources",...R.signInWithSolana.resources.map(V=>`- ${V}`)]:[]].join(`
`);const q=await A.signMessage(new TextEncoder().encode(E),"utf8");if(!q||!(q instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=q}}try{const{data:I,error:P}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:wr(N)},!((w=e.options)===null||w===void 0)&&w.captchaToken?{gotrue_meta_security:{captcha_token:(_=e.options)===null||_===void 0?void 0:_.captchaToken}}:null),xform:In});if(P)throw P;if(!I||!I.session||!I.user){const U=new ui;return this._returnResult({data:{user:null,session:null},error:U})}return I.session&&(await this._saveSession(I.session),await this._notifyAllSubscribers("SIGNED_IN",I.session)),this._returnResult({data:Object.assign({},I),error:P})}catch(I){if(we(I))return this._returnResult({data:{user:null,session:null},error:I});throw I}}async _exchangeCodeForSession(e){const n=await pr(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{const{data:o,error:c}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:In});if(await Gs(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!o||!o.session||!o.user){const d=new ui;return this._returnResult({data:{user:null,session:null,redirectType:null},error:d})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:c})}catch(o){if(we(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:n,provider:r,token:a,access_token:o,nonce:c}=e,d=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:o,nonce:c,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:In}),{data:p,error:h}=d;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!p||!p.session||!p.user){const x=new ui;return this._returnResult({data:{user:null,session:null},error:x})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:p,error:h})}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,a,o,c;try{if("email"in e){const{email:d,options:p}=e;let h=null,x=null;this.flowType==="pkce"&&([h,x]=await di(this.storage,this.storageKey));const{error:v}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},create_user:(r=p==null?void 0:p.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:h,code_challenge_method:x},redirectTo:p==null?void 0:p.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in e){const{phone:d,options:p}=e,{data:h,error:x}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:d,data:(a=p==null?void 0:p.data)!==null&&a!==void 0?a:{},create_user:(o=p==null?void 0:p.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},channel:(c=p==null?void 0:p.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:x})}throw new vl("You must provide either an email or phone number.")}catch(d){if(we(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async verifyOtp(e){var n,r;try{let a,o;"options"in e&&(a=(n=e.options)===null||n===void 0?void 0:n.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:d}=await Ae(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:In});if(d)throw d;if(!c)throw new Error("An error occurred on token verification.");const p=c.session,h=c.user;return p!=null&&p.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(a){if(we(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(e){var n,r,a,o,c;try{let d=null,p=null;this.flowType==="pkce"&&([d,p]=await di(this.storage,this.storageKey));const h=await Ae(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e==null?void 0:e.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:d,code_challenge_method:p}),headers:this.headers,xform:f4});return!((o=h.data)===null||o===void 0)&&o.url&&Ut()&&!(!((c=e.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(d){if(we(d))return this._returnResult({data:null,error:d});throw d}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new An;const{error:a}=await Ae(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(e){if(we(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:o}=e,{error:c}=await Ae(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in e){const{phone:r,type:a,options:o}=e,{data:c,error:d}=await Ae(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new vl("You must provide either an email or phone number and a type")}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await pr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Md:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await pr(this.userStorage,this.storageKey+"-user");c!=null&&c.user?e.user=c.user:e.user=Ud()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};e.user=l4(e.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:zs}):await this._useSession(async n=>{var r,a,o;const{data:c,error:d}=n;if(d)throw d;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new An}:await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:zs})})}catch(n){if(we(n))return BR(n)&&(await this._removeSession(),await Gs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:a,error:o}=r;if(o)throw o;if(!a.session)throw new An;const c=a.session;let d=null,p=null;this.flowType==="pkce"&&e.email!=null&&([d,p]=await di(this.storage,this.storageKey));const{data:h,error:x}=await Ae(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:d,code_challenge_method:p}),jwt:c.access_token,xform:zs});if(x)throw x;return c.user=h.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(r){if(we(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new An;const n=Date.now()/1e3;let r=n,a=!0,o=null;const{payload:c}=kd(e.access_token);if(c.exp&&(r=c.exp,a=r<=n),a){const{data:d,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!d)return{data:{user:null,session:null},error:null};o=d}else{const{data:d,error:p}=await this._getUser(e.access_token);if(p)throw p;o={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(n){if(we(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:c,error:d}=n;if(d)throw d;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new An;const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Ut())throw new bl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new bl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new rx("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new bl("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new rx("No code detected.");const{data:U,error:R}=await this._exchangeCodeForSession(e.code);if(R)throw R;const A=new URL(window.location.href);return A.searchParams.delete("code"),window.history.replaceState(window.history.state,"",A.toString()),{data:{session:U.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:o,refresh_token:c,expires_in:d,expires_at:p,token_type:h}=e;if(!o||!d||!c||!h)throw new bl("No session defined in URL");const x=Math.round(Date.now()/1e3),v=parseInt(d);let w=x+v;p&&(w=parseInt(p));const _=w-x;_*1e3<=gi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${_}s, should have been closer to ${v}s`);const E=w-v;x-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,w,x):x-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,w,x);const{data:N,error:I}=await this._getUser(o);if(I)throw I;const P={provider_token:r,provider_refresh_token:a,access_token:o,expires_in:v,expires_at:w,refresh_token:c,token_type:h,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:P,redirectType:e.type},error:null})}catch(r){if(we(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await pr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({error:o});const c=(r=a.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:d}=await this.admin.signOut(c,e);if(d&&!(qR(d)&&(d.status===404||d.status===401||d.status===403)))return this._returnResult({error:d})}return e!=="others"&&(await this._removeSession(),await Gs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=YR(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,a;try{const{data:{session:o},error:c}=n;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await di(this.storage,this.storageKey,!0));try{return await Ae(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(o){if(we(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:a}=await this._useSession(async o=>{var c,d,p,h,x;const{data:v,error:w}=o;if(w)throw w;const _=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(d=e.options)===null||d===void 0?void 0:d.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await Ae(this.fetch,"GET",_,{headers:this.headers,jwt:(x=(h=v.session)===null||h===void 0?void 0:h.access_token)!==null&&x!==void 0?x:void 0})});if(a)throw a;return Ut()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(we(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:o}}=n;if(a)throw a;const{options:c,provider:d,token:p,access_token:h,nonce:x}=e,v=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=o==null?void 0:o.access_token)!==null&&r!==void 0?r:void 0,body:{provider:d,id_token:p,access_token:h,nonce:x,link_identity:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:In}),{data:w,error:_}=v;return _?this._returnResult({data:{user:null,session:null},error:_}):!w||!w.session||!w.user?this._returnResult({data:{user:null,session:null},error:new ui}):(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("USER_UPDATED",w.session)),this._returnResult({data:w,error:_}))}catch(a){if(we(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,a;const{data:o,error:c}=n;if(c)throw c;return await Ae(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await WR(async a=>(a>0&&await XR(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await Ae(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:In})),(a,o)=>{const c=200*Math.pow(2,a);return o&&Pd(o)&&Date.now()+c-r<gi})}catch(r){if(this._debug(n,"error",r),we(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Ut()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await pr(this.storage,this.storageKey);if(a&&this.userStorage){let c=await pr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:a.user},await yi(this.userStorage,this.storageKey+"-user",c)),a.user=(e=c==null?void 0:c.user)!==null&&e!==void 0?e:Ud()}else if(a&&!a.user&&!a.user){const c=await pr(this.storage,this.storageKey+"-user");c&&(c!=null&&c.user)?(a.user=c.user,await Gs(this.storage,this.storageKey+"-user"),await yi(this.storage,this.storageKey,a)):a.user=Ud()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const o=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Md;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Md}s`),o){if(this.autoRefreshToken&&a.refresh_token){const{error:c}=await this._callRefreshToken(a.refresh_token);c&&(console.error(c),Pd(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:d}=await this._getUser(a.access_token);!d&&(c!=null&&c.user)?(a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new An;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Kl;const{data:o,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!o.session)throw new An;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const d={data:o.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(o){if(this._debug(a,"error",o),we(o)){const c={data:null,error:o};return Pd(o)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,n,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const o=[],c=Array.from(this.stateChangeEmitters.values()).map(async d=>{try{await d.callback(e,n)}catch(p){o.push(p)}});if(await Promise.all(c),o.length>0){for(let d=0;d<o.length;d+=1)console.error(o[d]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await yi(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const o=cx(a);await yi(this.storage,this.storageKey,o)}else{const a=cx(n);await yi(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await Gs(this.storage,this.storageKey),await Gs(this.storage,this.storageKey+"-code-verifier"),await Gs(this.storage,this.storageKey+"-user"),this.userStorage&&await Gs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ut()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),gi);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/gi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${gi}ms, refresh threshold is ${cf} ticks`),a<=cf&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Tb)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ut()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,c]=await di(this.storage,this.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(c)}`});a.push(d.toString())}if(r!=null&&r.queryParams){const o=new URLSearchParams(r.queryParams);a.push(o.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;return o?this._returnResult({data:null,error:o}):await Ae(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,a;const{data:o,error:c}=n;if(c)return this._returnResult({data:null,error:c});const d=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:p,error:h}=await Ae(this.fetch,"POST",`${this.url}/factors`,{body:d,headers:this.headers,jwt:(r=o==null?void 0:o.session)===null||r===void 0?void 0:r.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&p.type==="totp"&&(!((a=p==null?void 0:p.totp)===null||a===void 0)&&a.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),this._returnResult({data:p,error:null}))})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({data:null,error:o});const c=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?A4(e.webauthn.credential_response):I4(e.webauthn.credential_response)})}:{code:e.code}),{data:d,error:p}=await Ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:c,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return p?this._returnResult({data:null,error:p}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+d.expires_in},d)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",d),this._returnResult({data:d,error:p}))})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({data:null,error:o});const c=await Ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});if(c.error)return c;const{data:d}=c;if(d.type!=="webauthn")return{data:d,error:null};switch(d.webauthn.type){case"create":return{data:Object.assign(Object.assign({},d),{webauthn:Object.assign(Object.assign({},d.webauthn),{credential_options:Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:N4(d.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},d),{webauthn:Object.assign(Object.assign({},d.webauthn),{credential_options:Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:C4(d.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])a.all.push(o),o.status==="verified"&&a[o.factor_type].push(o);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=kd(r.access_token);let c=null;o.aal&&(c=o.aal);let d=c;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(x=>x.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(d="aal2");const h=o.amr||[];return{data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?await Ae(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new An})})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new An});const c=await Ae(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:d=>({data:d,error:null})});return c.data&&c.data.redirect_url&&Ut()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(r){if(we(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new An});const c=await Ae(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:d=>({data:d,error:null})});return c.data&&c.data.redirect_url&&Ut()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(r){if(we(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(d=>d.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(d=>d.kid===e),r&&this.jwks_cached_at+OR>a)return r;const{data:o,error:c}=await Ae(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=a,r=o.keys.find(d=>d.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:_,error:E}=await this.getSession();if(E||!_.session)return this._returnResult({data:null,error:E});r=_.session.access_token}const{header:a,payload:o,signature:c,raw:{header:d,payload:p}}=kd(r);n!=null&&n.allowExpired||i4(o.exp);const h=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!h){const{error:_}=await this.getUser(r);if(_)throw _;return{data:{claims:o,header:a,signature:c},error:null}}const x=a4(a.alg),v=await crypto.subtle.importKey("jwk",h,x,!0,["verify"]);if(!await crypto.subtle.verify(x,v,c,$R(`${d}.${p}`)))throw new ff("Invalid JWT signature");return{data:{claims:o,header:a,signature:c},error:null}}catch(r){if(we(r))return this._returnResult({data:null,error:r});throw r}}}La.nextInstanceID={};const L4=La;class q4 extends L4{constructor(e){super(e)}}class B4{constructor(e,n,r){var a,o,c;this.supabaseUrl=e,this.supabaseKey=n;const d=MR(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",d),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",d),this.storageUrl=new URL("storage/v1",d),this.functionsUrl=new URL("functions/v1",d);const p=`sb-${d.hostname.split(".")[0]}-auth-token`,h={db:ER,realtime:NR,auth:Object.assign(Object.assign({},TR),{storageKey:p}),global:SR},x=DR(r??{},h);this.storageKey=(a=x.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=x.global.headers)!==null&&o!==void 0?o:{},x.accessToken?(this.accessToken=x.accessToken,this.auth=new Proxy({},{get:(v,w)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(w)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=x.auth)!==null&&c!==void 0?c:{},this.headers,x.global.fetch),this.fetch=IR(n,this._getAccessToken.bind(this),x.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},x.realtime)),this.accessToken&&this.accessToken().then(v=>this.realtime.setAuth(v)).catch(v=>console.warn("Failed to set initial Realtime auth token:",v)),this.rest=new PI(new URL("rest/v1",d).href,{headers:this.headers,schema:x.db.schema,fetch:this.fetch}),this.storage=new bR(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),x.accessToken||this._listenForAuthEvents()}get functions(){return new II(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:o,storageKey:c,flowType:d,lock:p,debug:h,throwOnError:x},v,w){const _={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new q4({url:this.authUrl.href,headers:Object.assign(Object.assign({},_),v),storageKey:c,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:o,flowType:d,lock:p,debug:h,throwOnError:x,fetch:w,hasCustomAuthorizationHeader:Object.keys(this.headers).some(E=>E.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new QI(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const V4=(t,e,n)=>new B4(t,e,n);function G4(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}G4()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const H4="https://xzlqxctmgygpghaubsvt.supabase.co",z4="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6bHF4Y3RtZ3lncGdoYXVic3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxODk3MDUsImV4cCI6MjA3ODc2NTcwNX0.SJKSgc4fwoS9mLamnU75DNmxilBqho-Hi6OgZWEgiO4";let Ab=null;Ab=V4(H4,z4,{auth:{persistSession:!1}});const hs=Ab,gx={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var yx={};const F4="simulated_local",$4=F4==="simulated_local",Sr=(t,e)=>{const n=typeof import.meta<"u"&&gx?gx[t]:void 0,r=typeof process<"u"&&yx?yx[t]:void 0;return(n??r??e??"").toString()},ds=(()=>{const t=Sr("VITE_ENABLE_DAN","false").toLowerCase();return t==="1"||t==="true"||t==="yes"})(),J4=Sr("VITE_DAN_DERIVATION_SALT","dan-dev-salt");Sr("VITE_DAN_REALTIME_CHANNEL","dan_events");const Y4=Sr("VITE_SUPABASE_URL",Sr("SUPABASE_URL","")),K4=Sr("VITE_SUPABASE_ANON_KEY",Sr("SUPABASE_ANON_KEY",""));ds&&(!Y4||!K4)&&console.warn("[Config] DAN is enabled but Supabase credentials are missing. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY (or SUPABASE_URL/SUPABASE_ANON_KEY) in your environment.");const Ib="dan:keypairs:v1",Ll="dan:event-buffer:v1",Rb=()=>typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null,$f=(t,e)=>{const n=Rb();if(!n)return e;try{const r=n.getItem(t);return r?JSON.parse(r):e}catch{return e}},Jf=(t,e)=>{const n=Rb();if(n)try{n.setItem(t,JSON.stringify(e))}catch{}},Q4=t=>Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join(""),X4=()=>{if(typeof globalThis>"u")return null;const t=globalThis.crypto;return t&&t.subtle?t.subtle:null},ql=async t=>{const e=X4();if(!e){let a=0;for(let o=0;o<t.length;o+=1)a=(a<<5)-a+t.charCodeAt(o),a|=0;return`fallback-${Math.abs(a).toString(16)}`}const n=new TextEncoder().encode(t),r=await e.digest("SHA-256",n);return Q4(r)},Ql=async t=>{const e=typeof t=="string"?t:JSON.stringify(t??{});return ql(e)},W4=async t=>{const e=`${t}:${za||"global"}:${J4}`,n=await ql(`${e}:private`),r=await ql(`${n}:public`),a=r.slice(0,16);return{publicKey:r,fingerprint:a,derivedAt:new Date().toISOString(),privateKey:n}},Db=()=>$f(Ib,{}),Z4=t=>Jf(Ib,t),eD=t=>Db()[t]||null,Mb=(t,e)=>{const n=Db();n[t]=e,Z4(n)},tD=async(t,e)=>{if(!hs)return!1;try{const n=new Date().toISOString(),{error:r}=await hs.from("dan_keys").upsert({shop_id:t,namespace:za,public_key:e.publicKey,fingerprint:e.fingerprint,capability_scope:["local","dan"],last_seen_at:n},{onConflict:"shop_id"});return r?(console.warn("[DAN] Failed to register key with control plane",r),!1):(Mb(t,{...e,lastRegisteredAt:n}),!0)}catch(n){return console.warn("[DAN] Error registering key",n),!1}},nD=async()=>{const t=le;if(!t||!ds)return null;let e=eD(t);return e||(e=await W4(t),Mb(t,e)),hs&&await tD(t,e),e},sD=async()=>{if(!hs)return;const t=$f(Ll,[]);if(t.length)try{const e=t.map(r=>({event_id:r.eventId,shop_id:r.shopId,namespace:r.namespace,event_type:r.eventType,payload:r.payload,share_scope:r.shareScope,vector_context:r.vectorContext,proofs:r.proofs,actor_public_key:r.actor.publicKey,actor_fingerprint:r.actor.fingerprint,actor_signature:r.actor.signature,created_at:r.createdAt})),{error:n}=await hs.from("dan_events").insert(e);n||Jf(Ll,[])}catch(e){console.warn("[DAN] Failed to flush buffered events",e)}},Yf=t=>{const e=new Set(["local"]);return(t||[]).forEach(n=>{n&&e.add(n)}),Array.from(e)},rD=t=>Yf(t).includes("dan"),Pb=()=>ds,Od=t=>{const e=$f(Ll,[]);e.push(t),Jf(Ll,e)},Kf=async t=>{if(!ds)return null;const e=le;if(!e)return null;const n=await nD();if(!n)return null;const r=Yf(t.shareScope),a=JSON.parse(JSON.stringify(t.payload||{})),o=await Ql(a),c=await ql(`${n.privateKey}:${o}`),d={eventId:Ct(),eventType:t.eventType,shopId:e,namespace:za||null,payload:a,shareScope:r,vectorContext:t.vectorContext||null,proofs:{...t.proofs||{},hash:o},actor:{publicKey:n.publicKey,fingerprint:n.fingerprint,signature:c},createdAt:new Date().toISOString()};if(await sD(),!hs)return Od(d),d;try{const{error:p}=await hs.from("dan_events").insert({event_id:d.eventId,shop_id:d.shopId,namespace:d.namespace,event_type:d.eventType,payload:d.payload,share_scope:d.shareScope,vector_context:d.vectorContext,proofs:d.proofs,actor_public_key:d.actor.publicKey,actor_fingerprint:d.actor.fingerprint,actor_signature:d.actor.signature,created_at:d.createdAt});p&&(console.warn("[DAN] Failed to send event to Supabase, buffering",p),Od(d))}catch(p){console.warn("[DAN] Error publishing event, buffering instead",p),Od(d)}return d},kb="dan:policies:v1",Ub="dan:policy-runs:v1",jb=()=>typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null,Ob=(t,e)=>{const n=jb();if(!n)return e;try{const r=n.getItem(t);return r?JSON.parse(r):e}catch{return e}},Lb=(t,e)=>{const n=jb();if(n)try{n.setItem(t,JSON.stringify(e))}catch{}},qb=()=>Ob(kb,{}),iD=t=>Lb(kb,t),aD=()=>Ob(Ub,{}),oD=t=>Lb(Ub,t),Bb=async(t,e)=>{var a;const n=qb();if((a=n[t])!=null&&a.length)return;const r={id:Ct(),shopId:t,name:"Auto-flag low inventory offers",description:"Warns when a DAN offer is created with quantity below 10 units so the shop can replenish locally before sharing.",eventType:"inventory.offer.created",scope:"inventory",version:"1.0",enabled:!0,conditions:[{field:"quantity",operator:"lt",value:10},{field:"shareScope",operator:"includes",value:"dan"}],actions:[{type:"notify",params:{message:"DAN offer shared while stock is below 10 units. Confirm replenishment or adjust sharing scope."}},{type:"create_dan_event",params:{trigger:"policy.auto-alert",shopName:e||"unknown shop"}}],author:"system",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};n[t]=[r],iD(n)},xx=async t=>{const e=t||le;return e?qb()[e]||[]:[]},lD=t=>{const e=aD(),n=e[t.shopId]||[];n.unshift(t),e[t.shopId]=n.slice(0,50),oD(e)},cD=(t,e)=>e.split(".").reduce((n,r)=>{if(n&&typeof n=="object"&&r in n)return n[r]},t),uD=(t,e)=>{const n=cD(e,t.field),r=t.value;switch(t.operator){case"eq":return n===r;case"neq":return n!==r;case"gt":return typeof n=="number"&&n>Number(r);case"gte":return typeof n=="number"&&n>=Number(r);case"lt":return typeof n=="number"&&n<Number(r);case"lte":return typeof n=="number"&&n<=Number(r);case"includes":case"contains":return Array.isArray(n)?n.includes(r):typeof n=="string"?n.toLowerCase().includes(String(r).toLowerCase()):!1;default:return!1}},dD=async(t,e,n)=>{var r,a,o;switch(t.type){case"notify":{const c=((r=t.params)==null?void 0:r.message)||`Policy "${e.name}" triggered for event ${n.eventType}`;console.info(`[PolicyEngine] ${c}`,{policyId:e.id,payload:n.payload});break}case"create_dan_event":{await Kf({eventType:"policy.trigger.executed",payload:{policyId:e.id,policyName:e.name,scope:e.scope,trigger:((a=t.params)==null?void 0:a.trigger)||"policy.action",eventPayload:n.payload}});break}case"tag_inventory":{console.debug("[PolicyEngine] tag_inventory action queued",{policyId:e.id,params:t.params});break}case"call_webhook":{const c=(o=t.params)==null?void 0:o.url;if(!c||typeof fetch>"u")break;try{await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({policyId:e.id,policyName:e.name,payload:n.payload})})}catch(d){console.warn("[PolicyEngine] call_webhook failed",d)}break}default:console.warn("[PolicyEngine] Unknown action type",t.type)}},Vb=async t=>{var o,c,d;const e=((o=t.payload)==null?void 0:o.shopId)||le||((d=(c=t.payload)==null?void 0:c.shop)==null?void 0:d.id)||null;if(!e)return;(await xx(e)).length||await Bb(e,Ri);const a=(await xx(e)).filter(p=>p.enabled&&p.eventType===t.eventType);if(a.length)for(const p of a){const h=p.conditions.every(v=>uD(v,t.payload)),x={id:Ct(),policyId:p.id,shopId:e,eventType:t.eventType,eventPayload:t.payload,outcome:h?"triggered":"skipped",notes:h?`Policy ${p.name} triggered`:"Condition check failed",createdAt:new Date().toISOString()};if(h)try{for(const v of p.actions)await dD(v,p,t)}catch(v){x.outcome="error",x.notes=`Action error: ${(v==null?void 0:v.message)||"unknown"}`}lD(x)}},Gb=()=>le||null,fD=t=>{const e=Gb();return e?t.filter(n=>n.shopId===e):t},hD=t=>t.quantity>0&&t.status!=="EMPTY"&&t.status!=="EXPIRED"&&(!t.status||t.status==="ACTIVE"),Hb=()=>{const t=Array.from(Be.stockItems.values()).filter(hD);return fD(t)},Qf=t=>Yf(t),Xl=t=>Pb()&&rD(t),pD=t=>t?t.split("T")[0]:new Date().toISOString().split("T")[0],zb=t=>{if(!t)return null;const e=t.trim();if(!e)return null;const n=e.split(/[\s-]/)[0];return n?n.toUpperCase():null},mD=(t,e)=>{const n=Be.products.get(t);return e||(n==null?void 0:n.name)||t},Fb=t=>{for(const e of Be.stockItems.values())if(e.inventoryUuid===t||e.qdrantId===t||String(e.id)===t)return e},gD=async(t,e,n)=>{if(Xl(e.shareScope||t.shareScope))try{const r=Qf(e.shareScope||t.shareScope),a={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:mD(t.productId,e.productName),quantity:t.quantity,expirationDate:pD(t.expirationDate),locationBucket:zb(t.location),sellPrice:t.sellPrice??e.sellPrice??null,batchId:n.batchId,supplierId:t.supplierId||n.supplierId||null,supplierName:n.supplierName||null,shopId:t.shopId,shareScope:r},o=await Ql(a),c=await kn(`${a.productName} ${a.quantity} ${a.locationBucket||""}`);await Kf({eventType:"inventory.offer.created",payload:{...a,proofHash:o},shareScope:r,vectorContext:c,proofs:{hash:o,link:`qdrant://items/${t.inventoryUuid}`}}),await Vb({eventType:"inventory.offer.created",payload:{...a},proofs:{hash:o}}),await Mv({inventoryUuid:t.inventoryUuid,productId:t.productId,productName:a.productName,quantity:t.quantity,expirationDate:a.expirationDate,locationBucket:a.locationBucket,sellPrice:a.sellPrice??null,shopId:t.shopId,shopName:Ri,shareScope:r,proofHash:o,vector:c})}catch(r){console.warn("[DAN] Failed to publish inventory.offer.created",r)}},yD=async(t,e,n)=>{if(Xl(t.shareScope))try{const r=Qf(t.shareScope),a=Math.max((t.quantity||0)-n,0),o={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:e,fulfilledQuantity:n,remainingQuantity:a,saleTimestamp:new Date().toISOString(),batchId:t.batchId,shopId:t.shopId,shareScope:r},c=await Ql(o),d=await kn(`${o.productName} fulfilled ${n}`);await Kf({eventType:"inventory.offer.fulfilled",payload:{...o,proofHash:c},shareScope:r,vectorContext:d,proofs:{hash:c,link:`qdrant://items/${t.inventoryUuid}`}}),await Vb({eventType:"inventory.offer.fulfilled",payload:o,proofs:{hash:c}}),a<=0?await bI(t.inventoryUuid):await Mv({inventoryUuid:t.inventoryUuid,productId:t.productId,productName:e,quantity:a,expirationDate:t.expirationDate,locationBucket:zb(t.location),sellPrice:t.sellPrice,shopId:t.shopId,shopName:Ri,shareScope:r,proofHash:c})}catch(r){console.warn("[DAN] Failed to publish inventory.offer.fulfilled",r)}},xD=async t=>{if(!Pb())return;const e=Array.from(Be.stockItems.values()).filter(n=>Xl(n.shareScope));if(e.length)for(const n of t){const r=Array.from(Be.products.values()).find(o=>o.name.toLowerCase()===n.productName.toLowerCase());if(!r)continue;const a=e.find(o=>o.productId===r.id);a&&await yD(a,n.productName,n.quantity)}},Wl=Fa,hf=gv,$b=()=>wI(),qa=t=>{const e=le,n=(t==null?void 0:t.id)||null;Ly(n?{...t,id:n}:null),e!==n&&(kv(),Pv(!1),console.log(`[VectorDB] Shop context changed: ${e||"null"} -> ${n||"null"}, resetting initialization`))},Xf=()=>Gb(),Jb=async()=>{if(console.log(`[VectorDB] initializeAndSeedDatabase called, _activeShopId: ${le}, _initialized: ${Xd}`),!le){console.warn("[VectorDB] initializeAndSeedDatabase: _activeShopId is not set, cannot initialize");return}if(Xd){console.log("[VectorDB] initializeAndSeedDatabase: Already initialized, skipping");return}console.log(`[VectorDB] Initializing database for shopId: ${le}`),await lv(),await Ml(),console.log(`[VectorDB] After loadDataFromQdrant: ${Be.products.size} products, ${Be.stockItems.size} stock items`),Be.products.size===0&&Be.stockItems.size===0&&(console.log("[VectorDB] No data found, seeding local store..."),await vD(le),await Ml(),console.log(`[VectorDB] After seeding: ${Be.products.size} products, ${Be.stockItems.size} stock items`)),await Bb(le,Ri),Pv(!0),console.log("[VectorDB] Database initialization complete")},vD=async t=>{const n=(await Mi({name:"Organic Foods Dist."})).id,r=[{supplier:"Organic Foods Dist.",deliveryDate:"2024-06-05",inventoryDate:"2024-06-05"}],a=[{batchIndex:0,productName:"Organic Oat Milk",manufacturer:"Oatly",category:"Beverages",expirationDate:"2024-12-15",quantity:50,quantityType:"cartons",costPerUnit:2.5,location:"Shelf A"}],o=[];r.forEach(c=>{const d=Ct(),p={...c,id:d};Be.batches.set(d,p),o.push(p)});for(const c of a){const d=o[c.batchIndex],p=Wd(c.productName),h={id:p,name:c.productName,manufacturer:c.manufacturer,category:c.category};Be.products.set(p,h),await Di({name:c.productName,manufacturer:c.manufacturer,category:c.category});const x=Ct(),v={id:Date.now()+Math.random(),inventoryUuid:x,shopId:t,productId:p,batchId:d.id,expirationDate:c.expirationDate,quantity:c.quantity,costPerUnit:c.costPerUnit,location:c.location,supplierId:n||void 0,buyPrice:c.costPerUnit,sellPrice:c.costPerUnit*1.4,images:c.images,scanMetadata:c.scanMetadata||null,createdByUserId:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),qdrantId:x,status:"ACTIVE",shareScope:["local"]};Be.stockItems.set(v.id,v),await Jl(v)}console.info(`[Data Service] Seeded starter data for shop ${t}`)},Ti=async(t,e)=>{if(!le)throw new Error("No shop selected. Shop role/ID required.");await lv();let r=(await Js()).find(v=>{var w;return v.name.toLowerCase()===((w=t.supplier)==null?void 0:w.toLowerCase())});!r&&t.supplier&&(r=await Mi({name:t.supplier}));const a=r==null?void 0:r.id;(await Fa()).forEach(v=>{Be.products.has(v.id)||Be.products.set(v.id,{id:v.id,name:v.name,manufacturer:v.manufacturer,category:v.category})});const c=new Map;for(const v of e){let w=Array.from(Be.products.values()).find(_=>_.name.toLowerCase()===v.productName.toLowerCase());if(w)c.set(v.productName,w.id);else{const _=await Di({name:v.productName,manufacturer:v.manufacturer,category:v.category});Be.products.set(_.id,{id:_.id,name:_.name,manufacturer:_.manufacturer,category:_.category}),c.set(v.productName,_.id)}}const d=Ct(),p={...t,id:d};Be.batches.set(d,p);const h=new Date().toISOString(),x={id:d,shopId:le||"",supplierId:a||null,deliveryDate:t.deliveryDate||h.split("T")[0],inventoryDate:t.inventoryDate||t.deliveryDate||h.split("T")[0],invoiceNumber:void 0,documents:[],lineItems:e.map(v=>({productId:c.get(v.productName)||Wd(v.productName),productName:v.productName,quantity:v.quantity||0,cost:v.buyPrice??v.costPerUnit??0})),createdAt:h,createdByUserId:le||""};await Mf(x);for(const v of e){const w=c.get(v.productName)||Wd(v.productName),_=Ct(),E=Qf(v.shareScope),N=Xl(E),I={id:Date.now()+Math.random(),inventoryUuid:_,shopId:le||"",productId:w,batchId:d,expirationDate:v.expirationDate,quantity:v.quantity,costPerUnit:v.costPerUnit,location:v.location,supplierId:v.supplierId||a||void 0,buyPrice:v.buyPrice??v.costPerUnit,sellPrice:v.sellPrice??void 0,images:v.images,scanMetadata:v.scanMetadata||null,createdByUserId:le||void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),qdrantId:_,status:"ACTIVE",shareScope:E};N&&(I.shareProofHash=await Ql({inventoryUuid:_,productId:w,batchId:d,quantity:I.quantity})),Be.stockItems.set(I.id,I),await Jl(I,I.scanMetadata||void 0),N&&await gD(I,v,{batchId:d,supplierId:I.supplierId,supplierName:t.supplier})}console.log(`[Data Service] Added batch ${p.id} with ${e.length} item types.`)},Yb=async(t,e)=>{if(!le)throw new Error("No shop selected. Shop role/ID required.");const n=Fb(t);if(!n)throw new Error(`Inventory item ${t} not found`);const r=e.quantity??n.quantity,a={...n,quantity:r,expirationDate:e.expirationDate??n.expirationDate,costPerUnit:e.costPerUnit??n.costPerUnit,buyPrice:e.buyPrice??e.costPerUnit??n.buyPrice??n.costPerUnit,sellPrice:e.sellPrice??n.sellPrice,location:e.location??n.location,updatedAt:new Date().toISOString(),status:r>0?"ACTIVE":"EMPTY"};return Be.stockItems.set(a.id,a),await Jl(a),a},Kb=async t=>{if(!le)throw new Error("No shop selected. Shop role/ID required.");const e=Fb(t);if(!e)throw new Error(`Inventory item ${t} not found`);Be.stockItems.delete(e.id),await Tv(e)},Wf=async t=>{if(!le)throw new Error("No shop selected.");const e=new Map;for(const n of Be.products.values())e.set(n.name,{id:n.id,name:n.name});await hI(t,e),await Ml(),await xD(t)},Zl=async()=>_I(()=>Promise.resolve(Hb()),Js),Qb=async()=>Array.from(Be.batches.values()),Zf=async()=>Hb(),ka=async t=>{if(!le)throw new Error("No shop selected.");const e=new Date().toISOString(),n={id:Ct(),shopId:le,supplierId:t.supplierId,deliveryDate:t.deliveryDate,inventoryDate:t.inventoryDate,invoiceNumber:t.invoiceNumber,documents:t.documents||[],lineItems:t.lineItems||[],createdAt:e,createdByUserId:le};return await Mf(n),t.lineItems&&t.lineItems.length>0&&await fI(n,t.lineItems),n},Xb=async(t,e)=>{await mI(t,e,async(n,r)=>{await Ti(n,r)},async n=>{await Uf(n)}),await Ml()},bD=Object.freeze(Object.defineProperty({__proto__:null,get activeNamespace(){return za},get activeShopId(){return le},get activeShopName(){return Ri},addImageForField:jf,addInventoryBatch:Ti,createBatchForShop:ka,createCanonicalProduct:Di,createShopNamespace:vv,deleteCanonicalProduct:mv,fetchBatchRecords:xv,fetchCanonicalProducts:Wl,fetchSuppliersForActiveShop:Js,getActiveShopId:Xf,getAllBatches:Qb,getAllSales:Cv,getAllShops:_v,getAllStockItems:Zf,getBatchRecords:yv,getCanonicalProducts:Fa,getDanInventoryOffers:$b,getLearnedFieldsForProduct:Dv,getMyMarketplaceListings:Iv,getProductSummaries:Zl,initializeAndSeedDatabase:Jb,listProductOnMarketplace:Av,persistSale:Uf,purchaseFromMarketplace:Xb,recordSale:Wf,registerLocalSupplier:Mi,removeInventoryItem:Kb,searchCanonicalProducts:gv,searchCatalogProducts:hf,searchRelevantInventoryItems:kf,setActiveShopContext:qa,updateCanonicalProduct:pv,updateInventoryItem:Yb,upsertBatchRecord:Mf,upsertCustomerRecord:wv,upsertDriverRecord:$l,upsertProductDefinition:Df,upsertShopRecord:bv,upsertSupplierProfile:Pf,upsertUserProfile:Tr,validateShopExists:Sv},Symbol.toStringTag,{value:"Module"})),wD=async t=>{var e;(e=t.roles)!=null&&e.shop&&await Tr({userId:t.clientId,displayName:t.companyName,email:t.email,contactEmail:t.email,shopId:t.shopId||null,isVerified:!1})},_D=async t=>{var e;(e=t.roles)!=null&&e.driver&&(await Tr({userId:t.clientId,displayName:t.companyName,email:t.email,contactEmail:t.email,isDriverVerified:!1}),t.driverId&&await $l({id:t.driverId,fullName:t.companyName,contactEmail:t.email,status:"pending",userId:t.clientId}))},SD=async(t,e)=>{if(!pe||!await tt("users"))return{isVerified:!0,isDriverVerified:!0};try{const n=Vt("users",t),r=await pe.retrieve("users",{ids:[n],with_payload:!0});if(r.points&&r.points.length>0){const a=r.points[0].payload;return{isVerified:e!=null&&e.requiresShopVerification?a.isVerified??!1:!0,isDriverVerified:e!=null&&e.requiresDriverVerification?a.isDriverVerified??!1:!0}}}catch(n){console.error("[Backend] Error fetching verification status:",n)}return{isVerified:!(e!=null&&e.requiresShopVerification),isDriverVerified:!(e!=null&&e.requiresDriverVerification)}},ED=async()=>{if(!pe||!await tt("users"))return[];try{return(await bt("users",null)).map(e=>{const n=e.payload;return n.shopId&&(n.isVerified===!1||n.isVerified===void 0)?{clientId:n.userId,companyName:n.displayName,contactPerson:n.displayName,address:"",email:n.email,role:"shop",isVerified:!1,isDriverVerified:n.isDriverVerified??!1,shopId:n.shopId,roles:{shop:!0,customer:!1,driver:!1,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching pending clients:",t),[]}},TD=async()=>{if(!pe||!await tt("users"))return[];try{return(await bt("users",null)).map(e=>{const n=e.payload;return n.shopId&&n.isVerified===!0?{clientId:n.userId,companyName:n.displayName,contactPerson:n.displayName,address:"",email:n.email,role:"shop",isVerified:!0,isDriverVerified:n.isDriverVerified??!1,shopId:n.shopId,roles:{shop:!0,customer:!1,driver:!1,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching verified clients:",t),[]}},ND=async()=>{if(!pe||!await tt("drivers"))return[];try{return(await bt("drivers",null)).map(e=>{const n=e.payload;return n.status==="pending"&&n.userId?{clientId:n.userId,companyName:n.name||"Driver",contactPerson:n.name||"Driver",address:"",email:n.contact||n.contactEmail||"",role:"driver",isVerified:!0,isDriverVerified:!1,driverId:n.driverId,roles:{shop:!1,customer:!1,driver:!0,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching pending drivers:",t),[]}},CD=async()=>{if(!pe||!await tt("drivers"))return[];try{return(await bt("drivers",null)).map(e=>{const n=e.payload;return n.status==="verified"&&n.userId?{clientId:n.userId,companyName:n.name||"Driver",contactPerson:n.name||"Driver",address:"",email:n.contact||n.contactEmail||"",role:"driver",isVerified:!0,isDriverVerified:!0,driverId:n.driverId,roles:{shop:!1,customer:!1,driver:!0,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching verified drivers:",t),[]}},AD=async t=>{if(!pe||!await tt("users")){console.warn("[Backend] Qdrant not available for verification");return}try{const e=Vt("users",t),n=await pe.retrieve("users",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;await Tr({userId:t,displayName:r.displayName,email:r.email,contactEmail:r.contactEmail,shopId:r.shopId,isVerified:!0,isDriverVerified:r.isDriverVerified}),console.log(`[Backend] Verified shop client: ${r.displayName}`)}else console.warn(`[Backend] User not found for verification: ${t}`)}catch(e){console.error("[Backend] Error verifying client:",e)}},ID=async t=>{if(!pe||!await tt("users")){console.warn("[Backend] Qdrant not available for driver verification");return}try{const e=Vt("users",t),n=await pe.retrieve("users",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;await Tr({userId:t,displayName:r.displayName,email:r.email,contactEmail:r.contactEmail,shopId:r.shopId,isVerified:r.isVerified,isDriverVerified:!0});const o=(await bt("drivers",null)).find(c=>c.payload.userId===t);if(o){const c=o.payload;await $l({id:c.driverId,fullName:c.name||r.displayName,contactEmail:c.contact||c.contactEmail||r.email,status:"verified",userId:t})}console.log(`[Backend] Verified driver: ${r.displayName}`)}else console.warn(`[Backend] User not found for driver verification: ${t}`)}catch(e){console.error("[Backend] Error verifying driver:",e)}},RD=[{id:"peer_1",name:"Gourmet Goods",listings:[{listingId:"gg_1",productName:"Artisanal Cheese",manufacturer:"Cheese Masters",category:"Dairy",quantity:20,quantityType:"kg",price:25.5,seller:{id:"peer_1",name:"Gourmet Goods"}},{listingId:"gg_2",productName:"Truffle Oil",manufacturer:"Italian Imports",category:"Pantry",quantity:50,quantityType:"bottles",price:15,seller:{id:"peer_1",name:"Gourmet Goods"}}]},{id:"peer_2",name:"The Fresh Market",listings:[{listingId:"tfm_1",productName:"Organic Avocados",manufacturer:"Fresh Farms",category:"Produce",quantity:100,quantityType:"units",price:1.5,seller:{id:"peer_2",name:"The Fresh Market"}}]}],DD=async t=>{if(!t.isVerified)throw new Error("User is not verified.");return Promise.resolve(RD.filter(e=>e.id!==t.clientId))},MD=async(t,e)=>{console.log(`[Backend] Consuming listing ${t}, quantity: ${e}`)},PD={};var pf=null;function kD(t){try{return crypto.getRandomValues(new Uint8Array(t))}catch{}try{return PD.randomBytes(t)}catch{}if(!pf)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return pf(t)}function UD(t){pf=t}function eh(t,e){if(t=t||th,typeof t!="number")throw Error("Illegal arguments: "+typeof t+", "+typeof e);t<4?t=4:t>31&&(t=31);var n=[];return n.push("$2b$"),t<10&&n.push("0"),n.push(t.toString()),n.push("$"),n.push(Bl(kD(Ba),Ba)),n.join("")}function Wb(t,e,n){if(typeof e=="function"&&(n=e,e=void 0),typeof t=="function"&&(n=t,t=void 0),typeof t>"u")t=th;else if(typeof t!="number")throw Error("illegal arguments: "+typeof t);function r(a){Dn(function(){try{a(null,eh(t))}catch(o){a(o)}})}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);r(n)}else return new Promise(function(a,o){r(function(c,d){if(c){o(c);return}a(d)})})}function Zb(t,e){if(typeof e>"u"&&(e=th),typeof e=="number"&&(e=eh(e)),typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return mf(t,e)}function ew(t,e,n,r){function a(o){typeof t=="string"&&typeof e=="number"?Wb(e,function(c,d){mf(t,d,o,r)}):typeof t=="string"&&typeof e=="string"?mf(t,e,o,r):Dn(o.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)))}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);a(n)}else return new Promise(function(o,c){a(function(d,p){if(d){c(d);return}o(p)})})}function tw(t,e){for(var n=t.length^e.length,r=0;r<t.length;++r)n|=t.charCodeAt(r)^e.charCodeAt(r);return n===0}function jD(t,e){if(typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return e.length!==60?!1:tw(Zb(t,e.substring(0,e.length-31)),e)}function OD(t,e,n,r){function a(o){if(typeof t!="string"||typeof e!="string"){Dn(o.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)));return}if(e.length!==60){Dn(o.bind(this,null,!1));return}ew(t,e.substring(0,29),function(c,d){c?o(c):o(null,tw(d,e))},r)}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);a(n)}else return new Promise(function(o,c){a(function(d,p){if(d){c(d);return}o(p)})})}function LD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return parseInt(t.split("$")[2],10)}function qD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);if(t.length!==60)throw Error("Illegal hash length: "+t.length+" != 60");return t.substring(0,29)}function BD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return nw(t)>72}var Dn=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function nw(t){for(var e=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?e+=1:n<2048?e+=2:(n&64512)===55296&&(t.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e}function VD(t){for(var e=0,n,r,a=new Array(nw(t)),o=0,c=t.length;o<c;++o)n=t.charCodeAt(o),n<128?a[e++]=n:n<2048?(a[e++]=n>>6|192,a[e++]=n&63|128):(n&64512)===55296&&((r=t.charCodeAt(o+1))&64512)===56320?(n=65536+((n&1023)<<10)+(r&1023),++o,a[e++]=n>>18|240,a[e++]=n>>12&63|128,a[e++]=n>>6&63|128,a[e++]=n&63|128):(a[e++]=n>>12|224,a[e++]=n>>6&63|128,a[e++]=n&63|128);return a}var mi="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),Hs=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function Bl(t,e){var n=0,r=[],a,o;if(e<=0||e>t.length)throw Error("Illegal len: "+e);for(;n<e;){if(a=t[n++]&255,r.push(mi[a>>2&63]),a=(a&3)<<4,n>=e){r.push(mi[a&63]);break}if(o=t[n++]&255,a|=o>>4&15,r.push(mi[a&63]),a=(o&15)<<2,n>=e){r.push(mi[a&63]);break}o=t[n++]&255,a|=o>>6&3,r.push(mi[a&63]),r.push(mi[o&63])}return r.join("")}function sw(t,e){var n=0,r=t.length,a=0,o=[],c,d,p,h,x,v;if(e<=0)throw Error("Illegal len: "+e);for(;n<r-1&&a<e&&(v=t.charCodeAt(n++),c=v<Hs.length?Hs[v]:-1,v=t.charCodeAt(n++),d=v<Hs.length?Hs[v]:-1,!(c==-1||d==-1||(x=c<<2>>>0,x|=(d&48)>>4,o.push(String.fromCharCode(x)),++a>=e||n>=r)||(v=t.charCodeAt(n++),p=v<Hs.length?Hs[v]:-1,p==-1)||(x=(d&15)<<4>>>0,x|=(p&60)>>2,o.push(String.fromCharCode(x)),++a>=e||n>=r)));)v=t.charCodeAt(n++),h=v<Hs.length?Hs[v]:-1,x=(p&3)<<6>>>0,x|=h,o.push(String.fromCharCode(x)),++a;var w=[];for(n=0;n<a;n++)w.push(o[n].charCodeAt(0));return w}var Ba=16,th=10,GD=16,HD=100,vx=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],bx=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],rw=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function Va(t,e,n,r){var a,o=t[e],c=t[e+1];return o^=n[0],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[1],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[2],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[3],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[4],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[5],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[6],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[7],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[8],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[9],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[10],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[11],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[12],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[13],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[14],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[15],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[16],t[e]=c^n[GD+1],t[e+1]=o,t}function xi(t,e){for(var n=0,r=0;n<4;++n)r=r<<8|t[e]&255,e=(e+1)%t.length;return{key:r,offp:e}}function wx(t,e,n){for(var r=0,a=[0,0],o=e.length,c=n.length,d,p=0;p<o;p++)d=xi(t,r),r=d.offp,e[p]=e[p]^d.key;for(p=0;p<o;p+=2)a=Va(a,0,e,n),e[p]=a[0],e[p+1]=a[1];for(p=0;p<c;p+=2)a=Va(a,0,e,n),n[p]=a[0],n[p+1]=a[1]}function zD(t,e,n,r){for(var a=0,o=[0,0],c=n.length,d=r.length,p,h=0;h<c;h++)p=xi(e,a),a=p.offp,n[h]=n[h]^p.key;for(a=0,h=0;h<c;h+=2)p=xi(t,a),a=p.offp,o[0]^=p.key,p=xi(t,a),a=p.offp,o[1]^=p.key,o=Va(o,0,n,r),n[h]=o[0],n[h+1]=o[1];for(h=0;h<d;h+=2)p=xi(t,a),a=p.offp,o[0]^=p.key,p=xi(t,a),a=p.offp,o[1]^=p.key,o=Va(o,0,n,r),r[h]=o[0],r[h+1]=o[1]}function _x(t,e,n,r,a){var o=rw.slice(),c=o.length,d;if(n<4||n>31)if(d=Error("Illegal number of rounds (4-31): "+n),r){Dn(r.bind(this,d));return}else throw d;if(e.length!==Ba)if(d=Error("Illegal salt length: "+e.length+" != "+Ba),r){Dn(r.bind(this,d));return}else throw d;n=1<<n>>>0;var p,h,x=0,v;typeof Int32Array=="function"?(p=new Int32Array(vx),h=new Int32Array(bx)):(p=vx.slice(),h=bx.slice()),zD(e,t,p,h);function w(){if(a&&a(x/n),x<n)for(var E=Date.now();x<n&&(x=x+1,wx(t,p,h),wx(e,p,h),!(Date.now()-E>HD)););else{for(x=0;x<64;x++)for(v=0;v<c>>1;v++)Va(o,v<<1,p,h);var N=[];for(x=0;x<c;x++)N.push((o[x]>>24&255)>>>0),N.push((o[x]>>16&255)>>>0),N.push((o[x]>>8&255)>>>0),N.push((o[x]&255)>>>0);if(r){r(null,N);return}else return N}r&&Dn(w)}if(typeof r<"u")w();else for(var _;;)if(typeof(_=w())<"u")return _||[]}function mf(t,e,n,r){var a;if(typeof t!="string"||typeof e!="string")if(a=Error("Invalid string / salt: Not a string"),n){Dn(n.bind(this,a));return}else throw a;var o,c;if(e.charAt(0)!=="$"||e.charAt(1)!=="2")if(a=Error("Invalid salt version: "+e.substring(0,2)),n){Dn(n.bind(this,a));return}else throw a;if(e.charAt(2)==="$")o="\0",c=3;else{if(o=e.charAt(2),o!=="a"&&o!=="b"&&o!=="y"||e.charAt(3)!=="$")if(a=Error("Invalid salt revision: "+e.substring(2,4)),n){Dn(n.bind(this,a));return}else throw a;c=4}if(e.charAt(c+2)>"$")if(a=Error("Missing salt rounds"),n){Dn(n.bind(this,a));return}else throw a;var d=parseInt(e.substring(c,c+1),10)*10,p=parseInt(e.substring(c+1,c+2),10),h=d+p,x=e.substring(c+3,c+25);t+=o>="a"?"\0":"";var v=VD(t),w=sw(x,Ba);function _(E){var N=[];return N.push("$2"),o>="a"&&N.push(o),N.push("$"),h<10&&N.push("0"),N.push(h.toString()),N.push("$"),N.push(Bl(w,w.length)),N.push(Bl(E,rw.length*4-1)),N.join("")}if(typeof n>"u")return _(_x(v,w,h));_x(v,w,h,function(E,N){E?n(E,null):n(null,_(N))},r)}function FD(t,e){return Bl(t,e)}function $D(t,e){return sw(t,e)}const iw={setRandomFallback:UD,genSaltSync:eh,genSalt:Wb,hashSync:Zb,hash:ew,compareSync:jD,compare:OD,getRounds:LD,getSalt:qD,truncates:BD,encodeBase64:FD,decodeBase64:$D},nh=()=>{if(!hs)throw new Error("Supabase is not configured.");return hs},aw=t=>t.shop?"shop":t.customer?"customer":t.driver?"driver":"supplier",ow=async t=>{const e={shop:t.is_shop,customer:t.is_customer,driver:t.is_driver,supplier:t.is_supplier},n=await SD(t.id,{requiresShopVerification:t.is_shop,requiresDriverVerification:t.is_driver}),r={clientId:t.id,companyName:t.display_name,contactPerson:t.display_name,address:"",email:t.email,role:aw(e),isVerified:n.isVerified,isDriverVerified:n.isDriverVerified,shopId:t.shop_qdrant_id||void 0,customerId:t.customer_qdrant_id||void 0,driverId:t.driver_qdrant_id||void 0,supplierId:t.supplier_qdrant_id||void 0,roles:e};let a=null;return t.is_shop&&t.shop_qdrant_id&&(a={id:t.shop_qdrant_id,name:t.display_name,contactEmail:t.contact_email,qdrantNamespace:t.qdrant_namespace||void 0}),qa(a),Tr({userId:t.id,qdrantUserId:t.qdrant_user_id||t.id,displayName:t.display_name,email:t.contact_email||t.email,contactEmail:t.contact_email||t.email,shopId:t.shop_qdrant_id||null}).catch(o=>console.error("[Auth] Failed to sync user to Qdrant:",o)),{user:r,shopContext:a}},JD=async t=>{const e=nh(),{error:n}=await e.from("users").insert([t]);if(n)throw n},YD=async t=>{nh();const e=t.roles;if(!e.shop&&!e.customer&&!e.driver&&!e.supplier)throw new Error("Please select at least one role.");const n=await iw.hash(t.password,10),r=Ct(),a=e.shop?Ct():null,o=e.customer?Ct():null,c=e.driver?Ct():null,d=e.supplier?Ct():null;await JD({id:r,username:t.username.trim(),email:t.email.trim(),contact_email:t.email.trim(),display_name:t.displayName.trim(),password_hash:n,is_shop:e.shop,is_customer:e.customer,is_driver:e.driver,is_supplier:e.supplier,qdrant_user_id:r,shop_qdrant_id:a,qdrant_namespace:a?`shop-${a}`:null,customer_qdrant_id:o,driver_qdrant_id:c,supplier_qdrant_id:d,metadata:e.driver&&t.licenseId?{licenseId:t.licenseId}:{}}),await Tr({userId:r,qdrantUserId:r,displayName:t.displayName.trim(),email:t.email.trim(),contactEmail:t.email.trim(),shopId:a}),e.shop&&a&&(await vv(),await bv({id:a,name:t.displayName.trim(),contactEmail:t.email.trim(),userId:r,qdrantNamespace:`shop-${a}`})),e.customer&&o&&await wv({id:o,fullName:t.displayName.trim(),contactEmail:t.email.trim()}),e.driver&&c&&await $l({id:c,fullName:t.displayName.trim(),contactEmail:t.email.trim(),status:"pending"}),e.supplier&&d&&await Pf({id:d,name:t.displayName.trim(),contactEmail:t.email.trim(),shopId:t.supplierShopId||null,linkedUserId:t.supplierShopId?null:r});const p={id:r,username:t.username.trim(),email:t.email.trim(),display_name:t.displayName.trim(),contact_email:t.email.trim(),is_shop:e.shop,is_customer:e.customer,is_driver:e.driver,is_supplier:e.supplier,qdrant_user_id:r,shop_qdrant_id:a,qdrant_namespace:a?`shop-${a}`:null,customer_qdrant_id:o,driver_qdrant_id:c,supplier_qdrant_id:d,metadata:{...e.driver&&t.licenseId?{licenseId:t.licenseId}:{},...e.supplier&&t.supplierShopId?{linkedShop:t.supplierShopId}:{}}},h={clientId:r,companyName:t.displayName.trim(),contactPerson:t.displayName.trim(),email:t.email.trim(),role:aw(e),isVerified:!e.shop,isDriverVerified:!e.driver,shopId:a||void 0,driverId:c||void 0,roles:e};return e.shop&&await wD(h),e.driver&&await _D(h),await ow(p)},KD=async t=>{const e=nh(),{data:n,error:r}=await e.from("users").select("*").eq("username",t.username.trim()).single();if(r||!n)throw new Error("Invalid username or password.");if(!await iw.compare(t.password,n.password_hash??""))throw new Error("Invalid username or password.");return await ow(n)},QD=({onSuccess:t})=>{const[e,n]=C.useState(""),[r,a]=C.useState(""),[o,c]=C.useState(null),[d,p]=C.useState(!1),h=async x=>{x.preventDefault(),p(!0),c(null);try{const v=await KD({username:e.trim(),password:r});t(v)}catch(v){c(v instanceof Error?v.message:"Login failed")}finally{p(!1)}};return f.jsxs("form",{onSubmit:h,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),f.jsx("input",{type:"text",value:e,onChange:x=>n(x.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",autoComplete:"username",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),f.jsx("input",{type:"password",value:r,onChange:x=>a(x.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",autoComplete:"current-password",required:!0})]}),o&&f.jsx("div",{className:"text-sm text-red-400 bg-red-900/30 border border-red-700 rounded-md px-3 py-2",children:o}),f.jsx("button",{type:"submit",disabled:d,className:"w-full py-2.5 rounded-md bg-cyan-600 hover:bg-cyan-700 text-white font-semibold transition disabled:opacity-60",children:d?"Signing in...":"Sign In"})]})},XD=({onSuccess:t})=>{const[e,n]=C.useState(""),[r,a]=C.useState(""),[o,c]=C.useState(""),[d,p]=C.useState(""),[h,x]=C.useState(""),[v,w]=C.useState({shop:!1,customer:!1,driver:!1,supplier:!1}),[_,E]=C.useState(""),[N,I]=C.useState(null),[P,U]=C.useState(!1),R=k=>{w(q=>({...q,[k]:!q[k]}))},A=async k=>{k.preventDefault(),U(!0),I(null);try{if(!(v.shop||v.customer||v.driver||v.supplier))throw new Error("Please select at least one role.");if(v.shop&&!e.trim())throw new Error("Shop owners must provide a shop name.");if(!v.shop&&!e.trim())throw new Error("Please provide your display name.");const V=await YD({username:r.trim(),email:o.trim(),password:d,displayName:e.trim(),roles:v,licenseId:v.driver?h.trim():void 0,supplierShopId:v.supplier&&_.trim()||void 0});t(V)}catch(q){I(q instanceof Error?q.message:"Registration failed")}finally{U(!1)}};return f.jsxs("form",{onSubmit:A,className:"space-y-4",children:[f.jsx("div",{className:"flex space-x-2",children:["shop","customer","driver","supplier"].map(k=>f.jsx("button",{type:"button",onClick:()=>R(k),className:`flex-1 py-2 rounded-md text-sm font-semibold capitalize ${v[k]?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:k},k))}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:v.shop?"Shop Name":"Display Name"}),f.jsx("input",{type:"text",value:e,onChange:k=>n(k.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),f.jsx("input",{type:"email",value:o,onChange:k=>c(k.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),f.jsx("input",{type:"text",value:r,onChange:k=>a(k.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),f.jsx("input",{type:"password",value:d,onChange:k=>p(k.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),v.driver&&f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"License ID (optional)"}),f.jsx("input",{type:"text",value:h,onChange:k=>x(k.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),v.supplier&&f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Associated Shop ID (optional)"}),f.jsx("input",{type:"text",value:_,onChange:k=>E(k.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Link yourself to a shop UUID if applicable"})]}),N&&f.jsx("div",{className:"text-sm text-red-400 bg-red-900/30 border border-red-700 rounded-md px-3 py-2",children:N}),f.jsx("button",{type:"submit",disabled:P,className:"w-full py-2.5 rounded-md bg-cyan-600 hover:bg-cyan-700 text-white font-semibold transition disabled:opacity-60",children:P?"Creating...":"Create Account"})]})},lw=({onAuthenticated:t})=>{const[e,n]=C.useState("login");return f.jsx("div",{className:"min-h-screen bg-gray-900 flex flex-col items-center justify-center p-6",children:f.jsxs("div",{className:"w-full max-w-lg bg-gray-800 border border-gray-700 rounded-xl p-6 shadow-2xl",children:[f.jsxs("div",{className:"flex space-x-2 mb-6",children:[f.jsx("button",{onClick:()=>n("login"),className:`flex-1 py-2 rounded-md font-semibold ${e==="login"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Login"}),f.jsx("button",{onClick:()=>n("register"),className:`flex-1 py-2 rounded-md font-semibold ${e==="register"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Create Account"})]}),e==="login"?f.jsx(QD,{onSuccess:t}):f.jsx(XD,{onSuccess:r=>{t(r),n("login")}})]})})},sh=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M12 2L9 9l-7 3 7 3 3 7 3-7 7-3-7-3-3-7z"}),f.jsx("path",{d:"M22 12l-3-1-1-3-1 3-3 1 3 1 1 3 1-3 3-1z"}),f.jsx("path",{d:"M5 3l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z"})]}),WD=({activeTab:t,onTabChange:e,user:n,onLogout:r,isBackendAvailable:a})=>{var _,E,N,I;const[o,c]=C.useState(!1),d=!!((_=n.roles)!=null&&_.shop||n.shopId),p=!!((E=n.roles)!=null&&E.customer||n.customerId),h=!!((N=n.roles)!=null&&N.driver||n.driverId),x=!!((I=n.roles)!=null&&I.supplier||n.supplierId),v=(P,U=!1)=>{let R="px-3 py-2 rounded-md text-sm font-medium transition-colors";return U?`${R} text-gray-500 cursor-not-allowed`:(R+=" cursor-pointer",t===P?`${R} bg-cyan-600 text-white`:`${R} text-gray-300 hover:bg-gray-700 hover:text-white`)},w=!n.isVerified;return f.jsx("header",{className:"bg-gray-800/50 backdrop-blur-sm sticky top-0 z-10",children:f.jsx("div",{className:"container mx-auto px-4 md:px-8",children:f.jsxs("div",{className:"flex items-center justify-between h-20 border-b border-gray-700",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(sh,{className:"w-8 h-8 text-cyan-400"}),f.jsx("h1",{className:"text-2xl font-bold tracking-tight text-white",children:"NexusShop"})]}),f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("nav",{className:"hidden md:flex items-center space-x-2 p-1 bg-gray-900/50 rounded-lg border border-gray-700",children:[f.jsx("a",{onClick:()=>e("dashboard"),className:v("dashboard"),children:"Dashboard"}),d&&f.jsxs(f.Fragment,{children:[f.jsx("a",{onClick:()=>e("inventory"),className:v("inventory"),children:"Inventory"}),f.jsx("a",{onClick:()=>e("catalog"),className:v("catalog"),children:"Products"}),f.jsx("a",{onClick:()=>e("batches"),className:v("batches"),children:"Batches"}),f.jsx("a",{onClick:()=>!w&&e("marketplace"),className:v("marketplace",w),title:w?"Verification Pending":"Marketplace",children:"Marketplace"}),f.jsx("a",{onClick:()=>e("kiosk"),className:v("kiosk"),children:"Kiosk"})]}),p&&f.jsx("a",{onClick:()=>e("customer"),className:v("customer"),children:"Customer"}),x&&f.jsx("a",{onClick:()=>e("supplier"),className:v("supplier"),children:"Supplier"}),a&&f.jsx("a",{onClick:()=>e("backend"),className:v("backend"),children:"Backend"})]}),f.jsxs("div",{className:"relative",children:[f.jsxs("button",{onClick:()=>c(!o),className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-700",children:[f.jsx("div",{className:"w-8 h-8 bg-cyan-800 rounded-full flex items-center justify-center text-cyan-300 font-bold",children:n.companyName.charAt(0)}),f.jsx("span",{className:"hidden lg:inline text-sm font-medium text-white",children:n.companyName})]}),o&&f.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-gray-800 border border-gray-700 rounded-md shadow-lg z-20",children:[f.jsxs("div",{className:"px-4 py-3 border-b border-gray-700",children:[f.jsx("p",{className:"text-sm font-semibold text-white truncate",children:n.companyName}),f.jsx("p",{className:"text-xs text-gray-400 capitalize",children:n.role})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Shop: ",d?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.shopId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.shopId.slice(0,8),"...)"]})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Customer: ",p?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.customerId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.customerId.slice(0,8),"...)"]})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Driver: ",h?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.driverId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.driverId.slice(0,8),"...)"]})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400 border-b border-gray-700",children:["Supplier: ",x?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.supplierId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.supplierId.slice(0,8),"...)"]})]}),f.jsx("a",{onClick:r,className:"block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Logout"})]})]})]}),f.jsx("button",{className:"md:hidden text-gray-300",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]})})})},ZD="modulepreload",e3=function(t){return"/"+t},Sx={},cw=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(x=>Promise.resolve(x).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),p=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));a=c(n.map(h=>{if(h=e3(h),h in Sx)return;Sx[h]=!0;const x=h.endsWith(".css"),v=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${v}`))return;const w=document.createElement("link");if(w.rel=x?"stylesheet":ZD,x||(w.as="script"),w.crossOrigin="",w.href=h,p&&w.setAttribute("nonce",p),document.head.appendChild(w),x)return new Promise((_,E)=>{w.addEventListener("load",_),w.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return a.then(c=>{for(const d of c||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},t3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),f.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),uw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),f.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),f.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),gf=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),f.jsx("polyline",{points:"12 6 12 12 16 14"})]}),n3=({toast:t,onRemove:e})=>{const[n,r]=C.useState(!1);C.useEffect(()=>{setTimeout(()=>r(!0),10);const c=t.duration??5e3,d=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),300)},c);return()=>clearTimeout(d)},[t.id,t.duration,e]);const a=()=>{switch(t.type){case"success":return"bg-green-900/90 border-green-700 text-green-100";case"error":return"bg-red-900/90 border-red-700 text-red-100";case"warning":return"bg-yellow-900/90 border-yellow-700 text-yellow-100";case"info":return"bg-cyan-900/90 border-cyan-700 text-cyan-100";default:return"bg-gray-900/90 border-gray-700 text-gray-100"}},o=()=>{switch(t.type){case"success":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})});case"error":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})});case"warning":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});case"info":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}};return f.jsxs("div",{className:`
        ${a()}
        border rounded-lg shadow-lg p-4 flex items-start space-x-3
        transition-all duration-300 ease-in-out
        ${n?"opacity-100 translate-x-0":"opacity-0 translate-x-full"}
      `,children:[f.jsx("div",{className:"flex-shrink-0 mt-0.5",children:o()}),f.jsx("div",{className:"flex-1 min-w-0",children:f.jsx("p",{className:"text-sm font-medium",children:t.message})}),f.jsx("button",{onClick:()=>{r(!1),setTimeout(()=>e(t.id),300)},className:"flex-shrink-0 text-current opacity-70 hover:opacity-100 transition-opacity","aria-label":"Close",children:f.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})},s3=({toasts:t,onRemove:e})=>f.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-md",children:t.map(n=>f.jsx(n3,{toast:n,onRemove:e},n.id))});let r3=0;const wl=new Set,mr=[],gs=()=>{const[t,e]=C.useState(mr);return C.useEffect(()=>{const a=o=>e([...o]);return wl.add(a),a(mr),()=>{wl.delete(a)}},[]),{toasts:t,showToast:(a,o="info",c)=>{const p={id:`toast-${r3++}`,message:a,type:o,duration:c};mr.push(p),wl.forEach(h=>h([...mr]))},removeToast:a=>{const o=mr.findIndex(c=>c.id===a);o!==-1&&(mr.splice(o,1),wl.forEach(c=>c([...mr])))}}},Un="AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c";class Hn extends Error{constructor(e="Gemini API is currently overloaded. Please try again in a moment."){super(e),this.name="GeminiOverloadError"}}const ec=t=>{if(!t)return!1;const e=String(t.message||t.toString()||"").toLowerCase(),n=t.code||t.status||t.statusCode;return n===429||n===503||n==="RESOURCE_EXHAUSTED"||e.includes("quota")||e.includes("rate limit")||e.includes("overload")||e.includes("resource exhausted")||e.includes("too many requests")||e.includes("service unavailable")||e.includes("backend error")||n>=500&&n<600},cn={productId:{displayName:"Product ID",description:"Canonical product identifier",type:"string"},productName:{displayName:"Product Name",description:"Name of the product",type:"string"},manufacturer:{displayName:"Manufacturer",description:"Manufacturer of the product",type:"string"},category:{displayName:"Category",description:"Product category (e.g., Beverages, Snacks, Produce)",type:"string"},productDescription:{displayName:"Product Description",description:"Detailed description of the product",type:"string"},expirationDate:{displayName:"Exp. Date",description:"Expiration date in YYYY-MM-DD format",type:"string"},quantity:{displayName:"Quantity",description:"Quantity of the product",type:"number"},quantityType:{displayName:"Quantity Type",description:"Unit of measurement (e.g., units, kg, lbs, liters)",type:"string"},costPerUnit:{displayName:"Cost/Unit",description:"Cost per single unit of the product",type:"number"},supplier:{displayName:"Supplier",description:"Supplier or distributor name",type:"string"},deliveryDate:{displayName:"Delivery Date",description:"Delivery date in YYYY-MM-DD format",type:"string"},inventoryDate:{displayName:"Inventory Date",description:"Today's date in YYYY-MM-DD format",type:"string"}},i3={type:Re.OBJECT,properties:{productName:{type:Re.STRING,description:"Name of the product"},manufacturer:{type:Re.STRING,description:"Manufacturer of the product"},category:{type:Re.STRING,description:"A suitable category for the product (e.g., Beverages, Snacks, Dairy, Produce)"},expirationDate:{type:Re.STRING,description:"Expiration date in YYYY-MM-DD format"},quantity:{type:Re.NUMBER,description:"Quantity of the product"},quantityType:{type:Re.STRING,description:"Unit of measurement (e.g., units, kg, lbs, liters)"},costPerUnit:{type:Re.NUMBER,description:"Cost per single unit of the product"},supplier:{type:Re.STRING,description:"Supplier or distributor name, if visible"},deliveryDate:{type:Re.STRING,description:"Delivery date in YYYY-MM-DD format, if visible"}},required:["productName","manufacturer","category","expirationDate","quantity","quantityType","costPerUnit"]},a3={type:Re.OBJECT,properties:{supplierName:{type:Re.STRING,description:"The name of the supplier or vendor."},invoiceNumber:{type:Re.STRING,description:"The invoice or reference number for the delivery."},deliveryDate:{type:Re.STRING,description:"The delivery date in YYYY-MM-DD format."},items:{type:Re.ARRAY,description:"A complete list of all line items from the document.",items:{type:Re.OBJECT,properties:{productName:{type:Re.STRING,description:"The full name of the product as written on the document."},quantity:{type:Re.NUMBER,description:"The quantity of the product delivered."},costPerUnit:{type:Re.NUMBER,description:"The cost for a single unit of the product."}},required:["productName","quantity","costPerUnit"]}}}},Mn=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>{const o=r.result.split(",")[1];e({inlineData:{data:o,mimeType:t.type}})},r.onerror=a=>n(a)}),dw=async t=>{if(t.length===0)throw new Error("No documents provided for analysis.");try{const e=new un({apiKey:Un}),n=await Promise.all(t.map(d=>Mn(d))),o=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[...n,{text:"Analyze these images of shipping documents (e.g., invoice, packing slip). Extract the supplier name, invoice number, delivery date, and a complete list of all line items. For each line item, provide the product name, quantity, and cost per unit. If a value isn't clearly present, omit it. Consolidate information if multiple documents are provided."}]},config:{responseMimeType:"application/json",responseSchema:a3}})).text.trim(),c=JSON.parse(o);if(typeof c!="object"||c===null)throw new Error("Invalid JSON structure received from API");return{supplierName:c.supplierName,invoiceNumber:c.invoiceNumber,deliveryDate:c.deliveryDate,items:c.items||[]}}catch(e){throw console.error("Error analyzing batch documents with Gemini:",e),new Error("Failed to extract batch data from the documents.")}},tc=async t=>{try{const e=new un({apiKey:Un}),n=await Mn(t),a=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[n,{text:"Analyze this image of a product or delivery note. Extract inventory details. If a value isn't present, make a reasonable guess or use 'N/A' for strings and 0 for numbers. For dates, use YYYY-MM-DD format."}]},config:{responseMimeType:"application/json",responseSchema:i3}})).text.trim(),o=JSON.parse(a);if(typeof o!="object"||o===null)throw new Error("Invalid JSON structure received from API");return{productName:o.productName||"N/A",manufacturer:o.manufacturer||"N/A",category:o.category||"General",expirationDate:o.expirationDate||"N/A",quantity:Number(o.quantity)||0,quantityType:o.quantityType||"units",costPerUnit:Number(o.costPerUnit)||0,supplier:o.supplier,deliveryDate:o.deliveryDate}}catch(e){throw console.error("Error analyzing image with Gemini:",e),ec(e)?new Hn("Gemini API is currently overloaded. Please wait a moment and try again."):new Error("Failed to extract inventory data from the image.")}},rh=async(t,e)=>{try{const n=new un({apiKey:Un}),r=await Mn(t),a=cn[e],o=`This image contains the ${a.displayName}. Extract ONLY the value for this field. Do not add any extra text, labels, or explanations. Return just the raw value. For dates, use YYYY-MM-DD format.`,d=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:o}]}})).text.trim();if(a.type==="number"){const p=parseFloat(d.replace(/[^0-9.-]+/g,""));return isNaN(p)?0:p}return d}catch(n){throw console.error(`Error analyzing cropped image for field ${e}:`,n),ec(n)?new Hn("Gemini API is currently overloaded. Please wait a moment and try again."):new Error(`Failed to extract data for ${e}.`)}},fw=async(t,e,n)=>{if(t.length===0&&!le)return"The inventory is currently empty. Please add items to generate a report.";const r=new un({apiKey:Un});try{let a="",o=[];if(le&&n.trim().length>0){const p=await kn(n);if(o=await kf(p,le,20),o.length>0){const h=o.map(x=>{const v=e.find(_=>_.id===x.batchId),w=t.find(_=>_.productId===x.productId&&String(_.batchId)===String(x.batchId));return{inventoryUuid:x.inventoryUuid,productName:(w==null?void 0:w.productName)||"N/A",manufacturer:(w==null?void 0:w.manufacturer)||"N/A",category:(w==null?void 0:w.category)||"General",expirationDate:x.expirationDate,quantity:x.quantity,quantityType:(w==null?void 0:w.quantityType)||"units",costPerUnit:x.costPerUnit,supplier:v==null?void 0:v.supplier,deliveryDate:v==null?void 0:v.deliveryDate,inventoryDate:v==null?void 0:v.inventoryDate,location:x.location,buyPrice:x.buyPrice,sellPrice:x.sellPrice}});a=JSON.stringify(h,null,2),console.log("RAG applied: sending relevant inventory data to Gemini.")}else a=JSON.stringify(t.map(h=>{const x=e.find(v=>v.id===h.batchId);return{...h,supplier:x==null?void 0:x.supplier,deliveryDate:x==null?void 0:x.deliveryDate,inventoryDate:x==null?void 0:x.inventoryDate}}),null,2),console.warn("No relevant items found via RAG for the given prompt, falling back to full inventory context.")}else a=JSON.stringify(t.map(p=>{const h=e.find(x=>x.id===p.batchId);return{...p,supplier:h==null?void 0:h.supplier,deliveryDate:h==null?void 0:h.deliveryDate,inventoryDate:h==null?void 0:h.inventoryDate}}),null,2),console.log("RAG skipped: using full inventory context for analysis.");const c=`
      Based on the following inventory data, please provide an analysis for the request: "${n}".
      
      Inventory Data:
      ${a}
      
      Please format your response in clear, easy-to-read markdown.
    `;return(await r.models.generateContent({model:"gemini-2.5-pro",contents:c,config:{thinkingConfig:{thinkingBudget:32768}}})).text}catch(a){throw console.error("Error generating inventory report with Gemini Pro:",a),new Error("Failed to generate the inventory report.")}},ih=async(t,e)=>{if(e.length===0)return null;try{const n=new un({apiKey:Un}),r=await Mn(t),a=`
      Analyze this image. Identify the main product visible.
      From the following list of known products, which one is it?
      Product list: [${e.join(", ")}]
      Respond with ONLY the name of the product from the list that matches best.
      If no product from the list is clearly identifiable, respond with the exact text "NO_PRODUCT".
    `,c=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:a}]}})).text.trim();return c==="NO_PRODUCT"||!e.includes(c)?null:c}catch(n){if(console.error("Error identifying product:",n),ec(n))throw new Hn("Gemini API is currently overloaded. Please wait a moment and try again.");return null}},hw=t=>{const e=t.split(","),n=e[0].match(/:(.*?);/);if(!n)throw new Error("Invalid data URL");const r=n[1],a=atob(e[1]);let o=a.length;const c=new Uint8Array(o);for(;o--;)c[o]=a.charCodeAt(o);return new Blob([c],{type:r})},pw=async(t,e,n)=>{try{const r=new un({apiKey:Un}),a=await Mn(t),o=await Mn(e),c=cn[n],d=`The first image is a close-up of a '${c.displayName}'. The second image is a wider view of a product. Find the exact feature from the first image within the second image and extract ONLY its value. Do not add any extra text, labels, or explanations. Return just the raw value. If you cannot find the feature, return the text "NOT_FOUND". For dates, use YYYY-MM-DD format.`,h=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[o,a,{text:d}]}})).text.trim();if(h==="NOT_FOUND")return null;if(c.type==="number"){const x=parseFloat(h.replace(/[^0-9.-]+/g,""));return isNaN(x)?null:x}return h}catch(r){if(console.error(`Error finding feature for field ${n}:`,r),ec(r))throw new Hn("Gemini API is currently overloaded. Please wait a moment and try again.");return null}},o3={type:Re.OBJECT,properties:{estimatedQuantity:{type:Re.NUMBER,description:"Estimated total quantity including hidden units"},confidence:{type:Re.NUMBER,description:"Confidence score from 0 to 1"},reasoning:{type:Re.STRING,description:"Explanation of the estimation"},visualAnalysis:{type:Re.STRING,description:"Detailed visual observations"},shelfFullness:{type:Re.NUMBER,description:"Shelf fullness percentage (0-100)"},visibleUnits:{type:Re.NUMBER,description:"Number of units clearly visible"},hiddenUnits:{type:Re.NUMBER,description:"Estimated units hidden behind others"}},required:["estimatedQuantity","confidence","reasoning","visualAnalysis","shelfFullness","visibleUnits"]},mw=async(t,e,n)=>{try{const r=new un({apiKey:Un}),a=await Mn(t),o=n?`Expected shelf capacity: ${n} units.`:"No expected capacity provided.",c=`Analyze this shelf photo for ${e}.
        
        Tasks:
        1. Count visible units of the product
        2. Estimate if there are units hidden behind others
        3. Assess shelf fullness (0-100%)
        4. Identify any damage or quality issues
        5. Check expiration dates if visible
        
        ${o}
        
        Provide detailed analysis with confidence score.`,d=await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[a,{text:c}]},config:{responseMimeType:"application/json",responseSchema:o3}}),p=JSON.parse(d.text.trim());return{estimatedQuantity:p.estimatedQuantity||0,confidence:Math.max(0,Math.min(1,p.confidence||.5)),reasoning:p.reasoning||"",visualAnalysis:p.visualAnalysis||"",shelfFullness:Math.max(0,Math.min(100,p.shelfFullness||0)),visibleUnits:p.visibleUnits||0,hiddenUnits:p.hiddenUnits}}catch(r){throw console.error("Error estimating stock from shelf photo:",r),new Error("Failed to estimate stock from shelf photo.")}},l3={type:Re.OBJECT,properties:{qualityScore:{type:Re.NUMBER,description:"Overall quality score from 0 to 100"},issues:{type:Re.ARRAY,items:{type:Re.STRING},description:"List of quality issues found"},recommendations:{type:Re.ARRAY,items:{type:Re.STRING},description:"Recommendations for action"},expirationVisible:{type:Re.BOOLEAN,description:"Whether expiration date is visible"},expirationDate:{type:Re.STRING,description:"Detected expiration date in YYYY-MM-DD format if visible"},damageDetected:{type:Re.BOOLEAN,description:"Whether any damage was detected"},damageDescription:{type:Re.STRING,description:"Description of damage if found"},packagingIntegrity:{type:Re.STRING,description:"Packaging condition: good, fair, or poor"}},required:["qualityScore","issues","recommendations","expirationVisible","damageDetected","packagingIntegrity"]},gw=async(t,e,n)=>{try{const r=new un({apiKey:Un}),a=await Mn(t),o=n?`Expected expiration: ${n}. Compare detected date with expected.`:"",c=`Analyze this image of ${e} for quality assessment.
        
        Check for:
        - Physical damage (dents, tears, broken seals)
        - Expiration date visibility and validity
        - Packaging integrity
        - Signs of spoilage (for perishables)
        - Overall condition
        
        ${o}
        
        Provide detailed quality assessment with actionable recommendations.`,d=await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[a,{text:c}]},config:{responseMimeType:"application/json",responseSchema:l3}}),p=JSON.parse(d.text.trim());return{qualityScore:Math.max(0,Math.min(100,p.qualityScore||50)),issues:p.issues||[],recommendations:p.recommendations||[],expirationVisible:p.expirationVisible||!1,expirationDate:p.expirationDate,damageDetected:p.damageDetected||!1,damageDescription:p.damageDescription,packagingIntegrity:p.packagingIntegrity||"fair"}}catch(r){throw console.error("Error assessing product quality:",r),new Error("Failed to assess product quality.")}},ah=async(t,e)=>{try{const n=new un({apiKey:Un}),r=await Mn(t),c=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:`Describe this product in detail. Include:
        - Product name/brand
        - Category
        - Key visual features
        - Packaging type
        - Any text visible on packaging
        
        Return a concise product description suitable for search.`}]}})).text.trim(),d=await z2(c,t,.5,.5);return await kf(d,e,10)}catch(n){return console.error("Error searching inventory by image:",n),[]}},yw=async t=>{try{const e=new un({apiKey:Un});return await Promise.all(t.map(async({image:r,expectedExpiration:a,productName:o})=>{try{const c=await Mn(r),d=`Find and read the expiration date on this ${o}.
                    
                    Expected expiration: ${a}
                    
                    Return ONLY the expiration date in YYYY-MM-DD format if visible, or "NOT_VISIBLE" if not found.
                    Also indicate your confidence (0-1) in the detection.`,h=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[c,{text:d}]}})).text.trim();if(h.includes("NOT_VISIBLE")||h.includes("not visible"))return{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Expiration date not visible in image"};const v=h.match(/\d{4}-\d{2}-\d{2}/),w=v?v[0]:null;if(!w)return{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Could not parse date from image"};const _=w===a||w.split("-")[0]===a.split("-")[0];return{productName:o,expectedExpiration:a,detectedExpiration:w,match:_,discrepancy:_?void 0:`Expected ${a}, found ${w}`,confidence:_?.9:.7}}catch(c){return console.error(`Error verifying expiration for ${o}:`,c),{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Error processing image"}}}))}catch(e){throw console.error("Error verifying expiration dates:",e),new Error("Failed to verify expiration dates.")}},xw=async(t,e,n)=>{try{if(t.length===0)throw new Error("No shelf images provided.");const r=new un({apiKey:Un}),a=await Promise.all(t.map(Mn)),c=`Analyze these shelf photos combined with inventory data.
        
        Inventory Data:
        ${JSON.stringify({inventory:e.slice(0,50).map(x=>({productId:x.productId,quantity:x.quantity,expirationDate:x.expirationDate})),recentSales:n.slice(-20).map(x=>({timestamp:x.timestamp,items:x.items,totalAmount:x.totalAmount}))},null,2)}
        
        Tasks:
        1. Compare visual stock levels with recorded inventory
        2. Identify discrepancies (visual vs recorded)
        3. Find products that look expired/damaged
        4. Suggest reordering based on visual stock levels
        5. Identify layout optimization opportunities
        6. Flag high-risk items (expiring soon, low stock, damaged)
        
        Provide actionable insights combining visual and data analysis.
        Format as structured recommendations with severity levels.`;return{insights:(await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[...a,{text:c}]},config:{thinkingConfig:{thinkingBudget:32768}}})).text.split(`
`).filter(x=>x.trim().length>0&&(x.includes("insight")||x.includes("finding")||x.match(/^\d+\./))).slice(0,10),visualFindings:[],recommendations:[],riskItems:[],dataDiscrepancies:[]}}catch(r){throw console.error("Error generating visual insights:",r),new Error("Failed to generate visual inventory insights.")}},c3=Object.freeze(Object.defineProperty({__proto__:null,GeminiOverloadError:Hn,analyzeBatchDocuments:dw,analyzeCroppedImageForField:rh,analyzeImageForInventory:tc,assessProductQuality:gw,dataUrlToBlob:hw,estimateStockFromShelfPhoto:mw,fieldMetadata:cn,findAndReadFeature:pw,generateInventoryReport:fw,generateVisualInventoryInsights:xw,identifyProductNameFromImage:ih,searchInventoryByImage:ah,verifyExpirationDates:yw},Symbol.toStringTag,{value:"Module"})),vw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v1a2.5 2.5 0 0 1-2.5 2.5h-1A2.5 2.5 0 0 1 6 5.5v-1A2.5 2.5 0 0 1 8.5 2h1Z"}),f.jsx("path",{d:"M14.5 2A2.5 2.5 0 0 1 17 4.5v1a2.5 2.5 0 0 1-2.5 2.5h-1a2.5 2.5 0 0 1-2.5-2.5v-1A2.5 2.5 0 0 1 12.5 2h2Z"}),f.jsx("path",{d:"M18 12a4.5 4.5 0 0 1-4.5 4.5h-3A4.5 4.5 0 0 1 6 12v-2a4.5 4.5 0 0 1 4.5-4.5h3A4.5 4.5 0 0 1 18 10v2Z"}),f.jsx("path",{d:"M6 12a2.5 2.5 0 0 0-2.5 2.5v1A2.5 2.5 0 0 0 6 18h1a2.5 2.5 0 0 0 2.5-2.5v-1A2.5 2.5 0 0 0 7 12h-1Z"}),f.jsx("path",{d:"M18 12a2.5 2.5 0 0 1 2.5 2.5v1a2.5 2.5 0 0 1-2.5 2.5h-1a2.5 2.5 0 0 1-2.5-2.5v-1a2.5 2.5 0 0 1 2.5-2.5h1Z"}),f.jsx("path",{d:"M12 11v1"}),f.jsx("path",{d:"M12 18v2"})]}),Ga=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),f.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),bw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),f.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),ww=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M12 5a3 3 0 1 0-5.993.142"}),f.jsx("path",{d:"M12 5a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M15 13a3 3 0 1 0-5.993.142"}),f.jsx("path",{d:"M15 13a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M9 13a3 3 0 1 0-5.993.142"}),f.jsx("path",{d:"M9 13a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M12 21a3 3 0 1 0-5.993-.142"}),f.jsx("path",{d:"M12 21a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M12 13h.01"}),f.jsx("path",{d:"M12 5h.01"}),f.jsx("path",{d:"M12 21h.01"}),f.jsx("path",{d:"M18 13h.01"}),f.jsx("path",{d:"M6 13h.01"}),f.jsx("path",{d:"M18 5h.01"}),f.jsx("path",{d:"M6 5h.01"}),f.jsx("path",{d:"m18 5-3 4"}),f.jsx("path",{d:"m6 5 3 4"}),f.jsx("path",{d:"m18 13-3-4"}),f.jsx("path",{d:"m6 13 3-4"}),f.jsx("path",{d:"m15 21-3-4"}),f.jsx("path",{d:"m9 21 3-4"})]}),Ha=({onDataScanned:t,onClose:e,productOptions:n,mode:r="scan"})=>{const a=C.useRef(null),o=C.useRef(null),c=C.useRef(null),d=C.useRef(null),[p,h]=C.useState(null),[x,v]=C.useState(!1),[w,_]=C.useState({}),[E,N]=C.useState(new Map),[I,P]=C.useState(new Map),[U,R]=C.useState("auto-scanning"),[A,k]=C.useState(null),[q,V]=C.useState(null),[W,J]=C.useState(null),[$,ce]=C.useState(new Set),[ue,Ce]=C.useState(new Map),[_e,Ve]=C.useState(null),[M,G]=C.useState(new Set),Z=C.useMemo(()=>{const ye=new Map;return n.forEach(Ee=>{ye.has(Ee.productName)||ye.set(Ee.productName,Ee)}),ye},[n]),oe=C.useMemo(()=>Array.from(Z.keys()),[Z]),se=C.useRef(w),D=C.useRef(I);C.useEffect(()=>{se.current=w},[w]),C.useEffect(()=>{D.current=I},[I]);const L=C.useCallback((ye,Ee,ze,Ke)=>{if(Ee==null||typeof Ee=="string"&&Ee.trim()==="")return;const st=D.current.get(ye)??0;se.current[ye]!==void 0&&se.current[ye]!==null&&String(se.current[ye]).length>0&&st>=Ke||(_(it=>({...it,[ye]:Ee})),N(it=>{const wt=new Map(it);return wt.set(ye,ze),wt}),P(it=>{const wt=new Map(it);return wt.set(ye,Ke),wt}))},[]),Q=C.useCallback(()=>{d.current&&(clearInterval(d.current),d.current=null)},[]),re=C.useCallback(()=>{if(a.current&&c.current){const ye=a.current,Ee=c.current,ze=ye.getBoundingClientRect();Ee.width=ze.width,Ee.height=ze.height}},[]);C.useEffect(()=>{let ye=null;return(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){h("Camera not supported on this browser. Please use a modern browser on a secure (HTTPS) connection.");return}try{ye=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),a.current&&(a.current.srcObject=ye,a.current.onloadedmetadata=()=>re())}catch(ze){console.error("Error accessing camera:",ze),h("Could not access the camera. Please ensure permissions are granted and you are on a secure (HTTPS) site.")}})(),window.addEventListener("resize",re),()=>{window.removeEventListener("resize",re),Q(),ye&&ye.getTracks().forEach(ze=>ze.stop())}},[re,Q]);const de=C.useCallback(async()=>{if(!a.current||!o.current||document.hidden||U!=="auto-scanning")return;const ye=a.current,Ee=o.current;Ee.width=ye.videoWidth,Ee.height=ye.videoHeight;const ze=Ee.getContext("2d");if(!ze)return;ze.drawImage(ye,0,0,ye.videoWidth,ye.videoHeight);const Ke=await new Promise(Ue=>Ee.toBlob(Ue,"image/jpeg",.8));if(!Ke||U!=="auto-scanning")return;let st=null;try{const Ue=await ih(Ke,oe);st=Ue&&Z.get(Ue)||null,(st==null?void 0:st.productId)!==(_e==null?void 0:_e.productId)&&Ve(st),x&&(v(!1),h(null))}catch(Ue){if(Ue instanceof Hn){v(!0),h(Ue.message),Q();return}console.warn("Product identification failed:",Ue)}if(st)try{const Ue=await Dv(st.productId);Ue.size>0&&await Promise.all(Array.from(Ue.entries()).map(async([it,wt])=>{const At=it;if($.has(At)||M.has(At)||(D.current.get(At)??0)>=.85)return;const On=hw(`data:${wt.mimeType};base64,${wt.imageBase64}`);try{const Qt=await pw(Ke,On,At);Qt!==null&&(L(At,Qt,"learned",.85),G(ae=>new Set(ae).add(At)))}catch(Qt){if(Qt instanceof Hn)throw Qt}})),x&&(v(!1),h(null))}catch(Ue){if(Ue instanceof Hn){v(!0),h(Ue.message),Q();return}console.warn("Learned field scan failed:",Ue)}try{const Ue=await tc(Ke);for(const it in Ue){const wt=it;$.has(wt)||L(wt,Ue[wt],"auto",.6)}x&&(v(!1),h(null))}catch(Ue){if(Ue instanceof Hn){v(!0),h(Ue.message),Q();return}console.warn("Generic auto-scan analysis failed:",Ue)}},[_e,$,U,Z,oe,L,M,x,Q]);C.useEffect(()=>{U==="auto-scanning"&&!d.current?d.current=window.setInterval(de,4e3):U!=="auto-scanning"&&Q()},[U,de,Q]),C.useEffect(()=>{const ye=c.current,Ee=ye==null?void 0:ye.getContext("2d");Ee&&ye&&(Ee.clearRect(0,0,ye.width,ye.height),q&&(Ee.fillStyle="#06b6d4",Ee.beginPath(),Ee.arc(q.x,q.y,10,0,2*Math.PI),Ee.fill(),Ee.strokeStyle="white",Ee.lineWidth=2,Ee.stroke()),W&&(Ee.strokeStyle="#06b6d4",Ee.lineWidth=3,Ee.strokeRect(W.x,W.y,W.width,W.height)))},[q,W]);const ge=ye=>{k(ye),R("manual-capture"),V(null),J(null)},te=ye=>{var Ee;if(U==="auto-scanning"){R("selecting-field");return}if(U==="manual-capture"&&A){const ze=(Ee=c.current)==null?void 0:Ee.getBoundingClientRect();if(!ze)return;const Ke=ye.clientX-ze.left,st=ye.clientY-ze.top;if(!q)V({x:Ke,y:st});else{const Ue={x:Math.min(q.x,Ke),y:Math.min(q.y,st),width:Math.abs(Ke-q.x),height:Math.abs(st-q.y)};Ue.width>10&&Ue.height>10?(J(Ue),K(Ue)):V(null)}}},K=C.useCallback(async ye=>{if(!a.current||!o.current||!A)return;R("analyzing"),V(null);const Ee=a.current,ze=o.current,Ke=Ee.getBoundingClientRect(),st=Ee.videoWidth/Ke.width,Ue=Ee.videoHeight/Ke.height,it=ye.x*st,wt=ye.y*Ue,At=ye.width*st,jn=ye.height*Ue;ze.width=At,ze.height=jn;const On=ze.getContext("2d");On&&(On.drawImage(Ee,it,wt,At,jn,0,0,At,jn),ze.toBlob(async Qt=>{if(Qt)try{Ce(ie=>new Map(ie).set(A,Qt));const ae=await rh(Qt,A);L(A,ae,"manual",1),ce(ie=>new Set(ie).add(A)),G(ie=>{const Ne=new Set(ie);return Ne.delete(A),Ne})}catch(ae){ae instanceof Hn?(v(!0),h(ae.message)):(console.error(ae),h(ae instanceof Error?ae.message:"Analysis failed"))}k(null),J(null),R("auto-scanning")},"image/jpeg",.9))},[A,L]),he=async()=>{if(r==="visual-search"){if(!a.current||!o.current){h("Camera not ready");return}const ye=a.current,Ee=o.current;Ee.width=ye.videoWidth,Ee.height=ye.videoHeight;const ze=Ee.getContext("2d");if(!ze){h("Failed to get canvas context");return}ze.drawImage(ye,0,0,ye.videoWidth,ye.videoHeight);const Ke=await new Promise(st=>Ee.toBlob(st,"image/jpeg",.85));Ke?(t({data:{},blobs:new Map([["productName",Ke]]),fieldSources:new Map,fieldConfidences:new Map}),e()):h("Failed to capture image");return}t({data:{...w},blobs:new Map(ue),identifiedProductId:_e==null?void 0:_e.productId,fieldSources:new Map(E),fieldConfidences:new Map(I)}),e()},ke=()=>{switch(U){case"auto-scanning":return _e?`Identified: ${_e.productName}. Using learned fields to scan.`:"Scanning automatically... Tap screen to select a field manually.";case"selecting-field":return"Select a field to capture manually.";case"manual-capture":return A?q?"Tap the opposite corner.":`Tap the first corner for ${cn[A].displayName}.`:"Select a field.";case"analyzing":return`Analyzing ${cn[A].displayName}...`;default:return"Ready to scan."}};return f.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center","aria-modal":"true",children:[f.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),f.jsx("canvas",{ref:o,className:"hidden"}),f.jsx("canvas",{ref:c,className:"absolute inset-0 w-full h-full object-cover z-10 cursor-pointer",onClick:te}),U==="selecting-field"&&f.jsxs("div",{className:"absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20 p-4",children:[f.jsx("h3",{className:"text-xl font-bold mb-6 text-white",children:"Select a field to capture"}),f.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 w-full max-w-2xl",children:Object.keys(cn).map(ye=>f.jsx("button",{onClick:()=>ge(ye),className:"p-3 bg-gray-700 text-white rounded-lg hover:bg-cyan-600 transition-colors text-sm",children:cn[ye].displayName},ye))}),f.jsx("button",{onClick:()=>R("auto-scanning"),className:"mt-8 bg-gray-600 px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors",children:"Cancel & Resume Auto-Scan"})]}),x&&f.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-yellow-600/95 text-white p-4 rounded-lg text-center z-30 max-w-md mx-auto shadow-2xl border-2 border-yellow-400",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[f.jsx("svg",{className:"w-6 h-6 animate-pulse",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),f.jsx("h3",{className:"text-lg font-bold",children:"Gemini API Overloaded"})]}),f.jsx("p",{className:"text-sm mb-3",children:p||"Gemini API is currently overloaded. Please wait a moment and try again."}),f.jsx("button",{onClick:()=>{v(!1),h(null),U==="auto-scanning"&&!d.current&&(d.current=window.setInterval(de,4e3))},className:"px-4 py-2 bg-yellow-700 hover:bg-yellow-800 rounded-md text-sm font-semibold transition-colors",children:"Retry Now"})]}),p&&!x&&f.jsx("div",{className:"absolute top-4 bg-red-800/80 text-white p-3 rounded-lg text-center z-30 max-w-md mx-auto",children:p}),f.jsx("div",{className:"absolute top-4 bg-black/50 text-white px-4 py-2 rounded-full z-20 text-center",children:f.jsx("p",{children:ke()})}),U==="analyzing"&&f.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"})}),f.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-30","aria-label":"Close scanner",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),f.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 backdrop-blur-sm p-4 text-white rounded-t-lg shadow-2xl shadow-black z-20",children:[r==="visual-search"?f.jsxs(f.Fragment,{children:[f.jsx("h3",{className:"text-lg font-bold text-cyan-400 mb-2",children:"Visual Search"}),f.jsx("p",{className:"text-sm text-gray-300 mb-4",children:`Position the product in view and click "Capture & Search" to check if it's in inventory.`})]}):f.jsxs(f.Fragment,{children:[f.jsx("h3",{className:"text-lg font-bold text-cyan-400 mb-2",children:"Scanned Data"}),f.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 text-sm max-h-32 overflow-y-auto",children:Object.keys(w).length>0?Object.entries(w).map(([ye,Ee])=>{const ze=ye,Ke=E.get(ze);return f.jsxs("div",{className:"truncate flex items-center",children:[f.jsxs("span",{className:"font-semibold capitalize text-gray-400",children:[cn[ze].displayName,": "]}),f.jsx("span",{className:"text-gray-100 ml-1",children:String(Ee)}),Ke==="manual"&&f.jsx(bw,{className:"w-3 h-3 ml-2 text-cyan-400 flex-shrink-0"}),Ke==="learned"&&f.jsx(ww,{className:"w-4 h-4 ml-2 text-indigo-400 flex-shrink-0"})]},ye)}):f.jsx("p",{className:"col-span-full text-gray-500 text-center py-4",children:"Data will appear here as it's scanned..."})})]}),f.jsx("button",{onClick:he,disabled:r==="scan"&&Object.keys(w).length===0||U==="analyzing",className:"mt-4 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:r==="visual-search"?"Capture & Search":"Confirm & Use This Data"})]})]})},u3=({inventoryData:t,salesHistory:e,productCatalog:n})=>{const[r,a]=C.useState("insights"),[o,c]=C.useState(!1),[d,p]=C.useState(null),[h,x]=C.useState([]),[v,w]=C.useState(null),[_,E]=C.useState(!1),{showToast:N}=gs(),I=C.useCallback(R=>{x([R]),E(!1),p(null),N('Image captured! Click "Analyze Images" to process.',"success")},[N]),P=async()=>{if(h.length===0){p("Please capture at least one image.");return}c(!0),p(null),w(null);try{switch(r){case"insights":const R=await xw(h,t,e);w(R),N("Visual insights generated successfully!","success");break;case"stock-estimation":const A=prompt("Enter product name for stock estimation:")||"Unknown Product",k=prompt("Enter expected shelf capacity (optional):"),q=await mw(h[0],A,k?parseInt(k):void 0);w(q),N("Stock estimation completed!","success");break;case"quality-assessment":const V=prompt("Enter product name:")||"Unknown Product",W=prompt("Enter expected expiration date (YYYY-MM-DD, optional):"),J=await gw(h[0],V,W||void 0);w(J),N("Quality assessment completed!","success");break;case"visual-search":{const ue=Xf();if(!ue){p("No active shop context. Please ensure you are logged in."),c(!1);return}const Ce=await ah(h[0],ue);w({items:Ce,count:Ce.length}),N(`Found ${Ce.length} matching items!`,"success")}break;case"expiration-verify":const $=await Promise.all(h.map(async(ue,Ce)=>{const _e=prompt(`Enter product name for image ${Ce+1}:`)||"Unknown Product",Ve=prompt(`Enter expected expiration (YYYY-MM-DD) for image ${Ce+1}:`)||"";return{image:ue,productName:_e,expectedExpiration:Ve}})),ce=await yw($);w({verifications:ce}),N("Expiration verification completed!","success");break}}catch(R){const A=R instanceof Error?R.message:"An unknown error occurred.";p(A),N(`Error: ${A}`,"error")}finally{c(!1)}},U=()=>{if(!v)return null;switch(r){case"insights":const R=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Visual Insights"}),R.insights.length>0&&f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Key Insights"}),f.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:R.insights.map((J,$)=>f.jsx("li",{children:J},$))})]}),R.riskItems.length>0&&f.jsxs("div",{className:"bg-red-900/20 p-4 rounded-lg border border-red-700",children:[f.jsx("h4",{className:"text-red-400 font-medium mb-2",children:"Risk Items"}),f.jsx("ul",{className:"space-y-2",children:R.riskItems.map((J,$)=>f.jsxs("li",{className:"text-sm text-gray-300",children:[f.jsx("span",{className:"font-semibold",children:J.product}),": ",J.issue,f.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${J.severity==="high"?"bg-red-600":J.severity==="medium"?"bg-yellow-600":"bg-gray-600"}`,children:J.severity})]},$))})]})]});case"stock-estimation":const A=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Stock Estimation Results"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Estimated Quantity"}),f.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:A.estimatedQuantity})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Confidence"}),f.jsxs("p",{className:"text-2xl font-bold text-cyan-400",children:[(A.confidence*100).toFixed(0),"%"]})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Visible Units"}),f.jsx("p",{className:"text-2xl font-bold text-white",children:A.visibleUnits})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Shelf Fullness"}),f.jsxs("p",{className:"text-2xl font-bold text-white",children:[A.shelfFullness,"%"]})]})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Reasoning"}),f.jsx("p",{className:"text-gray-300 text-sm",children:A.reasoning})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Visual Analysis"}),f.jsx("p",{className:"text-gray-300 text-sm",children:A.visualAnalysis})]})]});case"quality-assessment":const k=v,q=k.qualityScore>=80?"text-green-400":k.qualityScore>=60?"text-yellow-400":"text-red-400";return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Quality Assessment"}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Quality Score"}),f.jsxs("p",{className:`text-4xl font-bold ${q}`,children:[k.qualityScore,"/100"]})]}),k.issues.length>0&&f.jsxs("div",{className:"bg-red-900/20 p-4 rounded-lg border border-red-700",children:[f.jsx("h4",{className:"text-red-400 font-medium mb-2",children:"Issues Found"}),f.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:k.issues.map((J,$)=>f.jsx("li",{children:J},$))})]}),k.recommendations.length>0&&f.jsxs("div",{className:"bg-cyan-900/20 p-4 rounded-lg border border-cyan-700",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Recommendations"}),f.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:k.recommendations.map((J,$)=>f.jsx("li",{children:J},$))})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Packaging"}),f.jsx("p",{className:"text-lg font-semibold text-white capitalize",children:k.packagingIntegrity})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Damage Detected"}),f.jsx("p",{className:`text-lg font-semibold ${k.damageDetected?"text-red-400":"text-green-400"}`,children:k.damageDetected?"Yes":"No"})]})]}),k.expirationDate&&f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Detected Expiration"}),f.jsx("p",{className:"text-lg font-semibold text-white",children:k.expirationDate})]})]});case"visual-search":const V=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Search Results (",V.count," items found)"]}),V.items.length>0?f.jsx("div",{className:"space-y-2",children:V.items.map((J,$)=>f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsxs("p",{className:"font-semibold text-white",children:["Product ID: ",J.productId]}),f.jsxs("p",{className:"text-sm text-gray-400",children:["Quantity: ",J.quantity," | Expiration: ",J.expirationDate]})]},$))}):f.jsx("p",{className:"text-gray-400",children:"No matching items found in inventory."})]});case"expiration-verify":const W=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Expiration Verification Results"}),f.jsx("div",{className:"space-y-3",children:W.verifications.map((J,$)=>f.jsxs("div",{className:`p-4 rounded-lg border ${J.match?"bg-green-900/20 border-green-700":"bg-red-900/20 border-red-700"}`,children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsx("p",{className:"font-semibold text-white",children:J.productName}),f.jsx("span",{className:`px-2 py-1 rounded text-xs ${J.match?"bg-green-600":"bg-red-600"}`,children:J.match?"Match":"Mismatch"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Expected"}),f.jsx("p",{className:"text-white",children:J.expectedExpiration})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Detected"}),f.jsx("p",{className:"text-white",children:J.detectedExpiration||"Not visible"})]})]}),J.discrepancy&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:J.discrepancy})]},$))})]});default:return null}};return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("h2",{className:"text-xl font-semibold mb-4 text-white flex items-center",children:[f.jsx(vw,{className:"w-6 h-6 mr-2 text-cyan-400"}),"Multi-Modal AI Visual Analysis"]}),f.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use AI-powered visual analysis to gain insights from shelf photos, assess product quality, estimate stock levels, and more."}),f.jsx("div",{className:"mb-4 flex flex-wrap gap-2",children:["insights","stock-estimation","quality-assessment","visual-search","expiration-verify"].map(R=>f.jsx("button",{onClick:()=>{a(R),w(null),x([]),p(null),E(!1)},className:`px-3 py-2 rounded-md text-sm font-medium transition ${r===R?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:R.split("-").map(A=>A.charAt(0).toUpperCase()+A.slice(1)).join(" ")},R))}),f.jsxs("div",{className:"mb-4",children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Capture Image ",r==="insights"||r==="expiration-verify"?"(Can capture multiple)":"(Single capture)"]}),f.jsxs("button",{onClick:()=>E(!0),disabled:_||o,className:"w-full flex items-center justify-center gap-2 py-3 px-4 border border-gray-600 rounded-md text-sm font-medium text-gray-200 bg-gray-700/50 hover:bg-gray-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[f.jsx(Ga,{className:"w-5 h-5"}),h.length>0?`Re-capture Image (${h.length} captured)`:"Capture Image with Camera"]}),h.length>0&&f.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[h.length,' image(s) ready for analysis. Click "Analyze Images" to process.']})]}),_&&f.jsx(Ha,{mode:"visual-search",productOptions:[],onDataScanned:R=>{if(R.blobs&&R.blobs.size>0){const A=R.blobs.get("productName")||Array.from(R.blobs.values())[0];A?I(A):(N("Failed to capture image. Please try again.","error"),E(!1))}else N("Failed to capture image. Please try again.","error"),E(!1)},onClose:()=>E(!1)}),f.jsx("button",{onClick:P,disabled:o||h.length===0,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:o?"Analyzing...":"Analyze Images"}),d&&f.jsx("div",{className:"mt-4 p-3 bg-red-900/50 border border-red-700 rounded-lg",children:f.jsx("p",{className:"text-red-400 text-sm",children:d})}),o&&f.jsxs("div",{className:"flex items-center justify-center my-4 p-4 bg-gray-900/50 rounded-lg",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"}),f.jsx("p",{className:"ml-3 text-cyan-400",children:"AI is analyzing your images..."})]}),U()]})},d3=({summaries:t,onNavigateToInventory:e,onRefreshData:n})=>{const[r,a]=C.useState(!1),[o,c]=C.useState([]),[d,p]=C.useState([]),{showToast:h}=gs();C.useEffect(()=>{(async()=>{try{const _=await Zf();c(_);try{const{getActiveShopId:E}=await cw(async()=>{const{getActiveShopId:I}=await Promise.resolve().then(()=>bD);return{getActiveShopId:I}},void 0),N=E();if(N){const I=await Cv(N);p(I)}}catch(E){console.warn("Could not load sales history:",E)}}catch(_){console.error("Error loading inventory data:",_)}})()},[t]);const x=async()=>{var w,_,E,N,I,P,U,R,A;if(confirm("This will create sample products, suppliers, batches, and inventory items. Continue?")){a(!0);try{const k=[{name:"Organic Milk - Whole",manufacturer:"Fresh Dairy Co.",category:"Dairy",description:"Fresh organic whole milk, 1 gallon",imageUrl:"https://images.unsplash.com/photo-1563636619-e9143da7973b?w=200"},{name:"Whole Wheat Bread",manufacturer:"Baker's Delight",category:"Bakery",description:"Fresh baked whole wheat bread, 1 loaf",imageUrl:"https://images.unsplash.com/photo-1509440159596-0249088772ff?w=200"},{name:"Bananas - Organic",manufacturer:"Tropical Farms",category:"Produce",description:"Organic bananas, 1 bunch (~2 lbs)",imageUrl:"https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=200"},{name:"Chicken Breast - Free Range",manufacturer:"Farm Fresh Poultry",category:"Meat",description:"Free range chicken breast, 1 lb",imageUrl:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=200"},{name:"Organic Eggs - Large",manufacturer:"Happy Hens Farm",category:"Dairy",description:"Organic large eggs, 12 count",imageUrl:"https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?w=200"},{name:"Tomatoes - Roma",manufacturer:"Garden Fresh",category:"Produce",description:"Fresh Roma tomatoes, 1 lb",imageUrl:"https://images.unsplash.com/photo-1546470427-e26264be0b01?w=200"}],q=[{name:"Fresh Dairy Co.",contactEmail:"orders@fresherdairy.com"},{name:"Baker's Delight",contactEmail:"supply@bakersdelight.com"},{name:"Tropical Farms",contactEmail:"sales@tropicalfarms.com"},{name:"Farm Fresh Poultry",contactEmail:"info@farmfreshpoultry.com"},{name:"Happy Hens Farm",contactEmail:"orders@happyhens.com"},{name:"Garden Fresh",contactEmail:"wholesale@gardenfresh.com"},{name:"Organic Foods Dist.",contactEmail:"sales@organicfoods.com"},{name:"Premium Meats Co.",contactEmail:"orders@premiummeats.com"}],V=[];for(const D of q)try{const L=await Mi(D);V.push(L)}catch(L){console.warn("Failed to create supplier:",L)}const W=[];for(let D=0;D<k.length;D++){const L=k[D],Q=V.find(re=>re.name.toLowerCase().includes(L.manufacturer.toLowerCase().split(" ")[0]))||V[D]||V[0];try{const re=L.imageUrl?[{url:L.imageUrl,type:"manual",source:"user",addedAt:new Date().toISOString()}]:[],de=await Di({...L,defaultSupplierId:Q==null?void 0:Q.id,images:re});W.push(de)}catch(re){console.warn("Failed to create product:",re)}}const J=new Date,$=new Date(J);$.setDate($.getDate()-7);const ce=new Date(J);ce.setDate(ce.getDate()-5);const ue=W.slice(0,3).map(D=>({productId:D.id,productName:D.name,quantity:Math.floor(Math.random()*80)+20,cost:Math.random()*8+2})),Ce=await ka({supplierId:(w=V[0])==null?void 0:w.id,deliveryDate:$.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-1`,documents:[],lineItems:ue}),_e=W.slice(0,2).map(D=>({productId:D.id,productName:D.name,quantity:Math.floor(Math.random()*60)+15,cost:Math.random()*10+3})),Ve=await ka({supplierId:(_=V[1])==null?void 0:_.id,deliveryDate:ce.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-2`,documents:[],lineItems:_e}),M=W.slice(3,6).map(D=>({productId:D.id,productName:D.name,quantity:Math.floor(Math.random()*70)+20,cost:Math.random()*9+2})),G=await ka({supplierId:((E=V[3])==null?void 0:E.id)||((N=V[2])==null?void 0:N.id)||((I=V[0])==null?void 0:I.id),deliveryDate:$.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-3`,documents:[],lineItems:M}),Z=ue.map((D,L)=>{var K;const Q=W[L],re=[7,14,21,30][Math.floor(Math.random()*4)],de=new Date(J);de.setDate(de.getDate()+re);const ge=D.cost,te=ge*1.5;return{productName:Q.name,manufacturer:Q.manufacturer,category:Q.category,quantity:D.quantity,quantityType:"units",costPerUnit:ge,buyPrice:ge,sellPrice:te,expirationDate:de.toISOString().split("T")[0],location:["A-1","B-2","C-3"][Math.floor(Math.random()*3)],images:Q.images||[],supplierId:(K=V[0])==null?void 0:K.id,scanMetadata:null}}),oe=_e.map((D,L)=>{var K;const Q=W[L],re=[10,17,24,31][Math.floor(Math.random()*4)],de=new Date(J);de.setDate(de.getDate()+re);const ge=D.cost,te=ge*1.5;return{productName:Q.name,manufacturer:Q.manufacturer,category:Q.category,quantity:D.quantity,quantityType:"units",costPerUnit:ge,buyPrice:ge,sellPrice:te,expirationDate:de.toISOString().split("T")[0],location:["D-1","E-2","F-3"][Math.floor(Math.random()*3)],images:Q.images||[],supplierId:(K=V[1])==null?void 0:K.id,scanMetadata:null}}),se=M.map((D,L)=>{var K,he,ke;const Q=W[3+L],re=[7,14,21,30][Math.floor(Math.random()*4)],de=new Date(J);de.setDate(de.getDate()+re);const ge=D.cost,te=ge*1.5;return{productName:Q.name,manufacturer:Q.manufacturer,category:Q.category,quantity:D.quantity,quantityType:"units",costPerUnit:ge,buyPrice:ge,sellPrice:te,expirationDate:de.toISOString().split("T")[0],location:["G-1","H-2","I-3"][Math.floor(Math.random()*3)],images:Q.images||[],supplierId:((K=V[3])==null?void 0:K.id)||((he=V[2])==null?void 0:he.id)||((ke=V[0])==null?void 0:ke.id),scanMetadata:null}});await Ti({supplier:((P=V[0])==null?void 0:P.name)||"Test Supplier",deliveryDate:$.toISOString().split("T")[0],inventoryDate:J.toISOString().split("T")[0]},Z),await Ti({supplier:((U=V[1])==null?void 0:U.name)||"Test Supplier 2",deliveryDate:ce.toISOString().split("T")[0],inventoryDate:J.toISOString().split("T")[0]},oe),await Ti({supplier:((R=V[3])==null?void 0:R.name)||((A=V[2])==null?void 0:A.name)||"Test Supplier 3",deliveryDate:$.toISOString().split("T")[0],inventoryDate:J.toISOString().split("T")[0]},se),h(`Test data created: ${V.length} suppliers, ${W.length} products, 3 batches, ${Z.length+oe.length+se.length} inventory items`,"success"),n&&await n()}catch(k){console.error("Error creating test data:",k),h("Failed to create test data: "+(k instanceof Error?k.message:"Unknown error"),"error")}finally{a(!1)}}},v=C.useMemo(()=>{const w=t.reduce((U,R)=>{const A=R.averageCostPerUnit||0;return U+R.totalQuantity*A},0),_=t.length,E=new Date;E.setHours(0,0,0,0);const N=new Date;N.setDate(E.getDate()+30),N.setHours(23,59,59,999);const I=t.filter(U=>{const R=new Date(U.earliestExpiration);return R.setHours(0,0,0,0),R>=E&&R<=N}),P=t.filter(U=>{const R=new Date(U.earliestExpiration);return R.setHours(0,0,0,0),R<E});return{totalValue:w,uniqueProducts:_,expiringSoon:I.length,expired:P.length,expiringSoonList:I,expiredList:P}},[t]);return f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Dashboard"}),f.jsx("p",{className:"text-lg text-gray-400",children:"A high-level overview of your inventory status."})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[f.jsx("div",{className:"p-3 bg-cyan-900/50 rounded-lg",children:f.jsx(t3,{className:"w-8 h-8 text-cyan-400"})}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Total Inventory Value"}),f.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",v.totalValue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[f.jsx("div",{className:"p-3 bg-cyan-900/50 rounded-lg",children:f.jsx(uw,{className:"w-8 h-8 text-cyan-400"})}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Unique Products"}),f.jsx("p",{className:"text-2xl font-bold text-white",children:v.uniqueProducts})]})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[f.jsx("div",{className:"p-3 bg-red-900/50 rounded-lg",children:f.jsx(gf,{className:"w-8 h-8 text-red-400"})}),f.jsxs("div",{className:"flex-1",children:[f.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Expiring in 30 Days"}),f.jsxs("p",{className:"text-2xl font-bold text-white",children:[v.expiringSoon," items"]}),v.expired>0&&f.jsxs("p",{className:"text-xs text-red-400 mt-1",children:[v.expired," expired"]})]})]})]}),(v.expired>0||v.expiringSoon>0)&&f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-red-700",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(gf,{className:"w-6 h-6 text-red-400"}),"Expiration Alerts"]}),v.expired>0&&f.jsxs("div",{className:"mb-4",children:[f.jsxs("p",{className:"text-red-400 font-semibold mb-2",children:[" Expired Items (",v.expired,")"]}),f.jsx("ul",{className:"space-y-2",children:v.expiredList.slice(0,5).map(w=>f.jsxs("li",{className:"text-sm p-2 bg-red-900/30 rounded-md",children:[f.jsx("span",{className:"text-white font-medium",children:w.productName}),f.jsxs("span",{className:"text-red-300 ml-2",children:["Expired: ",w.earliestExpiration]})]},w.productName))})]}),v.expiringSoon>0&&f.jsxs("div",{children:[f.jsxs("p",{className:"text-yellow-400 font-semibold mb-2",children:[" Expiring Soon (",v.expiringSoon,")"]}),f.jsx("ul",{className:"space-y-2",children:v.expiringSoonList.slice(0,5).map(w=>{const _=new Date(w.earliestExpiration),E=Math.ceil((_.getTime()-new Date().getTime())/(1e3*60*60*24));return f.jsxs("li",{className:"text-sm p-2 bg-yellow-900/30 rounded-md",children:[f.jsx("span",{className:"text-white font-medium",children:w.productName}),f.jsxs("span",{className:"text-yellow-300 ml-2",children:["Expires in ",E," days: ",w.earliestExpiration]})]},w.productName)})})]})]}),f.jsx(u3,{inventoryData:o,salesHistory:d,productCatalog:t}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Quick Actions"}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("button",{onClick:e,className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Add New Inventory Batch"}),t.length===0&&f.jsx("button",{onClick:x,disabled:r,className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Creating Test Data...":" Create Test Data"})]})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Recently Added Products"}),t.length>0?f.jsx("ul",{className:"space-y-3",children:t.slice(0,3).map(w=>f.jsxs("li",{className:"flex justify-between items-center text-sm p-3 bg-gray-900/50 rounded-md",children:[f.jsxs("div",{children:[f.jsx("p",{className:"font-medium text-white",children:w.productName}),f.jsx("p",{className:"text-gray-400",children:w.manufacturer})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("p",{className:"font-bold text-white",children:[w.totalQuantity," ",w.quantityType]}),f.jsxs("p",{className:"text-gray-400",children:["Exp: ",w.earliestExpiration]})]})]},w.productName))}):f.jsx("p",{className:"text-center text-gray-500 py-4",children:"No inventory data available."})]})]})]})},_r=t=>{if(!t)return"N/A";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toISOString().split("T")[0]},f3=t=>{const e=t.trim().split(" ");return e.length===1?e[0].slice(0,2).toUpperCase():(e[0][0]+e[e.length-1][0]).toUpperCase()},Ex=7,Tx=10,h3=({summaries:t,inventoryItems:e,onSelectProduct:n,onEditItem:r,onDeleteItem:a})=>{var R;const[o,c]=C.useState([]),[d,p]=C.useState(""),[h,x]=C.useState("all"),[v,w]=C.useState({});C.useEffect(()=>{(async()=>{try{const k=await Js();c(k)}catch(k){console.error("Failed to load suppliers:",k)}})()},[]);const _=C.useMemo(()=>d?t.filter(A=>A.supplierIds&&A.supplierIds.includes(d)):t,[t,d]),E=C.useMemo(()=>{if(h==="all")return _;const A=new Date,k=1e3*60*60*24;return _.filter(q=>{if(h==="expiringSoon"){const V=new Date(q.earliestExpiration);if(Number.isNaN(V.getTime()))return!1;const W=Math.ceil((V.getTime()-A.getTime())/k);return W>=0&&W<=Ex}return h==="lowStock"?q.totalQuantity<=Tx:!0})},[_,h]);if(!t.length)return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[f.jsx("p",{className:"mb-4",children:"Your inventory is empty. Products need inventory items (stock) to appear here."}),f.jsxs("div",{className:"mt-4 p-4 bg-gray-900/50 rounded-lg text-left text-sm",children:[f.jsx("p",{className:"text-yellow-400 font-semibold mb-2",children:" How to add inventory:"}),f.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-gray-300",children:[f.jsx("li",{children:"Use the form on the left to add inventory items for existing products"}),f.jsx("li",{children:'Or use the "Batches" tab to log a delivery batch with multiple items'}),f.jsx("li",{children:"Products from Product Catalog need inventory items added to show up here"})]})]})]});if(t.length>0&&!E.length)return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[f.jsx("p",{className:"mb-2",children:"No products match the current filters."}),f.jsx("p",{className:"text-sm text-gray-400",children:"Try clearing the supplier or inventory filter above to see the full inventory list."})]});const I=A=>!A||A.length===0?[]:A.map(k=>{var q;return(q=o.find(V=>V.id===k))==null?void 0:q.name}).filter(k=>!!k),P=C.useMemo(()=>{const A=new Map;return e.forEach(k=>{const q=A.get(k.productId)||[];q.push(k),A.set(k.productId,q)}),A},[e]),U=A=>{w(k=>({...k,[A]:!k[A]}))};return f.jsxs("div",{children:[f.jsx("div",{className:"flex items-center justify-end mb-4",children:f.jsxs("div",{className:"flex flex-col gap-3 text-sm text-gray-300 md:flex-row md:items-center",children:[o.length>0&&f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("label",{children:"Supplier:"}),f.jsxs("select",{value:d,onChange:A=>p(A.target.value),className:"px-3 py-1.5 rounded-md bg-gray-900 border border-gray-700 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"",children:"All Suppliers"}),o.map(A=>f.jsx("option",{value:A.id,children:A.name},A.id))]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("label",{children:"Inventory filter:"}),f.jsxs("select",{value:h,onChange:A=>x(A.target.value),className:"px-3 py-1.5 rounded-md bg-gray-900 border border-gray-700 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"all",children:"All items"}),f.jsxs("option",{value:"expiringSoon",children:["Expiring in  ",Ex," days"]}),f.jsxs("option",{value:"lowStock",children:["Low stock ( ",Tx,")"]})]})]})]})}),d&&f.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Showing ",E.length," product(s) from ",((R=o.find(A=>A.id===d))==null?void 0:R.name)||"selected supplier"]}),f.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:E.map(A=>{const k=I(A.supplierIds),q=P.get(A.productId)||[],V=v[A.productId];return f.jsxs("div",{onClick:()=>n(A),className:"bg-gray-800/60 border border-gray-700 rounded-xl overflow-hidden text-left hover:border-cyan-500 transition cursor-pointer",children:[f.jsx("div",{className:"h-32 bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-3xl font-bold text-gray-300",children:f3(A.productName)}),f.jsxs("div",{className:"p-4 space-y-2",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-lg font-semibold text-white",children:A.productName}),f.jsx("p",{className:"text-sm text-gray-400",children:A.manufacturer})]}),f.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300",children:[f.jsxs("span",{className:"font-medium text-white",children:[A.totalQuantity," ",A.quantityType]}),f.jsxs("span",{className:"text-xs uppercase tracking-wide text-gray-400",children:["Exp: ",_r(A.earliestExpiration)]})]}),k.length>0&&f.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[f.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Suppliers:"}),f.jsx("div",{className:"flex flex-wrap gap-1",children:k.map((W,J)=>f.jsx("span",{className:"px-2 py-0.5 text-xs bg-cyan-900/30 text-cyan-300 rounded border border-cyan-700/50",children:W},J))})]}),f.jsx("p",{className:"text-xs text-gray-500",children:"Location: Not set"}),q.length>0&&f.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700",children:[f.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-2",children:[f.jsxs("span",{children:[q.length," inventory item",q.length>1?"s":""]}),f.jsx("button",{onClick:W=>{W.stopPropagation(),U(A.productId)},className:"text-cyan-300 hover:text-cyan-200",children:V?"Hide items":"Manage items"})]}),V&&f.jsx("div",{className:"space-y-2",children:q.map(W=>f.jsxs("div",{className:"p-2 bg-gray-900/60 rounded text-xs text-gray-300 border border-gray-800 flex flex-col gap-1",onClick:J=>J.stopPropagation(),children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{children:["Qty: ",W.quantity," ",W.quantityType]}),f.jsxs("span",{children:["Exp: ",_r(W.expirationDate)]})]}),f.jsxs("div",{className:"flex justify-between text-gray-400",children:[f.jsx("span",{children:W.location?`Loc: ${W.location}`:"Location N/A"}),f.jsxs("span",{children:["$",W.costPerUnit.toFixed(2),"/unit"]})]}),f.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[f.jsx("button",{onClick:J=>{J.stopPropagation(),r(W)},disabled:!W.inventoryUuid,className:"px-2 py-1 rounded bg-gray-700 text-white disabled:opacity-40 disabled:cursor-not-allowed",children:"Edit"}),f.jsx("button",{onClick:J=>{J.stopPropagation(),a(W)},disabled:!W.inventoryUuid,className:"px-2 py-1 rounded bg-red-700/80 text-white disabled:opacity-40 disabled:cursor-not-allowed",children:"Delete"})]})]},W.inventoryUuid||W.id))})]})]})]},A.productId)})})]})},p3=({inventory:t,batches:e,onEditRequest:n,onDeleteRequest:r})=>t.length===0?f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[f.jsx("h2",{className:"text-xl font-semibold mb-2 text-white",children:"Current Inventory"}),f.jsx("p",{children:"Your inventory is empty. Add items using the form to see them here."})]}):f.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700 overflow-hidden",children:[f.jsx("h2",{className:"text-xl font-semibold text-white p-6",children:"Current Inventory"}),f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[f.jsx("thead",{className:"bg-gray-800",children:f.jsxs("tr",{children:[f.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-6",children:"Product Name"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Manufacturer"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Exp. Date"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Quantity"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Supplier"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Cost/Unit"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-right text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700 bg-gray-900/50",children:t.map(a=>{var o;return f.jsxs("tr",{className:"hover:bg-gray-800 transition-colors",children:[f.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-6",children:a.productName}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:a.manufacturer}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:_r(a.expirationDate)}),f.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:[a.quantity," ",a.quantityType]}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:((o=e.find(c=>c.id===a.batchId))==null?void 0:o.supplier)||"N/A"}),f.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:["$",a.costPerUnit.toFixed(2)]}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-right text-gray-400",children:f.jsxs("div",{className:"flex justify-end gap-2",children:[f.jsx("button",{onClick:()=>n(a),disabled:!a.inventoryUuid,className:"px-3 py-1 rounded-md bg-gray-700 text-white text-xs hover:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed",children:"Edit"}),f.jsx("button",{onClick:()=>r(a),disabled:!a.inventoryUuid,className:"px-3 py-1 rounded-md bg-red-700/70 text-white text-xs hover:bg-red-700 disabled:opacity-40 disabled:cursor-not-allowed",children:"Delete"})]})})]},a.id)})})]})})]}),m3=({items:t,batches:e})=>{const[n,r]=C.useState(""),[a,o]=C.useState(null),[c,d]=C.useState(!1),[p,h]=C.useState(null),x=["Which items expire in the next 30 days?","What is the total value of my current inventory?","Summarize stock levels by supplier.","Identify my most expensive items per unit."],v=async()=>{if(!n){h("Please enter a query for the report.");return}d(!0),h(null),o(null);try{const w=await fw(t,e,n);o(w)}catch(w){h(w instanceof Error?w.message:"An unknown error occurred.")}finally{d(!1)}};return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("h2",{className:"text-xl font-semibold mb-4 text-white flex items-center",children:[f.jsx(vw,{className:"w-6 h-6 mr-2 text-cyan-400"}),"Advanced Inventory Analysis (Gemini Pro)"]}),f.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use our most powerful model to get deep insights into your inventory. Ask complex questions to make better business decisions."}),f.jsxs("div",{className:"mb-4",children:[f.jsx("label",{htmlFor:"analysis-prompt",className:"block text-sm font-medium text-gray-300 mb-2",children:"Your Analysis Request"}),f.jsx("textarea",{id:"analysis-prompt",rows:3,className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm",placeholder:"e.g., What is the total value of my current stock?",value:n,onChange:w=>r(w.target.value)})]}),f.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[f.jsx("span",{className:"text-sm text-gray-400 self-center",children:"Try:"}),x.map(w=>f.jsx("button",{onClick:()=>r(w),className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded-md hover:bg-cyan-800 hover:text-white transition-colors",children:w},w))]}),f.jsx("button",{onClick:v,disabled:c||t.length===0,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:c?"Thinking...":"Generate Report"}),t.length===0&&f.jsx("p",{className:"text-yellow-400 text-sm mt-2 text-center",children:"Add items to inventory to enable analysis."}),p&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:p}),c&&f.jsxs("div",{className:"flex items-center justify-center my-4 p-4 bg-gray-900/50 rounded-lg",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"}),f.jsx("p",{className:"ml-3 text-cyan-400",children:"Gemini Pro is processing your request..."})]}),a&&f.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[f.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Analysis Report"}),f.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-gray-300",dangerouslySetInnerHTML:{__html:a.replace(/\n/g,"<br />")}})]})]})},g3=({product:t,allItems:e,allBatches:n,onClose:r})=>{const a=h=>typeof h!="number"||Number.isNaN(h)?"N/A":`$${h.toFixed(2)}`,o=e.filter(h=>h.productName===t.productName).map(h=>{const x=n.find(v=>v.id===h.batchId);return{...h,batch:x}}).sort((h,x)=>new Date(h.expirationDate).getTime()-new Date(x.expirationDate).getTime()),c=C.useMemo(()=>o.reduce((h,x)=>{const v=typeof x.costPerUnit=="number"?x.costPerUnit:0;return h+v*x.quantity},0),[o]),d=t.totalQuantity>0?c/t.totalQuantity:0,p=C.useMemo(()=>{const h=new Map;return o.forEach(x=>{var P,U,R;const v=((P=x.batch)==null?void 0:P.id)??x.batchId??`line-${x.id}`,w=String(v),_=((U=x.batch)==null?void 0:U.supplier)??"N/A",E=(R=x.batch)==null?void 0:R.inventoryDate,N=typeof x.costPerUnit=="number"?x.costPerUnit:0,I=h.get(w)??{batchId:w,supplier:_,inventoryDate:E,quantity:0,totalValue:0};I.quantity+=x.quantity,I.totalValue+=N*x.quantity,I.supplier=_,I.inventoryDate=E,h.set(w,I)}),Array.from(h.values()).sort((x,v)=>x.batchId.localeCompare(v.batchId))},[o]);return f.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-center justify-center p-4",onClick:r,children:f.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",onClick:h=>h.stopPropagation(),children:[f.jsxs("div",{className:"p-6 border-b border-gray-700",children:[f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold text-white",children:t.productName}),f.jsx("p",{className:"text-sm text-gray-400",children:t.manufacturer})]}),f.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white transition-colors",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f.jsxs("div",{className:"mt-4 flex space-x-8 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Total Quantity"}),f.jsxs("p",{className:"text-white font-semibold text-lg",children:[t.totalQuantity," ",t.quantityType]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Earliest Expiration"}),f.jsx("p",{className:"text-yellow-400 font-semibold text-lg",children:_r(t.earliestExpiration)})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Average Unit Cost"}),f.jsx("p",{className:"text-cyan-400 font-semibold text-lg",children:a(d)})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Inventory Value"}),f.jsx("p",{className:"text-green-400 font-semibold text-lg",children:a(c)})]})]})]}),f.jsxs("div",{className:"p-6 overflow-y-auto",children:[f.jsx("h3",{className:"text-lg font-semibold text-cyan-400 mb-3",children:"Batch Details (First-Expired, First-Out)"}),f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[f.jsx("thead",{className:"bg-gray-800",children:f.jsxs("tr",{children:[f.jsx("th",{scope:"col",className:"py-3 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-0",children:"Quantity"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Exp. Date"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Supplier"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Inventory Date"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Cost / Unit"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Buy Price"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Sell Price"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Line Value"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Batch"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700",children:o.map(h=>{var x,v,w;return f.jsxs("tr",{children:[f.jsxs("td",{className:"py-3 pl-4 pr-3 text-sm text-white sm:pl-0",children:[h.quantity," ",h.quantityType]}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:_r(h.expirationDate)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-400",children:((x=h.batch)==null?void 0:x.supplier)??"N/A"}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-400",children:_r((v=h.batch)==null?void 0:v.inventoryDate)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a(h.costPerUnit)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a(h.buyPrice)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:typeof h.sellPrice=="number"?a(h.sellPrice):""}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a((h.costPerUnit||0)*h.quantity)}),f.jsx("td",{className:"px-3 py-3 text-xs text-gray-500",children:((w=h.batch)==null?void 0:w.id)??String(h.batchId)})]},h.id)})})]})}),p.length>0&&f.jsxs("div",{className:"mt-6",children:[f.jsx("h4",{className:"text-md font-semibold text-gray-200 mb-3",children:"Cost Overview by Batch"}),f.jsx("div",{className:"space-y-3",children:p.map(h=>f.jsxs("div",{className:"p-4 bg-gray-900/40 border border-gray-700 rounded-lg flex flex-wrap gap-4 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Batch"}),f.jsx("p",{className:"text-white font-semibold",children:h.batchId})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Supplier"}),f.jsx("p",{className:"text-white",children:h.supplier})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Inventory Date"}),f.jsx("p",{className:"text-white",children:_r(h.inventoryDate)})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Quantity"}),f.jsxs("p",{className:"text-white",children:[h.quantity," ",t.quantityType]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Batch Value"}),f.jsx("p",{className:"text-green-400 font-semibold",children:a(h.totalValue)})]})]},h.batchId))})]}),f.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-cyan-800/50",children:[f.jsx("h4",{className:"font-semibold text-cyan-500",children:"POS Integration Note"}),f.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'The list above is sorted by expiration date. For a "First-Expired, First-Out" (FEFO) strategy, a Point-of-Sale system would automatically deduct sold items from the top of this list, ensuring optimal stock rotation and minimizing waste.'})]})]})]})})},_w=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),f.jsx("polyline",{points:"17 8 12 3 7 8"}),f.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),Ld={supplier:"",deliveryDate:"",inventoryDate:new Date().toISOString().split("T")[0]},Nx={productName:"",manufacturer:"",category:"",productDescription:"",productId:void 0,supplierId:void 0,expirationDate:"",quantity:0,quantityType:"units",costPerUnit:0,location:"",buyPrice:0,sellPrice:void 0,images:[],scanMetadata:null,shareScope:["local"]},y3=({onAddBatch:t,summaries:e,pendingScanResult:n})=>{const[r,a]=C.useState(Ld),[o,c]=C.useState(Nx),[d,p]=C.useState([]),[h,x]=C.useState(!1),[v,w]=C.useState(null),[_,E]=C.useState(null),[N,I]=C.useState(!1),P=C.useRef(null),[U,R]=C.useState(new Map),[A,k]=C.useState(new Map),[q,V]=C.useState([]),[W,J]=C.useState([]),[$,ce]=C.useState(""),[ue,Ce]=C.useState(""),[_e,Ve]=C.useState("existing"),[M,G]=C.useState("existing"),[Z,oe]=C.useState({name:"",email:""}),[se,D]=C.useState(!1),[L,Q]=C.useState(null),[re,de]=C.useState(!1),ge=C.useRef(null),te=C.useRef(!1),K=C.useMemo(()=>{const ae=new Map;return q.forEach(ie=>{ae.set(ie.name,{productId:ie.id,productName:ie.name})}),e.forEach(ie=>{ae.has(ie.productName)||ae.set(ie.productName,{productId:ie.productId,productName:ie.productName})}),Array.from(ae.values())},[q,e]),he=C.useCallback(ae=>{const ie=new Set(["local"]);return(ae||[]).forEach(Ne=>Ne&&ie.add(Ne)),Array.from(ie)},[]),ke=C.useCallback(ae=>ae?ae.toLowerCase().trim().replace(/[^a-z0-9]+/gi,"-"):"unlabeled-product",[]),ye=C.useCallback((ae,ie)=>{c(Ne=>{const He=new Set(he(Ne.shareScope));return ie?He.add(ae):He.delete(ae),He.size||He.add("local"),{...Ne,shareScope:Array.from(He)}})},[he]);C.useEffect(()=>()=>{A.forEach(ae=>URL.revokeObjectURL(ae))},[A]),C.useEffect(()=>{_e==="new"&&(ce(""),c(ae=>({...ae,productId:void 0})))},[_e]),C.useEffect(()=>{M==="new"&&(Ce(""),c(ae=>({...ae,supplierId:void 0})))},[M]);const Ee=C.useCallback(async()=>{try{const[ae,ie]=await Promise.all([Wl(),Js()]);V(ae),J(ie)}catch(ae){console.error("Failed to load reference data",ae)}},[]);C.useEffect(()=>{Ee()},[Ee]);const ze=C.useCallback(async ae=>{E(URL.createObjectURL(ae)),x(!0),w(null);try{const ie=await tc(ae);a(Ne=>({...Ne,supplier:Ne.supplier||ie.supplier||"",deliveryDate:Ne.deliveryDate||ie.deliveryDate||""})),c(Ne=>({...Ne,productName:ie.productName||"",manufacturer:ie.manufacturer||"",category:ie.category||"",expirationDate:ie.expirationDate||"",quantity:ie.quantity||0,quantityType:ie.quantityType||"units",costPerUnit:ie.costPerUnit||0}))}catch(ie){w(ie instanceof Error?ie.message:"An unknown error occurred.")}finally{x(!1)}},[]),Ke=C.useCallback(ae=>{var Ne;const ie=(Ne=ae.target.files)==null?void 0:Ne[0];ie&&ze(ie)},[ze]),st=C.useCallback(ae=>{const{data:ie,blobs:Ne,identifiedProductId:He}=ae;I(!1),E(null),P.current&&(P.current.value=""),Q(ae),A.forEach(Ie=>URL.revokeObjectURL(Ie));const Fn=new Map;if(Ne.forEach((Ie,Et)=>Fn.set(Et,URL.createObjectURL(Ie))),k(Fn),R(Ne),a(Ie=>({...Ie,supplier:Ie.supplier||ie.supplier||"",deliveryDate:Ie.deliveryDate||ie.deliveryDate||""})),He){const Ie=q.find(Et=>Et.id===He);if(Ie){de(!1),Ve("existing"),ce(Ie.id),c(Et=>({...Et,productId:Ie.id,productName:Ie.name,manufacturer:Ie.manufacturer,category:Ie.category,productDescription:Ie.description||"",expirationDate:ie.expirationDate||Et.expirationDate||"",quantity:ie.quantity||Et.quantity||1,quantityType:ie.quantityType||Et.quantityType||"units",costPerUnit:ie.costPerUnit||Et.costPerUnit||0,buyPrice:ie.buyPrice||Et.buyPrice||0,sellPrice:ie.sellPrice||Et.sellPrice,location:ie.location||Et.location||""}));return}}Ve("new"),de(!0),c(Ie=>({...Ie,productName:ie.productName||Ie.productName||"",manufacturer:ie.manufacturer||Ie.manufacturer||"",category:ie.category||Ie.category||"",productDescription:ie.productDescription||Ie.productDescription||"",expirationDate:ie.expirationDate||Ie.expirationDate||"",quantity:ie.quantity||Ie.quantity||0,quantityType:ie.quantityType||Ie.quantityType||"units",costPerUnit:ie.costPerUnit||Ie.costPerUnit||0,buyPrice:ie.buyPrice||Ie.buyPrice||0,sellPrice:ie.sellPrice||Ie.sellPrice,location:ie.location||Ie.location||""}))},[A,q]);C.useEffect(()=>{n&&n!==ge.current&&!te.current&&(te.current=!0,ge.current=n,st(n),setTimeout(()=>{te.current=!1},100))},[n]);const Ue=ae=>{const{name:ie,value:Ne}=ae.target;a(He=>({...He,[ie]:Ne}))},it=ae=>{const{name:ie,value:Ne,type:He}=ae.target,Fn=He==="number";c(Ie=>({...Ie,[ie]:Fn?parseFloat(Ne)||0:Ne}))},wt=ae=>{var Ne;Ce(ae),c(He=>({...He,supplierId:ae||void 0}));const ie=(Ne=W.find(He=>He.id===ae))==null?void 0:Ne.name;ie&&a(He=>({...He,supplier:ie}))},At=ae=>{const{name:ie,value:Ne}=ae.target;oe(He=>({...He,[ie]:Ne}))},jn=async ae=>{if(ae.preventDefault(),!Z.name.trim()){w("Supplier name is required.");return}D(!0),w(null);try{const ie=await Mi({name:Z.name.trim(),contactEmail:Z.email.trim()||void 0});await Ee(),G("existing"),Ce(ie.id),c(Ne=>({...Ne,supplierId:ie.id})),a(Ne=>({...Ne,supplier:ie.name||ie.id})),oe({name:"",email:""})}catch(ie){w(ie instanceof Error?ie.message:"Failed to create supplier.")}finally{D(!1)}},On=async ae=>{if(ae.preventDefault(),o.productName&&o.quantity>0){let ie=[];if(U.size>0&&o.productName){x(!0),w(null);try{const Ie=await Promise.all(Array.from(U.entries()).map(async([Ln,nc])=>{const sc=await jf(o.productName,Ln,nc,{productId:$||o.productId||ke(o.productName),source:(L==null?void 0:L.fieldSources.get(Ln))||"manual"});return{field:String(Ln),captureId:sc,source:(L==null?void 0:L.fieldSources.get(Ln))||"manual",confidence:L==null?void 0:L.fieldConfidences.get(Ln)}})),Et=new Date().toISOString();ie=Ie.map(Ln=>({...Ln,capturedAt:Et}))}catch(Ie){console.error(Ie),w("Could not save scan images.")}finally{x(!1)}}const Ne=L?Array.from(L.fieldConfidences.values()).filter(Ie=>typeof Ie=="number"):[],He=Ne.length>0?Ne.reduce((Ie,Et)=>Ie+Et,0)/Ne.length:void 0,Fn=ie.length?{confidence:He,fieldCaptures:ie}:He!==void 0?{confidence:He}:null;p(Ie=>[...Ie,{...o,productId:$||o.productId,supplierId:ue||o.supplierId,shareScope:he(o.shareScope),scanMetadata:Fn}]),c(Nx),ce(""),Ce(""),E(null),Q(null),de(!1),P.current&&(P.current.value=""),R(new Map),A.forEach(Ie=>URL.revokeObjectURL(Ie)),k(new Map),ge.current=null,te.current=!1}},Qt=()=>{d.length>0&&r.supplier&&r.deliveryDate?(t(r,d),a(Ld),p([])):w("Please add at least one item and fill in all batch details (Supplier, Delivery Date).")};return f.jsxs(f.Fragment,{children:[N&&f.jsx(Ha,{onDataScanned:st,onClose:()=>I(!1),productOptions:K}),f.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm p-8 rounded-xl border border-gray-700/50 shadow-2xl",children:[f.jsxs("h2",{className:"text-2xl font-bold mb-6 text-white flex items-center gap-3",children:[f.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:f.jsx(sh,{className:"w-6 h-6 text-cyan-400"})}),"Add New Inventory Batch"]}),f.jsxs("div",{className:"space-y-6 p-6 bg-gray-900/40 border border-gray-700/50 rounded-xl mb-6 backdrop-blur-sm shadow-inner",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx("div",{className:"w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center",children:f.jsx("span",{className:"text-cyan-400 font-bold text-sm",children:"1"})}),f.jsx("h3",{className:"font-bold text-xl text-gray-100",children:"Batch Details"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[f.jsxs("div",{className:"space-y-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700/30",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-semibold text-gray-200 mb-3",children:"Product Selection"}),f.jsx("div",{className:"flex gap-2 mb-4",children:["existing","new"].map(ae=>f.jsx("button",{type:"button",onClick:()=>Ve(ae),className:`flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 ${_e===ae?"bg-gradient-to-r from-cyan-600 to-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:ae==="existing"?"Existing Product":"New Product"},ae))})]}),re&&_e==="new"&&f.jsx("div",{className:"p-3 bg-amber-500/10 border border-amber-500/40 rounded-lg text-sm text-amber-100",children:"New product detected. Review the static fields below so we can register it in the catalog when this batch is saved."}),_e==="existing"?f.jsx("div",{children:f.jsxs("select",{className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",value:$,onChange:ae=>{const ie=ae.target.value;if(ce(ie),!ie){c(He=>({...He,productId:void 0,productName:"",manufacturer:"",category:"",productDescription:""}));return}const Ne=q.find(He=>He.id===ie);Ne&&c(He=>({...He,productId:Ne.id,productName:Ne.name,manufacturer:Ne.manufacturer,category:Ne.category,productDescription:Ne.description||""}))},children:[f.jsx("option",{value:"",children:"Select from catalog"}),q.map(ae=>f.jsxs("option",{value:ae.id,children:[ae.name,"  ",ae.manufacturer]},ae.id))]})}):f.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:f.jsx("p",{className:"text-sm text-blue-300",children:"Manual entry enabled. Fill in the product fields below to register a new product as you scan it."})})]}),f.jsxs("div",{className:"space-y-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700/30",children:[f.jsx("div",{className:"flex items-center justify-between gap-2 mb-2",children:f.jsx("p",{className:"text-sm font-semibold text-gray-200",children:"Supplier Management"})}),f.jsx("div",{className:"flex gap-2 mb-4",children:["existing","new"].map(ae=>f.jsx("button",{type:"button",onClick:()=>G(ae),className:`flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 ${M===ae?"bg-gradient-to-r from-cyan-600 to-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:ae==="existing"?"Choose Supplier":"Create Supplier"},ae))}),M==="existing"?f.jsxs("select",{className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",value:ue,onChange:ae=>wt(ae.target.value),children:[f.jsx("option",{value:"",children:"Select Supplier"}),W.map(ae=>f.jsx("option",{value:ae.id,children:ae.name},ae.id))]}):f.jsxs("form",{onSubmit:jn,className:"space-y-3",children:[f.jsx("input",{name:"name",value:Z.name,onChange:At,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",placeholder:"Supplier name"}),f.jsx("input",{type:"email",name:"email",value:Z.email,onChange:At,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",placeholder:"Contact email (optional)"}),f.jsx("button",{type:"submit",disabled:se,className:"w-full px-4 py-2.5 rounded-lg bg-gradient-to-r from-cyan-600 to-cyan-500 text-white text-sm font-semibold disabled:opacity-60 hover:from-cyan-500 hover:to-cyan-400 transition-all shadow-lg shadow-cyan-500/20",children:se?"Creating...":"Create & Use Supplier"})]})]})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-700/50",children:Object.keys(Ld).map(ae=>f.jsxs("div",{children:[f.jsx("label",{htmlFor:`batch-${ae}`,className:"block text-sm font-medium text-gray-300 mb-2 capitalize",children:ae.replace(/([A-Z])/g," $1")}),f.jsx("input",{type:ae.includes("Date")?"date":"text",name:ae,id:`batch-${ae}`,value:r[ae],onChange:Ue,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all shadow-sm"})]},ae))})]}),f.jsxs("div",{className:"space-y-6 p-6 bg-gray-900/40 border border-gray-700/50 rounded-xl backdrop-blur-sm shadow-inner",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx("div",{className:"w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center",children:f.jsx("span",{className:"text-cyan-400 font-bold text-sm",children:"2"})}),f.jsx("h3",{className:"font-bold text-xl text-gray-100",children:"Add Items to Batch"})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("div",{className:"flex justify-center px-6 pt-6 pb-6 border-2 border-gray-600/50 border-dashed rounded-xl cursor-pointer hover:border-cyan-400/50 hover:bg-cyan-500/5 transition-all duration-200 group",onClick:()=>{var ae;return(ae=P.current)==null?void 0:ae.click()},children:f.jsxs("div",{className:"space-y-2 text-center",children:[_?f.jsx("img",{src:_,alt:"Preview",className:"mx-auto h-32 w-auto rounded-lg object-cover shadow-lg"}):f.jsx("div",{className:"mx-auto p-4 bg-gray-800/50 rounded-full group-hover:bg-cyan-500/10 transition-all",children:f.jsx(_w,{className:"h-10 w-10 text-gray-400 group-hover:text-cyan-400 transition-colors"})}),f.jsx("p",{className:"text-sm text-gray-400 group-hover:text-cyan-300 transition-colors",children:h?"Analyzing...":"Click to upload image"})]})}),f.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:Ke,ref:P,accept:"image/*"}),f.jsxs("button",{type:"button",onClick:()=>I(!0),className:"w-full flex items-center justify-center gap-2 py-3 px-4 border border-gray-600/50 rounded-lg text-sm font-semibold text-gray-200 bg-gray-700/30 hover:bg-gray-700/50 hover:border-cyan-500/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all shadow-sm",children:[f.jsx(Ga,{className:"w-5 h-5"}),"Live Scan Item"]})]}),h&&f.jsxs("div",{className:"flex items-center justify-center py-4",children:[f.jsx("div",{className:"animate-spin rounded-full h-7 w-7 border-2 border-cyan-400 border-t-transparent"}),f.jsx("p",{className:"ml-3 text-cyan-400 font-medium",children:"Extracting data..."})]}),v&&f.jsx("div",{className:"p-3 bg-red-900/30 border border-red-700/50 rounded-lg",children:f.jsx("p",{className:"text-red-400 text-sm",children:v})}),f.jsxs("form",{onSubmit:On,className:"space-y-5 pt-2",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Product Name"}),f.jsx("input",{name:"productName",value:o.productName,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!$})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Manufacturer"}),f.jsx("input",{name:"manufacturer",value:o.manufacturer,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!$})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),f.jsx("input",{name:"category",value:o.category,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!$})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Expiration Date"}),f.jsx("input",{type:"date",name:"expirationDate",value:o.expirationDate,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Product Description"}),f.jsx("textarea",{name:"productDescription",value:o.productDescription,onChange:it,rows:3,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all resize-none",disabled:!!$})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quantity"}),f.jsx("input",{type:"number",name:"quantity",value:o.quantity,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quantity Type"}),f.jsx("input",{name:"quantityType",value:o.quantityType,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),f.jsx("input",{name:"location",value:o.location,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Cost Per Unit"}),f.jsx("input",{type:"number",name:"costPerUnit",value:o.costPerUnit,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Buy Price"}),f.jsx("input",{type:"number",name:"buyPrice",value:o.buyPrice??"",onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Sell Price"}),f.jsx("input",{type:"number",name:"sellPrice",value:o.sellPrice??"",onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]})]}),ds&&f.jsxs("div",{className:"p-4 bg-cyan-900/10 border border-cyan-800/40 rounded-lg space-y-2",children:[f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx("input",{id:"dan-sharing",type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-500 text-cyan-500 focus:ring-cyan-400 bg-gray-900",checked:(o.shareScope||[]).includes("dan"),onChange:ae=>ye("dan",ae.target.checked)}),f.jsxs("label",{htmlFor:"dan-sharing",className:"text-sm text-gray-200",children:[f.jsx("span",{className:"font-semibold text-cyan-200",children:"Share with DAN network (beta)"}),f.jsx("span",{className:"block text-gray-400",children:"Broadcast anonymized surplus signals (product, quantity, expiration bucket, aisle zone) so trusted partners can discover this offer."})]})]}),f.jsx("p",{className:"text-xs text-gray-500 pl-7",children:"Provenance proofs are signed with your shop key. Disable anytime to keep inventory local-only."})]}),f.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-indigo-600 to-indigo-500 hover:from-indigo-500 hover:to-indigo-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 disabled:from-gray-600 disabled:to-gray-600 disabled:cursor-not-allowed transition-all shadow-lg shadow-indigo-500/20",children:h?"Saving Scan...":"Add This Item"})]})]}),d.length>0&&f.jsxs("div",{className:"mt-6",children:[f.jsxs("h3",{className:"font-semibold text-lg text-gray-200 mb-2",children:["Items in this Batch (",d.length,")"]}),f.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto p-2 bg-gray-900/50 rounded-md",children:d.map((ae,ie)=>{var Ne;return f.jsxs("li",{className:"text-sm text-gray-300 p-2 bg-gray-700/50 rounded-md flex justify-between items-center gap-3",children:[f.jsxs("span",{children:[ae.quantity,"x ",ae.productName]}),f.jsxs("span",{className:"flex items-center gap-2",children:[f.jsxs("span",{children:["Exp: ",ae.expirationDate]}),((Ne=ae.shareScope)==null?void 0:Ne.includes("dan"))&&f.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border border-cyan-600/40 bg-cyan-900/40 text-cyan-200",children:"DAN"})]})]},ie)})})]}),f.jsx("button",{onClick:Qt,disabled:d.length===0,className:"mt-6 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:"Finish and Save Batch"})]})]})},x3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),f.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),f.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),f.jsx("rect",{x:"14",y:"14",width:"7",height:"7"})]}),v3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),f.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),f.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),f.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),f.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),f.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),b3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),f.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),f.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),f.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),f.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),w3=({summaries:t,items:e,batches:n,onAddBatch:r,onDataRefresh:a})=>{const[o,c]=C.useState(null),[d,p]=C.useState("grid"),[h,x]=C.useState("overview"),[v,w]=C.useState(!1),[_,E]=C.useState(null),[N,I]=C.useState(!1),{showToast:P}=gs(),[U,R]=C.useState(null),[A,k]=C.useState({}),[q,V]=C.useState(null),[W,J]=C.useState(null),[$,ce]=C.useState(!1),ue=C.useMemo(()=>t.map(te=>({productId:te.productId,productName:te.productName})),[t]),Ce=C.useMemo(()=>{const te=new Date,K=new Date(te.getTime()+10080*60*1e3);return t.filter(he=>{const ke=new Date(he.earliestExpiration);return ke<=K&&ke>=te})},[t]),_e=C.useMemo(()=>{const te=new Date;return t.filter(K=>new Date(K.earliestExpiration)<te)},[t]);C.useCallback(()=>{a(),P("New product successfully learned and added to catalog!","success")},[a,P]);const[Ve,M]=C.useState(null),G=C.useCallback(te=>{w(!1),M(te),x("manual"),P("Scan complete! Please verify and edit the pre-populated data in the form below before adding to inventory.","success")},[P]),Z=C.useCallback(()=>{x("overview"),a(),P("Inventory batch added successfully!","success")},[a,P]),[oe,se]=C.useState(!1),D=C.useCallback(async te=>{se(!1),I(!0),E(null);try{const K=Xf();if(!K){P("No active shop context. Please ensure you are logged in.","error"),I(!1);return}const he=await ah(te,K);E(he),he.length>0?P(`Found ${he.length} matching items in inventory!`,"success"):P("This item is not in the inventory.","info")}catch(K){P("Visual search failed: "+(K instanceof Error?K.message:"Unknown error"),"error")}finally{I(!1)}},[P]),L=C.useCallback(te=>{if(!te.inventoryUuid){P("This entry was imported without a Qdrant reference and cannot be edited.","error");return}J(null),k({quantity:te.quantity,expirationDate:te.expirationDate,location:te.location||"",costPerUnit:te.costPerUnit,sellPrice:te.sellPrice??void 0}),R(te)},[P]),Q=C.useCallback(te=>{if(!te.inventoryUuid){P("This entry was imported without a Qdrant reference and cannot be deleted.","error");return}J(null),V(te)},[P]),re=C.useCallback((te,K)=>{if(te==="quantity"||te==="costPerUnit"||te==="sellPrice"){k(he=>({...he,[te]:K===""?void 0:Number(K)}));return}k(he=>({...he,[te]:K}))},[]),de=C.useCallback(async te=>{if(te.preventDefault(),!!(U!=null&&U.inventoryUuid)){ce(!0),J(null);try{await Yb(U.inventoryUuid,A),await Promise.resolve(a()),P("Inventory item updated.","success"),R(null)}catch(K){J(K instanceof Error?K.message:"Failed to update inventory item.")}finally{ce(!1)}}},[U,A,a,P]),ge=C.useCallback(async()=>{if(q!=null&&q.inventoryUuid){ce(!0),J(null);try{await Kb(q.inventoryUuid),await Promise.resolve(a()),P("Inventory item deleted.","success"),V(null)}catch(te){J(te instanceof Error?te.message:"Failed to delete inventory item.")}finally{ce(!1)}}},[q,a,P]);return f.jsxs(f.Fragment,{children:[o&&f.jsx(g3,{product:o,allItems:e,allBatches:n,onClose:()=>c(null)}),v&&f.jsx(Ha,{onDataScanned:G,onClose:()=>w(!1),productOptions:ue}),oe&&f.jsx(Ha,{onDataScanned:te=>{const K=te.blobs.get("productName")||te.blobs.get("manufacturer")||Array.from(te.blobs.values())[0];K?D(K):(P("No image captured. Please try again.","error"),se(!1))},onClose:()=>se(!1),productOptions:ue,mode:"visual-search"}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h1",{className:"text-2xl font-bold text-white",children:"Inventory Management"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:()=>x("overview"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${h==="overview"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Overview"}),f.jsx("button",{onClick:()=>x("manual"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${h==="manual"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Manual Entry"})]})]}),(Ce.length>0||_e.length>0)&&f.jsxs("div",{className:"mt-4 p-4 rounded-lg border-l-4 bg-yellow-900/20 border-yellow-500",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(gf,{className:"w-5 h-5 text-yellow-400"}),f.jsxs("h3",{className:"font-semibold text-yellow-300",children:[_e.length>0&&`${_e.length} Expired`,_e.length>0&&Ce.length>0&&"  ",Ce.length>0&&`${Ce.length} Expiring Soon`]})]}),f.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[_e.slice(0,5).map(te=>f.jsxs("span",{className:"px-2 py-1 bg-red-900/50 text-red-300 rounded text-xs",children:[te.productName," (Expired)"]},te.productId)),Ce.slice(0,5).map(te=>f.jsxs("span",{className:"px-2 py-1 bg-yellow-900/50 text-yellow-300 rounded text-xs",children:[te.productName," (Expires: ",new Date(te.earliestExpiration).toLocaleDateString(),")"]},te.productId))]})]})]}),h==="overview"&&f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[f.jsxs("div",{className:"lg:col-span-4 space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 shadow-lg",children:[f.jsx("h2",{className:"text-xl font-semibold mb-4 text-white",children:"Quick Actions"}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("button",{onClick:()=>w(!0),className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:[f.jsx(Ga,{className:"w-6 h-6"}),"Live Scan Item"]}),f.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Use your camera to automatically extract product data"}),f.jsxs("button",{onClick:()=>se(!0),disabled:N,className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[f.jsx(Ga,{className:"w-6 h-6"}),N?"Searching...":"Live Imagery Search"]}),f.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Use your camera to search inventory by image"}),f.jsxs("button",{onClick:()=>x("manual"),className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-gray-600 rounded-md shadow-sm text-base font-medium text-gray-200 bg-gray-700/50 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:[f.jsx(b3,{className:"w-6 h-6"}),"Manual Entry"]}),f.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Enter inventory details manually or complete a scan"})]}),_&&_.length>0&&f.jsxs("div",{className:"mt-4 p-4 bg-purple-900/20 border border-purple-700 rounded-lg",children:[f.jsxs("h3",{className:"text-sm font-semibold text-purple-300 mb-2",children:["Visual Search Results (",_.length," found)"]}),f.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:_.map((te,K)=>f.jsxs("div",{className:"text-xs p-2 bg-gray-900/50 rounded",children:[f.jsxs("p",{className:"text-white font-medium",children:["Product ID: ",te.productId]}),f.jsxs("p",{className:"text-gray-400",children:["Qty: ",te.quantity," | Exp: ",te.expirationDate]})]},K))}),f.jsx("button",{onClick:()=>E(null),className:"mt-2 text-xs text-purple-400 hover:text-purple-300",children:"Clear results"})]})]}),f.jsx(m3,{items:e,batches:n})]}),f.jsxs("div",{className:"lg:col-span-8 space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Current Inventory"}),f.jsxs("div",{className:"flex items-center p-1 bg-gray-900/50 rounded-lg border border-gray-700",children:[f.jsx("button",{onClick:()=>p("grid"),className:`p-2 rounded-md transition-colors ${d==="grid"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,"aria-label":"Grid view",title:"Grid View",children:f.jsx(x3,{className:"w-5 h-5"})}),f.jsx("button",{onClick:()=>p("table"),className:`p-2 rounded-md transition-colors ${d==="table"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,"aria-label":"Table view",title:"Table View",children:f.jsx(v3,{className:"w-5 h-5"})})]})]}),d==="grid"?f.jsx(h3,{summaries:t,inventoryItems:e,onSelectProduct:c,onEditItem:L,onDeleteItem:Q}):f.jsx(p3,{inventory:e,batches:n,onEditRequest:L,onDeleteRequest:Q})]})]}),h==="manual"&&f.jsx(y3,{onAddBatch:(te,K)=>{r(te,K),Z(),M(null)},summaries:t,pendingScanResult:Ve,onScanResultProcessed:()=>M(null)}),U&&f.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-lg",children:[f.jsxs("div",{className:"flex justify-between items-center border-b border-gray-700 p-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Edit Inventory Item"}),f.jsx("p",{className:"text-sm text-gray-400",children:U.productName})]}),f.jsx("button",{onClick:()=>{R(null),J(null)},className:"text-gray-400 hover:text-white text-2xl leading-5","aria-label":"Close edit item modal",children:""})]}),f.jsxs("form",{onSubmit:de,className:"p-4 space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[f.jsxs("label",{className:"text-sm text-gray-300",children:["Quantity",f.jsx("input",{type:"number",min:0,className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:A.quantity??"",onChange:te=>re("quantity",te.target.value)})]}),f.jsxs("label",{className:"text-sm text-gray-300",children:["Expiration Date",f.jsx("input",{type:"date",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:A.expirationDate??"",onChange:te=>re("expirationDate",te.target.value)})]}),f.jsxs("label",{className:"text-sm text-gray-300",children:["Cost / Unit",f.jsx("input",{type:"number",step:"0.01",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:A.costPerUnit??"",onChange:te=>re("costPerUnit",te.target.value)})]}),f.jsxs("label",{className:"text-sm text-gray-300",children:["Sell Price",f.jsx("input",{type:"number",step:"0.01",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:A.sellPrice??"",onChange:te=>re("sellPrice",te.target.value)})]})]}),f.jsxs("label",{className:"text-sm text-gray-300 block",children:["Location",f.jsx("input",{type:"text",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:A.location??"",onChange:te=>re("location",te.target.value)})]}),W&&f.jsx("p",{className:"text-sm text-red-400",children:W}),f.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[f.jsx("button",{type:"button",onClick:()=>{R(null),J(null)},className:"px-4 py-2 rounded-md bg-gray-700 text-white hover:bg-gray-600",children:"Cancel"}),f.jsx("button",{type:"submit",disabled:$,className:"px-4 py-2 rounded-md bg-cyan-600 text-white hover:bg-cyan-500 disabled:opacity-60",children:$?"Saving...":"Save Changes"})]})]})]})}),q&&f.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-md p-6",children:[f.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete Inventory Item"}),f.jsxs("p",{className:"text-sm text-gray-300",children:["Are you sure you want to remove ",f.jsx("span",{className:"text-white font-semibold",children:q.productName})," from inventory? This action cannot be undone."]}),W&&f.jsx("p",{className:"text-sm text-red-400 mt-3",children:W}),f.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[f.jsx("button",{onClick:()=>{V(null),J(null)},className:"px-4 py-2 rounded-md bg-gray-700 text-white hover:bg-gray-600",children:"Cancel"}),f.jsx("button",{onClick:ge,disabled:$,className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-500 disabled:opacity-60",children:$?"Deleting...":"Delete"})]})]})})]})]})},yf=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("circle",{cx:"9",cy:"21",r:"1"}),f.jsx("circle",{cx:"20",cy:"21",r:"1"}),f.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]}),Sw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),f.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Ew=t=>f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:f.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})}),Vl=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("polyline",{points:"3 6 5 6 21 6"}),f.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),f.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),f.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Tw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),f.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),f.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),f.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),f.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),_3=({summaries:t,onProductScanned:e,onClose:n})=>{const r=C.useRef(null),a=C.useRef(null),o=C.useRef(null),[c,d]=C.useState("SCANNING"),[p,h]=C.useState(null),[x,v]=C.useState(null),w=C.useMemo(()=>t.map(U=>U.productName),[t]),_=C.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=null)},[]),E=C.useCallback(async()=>{if(!r.current||!a.current||document.hidden)return;const U=r.current,R=a.current;R.width=U.videoWidth,R.height=U.videoHeight;const A=R.getContext("2d");A&&(A.drawImage(U,0,0,U.videoWidth,U.videoHeight),R.toBlob(async k=>{if(k&&o.current)try{const q=await ih(k,w);q?(h(q),d("DETECTED"),e(q),_(),setTimeout(()=>{d("SCANNING"),h(null),o.current=window.setInterval(E,2e3)},2500)):d("NO_PRODUCT")}catch(q){console.warn("Scan failed:",q),d("ERROR")}},"image/jpeg",.8))},[w,e,_]);C.useEffect(()=>{let U=null;return(async()=>{try{U=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),r.current&&(r.current.srcObject=U),_(),o.current=window.setInterval(E,2e3)}catch(A){console.error("Error accessing camera:",A),v("Could not access the camera. Please ensure permissions are granted."),d("ERROR")}})(),()=>{_(),U&&U.getTracks().forEach(A=>A.stop())}},[E,_]);const N=()=>{switch(c){case"SCANNING":return{message:"Point camera at a product",color:"border-gray-500"};case"DETECTED":return{message:`${p} added to cart!`,color:"border-green-500 animate-pulse-border"};case"NO_PRODUCT":return{message:"Searching for product...",color:"border-yellow-500"};case"ERROR":return{message:"Scanner error. Please try again.",color:"border-red-500"};default:return{message:"",color:"border-transparent"}}},{message:I,color:P}=N();return f.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center","aria-modal":"true",children:[f.jsx("style",{children:`
            @keyframes pulse-border {
                0%, 100% { box-shadow: 0 0 0 0 rgba(4, 120, 87, 0.7); }
                50% { box-shadow: 0 0 0 10px rgba(4, 120, 87, 0); }
            }
            .animate-pulse-border {
                animation: pulse-border 1.5s infinite;
            }
        `}),f.jsxs("div",{className:`relative w-full max-w-4xl aspect-video bg-black rounded-lg overflow-hidden border-4 ${P} transition-all`,children:[f.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),f.jsx("canvas",{ref:a,className:"hidden"})]}),f.jsxs("div",{className:"mt-4 text-center",children:[f.jsx("p",{className:"text-white text-lg font-semibold",children:I}),x&&f.jsx("p",{className:"text-red-400 text-sm mt-1",children:x})]}),f.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-30","aria-label":"Close scanner",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),f.jsx("button",{onClick:n,className:"mt-8 px-8 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors shadow-lg",children:"Done Scanning"})]})},Cx=1.4,S3=({summaries:t,onPurchase:e})=>{const[n,r]=C.useState([]),[a,o]=C.useState(!1),[c,d]=C.useState("All"),[p,h]=C.useState(!1),x=C.useMemo(()=>t.map(A=>({...A,price:A.averageCostPerUnit*Cx})).filter(A=>c==="All"?!0:A.category===c),[t,c]),v=C.useMemo(()=>{const A=new Set(t.map(k=>k.category));return["All",...Array.from(A)]},[t]),w=A=>{r(k=>{const q=k.find(V=>V.productName===A.productName);if(q){const V=P(A.productName);return q.quantity>=V?k:k.map(W=>W.productName===A.productName?{...W,quantity:W.quantity+1}:W)}return[...k,{productName:A.productName,quantity:1,price:A.price}]})},_=(A,k)=>{r(q=>q.map(W=>W.productName===A?{...W,quantity:W.quantity+k}:W).filter(W=>W.quantity>0))},E=A=>{r(k=>k.filter(q=>q.productName!==A))},N=C.useMemo(()=>n.reduce((A,k)=>A+k.price*k.quantity,0),[n]),I=()=>{e(n.map(({productName:A,quantity:k})=>({productName:A,quantity:k}))),r([]),o(!0),setTimeout(()=>o(!1),4e3)},P=A=>{var k;return((k=t.find(q=>q.productName===A))==null?void 0:k.totalQuantity)||0},U=A=>{var k;return((k=n.find(q=>q.productName===A))==null?void 0:k.quantity)||0},R=A=>{const k=t.find(q=>q.productName===A);if(k){const q={...k,price:k.averageCostPerUnit*Cx};w(q)}};return f.jsxs(f.Fragment,{children:[p&&f.jsx(_3,{summaries:t,onProductScanned:R,onClose:()=>h(!1)}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"lg:col-span-2",children:[f.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4",children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Welcome to the Kiosk"}),f.jsxs("button",{onClick:()=>h(!0),className:"flex items-center justify-center gap-2 py-2 px-4 border border-cyan-600 rounded-md shadow-sm text-sm font-medium text-cyan-400 bg-cyan-900/30 hover:bg-cyan-900/60 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:[f.jsx(Tw,{className:"w-5 h-5"}),"Scan Item to Add"]})]}),f.jsx("div",{className:"mb-6",children:f.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(A=>f.jsx("button",{onClick:()=>d(A),className:`px-4 py-2 text-sm font-medium rounded-full transition-colors ${c===A?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:A},A))})}),x.length===0?f.jsx("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:f.jsx("p",{children:"There are no products available in this category. Please check back later."})}):f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:x.map(A=>{const k=U(A.productName),q=A.totalQuantity,V=k<q;return f.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700 overflow-hidden flex flex-col",children:[f.jsxs("div",{className:"p-4 flex-grow",children:[f.jsx("div",{className:"flex justify-center items-center h-24 w-24 bg-gray-700/50 rounded-lg mx-auto mb-4",children:f.jsx(uw,{className:"w-12 h-12 text-gray-500"})}),f.jsx("h3",{className:"font-semibold text-white truncate",children:A.productName}),f.jsx("p",{className:"text-sm text-gray-400 mb-2 truncate",children:A.manufacturer}),f.jsxs("p",{className:"text-xl font-bold text-cyan-400",children:["$",A.price.toFixed(2)]})]}),f.jsx("div",{className:"p-4 bg-gray-900/50",children:f.jsxs("button",{onClick:()=>w(A),disabled:!V,className:"w-full flex items-center justify-center gap-2 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all disabled:bg-gray-600 disabled:cursor-not-allowed",children:[f.jsx(yf,{className:"w-5 h-5"}),V?"Add to Cart":"Out of Stock"]})})]},A.productName)})})]}),f.jsx("div",{className:"lg:col-span-1",children:f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 sticky top-28",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(yf,{className:"w-6 h-6 text-cyan-400"}),"Your Cart"]}),a&&f.jsxs("div",{className:"bg-green-800/50 border border-green-600 text-green-300 p-4 rounded-lg mb-4 text-center",children:[f.jsx("h3",{className:"font-bold",children:"Purchase Successful!"}),f.jsx("p",{className:"text-sm",children:"Thank you for your order."})]}),n.length>0?f.jsxs("div",{className:"space-y-4",children:[f.jsx("ul",{className:"space-y-3 max-h-80 overflow-y-auto pr-2 -mr-2",children:n.map(A=>f.jsxs("li",{className:"flex items-center gap-4 text-sm",children:[f.jsxs("div",{className:"flex-grow",children:[f.jsx("p",{className:"font-medium text-white truncate",children:A.productName}),f.jsxs("p",{className:"text-gray-400",children:["$",A.price.toFixed(2)]})]}),f.jsxs("div",{className:"flex items-center gap-1 bg-gray-700/50 rounded-md",children:[f.jsx("button",{onClick:()=>_(A.productName,-1),className:"p-1 text-gray-300 hover:text-white",children:f.jsx(Ew,{className:"w-4 h-4"})}),f.jsx("span",{className:"font-bold text-white px-1",children:A.quantity}),f.jsx("button",{onClick:()=>_(A.productName,1),disabled:A.quantity>=P(A.productName),className:"p-1 text-gray-300 hover:text-white disabled:text-gray-600",children:f.jsx(Sw,{className:"w-4 h-4"})})]}),f.jsx("button",{onClick:()=>E(A.productName),className:"p-1 text-gray-400 hover:text-red-400",children:f.jsx(Vl,{className:"w-4 h-4"})})]},A.productName))}),f.jsxs("div",{className:"border-t border-gray-700 pt-4 space-y-4",children:[f.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[f.jsx("span",{className:"text-gray-300",children:"Total:"}),f.jsxs("span",{className:"text-white",children:["$",N.toFixed(2)]})]}),f.jsx("button",{onClick:I,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Checkout"})]})]}):f.jsx("p",{className:"text-center text-gray-500 py-8",children:"Your cart is empty."})]})})]})]})},E3=({summaries:t,onClose:e,onListProduct:n})=>{const[r,a]=C.useState(""),[o,c]=C.useState(1),[d,p]=C.useState(0),[h,x]=C.useState(""),v=t.find(E=>E.productName===r),w=(v==null?void 0:v.totalQuantity)||0,_=E=>{if(E.preventDefault(),x(""),!r||o<=0||d<=0){x("Please fill all fields with valid values.");return}if(o>w){x(`Quantity cannot exceed available stock of ${w}.`);return}n(r,o,d)};return f.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-center justify-center p-4",onClick:e,children:f.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-full max-w-lg",onClick:E=>E.stopPropagation(),children:[f.jsxs("div",{className:"p-6 border-b border-gray-700 flex justify-between items-center",children:[f.jsx("h2",{className:"text-2xl font-bold text-white",children:"List Product on Marketplace"}),f.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"product",className:"block text-sm font-medium text-gray-300",children:"Product"}),f.jsxs("select",{id:"product",value:r,onChange:E=>a(E.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm",children:[f.jsx("option",{value:"",children:"Select a product..."}),t.map(E=>f.jsxs("option",{value:E.productName,children:[E.productName," (In Stock: ",E.totalQuantity,")"]},E.productName))]})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-300",children:"Quantity to List"}),f.jsx("input",{type:"number",id:"quantity",value:o,onChange:E=>c(Math.max(1,parseInt(E.target.value)||1)),min:"1",max:w,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm"})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-300",children:"Price per Unit ($)"}),f.jsx("input",{type:"number",id:"price",value:d,onChange:E=>p(parseFloat(E.target.value)||0),min:"0.01",step:"0.01",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm"})]}),h&&f.jsx("p",{className:"text-red-400 text-sm",children:h}),f.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[f.jsx("button",{type:"button",onClick:e,className:"py-2 px-4 border border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-300 bg-gray-700/50 hover:bg-gray-700",children:"Cancel"}),f.jsx("button",{type:"submit",className:"py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700",children:"List Product"})]})]})]})})},T3=({summaries:t,user:e,onPurchase:n})=>{const[r,a]=C.useState([]),[o,c]=C.useState([]),[d,p]=C.useState(!0),[h,x]=C.useState(null),[v,w]=C.useState(!1),[_,E]=C.useState("peer"),[N,I]=C.useState([]),[P,U]=C.useState(!1),[R,A]=C.useState(null),k=C.useCallback(async()=>{if(!e.isVerified){p(!1);return}p(!0),x(null);try{const[$,ce]=await Promise.all([DD(e),Iv()]);a($),c(ce)}catch($){x($ instanceof Error?$.message:"Failed to load marketplace data.")}finally{p(!1)}},[e]),q=C.useCallback(async()=>{if(ds){U(!0),A(null);try{const $=await $b();I($)}catch($){A($ instanceof Error?$.message:"Failed to load DAN offers.")}finally{U(!1)}}},[]);C.useEffect(()=>{k()},[k]),C.useEffect(()=>{ds&&_==="dan"&&q()},[_,q]);const V=async($,ce,ue)=>{if(!t.find(Ve=>Ve.productName===$))return;const _e=$.toLowerCase().replace(/ /g,"-");await Av({productId:_e,productName:$,quantity:ce,price:ue}),w(!1),k()},W=$=>{alert(`Signal sent! Coordinate with ${$.shopName||$.shopId} to fulfill ${$.productName}.`)},J=$=>{const ce=prompt(`How many units of ${$.productName} would you like to buy? (Available: ${$.quantity})`,"1");if(ce){const ue=parseInt(ce,10);!isNaN(ue)&&ue>0&&ue<=$.quantity?(n($,ue),alert(`Successfully purchased ${ue} ${$.productName}! It has been added to your inventory.`)):alert("Invalid quantity entered.")}};return e.isVerified?f.jsxs(f.Fragment,{children:[v&&f.jsx(E3,{summaries:t,onClose:()=>w(!1),onListProduct:V}),f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Marketplace"}),f.jsx("p",{className:"text-lg text-gray-400",children:"Buy and sell inventory with other verified shops in the network."})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[f.jsx("div",{className:"lg:col-span-4",children:f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"My Listings"}),f.jsx("button",{onClick:()=>w(!0),className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:"List a Product"}),f.jsx("div",{className:"mt-4 space-y-3 max-h-96 overflow-y-auto",children:o.length>0?o.map($=>f.jsxs("div",{className:"p-3 bg-gray-900/50 rounded-md text-sm",children:[f.jsx("p",{className:"font-semibold text-white",children:$.productName}),f.jsxs("p",{className:"text-gray-400",children:[$.quantity," units at $",$.price.toFixed(2),"/each"]})]},$.id)):f.jsx("p",{className:"text-center text-gray-500 py-4",children:"You haven't listed any products."})})]})}),f.jsx("div",{className:"lg:col-span-8",children:f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:_==="dan"?"DAN Offers":"Peer Offerings"}),ds&&f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>E("peer"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${_==="peer"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Peer Network"}),f.jsx("button",{onClick:()=>E("dan"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${_==="dan"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"DAN Offers Only"})]})]}),_==="peer"&&f.jsxs(f.Fragment,{children:[d&&f.jsx("p",{className:"text-cyan-400 mt-4",children:"Loading peer listings..."}),h&&f.jsx("p",{className:"text-red-400 mt-4",children:h}),!d&&!h&&f.jsx("div",{className:"space-y-6 mt-4",children:r.map($=>f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-bold text-cyan-400",children:$.name}),f.jsx("div",{className:"mt-2 divide-y divide-gray-700 border-t border-b border-gray-700",children:$.listings.map(ce=>f.jsxs("div",{className:"p-3 grid grid-cols-1 md:grid-cols-4 gap-4 items-center",children:[f.jsxs("div",{children:[f.jsx("p",{className:"font-semibold text-white",children:ce.productName}),f.jsx("p",{className:"text-xs text-gray-400",children:ce.manufacturer})]}),f.jsx("div",{className:"text-sm",children:f.jsxs("p",{className:"text-gray-300",children:[ce.quantity," ",ce.quantityType]})}),f.jsx("div",{className:"text-sm font-bold",children:f.jsxs("p",{className:"text-white",children:["$",ce.price.toFixed(2)]})}),f.jsx("div",{children:f.jsx("button",{onClick:()=>J(ce),className:"w-full md:w-auto text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Buy"})})]},ce.listingId))})]},$.id))})]}),_==="dan"&&ds&&f.jsxs("div",{className:"mt-4 space-y-4",children:[P&&f.jsx("p",{className:"text-indigo-300",children:"Syncing DAN offers..."}),R&&f.jsx("p",{className:"text-red-400",children:R}),!P&&!R&&f.jsx(f.Fragment,{children:N.filter($=>$.shopId!==(e.shopId||e.clientId)).length===0?f.jsx("p",{className:"text-gray-400",children:"No external DAN offers yet. Encourage peers to opt-in sharing from Inventory > Manual Entry."}):f.jsx("div",{className:"grid grid-cols-1 gap-4",children:N.filter($=>$.shopId!==(e.shopId||e.clientId)).map($=>{var ce;return f.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 bg-gray-900/40",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-lg font-semibold text-white",children:$.productName}),f.jsxs("p",{className:"text-xs text-gray-400",children:["From ",$.shopName||$.shopId]})]}),f.jsx("span",{className:"text-xs px-2 py-1 rounded-full border border-indigo-400 text-indigo-300",children:"DAN"})]}),f.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-3 text-sm text-gray-300",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Quantity"}),f.jsxs("p",{children:[$.quantity," units"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Expires"}),f.jsx("p",{children:new Date($.expirationDate).toLocaleDateString()})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Aisle Zone"}),f.jsx("p",{children:$.locationBucket||"Hidden"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Signal Hash"}),f.jsx("p",{className:"font-mono text-xs",children:((ce=$.proofHash)==null?void 0:ce.slice(0,12))??""})]})]}),f.jsxs("div",{className:"mt-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[f.jsx("div",{className:"text-sm text-gray-400",children:$.sellPrice?`Listed at $${$.sellPrice.toFixed(2)} / unit`:"Price shared privately"}),f.jsx("button",{onClick:()=>W($),className:"w-full md:w-auto text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:"Signal Interest"})]})]},$.inventoryUuid)})})})]})]})})]})]})]}):f.jsxs("div",{className:"text-center bg-gray-800/50 p-12 rounded-lg border border-gray-700",children:[f.jsx("h1",{className:"text-2xl font-bold text-yellow-400",children:"Verification Pending"}),f.jsx("p",{className:"text-lg text-gray-400 mt-2",children:"Your shop is awaiting verification by the network admin."}),f.jsx("p",{className:"text-gray-500 mt-4",children:"Once verified, you will be able to access the peer-to-peer marketplace here."}),f.jsx("p",{className:"text-gray-500 mt-1",children:'Navigate to the "Backend" tab to simulate the admin view and verify this shop.'})]})},N3=()=>{const[t,e]=C.useState([]),[n,r]=C.useState([]),[a,o]=C.useState([]),[c,d]=C.useState([]),[p,h]=C.useState(!0),[x,v]=C.useState(new Date),w=C.useCallback(async()=>{h(!0);const[N,I,P,U]=await Promise.all([ED(),TD(),ND(),CD()]);e(N),r(I),o(P),d(U),h(!1)},[]);C.useEffect(()=>{w()},[w,x]);const _=async N=>{await AD(N),v(new Date)},E=async N=>{await ID(N),v(new Date)};return f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Backend Admin Panel"}),f.jsx("p",{className:"text-lg text-gray-400",children:"Simulated proxy server for verifying new shops and drivers."})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Pending Shop Verifications (",t.length,")"]}),f.jsx("button",{onClick:()=>v(new Date),className:"text-sm text-cyan-400 hover:text-cyan-300",children:"Refresh"})]}),p?f.jsx("p",{className:"text-center text-gray-400",children:"Loading..."}):t.length===0?f.jsx("p",{className:"text-center text-gray-500 py-8",children:"No shops are awaiting verification."}):f.jsx(_l,{users:t,onVerify:_})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4",children:["Pending Driver Verifications (",a.length,")"]}),p?f.jsx("p",{className:"text-center text-gray-400",children:"Loading..."}):a.length===0?f.jsx("p",{className:"text-center text-gray-500 py-8",children:"No drivers are awaiting verification."}):f.jsx(_l,{users:a,onVerify:E,isDriverTable:!0})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Active Network Participants"}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("h3",{className:"text-lg font-semibold text-cyan-400",children:["Verified Shops (",n.length,")"]}),n.length>0?f.jsx(_l,{users:n}):f.jsx("p",{className:"text-gray-500 text-sm",children:"No verified shops."}),f.jsxs("h3",{className:"text-lg font-semibold text-cyan-400 mt-6",children:["Verified Drivers (",c.length,")"]}),c.length>0?f.jsx(_l,{users:c,isDriverTable:!0}):f.jsx("p",{className:"text-gray-500 text-sm",children:"No verified drivers."})]})]}),f.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-cyan-800/50",children:[f.jsx("h4",{className:"font-semibold text-cyan-500",children:"How this simulation works:"}),f.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'When a new user registers, they appear in the appropriate "Pending" list. Clicking "Verify" updates a shared `localStorage` value. The main application is continuously polling for this change. Once it detects it has been verified, it will automatically unlock the relevant features (Marketplace, Orders, or Driver panel).'})]})]})},_l=({users:t,onVerify:e,isDriverTable:n})=>f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[f.jsx("thead",{className:"bg-gray-800",children:f.jsxs("tr",{children:[f.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-6",children:n?"Name":"Company"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Email"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Client ID"}),e&&f.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:f.jsx("span",{className:"sr-only",children:"Verify"})})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700 bg-gray-900/50",children:t.map(r=>f.jsxs("tr",{children:[f.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-6",children:r.companyName}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:r.email}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500 font-mono text-xs",children:r.clientId}),e&&f.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:f.jsx("button",{onClick:()=>e(r.clientId),className:"py-1 px-3 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-green-600 hover:bg-green-700",children:"Verify"})})]},r.clientId))})]})}),Nw=C.createContext(void 0),C3=({children:t})=>{const[e,n]=C.useState(()=>{if(typeof window<"u"){const r=sessionStorage.getItem("current_shop");return r?JSON.parse(r):null}return null});return C.useEffect(()=>{typeof window<"u"&&(e?sessionStorage.setItem("current_shop",JSON.stringify(e)):sessionStorage.removeItem("current_shop"))},[e]),f.jsx(Nw.Provider,{value:{currentShop:e,setCurrentShop:n},children:t})},oh=()=>{const t=C.useContext(Nw);if(t===void 0)throw new Error("useShopContext must be used within a ShopContextProvider");return t},Cw=C.createContext(void 0),A3=({children:t,initialCustomer:e})=>{const[n,r]=C.useState(()=>{if(e)return e;if(typeof window<"u"){const c=sessionStorage.getItem("customer_profile");return c?JSON.parse(c):null}return null});C.useEffect(()=>{e&&r(c=>(c==null?void 0:c.user.clientId)===e.user.clientId?c:e)},[e]),C.useEffect(()=>{typeof window<"u"&&(n?sessionStorage.setItem("customer_profile",JSON.stringify(n)):sessionStorage.removeItem("customer_profile"))},[n]);const a=c=>{r(c)},o=()=>{r(null)};return f.jsx(Cw.Provider,{value:{customer:n,setCustomer:a,clearCustomer:o},children:t})},Aw=()=>{const t=C.useContext(Cw);if(t===void 0)throw new Error("useCustomerContext must be used within a CustomerContextProvider");return t},Ax=({onShopSelected:t,showQRScanner:e=!1})=>{const{currentShop:n,setCurrentShop:r}=oh(),[a,o]=C.useState([]),[c,d]=C.useState(!0),[p,h]=C.useState(!1),[x,v]=C.useState(""),{showToast:w}=gs();C.useEffect(()=>{_()},[]);const _=async()=>{try{d(!0);const I=await _v();o(I)}catch(I){console.error("Failed to load shops:",I),w("Failed to load shops","error")}finally{d(!1)}},E=I=>{r(I),w(`Selected shop: ${I.name}`,"success"),t&&t()},N=async()=>{if(!x.trim()){w("Please enter a shop ID","error");return}try{const I=await Sv(x.trim());I?(E(I),v(""),h(!1)):w("Shop not found. Please check the QR code.","error")}catch(I){console.error("Error validating shop:",I),w("Failed to validate shop","error")}};return n?f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Current Shop"}),f.jsx("p",{className:"text-gray-300",children:n.name})]}),f.jsx("button",{onClick:()=>r(null),className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Change Shop"})]})}):f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Select a Shop"}),e&&f.jsxs("div",{className:"mb-6",children:[f.jsxs("button",{onClick:()=>h(!p),className:"w-full flex items-center justify-center gap-3 py-3 px-6 border border-transparent rounded-lg shadow-lg text-base font-semibold text-white bg-cyan-600 hover:bg-cyan-700 transition-all mb-4",children:[f.jsx(Tw,{className:"w-5 h-5"}),p?"Hide QR Scanner":"Scan Shop QR Code"]}),p&&f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4",children:[f.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Enter shop ID from QR code:"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"text",value:x,onChange:I=>v(I.target.value),onKeyPress:I=>I.key==="Enter"&&N(),placeholder:"Shop ID",className:"flex-1 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsx("button",{onClick:N,className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold transition",children:"Go"})]})]})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Or Browse Shops"}),c?f.jsxs("div",{className:"text-center py-8",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400 mx-auto"}),f.jsx("p",{className:"text-gray-400 mt-2",children:"Loading shops..."})]}):a.length===0?f.jsx("div",{className:"text-center py-8",children:f.jsx("p",{className:"text-gray-400",children:"No shops available"})}):f.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.map(I=>f.jsxs("button",{onClick:()=>E(I),className:"w-full text-left px-4 py-3 bg-gray-900/50 border border-gray-700 rounded-lg hover:bg-gray-900 hover:border-cyan-600 transition text-white",children:[f.jsx("div",{className:"font-semibold",children:I.name}),I.contactEmail&&f.jsx("div",{className:"text-sm text-gray-400",children:I.contactEmail})]},I.id))})]})]})},Iw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),f.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),I3=({cart:t,totalPrice:e,shopId:n,customerId:r,onComplete:a,onCancel:o})=>{const[c,d]=C.useState(!1),[p,h]=C.useState(!1),{showToast:x}=gs(),v=async()=>{try{d(!0);const w=await Zl(),_=new Map(w.map(N=>[N.productName,{id:N.productId,name:N.productName}])),E=t.map(N=>({productName:N.productName,quantity:N.quantity}));qa({id:n,name:null,contactEmail:null,location:null,qdrantNamespace:null});try{await Wf(E,_)}finally{qa(null)}h(!0),x("Purchase completed successfully!","success"),setTimeout(()=>{a()},2e3)}catch(w){console.error("Purchase error:",w),x("Purchase failed: "+(w instanceof Error?w.message:"Unknown error"),"error"),d(!1)}};return p?f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:[f.jsx(Iw,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Purchase Complete!"}),f.jsx("p",{className:"text-gray-400",children:"Thank you for your purchase"})]}):f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Checkout"}),f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4 mb-4",children:[f.jsx("h3",{className:"font-semibold text-white mb-3",children:"Order Summary"}),f.jsx("div",{className:"space-y-2",children:t.map(w=>f.jsxs("div",{className:"flex justify-between text-sm",children:[f.jsxs("span",{className:"text-gray-300",children:[w.productName," x ",w.quantity]}),f.jsxs("span",{className:"text-white font-semibold",children:["$",(w.price*w.quantity).toFixed(2)]})]},w.productId))}),f.jsxs("div",{className:"border-t border-gray-700 mt-3 pt-3 flex justify-between",children:[f.jsx("span",{className:"text-lg font-semibold text-white",children:"Total"}),f.jsxs("span",{className:"text-xl font-bold text-cyan-400",children:["$",e.toFixed(2)]})]})]}),f.jsxs("div",{className:"mb-4",children:[f.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Payment Method"}),f.jsx("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-3",children:f.jsx("p",{className:"text-gray-300 text-sm",children:"Cash / Card at pickup"})})]}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("button",{onClick:o,disabled:c,className:"flex-1 py-3 px-4 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition disabled:opacity-50",children:"Cancel"}),f.jsx("button",{onClick:v,disabled:c,className:"flex-1 py-3 px-4 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition disabled:opacity-50",children:c?"Processing...":"Complete Purchase"})]})]})},R3=({cart:t,onUpdateQuantity:e,onRemoveItem:n,totalPrice:r,shopId:a,onPurchaseComplete:o})=>{const{customer:c}=Aw(),[d,p]=C.useState(!1);return d?f.jsx(I3,{cart:t,totalPrice:r,shopId:a,customerId:(c==null?void 0:c.user.customerId)||(c==null?void 0:c.user.clientId),onComplete:o,onCancel:()=>p(!1)}):f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 sticky top-4",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(yf,{className:"w-6 h-6 text-cyan-400"}),f.jsx("h2",{className:"text-xl font-bold text-white",children:"Cart"}),t.length>0&&f.jsx("span",{className:"bg-cyan-600 text-white text-xs font-semibold px-2 py-1 rounded-full",children:t.length})]}),t.length===0?f.jsxs("div",{className:"text-center py-8",children:[f.jsx("p",{className:"text-gray-400",children:"Your cart is empty"}),f.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Add items to get started"})]}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto mb-4",children:t.map(h=>f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-3",children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"font-semibold text-white text-sm",children:h.productName}),f.jsxs("p",{className:"text-xs text-gray-400",children:["$",h.price.toFixed(2)," each"]})]}),f.jsx("button",{onClick:()=>n(h.productId),className:"text-gray-400 hover:text-red-400 transition","aria-label":"Remove item",children:f.jsx(Vl,{className:"w-4 h-4"})})]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:()=>e(h.productId,-1),className:"p-1 bg-gray-700 hover:bg-gray-600 rounded text-white transition","aria-label":"Decrease quantity",children:f.jsx(Ew,{className:"w-4 h-4"})}),f.jsx("span",{className:"text-white font-semibold w-8 text-center",children:h.quantity}),f.jsx("button",{onClick:()=>e(h.productId,1),className:"p-1 bg-gray-700 hover:bg-gray-600 rounded text-white transition","aria-label":"Increase quantity",children:f.jsx(Sw,{className:"w-4 h-4"})})]}),f.jsxs("p",{className:"text-cyan-400 font-semibold",children:["$",(h.price*h.quantity).toFixed(2)]})]})]},h.productId))}),f.jsxs("div",{className:"border-t border-gray-700 pt-4 space-y-3",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("span",{className:"text-lg font-semibold text-white",children:"Total"}),f.jsxs("span",{className:"text-2xl font-bold text-cyan-400",children:["$",r.toFixed(2)]})]}),f.jsx("button",{onClick:()=>{if(!c){alert("Please log in to checkout");return}p(!0)},className:"w-full py-3 px-4 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition",children:c?"Checkout":"Login to Checkout"})]})]})]})},D3=()=>{const{currentShop:t,setCurrentShop:e}=oh(),[n,r]=C.useState([]),[a,o]=C.useState([]),[c,d]=C.useState([]),[p,h]=C.useState(!0),{showToast:x}=gs();C.useEffect(()=>{t&&v()},[t]);const v=async()=>{if(t)try{h(!0);const U=(await Nv(t.id)).filter(A=>A.quantity>0&&(!A.status||A.status==="ACTIVE"));r(U);const R=await Zl();o(R)}catch(P){console.error("Failed to load inventory:",P),x("Failed to load inventory","error")}finally{h(!1)}},w=P=>{const U=a.find(R=>R.productId===P);return(U==null?void 0:U.productName)||"Unknown Product"},_=P=>{const U=w(P.productId),R=c.find(A=>A.productId===P.productId);if(R)R.quantity<P.quantity?(d(c.map(A=>A.productId===P.productId?{...A,quantity:A.quantity+1}:A)),x(`Added ${U} to cart`,"success")):x(`Only ${P.quantity} available`,"warning");else{const A=P.sellPrice||P.costPerUnit*1.4;d([...c,{productId:P.productId,productName:U,quantity:1,price:A,stockItem:P}]),x(`Added ${U} to cart`,"success")}},E=(P,U)=>{d(c.map(R=>{if(R.productId===P){const A=R.quantity+U,k=R.stockItem.quantity;return A<=0?null:A>k?(x(`Only ${k} available`,"warning"),R):{...R,quantity:A}}return R}).filter(Boolean))},N=P=>{d(c.filter(U=>U.productId!==P))};if(!t)return f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-gray-400",children:"Please select a shop to start shopping"})});const I=c.reduce((P,U)=>P+U.price*U.quantity,0);return f.jsxs("div",{className:"space-y-6",children:[f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold text-white",children:t.name}),t.contactEmail&&f.jsx("p",{className:"text-gray-400 text-sm",children:t.contactEmail})]}),f.jsx("button",{onClick:()=>{e(null),d([])},className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition whitespace-nowrap",children:"Change Shop"})]})}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx("div",{className:"lg:col-span-2",children:f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Available Products"}),p?f.jsxs("div",{className:"text-center py-12",children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto"}),f.jsx("p",{className:"text-gray-400 mt-4",children:"Loading inventory..."})]}):n.length===0?f.jsx("div",{className:"text-center py-12",children:f.jsx("p",{className:"text-gray-400",children:"No products available at this shop"})}):f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(P=>{const U=w(P.productId),R=P.sellPrice||P.costPerUnit*1.4,A=c.find(q=>q.productId===P.productId),k=A!==void 0;return f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4 hover:border-cyan-600 transition",children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"font-semibold text-white",children:U}),f.jsxs("p",{className:"text-sm text-gray-400",children:[P.quantity," ",P.quantityType||"units"," available"]})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("p",{className:"text-lg font-bold text-cyan-400",children:["$",R.toFixed(2)]}),P.expirationDate&&f.jsxs("p",{className:"text-xs text-gray-500",children:["Exp: ",new Date(P.expirationDate).toLocaleDateString()]})]})]}),f.jsx("button",{onClick:()=>_(P),disabled:P.quantity===0||k&&A.quantity>=P.quantity,className:`w-full py-2 px-4 rounded-lg font-semibold transition ${P.quantity===0||k&&A.quantity>=P.quantity?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-cyan-600 hover:bg-cyan-700 text-white"}`,children:k?`In Cart (${A.quantity})`:"Add to Cart"})]},P.id)})})]})}),f.jsx("div",{className:"lg:col-span-1",children:f.jsx(R3,{cart:c,onUpdateQuantity:E,onRemoveItem:N,totalPrice:I,shopId:t.id,onPurchaseComplete:()=>{d([]),v()}})})]})]})},M3=({name:t})=>{const[e,n]=C.useState([]),[r,a]=C.useState([]),[o,c]=C.useState(""),[d,p]=C.useState(!0),[h,x]=C.useState(!1),[v,w]=C.useState(null),[_,E]=C.useState(!1),[N,I]=C.useState(null),[P,U]=C.useState(""),R=C.useRef(!1);C.useEffect(()=>{let k=!1;const q=setTimeout(async()=>{const V=o.trim();x(!!V),!V&&!R.current&&p(!0);try{const W=await hf(V,30);if(k)return;V&&W.length===0?(w("No such product found!"),n([])):(n(W),w(null)),R.current=!0}catch(W){k||w(W instanceof Error?W.message:"Failed to load products.")}finally{k||(p(!1),x(!1))}},250);return()=>{k=!0,clearTimeout(q)}},[o]),C.useEffect(()=>{(async()=>{try{const q=await hf("",200);a(q)}catch(q){console.warn("Failed to preload scanner catalog",q)}})()},[]);const A=async k=>{E(!1),x(!0),w(null);try{const q=r.length>0?r:e,{identifyProductNameFromImage:V}=await cw(async()=>{const{identifyProductNameFromImage:$}=await Promise.resolve().then(()=>c3);return{identifyProductNameFromImage:$}},void 0),W=q.map($=>$.name),J=await V(k,W);if(J){const $=q.find(ce=>ce.name===J);$?(n([$]),U($.name),c($.name),I($),w(null)):(w("Product found in image but not in catalog."),n([]))}else w("Could not identify product from image. Please try again."),n([])}catch(q){w("Visual search failed: "+(q instanceof Error?q.message:"Unknown error"))}finally{x(!1)}};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("h1",{className:"text-3xl font-bold text-white mb-2",children:["Welcome, ",t,"!"]}),f.jsx("p",{className:"text-gray-300",children:"Search the live catalog to see if a product is available in nearby autonomous shops. You can search by name, manufacturer, category, or use the live visual search to find products by image."}),f.jsxs("div",{className:"mt-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[f.jsx("input",{type:"search",value:o,onChange:k=>c(k.target.value),placeholder:"Search products by name, category, or manufacturer...",className:"flex-1 px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsxs("button",{onClick:()=>E(!0),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-indigo-600 text-white font-semibold hover:bg-indigo-500",children:[f.jsx(Ga,{className:"w-5 h-5"}),"Live Visual Search"]})]}),(N||P)&&f.jsx("p",{className:"mt-3 text-sm text-cyan-300",children:P?f.jsxs(f.Fragment,{children:["Showing results for visual search: ",f.jsx("span",{className:"font-semibold",children:P})]}):f.jsxs(f.Fragment,{children:["Showing matches for ",f.jsx("span",{className:"font-semibold",children:N==null?void 0:N.name})," based on the latest scan."]})}),v&&f.jsx("p",{className:"mt-3 text-sm text-red-400",children:v})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Product Catalog"}),d?f.jsx("span",{className:"text-sm text-gray-400",children:"Loading catalog..."}):h?f.jsx("span",{className:"text-sm text-gray-400",children:"Searching"}):f.jsxs("span",{className:"text-sm text-gray-400",children:[e.length," result(s)"]})]}),d?f.jsx("p",{className:"text-gray-400",children:"Fetching catalog..."}):e.length===0&&o.trim()?f.jsx("p",{className:"text-gray-400",children:"No such product found! Try a different keyword or use the live visual search."}):e.length===0?f.jsx("p",{className:"text-gray-400",children:"No products available. Try searching or use the live visual search."}):f.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.map(k=>f.jsxs("div",{className:"p-4 rounded-lg bg-gray-900/60 border border-gray-700",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsx("h3",{className:"text-lg font-semibold text-white truncate",title:k.name,children:k.name}),k.category&&f.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-cyan-900/40 text-cyan-200 border border-cyan-700/40",children:k.category})]}),f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:k.manufacturer||"Unknown manufacturer"}),k.description&&f.jsx("p",{className:"text-xs text-gray-400 line-clamp-3",children:k.description})]},k.id))})]}),_&&f.jsx(Ha,{onDataScanned:k=>{const q=k.blobs.get("productName")||k.blobs.get("manufacturer")||Array.from(k.blobs.values())[0];q?A(q):(w("No image captured. Please try again."),E(!1))},onClose:()=>E(!1),productOptions:r.map(k=>({productId:k.id,productName:k.name})),mode:"visual-search"})]})},P3=({onLogout:t,name:e})=>{const{currentShop:n,setCurrentShop:r}=oh(),{customer:a,setCustomer:o,clearCustomer:c}=Aw(),[d,p]=C.useState(!1),[h,x]=C.useState("discovery"),{showToast:v}=gs(),w=E=>{var I;const N=E.user;if((I=N.roles)!=null&&I.shop||N.shopId){v("Shop account detected. Please sign in via the shop dashboard.","info"),p(!1);return}o(E),p(!1),v("Welcome! You can now checkout.","success")},_=()=>{c(),v("Logged out successfully","success"),t==null||t(),p(!1)};return C.useEffect(()=>{n&&x("shop")},[n]),f.jsxs("div",{className:"min-h-screen bg-gray-900",children:[f.jsx("div",{className:"bg-gray-800/50 border-b border-gray-700 p-4",children:f.jsxs("div",{className:"container mx-auto flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-xl font-bold text-white",children:"ShopNexus Customer"}),a&&f.jsxs("p",{className:"text-sm text-gray-400",children:["Logged in as ",a.user.companyName||a.user.email]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[n&&f.jsx("button",{onClick:()=>{r(null),x("discovery")},className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Change Shop"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>x("discovery"),className:`px-4 py-2 text-sm border rounded-lg transition ${h==="discovery"?"bg-cyan-600 text-white border-cyan-600":"text-gray-300 border-gray-600 hover:bg-gray-700"}`,children:"Browse Catalog"}),n&&f.jsx("button",{onClick:()=>x("shop"),className:`px-4 py-2 text-sm border rounded-lg transition ${h==="shop"?"bg-cyan-600 text-white border-cyan-600":"text-gray-300 border-gray-600 hover:bg-gray-700"}`,children:"Shop View"})]}),a?f.jsx("button",{onClick:_,className:"px-4 py-2 text-sm text-gray-300 hover:text-white border border-gray-600 rounded-lg hover:bg-gray-700 transition",children:"Logout"}):f.jsx("button",{onClick:()=>p(!0),className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Login"})]})]})}),f.jsx("div",{className:"container mx-auto p-4 md:p-8",children:d?f.jsxs("div",{className:"max-w-lg mx-auto",children:[f.jsx(lw,{onAuthenticated:w}),f.jsx("button",{onClick:()=>p(!1),className:"mt-4 w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition",children:"Cancel"})]}):h==="discovery"?f.jsxs(f.Fragment,{children:[!n&&f.jsx(Ax,{}),n&&f.jsx("div",{className:"mb-6",children:f.jsx(Ax,{})}),f.jsx(M3,{name:e||"Guest"})]}):f.jsx(D3,{})})]})},Ix=({name:t,initialProfile:e,onLogout:n})=>f.jsx(C3,{children:f.jsx(A3,{initialCustomer:e,children:f.jsx(P3,{name:t,onLogout:n})})}),k3=({name:t})=>{const[e,n]=C.useState([]),[r,a]=C.useState(!0),[o,c]=C.useState(""),[d,p]=C.useState(""),[h,x]=C.useState(null),v=async()=>{a(!0),x(null);try{const _=await Js();n(_)}catch(_){x(_ instanceof Error?_.message:"Failed to load suppliers.")}finally{a(!1)}};C.useEffect(()=>{v()},[]);const w=async _=>{if(_.preventDefault(),!o.trim()){x("Supplier name is required.");return}x(null);try{await Mi({name:o.trim(),contactEmail:d.trim()||void 0}),c(""),p(""),await v()}catch(E){x(E instanceof Error?E.message:"Failed to create supplier.")}};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Supplier Console"}),f.jsxs("p",{className:"text-gray-300",children:["Hello ",t,"! Manage your supplier network here. Register local suppliers (created by your shop) or review existing ones (local or global suppliers linked to registered users)."]})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Register Local Supplier"}),f.jsxs("form",{onSubmit:w,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Supplier Name"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:o,onChange:_=>c(_.target.value),required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Contact Email (optional)"}),f.jsx("input",{type:"email",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:d,onChange:_=>p(_.target.value)})]}),f.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold",children:"Add Supplier"})]}),h&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:h})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Suppliers"}),f.jsx("button",{onClick:v,className:"px-3 py-1.5 bg-gray-700 rounded-md text-sm text-white hover:bg-gray-600",children:"Refresh"})]}),r?f.jsx("p",{className:"text-gray-400",children:"Loading suppliers..."}):e.length===0?f.jsx("p",{className:"text-gray-500",children:"No suppliers yet. Add a local supplier above."}):f.jsx("div",{className:"space-y-3",children:e.map(_=>f.jsx("div",{className:"p-3 bg-gray-900/40 rounded-lg border border-gray-700 hover:bg-gray-900/60 transition-colors",children:f.jsx("div",{className:"flex items-start justify-between",children:f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("p",{className:"text-white font-semibold",children:_.name}),_.shopId?f.jsx("span",{className:"text-xs bg-cyan-600/20 text-cyan-400 px-2 py-1 rounded",children:"Local"}):_.linkedUserId?f.jsx("span",{className:"text-xs bg-green-600/20 text-green-400 px-2 py-1 rounded",children:"Global"}):null]}),_.contact&&f.jsx("p",{className:"text-sm text-gray-400 mt-1",children:_.contact}),_.linkedUserId&&f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Linked User ID: ",_.linkedUserId]}),_.shopId&&f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Shop ID: ",_.shopId]})]})})},_.id))})]})]})},U3=({onClose:t,onProductCreated:e})=>{const n=C.useRef(null),r=C.useRef(null),a=C.useRef(null),o=C.useRef(null),[c,d]=C.useState("scanning"),[p,h]=C.useState(null),[x,v]=C.useState({}),[w,_]=C.useState(new Set),[E,N]=C.useState(new Map),[I,P]=C.useState(null),[U,R]=C.useState(null),[A,k]=C.useState(null),[q,V]=C.useState(!1),W=C.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=null)},[]),J=C.useCallback(()=>{if(n.current&&a.current){const M=n.current,G=a.current,Z=M.getBoundingClientRect();G.width=Z.width,G.height=Z.height}},[]);C.useEffect(()=>{let M=null;return(async()=>{try{M=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),n.current&&(n.current.srcObject=M,n.current.onloadedmetadata=()=>J())}catch{h("Could not access camera. Please grant permissions.")}})(),window.addEventListener("resize",J),()=>{window.removeEventListener("resize",J),W(),M==null||M.getTracks().forEach(Z=>Z.stop())}},[J,W]);const $=C.useCallback(async()=>{if(!n.current||!r.current||document.hidden||c!=="scanning")return;const M=n.current,G=r.current;G.width=M.videoWidth,G.height=M.videoHeight;const Z=G.getContext("2d");if(!Z)return;Z.drawImage(M,0,0,M.videoWidth,M.videoHeight);const oe=await new Promise(se=>G.toBlob(se,"image/jpeg",.8));if(!(!oe||c!=="scanning"))try{const se=await tc(oe);v(D=>{const L={...D};for(const Q in se){const re=Q;w.has(re)||(L[re]=se[re])}return L})}catch(se){console.warn("Auto-scan failed:",se)}},[c,w]);C.useEffect(()=>{c==="scanning"&&!o.current?o.current=window.setInterval($,3500):c!=="scanning"&&W()},[c,$,W]);const ce=M=>{P(M),d("drawingBox"),R(null),k(null)},ue=M=>{var se;if(c!=="drawingBox"||!I)return;const G=(se=a.current)==null?void 0:se.getBoundingClientRect();if(!G)return;const Z=M.clientX-G.left,oe=M.clientY-G.top;if(!U)R({x:Z,y:oe});else{const D={x:Math.min(U.x,Z),y:Math.min(U.y,oe),width:Math.abs(Z-U.x),height:Math.abs(oe-U.y)};D.width>5&&D.height>5&&(k(D),Ce(D)),R(null)}},Ce=C.useCallback(async M=>{if(!n.current||!r.current||!I)return;d("analyzing");const G=n.current,Z=r.current,oe=G.videoWidth/G.clientWidth,se=G.videoHeight/G.clientHeight,D=M.x*oe,L=M.y*se,Q=M.width*oe,re=M.height*se;Z.width=Q,Z.height=re;const de=Z.getContext("2d");if(de){de.drawImage(G,D,L,Q,re,0,0,Q,re);const ge=await new Promise(te=>Z.toBlob(te,"image/jpeg",.9));if(ge){N(te=>new Map(te).set(I,ge));try{const te=await rh(ge,I);v(K=>({...K,[I]:te})),_(K=>new Set(K).add(I))}catch(te){h(te instanceof Error?te.message:"Analysis failed")}}}P(null),k(null),d("scanning")},[I]),_e=async()=>{const M=x;if(!M.productName||!M.manufacturer||!M.category){h("Product Name, Manufacturer, and Category are required to save."),d("scanning");return}V(!0),h(null);try{const G=await Di({name:M.productName,manufacturer:M.manufacturer,category:M.category,description:M.productDescription||""}),Z=Array.from(E.entries()).map(([oe,se])=>jf(G.name,oe,se,{productId:G.id,source:"manual"}));await Promise.all(Z),e(),t()}catch(G){h(G instanceof Error?G.message:"Failed to save product.")}finally{V(!1)}},Ve=()=>c==="scanning"?"Auto-scanning product... Tap screen to manually select a field.":c==="drawingBox"?U?"Tap the opposite corner to create a selection.":`Tap the first corner for ${cn[I].displayName}.`:c==="analyzing"?`Analyzing ${cn[I].displayName}...`:c==="verifying"?"Review the extracted data and confirm to save the new product.":"";return c==="verifying"?f.jsxs("div",{className:"fixed inset-0 bg-gray-900 z-50 p-4 sm:p-8 flex flex-col","aria-modal":"true",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Verify New Product"}),p&&f.jsx("p",{className:"bg-red-900/50 text-red-300 p-3 rounded-md mb-4",children:p}),f.jsx("div",{className:"flex-grow overflow-y-auto space-y-4 bg-gray-800/50 p-4 rounded-lg",children:Object.entries(x).map(([M,G])=>{var se;const Z=M,oe=E.get(Z);return f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-400",children:((se=cn[Z])==null?void 0:se.displayName)||M}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("input",{value:String(G),onChange:D=>v(L=>({...L,[Z]:D.target.value})),className:"flex-grow px-3 py-2 rounded-md bg-gray-700 border border-gray-600 text-white"}),oe&&f.jsx("img",{src:URL.createObjectURL(oe),alt:`Crop of ${M}`,className:"w-24 h-12 object-contain rounded-md bg-black"})]})]},M)})}),f.jsxs("div",{className:"flex-shrink-0 pt-6 flex justify-end gap-4",children:[f.jsx("button",{onClick:()=>d("scanning"),disabled:q,className:"px-6 py-2 rounded-md bg-gray-600 text-white font-semibold",children:"Back to Scanner"}),f.jsx("button",{onClick:_e,disabled:q,className:"px-6 py-2 rounded-md bg-cyan-600 text-white font-semibold",children:q?"Saving...":"Confirm & Save Product"})]})]}):f.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex","aria-modal":"true",children:[f.jsxs("div",{className:"flex-grow relative",children:[f.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),f.jsx("canvas",{ref:r,className:"hidden"}),f.jsx("canvas",{ref:a,className:"absolute inset-0 w-full h-full z-10",onClick:ue}),p&&f.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-red-800/80 text-white p-3 rounded-lg text-center z-30 max-w-md mx-auto",children:p}),f.jsx("div",{className:"absolute top-4 left-4 bg-black/50 text-white px-4 py-2 rounded-full z-20 text-center text-sm",children:Ve()})]}),f.jsxs("div",{className:"w-full md:w-96 bg-gray-900/80 backdrop-blur-sm border-l border-gray-700 flex flex-col p-4 space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("h2",{className:"text-xl font-bold text-white",children:"Learn Product"}),f.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:""})]}),f.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 pr-2",children:Object.keys(cn).map(M=>{const G=w.has(M),Z=x[M]!==void 0&&x[M]!==""&&x[M]!==0;return f.jsxs("button",{onClick:()=>ce(M),className:`w-full text-left p-3 rounded-md transition-colors flex items-center justify-between ${G?"bg-indigo-800/50":"bg-gray-700/50 hover:bg-gray-700"}`,children:[f.jsxs("div",{children:[f.jsx("span",{className:"font-semibold text-white",children:cn[M].displayName}),Z&&f.jsx("p",{className:"text-sm text-cyan-300 truncate",children:String(x[M])})]}),G&&f.jsx(bw,{className:"w-5 h-5 text-indigo-300 flex-shrink-0"})]},M)})}),f.jsx("div",{className:"flex-shrink-0",children:f.jsxs("button",{onClick:()=>d("verifying"),className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-cyan-600 text-white font-semibold rounded-md hover:bg-cyan-700 transition-colors",children:[f.jsx(Iw,{className:"w-6 h-6"}),"Verify & Save"]})})]})]})},j3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),f.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),O3=()=>{const[t,e]=C.useState([]),[n,r]=C.useState([]),[a,o]=C.useState(!0),[c,d]=C.useState(null),[p,h]=C.useState(""),[x,v]=C.useState(""),[w,_]=C.useState(""),[E,N]=C.useState(""),[I,P]=C.useState(void 0),[U,R]=C.useState(""),[A,k]=C.useState(!1),[q,V]=C.useState([]),[W,J]=C.useState(""),[$,ce]=C.useState(""),[ue,Ce]=C.useState(""),[_e,Ve]=C.useState(null),[M,G]=C.useState(null),[Z,oe]=C.useState(!1),{showToast:se}=gs(),D=async()=>{o(!0),d(null);try{const[K,he]=await Promise.all([Wl(),Js()]);e(K),r(K),V(he.map(ke=>({id:ke.id,name:ke.name||ke.id})))}catch(K){d(K instanceof Error?K.message:"Failed to load products.")}finally{o(!1)}};Rx.useEffect(()=>{let K=t;if(W.trim()){const he=W.toLowerCase();K=K.filter(ke=>ke.name.toLowerCase().includes(he)||ke.manufacturer.toLowerCase().includes(he)||ke.category.toLowerCase().includes(he)||ke.description&&ke.description.toLowerCase().includes(he))}$&&(K=K.filter(he=>he.category===$)),ue&&(K=K.filter(he=>he.manufacturer===ue)),r(K)},[t,W,$,ue]),C.useEffect(()=>{D()},[]);const L=()=>{D(),se("New product successfully learned and added to catalog!","success")},Q=async K=>{if(K.preventDefault(),!p.trim()){d("Name is required.");return}k(!0),d(null);try{const he=U?[{url:U.trim(),type:"manual",source:"user",addedAt:new Date().toISOString()}]:[];await Di({name:p,manufacturer:x,category:w,description:E,defaultSupplierId:I,images:he}),h(""),v(""),_(""),N(""),R(""),P(void 0),await D(),se("Product created successfully!","success")}catch(he){const ke=he instanceof Error?he.message:"Failed to create product.";d(ke),se(ke,"error")}finally{k(!1)}},re=K=>{var he,ke;Ve(K),h(K.name),v(K.manufacturer),_(K.category),N(K.description||""),R(((ke=(he=K.images)==null?void 0:he[0])==null?void 0:ke.url)||""),P(K.defaultSupplierId||void 0)},de=()=>{Ve(null),h(""),v(""),_(""),N(""),R(""),P(void 0),d(null)},ge=async K=>{if(K.preventDefault(),!_e||!p.trim()){d("Name is required.");return}k(!0),d(null);try{const he=U?[{url:U.trim(),type:"manual",source:"user",addedAt:new Date().toISOString()}]:[];await pv(_e.id,{name:p,manufacturer:x,category:w,description:E,defaultSupplierId:I,images:he}),de(),await D(),se("Product updated successfully!","success")}catch(he){const ke=he instanceof Error?he.message:"Failed to update product.";d(ke),se(ke,"error")}finally{k(!1)}},te=async K=>{try{await mv(K),G(null),await D(),se("Product deleted successfully!","success")}catch(he){const ke=he instanceof Error?he.message:"Failed to delete product.";se(ke,"error")}};return f.jsxs(f.Fragment,{children:[Z&&f.jsx(U3,{onClose:()=>oe(!1),onProductCreated:L}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h1",{className:"text-2xl font-bold text-white",children:"Product Catalog"}),f.jsxs("button",{onClick:()=>oe(!0),className:"flex items-center justify-center gap-3 py-3 px-6 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:[f.jsx(ww,{className:"w-6 h-6"}),"Scan & Train New Product"]})]}),f.jsx("p",{className:"text-gray-400 text-sm",children:"Use the AI scanner to learn new products. The system will extract all relevant information sections from the product image and learn where to look for specific data fields for future scans."})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:_e?"Edit Product":"Create Product Manually"}),f.jsxs("form",{onSubmit:_e?ge:Q,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Name"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:p,onChange:K=>h(K.target.value),required:!0})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Manufacturer"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:x,onChange:K=>v(K.target.value)})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Category"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:w,onChange:K=>_(K.target.value)})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Description"}),f.jsx("textarea",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:E,onChange:K=>N(K.target.value),rows:3})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Default Supplier"}),f.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:I||"",onChange:K=>P(K.target.value||void 0),children:[f.jsx("option",{value:"",children:"None"}),q.map(K=>f.jsx("option",{value:K.id,children:K.name},K.id))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Image URL"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:U,onChange:K=>R(K.target.value),placeholder:"https://example.com/photo.jpg"})]})]}),f.jsxs("div",{className:"flex space-x-3",children:[f.jsx("button",{type:"submit",disabled:A,className:"px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold disabled:opacity-60 hover:bg-cyan-700 transition-colors",children:A?_e?"Updating...":"Creating...":_e?"Update Product":"Create Product"}),_e&&f.jsx("button",{type:"button",onClick:de,disabled:A,className:"px-4 py-2 rounded-md bg-gray-700 text-white font-semibold disabled:opacity-60 hover:bg-gray-600 transition-colors",children:"Cancel"})]})]}),c&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:c})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"All Products"}),f.jsx("button",{onClick:D,className:"px-3 py-1.5 rounded-md bg-gray-700 text-sm text-white hover:bg-gray-600",children:"Refresh"})]}),f.jsxs("div",{className:"mb-6 space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Search Products"}),f.jsx("input",{type:"text",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",placeholder:"Search by name, manufacturer, category, or description...",value:W,onChange:K=>J(K.target.value)})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Filter by Category"}),f.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:$,onChange:K=>ce(K.target.value),children:[f.jsx("option",{value:"",children:"All Categories"}),Array.from(new Set(t.map(K=>K.category).filter(Boolean))).sort().map(K=>f.jsx("option",{value:K,children:K},K))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Filter by Manufacturer"}),f.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:ue,onChange:K=>Ce(K.target.value),children:[f.jsx("option",{value:"",children:"All Manufacturers"}),Array.from(new Set(t.map(K=>K.manufacturer).filter(Boolean))).sort().map(K=>f.jsx("option",{value:K,children:K},K))]})]})]})]}),a?f.jsx("p",{className:"text-gray-400",children:"Loading products..."}):n.length===0?f.jsxs("div",{className:"text-center py-12",children:[f.jsx(j3,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),f.jsx("p",{className:"text-gray-500 text-lg mb-2",children:t.length===0?"No products yet.":"No products match your filters."}),t.length===0&&f.jsx("button",{onClick:()=>oe(!0),className:"mt-4 px-6 py-3 rounded-md bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition-colors",children:"Scan Your First Product"})]}):f.jsxs("div",{className:"space-y-3",children:[f.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",n.length," of ",t.length," products"]}),n.map(K=>{var he;return f.jsxs("div",{className:"p-4 bg-gray-900/40 rounded-lg border border-gray-700 hover:bg-gray-900/60 transition-colors",children:[f.jsxs("div",{className:"flex items-start justify-between gap-4",children:[f.jsx("div",{className:"flex-1 min-w-0",children:f.jsxs("div",{className:"flex items-start gap-3",children:[K.images&&K.images[0]&&f.jsx("img",{src:K.images[0].url,alt:K.name,className:"w-16 h-16 object-cover rounded-md flex-shrink-0",onError:ke=>{ke.target.style.display="none"}}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:"text-white font-semibold text-lg",children:K.name}),f.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[K.manufacturer,"  ",K.category]}),K.description&&f.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:K.description}),K.defaultSupplierId&&f.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700",children:[f.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Default Supplier:"}),f.jsx("span",{className:"inline-block px-2 py-0.5 text-xs bg-blue-900/30 text-blue-300 rounded border border-blue-700/50",children:((he=q.find(ke=>ke.id===K.defaultSupplierId))==null?void 0:he.name)||K.defaultSupplierId})]})]})]})}),f.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[f.jsx("button",{onClick:()=>re(K),className:"px-3 py-1.5 rounded-md bg-blue-600/80 text-white text-sm hover:bg-blue-600 transition-colors",title:"Edit product",children:"Edit"}),f.jsx("button",{onClick:()=>G(K.id),className:"px-3 py-1.5 rounded-md bg-red-600/80 text-white text-sm hover:bg-red-600 transition-colors",title:"Delete product",children:"Delete"})]})]}),M===K.id&&f.jsxs("div",{className:"mt-4 p-3 bg-red-900/30 border border-red-700 rounded-md",children:[f.jsxs("p",{className:"text-red-300 text-sm mb-3",children:['Are you sure you want to delete "',K.name,'"?']}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsx("button",{onClick:()=>te(K.id),className:"px-3 py-1.5 rounded-md bg-red-600 text-white text-sm hover:bg-red-700 transition-colors",children:"Yes, Delete"}),f.jsx("button",{onClick:()=>G(null),className:"px-3 py-1.5 rounded-md bg-gray-700 text-white text-sm hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]},K.id)})]})]})]})]})},L3=()=>{const[t,e]=C.useState([]),[n,r]=C.useState([]),[a,o]=C.useState([]),[c,d]=C.useState(!0),[p,h]=C.useState({deliveryDate:new Date().toISOString().split("T")[0],lineItems:[],documents:[]}),[x,v]=C.useState([]),[w,_]=C.useState(!1),[E,N]=C.useState(!1),[I,P]=C.useState(!1),[U,R]=C.useState(null),A=C.useRef(null),k=C.useMemo(()=>new Map(a.map(M=>[M.id,M])),[a]),q=C.useMemo(()=>new Map(n.map(M=>[M.id,M.name||M.id])),[n]),V=async()=>{d(!0),R(null);try{const[M,G,Z]=await Promise.all([xv(),Js(),Wl()]);e(M.sort((oe,se)=>new Date(se.deliveryDate).getTime()-new Date(oe.deliveryDate).getTime())),r(G),o(Z)}catch(M){R(M instanceof Error?M.message:"Failed to load data.")}finally{d(!1)}};C.useEffect(()=>{V()},[]);const W=()=>{h({deliveryDate:new Date().toISOString().split("T")[0],lineItems:[],documents:[]}),v([]),A.current&&(A.current.value="")},J=M=>{M.target.files&&v(G=>[...G,...Array.from(M.target.files)])},$=M=>{v(G=>G.filter((Z,oe)=>oe!==M))},ce=async()=>{if(x.length!==0){N(!0),R(null);try{const M=await dw(x),G=n.find(oe=>M.supplierName&&oe.name.toLowerCase().includes(M.supplierName.toLowerCase())),Z=M.items.map(oe=>{const se=a.find(D=>D.name.toLowerCase()===oe.productName.toLowerCase());return{productId:(se==null?void 0:se.id)||"",productName:oe.productName,quantity:oe.quantity,cost:oe.costPerUnit}});h(oe=>({...oe,supplierId:(G==null?void 0:G.id)||oe.supplierId,invoiceNumber:M.invoiceNumber||oe.invoiceNumber,deliveryDate:M.deliveryDate||oe.deliveryDate,lineItems:Z}))}catch(M){R(M instanceof Error?M.message:"Failed to analyze documents.")}finally{N(!1)}}},ue=(M,G,Z)=>{const oe=[...p.lineItems||[]];if(oe[M]={...oe[M],[G]:Z},G==="productId"){const se=k.get(Z);se&&(oe[M].productName=se.name)}h(se=>({...se,lineItems:oe}))},Ce=()=>{const M={productId:"",productName:"Manual Entry",quantity:1,cost:0};h(G=>({...G,lineItems:[...G.lineItems||[],M]}))},_e=M=>{h(G=>{var Z;return{...G,lineItems:(Z=G.lineItems)==null?void 0:Z.filter((oe,se)=>se!==M)}})},Ve=async M=>{if(M.preventDefault(),!p.deliveryDate||!p.lineItems||p.lineItems.length===0){R("Delivery date and at least one valid line item are required.");return}const G=p.lineItems.filter(Z=>Z.productId&&Z.quantity>0);if(G.length===0){R("At least one line item must be assigned to a product.");return}_(!0),R(null);try{await ka({...p,deliveryDate:p.deliveryDate,lineItems:G}),W(),await V()}catch(Z){R(Z instanceof Error?Z.message:"Failed to create batch.")}finally{_(!1)}};return f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(sh,{className:"w-6 h-6 text-cyan-400"}),"Log New Delivery Batch"]}),f.jsxs("form",{onSubmit:Ve,className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Delivery Date"}),f.jsx("input",{type:"date",className:"form-input",value:p.deliveryDate||"",onChange:M=>h(G=>({...G,deliveryDate:M.target.value})),required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Supplier"}),f.jsxs("select",{className:"form-input",value:p.supplierId||"",onChange:M=>h(G=>({...G,supplierId:M.target.value||void 0})),children:[f.jsx("option",{value:"",children:"Select Supplier..."}),n.map(M=>f.jsx("option",{value:M.id,children:M.name},M.id))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Invoice Number"}),f.jsx("input",{className:"form-input",value:p.invoiceNumber||"",onChange:M=>h(G=>({...G,invoiceNumber:M.target.value}))})]})]}),f.jsxs("div",{className:"p-4 border border-gray-700 rounded-lg space-y-3",children:[f.jsx("h3",{className:"text-base font-semibold text-gray-200",children:"Upload Documents"}),f.jsx("input",{type:"file",ref:A,onChange:J,accept:"image/*",className:"hidden",multiple:!0}),f.jsxs("button",{type:"button",onClick:()=>{var M;return(M=A.current)==null?void 0:M.click()},className:"button-secondary w-full",children:[f.jsx(_w,{className:"w-5 h-5"})," Add Document(s)"]}),f.jsx("div",{className:"space-y-2",children:x.map((M,G)=>f.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 p-2 rounded text-sm",children:[f.jsx("span",{className:"truncate text-gray-300",children:M.name}),f.jsx("button",{type:"button",onClick:()=>$(G),className:"text-red-400 hover:text-red-300",children:f.jsx(Vl,{className:"w-4 h-4"})})]},G))}),x.length>0&&f.jsx("button",{type:"button",onClick:ce,disabled:E,className:"button-primary w-full",children:E?"Analyzing...":`Analyze ${x.length} Document(s) with AI`})]})]}),f.jsxs("div",{className:"space-y-4 p-4 border border-gray-700 rounded-lg bg-gray-900/20",children:[f.jsx("h3",{className:"text-base font-semibold text-gray-200",children:"Line Items"}),f.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(p.lineItems||[]).map((M,G)=>f.jsxs("div",{className:"p-2 rounded-md bg-gray-800/50 grid grid-cols-12 gap-2 items-center",children:[f.jsxs("div",{className:"col-span-6",children:[f.jsxs("select",{className:"form-input text-sm",value:M.productId,onChange:Z=>ue(G,"productId",Z.target.value),required:!0,children:[f.jsx("option",{value:"",children:"Match Product..."}),a.map(Z=>f.jsx("option",{value:Z.id,children:Z.name},Z.id))]}),M.productId===""&&f.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:['Unmatched: "',M.productName,'"']})]}),f.jsx("div",{className:"col-span-2",children:f.jsx("input",{type:"number",placeholder:"Qty",className:"form-input text-sm",value:M.quantity,onChange:Z=>ue(G,"quantity",Number(Z.target.value))})}),f.jsx("div",{className:"col-span-3",children:f.jsx("input",{type:"number",placeholder:"Cost",step:"0.01",className:"form-input text-sm",value:M.cost,onChange:Z=>ue(G,"cost",Number(Z.target.value))})}),f.jsx("div",{className:"col-span-1",children:f.jsx("button",{type:"button",onClick:()=>_e(G),className:"text-red-400 hover:text-red-300",children:f.jsx(Vl,{className:"w-4 h-4"})})})]},G))}),f.jsx("button",{type:"button",onClick:Ce,className:"button-secondary text-sm",children:"Add Manual Item"}),f.jsx("button",{type:"submit",disabled:w,className:"button-primary w-full",children:w?"Saving Batch...":"Save Batch"})]})]}),U&&f.jsx("p",{className:"text-red-400 text-sm mt-4",children:U})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Logged Batches"}),f.jsx("button",{onClick:V,className:"button-secondary text-sm",children:"Refresh"})]}),c?f.jsx("p",{className:"text-gray-400",children:"Loading batches..."}):t.length===0?f.jsx("p",{className:"text-gray-500 text-center py-4",children:"No batches logged yet."}):f.jsx("div",{className:"space-y-3",children:t.map(M=>{var G,Z;return f.jsxs("details",{className:"p-3 bg-gray-900/40 rounded-lg border border-gray-700 transition-colors",children:[f.jsx("summary",{className:"cursor-pointer",children:f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{children:[f.jsxs("p",{className:"text-white font-semibold",children:["Delivery: ",M.deliveryDate]}),f.jsxs("p",{className:"text-sm text-gray-400",children:["Supplier: ",q.get(M.supplierId||"")||M.supplierId||"N/A"]}),f.jsxs("p",{className:"text-xs text-gray-500",children:["Invoice #: ",M.invoiceNumber||"N/A"]})]}),f.jsx("div",{className:"text-right text-sm",children:f.jsxs("span",{className:"text-gray-300",children:[((G=M.lineItems)==null?void 0:G.length)||0," items"]})})]})}),f.jsx("div",{className:"mt-3 pt-3 border-t border-gray-700",children:f.jsx("ul",{className:"space-y-1 text-sm",children:(Z=M.lineItems)==null?void 0:Z.map((oe,se)=>{var D;return f.jsxs("li",{className:"flex justify-between text-gray-300",children:[f.jsxs("span",{children:[oe.quantity,"x ",((D=k.get(oe.productId))==null?void 0:D.name)||oe.productName]}),f.jsxs("span",{className:"text-gray-400",children:["$",oe.cost.toFixed(2),"/unit"]})]},se)})})})]},M.id)})})]}),f.jsx("style",{children:`
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            background-color: #1f2937;
            border: 1px solid #4b5563;
            color: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #22d3ee;
            box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.4);
        }
        .button-primary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            border-radius: 0.375rem;
            background-color: #0891b2;
            color: white;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .button-primary:hover {
            background-color: #0e7490;
        }
        .button-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .button-secondary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #4b5563;
            color: white;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .button-secondary:hover {
            background-color: #6b7280;
        }
      `})]})},q3=()=>{var M,G,Z,oe;const[t,e]=C.useState(null),{toasts:n,removeToast:r}=gs(),a=(t==null?void 0:t.user)??null,o=!!((M=a==null?void 0:a.roles)!=null&&M.shop||a!=null&&a.shopId),c=!!((G=a==null?void 0:a.roles)!=null&&G.customer||a!=null&&a.customerId),d=!!((Z=a==null?void 0:a.roles)!=null&&Z.supplier||a!=null&&a.supplierId),[p,h]=C.useState([]),[x,v]=C.useState([]),[w,_]=C.useState([]),[E,N]=C.useState("dashboard"),[I,P]=C.useState(!0),U=!a,R=C.useMemo(()=>{if(!(t!=null&&t.shopContext)||!a)return null;let se;if(typeof t.shopContext=="string")se=t.shopContext;else if(t.shopContext&&typeof t.shopContext=="object"&&"id"in t.shopContext)se=t.shopContext.id;else return null;return{id:se,name:a.companyName,contactEmail:a.email,location:a.address,qdrantNamespace:se}},[t==null?void 0:t.shopContext,(oe=t==null?void 0:t.user)==null?void 0:oe.shopId,a==null?void 0:a.shopId,a==null?void 0:a.companyName,a==null?void 0:a.email,a==null?void 0:a.address]),A=C.useRef(null);C.useEffect(()=>{var L;const se=(L=A.current)==null?void 0:L.id,D=R==null?void 0:R.id;se!==D&&(A.current=R,qa(R))},[R]);const k=C.useCallback(async se=>{var L;if(!se){P(!1);return}const D=!!((L=se.roles)!=null&&L.shop||se.shopId);if(P(!0),D){const Q=await Zl(),re=await Qb(),de=await Zf();v(Q),h(re),_(de)}else v([]),h([]),_([]);P(!1)},[]),q=C.useRef(!1),V=C.useRef(null);C.useEffect(()=>{var Q;if(U||!a){q.current=!1;return}const se=!!((Q=a.roles)!=null&&Q.shop||a.shopId),D=a.shopId||null;if(!se||q.current&&V.current===D)return;(async()=>{await Jb(),await k(a),q.current=!0,V.current=D})()},[U,a==null?void 0:a.shopId,k]),C.useEffect(()=>{if(!a||!o)return;const se=setInterval(()=>{k(a)},6e4);return()=>clearInterval(se)},[a,o,k]);const W=C.useCallback(se=>{var L,Q,re;e(se),P(!1);const D=se.user;D.shopId||(L=D.roles)!=null&&L.shop?N("dashboard"):D.supplierId||(Q=D.roles)!=null&&Q.supplier?N("supplier"):D.customerId||(re=D.roles)!=null&&re.customer?N("customer"):N("dashboard")},[]),J=C.useCallback(()=>{e(null),h([]),v([]),_([]),N("dashboard")},[]),$=async(se,D)=>{await Ti(se,D),a&&await k(a)},ce=async se=>{await Wf(se),a&&await k(a)},ue=async(se,D)=>{await Xb(se,D),await MD(se.listingId,D),a&&await k(a)},Ce=se=>N(se),_e=C.useMemo(()=>{if(!a||!o)return[];const se=w.filter(L=>L.quantity>0&&(!L.status||L.status==="ACTIVE")),D=new Map(x.map(L=>[L.productId,L]));return se.map(L=>{const Q=D.get(L.productId);return{id:L.id,batchId:String(L.batchId),productId:L.productId,inventoryUuid:L.inventoryUuid,productName:(Q==null?void 0:Q.productName)||"N/A",manufacturer:(Q==null?void 0:Q.manufacturer)||"N/A",category:(Q==null?void 0:Q.category)||"N/A",expirationDate:L.expirationDate,quantity:L.quantity,quantityType:(Q==null?void 0:Q.quantityType)||"units",costPerUnit:L.costPerUnit,location:L.location||void 0,createdAt:L.createdAt,updatedAt:L.updatedAt,supplierId:L.supplierId||null,buyPrice:L.buyPrice??L.costPerUnit,sellPrice:L.sellPrice??void 0}})},[w,x,a==null?void 0:a.shopId,o]);return a&&c&&!o?f.jsx(Ix,{name:a.companyName||"Guest",initialProfile:t??void 0,onLogout:J}):U?f.jsx(lw,{onAuthenticated:W}):!a||o&&I?f.jsxs("div",{className:"min-h-screen bg-gray-900 flex flex-col items-center justify-center text-white",children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"}),f.jsx("p",{className:"mt-4 text-lg",children:"Initializing Application..."})]}):f.jsxs("div",{className:"min-h-screen bg-gray-900 text-gray-100 font-sans",children:[f.jsx(WD,{activeTab:E,onTabChange:Ce,user:a,onLogout:J,isBackendAvailable:$4}),f.jsxs("main",{className:"container mx-auto p-4 md:p-8",children:[E==="dashboard"&&f.jsx(d3,{summaries:o?x:[],onNavigateToInventory:()=>o&&Ce("inventory"),onRefreshData:a?()=>k(a):void 0}),E==="inventory"&&o&&f.jsx(w3,{summaries:x,items:_e,batches:p,onAddBatch:$,onDataRefresh:()=>a&&k(a)}),E==="catalog"&&o&&f.jsx(O3,{}),E==="batches"&&o&&f.jsx(L3,{}),E==="kiosk"&&o&&f.jsx(S3,{summaries:x,onPurchase:ce}),E==="marketplace"&&o&&f.jsx(T3,{summaries:x,user:a,onPurchase:ue}),E==="customer"&&c&&f.jsx(Ix,{name:a.companyName}),E==="supplier"&&d&&f.jsx(k3,{name:a.companyName}),E==="backend"&&f.jsx(N3,{}),!o&&["inventory","catalog","batches","kiosk","marketplace"].includes(E)&&f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-red-400",children:"Access Denied: Shop role required"})}),!c&&E==="customer"&&f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-red-400",children:"Access Denied: Customer role required"})}),!d&&E==="supplier"&&f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-red-400",children:"Access Denied: Supplier role required"})})]}),f.jsx("footer",{className:"text-center p-4 mt-8 text-gray-500 text-sm",children:f.jsx("p",{children:"Built for the modern autonomous shop.  2024 Inventory AI"})}),f.jsx(s3,{toasts:n,onRemove:r})]})};console.log("[index.tsx] Starting app initialization...");const Rw=document.getElementById("root");if(!Rw)throw console.error("[index.tsx] Root element not found!"),new Error("Could not find root element to mount to");console.log("[index.tsx] Root element found, creating React root...");const B3=iE.createRoot(Rw);console.log("[index.tsx] Rendering App component...");B3.render(f.jsx(Rx.StrictMode,{children:f.jsx(q3,{})}));console.log("[index.tsx] App rendered successfully");
