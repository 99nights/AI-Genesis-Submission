function YS(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in t)){const o=Object.getOwnPropertyDescriptor(r,a);o&&Object.defineProperty(t,a,o.get?o:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function vf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function KS(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}),n}var xd={exports:{}},Ra={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ag;function QS(){if(ag)return Ra;ag=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,a,o){var c=null;if(o!==void 0&&(c=""+o),a.key!==void 0&&(c=""+a.key),"key"in a){o={};for(var f in a)f!=="key"&&(o[f]=a[f])}else o=a;return a=o.ref,{$$typeof:t,type:r,key:c,ref:a!==void 0?a:null,props:o}}return Ra.Fragment=e,Ra.jsx=n,Ra.jsxs=n,Ra}var og;function XS(){return og||(og=1,xd.exports=QS()),xd.exports}var d=XS(),vd={exports:{}},Pe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lg;function WS(){if(lg)return Pe;lg=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),w=Symbol.iterator;function _(M){return M===null||typeof M!="object"?null:(M=w&&M[w]||M["@@iterator"],typeof M=="function"?M:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,D={};function k(M,q,K){this.props=M,this.context=q,this.refs=D,this.updater=K||E}k.prototype.isReactComponent={},k.prototype.setState=function(M,q){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,q,"setState")},k.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function U(){}U.prototype=k.prototype;function A(M,q,K){this.props=M,this.context=q,this.refs=D,this.updater=K||E}var I=A.prototype=new U;I.constructor=A,N(I,k.prototype),I.isPureReactComponent=!0;var P=Array.isArray;function B(){}var H={H:null,A:null,T:null,S:null},Q=Object.prototype.hasOwnProperty;function J(M,q,K){var ie=K.ref;return{$$typeof:t,type:M,key:q,ref:ie!==void 0?ie:null,props:K}}function O(M,q){return J(M.type,q,M.props)}function Z(M){return typeof M=="object"&&M!==null&&M.$$typeof===t}function ae(M){var q={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(K){return q[K]})}var ve=/\/+/g;function ye(M,q){return typeof M=="object"&&M!==null&&M.key!=null?ae(""+M.key):q.toString(36)}function Me(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(B,B):(M.status="pending",M.then(function(q){M.status==="pending"&&(M.status="fulfilled",M.value=q)},function(q){M.status==="pending"&&(M.status="rejected",M.reason=q)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function R(M,q,K,ie,de){var me=typeof M;(me==="undefined"||me==="boolean")&&(M=null);var Te=!1;if(M===null)Te=!0;else switch(me){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(M.$$typeof){case t:case e:Te=!0;break;case x:return Te=M._init,R(Te(M._payload),q,K,ie,de)}}if(Te)return de=de(M),Te=ie===""?"."+ye(M,0):ie,P(de)?(K="",Te!=null&&(K=Te.replace(ve,"$&/")+"/"),R(de,q,K,"",function(be){return be})):de!=null&&(Z(de)&&(de=O(de,K+(de.key==null||M&&M.key===de.key?"":(""+de.key).replace(ve,"$&/")+"/")+Te)),q.push(de)),1;Te=0;var ne=ie===""?".":ie+":";if(P(M))for(var ee=0;ee<M.length;ee++)ie=M[ee],me=ne+ye(ie,ee),Te+=R(ie,q,K,me,de);else if(ee=_(M),typeof ee=="function")for(M=ee.call(M),ee=0;!(ie=M.next()).done;)ie=ie.value,me=ne+ye(ie,ee++),Te+=R(ie,q,K,me,de);else if(me==="object"){if(typeof M.then=="function")return R(Me(M),q,K,ie,de);throw q=String(M),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return Te}function G(M,q,K){if(M==null)return M;var ie=[],de=0;return R(M,ie,"","",function(me){return q.call(K,me,de++)}),ie}function X(M){if(M._status===-1){var q=M._result;q=q(),q.then(function(K){(M._status===0||M._status===-1)&&(M._status=1,M._result=K)},function(K){(M._status===0||M._status===-1)&&(M._status=2,M._result=K)}),M._status===-1&&(M._status=0,M._result=q)}if(M._status===1)return M._result.default;throw M._result}var ce=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)},re={map:G,forEach:function(M,q,K){G(M,function(){q.apply(this,arguments)},K)},count:function(M){var q=0;return G(M,function(){q++}),q},toArray:function(M){return G(M,function(q){return q})||[]},only:function(M){if(!Z(M))throw Error("React.Children.only expected to receive a single React element child.");return M}};return Pe.Activity=v,Pe.Children=re,Pe.Component=k,Pe.Fragment=n,Pe.Profiler=a,Pe.PureComponent=A,Pe.StrictMode=r,Pe.Suspense=p,Pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,Pe.__COMPILER_RUNTIME={__proto__:null,c:function(M){return H.H.useMemoCache(M)}},Pe.cache=function(M){return function(){return M.apply(null,arguments)}},Pe.cacheSignal=function(){return null},Pe.cloneElement=function(M,q,K){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var ie=N({},M.props),de=M.key;if(q!=null)for(me in q.key!==void 0&&(de=""+q.key),q)!Q.call(q,me)||me==="key"||me==="__self"||me==="__source"||me==="ref"&&q.ref===void 0||(ie[me]=q[me]);var me=arguments.length-2;if(me===1)ie.children=K;else if(1<me){for(var Te=Array(me),ne=0;ne<me;ne++)Te[ne]=arguments[ne+2];ie.children=Te}return J(M.type,de,ie)},Pe.createContext=function(M){return M={$$typeof:c,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:o,_context:M},M},Pe.createElement=function(M,q,K){var ie,de={},me=null;if(q!=null)for(ie in q.key!==void 0&&(me=""+q.key),q)Q.call(q,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(de[ie]=q[ie]);var Te=arguments.length-2;if(Te===1)de.children=K;else if(1<Te){for(var ne=Array(Te),ee=0;ee<Te;ee++)ne[ee]=arguments[ee+2];de.children=ne}if(M&&M.defaultProps)for(ie in Te=M.defaultProps,Te)de[ie]===void 0&&(de[ie]=Te[ie]);return J(M,me,de)},Pe.createRef=function(){return{current:null}},Pe.forwardRef=function(M){return{$$typeof:f,render:M}},Pe.isValidElement=Z,Pe.lazy=function(M){return{$$typeof:x,_payload:{_status:-1,_result:M},_init:X}},Pe.memo=function(M,q){return{$$typeof:h,type:M,compare:q===void 0?null:q}},Pe.startTransition=function(M){var q=H.T,K={};H.T=K;try{var ie=M(),de=H.S;de!==null&&de(K,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(B,ce)}catch(me){ce(me)}finally{q!==null&&K.types!==null&&(q.types=K.types),H.T=q}},Pe.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},Pe.use=function(M){return H.H.use(M)},Pe.useActionState=function(M,q,K){return H.H.useActionState(M,q,K)},Pe.useCallback=function(M,q){return H.H.useCallback(M,q)},Pe.useContext=function(M){return H.H.useContext(M)},Pe.useDebugValue=function(){},Pe.useDeferredValue=function(M,q){return H.H.useDeferredValue(M,q)},Pe.useEffect=function(M,q){return H.H.useEffect(M,q)},Pe.useEffectEvent=function(M){return H.H.useEffectEvent(M)},Pe.useId=function(){return H.H.useId()},Pe.useImperativeHandle=function(M,q,K){return H.H.useImperativeHandle(M,q,K)},Pe.useInsertionEffect=function(M,q){return H.H.useInsertionEffect(M,q)},Pe.useLayoutEffect=function(M,q){return H.H.useLayoutEffect(M,q)},Pe.useMemo=function(M,q){return H.H.useMemo(M,q)},Pe.useOptimistic=function(M,q){return H.H.useOptimistic(M,q)},Pe.useReducer=function(M,q,K){return H.H.useReducer(M,q,K)},Pe.useRef=function(M){return H.H.useRef(M)},Pe.useState=function(M){return H.H.useState(M)},Pe.useSyncExternalStore=function(M,q,K){return H.H.useSyncExternalStore(M,q,K)},Pe.useTransition=function(){return H.H.useTransition()},Pe.version="19.2.0",Pe}var cg;function bf(){return cg||(cg=1,vd.exports=WS()),vd.exports}var C=bf();const Mx=vf(C);var bd={exports:{}},Da={},wd={exports:{}},_d={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ug;function ZS(){return ug||(ug=1,(function(t){function e(R,G){var X=R.length;R.push(G);e:for(;0<X;){var ce=X-1>>>1,re=R[ce];if(0<a(re,G))R[ce]=G,R[X]=re,X=ce;else break e}}function n(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var G=R[0],X=R.pop();if(X!==G){R[0]=X;e:for(var ce=0,re=R.length,M=re>>>1;ce<M;){var q=2*(ce+1)-1,K=R[q],ie=q+1,de=R[ie];if(0>a(K,X))ie<re&&0>a(de,K)?(R[ce]=de,R[ie]=X,ce=ie):(R[ce]=K,R[q]=X,ce=q);else if(ie<re&&0>a(de,X))R[ce]=de,R[ie]=X,ce=ie;else break e}}return G}function a(R,G){var X=R.sortIndex-G.sortIndex;return X!==0?X:R.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,f=c.now();t.unstable_now=function(){return c.now()-f}}var p=[],h=[],x=1,v=null,w=3,_=!1,E=!1,N=!1,D=!1,k=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function I(R){for(var G=n(h);G!==null;){if(G.callback===null)r(h);else if(G.startTime<=R)r(h),G.sortIndex=G.expirationTime,e(p,G);else break;G=n(h)}}function P(R){if(N=!1,I(R),!E)if(n(p)!==null)E=!0,B||(B=!0,ae());else{var G=n(h);G!==null&&Me(P,G.startTime-R)}}var B=!1,H=-1,Q=5,J=-1;function O(){return D?!0:!(t.unstable_now()-J<Q)}function Z(){if(D=!1,B){var R=t.unstable_now();J=R;var G=!0;try{e:{E=!1,N&&(N=!1,U(H),H=-1),_=!0;var X=w;try{t:{for(I(R),v=n(p);v!==null&&!(v.expirationTime>R&&O());){var ce=v.callback;if(typeof ce=="function"){v.callback=null,w=v.priorityLevel;var re=ce(v.expirationTime<=R);if(R=t.unstable_now(),typeof re=="function"){v.callback=re,I(R),G=!0;break t}v===n(p)&&r(p),I(R)}else r(p);v=n(p)}if(v!==null)G=!0;else{var M=n(h);M!==null&&Me(P,M.startTime-R),G=!1}}break e}finally{v=null,w=X,_=!1}G=void 0}}finally{G?ae():B=!1}}}var ae;if(typeof A=="function")ae=function(){A(Z)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,ye=ve.port2;ve.port1.onmessage=Z,ae=function(){ye.postMessage(null)}}else ae=function(){k(Z,0)};function Me(R,G){H=k(function(){R(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(R){R.callback=null},t.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<R?Math.floor(1e3/R):5},t.unstable_getCurrentPriorityLevel=function(){return w},t.unstable_next=function(R){switch(w){case 1:case 2:case 3:var G=3;break;default:G=w}var X=w;w=G;try{return R()}finally{w=X}},t.unstable_requestPaint=function(){D=!0},t.unstable_runWithPriority=function(R,G){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var X=w;w=R;try{return G()}finally{w=X}},t.unstable_scheduleCallback=function(R,G,X){var ce=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?ce+X:ce):X=ce,R){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=X+re,R={id:x++,callback:G,priorityLevel:R,startTime:X,expirationTime:re,sortIndex:-1},X>ce?(R.sortIndex=X,e(h,R),n(p)===null&&R===n(h)&&(N?(U(H),H=-1):N=!0,Me(P,X-ce))):(R.sortIndex=re,e(p,R),E||_||(E=!0,B||(B=!0,ae()))),R},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(R){var G=w;return function(){var X=w;w=G;try{return R.apply(this,arguments)}finally{w=X}}}})(_d)),_d}var dg;function eE(){return dg||(dg=1,wd.exports=ZS()),wd.exports}var Sd={exports:{}},jt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fg;function tE(){if(fg)return jt;fg=1;var t=bf();function e(p){var h="https://react.dev/errors/"+p;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)h+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+p+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(p,h,x){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:p,containerInfo:h,implementation:x}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,h){if(p==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return jt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,jt.createPortal=function(p,h){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return o(p,h,null,x)},jt.flushSync=function(p){var h=c.T,x=r.p;try{if(c.T=null,r.p=2,p)return p()}finally{c.T=h,r.p=x,r.d.f()}},jt.preconnect=function(p,h){typeof p=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(p,h))},jt.prefetchDNS=function(p){typeof p=="string"&&r.d.D(p)},jt.preinit=function(p,h){if(typeof p=="string"&&h&&typeof h.as=="string"){var x=h.as,v=f(x,h.crossOrigin),w=typeof h.integrity=="string"?h.integrity:void 0,_=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;x==="style"?r.d.S(p,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:v,integrity:w,fetchPriority:_}):x==="script"&&r.d.X(p,{crossOrigin:v,integrity:w,fetchPriority:_,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},jt.preinitModule=function(p,h){if(typeof p=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var x=f(h.as,h.crossOrigin);r.d.M(p,{crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(p)},jt.preload=function(p,h){if(typeof p=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var x=h.as,v=f(x,h.crossOrigin);r.d.L(p,x,{crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},jt.preloadModule=function(p,h){if(typeof p=="string")if(h){var x=f(h.as,h.crossOrigin);r.d.m(p,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(p)},jt.requestFormReset=function(p){r.d.r(p)},jt.unstable_batchedUpdates=function(p,h){return p(h)},jt.useFormState=function(p,h,x){return c.H.useFormState(p,h,x)},jt.useFormStatus=function(){return c.H.useHostTransitionStatus()},jt.version="19.2.0",jt}var hg;function nE(){if(hg)return Sd.exports;hg=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Sd.exports=tE(),Sd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pg;function sE(){if(pg)return Da;pg=1;var t=eE(),e=bf(),n=nE();function r(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function c(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function f(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function p(s){if(o(s)!==s)throw Error(r(188))}function h(s){var i=s.alternate;if(!i){if(i=o(s),i===null)throw Error(r(188));return i!==s?null:s}for(var l=s,u=i;;){var y=l.return;if(y===null)break;var b=y.alternate;if(b===null){if(u=y.return,u!==null){l=u;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===l)return p(y),s;if(b===u)return p(y),i;b=b.sibling}throw Error(r(188))}if(l.return!==u.return)l=y,u=b;else{for(var S=!1,T=y.child;T;){if(T===l){S=!0,l=y,u=b;break}if(T===u){S=!0,u=y,l=b;break}T=T.sibling}if(!S){for(T=b.child;T;){if(T===l){S=!0,l=b,u=y;break}if(T===u){S=!0,u=b,l=y;break}T=T.sibling}if(!S)throw Error(r(189))}}if(l.alternate!==u)throw Error(r(190))}if(l.tag!==3)throw Error(r(188));return l.stateNode.current===l?s:i}function x(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=x(s),i!==null)return i;s=s.sibling}return null}var v=Object.assign,w=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),U=Symbol.for("react.consumer"),A=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),J=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),Z=Symbol.iterator;function ae(s){return s===null||typeof s!="object"?null:(s=Z&&s[Z]||s["@@iterator"],typeof s=="function"?s:null)}var ve=Symbol.for("react.client.reference");function ye(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ve?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case N:return"Fragment";case k:return"Profiler";case D:return"StrictMode";case P:return"Suspense";case B:return"SuspenseList";case J:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case E:return"Portal";case A:return s.displayName||"Context";case U:return(s._context.displayName||"Context")+".Consumer";case I:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case H:return i=s.displayName||null,i!==null?i:ye(s.type)||"Memo";case Q:i=s._payload,s=s._init;try{return ye(s(i))}catch{}}return null}var Me=Array.isArray,R=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},ce=[],re=-1;function M(s){return{current:s}}function q(s){0>re||(s.current=ce[re],ce[re]=null,re--)}function K(s,i){re++,ce[re]=s.current,s.current=i}var ie=M(null),de=M(null),me=M(null),Te=M(null);function ne(s,i){switch(K(me,i),K(de,s),K(ie,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?I0(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=I0(i),s=R0(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}q(ie),K(ie,s)}function ee(){q(ie),q(de),q(me)}function be(s){s.memoizedState!==null&&K(Te,s);var i=ie.current,l=R0(i,s.type);i!==l&&(K(de,s),K(ie,l))}function he(s){de.current===s&&(q(ie),q(de)),Te.current===s&&(q(Te),Na._currentValue=X)}var Ee,ze;function Ke(s){if(Ee===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);Ee=i&&i[1]||"",ze=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ee+s+ze}var st=!1;function je(s,i){if(!s||st)return"";st=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(i){var se=function(){throw Error()};if(Object.defineProperty(se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(se,[])}catch(Y){var $=Y}Reflect.construct(s,[],se)}else{try{se.call()}catch(Y){$=Y}s.call(se.prototype)}}else{try{throw Error()}catch(Y){$=Y}(se=s())&&typeof se.catch=="function"&&se.catch(function(){})}}catch(Y){if(Y&&$&&typeof Y.stack=="string")return[Y.stack,$.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=u.DetermineComponentFrameRoot(),S=b[0],T=b[1];if(S&&T){var j=S.split(`
`),F=T.split(`
`);for(y=u=0;u<j.length&&!j[u].includes("DetermineComponentFrameRoot");)u++;for(;y<F.length&&!F[y].includes("DetermineComponentFrameRoot");)y++;if(u===j.length||y===F.length)for(u=j.length-1,y=F.length-1;1<=u&&0<=y&&j[u]!==F[y];)y--;for(;1<=u&&0<=y;u--,y--)if(j[u]!==F[y]){if(u!==1||y!==1)do if(u--,y--,0>y||j[u]!==F[y]){var W=`
`+j[u].replace(" at new "," at ");return s.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",s.displayName)),W}while(1<=u&&0<=y);break}}}finally{st=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?Ke(l):""}function it(s,i){switch(s.tag){case 26:case 27:case 5:return Ke(s.type);case 16:return Ke("Lazy");case 13:return s.child!==i&&i!==null?Ke("Suspense Fallback"):Ke("Suspense");case 19:return Ke("SuspenseList");case 0:case 15:return je(s.type,!1);case 11:return je(s.type.render,!1);case 1:return je(s.type,!0);case 31:return Ke("Activity");default:return""}}function _t(s){try{var i="",l=null;do i+=it(s,l),l=s,s=s.return;while(s);return i}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var At=Object.prototype.hasOwnProperty,On=t.unstable_scheduleCallback,Ln=t.unstable_cancelCallback,Xt=t.unstable_shouldYield,le=t.unstable_requestPaint,oe=t.unstable_now,Ie=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,$n=t.unstable_UserBlockingPriority,De=t.unstable_NormalPriority,Tt=t.unstable_LowPriority,qn=t.unstable_IdlePriority,rc=t.log,ic=t.unstable_setDisableYieldValue,Li=null,Wt=null;function ys(s){if(typeof rc=="function"&&ic(s),Wt&&typeof Wt.setStrictMode=="function")try{Wt.setStrictMode(Li,s)}catch{}}var Zt=Math.clz32?Math.clz32:kw,Mw=Math.log,Pw=Math.LN2;function kw(s){return s>>>=0,s===0?32:31-(Mw(s)/Pw|0)|0}var Qa=256,Xa=262144,Wa=4194304;function Qs(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Za(s,i,l){var u=s.pendingLanes;if(u===0)return 0;var y=0,b=s.suspendedLanes,S=s.pingedLanes;s=s.warmLanes;var T=u&134217727;return T!==0?(u=T&~b,u!==0?y=Qs(u):(S&=T,S!==0?y=Qs(S):l||(l=T&~s,l!==0&&(y=Qs(l))))):(T=u&~b,T!==0?y=Qs(T):S!==0?y=Qs(S):l||(l=u&~s,l!==0&&(y=Qs(l)))),y===0?0:i!==0&&i!==y&&(i&b)===0&&(b=y&-y,l=i&-i,b>=l||b===32&&(l&4194048)!==0)?i:y}function qi(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function Uw(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function uh(){var s=Wa;return Wa<<=1,(Wa&62914560)===0&&(Wa=4194304),s}function ac(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Bi(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function jw(s,i,l,u,y,b){var S=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var T=s.entanglements,j=s.expirationTimes,F=s.hiddenUpdates;for(l=S&~l;0<l;){var W=31-Zt(l),se=1<<W;T[W]=0,j[W]=-1;var $=F[W];if($!==null)for(F[W]=null,W=0;W<$.length;W++){var Y=$[W];Y!==null&&(Y.lane&=-536870913)}l&=~se}u!==0&&dh(s,u,0),b!==0&&y===0&&s.tag!==0&&(s.suspendedLanes|=b&~(S&~i))}function dh(s,i,l){s.pendingLanes|=i,s.suspendedLanes&=~i;var u=31-Zt(i);s.entangledLanes|=i,s.entanglements[u]=s.entanglements[u]|1073741824|l&261930}function fh(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var u=31-Zt(l),y=1<<u;y&i|s[u]&i&&(s[u]|=i),l&=~y}}function hh(s,i){var l=i&-i;return l=(l&42)!==0?1:oc(l),(l&(s.suspendedLanes|i))!==0?0:l}function oc(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function lc(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function ph(){var s=G.p;return s!==0?s:(s=window.event,s===void 0?32:Z0(s.type))}function mh(s,i){var l=G.p;try{return G.p=s,i()}finally{G.p=l}}var xs=Math.random().toString(36).slice(2),It="__reactFiber$"+xs,Ht="__reactProps$"+xs,Ar="__reactContainer$"+xs,cc="__reactEvents$"+xs,Ow="__reactListeners$"+xs,Lw="__reactHandles$"+xs,gh="__reactResources$"+xs,Vi="__reactMarker$"+xs;function uc(s){delete s[It],delete s[Ht],delete s[cc],delete s[Ow],delete s[Lw]}function Ir(s){var i=s[It];if(i)return i;for(var l=s.parentNode;l;){if(i=l[Ar]||l[It]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=O0(s);s!==null;){if(l=s[It])return l;s=O0(s)}return i}s=l,l=s.parentNode}return null}function Rr(s){if(s=s[It]||s[Ar]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function Gi(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(r(33))}function Dr(s){var i=s[gh];return i||(i=s[gh]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Nt(s){s[Vi]=!0}var yh=new Set,xh={};function Xs(s,i){Mr(s,i),Mr(s+"Capture",i)}function Mr(s,i){for(xh[s]=i,s=0;s<i.length;s++)yh.add(i[s])}var qw=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),vh={},bh={};function Bw(s){return At.call(bh,s)?!0:At.call(vh,s)?!1:qw.test(s)?bh[s]=!0:(vh[s]=!0,!1)}function eo(s,i,l){if(Bw(i))if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var u=i.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+l)}}function to(s,i,l){if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+l)}}function Jn(s,i,l,u){if(u===null)s.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(i,l,""+u)}}function fn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function wh(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Vw(s,i,l){var u=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var y=u.get,b=u.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return y.call(this)},set:function(S){l=""+S,b.call(this,S)}}),Object.defineProperty(s,i,{enumerable:u.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function dc(s){if(!s._valueTracker){var i=wh(s)?"checked":"value";s._valueTracker=Vw(s,i,""+s[i])}}function _h(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),u="";return s&&(u=wh(s)?s.checked?"true":"false":s.value),s=u,s!==l?(i.setValue(s),!0):!1}function no(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Gw=/[\n"\\]/g;function hn(s){return s.replace(Gw,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function fc(s,i,l,u,y,b,S,T){s.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?s.type=S:s.removeAttribute("type"),i!=null?S==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+fn(i)):s.value!==""+fn(i)&&(s.value=""+fn(i)):S!=="submit"&&S!=="reset"||s.removeAttribute("value"),i!=null?hc(s,S,fn(i)):l!=null?hc(s,S,fn(l)):u!=null&&s.removeAttribute("value"),y==null&&b!=null&&(s.defaultChecked=!!b),y!=null&&(s.checked=y&&typeof y!="function"&&typeof y!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?s.name=""+fn(T):s.removeAttribute("name")}function Sh(s,i,l,u,y,b,S,T){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.type=b),i!=null||l!=null){if(!(b!=="submit"&&b!=="reset"||i!=null)){dc(s);return}l=l!=null?""+fn(l):"",i=i!=null?""+fn(i):l,T||i===s.value||(s.value=i),s.defaultValue=i}u=u??y,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=T?s.checked:!!u,s.defaultChecked=!!u,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(s.name=S),dc(s)}function hc(s,i,l){i==="number"&&no(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function Pr(s,i,l,u){if(s=s.options,i){i={};for(var y=0;y<l.length;y++)i["$"+l[y]]=!0;for(l=0;l<s.length;l++)y=i.hasOwnProperty("$"+s[l].value),s[l].selected!==y&&(s[l].selected=y),y&&u&&(s[l].defaultSelected=!0)}else{for(l=""+fn(l),i=null,y=0;y<s.length;y++){if(s[y].value===l){s[y].selected=!0,u&&(s[y].defaultSelected=!0);return}i!==null||s[y].disabled||(i=s[y])}i!==null&&(i.selected=!0)}}function Eh(s,i,l){if(i!=null&&(i=""+fn(i),i!==s.value&&(s.value=i),l==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=l!=null?""+fn(l):""}function Th(s,i,l,u){if(i==null){if(u!=null){if(l!=null)throw Error(r(92));if(Me(u)){if(1<u.length)throw Error(r(93));u=u[0]}l=u}l==null&&(l=""),i=l}l=fn(i),s.defaultValue=l,u=s.textContent,u===l&&u!==""&&u!==null&&(s.value=u),dc(s)}function kr(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var Hw=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nh(s,i,l){var u=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":u?s.setProperty(i,l):typeof l!="number"||l===0||Hw.has(i)?i==="float"?s.cssFloat=l:s[i]=(""+l).trim():s[i]=l+"px"}function Ch(s,i,l){if(i!=null&&typeof i!="object")throw Error(r(62));if(s=s.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||i!=null&&i.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var y in i)u=i[y],i.hasOwnProperty(y)&&l[y]!==u&&Nh(s,y,u)}else for(var b in i)i.hasOwnProperty(b)&&Nh(s,b,i[b])}function pc(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zw=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Fw=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function so(s){return Fw.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Yn(){}var mc=null;function gc(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ur=null,jr=null;function Ah(s){var i=Rr(s);if(i&&(s=i.stateNode)){var l=s[Ht]||null;e:switch(s=i.stateNode,i.type){case"input":if(fc(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+hn(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var u=l[i];if(u!==s&&u.form===s.form){var y=u[Ht]||null;if(!y)throw Error(r(90));fc(u,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(i=0;i<l.length;i++)u=l[i],u.form===s.form&&_h(u)}break e;case"textarea":Eh(s,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&Pr(s,!!l.multiple,i,!1)}}}var yc=!1;function Ih(s,i,l){if(yc)return s(i,l);yc=!0;try{var u=s(i);return u}finally{if(yc=!1,(Ur!==null||jr!==null)&&(Fo(),Ur&&(i=Ur,s=jr,jr=Ur=null,Ah(i),s)))for(i=0;i<s.length;i++)Ah(s[i])}}function Hi(s,i){var l=s.stateNode;if(l===null)return null;var u=l[Ht]||null;if(u===null)return null;l=u[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(r(231,i,typeof l));return l}var Kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xc=!1;if(Kn)try{var zi={};Object.defineProperty(zi,"passive",{get:function(){xc=!0}}),window.addEventListener("test",zi,zi),window.removeEventListener("test",zi,zi)}catch{xc=!1}var vs=null,vc=null,ro=null;function Rh(){if(ro)return ro;var s,i=vc,l=i.length,u,y="value"in vs?vs.value:vs.textContent,b=y.length;for(s=0;s<l&&i[s]===y[s];s++);var S=l-s;for(u=1;u<=S&&i[l-u]===y[b-u];u++);return ro=y.slice(s,1<u?1-u:void 0)}function io(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function ao(){return!0}function Dh(){return!1}function zt(s){function i(l,u,y,b,S){this._reactName=l,this._targetInst=y,this.type=u,this.nativeEvent=b,this.target=S,this.currentTarget=null;for(var T in s)s.hasOwnProperty(T)&&(l=s[T],this[T]=l?l(b):b[T]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?ao:Dh,this.isPropagationStopped=Dh,this}return v(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=ao)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=ao)},persist:function(){},isPersistent:ao}),i}var Ws={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oo=zt(Ws),Fi=v({},Ws,{view:0,detail:0}),$w=zt(Fi),bc,wc,$i,lo=v({},Fi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==$i&&($i&&s.type==="mousemove"?(bc=s.screenX-$i.screenX,wc=s.screenY-$i.screenY):wc=bc=0,$i=s),bc)},movementY:function(s){return"movementY"in s?s.movementY:wc}}),Mh=zt(lo),Jw=v({},lo,{dataTransfer:0}),Yw=zt(Jw),Kw=v({},Fi,{relatedTarget:0}),_c=zt(Kw),Qw=v({},Ws,{animationName:0,elapsedTime:0,pseudoElement:0}),Xw=zt(Qw),Ww=v({},Ws,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Zw=zt(Ww),e_=v({},Ws,{data:0}),Ph=zt(e_),t_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},n_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},s_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function r_(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=s_[s])?!!i[s]:!1}function Sc(){return r_}var i_=v({},Fi,{key:function(s){if(s.key){var i=t_[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=io(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?n_[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sc,charCode:function(s){return s.type==="keypress"?io(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?io(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),a_=zt(i_),o_=v({},lo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kh=zt(o_),l_=v({},Fi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sc}),c_=zt(l_),u_=v({},Ws,{propertyName:0,elapsedTime:0,pseudoElement:0}),d_=zt(u_),f_=v({},lo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),h_=zt(f_),p_=v({},Ws,{newState:0,oldState:0}),m_=zt(p_),g_=[9,13,27,32],Ec=Kn&&"CompositionEvent"in window,Ji=null;Kn&&"documentMode"in document&&(Ji=document.documentMode);var y_=Kn&&"TextEvent"in window&&!Ji,Uh=Kn&&(!Ec||Ji&&8<Ji&&11>=Ji),jh=" ",Oh=!1;function Lh(s,i){switch(s){case"keyup":return g_.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qh(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Or=!1;function x_(s,i){switch(s){case"compositionend":return qh(i);case"keypress":return i.which!==32?null:(Oh=!0,jh);case"textInput":return s=i.data,s===jh&&Oh?null:s;default:return null}}function v_(s,i){if(Or)return s==="compositionend"||!Ec&&Lh(s,i)?(s=Rh(),ro=vc=vs=null,Or=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Uh&&i.locale!=="ko"?null:i.data;default:return null}}var b_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bh(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!b_[s.type]:i==="textarea"}function Vh(s,i,l,u){Ur?jr?jr.push(u):jr=[u]:Ur=u,i=Wo(i,"onChange"),0<i.length&&(l=new oo("onChange","change",null,l,u),s.push({event:l,listeners:i}))}var Yi=null,Ki=null;function w_(s){S0(s,0)}function co(s){var i=Gi(s);if(_h(i))return s}function Gh(s,i){if(s==="change")return i}var Hh=!1;if(Kn){var Tc;if(Kn){var Nc="oninput"in document;if(!Nc){var zh=document.createElement("div");zh.setAttribute("oninput","return;"),Nc=typeof zh.oninput=="function"}Tc=Nc}else Tc=!1;Hh=Tc&&(!document.documentMode||9<document.documentMode)}function Fh(){Yi&&(Yi.detachEvent("onpropertychange",$h),Ki=Yi=null)}function $h(s){if(s.propertyName==="value"&&co(Ki)){var i=[];Vh(i,Ki,s,gc(s)),Ih(w_,i)}}function __(s,i,l){s==="focusin"?(Fh(),Yi=i,Ki=l,Yi.attachEvent("onpropertychange",$h)):s==="focusout"&&Fh()}function S_(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return co(Ki)}function E_(s,i){if(s==="click")return co(i)}function T_(s,i){if(s==="input"||s==="change")return co(i)}function N_(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var en=typeof Object.is=="function"?Object.is:N_;function Qi(s,i){if(en(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),u=Object.keys(i);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var y=l[u];if(!At.call(i,y)||!en(s[y],i[y]))return!1}return!0}function Jh(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Yh(s,i){var l=Jh(s);s=0;for(var u;l;){if(l.nodeType===3){if(u=s+l.textContent.length,s<=i&&u>=i)return{node:l,offset:i-s};s=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Jh(l)}}function Kh(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?Kh(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function Qh(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=no(s.document);i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=no(s.document)}return i}function Cc(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var C_=Kn&&"documentMode"in document&&11>=document.documentMode,Lr=null,Ac=null,Xi=null,Ic=!1;function Xh(s,i,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Ic||Lr==null||Lr!==no(u)||(u=Lr,"selectionStart"in u&&Cc(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Xi&&Qi(Xi,u)||(Xi=u,u=Wo(Ac,"onSelect"),0<u.length&&(i=new oo("onSelect","select",null,i,l),s.push({event:i,listeners:u}),i.target=Lr)))}function Zs(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var qr={animationend:Zs("Animation","AnimationEnd"),animationiteration:Zs("Animation","AnimationIteration"),animationstart:Zs("Animation","AnimationStart"),transitionrun:Zs("Transition","TransitionRun"),transitionstart:Zs("Transition","TransitionStart"),transitioncancel:Zs("Transition","TransitionCancel"),transitionend:Zs("Transition","TransitionEnd")},Rc={},Wh={};Kn&&(Wh=document.createElement("div").style,"AnimationEvent"in window||(delete qr.animationend.animation,delete qr.animationiteration.animation,delete qr.animationstart.animation),"TransitionEvent"in window||delete qr.transitionend.transition);function er(s){if(Rc[s])return Rc[s];if(!qr[s])return s;var i=qr[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in Wh)return Rc[s]=i[l];return s}var Zh=er("animationend"),ep=er("animationiteration"),tp=er("animationstart"),A_=er("transitionrun"),I_=er("transitionstart"),R_=er("transitioncancel"),np=er("transitionend"),sp=new Map,Dc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Dc.push("scrollEnd");function Cn(s,i){sp.set(s,i),Xs(i,[s])}var uo=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},pn=[],Br=0,Mc=0;function fo(){for(var s=Br,i=Mc=Br=0;i<s;){var l=pn[i];pn[i++]=null;var u=pn[i];pn[i++]=null;var y=pn[i];pn[i++]=null;var b=pn[i];if(pn[i++]=null,u!==null&&y!==null){var S=u.pending;S===null?y.next=y:(y.next=S.next,S.next=y),u.pending=y}b!==0&&rp(l,y,b)}}function ho(s,i,l,u){pn[Br++]=s,pn[Br++]=i,pn[Br++]=l,pn[Br++]=u,Mc|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function Pc(s,i,l,u){return ho(s,i,l,u),po(s)}function tr(s,i){return ho(s,null,null,i),po(s)}function rp(s,i,l){s.lanes|=l;var u=s.alternate;u!==null&&(u.lanes|=l);for(var y=!1,b=s.return;b!==null;)b.childLanes|=l,u=b.alternate,u!==null&&(u.childLanes|=l),b.tag===22&&(s=b.stateNode,s===null||s._visibility&1||(y=!0)),s=b,b=b.return;return s.tag===3?(b=s.stateNode,y&&i!==null&&(y=31-Zt(l),s=b.hiddenUpdates,u=s[y],u===null?s[y]=[i]:u.push(i),i.lane=l|536870912),b):null}function po(s){if(50<va)throw va=0,Gu=null,Error(r(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var Vr={};function D_(s,i,l,u){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function tn(s,i,l,u){return new D_(s,i,l,u)}function kc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Qn(s,i){var l=s.alternate;return l===null?(l=tn(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function ip(s,i){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function mo(s,i,l,u,y,b){var S=0;if(u=s,typeof s=="function")kc(s)&&(S=1);else if(typeof s=="string")S=jS(s,l,ie.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case J:return s=tn(31,l,i,y),s.elementType=J,s.lanes=b,s;case N:return nr(l.children,y,b,i);case D:S=8,y|=24;break;case k:return s=tn(12,l,i,y|2),s.elementType=k,s.lanes=b,s;case P:return s=tn(13,l,i,y),s.elementType=P,s.lanes=b,s;case B:return s=tn(19,l,i,y),s.elementType=B,s.lanes=b,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case A:S=10;break e;case U:S=9;break e;case I:S=11;break e;case H:S=14;break e;case Q:S=16,u=null;break e}S=29,l=Error(r(130,s===null?"null":typeof s,"")),u=null}return i=tn(S,l,i,y),i.elementType=s,i.type=u,i.lanes=b,i}function nr(s,i,l,u){return s=tn(7,s,u,i),s.lanes=l,s}function Uc(s,i,l){return s=tn(6,s,null,i),s.lanes=l,s}function ap(s){var i=tn(18,null,null,0);return i.stateNode=s,i}function jc(s,i,l){return i=tn(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var op=new WeakMap;function mn(s,i){if(typeof s=="object"&&s!==null){var l=op.get(s);return l!==void 0?l:(i={value:s,source:i,stack:_t(i)},op.set(s,i),i)}return{value:s,source:i,stack:_t(i)}}var Gr=[],Hr=0,go=null,Wi=0,gn=[],yn=0,bs=null,Bn=1,Vn="";function Xn(s,i){Gr[Hr++]=Wi,Gr[Hr++]=go,go=s,Wi=i}function lp(s,i,l){gn[yn++]=Bn,gn[yn++]=Vn,gn[yn++]=bs,bs=s;var u=Bn;s=Vn;var y=32-Zt(u)-1;u&=~(1<<y),l+=1;var b=32-Zt(i)+y;if(30<b){var S=y-y%5;b=(u&(1<<S)-1).toString(32),u>>=S,y-=S,Bn=1<<32-Zt(i)+y|l<<y|u,Vn=b+s}else Bn=1<<b|l<<y|u,Vn=s}function Oc(s){s.return!==null&&(Xn(s,1),lp(s,1,0))}function Lc(s){for(;s===go;)go=Gr[--Hr],Gr[Hr]=null,Wi=Gr[--Hr],Gr[Hr]=null;for(;s===bs;)bs=gn[--yn],gn[yn]=null,Vn=gn[--yn],gn[yn]=null,Bn=gn[--yn],gn[yn]=null}function cp(s,i){gn[yn++]=Bn,gn[yn++]=Vn,gn[yn++]=bs,Bn=i.id,Vn=i.overflow,bs=s}var Rt=null,at=null,Ge=!1,ws=null,xn=!1,qc=Error(r(519));function _s(s){var i=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Zi(mn(i,s)),qc}function up(s){var i=s.stateNode,l=s.type,u=s.memoizedProps;switch(i[It]=s,i[Ht]=u,l){case"dialog":Le("cancel",i),Le("close",i);break;case"iframe":case"object":case"embed":Le("load",i);break;case"video":case"audio":for(l=0;l<wa.length;l++)Le(wa[l],i);break;case"source":Le("error",i);break;case"img":case"image":case"link":Le("error",i),Le("load",i);break;case"details":Le("toggle",i);break;case"input":Le("invalid",i),Sh(i,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":Le("invalid",i);break;case"textarea":Le("invalid",i),Th(i,u.value,u.defaultValue,u.children)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||u.suppressHydrationWarning===!0||C0(i.textContent,l)?(u.popover!=null&&(Le("beforetoggle",i),Le("toggle",i)),u.onScroll!=null&&Le("scroll",i),u.onScrollEnd!=null&&Le("scrollend",i),u.onClick!=null&&(i.onclick=Yn),i=!0):i=!1,i||_s(s,!0)}function dp(s){for(Rt=s.return;Rt;)switch(Rt.tag){case 5:case 31:case 13:xn=!1;return;case 27:case 3:xn=!0;return;default:Rt=Rt.return}}function zr(s){if(s!==Rt)return!1;if(!Ge)return dp(s),Ge=!0,!1;var i=s.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||sd(s.type,s.memoizedProps)),l=!l),l&&at&&_s(s),dp(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));at=j0(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));at=j0(s)}else i===27?(i=at,js(s.type)?(s=ld,ld=null,at=s):at=i):at=Rt?bn(s.stateNode.nextSibling):null;return!0}function sr(){at=Rt=null,Ge=!1}function Bc(){var s=ws;return s!==null&&(Yt===null?Yt=s:Yt.push.apply(Yt,s),ws=null),s}function Zi(s){ws===null?ws=[s]:ws.push(s)}var Vc=M(null),rr=null,Wn=null;function Ss(s,i,l){K(Vc,i._currentValue),i._currentValue=l}function Zn(s){s._currentValue=Vc.current,q(Vc)}function Gc(s,i,l){for(;s!==null;){var u=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,u!==null&&(u.childLanes|=i)):u!==null&&(u.childLanes&i)!==i&&(u.childLanes|=i),s===l)break;s=s.return}}function Hc(s,i,l,u){var y=s.child;for(y!==null&&(y.return=s);y!==null;){var b=y.dependencies;if(b!==null){var S=y.child;b=b.firstContext;e:for(;b!==null;){var T=b;b=y;for(var j=0;j<i.length;j++)if(T.context===i[j]){b.lanes|=l,T=b.alternate,T!==null&&(T.lanes|=l),Gc(b.return,l,s),u||(S=null);break e}b=T.next}}else if(y.tag===18){if(S=y.return,S===null)throw Error(r(341));S.lanes|=l,b=S.alternate,b!==null&&(b.lanes|=l),Gc(S,l,s),S=null}else S=y.child;if(S!==null)S.return=y;else for(S=y;S!==null;){if(S===s){S=null;break}if(y=S.sibling,y!==null){y.return=S.return,S=y;break}S=S.return}y=S}}function Fr(s,i,l,u){s=null;for(var y=i,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var S=y.alternate;if(S===null)throw Error(r(387));if(S=S.memoizedProps,S!==null){var T=y.type;en(y.pendingProps.value,S.value)||(s!==null?s.push(T):s=[T])}}else if(y===Te.current){if(S=y.alternate,S===null)throw Error(r(387));S.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(s!==null?s.push(Na):s=[Na])}y=y.return}s!==null&&Hc(i,s,l,u),i.flags|=262144}function yo(s){for(s=s.firstContext;s!==null;){if(!en(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ir(s){rr=s,Wn=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Dt(s){return fp(rr,s)}function xo(s,i){return rr===null&&ir(s),fp(s,i)}function fp(s,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},Wn===null){if(s===null)throw Error(r(308));Wn=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else Wn=Wn.next=i;return l}var M_=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(l,u){s.push(u)}};this.abort=function(){i.aborted=!0,s.forEach(function(l){return l()})}},P_=t.unstable_scheduleCallback,k_=t.unstable_NormalPriority,yt={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zc(){return{controller:new M_,data:new Map,refCount:0}}function ea(s){s.refCount--,s.refCount===0&&P_(k_,function(){s.controller.abort()})}var ta=null,Fc=0,$r=0,Jr=null;function U_(s,i){if(ta===null){var l=ta=[];Fc=0,$r=Yu(),Jr={status:"pending",value:void 0,then:function(u){l.push(u)}}}return Fc++,i.then(hp,hp),i}function hp(){if(--Fc===0&&ta!==null){Jr!==null&&(Jr.status="fulfilled");var s=ta;ta=null,$r=0,Jr=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function j_(s,i){var l=[],u={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return s.then(function(){u.status="fulfilled",u.value=i;for(var y=0;y<l.length;y++)(0,l[y])(i)},function(y){for(u.status="rejected",u.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),u}var pp=R.S;R.S=function(s,i){Xm=oe(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&U_(s,i),pp!==null&&pp(s,i)};var ar=M(null);function $c(){var s=ar.current;return s!==null?s:nt.pooledCache}function vo(s,i){i===null?K(ar,ar.current):K(ar,i.pool)}function mp(){var s=$c();return s===null?null:{parent:yt._currentValue,pool:s}}var Yr=Error(r(460)),Jc=Error(r(474)),bo=Error(r(542)),wo={then:function(){}};function gp(s){return s=s.status,s==="fulfilled"||s==="rejected"}function yp(s,i,l){switch(l=s[l],l===void 0?s.push(i):l!==i&&(i.then(Yn,Yn),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,vp(s),s;default:if(typeof i.status=="string")i.then(Yn,Yn);else{if(s=nt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=i,s.status="pending",s.then(function(u){if(i.status==="pending"){var y=i;y.status="fulfilled",y.value=u}},function(u){if(i.status==="pending"){var y=i;y.status="rejected",y.reason=u}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,vp(s),s}throw lr=i,Yr}}function or(s){try{var i=s._init;return i(s._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(lr=l,Yr):l}}var lr=null;function xp(){if(lr===null)throw Error(r(459));var s=lr;return lr=null,s}function vp(s){if(s===Yr||s===bo)throw Error(r(483))}var Kr=null,na=0;function _o(s){var i=na;return na+=1,Kr===null&&(Kr=[]),yp(Kr,s,i)}function sa(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function So(s,i){throw i.$$typeof===w?Error(r(525)):(s=Object.prototype.toString.call(i),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function bp(s){function i(V,L){if(s){var z=V.deletions;z===null?(V.deletions=[L],V.flags|=16):z.push(L)}}function l(V,L){if(!s)return null;for(;L!==null;)i(V,L),L=L.sibling;return null}function u(V){for(var L=new Map;V!==null;)V.key!==null?L.set(V.key,V):L.set(V.index,V),V=V.sibling;return L}function y(V,L){return V=Qn(V,L),V.index=0,V.sibling=null,V}function b(V,L,z){return V.index=z,s?(z=V.alternate,z!==null?(z=z.index,z<L?(V.flags|=67108866,L):z):(V.flags|=67108866,L)):(V.flags|=1048576,L)}function S(V){return s&&V.alternate===null&&(V.flags|=67108866),V}function T(V,L,z,te){return L===null||L.tag!==6?(L=Uc(z,V.mode,te),L.return=V,L):(L=y(L,z),L.return=V,L)}function j(V,L,z,te){var Ce=z.type;return Ce===N?W(V,L,z.props.children,te,z.key):L!==null&&(L.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===Q&&or(Ce)===L.type)?(L=y(L,z.props),sa(L,z),L.return=V,L):(L=mo(z.type,z.key,z.props,null,V.mode,te),sa(L,z),L.return=V,L)}function F(V,L,z,te){return L===null||L.tag!==4||L.stateNode.containerInfo!==z.containerInfo||L.stateNode.implementation!==z.implementation?(L=jc(z,V.mode,te),L.return=V,L):(L=y(L,z.children||[]),L.return=V,L)}function W(V,L,z,te,Ce){return L===null||L.tag!==7?(L=nr(z,V.mode,te,Ce),L.return=V,L):(L=y(L,z),L.return=V,L)}function se(V,L,z){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return L=Uc(""+L,V.mode,z),L.return=V,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case _:return z=mo(L.type,L.key,L.props,null,V.mode,z),sa(z,L),z.return=V,z;case E:return L=jc(L,V.mode,z),L.return=V,L;case Q:return L=or(L),se(V,L,z)}if(Me(L)||ae(L))return L=nr(L,V.mode,z,null),L.return=V,L;if(typeof L.then=="function")return se(V,_o(L),z);if(L.$$typeof===A)return se(V,xo(V,L),z);So(V,L)}return null}function $(V,L,z,te){var Ce=L!==null?L.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return Ce!==null?null:T(V,L,""+z,te);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case _:return z.key===Ce?j(V,L,z,te):null;case E:return z.key===Ce?F(V,L,z,te):null;case Q:return z=or(z),$(V,L,z,te)}if(Me(z)||ae(z))return Ce!==null?null:W(V,L,z,te,null);if(typeof z.then=="function")return $(V,L,_o(z),te);if(z.$$typeof===A)return $(V,L,xo(V,z),te);So(V,z)}return null}function Y(V,L,z,te,Ce){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return V=V.get(z)||null,T(L,V,""+te,Ce);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case _:return V=V.get(te.key===null?z:te.key)||null,j(L,V,te,Ce);case E:return V=V.get(te.key===null?z:te.key)||null,F(L,V,te,Ce);case Q:return te=or(te),Y(V,L,z,te,Ce)}if(Me(te)||ae(te))return V=V.get(z)||null,W(L,V,te,Ce,null);if(typeof te.then=="function")return Y(V,L,z,_o(te),Ce);if(te.$$typeof===A)return Y(V,L,z,xo(L,te),Ce);So(L,te)}return null}function ge(V,L,z,te){for(var Ce=null,Fe=null,we=L,Ue=L=0,Be=null;we!==null&&Ue<z.length;Ue++){we.index>Ue?(Be=we,we=null):Be=we.sibling;var $e=$(V,we,z[Ue],te);if($e===null){we===null&&(we=Be);break}s&&we&&$e.alternate===null&&i(V,we),L=b($e,L,Ue),Fe===null?Ce=$e:Fe.sibling=$e,Fe=$e,we=Be}if(Ue===z.length)return l(V,we),Ge&&Xn(V,Ue),Ce;if(we===null){for(;Ue<z.length;Ue++)we=se(V,z[Ue],te),we!==null&&(L=b(we,L,Ue),Fe===null?Ce=we:Fe.sibling=we,Fe=we);return Ge&&Xn(V,Ue),Ce}for(we=u(we);Ue<z.length;Ue++)Be=Y(we,V,Ue,z[Ue],te),Be!==null&&(s&&Be.alternate!==null&&we.delete(Be.key===null?Ue:Be.key),L=b(Be,L,Ue),Fe===null?Ce=Be:Fe.sibling=Be,Fe=Be);return s&&we.forEach(function(Vs){return i(V,Vs)}),Ge&&Xn(V,Ue),Ce}function Ae(V,L,z,te){if(z==null)throw Error(r(151));for(var Ce=null,Fe=null,we=L,Ue=L=0,Be=null,$e=z.next();we!==null&&!$e.done;Ue++,$e=z.next()){we.index>Ue?(Be=we,we=null):Be=we.sibling;var Vs=$(V,we,$e.value,te);if(Vs===null){we===null&&(we=Be);break}s&&we&&Vs.alternate===null&&i(V,we),L=b(Vs,L,Ue),Fe===null?Ce=Vs:Fe.sibling=Vs,Fe=Vs,we=Be}if($e.done)return l(V,we),Ge&&Xn(V,Ue),Ce;if(we===null){for(;!$e.done;Ue++,$e=z.next())$e=se(V,$e.value,te),$e!==null&&(L=b($e,L,Ue),Fe===null?Ce=$e:Fe.sibling=$e,Fe=$e);return Ge&&Xn(V,Ue),Ce}for(we=u(we);!$e.done;Ue++,$e=z.next())$e=Y(we,V,Ue,$e.value,te),$e!==null&&(s&&$e.alternate!==null&&we.delete($e.key===null?Ue:$e.key),L=b($e,L,Ue),Fe===null?Ce=$e:Fe.sibling=$e,Fe=$e);return s&&we.forEach(function(JS){return i(V,JS)}),Ge&&Xn(V,Ue),Ce}function et(V,L,z,te){if(typeof z=="object"&&z!==null&&z.type===N&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case _:e:{for(var Ce=z.key;L!==null;){if(L.key===Ce){if(Ce=z.type,Ce===N){if(L.tag===7){l(V,L.sibling),te=y(L,z.props.children),te.return=V,V=te;break e}}else if(L.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===Q&&or(Ce)===L.type){l(V,L.sibling),te=y(L,z.props),sa(te,z),te.return=V,V=te;break e}l(V,L);break}else i(V,L);L=L.sibling}z.type===N?(te=nr(z.props.children,V.mode,te,z.key),te.return=V,V=te):(te=mo(z.type,z.key,z.props,null,V.mode,te),sa(te,z),te.return=V,V=te)}return S(V);case E:e:{for(Ce=z.key;L!==null;){if(L.key===Ce)if(L.tag===4&&L.stateNode.containerInfo===z.containerInfo&&L.stateNode.implementation===z.implementation){l(V,L.sibling),te=y(L,z.children||[]),te.return=V,V=te;break e}else{l(V,L);break}else i(V,L);L=L.sibling}te=jc(z,V.mode,te),te.return=V,V=te}return S(V);case Q:return z=or(z),et(V,L,z,te)}if(Me(z))return ge(V,L,z,te);if(ae(z)){if(Ce=ae(z),typeof Ce!="function")throw Error(r(150));return z=Ce.call(z),Ae(V,L,z,te)}if(typeof z.then=="function")return et(V,L,_o(z),te);if(z.$$typeof===A)return et(V,L,xo(V,z),te);So(V,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,L!==null&&L.tag===6?(l(V,L.sibling),te=y(L,z),te.return=V,V=te):(l(V,L),te=Uc(z,V.mode,te),te.return=V,V=te),S(V)):l(V,L)}return function(V,L,z,te){try{na=0;var Ce=et(V,L,z,te);return Kr=null,Ce}catch(we){if(we===Yr||we===bo)throw we;var Fe=tn(29,we,null,V.mode);return Fe.lanes=te,Fe.return=V,Fe}finally{}}}var cr=bp(!0),wp=bp(!1),Es=!1;function Yc(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Kc(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ts(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ns(s,i,l){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,(Ye&2)!==0){var y=u.pending;return y===null?i.next=i:(i.next=y.next,y.next=i),u.pending=i,i=po(s),rp(s,null,l),i}return ho(s,u,i,l),po(s)}function ra(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var u=i.lanes;u&=s.pendingLanes,l|=u,i.lanes=l,fh(s,l)}}function Qc(s,i){var l=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var y=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var S={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};b===null?y=b=S:b=b.next=S,l=l.next}while(l!==null);b===null?y=b=i:b=b.next=i}else y=b=i;l={baseState:u.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:u.shared,callbacks:u.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}var Xc=!1;function ia(){if(Xc){var s=Jr;if(s!==null)throw s}}function aa(s,i,l,u){Xc=!1;var y=s.updateQueue;Es=!1;var b=y.firstBaseUpdate,S=y.lastBaseUpdate,T=y.shared.pending;if(T!==null){y.shared.pending=null;var j=T,F=j.next;j.next=null,S===null?b=F:S.next=F,S=j;var W=s.alternate;W!==null&&(W=W.updateQueue,T=W.lastBaseUpdate,T!==S&&(T===null?W.firstBaseUpdate=F:T.next=F,W.lastBaseUpdate=j))}if(b!==null){var se=y.baseState;S=0,W=F=j=null,T=b;do{var $=T.lane&-536870913,Y=$!==T.lane;if(Y?(qe&$)===$:(u&$)===$){$!==0&&$===$r&&(Xc=!0),W!==null&&(W=W.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var ge=s,Ae=T;$=i;var et=l;switch(Ae.tag){case 1:if(ge=Ae.payload,typeof ge=="function"){se=ge.call(et,se,$);break e}se=ge;break e;case 3:ge.flags=ge.flags&-65537|128;case 0:if(ge=Ae.payload,$=typeof ge=="function"?ge.call(et,se,$):ge,$==null)break e;se=v({},se,$);break e;case 2:Es=!0}}$=T.callback,$!==null&&(s.flags|=64,Y&&(s.flags|=8192),Y=y.callbacks,Y===null?y.callbacks=[$]:Y.push($))}else Y={lane:$,tag:T.tag,payload:T.payload,callback:T.callback,next:null},W===null?(F=W=Y,j=se):W=W.next=Y,S|=$;if(T=T.next,T===null){if(T=y.shared.pending,T===null)break;Y=T,T=Y.next,Y.next=null,y.lastBaseUpdate=Y,y.shared.pending=null}}while(!0);W===null&&(j=se),y.baseState=j,y.firstBaseUpdate=F,y.lastBaseUpdate=W,b===null&&(y.shared.lanes=0),Ds|=S,s.lanes=S,s.memoizedState=se}}function _p(s,i){if(typeof s!="function")throw Error(r(191,s));s.call(i)}function Sp(s,i){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)_p(l[s],i)}var Qr=M(null),Eo=M(0);function Ep(s,i){s=ls,K(Eo,s),K(Qr,i),ls=s|i.baseLanes}function Wc(){K(Eo,ls),K(Qr,Qr.current)}function Zc(){ls=Eo.current,q(Qr),q(Eo)}var nn=M(null),vn=null;function Cs(s){var i=s.alternate;K(pt,pt.current&1),K(nn,s),vn===null&&(i===null||Qr.current!==null||i.memoizedState!==null)&&(vn=s)}function eu(s){K(pt,pt.current),K(nn,s),vn===null&&(vn=s)}function Tp(s){s.tag===22?(K(pt,pt.current),K(nn,s),vn===null&&(vn=s)):As()}function As(){K(pt,pt.current),K(nn,nn.current)}function sn(s){q(nn),vn===s&&(vn=null),q(pt)}var pt=M(0);function To(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||ad(l)||od(l)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var es=0,ke=null,We=null,xt=null,No=!1,Xr=!1,ur=!1,Co=0,oa=0,Wr=null,O_=0;function dt(){throw Error(r(321))}function tu(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!en(s[l],i[l]))return!1;return!0}function nu(s,i,l,u,y,b){return es=b,ke=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,R.H=s===null||s.memoizedState===null?lm:yu,ur=!1,b=l(u,y),ur=!1,Xr&&(b=Cp(i,l,u,y)),Np(s),b}function Np(s){R.H=ua;var i=We!==null&&We.next!==null;if(es=0,xt=We=ke=null,No=!1,oa=0,Wr=null,i)throw Error(r(300));s===null||vt||(s=s.dependencies,s!==null&&yo(s)&&(vt=!0))}function Cp(s,i,l,u){ke=s;var y=0;do{if(Xr&&(Wr=null),oa=0,Xr=!1,25<=y)throw Error(r(301));if(y+=1,xt=We=null,s.updateQueue!=null){var b=s.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}R.H=cm,b=i(l,u)}while(Xr);return b}function L_(){var s=R.H,i=s.useState()[0];return i=typeof i.then=="function"?la(i):i,s=s.useState()[0],(We!==null?We.memoizedState:null)!==s&&(ke.flags|=1024),i}function su(){var s=Co!==0;return Co=0,s}function ru(s,i,l){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~l}function iu(s){if(No){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}No=!1}es=0,xt=We=ke=null,Xr=!1,oa=Co=0,Wr=null}function qt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xt===null?ke.memoizedState=xt=s:xt=xt.next=s,xt}function mt(){if(We===null){var s=ke.alternate;s=s!==null?s.memoizedState:null}else s=We.next;var i=xt===null?ke.memoizedState:xt.next;if(i!==null)xt=i,We=s;else{if(s===null)throw ke.alternate===null?Error(r(467)):Error(r(310));We=s,s={memoizedState:We.memoizedState,baseState:We.baseState,baseQueue:We.baseQueue,queue:We.queue,next:null},xt===null?ke.memoizedState=xt=s:xt=xt.next=s}return xt}function Ao(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function la(s){var i=oa;return oa+=1,Wr===null&&(Wr=[]),s=yp(Wr,s,i),i=ke,(xt===null?i.memoizedState:xt.next)===null&&(i=i.alternate,R.H=i===null||i.memoizedState===null?lm:yu),s}function Io(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return la(s);if(s.$$typeof===A)return Dt(s)}throw Error(r(438,String(s)))}function au(s){var i=null,l=ke.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var u=ke.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(i={data:u.data.map(function(y){return y.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=Ao(),ke.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(s),u=0;u<s;u++)l[u]=O;return i.index++,l}function ts(s,i){return typeof i=="function"?i(s):i}function Ro(s){var i=mt();return ou(i,We,s)}function ou(s,i,l){var u=s.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=l;var y=s.baseQueue,b=u.pending;if(b!==null){if(y!==null){var S=y.next;y.next=b.next,b.next=S}i.baseQueue=y=b,u.pending=null}if(b=s.baseState,y===null)s.memoizedState=b;else{i=y.next;var T=S=null,j=null,F=i,W=!1;do{var se=F.lane&-536870913;if(se!==F.lane?(qe&se)===se:(es&se)===se){var $=F.revertLane;if($===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),se===$r&&(W=!0);else if((es&$)===$){F=F.next,$===$r&&(W=!0);continue}else se={lane:0,revertLane:F.revertLane,gesture:null,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},j===null?(T=j=se,S=b):j=j.next=se,ke.lanes|=$,Ds|=$;se=F.action,ur&&l(b,se),b=F.hasEagerState?F.eagerState:l(b,se)}else $={lane:se,revertLane:F.revertLane,gesture:F.gesture,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},j===null?(T=j=$,S=b):j=j.next=$,ke.lanes|=se,Ds|=se;F=F.next}while(F!==null&&F!==i);if(j===null?S=b:j.next=T,!en(b,s.memoizedState)&&(vt=!0,W&&(l=Jr,l!==null)))throw l;s.memoizedState=b,s.baseState=S,s.baseQueue=j,u.lastRenderedState=b}return y===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function lu(s){var i=mt(),l=i.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=s;var u=l.dispatch,y=l.pending,b=i.memoizedState;if(y!==null){l.pending=null;var S=y=y.next;do b=s(b,S.action),S=S.next;while(S!==y);en(b,i.memoizedState)||(vt=!0),i.memoizedState=b,i.baseQueue===null&&(i.baseState=b),l.lastRenderedState=b}return[b,u]}function Ap(s,i,l){var u=ke,y=mt(),b=Ge;if(b){if(l===void 0)throw Error(r(407));l=l()}else l=i();var S=!en((We||y).memoizedState,l);if(S&&(y.memoizedState=l,vt=!0),y=y.queue,du(Dp.bind(null,u,y,s),[s]),y.getSnapshot!==i||S||xt!==null&&xt.memoizedState.tag&1){if(u.flags|=2048,Zr(9,{destroy:void 0},Rp.bind(null,u,y,l,i),null),nt===null)throw Error(r(349));b||(es&127)!==0||Ip(u,i,l)}return l}function Ip(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=ke.updateQueue,i===null?(i=Ao(),ke.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function Rp(s,i,l,u){i.value=l,i.getSnapshot=u,Mp(i)&&Pp(s)}function Dp(s,i,l){return l(function(){Mp(i)&&Pp(s)})}function Mp(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!en(s,l)}catch{return!0}}function Pp(s){var i=tr(s,2);i!==null&&Kt(i,s,2)}function cu(s){var i=qt();if(typeof s=="function"){var l=s;if(s=l(),ur){ys(!0);try{l()}finally{ys(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:s},i}function kp(s,i,l,u){return s.baseState=l,ou(s,We,typeof u=="function"?u:ts)}function q_(s,i,l,u,y){if(Po(s))throw Error(r(485));if(s=i.action,s!==null){var b={payload:y,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){b.listeners.push(S)}};R.T!==null?l(!0):b.isTransition=!1,u(b),l=i.pending,l===null?(b.next=i.pending=b,Up(i,b)):(b.next=l.next,i.pending=l.next=b)}}function Up(s,i){var l=i.action,u=i.payload,y=s.state;if(i.isTransition){var b=R.T,S={};R.T=S;try{var T=l(y,u),j=R.S;j!==null&&j(S,T),jp(s,i,T)}catch(F){uu(s,i,F)}finally{b!==null&&S.types!==null&&(b.types=S.types),R.T=b}}else try{b=l(y,u),jp(s,i,b)}catch(F){uu(s,i,F)}}function jp(s,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){Op(s,i,u)},function(u){return uu(s,i,u)}):Op(s,i,l)}function Op(s,i,l){i.status="fulfilled",i.value=l,Lp(i),s.state=l,i=s.pending,i!==null&&(l=i.next,l===i?s.pending=null:(l=l.next,i.next=l,Up(s,l)))}function uu(s,i,l){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do i.status="rejected",i.reason=l,Lp(i),i=i.next;while(i!==u)}s.action=null}function Lp(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function qp(s,i){return i}function Bp(s,i){if(Ge){var l=nt.formState;if(l!==null){e:{var u=ke;if(Ge){if(at){t:{for(var y=at,b=xn;y.nodeType!==8;){if(!b){y=null;break t}if(y=bn(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){at=bn(y.nextSibling),u=y.data==="F!";break e}}_s(u)}u=!1}u&&(i=l[0])}}return l=qt(),l.memoizedState=l.baseState=i,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qp,lastRenderedState:i},l.queue=u,l=im.bind(null,ke,u),u.dispatch=l,u=cu(!1),b=gu.bind(null,ke,!1,u.queue),u=qt(),y={state:i,dispatch:null,action:s,pending:null},u.queue=y,l=q_.bind(null,ke,y,b,l),y.dispatch=l,u.memoizedState=s,[i,l,!1]}function Vp(s){var i=mt();return Gp(i,We,s)}function Gp(s,i,l){if(i=ou(s,i,qp)[0],s=Ro(ts)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var u=la(i)}catch(S){throw S===Yr?bo:S}else u=i;i=mt();var y=i.queue,b=y.dispatch;return l!==i.memoizedState&&(ke.flags|=2048,Zr(9,{destroy:void 0},B_.bind(null,y,l),null)),[u,b,s]}function B_(s,i){s.action=i}function Hp(s){var i=mt(),l=We;if(l!==null)return Gp(i,l,s);mt(),i=i.memoizedState,l=mt();var u=l.queue.dispatch;return l.memoizedState=s,[i,u,!1]}function Zr(s,i,l,u){return s={tag:s,create:l,deps:u,inst:i,next:null},i=ke.updateQueue,i===null&&(i=Ao(),ke.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=s.next=s:(u=l.next,l.next=s,s.next=u,i.lastEffect=s),s}function zp(){return mt().memoizedState}function Do(s,i,l,u){var y=qt();ke.flags|=s,y.memoizedState=Zr(1|i,{destroy:void 0},l,u===void 0?null:u)}function Mo(s,i,l,u){var y=mt();u=u===void 0?null:u;var b=y.memoizedState.inst;We!==null&&u!==null&&tu(u,We.memoizedState.deps)?y.memoizedState=Zr(i,b,l,u):(ke.flags|=s,y.memoizedState=Zr(1|i,b,l,u))}function Fp(s,i){Do(8390656,8,s,i)}function du(s,i){Mo(2048,8,s,i)}function V_(s){ke.flags|=4;var i=ke.updateQueue;if(i===null)i=Ao(),ke.updateQueue=i,i.events=[s];else{var l=i.events;l===null?i.events=[s]:l.push(s)}}function $p(s){var i=mt().memoizedState;return V_({ref:i,nextImpl:s}),function(){if((Ye&2)!==0)throw Error(r(440));return i.impl.apply(void 0,arguments)}}function Jp(s,i){return Mo(4,2,s,i)}function Yp(s,i){return Mo(4,4,s,i)}function Kp(s,i){if(typeof i=="function"){s=s();var l=i(s);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function Qp(s,i,l){l=l!=null?l.concat([s]):null,Mo(4,4,Kp.bind(null,i,s),l)}function fu(){}function Xp(s,i){var l=mt();i=i===void 0?null:i;var u=l.memoizedState;return i!==null&&tu(i,u[1])?u[0]:(l.memoizedState=[s,i],s)}function Wp(s,i){var l=mt();i=i===void 0?null:i;var u=l.memoizedState;if(i!==null&&tu(i,u[1]))return u[0];if(u=s(),ur){ys(!0);try{s()}finally{ys(!1)}}return l.memoizedState=[u,i],u}function hu(s,i,l){return l===void 0||(es&1073741824)!==0&&(qe&261930)===0?s.memoizedState=i:(s.memoizedState=l,s=Zm(),ke.lanes|=s,Ds|=s,l)}function Zp(s,i,l,u){return en(l,i)?l:Qr.current!==null?(s=hu(s,l,u),en(s,i)||(vt=!0),s):(es&42)===0||(es&1073741824)!==0&&(qe&261930)===0?(vt=!0,s.memoizedState=l):(s=Zm(),ke.lanes|=s,Ds|=s,i)}function em(s,i,l,u,y){var b=G.p;G.p=b!==0&&8>b?b:8;var S=R.T,T={};R.T=T,gu(s,!1,i,l);try{var j=y(),F=R.S;if(F!==null&&F(T,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var W=j_(j,u);ca(s,i,W,on(s))}else ca(s,i,u,on(s))}catch(se){ca(s,i,{then:function(){},status:"rejected",reason:se},on())}finally{G.p=b,S!==null&&T.types!==null&&(S.types=T.types),R.T=S}}function G_(){}function pu(s,i,l,u){if(s.tag!==5)throw Error(r(476));var y=tm(s).queue;em(s,y,i,X,l===null?G_:function(){return nm(s),l(u)})}function tm(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:X},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:l},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function nm(s){var i=tm(s);i.next===null&&(i=s.alternate.memoizedState),ca(s,i.next.queue,{},on())}function mu(){return Dt(Na)}function sm(){return mt().memoizedState}function rm(){return mt().memoizedState}function H_(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var l=on();s=Ts(l);var u=Ns(i,s,l);u!==null&&(Kt(u,i,l),ra(u,i,l)),i={cache:zc()},s.payload=i;return}i=i.return}}function z_(s,i,l){var u=on();l={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Po(s)?am(i,l):(l=Pc(s,i,l,u),l!==null&&(Kt(l,s,u),om(l,i,u)))}function im(s,i,l){var u=on();ca(s,i,l,u)}function ca(s,i,l,u){var y={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Po(s))am(i,y);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=i.lastRenderedReducer,b!==null))try{var S=i.lastRenderedState,T=b(S,l);if(y.hasEagerState=!0,y.eagerState=T,en(T,S))return ho(s,i,y,0),nt===null&&fo(),!1}catch{}finally{}if(l=Pc(s,i,y,u),l!==null)return Kt(l,s,u),om(l,i,u),!0}return!1}function gu(s,i,l,u){if(u={lane:2,revertLane:Yu(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Po(s)){if(i)throw Error(r(479))}else i=Pc(s,l,u,2),i!==null&&Kt(i,s,2)}function Po(s){var i=s.alternate;return s===ke||i!==null&&i===ke}function am(s,i){Xr=No=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function om(s,i,l){if((l&4194048)!==0){var u=i.lanes;u&=s.pendingLanes,l|=u,i.lanes=l,fh(s,l)}}var ua={readContext:Dt,use:Io,useCallback:dt,useContext:dt,useEffect:dt,useImperativeHandle:dt,useLayoutEffect:dt,useInsertionEffect:dt,useMemo:dt,useReducer:dt,useRef:dt,useState:dt,useDebugValue:dt,useDeferredValue:dt,useTransition:dt,useSyncExternalStore:dt,useId:dt,useHostTransitionStatus:dt,useFormState:dt,useActionState:dt,useOptimistic:dt,useMemoCache:dt,useCacheRefresh:dt};ua.useEffectEvent=dt;var lm={readContext:Dt,use:Io,useCallback:function(s,i){return qt().memoizedState=[s,i===void 0?null:i],s},useContext:Dt,useEffect:Fp,useImperativeHandle:function(s,i,l){l=l!=null?l.concat([s]):null,Do(4194308,4,Kp.bind(null,i,s),l)},useLayoutEffect:function(s,i){return Do(4194308,4,s,i)},useInsertionEffect:function(s,i){Do(4,2,s,i)},useMemo:function(s,i){var l=qt();i=i===void 0?null:i;var u=s();if(ur){ys(!0);try{s()}finally{ys(!1)}}return l.memoizedState=[u,i],u},useReducer:function(s,i,l){var u=qt();if(l!==void 0){var y=l(i);if(ur){ys(!0);try{l(i)}finally{ys(!1)}}}else y=i;return u.memoizedState=u.baseState=y,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:y},u.queue=s,s=s.dispatch=z_.bind(null,ke,s),[u.memoizedState,s]},useRef:function(s){var i=qt();return s={current:s},i.memoizedState=s},useState:function(s){s=cu(s);var i=s.queue,l=im.bind(null,ke,i);return i.dispatch=l,[s.memoizedState,l]},useDebugValue:fu,useDeferredValue:function(s,i){var l=qt();return hu(l,s,i)},useTransition:function(){var s=cu(!1);return s=em.bind(null,ke,s.queue,!0,!1),qt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,l){var u=ke,y=qt();if(Ge){if(l===void 0)throw Error(r(407));l=l()}else{if(l=i(),nt===null)throw Error(r(349));(qe&127)!==0||Ip(u,i,l)}y.memoizedState=l;var b={value:l,getSnapshot:i};return y.queue=b,Fp(Dp.bind(null,u,b,s),[s]),u.flags|=2048,Zr(9,{destroy:void 0},Rp.bind(null,u,b,l,i),null),l},useId:function(){var s=qt(),i=nt.identifierPrefix;if(Ge){var l=Vn,u=Bn;l=(u&~(1<<32-Zt(u)-1)).toString(32)+l,i="_"+i+"R_"+l,l=Co++,0<l&&(i+="H"+l.toString(32)),i+="_"}else l=O_++,i="_"+i+"r_"+l.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:mu,useFormState:Bp,useActionState:Bp,useOptimistic:function(s){var i=qt();i.memoizedState=i.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=gu.bind(null,ke,!0,l),l.dispatch=i,[s,i]},useMemoCache:au,useCacheRefresh:function(){return qt().memoizedState=H_.bind(null,ke)},useEffectEvent:function(s){var i=qt(),l={impl:s};return i.memoizedState=l,function(){if((Ye&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}},yu={readContext:Dt,use:Io,useCallback:Xp,useContext:Dt,useEffect:du,useImperativeHandle:Qp,useInsertionEffect:Jp,useLayoutEffect:Yp,useMemo:Wp,useReducer:Ro,useRef:zp,useState:function(){return Ro(ts)},useDebugValue:fu,useDeferredValue:function(s,i){var l=mt();return Zp(l,We.memoizedState,s,i)},useTransition:function(){var s=Ro(ts)[0],i=mt().memoizedState;return[typeof s=="boolean"?s:la(s),i]},useSyncExternalStore:Ap,useId:sm,useHostTransitionStatus:mu,useFormState:Vp,useActionState:Vp,useOptimistic:function(s,i){var l=mt();return kp(l,We,s,i)},useMemoCache:au,useCacheRefresh:rm};yu.useEffectEvent=$p;var cm={readContext:Dt,use:Io,useCallback:Xp,useContext:Dt,useEffect:du,useImperativeHandle:Qp,useInsertionEffect:Jp,useLayoutEffect:Yp,useMemo:Wp,useReducer:lu,useRef:zp,useState:function(){return lu(ts)},useDebugValue:fu,useDeferredValue:function(s,i){var l=mt();return We===null?hu(l,s,i):Zp(l,We.memoizedState,s,i)},useTransition:function(){var s=lu(ts)[0],i=mt().memoizedState;return[typeof s=="boolean"?s:la(s),i]},useSyncExternalStore:Ap,useId:sm,useHostTransitionStatus:mu,useFormState:Hp,useActionState:Hp,useOptimistic:function(s,i){var l=mt();return We!==null?kp(l,We,s,i):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:au,useCacheRefresh:rm};cm.useEffectEvent=$p;function xu(s,i,l,u){i=s.memoizedState,l=l(u,i),l=l==null?i:v({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var vu={enqueueSetState:function(s,i,l){s=s._reactInternals;var u=on(),y=Ts(u);y.payload=i,l!=null&&(y.callback=l),i=Ns(s,y,u),i!==null&&(Kt(i,s,u),ra(i,s,u))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var u=on(),y=Ts(u);y.tag=1,y.payload=i,l!=null&&(y.callback=l),i=Ns(s,y,u),i!==null&&(Kt(i,s,u),ra(i,s,u))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=on(),u=Ts(l);u.tag=2,i!=null&&(u.callback=i),i=Ns(s,u,l),i!==null&&(Kt(i,s,l),ra(i,s,l))}};function um(s,i,l,u,y,b,S){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,b,S):i.prototype&&i.prototype.isPureReactComponent?!Qi(l,u)||!Qi(y,b):!0}function dm(s,i,l,u){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,u),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,u),i.state!==s&&vu.enqueueReplaceState(i,i.state,null)}function dr(s,i){var l=i;if("ref"in i){l={};for(var u in i)u!=="ref"&&(l[u]=i[u])}if(s=s.defaultProps){l===i&&(l=v({},l));for(var y in s)l[y]===void 0&&(l[y]=s[y])}return l}function fm(s){uo(s)}function hm(s){console.error(s)}function pm(s){uo(s)}function ko(s,i){try{var l=s.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(u){setTimeout(function(){throw u})}}function mm(s,i,l){try{var u=s.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function bu(s,i,l){return l=Ts(l),l.tag=3,l.payload={element:null},l.callback=function(){ko(s,i)},l}function gm(s){return s=Ts(s),s.tag=3,s}function ym(s,i,l,u){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var b=u.value;s.payload=function(){return y(b)},s.callback=function(){mm(i,l,u)}}var S=l.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(s.callback=function(){mm(i,l,u),typeof y!="function"&&(Ms===null?Ms=new Set([this]):Ms.add(this));var T=u.stack;this.componentDidCatch(u.value,{componentStack:T!==null?T:""})})}function F_(s,i,l,u,y){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(i=l.alternate,i!==null&&Fr(i,l,y,!0),l=nn.current,l!==null){switch(l.tag){case 31:case 13:return vn===null?$o():l.alternate===null&&ft===0&&(ft=3),l.flags&=-257,l.flags|=65536,l.lanes=y,u===wo?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([u]):i.add(u),Fu(s,u,y)),!1;case 22:return l.flags|=65536,u===wo?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([u]):l.add(u)),Fu(s,u,y)),!1}throw Error(r(435,l.tag))}return Fu(s,u,y),$o(),!1}if(Ge)return i=nn.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=y,u!==qc&&(s=Error(r(422),{cause:u}),Zi(mn(s,l)))):(u!==qc&&(i=Error(r(423),{cause:u}),Zi(mn(i,l))),s=s.current.alternate,s.flags|=65536,y&=-y,s.lanes|=y,u=mn(u,l),y=bu(s.stateNode,u,y),Qc(s,y),ft!==4&&(ft=2)),!1;var b=Error(r(520),{cause:u});if(b=mn(b,l),xa===null?xa=[b]:xa.push(b),ft!==4&&(ft=2),i===null)return!0;u=mn(u,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,s=y&-y,l.lanes|=s,s=bu(l.stateNode,u,s),Qc(l,s),!1;case 1:if(i=l.type,b=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ms===null||!Ms.has(b))))return l.flags|=65536,y&=-y,l.lanes|=y,y=gm(y),ym(y,s,l,u),Qc(l,y),!1}l=l.return}while(l!==null);return!1}var wu=Error(r(461)),vt=!1;function Mt(s,i,l,u){i.child=s===null?wp(i,null,l,u):cr(i,s.child,l,u)}function xm(s,i,l,u,y){l=l.render;var b=i.ref;if("ref"in u){var S={};for(var T in u)T!=="ref"&&(S[T]=u[T])}else S=u;return ir(i),u=nu(s,i,l,S,b,y),T=su(),s!==null&&!vt?(ru(s,i,y),ns(s,i,y)):(Ge&&T&&Oc(i),i.flags|=1,Mt(s,i,u,y),i.child)}function vm(s,i,l,u,y){if(s===null){var b=l.type;return typeof b=="function"&&!kc(b)&&b.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=b,bm(s,i,b,u,y)):(s=mo(l.type,null,u,i,i.mode,y),s.ref=i.ref,s.return=i,i.child=s)}if(b=s.child,!Iu(s,y)){var S=b.memoizedProps;if(l=l.compare,l=l!==null?l:Qi,l(S,u)&&s.ref===i.ref)return ns(s,i,y)}return i.flags|=1,s=Qn(b,u),s.ref=i.ref,s.return=i,i.child=s}function bm(s,i,l,u,y){if(s!==null){var b=s.memoizedProps;if(Qi(b,u)&&s.ref===i.ref)if(vt=!1,i.pendingProps=u=b,Iu(s,y))(s.flags&131072)!==0&&(vt=!0);else return i.lanes=s.lanes,ns(s,i,y)}return _u(s,i,l,u,y)}function wm(s,i,l,u){var y=u.children,b=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((i.flags&128)!==0){if(b=b!==null?b.baseLanes|l:l,s!==null){for(u=i.child=s.child,y=0;u!==null;)y=y|u.lanes|u.childLanes,u=u.sibling;u=y&~b}else u=0,i.child=null;return _m(s,i,b,l,u)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&vo(i,b!==null?b.cachePool:null),b!==null?Ep(i,b):Wc(),Tp(i);else return u=i.lanes=536870912,_m(s,i,b!==null?b.baseLanes|l:l,l,u)}else b!==null?(vo(i,b.cachePool),Ep(i,b),As(),i.memoizedState=null):(s!==null&&vo(i,null),Wc(),As());return Mt(s,i,y,l),i.child}function da(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function _m(s,i,l,u,y){var b=$c();return b=b===null?null:{parent:yt._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},s!==null&&vo(i,null),Wc(),Tp(i),s!==null&&Fr(s,i,u,!0),i.childLanes=y,null}function Uo(s,i){return i=Oo({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function Sm(s,i,l){return cr(i,s.child,null,l),s=Uo(i,i.pendingProps),s.flags|=2,sn(i),i.memoizedState=null,s}function $_(s,i,l){var u=i.pendingProps,y=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(Ge){if(u.mode==="hidden")return s=Uo(i,u),i.lanes=536870912,da(null,s);if(eu(i),(s=at)?(s=U0(s,xn),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:bs!==null?{id:Bn,overflow:Vn}:null,retryLane:536870912,hydrationErrors:null},l=ap(s),l.return=i,i.child=l,Rt=i,at=null)):s=null,s===null)throw _s(i);return i.lanes=536870912,null}return Uo(i,u)}var b=s.memoizedState;if(b!==null){var S=b.dehydrated;if(eu(i),y)if(i.flags&256)i.flags&=-257,i=Sm(s,i,l);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(r(558));else if(vt||Fr(s,i,l,!1),y=(l&s.childLanes)!==0,vt||y){if(u=nt,u!==null&&(S=hh(u,l),S!==0&&S!==b.retryLane))throw b.retryLane=S,tr(s,S),Kt(u,s,S),wu;$o(),i=Sm(s,i,l)}else s=b.treeContext,at=bn(S.nextSibling),Rt=i,Ge=!0,ws=null,xn=!1,s!==null&&cp(i,s),i=Uo(i,u),i.flags|=4096;return i}return s=Qn(s.child,{mode:u.mode,children:u.children}),s.ref=i.ref,i.child=s,s.return=i,s}function jo(s,i){var l=i.ref;if(l===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(r(284));(s===null||s.ref!==l)&&(i.flags|=4194816)}}function _u(s,i,l,u,y){return ir(i),l=nu(s,i,l,u,void 0,y),u=su(),s!==null&&!vt?(ru(s,i,y),ns(s,i,y)):(Ge&&u&&Oc(i),i.flags|=1,Mt(s,i,l,y),i.child)}function Em(s,i,l,u,y,b){return ir(i),i.updateQueue=null,l=Cp(i,u,l,y),Np(s),u=su(),s!==null&&!vt?(ru(s,i,b),ns(s,i,b)):(Ge&&u&&Oc(i),i.flags|=1,Mt(s,i,l,b),i.child)}function Tm(s,i,l,u,y){if(ir(i),i.stateNode===null){var b=Vr,S=l.contextType;typeof S=="object"&&S!==null&&(b=Dt(S)),b=new l(u,b),i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=vu,i.stateNode=b,b._reactInternals=i,b=i.stateNode,b.props=u,b.state=i.memoizedState,b.refs={},Yc(i),S=l.contextType,b.context=typeof S=="object"&&S!==null?Dt(S):Vr,b.state=i.memoizedState,S=l.getDerivedStateFromProps,typeof S=="function"&&(xu(i,l,S,u),b.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(S=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),S!==b.state&&vu.enqueueReplaceState(b,b.state,null),aa(i,u,b,y),ia(),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308),u=!0}else if(s===null){b=i.stateNode;var T=i.memoizedProps,j=dr(l,T);b.props=j;var F=b.context,W=l.contextType;S=Vr,typeof W=="object"&&W!==null&&(S=Dt(W));var se=l.getDerivedStateFromProps;W=typeof se=="function"||typeof b.getSnapshotBeforeUpdate=="function",T=i.pendingProps!==T,W||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(T||F!==S)&&dm(i,b,u,S),Es=!1;var $=i.memoizedState;b.state=$,aa(i,u,b,y),ia(),F=i.memoizedState,T||$!==F||Es?(typeof se=="function"&&(xu(i,l,se,u),F=i.memoizedState),(j=Es||um(i,l,j,u,$,F,S))?(W||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=u,i.memoizedState=F),b.props=u,b.state=F,b.context=S,u=j):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),u=!1)}else{b=i.stateNode,Kc(s,i),S=i.memoizedProps,W=dr(l,S),b.props=W,se=i.pendingProps,$=b.context,F=l.contextType,j=Vr,typeof F=="object"&&F!==null&&(j=Dt(F)),T=l.getDerivedStateFromProps,(F=typeof T=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(S!==se||$!==j)&&dm(i,b,u,j),Es=!1,$=i.memoizedState,b.state=$,aa(i,u,b,y),ia();var Y=i.memoizedState;S!==se||$!==Y||Es||s!==null&&s.dependencies!==null&&yo(s.dependencies)?(typeof T=="function"&&(xu(i,l,T,u),Y=i.memoizedState),(W=Es||um(i,l,W,u,$,Y,j)||s!==null&&s.dependencies!==null&&yo(s.dependencies))?(F||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(u,Y,j),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(u,Y,j)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||S===s.memoizedProps&&$===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&$===s.memoizedState||(i.flags|=1024),i.memoizedProps=u,i.memoizedState=Y),b.props=u,b.state=Y,b.context=j,u=W):(typeof b.componentDidUpdate!="function"||S===s.memoizedProps&&$===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&$===s.memoizedState||(i.flags|=1024),u=!1)}return b=u,jo(s,i),u=(i.flags&128)!==0,b||u?(b=i.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:b.render(),i.flags|=1,s!==null&&u?(i.child=cr(i,s.child,null,y),i.child=cr(i,null,l,y)):Mt(s,i,l,y),i.memoizedState=b.state,s=i.child):s=ns(s,i,y),s}function Nm(s,i,l,u){return sr(),i.flags|=256,Mt(s,i,l,u),i.child}var Su={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Eu(s){return{baseLanes:s,cachePool:mp()}}function Tu(s,i,l){return s=s!==null?s.childLanes&~l:0,i&&(s|=an),s}function Cm(s,i,l){var u=i.pendingProps,y=!1,b=(i.flags&128)!==0,S;if((S=b)||(S=s!==null&&s.memoizedState===null?!1:(pt.current&2)!==0),S&&(y=!0,i.flags&=-129),S=(i.flags&32)!==0,i.flags&=-33,s===null){if(Ge){if(y?Cs(i):As(),(s=at)?(s=U0(s,xn),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:bs!==null?{id:Bn,overflow:Vn}:null,retryLane:536870912,hydrationErrors:null},l=ap(s),l.return=i,i.child=l,Rt=i,at=null)):s=null,s===null)throw _s(i);return od(s)?i.lanes=32:i.lanes=536870912,null}var T=u.children;return u=u.fallback,y?(As(),y=i.mode,T=Oo({mode:"hidden",children:T},y),u=nr(u,y,l,null),T.return=i,u.return=i,T.sibling=u,i.child=T,u=i.child,u.memoizedState=Eu(l),u.childLanes=Tu(s,S,l),i.memoizedState=Su,da(null,u)):(Cs(i),Nu(i,T))}var j=s.memoizedState;if(j!==null&&(T=j.dehydrated,T!==null)){if(b)i.flags&256?(Cs(i),i.flags&=-257,i=Cu(s,i,l)):i.memoizedState!==null?(As(),i.child=s.child,i.flags|=128,i=null):(As(),T=u.fallback,y=i.mode,u=Oo({mode:"visible",children:u.children},y),T=nr(T,y,l,null),T.flags|=2,u.return=i,T.return=i,u.sibling=T,i.child=u,cr(i,s.child,null,l),u=i.child,u.memoizedState=Eu(l),u.childLanes=Tu(s,S,l),i.memoizedState=Su,i=da(null,u));else if(Cs(i),od(T)){if(S=T.nextSibling&&T.nextSibling.dataset,S)var F=S.dgst;S=F,u=Error(r(419)),u.stack="",u.digest=S,Zi({value:u,source:null,stack:null}),i=Cu(s,i,l)}else if(vt||Fr(s,i,l,!1),S=(l&s.childLanes)!==0,vt||S){if(S=nt,S!==null&&(u=hh(S,l),u!==0&&u!==j.retryLane))throw j.retryLane=u,tr(s,u),Kt(S,s,u),wu;ad(T)||$o(),i=Cu(s,i,l)}else ad(T)?(i.flags|=192,i.child=s.child,i=null):(s=j.treeContext,at=bn(T.nextSibling),Rt=i,Ge=!0,ws=null,xn=!1,s!==null&&cp(i,s),i=Nu(i,u.children),i.flags|=4096);return i}return y?(As(),T=u.fallback,y=i.mode,j=s.child,F=j.sibling,u=Qn(j,{mode:"hidden",children:u.children}),u.subtreeFlags=j.subtreeFlags&65011712,F!==null?T=Qn(F,T):(T=nr(T,y,l,null),T.flags|=2),T.return=i,u.return=i,u.sibling=T,i.child=u,da(null,u),u=i.child,T=s.child.memoizedState,T===null?T=Eu(l):(y=T.cachePool,y!==null?(j=yt._currentValue,y=y.parent!==j?{parent:j,pool:j}:y):y=mp(),T={baseLanes:T.baseLanes|l,cachePool:y}),u.memoizedState=T,u.childLanes=Tu(s,S,l),i.memoizedState=Su,da(s.child,u)):(Cs(i),l=s.child,s=l.sibling,l=Qn(l,{mode:"visible",children:u.children}),l.return=i,l.sibling=null,s!==null&&(S=i.deletions,S===null?(i.deletions=[s],i.flags|=16):S.push(s)),i.child=l,i.memoizedState=null,l)}function Nu(s,i){return i=Oo({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function Oo(s,i){return s=tn(22,s,null,i),s.lanes=0,s}function Cu(s,i,l){return cr(i,s.child,null,l),s=Nu(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function Am(s,i,l){s.lanes|=i;var u=s.alternate;u!==null&&(u.lanes|=i),Gc(s.return,i,l)}function Au(s,i,l,u,y,b){var S=s.memoizedState;S===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:y,treeForkCount:b}:(S.isBackwards=i,S.rendering=null,S.renderingStartTime=0,S.last=u,S.tail=l,S.tailMode=y,S.treeForkCount=b)}function Im(s,i,l){var u=i.pendingProps,y=u.revealOrder,b=u.tail;u=u.children;var S=pt.current,T=(S&2)!==0;if(T?(S=S&1|2,i.flags|=128):S&=1,K(pt,S),Mt(s,i,u,l),u=Ge?Wi:0,!T&&s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Am(s,l,i);else if(s.tag===19)Am(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(y){case"forwards":for(l=i.child,y=null;l!==null;)s=l.alternate,s!==null&&To(s)===null&&(y=l),l=l.sibling;l=y,l===null?(y=i.child,i.child=null):(y=l.sibling,l.sibling=null),Au(i,!1,y,l,b,u);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=i.child,i.child=null;y!==null;){if(s=y.alternate,s!==null&&To(s)===null){i.child=y;break}s=y.sibling,y.sibling=l,l=y,y=s}Au(i,!0,l,null,b,u);break;case"together":Au(i,!1,null,null,void 0,u);break;default:i.memoizedState=null}return i.child}function ns(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),Ds|=i.lanes,(l&i.childLanes)===0)if(s!==null){if(Fr(s,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(r(153));if(i.child!==null){for(s=i.child,l=Qn(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=Qn(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function Iu(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&yo(s)))}function J_(s,i,l){switch(i.tag){case 3:ne(i,i.stateNode.containerInfo),Ss(i,yt,s.memoizedState.cache),sr();break;case 27:case 5:be(i);break;case 4:ne(i,i.stateNode.containerInfo);break;case 10:Ss(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,eu(i),null;break;case 13:var u=i.memoizedState;if(u!==null)return u.dehydrated!==null?(Cs(i),i.flags|=128,null):(l&i.child.childLanes)!==0?Cm(s,i,l):(Cs(i),s=ns(s,i,l),s!==null?s.sibling:null);Cs(i);break;case 19:var y=(s.flags&128)!==0;if(u=(l&i.childLanes)!==0,u||(Fr(s,i,l,!1),u=(l&i.childLanes)!==0),y){if(u)return Im(s,i,l);i.flags|=128}if(y=i.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),K(pt,pt.current),u)break;return null;case 22:return i.lanes=0,wm(s,i,l,i.pendingProps);case 24:Ss(i,yt,s.memoizedState.cache)}return ns(s,i,l)}function Rm(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps)vt=!0;else{if(!Iu(s,l)&&(i.flags&128)===0)return vt=!1,J_(s,i,l);vt=(s.flags&131072)!==0}else vt=!1,Ge&&(i.flags&1048576)!==0&&lp(i,Wi,i.index);switch(i.lanes=0,i.tag){case 16:e:{var u=i.pendingProps;if(s=or(i.elementType),i.type=s,typeof s=="function")kc(s)?(u=dr(s,u),i.tag=1,i=Tm(null,i,s,u,l)):(i.tag=0,i=_u(null,i,s,u,l));else{if(s!=null){var y=s.$$typeof;if(y===I){i.tag=11,i=xm(null,i,s,u,l);break e}else if(y===H){i.tag=14,i=vm(null,i,s,u,l);break e}}throw i=ye(s)||s,Error(r(306,i,""))}}return i;case 0:return _u(s,i,i.type,i.pendingProps,l);case 1:return u=i.type,y=dr(u,i.pendingProps),Tm(s,i,u,y,l);case 3:e:{if(ne(i,i.stateNode.containerInfo),s===null)throw Error(r(387));u=i.pendingProps;var b=i.memoizedState;y=b.element,Kc(s,i),aa(i,u,null,l);var S=i.memoizedState;if(u=S.cache,Ss(i,yt,u),u!==b.cache&&Hc(i,[yt],l,!0),ia(),u=S.element,b.isDehydrated)if(b={element:u,isDehydrated:!1,cache:S.cache},i.updateQueue.baseState=b,i.memoizedState=b,i.flags&256){i=Nm(s,i,u,l);break e}else if(u!==y){y=mn(Error(r(424)),i),Zi(y),i=Nm(s,i,u,l);break e}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(at=bn(s.firstChild),Rt=i,Ge=!0,ws=null,xn=!0,l=wp(i,null,u,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(sr(),u===y){i=ns(s,i,l);break e}Mt(s,i,u,l)}i=i.child}return i;case 26:return jo(s,i),s===null?(l=V0(i.type,null,i.pendingProps,null))?i.memoizedState=l:Ge||(l=i.type,s=i.pendingProps,u=Zo(me.current).createElement(l),u[It]=i,u[Ht]=s,Pt(u,l,s),Nt(u),i.stateNode=u):i.memoizedState=V0(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return be(i),s===null&&Ge&&(u=i.stateNode=L0(i.type,i.pendingProps,me.current),Rt=i,xn=!0,y=at,js(i.type)?(ld=y,at=bn(u.firstChild)):at=y),Mt(s,i,i.pendingProps.children,l),jo(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&Ge&&((y=u=at)&&(u=SS(u,i.type,i.pendingProps,xn),u!==null?(i.stateNode=u,Rt=i,at=bn(u.firstChild),xn=!1,y=!0):y=!1),y||_s(i)),be(i),y=i.type,b=i.pendingProps,S=s!==null?s.memoizedProps:null,u=b.children,sd(y,b)?u=null:S!==null&&sd(y,S)&&(i.flags|=32),i.memoizedState!==null&&(y=nu(s,i,L_,null,null,l),Na._currentValue=y),jo(s,i),Mt(s,i,u,l),i.child;case 6:return s===null&&Ge&&((s=l=at)&&(l=ES(l,i.pendingProps,xn),l!==null?(i.stateNode=l,Rt=i,at=null,s=!0):s=!1),s||_s(i)),null;case 13:return Cm(s,i,l);case 4:return ne(i,i.stateNode.containerInfo),u=i.pendingProps,s===null?i.child=cr(i,null,u,l):Mt(s,i,u,l),i.child;case 11:return xm(s,i,i.type,i.pendingProps,l);case 7:return Mt(s,i,i.pendingProps,l),i.child;case 8:return Mt(s,i,i.pendingProps.children,l),i.child;case 12:return Mt(s,i,i.pendingProps.children,l),i.child;case 10:return u=i.pendingProps,Ss(i,i.type,u.value),Mt(s,i,u.children,l),i.child;case 9:return y=i.type._context,u=i.pendingProps.children,ir(i),y=Dt(y),u=u(y),i.flags|=1,Mt(s,i,u,l),i.child;case 14:return vm(s,i,i.type,i.pendingProps,l);case 15:return bm(s,i,i.type,i.pendingProps,l);case 19:return Im(s,i,l);case 31:return $_(s,i,l);case 22:return wm(s,i,l,i.pendingProps);case 24:return ir(i),u=Dt(yt),s===null?(y=$c(),y===null&&(y=nt,b=zc(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=l),y=b),i.memoizedState={parent:u,cache:y},Yc(i),Ss(i,yt,y)):((s.lanes&l)!==0&&(Kc(s,i),aa(i,null,null,l),ia()),y=s.memoizedState,b=i.memoizedState,y.parent!==u?(y={parent:u,cache:u},i.memoizedState=y,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=y),Ss(i,yt,u)):(u=b.cache,Ss(i,yt,u),u!==y.cache&&Hc(i,[yt],l,!0))),Mt(s,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(r(156,i.tag))}function ss(s){s.flags|=4}function Ru(s,i,l,u,y){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(y&335544128)===y)if(s.stateNode.complete)s.flags|=8192;else if(s0())s.flags|=8192;else throw lr=wo,Jc}else s.flags&=-16777217}function Dm(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!$0(i))if(s0())s.flags|=8192;else throw lr=wo,Jc}function Lo(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?uh():536870912,s.lanes|=i,si|=i)}function fa(s,i){if(!Ge)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function ot(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,u=0;if(i)for(var y=s.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags&65011712,u|=y.flags&65011712,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags,u|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=u,s.childLanes=l,i}function Y_(s,i,l){var u=i.pendingProps;switch(Lc(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ot(i),null;case 1:return ot(i),null;case 3:return l=i.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),i.memoizedState.cache!==u&&(i.flags|=2048),Zn(yt),ee(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(zr(i)?ss(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Bc())),ot(i),null;case 26:var y=i.type,b=i.memoizedState;return s===null?(ss(i),b!==null?(ot(i),Dm(i,b)):(ot(i),Ru(i,y,null,u,l))):b?b!==s.memoizedState?(ss(i),ot(i),Dm(i,b)):(ot(i),i.flags&=-16777217):(s=s.memoizedProps,s!==u&&ss(i),ot(i),Ru(i,y,s,u,l)),null;case 27:if(he(i),l=me.current,y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&ss(i);else{if(!u){if(i.stateNode===null)throw Error(r(166));return ot(i),null}s=ie.current,zr(i)?up(i):(s=L0(y,u,l),i.stateNode=s,ss(i))}return ot(i),null;case 5:if(he(i),y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&ss(i);else{if(!u){if(i.stateNode===null)throw Error(r(166));return ot(i),null}if(b=ie.current,zr(i))up(i);else{var S=Zo(me.current);switch(b){case 1:b=S.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=S.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=S.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=S.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=S.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof u.is=="string"?S.createElement("select",{is:u.is}):S.createElement("select"),u.multiple?b.multiple=!0:u.size&&(b.size=u.size);break;default:b=typeof u.is=="string"?S.createElement(y,{is:u.is}):S.createElement(y)}}b[It]=i,b[Ht]=u;e:for(S=i.child;S!==null;){if(S.tag===5||S.tag===6)b.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===i)break e;for(;S.sibling===null;){if(S.return===null||S.return===i)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}i.stateNode=b;e:switch(Pt(b,y,u),y){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&ss(i)}}return ot(i),Ru(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,l),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==u&&ss(i);else{if(typeof u!="string"&&i.stateNode===null)throw Error(r(166));if(s=me.current,zr(i)){if(s=i.stateNode,l=i.memoizedProps,u=null,y=Rt,y!==null)switch(y.tag){case 27:case 5:u=y.memoizedProps}s[It]=i,s=!!(s.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||C0(s.nodeValue,l)),s||_s(i,!0)}else s=Zo(s).createTextNode(u),s[It]=i,i.stateNode=s}return ot(i),null;case 31:if(l=i.memoizedState,s===null||s.memoizedState!==null){if(u=zr(i),l!==null){if(s===null){if(!u)throw Error(r(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[It]=i}else sr(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ot(i),s=!1}else l=Bc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=l),s=!0;if(!s)return i.flags&256?(sn(i),i):(sn(i),null);if((i.flags&128)!==0)throw Error(r(558))}return ot(i),null;case 13:if(u=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(y=zr(i),u!==null&&u.dehydrated!==null){if(s===null){if(!y)throw Error(r(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[It]=i}else sr(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ot(i),y=!1}else y=Bc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),y=!0;if(!y)return i.flags&256?(sn(i),i):(sn(i),null)}return sn(i),(i.flags&128)!==0?(i.lanes=l,i):(l=u!==null,s=s!==null&&s.memoizedState!==null,l&&(u=i.child,y=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(y=u.alternate.memoizedState.cachePool.pool),b=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(b=u.memoizedState.cachePool.pool),b!==y&&(u.flags|=2048)),l!==s&&l&&(i.child.flags|=8192),Lo(i,i.updateQueue),ot(i),null);case 4:return ee(),s===null&&Wu(i.stateNode.containerInfo),ot(i),null;case 10:return Zn(i.type),ot(i),null;case 19:if(q(pt),u=i.memoizedState,u===null)return ot(i),null;if(y=(i.flags&128)!==0,b=u.rendering,b===null)if(y)fa(u,!1);else{if(ft!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(b=To(s),b!==null){for(i.flags|=128,fa(u,!1),s=b.updateQueue,i.updateQueue=s,Lo(i,s),i.subtreeFlags=0,s=l,l=i.child;l!==null;)ip(l,s),l=l.sibling;return K(pt,pt.current&1|2),Ge&&Xn(i,u.treeForkCount),i.child}s=s.sibling}u.tail!==null&&oe()>Ho&&(i.flags|=128,y=!0,fa(u,!1),i.lanes=4194304)}else{if(!y)if(s=To(b),s!==null){if(i.flags|=128,y=!0,s=s.updateQueue,i.updateQueue=s,Lo(i,s),fa(u,!0),u.tail===null&&u.tailMode==="hidden"&&!b.alternate&&!Ge)return ot(i),null}else 2*oe()-u.renderingStartTime>Ho&&l!==536870912&&(i.flags|=128,y=!0,fa(u,!1),i.lanes=4194304);u.isBackwards?(b.sibling=i.child,i.child=b):(s=u.last,s!==null?s.sibling=b:i.child=b,u.last=b)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=oe(),s.sibling=null,l=pt.current,K(pt,y?l&1|2:l&1),Ge&&Xn(i,u.treeForkCount),s):(ot(i),null);case 22:case 23:return sn(i),Zc(),u=i.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(i.flags|=8192):u&&(i.flags|=8192),u?(l&536870912)!==0&&(i.flags&128)===0&&(ot(i),i.subtreeFlags&6&&(i.flags|=8192)):ot(i),l=i.updateQueue,l!==null&&Lo(i,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),u=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),u!==l&&(i.flags|=2048),s!==null&&q(ar),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Zn(yt),ot(i),null;case 25:return null;case 30:return null}throw Error(r(156,i.tag))}function K_(s,i){switch(Lc(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Zn(yt),ee(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return he(i),null;case 31:if(i.memoizedState!==null){if(sn(i),i.alternate===null)throw Error(r(340));sr()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(sn(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(r(340));sr()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return q(pt),null;case 4:return ee(),null;case 10:return Zn(i.type),null;case 22:case 23:return sn(i),Zc(),s!==null&&q(ar),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Zn(yt),null;case 25:return null;default:return null}}function Mm(s,i){switch(Lc(i),i.tag){case 3:Zn(yt),ee();break;case 26:case 27:case 5:he(i);break;case 4:ee();break;case 31:i.memoizedState!==null&&sn(i);break;case 13:sn(i);break;case 19:q(pt);break;case 10:Zn(i.type);break;case 22:case 23:sn(i),Zc(),s!==null&&q(ar);break;case 24:Zn(yt)}}function ha(s,i){try{var l=i.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var y=u.next;l=y;do{if((l.tag&s)===s){u=void 0;var b=l.create,S=l.inst;u=b(),S.destroy=u}l=l.next}while(l!==y)}}catch(T){Xe(i,i.return,T)}}function Is(s,i,l){try{var u=i.updateQueue,y=u!==null?u.lastEffect:null;if(y!==null){var b=y.next;u=b;do{if((u.tag&s)===s){var S=u.inst,T=S.destroy;if(T!==void 0){S.destroy=void 0,y=i;var j=l,F=T;try{F()}catch(W){Xe(y,j,W)}}}u=u.next}while(u!==b)}}catch(W){Xe(i,i.return,W)}}function Pm(s){var i=s.updateQueue;if(i!==null){var l=s.stateNode;try{Sp(i,l)}catch(u){Xe(s,s.return,u)}}}function km(s,i,l){l.props=dr(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(u){Xe(s,i,u)}}function pa(s,i){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var u=s.stateNode;break;case 30:u=s.stateNode;break;default:u=s.stateNode}typeof l=="function"?s.refCleanup=l(u):l.current=u}}catch(y){Xe(s,i,y)}}function Gn(s,i){var l=s.ref,u=s.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(y){Xe(s,i,y)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){Xe(s,i,y)}else l.current=null}function Um(s){var i=s.type,l=s.memoizedProps,u=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(y){Xe(s,s.return,y)}}function Du(s,i,l){try{var u=s.stateNode;yS(u,s.type,l,i),u[Ht]=i}catch(y){Xe(s,s.return,y)}}function jm(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&js(s.type)||s.tag===4}function Mu(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||jm(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&js(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Pu(s,i,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(s),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=Yn));else if(u!==4&&(u===27&&js(s.type)&&(l=s.stateNode,i=null),s=s.child,s!==null))for(Pu(s,i,l),s=s.sibling;s!==null;)Pu(s,i,l),s=s.sibling}function qo(s,i,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(u!==4&&(u===27&&js(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(qo(s,i,l),s=s.sibling;s!==null;)qo(s,i,l),s=s.sibling}function Om(s){var i=s.stateNode,l=s.memoizedProps;try{for(var u=s.type,y=i.attributes;y.length;)i.removeAttributeNode(y[0]);Pt(i,u,l),i[It]=s,i[Ht]=l}catch(b){Xe(s,s.return,b)}}var rs=!1,bt=!1,ku=!1,Lm=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function Q_(s,i){if(s=s.containerInfo,td=al,s=Qh(s),Cc(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var y=u.anchorOffset,b=u.focusNode;u=u.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break e}var S=0,T=-1,j=-1,F=0,W=0,se=s,$=null;t:for(;;){for(var Y;se!==l||y!==0&&se.nodeType!==3||(T=S+y),se!==b||u!==0&&se.nodeType!==3||(j=S+u),se.nodeType===3&&(S+=se.nodeValue.length),(Y=se.firstChild)!==null;)$=se,se=Y;for(;;){if(se===s)break t;if($===l&&++F===y&&(T=S),$===b&&++W===u&&(j=S),(Y=se.nextSibling)!==null)break;se=$,$=se.parentNode}se=Y}l=T===-1||j===-1?null:{start:T,end:j}}else l=null}l=l||{start:0,end:0}}else l=null;for(nd={focusedElem:s,selectionRange:l},al=!1,Ct=i;Ct!==null;)if(i=Ct,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,Ct=s;else for(;Ct!==null;){switch(i=Ct,b=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(l=0;l<s.length;l++)y=s[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&b!==null){s=void 0,l=i,y=b.memoizedProps,b=b.memoizedState,u=l.stateNode;try{var ge=dr(l.type,y);s=u.getSnapshotBeforeUpdate(ge,b),u.__reactInternalSnapshotBeforeUpdate=s}catch(Ae){Xe(l,l.return,Ae)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,l=s.nodeType,l===9)id(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":id(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=i.sibling,s!==null){s.return=i.return,Ct=s;break}Ct=i.return}}function qm(s,i,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:as(s,l),u&4&&ha(5,l);break;case 1:if(as(s,l),u&4)if(s=l.stateNode,i===null)try{s.componentDidMount()}catch(S){Xe(l,l.return,S)}else{var y=dr(l.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(y,i,s.__reactInternalSnapshotBeforeUpdate)}catch(S){Xe(l,l.return,S)}}u&64&&Pm(l),u&512&&pa(l,l.return);break;case 3:if(as(s,l),u&64&&(s=l.updateQueue,s!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{Sp(s,i)}catch(S){Xe(l,l.return,S)}}break;case 27:i===null&&u&4&&Om(l);case 26:case 5:as(s,l),i===null&&u&4&&Um(l),u&512&&pa(l,l.return);break;case 12:as(s,l);break;case 31:as(s,l),u&4&&Gm(s,l);break;case 13:as(s,l),u&4&&Hm(s,l),u&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=iS.bind(null,l),TS(s,l))));break;case 22:if(u=l.memoizedState!==null||rs,!u){i=i!==null&&i.memoizedState!==null||bt,y=rs;var b=bt;rs=u,(bt=i)&&!b?os(s,l,(l.subtreeFlags&8772)!==0):as(s,l),rs=y,bt=b}break;case 30:break;default:as(s,l)}}function Bm(s){var i=s.alternate;i!==null&&(s.alternate=null,Bm(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&uc(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var ct=null,Ft=!1;function is(s,i,l){for(l=l.child;l!==null;)Vm(s,i,l),l=l.sibling}function Vm(s,i,l){if(Wt&&typeof Wt.onCommitFiberUnmount=="function")try{Wt.onCommitFiberUnmount(Li,l)}catch{}switch(l.tag){case 26:bt||Gn(l,i),is(s,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:bt||Gn(l,i);var u=ct,y=Ft;js(l.type)&&(ct=l.stateNode,Ft=!1),is(s,i,l),Sa(l.stateNode),ct=u,Ft=y;break;case 5:bt||Gn(l,i);case 6:if(u=ct,y=Ft,ct=null,is(s,i,l),ct=u,Ft=y,ct!==null)if(Ft)try{(ct.nodeType===9?ct.body:ct.nodeName==="HTML"?ct.ownerDocument.body:ct).removeChild(l.stateNode)}catch(b){Xe(l,i,b)}else try{ct.removeChild(l.stateNode)}catch(b){Xe(l,i,b)}break;case 18:ct!==null&&(Ft?(s=ct,P0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),di(s)):P0(ct,l.stateNode));break;case 4:u=ct,y=Ft,ct=l.stateNode.containerInfo,Ft=!0,is(s,i,l),ct=u,Ft=y;break;case 0:case 11:case 14:case 15:Is(2,l,i),bt||Is(4,l,i),is(s,i,l);break;case 1:bt||(Gn(l,i),u=l.stateNode,typeof u.componentWillUnmount=="function"&&km(l,i,u)),is(s,i,l);break;case 21:is(s,i,l);break;case 22:bt=(u=bt)||l.memoizedState!==null,is(s,i,l),bt=u;break;default:is(s,i,l)}}function Gm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{di(s)}catch(l){Xe(i,i.return,l)}}}function Hm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{di(s)}catch(l){Xe(i,i.return,l)}}function X_(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Lm),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Lm),i;default:throw Error(r(435,s.tag))}}function Bo(s,i){var l=X_(s);i.forEach(function(u){if(!l.has(u)){l.add(u);var y=aS.bind(null,s,u);u.then(y,y)}})}function $t(s,i){var l=i.deletions;if(l!==null)for(var u=0;u<l.length;u++){var y=l[u],b=s,S=i,T=S;e:for(;T!==null;){switch(T.tag){case 27:if(js(T.type)){ct=T.stateNode,Ft=!1;break e}break;case 5:ct=T.stateNode,Ft=!1;break e;case 3:case 4:ct=T.stateNode.containerInfo,Ft=!0;break e}T=T.return}if(ct===null)throw Error(r(160));Vm(b,S,y),ct=null,Ft=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)zm(i,s),i=i.sibling}var An=null;function zm(s,i){var l=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:$t(i,s),Jt(s),u&4&&(Is(3,s,s.return),ha(3,s),Is(5,s,s.return));break;case 1:$t(i,s),Jt(s),u&512&&(bt||l===null||Gn(l,l.return)),u&64&&rs&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var y=An;if($t(i,s),Jt(s),u&512&&(bt||l===null||Gn(l,l.return)),u&4){var b=l!==null?l.memoizedState:null;if(u=s.memoizedState,l===null)if(u===null)if(s.stateNode===null){e:{u=s.type,l=s.memoizedProps,y=y.ownerDocument||y;t:switch(u){case"title":b=y.getElementsByTagName("title")[0],(!b||b[Vi]||b[It]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(u),y.head.insertBefore(b,y.querySelector("head > title"))),Pt(b,u,l),b[It]=s,Nt(b),u=b;break e;case"link":var S=z0("link","href",y).get(u+(l.href||""));if(S){for(var T=0;T<S.length;T++)if(b=S[T],b.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&b.getAttribute("rel")===(l.rel==null?null:l.rel)&&b.getAttribute("title")===(l.title==null?null:l.title)&&b.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){S.splice(T,1);break t}}b=y.createElement(u),Pt(b,u,l),y.head.appendChild(b);break;case"meta":if(S=z0("meta","content",y).get(u+(l.content||""))){for(T=0;T<S.length;T++)if(b=S[T],b.getAttribute("content")===(l.content==null?null:""+l.content)&&b.getAttribute("name")===(l.name==null?null:l.name)&&b.getAttribute("property")===(l.property==null?null:l.property)&&b.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&b.getAttribute("charset")===(l.charSet==null?null:l.charSet)){S.splice(T,1);break t}}b=y.createElement(u),Pt(b,u,l),y.head.appendChild(b);break;default:throw Error(r(468,u))}b[It]=s,Nt(b),u=b}s.stateNode=u}else F0(y,s.type,s.stateNode);else s.stateNode=H0(y,u,s.memoizedProps);else b!==u?(b===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):b.count--,u===null?F0(y,s.type,s.stateNode):H0(y,u,s.memoizedProps)):u===null&&s.stateNode!==null&&Du(s,s.memoizedProps,l.memoizedProps)}break;case 27:$t(i,s),Jt(s),u&512&&(bt||l===null||Gn(l,l.return)),l!==null&&u&4&&Du(s,s.memoizedProps,l.memoizedProps);break;case 5:if($t(i,s),Jt(s),u&512&&(bt||l===null||Gn(l,l.return)),s.flags&32){y=s.stateNode;try{kr(y,"")}catch(ge){Xe(s,s.return,ge)}}u&4&&s.stateNode!=null&&(y=s.memoizedProps,Du(s,y,l!==null?l.memoizedProps:y)),u&1024&&(ku=!0);break;case 6:if($t(i,s),Jt(s),u&4){if(s.stateNode===null)throw Error(r(162));u=s.memoizedProps,l=s.stateNode;try{l.nodeValue=u}catch(ge){Xe(s,s.return,ge)}}break;case 3:if(nl=null,y=An,An=el(i.containerInfo),$t(i,s),An=y,Jt(s),u&4&&l!==null&&l.memoizedState.isDehydrated)try{di(i.containerInfo)}catch(ge){Xe(s,s.return,ge)}ku&&(ku=!1,Fm(s));break;case 4:u=An,An=el(s.stateNode.containerInfo),$t(i,s),Jt(s),An=u;break;case 12:$t(i,s),Jt(s);break;case 31:$t(i,s),Jt(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Bo(s,u)));break;case 13:$t(i,s),Jt(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Go=oe()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Bo(s,u)));break;case 22:y=s.memoizedState!==null;var j=l!==null&&l.memoizedState!==null,F=rs,W=bt;if(rs=F||y,bt=W||j,$t(i,s),bt=W,rs=F,Jt(s),u&8192)e:for(i=s.stateNode,i._visibility=y?i._visibility&-2:i._visibility|1,y&&(l===null||j||rs||bt||fr(s)),l=null,i=s;;){if(i.tag===5||i.tag===26){if(l===null){j=l=i;try{if(b=j.stateNode,y)S=b.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{T=j.stateNode;var se=j.memoizedProps.style,$=se!=null&&se.hasOwnProperty("display")?se.display:null;T.style.display=$==null||typeof $=="boolean"?"":(""+$).trim()}}catch(ge){Xe(j,j.return,ge)}}}else if(i.tag===6){if(l===null){j=i;try{j.stateNode.nodeValue=y?"":j.memoizedProps}catch(ge){Xe(j,j.return,ge)}}}else if(i.tag===18){if(l===null){j=i;try{var Y=j.stateNode;y?k0(Y,!0):k0(j.stateNode,!1)}catch(ge){Xe(j,j.return,ge)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}u&4&&(u=s.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,Bo(s,l))));break;case 19:$t(i,s),Jt(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,Bo(s,u)));break;case 30:break;case 21:break;default:$t(i,s),Jt(s)}}function Jt(s){var i=s.flags;if(i&2){try{for(var l,u=s.return;u!==null;){if(jm(u)){l=u;break}u=u.return}if(l==null)throw Error(r(160));switch(l.tag){case 27:var y=l.stateNode,b=Mu(s);qo(s,b,y);break;case 5:var S=l.stateNode;l.flags&32&&(kr(S,""),l.flags&=-33);var T=Mu(s);qo(s,T,S);break;case 3:case 4:var j=l.stateNode.containerInfo,F=Mu(s);Pu(s,F,j);break;default:throw Error(r(161))}}catch(W){Xe(s,s.return,W)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Fm(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Fm(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function as(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)qm(s,i.alternate,i),i=i.sibling}function fr(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:Is(4,i,i.return),fr(i);break;case 1:Gn(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&km(i,i.return,l),fr(i);break;case 27:Sa(i.stateNode);case 26:case 5:Gn(i,i.return),fr(i);break;case 22:i.memoizedState===null&&fr(i);break;case 30:fr(i);break;default:fr(i)}s=s.sibling}}function os(s,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var u=i.alternate,y=s,b=i,S=b.flags;switch(b.tag){case 0:case 11:case 15:os(y,b,l),ha(4,b);break;case 1:if(os(y,b,l),u=b,y=u.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(F){Xe(u,u.return,F)}if(u=b,y=u.updateQueue,y!==null){var T=u.stateNode;try{var j=y.shared.hiddenCallbacks;if(j!==null)for(y.shared.hiddenCallbacks=null,y=0;y<j.length;y++)_p(j[y],T)}catch(F){Xe(u,u.return,F)}}l&&S&64&&Pm(b),pa(b,b.return);break;case 27:Om(b);case 26:case 5:os(y,b,l),l&&u===null&&S&4&&Um(b),pa(b,b.return);break;case 12:os(y,b,l);break;case 31:os(y,b,l),l&&S&4&&Gm(y,b);break;case 13:os(y,b,l),l&&S&4&&Hm(y,b);break;case 22:b.memoizedState===null&&os(y,b,l),pa(b,b.return);break;case 30:break;default:os(y,b,l)}i=i.sibling}}function Uu(s,i){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&ea(l))}function ju(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&ea(s))}function In(s,i,l,u){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)$m(s,i,l,u),i=i.sibling}function $m(s,i,l,u){var y=i.flags;switch(i.tag){case 0:case 11:case 15:In(s,i,l,u),y&2048&&ha(9,i);break;case 1:In(s,i,l,u);break;case 3:In(s,i,l,u),y&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&ea(s)));break;case 12:if(y&2048){In(s,i,l,u),s=i.stateNode;try{var b=i.memoizedProps,S=b.id,T=b.onPostCommit;typeof T=="function"&&T(S,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(j){Xe(i,i.return,j)}}else In(s,i,l,u);break;case 31:In(s,i,l,u);break;case 13:In(s,i,l,u);break;case 23:break;case 22:b=i.stateNode,S=i.alternate,i.memoizedState!==null?b._visibility&2?In(s,i,l,u):ma(s,i):b._visibility&2?In(s,i,l,u):(b._visibility|=2,ei(s,i,l,u,(i.subtreeFlags&10256)!==0||!1)),y&2048&&Uu(S,i);break;case 24:In(s,i,l,u),y&2048&&ju(i.alternate,i);break;default:In(s,i,l,u)}}function ei(s,i,l,u,y){for(y=y&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var b=s,S=i,T=l,j=u,F=S.flags;switch(S.tag){case 0:case 11:case 15:ei(b,S,T,j,y),ha(8,S);break;case 23:break;case 22:var W=S.stateNode;S.memoizedState!==null?W._visibility&2?ei(b,S,T,j,y):ma(b,S):(W._visibility|=2,ei(b,S,T,j,y)),y&&F&2048&&Uu(S.alternate,S);break;case 24:ei(b,S,T,j,y),y&&F&2048&&ju(S.alternate,S);break;default:ei(b,S,T,j,y)}i=i.sibling}}function ma(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=s,u=i,y=u.flags;switch(u.tag){case 22:ma(l,u),y&2048&&Uu(u.alternate,u);break;case 24:ma(l,u),y&2048&&ju(u.alternate,u);break;default:ma(l,u)}i=i.sibling}}var ga=8192;function ti(s,i,l){if(s.subtreeFlags&ga)for(s=s.child;s!==null;)Jm(s,i,l),s=s.sibling}function Jm(s,i,l){switch(s.tag){case 26:ti(s,i,l),s.flags&ga&&s.memoizedState!==null&&OS(l,An,s.memoizedState,s.memoizedProps);break;case 5:ti(s,i,l);break;case 3:case 4:var u=An;An=el(s.stateNode.containerInfo),ti(s,i,l),An=u;break;case 22:s.memoizedState===null&&(u=s.alternate,u!==null&&u.memoizedState!==null?(u=ga,ga=16777216,ti(s,i,l),ga=u):ti(s,i,l));break;default:ti(s,i,l)}}function Ym(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function ya(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var u=i[l];Ct=u,Qm(u,s)}Ym(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Km(s),s=s.sibling}function Km(s){switch(s.tag){case 0:case 11:case 15:ya(s),s.flags&2048&&Is(9,s,s.return);break;case 3:ya(s);break;case 12:ya(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,Vo(s)):ya(s);break;default:ya(s)}}function Vo(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var u=i[l];Ct=u,Qm(u,s)}Ym(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:Is(8,i,i.return),Vo(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,Vo(i));break;default:Vo(i)}s=s.sibling}}function Qm(s,i){for(;Ct!==null;){var l=Ct;switch(l.tag){case 0:case 11:case 15:Is(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:ea(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,Ct=u;else e:for(l=s;Ct!==null;){u=Ct;var y=u.sibling,b=u.return;if(Bm(u),u===l){Ct=null;break e}if(y!==null){y.return=b,Ct=y;break e}Ct=b}}}var W_={getCacheForType:function(s){var i=Dt(yt),l=i.data.get(s);return l===void 0&&(l=s(),i.data.set(s,l)),l},cacheSignal:function(){return Dt(yt).controller.signal}},Z_=typeof WeakMap=="function"?WeakMap:Map,Ye=0,nt=null,Oe=null,qe=0,Qe=0,rn=null,Rs=!1,ni=!1,Ou=!1,ls=0,ft=0,Ds=0,hr=0,Lu=0,an=0,si=0,xa=null,Yt=null,qu=!1,Go=0,Xm=0,Ho=1/0,zo=null,Ms=null,St=0,Ps=null,ri=null,cs=0,Bu=0,Vu=null,Wm=null,va=0,Gu=null;function on(){return(Ye&2)!==0&&qe!==0?qe&-qe:R.T!==null?Yu():ph()}function Zm(){if(an===0)if((qe&536870912)===0||Ge){var s=Xa;Xa<<=1,(Xa&3932160)===0&&(Xa=262144),an=s}else an=536870912;return s=nn.current,s!==null&&(s.flags|=32),an}function Kt(s,i,l){(s===nt&&(Qe===2||Qe===9)||s.cancelPendingCommit!==null)&&(ii(s,0),ks(s,qe,an,!1)),Bi(s,l),((Ye&2)===0||s!==nt)&&(s===nt&&((Ye&2)===0&&(hr|=l),ft===4&&ks(s,qe,an,!1)),Hn(s))}function e0(s,i,l){if((Ye&6)!==0)throw Error(r(327));var u=!l&&(i&127)===0&&(i&s.expiredLanes)===0||qi(s,i),y=u?nS(s,i):zu(s,i,!0),b=u;do{if(y===0){ni&&!u&&ks(s,i,0,!1);break}else{if(l=s.current.alternate,b&&!eS(l)){y=zu(s,i,!1),b=!1;continue}if(y===2){if(b=i,s.errorRecoveryDisabledLanes&b)var S=0;else S=s.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){i=S;e:{var T=s;y=xa;var j=T.current.memoizedState.isDehydrated;if(j&&(ii(T,S).flags|=256),S=zu(T,S,!1),S!==2){if(Ou&&!j){T.errorRecoveryDisabledLanes|=b,hr|=b,y=4;break e}b=Yt,Yt=y,b!==null&&(Yt===null?Yt=b:Yt.push.apply(Yt,b))}y=S}if(b=!1,y!==2)continue}}if(y===1){ii(s,0),ks(s,i,0,!0);break}e:{switch(u=s,b=y,b){case 0:case 1:throw Error(r(345));case 4:if((i&4194048)!==i)break;case 6:ks(u,i,an,!Rs);break e;case 2:Yt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((i&62914560)===i&&(y=Go+300-oe(),10<y)){if(ks(u,i,an,!Rs),Za(u,0,!0)!==0)break e;cs=i,u.timeoutHandle=D0(t0.bind(null,u,l,Yt,zo,qu,i,an,hr,si,Rs,b,"Throttled",-0,0),y);break e}t0(u,l,Yt,zo,qu,i,an,hr,si,Rs,b,null,-0,0)}}break}while(!0);Hn(s)}function t0(s,i,l,u,y,b,S,T,j,F,W,se,$,Y){if(s.timeoutHandle=-1,se=i.subtreeFlags,se&8192||(se&16785408)===16785408){se={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Yn},Jm(i,b,se);var ge=(b&62914560)===b?Go-oe():(b&4194048)===b?Xm-oe():0;if(ge=LS(se,ge),ge!==null){cs=b,s.cancelPendingCommit=ge(c0.bind(null,s,i,b,l,u,y,S,T,j,W,se,null,$,Y)),ks(s,b,S,!F);return}}c0(s,i,b,l,u,y,S,T,j)}function eS(s){for(var i=s;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var y=l[u],b=y.getSnapshot;y=y.value;try{if(!en(b(),y))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ks(s,i,l,u){i&=~Lu,i&=~hr,s.suspendedLanes|=i,s.pingedLanes&=~i,u&&(s.warmLanes|=i),u=s.expirationTimes;for(var y=i;0<y;){var b=31-Zt(y),S=1<<b;u[b]=-1,y&=~S}l!==0&&dh(s,l,i)}function Fo(){return(Ye&6)===0?(ba(0),!1):!0}function Hu(){if(Oe!==null){if(Qe===0)var s=Oe.return;else s=Oe,Wn=rr=null,iu(s),Kr=null,na=0,s=Oe;for(;s!==null;)Mm(s.alternate,s),s=s.return;Oe=null}}function ii(s,i){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,bS(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),cs=0,Hu(),nt=s,Oe=l=Qn(s.current,null),qe=i,Qe=0,rn=null,Rs=!1,ni=qi(s,i),Ou=!1,si=an=Lu=hr=Ds=ft=0,Yt=xa=null,qu=!1,(i&8)!==0&&(i|=i&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=i;0<u;){var y=31-Zt(u),b=1<<y;i|=s[y],u&=~b}return ls=i,fo(),l}function n0(s,i){ke=null,R.H=ua,i===Yr||i===bo?(i=xp(),Qe=3):i===Jc?(i=xp(),Qe=4):Qe=i===wu?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,rn=i,Oe===null&&(ft=1,ko(s,mn(i,s.current)))}function s0(){var s=nn.current;return s===null?!0:(qe&4194048)===qe?vn===null:(qe&62914560)===qe||(qe&536870912)!==0?s===vn:!1}function r0(){var s=R.H;return R.H=ua,s===null?ua:s}function i0(){var s=R.A;return R.A=W_,s}function $o(){ft=4,Rs||(qe&4194048)!==qe&&nn.current!==null||(ni=!0),(Ds&134217727)===0&&(hr&134217727)===0||nt===null||ks(nt,qe,an,!1)}function zu(s,i,l){var u=Ye;Ye|=2;var y=r0(),b=i0();(nt!==s||qe!==i)&&(zo=null,ii(s,i)),i=!1;var S=ft;e:do try{if(Qe!==0&&Oe!==null){var T=Oe,j=rn;switch(Qe){case 8:Hu(),S=6;break e;case 3:case 2:case 9:case 6:nn.current===null&&(i=!0);var F=Qe;if(Qe=0,rn=null,ai(s,T,j,F),l&&ni){S=0;break e}break;default:F=Qe,Qe=0,rn=null,ai(s,T,j,F)}}tS(),S=ft;break}catch(W){n0(s,W)}while(!0);return i&&s.shellSuspendCounter++,Wn=rr=null,Ye=u,R.H=y,R.A=b,Oe===null&&(nt=null,qe=0,fo()),S}function tS(){for(;Oe!==null;)a0(Oe)}function nS(s,i){var l=Ye;Ye|=2;var u=r0(),y=i0();nt!==s||qe!==i?(zo=null,Ho=oe()+500,ii(s,i)):ni=qi(s,i);e:do try{if(Qe!==0&&Oe!==null){i=Oe;var b=rn;t:switch(Qe){case 1:Qe=0,rn=null,ai(s,i,b,1);break;case 2:case 9:if(gp(b)){Qe=0,rn=null,o0(i);break}i=function(){Qe!==2&&Qe!==9||nt!==s||(Qe=7),Hn(s)},b.then(i,i);break e;case 3:Qe=7;break e;case 4:Qe=5;break e;case 7:gp(b)?(Qe=0,rn=null,o0(i)):(Qe=0,rn=null,ai(s,i,b,7));break;case 5:var S=null;switch(Oe.tag){case 26:S=Oe.memoizedState;case 5:case 27:var T=Oe;if(S?$0(S):T.stateNode.complete){Qe=0,rn=null;var j=T.sibling;if(j!==null)Oe=j;else{var F=T.return;F!==null?(Oe=F,Jo(F)):Oe=null}break t}}Qe=0,rn=null,ai(s,i,b,5);break;case 6:Qe=0,rn=null,ai(s,i,b,6);break;case 8:Hu(),ft=6;break e;default:throw Error(r(462))}}sS();break}catch(W){n0(s,W)}while(!0);return Wn=rr=null,R.H=u,R.A=y,Ye=l,Oe!==null?0:(nt=null,qe=0,fo(),ft)}function sS(){for(;Oe!==null&&!Xt();)a0(Oe)}function a0(s){var i=Rm(s.alternate,s,ls);s.memoizedProps=s.pendingProps,i===null?Jo(s):Oe=i}function o0(s){var i=s,l=i.alternate;switch(i.tag){case 15:case 0:i=Em(l,i,i.pendingProps,i.type,void 0,qe);break;case 11:i=Em(l,i,i.pendingProps,i.type.render,i.ref,qe);break;case 5:iu(i);default:Mm(l,i),i=Oe=ip(i,ls),i=Rm(l,i,ls)}s.memoizedProps=s.pendingProps,i===null?Jo(s):Oe=i}function ai(s,i,l,u){Wn=rr=null,iu(i),Kr=null,na=0;var y=i.return;try{if(F_(s,y,i,l,qe)){ft=1,ko(s,mn(l,s.current)),Oe=null;return}}catch(b){if(y!==null)throw Oe=y,b;ft=1,ko(s,mn(l,s.current)),Oe=null;return}i.flags&32768?(Ge||u===1?s=!0:ni||(qe&536870912)!==0?s=!1:(Rs=s=!0,(u===2||u===9||u===3||u===6)&&(u=nn.current,u!==null&&u.tag===13&&(u.flags|=16384))),l0(i,s)):Jo(i)}function Jo(s){var i=s;do{if((i.flags&32768)!==0){l0(i,Rs);return}s=i.return;var l=Y_(i.alternate,i,ls);if(l!==null){Oe=l;return}if(i=i.sibling,i!==null){Oe=i;return}Oe=i=s}while(i!==null);ft===0&&(ft=5)}function l0(s,i){do{var l=K_(s.alternate,s);if(l!==null){l.flags&=32767,Oe=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(s=s.sibling,s!==null)){Oe=s;return}Oe=s=l}while(s!==null);ft=6,Oe=null}function c0(s,i,l,u,y,b,S,T,j){s.cancelPendingCommit=null;do Yo();while(St!==0);if((Ye&6)!==0)throw Error(r(327));if(i!==null){if(i===s.current)throw Error(r(177));if(b=i.lanes|i.childLanes,b|=Mc,jw(s,l,b,S,T,j),s===nt&&(Oe=nt=null,qe=0),ri=i,Ps=s,cs=l,Bu=b,Vu=y,Wm=u,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,oS(De,function(){return p0(),null})):(s.callbackNode=null,s.callbackPriority=0),u=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||u){u=R.T,R.T=null,y=G.p,G.p=2,S=Ye,Ye|=4;try{Q_(s,i,l)}finally{Ye=S,G.p=y,R.T=u}}St=1,u0(),d0(),f0()}}function u0(){if(St===1){St=0;var s=Ps,i=ri,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=R.T,R.T=null;var u=G.p;G.p=2;var y=Ye;Ye|=4;try{zm(i,s);var b=nd,S=Qh(s.containerInfo),T=b.focusedElem,j=b.selectionRange;if(S!==T&&T&&T.ownerDocument&&Kh(T.ownerDocument.documentElement,T)){if(j!==null&&Cc(T)){var F=j.start,W=j.end;if(W===void 0&&(W=F),"selectionStart"in T)T.selectionStart=F,T.selectionEnd=Math.min(W,T.value.length);else{var se=T.ownerDocument||document,$=se&&se.defaultView||window;if($.getSelection){var Y=$.getSelection(),ge=T.textContent.length,Ae=Math.min(j.start,ge),et=j.end===void 0?Ae:Math.min(j.end,ge);!Y.extend&&Ae>et&&(S=et,et=Ae,Ae=S);var V=Yh(T,Ae),L=Yh(T,et);if(V&&L&&(Y.rangeCount!==1||Y.anchorNode!==V.node||Y.anchorOffset!==V.offset||Y.focusNode!==L.node||Y.focusOffset!==L.offset)){var z=se.createRange();z.setStart(V.node,V.offset),Y.removeAllRanges(),Ae>et?(Y.addRange(z),Y.extend(L.node,L.offset)):(z.setEnd(L.node,L.offset),Y.addRange(z))}}}}for(se=[],Y=T;Y=Y.parentNode;)Y.nodeType===1&&se.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<se.length;T++){var te=se[T];te.element.scrollLeft=te.left,te.element.scrollTop=te.top}}al=!!td,nd=td=null}finally{Ye=y,G.p=u,R.T=l}}s.current=i,St=2}}function d0(){if(St===2){St=0;var s=Ps,i=ri,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=R.T,R.T=null;var u=G.p;G.p=2;var y=Ye;Ye|=4;try{qm(s,i.alternate,i)}finally{Ye=y,G.p=u,R.T=l}}St=3}}function f0(){if(St===4||St===3){St=0,le();var s=Ps,i=ri,l=cs,u=Wm;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?St=5:(St=0,ri=Ps=null,h0(s,s.pendingLanes));var y=s.pendingLanes;if(y===0&&(Ms=null),lc(l),i=i.stateNode,Wt&&typeof Wt.onCommitFiberRoot=="function")try{Wt.onCommitFiberRoot(Li,i,void 0,(i.current.flags&128)===128)}catch{}if(u!==null){i=R.T,y=G.p,G.p=2,R.T=null;try{for(var b=s.onRecoverableError,S=0;S<u.length;S++){var T=u[S];b(T.value,{componentStack:T.stack})}}finally{R.T=i,G.p=y}}(cs&3)!==0&&Yo(),Hn(s),y=s.pendingLanes,(l&261930)!==0&&(y&42)!==0?s===Gu?va++:(va=0,Gu=s):va=0,ba(0)}}function h0(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,ea(i)))}function Yo(){return u0(),d0(),f0(),p0()}function p0(){if(St!==5)return!1;var s=Ps,i=Bu;Bu=0;var l=lc(cs),u=R.T,y=G.p;try{G.p=32>l?32:l,R.T=null,l=Vu,Vu=null;var b=Ps,S=cs;if(St=0,ri=Ps=null,cs=0,(Ye&6)!==0)throw Error(r(331));var T=Ye;if(Ye|=4,Km(b.current),$m(b,b.current,S,l),Ye=T,ba(0,!1),Wt&&typeof Wt.onPostCommitFiberRoot=="function")try{Wt.onPostCommitFiberRoot(Li,b)}catch{}return!0}finally{G.p=y,R.T=u,h0(s,i)}}function m0(s,i,l){i=mn(l,i),i=bu(s.stateNode,i,2),s=Ns(s,i,2),s!==null&&(Bi(s,2),Hn(s))}function Xe(s,i,l){if(s.tag===3)m0(s,s,l);else for(;i!==null;){if(i.tag===3){m0(i,s,l);break}else if(i.tag===1){var u=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Ms===null||!Ms.has(u))){s=mn(l,s),l=gm(2),u=Ns(i,l,2),u!==null&&(ym(l,u,i,s),Bi(u,2),Hn(u));break}}i=i.return}}function Fu(s,i,l){var u=s.pingCache;if(u===null){u=s.pingCache=new Z_;var y=new Set;u.set(i,y)}else y=u.get(i),y===void 0&&(y=new Set,u.set(i,y));y.has(l)||(Ou=!0,y.add(l),s=rS.bind(null,s,i,l),i.then(s,s))}function rS(s,i,l){var u=s.pingCache;u!==null&&u.delete(i),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,nt===s&&(qe&l)===l&&(ft===4||ft===3&&(qe&62914560)===qe&&300>oe()-Go?(Ye&2)===0&&ii(s,0):Lu|=l,si===qe&&(si=0)),Hn(s)}function g0(s,i){i===0&&(i=uh()),s=tr(s,i),s!==null&&(Bi(s,i),Hn(s))}function iS(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),g0(s,l)}function aS(s,i){var l=0;switch(s.tag){case 31:case 13:var u=s.stateNode,y=s.memoizedState;y!==null&&(l=y.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(r(314))}u!==null&&u.delete(i),g0(s,l)}function oS(s,i){return On(s,i)}var Ko=null,oi=null,$u=!1,Qo=!1,Ju=!1,Us=0;function Hn(s){s!==oi&&s.next===null&&(oi===null?Ko=oi=s:oi=oi.next=s),Qo=!0,$u||($u=!0,cS())}function ba(s,i){if(!Ju&&Qo){Ju=!0;do for(var l=!1,u=Ko;u!==null;){if(s!==0){var y=u.pendingLanes;if(y===0)var b=0;else{var S=u.suspendedLanes,T=u.pingedLanes;b=(1<<31-Zt(42|s)+1)-1,b&=y&~(S&~T),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(l=!0,b0(u,b))}else b=qe,b=Za(u,u===nt?b:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(b&3)===0||qi(u,b)||(l=!0,b0(u,b));u=u.next}while(l);Ju=!1}}function lS(){y0()}function y0(){Qo=$u=!1;var s=0;Us!==0&&vS()&&(s=Us);for(var i=oe(),l=null,u=Ko;u!==null;){var y=u.next,b=x0(u,i);b===0?(u.next=null,l===null?Ko=y:l.next=y,y===null&&(oi=l)):(l=u,(s!==0||(b&3)!==0)&&(Qo=!0)),u=y}St!==0&&St!==5||ba(s),Us!==0&&(Us=0)}function x0(s,i){for(var l=s.suspendedLanes,u=s.pingedLanes,y=s.expirationTimes,b=s.pendingLanes&-62914561;0<b;){var S=31-Zt(b),T=1<<S,j=y[S];j===-1?((T&l)===0||(T&u)!==0)&&(y[S]=Uw(T,i)):j<=i&&(s.expiredLanes|=T),b&=~T}if(i=nt,l=qe,l=Za(s,s===i?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u=s.callbackNode,l===0||s===i&&(Qe===2||Qe===9)||s.cancelPendingCommit!==null)return u!==null&&u!==null&&Ln(u),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||qi(s,l)){if(i=l&-l,i===s.callbackPriority)return i;switch(u!==null&&Ln(u),lc(l)){case 2:case 8:l=$n;break;case 32:l=De;break;case 268435456:l=qn;break;default:l=De}return u=v0.bind(null,s),l=On(l,u),s.callbackPriority=i,s.callbackNode=l,i}return u!==null&&u!==null&&Ln(u),s.callbackPriority=2,s.callbackNode=null,2}function v0(s,i){if(St!==0&&St!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(Yo()&&s.callbackNode!==l)return null;var u=qe;return u=Za(s,s===nt?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u===0?null:(e0(s,u,i),x0(s,oe()),s.callbackNode!=null&&s.callbackNode===l?v0.bind(null,s):null)}function b0(s,i){if(Yo())return null;e0(s,i,!0)}function cS(){wS(function(){(Ye&6)!==0?On(He,lS):y0()})}function Yu(){if(Us===0){var s=$r;s===0&&(s=Qa,Qa<<=1,(Qa&261888)===0&&(Qa=256)),Us=s}return Us}function w0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:so(""+s)}function _0(s,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,s.id&&l.setAttribute("form",s.id),i.parentNode.insertBefore(l,i),s=new FormData(s),l.parentNode.removeChild(l),s}function uS(s,i,l,u,y){if(i==="submit"&&l&&l.stateNode===y){var b=w0((y[Ht]||null).action),S=u.submitter;S&&(i=(i=S[Ht]||null)?w0(i.formAction):S.getAttribute("formAction"),i!==null&&(b=i,S=null));var T=new oo("action","action",null,u,y);s.push({event:T,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(Us!==0){var j=S?_0(y,S):new FormData(y);pu(l,{pending:!0,data:j,method:y.method,action:b},null,j)}}else typeof b=="function"&&(T.preventDefault(),j=S?_0(y,S):new FormData(y),pu(l,{pending:!0,data:j,method:y.method,action:b},b,j))},currentTarget:y}]})}}for(var Ku=0;Ku<Dc.length;Ku++){var Qu=Dc[Ku],dS=Qu.toLowerCase(),fS=Qu[0].toUpperCase()+Qu.slice(1);Cn(dS,"on"+fS)}Cn(Zh,"onAnimationEnd"),Cn(ep,"onAnimationIteration"),Cn(tp,"onAnimationStart"),Cn("dblclick","onDoubleClick"),Cn("focusin","onFocus"),Cn("focusout","onBlur"),Cn(A_,"onTransitionRun"),Cn(I_,"onTransitionStart"),Cn(R_,"onTransitionCancel"),Cn(np,"onTransitionEnd"),Mr("onMouseEnter",["mouseout","mouseover"]),Mr("onMouseLeave",["mouseout","mouseover"]),Mr("onPointerEnter",["pointerout","pointerover"]),Mr("onPointerLeave",["pointerout","pointerover"]),Xs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),hS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(wa));function S0(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var u=s[l],y=u.event;u=u.listeners;e:{var b=void 0;if(i)for(var S=u.length-1;0<=S;S--){var T=u[S],j=T.instance,F=T.currentTarget;if(T=T.listener,j!==b&&y.isPropagationStopped())break e;b=T,y.currentTarget=F;try{b(y)}catch(W){uo(W)}y.currentTarget=null,b=j}else for(S=0;S<u.length;S++){if(T=u[S],j=T.instance,F=T.currentTarget,T=T.listener,j!==b&&y.isPropagationStopped())break e;b=T,y.currentTarget=F;try{b(y)}catch(W){uo(W)}y.currentTarget=null,b=j}}}}function Le(s,i){var l=i[cc];l===void 0&&(l=i[cc]=new Set);var u=s+"__bubble";l.has(u)||(E0(i,s,2,!1),l.add(u))}function Xu(s,i,l){var u=0;i&&(u|=4),E0(l,s,u,i)}var Xo="_reactListening"+Math.random().toString(36).slice(2);function Wu(s){if(!s[Xo]){s[Xo]=!0,yh.forEach(function(l){l!=="selectionchange"&&(hS.has(l)||Xu(l,!1,s),Xu(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[Xo]||(i[Xo]=!0,Xu("selectionchange",!1,i))}}function E0(s,i,l,u){switch(Z0(i)){case 2:var y=VS;break;case 8:y=GS;break;default:y=hd}l=y.bind(null,i,l,s),y=void 0,!xc||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(y=!0),u?y!==void 0?s.addEventListener(i,l,{capture:!0,passive:y}):s.addEventListener(i,l,!0):y!==void 0?s.addEventListener(i,l,{passive:y}):s.addEventListener(i,l,!1)}function Zu(s,i,l,u,y){var b=u;if((i&1)===0&&(i&2)===0&&u!==null)e:for(;;){if(u===null)return;var S=u.tag;if(S===3||S===4){var T=u.stateNode.containerInfo;if(T===y)break;if(S===4)for(S=u.return;S!==null;){var j=S.tag;if((j===3||j===4)&&S.stateNode.containerInfo===y)return;S=S.return}for(;T!==null;){if(S=Ir(T),S===null)return;if(j=S.tag,j===5||j===6||j===26||j===27){u=b=S;continue e}T=T.parentNode}}u=u.return}Ih(function(){var F=b,W=gc(l),se=[];e:{var $=sp.get(s);if($!==void 0){var Y=oo,ge=s;switch(s){case"keypress":if(io(l)===0)break e;case"keydown":case"keyup":Y=a_;break;case"focusin":ge="focus",Y=_c;break;case"focusout":ge="blur",Y=_c;break;case"beforeblur":case"afterblur":Y=_c;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=Mh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=Yw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=c_;break;case Zh:case ep:case tp:Y=Xw;break;case np:Y=d_;break;case"scroll":case"scrollend":Y=$w;break;case"wheel":Y=h_;break;case"copy":case"cut":case"paste":Y=Zw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=kh;break;case"toggle":case"beforetoggle":Y=m_}var Ae=(i&4)!==0,et=!Ae&&(s==="scroll"||s==="scrollend"),V=Ae?$!==null?$+"Capture":null:$;Ae=[];for(var L=F,z;L!==null;){var te=L;if(z=te.stateNode,te=te.tag,te!==5&&te!==26&&te!==27||z===null||V===null||(te=Hi(L,V),te!=null&&Ae.push(_a(L,te,z))),et)break;L=L.return}0<Ae.length&&($=new Y($,ge,null,l,W),se.push({event:$,listeners:Ae}))}}if((i&7)===0){e:{if($=s==="mouseover"||s==="pointerover",Y=s==="mouseout"||s==="pointerout",$&&l!==mc&&(ge=l.relatedTarget||l.fromElement)&&(Ir(ge)||ge[Ar]))break e;if((Y||$)&&($=W.window===W?W:($=W.ownerDocument)?$.defaultView||$.parentWindow:window,Y?(ge=l.relatedTarget||l.toElement,Y=F,ge=ge?Ir(ge):null,ge!==null&&(et=o(ge),Ae=ge.tag,ge!==et||Ae!==5&&Ae!==27&&Ae!==6)&&(ge=null)):(Y=null,ge=F),Y!==ge)){if(Ae=Mh,te="onMouseLeave",V="onMouseEnter",L="mouse",(s==="pointerout"||s==="pointerover")&&(Ae=kh,te="onPointerLeave",V="onPointerEnter",L="pointer"),et=Y==null?$:Gi(Y),z=ge==null?$:Gi(ge),$=new Ae(te,L+"leave",Y,l,W),$.target=et,$.relatedTarget=z,te=null,Ir(W)===F&&(Ae=new Ae(V,L+"enter",ge,l,W),Ae.target=z,Ae.relatedTarget=et,te=Ae),et=te,Y&&ge)t:{for(Ae=pS,V=Y,L=ge,z=0,te=V;te;te=Ae(te))z++;te=0;for(var Ce=L;Ce;Ce=Ae(Ce))te++;for(;0<z-te;)V=Ae(V),z--;for(;0<te-z;)L=Ae(L),te--;for(;z--;){if(V===L||L!==null&&V===L.alternate){Ae=V;break t}V=Ae(V),L=Ae(L)}Ae=null}else Ae=null;Y!==null&&T0(se,$,Y,Ae,!1),ge!==null&&et!==null&&T0(se,et,ge,Ae,!0)}}e:{if($=F?Gi(F):window,Y=$.nodeName&&$.nodeName.toLowerCase(),Y==="select"||Y==="input"&&$.type==="file")var Fe=Gh;else if(Bh($))if(Hh)Fe=T_;else{Fe=S_;var we=__}else Y=$.nodeName,!Y||Y.toLowerCase()!=="input"||$.type!=="checkbox"&&$.type!=="radio"?F&&pc(F.elementType)&&(Fe=Gh):Fe=E_;if(Fe&&(Fe=Fe(s,F))){Vh(se,Fe,l,W);break e}we&&we(s,$,F),s==="focusout"&&F&&$.type==="number"&&F.memoizedProps.value!=null&&hc($,"number",$.value)}switch(we=F?Gi(F):window,s){case"focusin":(Bh(we)||we.contentEditable==="true")&&(Lr=we,Ac=F,Xi=null);break;case"focusout":Xi=Ac=Lr=null;break;case"mousedown":Ic=!0;break;case"contextmenu":case"mouseup":case"dragend":Ic=!1,Xh(se,l,W);break;case"selectionchange":if(C_)break;case"keydown":case"keyup":Xh(se,l,W)}var Ue;if(Ec)e:{switch(s){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else Or?Lh(s,l)&&(Be="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(Be="onCompositionStart");Be&&(Uh&&l.locale!=="ko"&&(Or||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&Or&&(Ue=Rh()):(vs=W,vc="value"in vs?vs.value:vs.textContent,Or=!0)),we=Wo(F,Be),0<we.length&&(Be=new Ph(Be,s,null,l,W),se.push({event:Be,listeners:we}),Ue?Be.data=Ue:(Ue=qh(l),Ue!==null&&(Be.data=Ue)))),(Ue=y_?x_(s,l):v_(s,l))&&(Be=Wo(F,"onBeforeInput"),0<Be.length&&(we=new Ph("onBeforeInput","beforeinput",null,l,W),se.push({event:we,listeners:Be}),we.data=Ue)),uS(se,s,F,l,W)}S0(se,i)})}function _a(s,i,l){return{instance:s,listener:i,currentTarget:l}}function Wo(s,i){for(var l=i+"Capture",u=[];s!==null;){var y=s,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=Hi(s,l),y!=null&&u.unshift(_a(s,y,b)),y=Hi(s,i),y!=null&&u.push(_a(s,y,b))),s.tag===3)return u;s=s.return}return[]}function pS(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function T0(s,i,l,u,y){for(var b=i._reactName,S=[];l!==null&&l!==u;){var T=l,j=T.alternate,F=T.stateNode;if(T=T.tag,j!==null&&j===u)break;T!==5&&T!==26&&T!==27||F===null||(j=F,y?(F=Hi(l,b),F!=null&&S.unshift(_a(l,F,j))):y||(F=Hi(l,b),F!=null&&S.push(_a(l,F,j)))),l=l.return}S.length!==0&&s.push({event:i,listeners:S})}var mS=/\r\n?/g,gS=/\u0000|\uFFFD/g;function N0(s){return(typeof s=="string"?s:""+s).replace(mS,`
`).replace(gS,"")}function C0(s,i){return i=N0(i),N0(s)===i}function Ze(s,i,l,u,y,b){switch(l){case"children":typeof u=="string"?i==="body"||i==="textarea"&&u===""||kr(s,u):(typeof u=="number"||typeof u=="bigint")&&i!=="body"&&kr(s,""+u);break;case"className":to(s,"class",u);break;case"tabIndex":to(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":to(s,l,u);break;case"style":Ch(s,u,b);break;case"data":if(i!=="object"){to(s,"data",u);break}case"src":case"href":if(u===""&&(i!=="a"||l!=="href")){s.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=so(""+u),s.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(l==="formAction"?(i!=="input"&&Ze(s,i,"name",y.name,y,null),Ze(s,i,"formEncType",y.formEncType,y,null),Ze(s,i,"formMethod",y.formMethod,y,null),Ze(s,i,"formTarget",y.formTarget,y,null)):(Ze(s,i,"encType",y.encType,y,null),Ze(s,i,"method",y.method,y,null),Ze(s,i,"target",y.target,y,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=so(""+u),s.setAttribute(l,u);break;case"onClick":u!=null&&(s.onclick=Yn);break;case"onScroll":u!=null&&Le("scroll",s);break;case"onScrollEnd":u!=null&&Le("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(l=u.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}l=so(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""+u):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":u===!0?s.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,u):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(l,u):s.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(l):s.setAttribute(l,u);break;case"popover":Le("beforetoggle",s),Le("toggle",s),eo(s,"popover",u);break;case"xlinkActuate":Jn(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Jn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Jn(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Jn(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Jn(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Jn(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Jn(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Jn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Jn(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":eo(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=zw.get(l)||l,eo(s,l,u))}}function ed(s,i,l,u,y,b){switch(l){case"style":Ch(s,u,b);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(l=u.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"children":typeof u=="string"?kr(s,u):(typeof u=="number"||typeof u=="bigint")&&kr(s,""+u);break;case"onScroll":u!=null&&Le("scroll",s);break;case"onScrollEnd":u!=null&&Le("scrollend",s);break;case"onClick":u!=null&&(s.onclick=Yn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xh.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),i=l.slice(2,y?l.length-7:void 0),b=s[Ht]||null,b=b!=null?b[l]:null,typeof b=="function"&&s.removeEventListener(i,b,y),typeof u=="function")){typeof b!="function"&&b!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(i,u,y);break e}l in s?s[l]=u:u===!0?s.setAttribute(l,""):eo(s,l,u)}}}function Pt(s,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Le("error",s),Le("load",s);var u=!1,y=!1,b;for(b in l)if(l.hasOwnProperty(b)){var S=l[b];if(S!=null)switch(b){case"src":u=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Ze(s,i,b,S,l,null)}}y&&Ze(s,i,"srcSet",l.srcSet,l,null),u&&Ze(s,i,"src",l.src,l,null);return;case"input":Le("invalid",s);var T=b=S=y=null,j=null,F=null;for(u in l)if(l.hasOwnProperty(u)){var W=l[u];if(W!=null)switch(u){case"name":y=W;break;case"type":S=W;break;case"checked":j=W;break;case"defaultChecked":F=W;break;case"value":b=W;break;case"defaultValue":T=W;break;case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(137,i));break;default:Ze(s,i,u,W,l,null)}}Sh(s,b,T,j,F,S,y,!1);return;case"select":Le("invalid",s),u=S=b=null;for(y in l)if(l.hasOwnProperty(y)&&(T=l[y],T!=null))switch(y){case"value":b=T;break;case"defaultValue":S=T;break;case"multiple":u=T;default:Ze(s,i,y,T,l,null)}i=b,l=S,s.multiple=!!u,i!=null?Pr(s,!!u,i,!1):l!=null&&Pr(s,!!u,l,!0);return;case"textarea":Le("invalid",s),b=y=u=null;for(S in l)if(l.hasOwnProperty(S)&&(T=l[S],T!=null))switch(S){case"value":u=T;break;case"defaultValue":y=T;break;case"children":b=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(r(91));break;default:Ze(s,i,S,T,l,null)}Th(s,u,y,b);return;case"option":for(j in l)if(l.hasOwnProperty(j)&&(u=l[j],u!=null))switch(j){case"selected":s.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:Ze(s,i,j,u,l,null)}return;case"dialog":Le("beforetoggle",s),Le("toggle",s),Le("cancel",s),Le("close",s);break;case"iframe":case"object":Le("load",s);break;case"video":case"audio":for(u=0;u<wa.length;u++)Le(wa[u],s);break;case"image":Le("error",s),Le("load",s);break;case"details":Le("toggle",s);break;case"embed":case"source":case"link":Le("error",s),Le("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(F in l)if(l.hasOwnProperty(F)&&(u=l[F],u!=null))switch(F){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Ze(s,i,F,u,l,null)}return;default:if(pc(i)){for(W in l)l.hasOwnProperty(W)&&(u=l[W],u!==void 0&&ed(s,i,W,u,l,void 0));return}}for(T in l)l.hasOwnProperty(T)&&(u=l[T],u!=null&&Ze(s,i,T,u,l,null))}function yS(s,i,l,u){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,S=null,T=null,j=null,F=null,W=null;for(Y in l){var se=l[Y];if(l.hasOwnProperty(Y)&&se!=null)switch(Y){case"checked":break;case"value":break;case"defaultValue":j=se;default:u.hasOwnProperty(Y)||Ze(s,i,Y,null,u,se)}}for(var $ in u){var Y=u[$];if(se=l[$],u.hasOwnProperty($)&&(Y!=null||se!=null))switch($){case"type":b=Y;break;case"name":y=Y;break;case"checked":F=Y;break;case"defaultChecked":W=Y;break;case"value":S=Y;break;case"defaultValue":T=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(r(137,i));break;default:Y!==se&&Ze(s,i,$,Y,u,se)}}fc(s,S,T,j,F,W,b,y);return;case"select":Y=S=T=$=null;for(b in l)if(j=l[b],l.hasOwnProperty(b)&&j!=null)switch(b){case"value":break;case"multiple":Y=j;default:u.hasOwnProperty(b)||Ze(s,i,b,null,u,j)}for(y in u)if(b=u[y],j=l[y],u.hasOwnProperty(y)&&(b!=null||j!=null))switch(y){case"value":$=b;break;case"defaultValue":T=b;break;case"multiple":S=b;default:b!==j&&Ze(s,i,y,b,u,j)}i=T,l=S,u=Y,$!=null?Pr(s,!!l,$,!1):!!u!=!!l&&(i!=null?Pr(s,!!l,i,!0):Pr(s,!!l,l?[]:"",!1));return;case"textarea":Y=$=null;for(T in l)if(y=l[T],l.hasOwnProperty(T)&&y!=null&&!u.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:Ze(s,i,T,null,u,y)}for(S in u)if(y=u[S],b=l[S],u.hasOwnProperty(S)&&(y!=null||b!=null))switch(S){case"value":$=y;break;case"defaultValue":Y=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==b&&Ze(s,i,S,y,u,b)}Eh(s,$,Y);return;case"option":for(var ge in l)if($=l[ge],l.hasOwnProperty(ge)&&$!=null&&!u.hasOwnProperty(ge))switch(ge){case"selected":s.selected=!1;break;default:Ze(s,i,ge,null,u,$)}for(j in u)if($=u[j],Y=l[j],u.hasOwnProperty(j)&&$!==Y&&($!=null||Y!=null))switch(j){case"selected":s.selected=$&&typeof $!="function"&&typeof $!="symbol";break;default:Ze(s,i,j,$,u,Y)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ae in l)$=l[Ae],l.hasOwnProperty(Ae)&&$!=null&&!u.hasOwnProperty(Ae)&&Ze(s,i,Ae,null,u,$);for(F in u)if($=u[F],Y=l[F],u.hasOwnProperty(F)&&$!==Y&&($!=null||Y!=null))switch(F){case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(r(137,i));break;default:Ze(s,i,F,$,u,Y)}return;default:if(pc(i)){for(var et in l)$=l[et],l.hasOwnProperty(et)&&$!==void 0&&!u.hasOwnProperty(et)&&ed(s,i,et,void 0,u,$);for(W in u)$=u[W],Y=l[W],!u.hasOwnProperty(W)||$===Y||$===void 0&&Y===void 0||ed(s,i,W,$,u,Y);return}}for(var V in l)$=l[V],l.hasOwnProperty(V)&&$!=null&&!u.hasOwnProperty(V)&&Ze(s,i,V,null,u,$);for(se in u)$=u[se],Y=l[se],!u.hasOwnProperty(se)||$===Y||$==null&&Y==null||Ze(s,i,se,$,u,Y)}function A0(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function xS(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,l=performance.getEntriesByType("resource"),u=0;u<l.length;u++){var y=l[u],b=y.transferSize,S=y.initiatorType,T=y.duration;if(b&&T&&A0(S)){for(S=0,T=y.responseEnd,u+=1;u<l.length;u++){var j=l[u],F=j.startTime;if(F>T)break;var W=j.transferSize,se=j.initiatorType;W&&A0(se)&&(j=j.responseEnd,S+=W*(j<T?1:(T-F)/(j-F)))}if(--u,i+=8*(b+S)/(y.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var td=null,nd=null;function Zo(s){return s.nodeType===9?s:s.ownerDocument}function I0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function R0(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function sd(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var rd=null;function vS(){var s=window.event;return s&&s.type==="popstate"?s===rd?!1:(rd=s,!0):(rd=null,!1)}var D0=typeof setTimeout=="function"?setTimeout:void 0,bS=typeof clearTimeout=="function"?clearTimeout:void 0,M0=typeof Promise=="function"?Promise:void 0,wS=typeof queueMicrotask=="function"?queueMicrotask:typeof M0<"u"?function(s){return M0.resolve(null).then(s).catch(_S)}:D0;function _S(s){setTimeout(function(){throw s})}function js(s){return s==="head"}function P0(s,i){var l=i,u=0;do{var y=l.nextSibling;if(s.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(u===0){s.removeChild(y),di(i);return}u--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")u++;else if(l==="html")Sa(s.ownerDocument.documentElement);else if(l==="head"){l=s.ownerDocument.head,Sa(l);for(var b=l.firstChild;b;){var S=b.nextSibling,T=b.nodeName;b[Vi]||T==="SCRIPT"||T==="STYLE"||T==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=S}}else l==="body"&&Sa(s.ownerDocument.body);l=y}while(l);di(i)}function k0(s,i){var l=s;s=0;do{var u=l.nextSibling;if(l.nodeType===1?i?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(i?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),u&&u.nodeType===8)if(l=u.data,l==="/$"){if(s===0)break;s--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||s++;l=u}while(l)}function id(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":id(l),uc(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function SS(s,i,l,u){for(;s.nodeType===1;){var y=l;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[Vi])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(b=s.getAttribute("rel"),b==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(b!==y.rel||s.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||s.getAttribute("title")!==(y.title==null?null:y.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(b=s.getAttribute("src"),(b!==(y.src==null?null:y.src)||s.getAttribute("type")!==(y.type==null?null:y.type)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&s.getAttribute("name")===b)return s}else return s;if(s=bn(s.nextSibling),s===null)break}return null}function ES(s,i,l){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=bn(s.nextSibling),s===null))return null;return s}function U0(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=bn(s.nextSibling),s===null))return null;return s}function ad(s){return s.data==="$?"||s.data==="$~"}function od(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function TS(s,i){var l=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||l.readyState!=="loading")i();else{var u=function(){i(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),s._reactRetry=u}}function bn(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var ld=null;function j0(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"||l==="/&"){if(i===0)return bn(s.nextSibling);i--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||i++}s=s.nextSibling}return null}function O0(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(i===0)return s;i--}else l!=="/$"&&l!=="/&"||i++}s=s.previousSibling}return null}function L0(s,i,l){switch(i=Zo(l),s){case"html":if(s=i.documentElement,!s)throw Error(r(452));return s;case"head":if(s=i.head,!s)throw Error(r(453));return s;case"body":if(s=i.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function Sa(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);uc(s)}var wn=new Map,q0=new Set;function el(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var us=G.d;G.d={f:NS,r:CS,D:AS,C:IS,L:RS,m:DS,X:PS,S:MS,M:kS};function NS(){var s=us.f(),i=Fo();return s||i}function CS(s){var i=Rr(s);i!==null&&i.tag===5&&i.type==="form"?nm(i):us.r(s)}var li=typeof document>"u"?null:document;function B0(s,i,l){var u=li;if(u&&typeof i=="string"&&i){var y=hn(i);y='link[rel="'+s+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),q0.has(y)||(q0.add(y),s={rel:s,crossOrigin:l,href:i},u.querySelector(y)===null&&(i=u.createElement("link"),Pt(i,"link",s),Nt(i),u.head.appendChild(i)))}}function AS(s){us.D(s),B0("dns-prefetch",s,null)}function IS(s,i){us.C(s,i),B0("preconnect",s,i)}function RS(s,i,l){us.L(s,i,l);var u=li;if(u&&s&&i){var y='link[rel="preload"][as="'+hn(i)+'"]';i==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+hn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+hn(l.imageSizes)+'"]')):y+='[href="'+hn(s)+'"]';var b=y;switch(i){case"style":b=ci(s);break;case"script":b=ui(s)}wn.has(b)||(s=v({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:s,as:i},l),wn.set(b,s),u.querySelector(y)!==null||i==="style"&&u.querySelector(Ea(b))||i==="script"&&u.querySelector(Ta(b))||(i=u.createElement("link"),Pt(i,"link",s),Nt(i),u.head.appendChild(i)))}}function DS(s,i){us.m(s,i);var l=li;if(l&&s){var u=i&&typeof i.as=="string"?i.as:"script",y='link[rel="modulepreload"][as="'+hn(u)+'"][href="'+hn(s)+'"]',b=y;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=ui(s)}if(!wn.has(b)&&(s=v({rel:"modulepreload",href:s},i),wn.set(b,s),l.querySelector(y)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Ta(b)))return}u=l.createElement("link"),Pt(u,"link",s),Nt(u),l.head.appendChild(u)}}}function MS(s,i,l){us.S(s,i,l);var u=li;if(u&&s){var y=Dr(u).hoistableStyles,b=ci(s);i=i||"default";var S=y.get(b);if(!S){var T={loading:0,preload:null};if(S=u.querySelector(Ea(b)))T.loading=5;else{s=v({rel:"stylesheet",href:s,"data-precedence":i},l),(l=wn.get(b))&&cd(s,l);var j=S=u.createElement("link");Nt(j),Pt(j,"link",s),j._p=new Promise(function(F,W){j.onload=F,j.onerror=W}),j.addEventListener("load",function(){T.loading|=1}),j.addEventListener("error",function(){T.loading|=2}),T.loading|=4,tl(S,i,u)}S={type:"stylesheet",instance:S,count:1,state:T},y.set(b,S)}}}function PS(s,i){us.X(s,i);var l=li;if(l&&s){var u=Dr(l).hoistableScripts,y=ui(s),b=u.get(y);b||(b=l.querySelector(Ta(y)),b||(s=v({src:s,async:!0},i),(i=wn.get(y))&&ud(s,i),b=l.createElement("script"),Nt(b),Pt(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},u.set(y,b))}}function kS(s,i){us.M(s,i);var l=li;if(l&&s){var u=Dr(l).hoistableScripts,y=ui(s),b=u.get(y);b||(b=l.querySelector(Ta(y)),b||(s=v({src:s,async:!0,type:"module"},i),(i=wn.get(y))&&ud(s,i),b=l.createElement("script"),Nt(b),Pt(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},u.set(y,b))}}function V0(s,i,l,u){var y=(y=me.current)?el(y):null;if(!y)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=ci(l.href),l=Dr(y).hoistableStyles,u=l.get(i),u||(u={type:"style",instance:null,count:0,state:null},l.set(i,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=ci(l.href);var b=Dr(y).hoistableStyles,S=b.get(s);if(S||(y=y.ownerDocument||y,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(s,S),(b=y.querySelector(Ea(s)))&&!b._p&&(S.instance=b,S.state.loading=5),wn.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},wn.set(s,l),b||US(y,s,l,S.state))),i&&u===null)throw Error(r(528,""));return S}if(i&&u!==null)throw Error(r(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=ui(l),l=Dr(y).hoistableScripts,u=l.get(i),u||(u={type:"script",instance:null,count:0,state:null},l.set(i,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function ci(s){return'href="'+hn(s)+'"'}function Ea(s){return'link[rel="stylesheet"]['+s+"]"}function G0(s){return v({},s,{"data-precedence":s.precedence,precedence:null})}function US(s,i,l,u){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?u.loading=1:(i=s.createElement("link"),u.preload=i,i.addEventListener("load",function(){return u.loading|=1}),i.addEventListener("error",function(){return u.loading|=2}),Pt(i,"link",l),Nt(i),s.head.appendChild(i))}function ui(s){return'[src="'+hn(s)+'"]'}function Ta(s){return"script[async]"+s}function H0(s,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var u=s.querySelector('style[data-href~="'+hn(l.href)+'"]');if(u)return i.instance=u,Nt(u),u;var y=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),Nt(u),Pt(u,"style",y),tl(u,l.precedence,s),i.instance=u;case"stylesheet":y=ci(l.href);var b=s.querySelector(Ea(y));if(b)return i.state.loading|=4,i.instance=b,Nt(b),b;u=G0(l),(y=wn.get(y))&&cd(u,y),b=(s.ownerDocument||s).createElement("link"),Nt(b);var S=b;return S._p=new Promise(function(T,j){S.onload=T,S.onerror=j}),Pt(b,"link",u),i.state.loading|=4,tl(b,l.precedence,s),i.instance=b;case"script":return b=ui(l.src),(y=s.querySelector(Ta(b)))?(i.instance=y,Nt(y),y):(u=l,(y=wn.get(b))&&(u=v({},l),ud(u,y)),s=s.ownerDocument||s,y=s.createElement("script"),Nt(y),Pt(y,"link",u),s.head.appendChild(y),i.instance=y);case"void":return null;default:throw Error(r(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(u=i.instance,i.state.loading|=4,tl(u,l.precedence,s));return i.instance}function tl(s,i,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=u.length?u[u.length-1]:null,b=y,S=0;S<u.length;S++){var T=u[S];if(T.dataset.precedence===i)b=T;else if(b!==y)break}b?b.parentNode.insertBefore(s,b.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(s,i.firstChild))}function cd(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function ud(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var nl=null;function z0(s,i,l){if(nl===null){var u=new Map,y=nl=new Map;y.set(l,u)}else y=nl,u=y.get(l),u||(u=new Map,y.set(l,u));if(u.has(s))return u;for(u.set(s,null),l=l.getElementsByTagName(s),y=0;y<l.length;y++){var b=l[y];if(!(b[Vi]||b[It]||s==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var S=b.getAttribute(i)||"";S=s+S;var T=u.get(S);T?T.push(b):u.set(S,[b])}}return u}function F0(s,i,l){s=s.ownerDocument||s,s.head.insertBefore(l,i==="title"?s.querySelector("head > title"):null)}function jS(s,i,l){if(l===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function $0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function OS(s,i,l,u){if(l.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=ci(u.href),b=i.querySelector(Ea(y));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=sl.bind(s),i.then(s,s)),l.state.loading|=4,l.instance=b,Nt(b);return}b=i.ownerDocument||i,u=G0(u),(y=wn.get(y))&&cd(u,y),b=b.createElement("link"),Nt(b);var S=b;S._p=new Promise(function(T,j){S.onload=T,S.onerror=j}),Pt(b,"link",u),l.instance=b}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(l,i),(i=l.state.preload)&&(l.state.loading&3)===0&&(s.count++,l=sl.bind(s),i.addEventListener("load",l),i.addEventListener("error",l))}}var dd=0;function LS(s,i){return s.stylesheets&&s.count===0&&il(s,s.stylesheets),0<s.count||0<s.imgCount?function(l){var u=setTimeout(function(){if(s.stylesheets&&il(s,s.stylesheets),s.unsuspend){var b=s.unsuspend;s.unsuspend=null,b()}},6e4+i);0<s.imgBytes&&dd===0&&(dd=62500*xS());var y=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&il(s,s.stylesheets),s.unsuspend)){var b=s.unsuspend;s.unsuspend=null,b()}},(s.imgBytes>dd?50:800)+i);return s.unsuspend=l,function(){s.unsuspend=null,clearTimeout(u),clearTimeout(y)}}:null}function sl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)il(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var rl=null;function il(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,rl=new Map,i.forEach(qS,s),rl=null,sl.call(s))}function qS(s,i){if(!(i.state.loading&4)){var l=rl.get(s);if(l)var u=l.get(null);else{l=new Map,rl.set(s,l);for(var y=s.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var S=y[b];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(l.set(S.dataset.precedence,S),u=S)}u&&l.set(null,u)}y=i.instance,S=y.getAttribute("data-precedence"),b=l.get(S)||u,b===u&&l.set(null,y),l.set(S,y),this.count++,u=sl.bind(this),y.addEventListener("load",u),y.addEventListener("error",u),b?b.parentNode.insertBefore(y,b.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(y,s.firstChild)),i.state.loading|=4}}var Na={$$typeof:A,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function BS(s,i,l,u,y,b,S,T,j){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ac(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ac(0),this.hiddenUpdates=ac(null),this.identifierPrefix=u,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function J0(s,i,l,u,y,b,S,T,j,F,W,se){return s=new BS(s,i,l,S,j,F,W,se,T),i=1,b===!0&&(i|=24),b=tn(3,null,null,i),s.current=b,b.stateNode=s,i=zc(),i.refCount++,s.pooledCache=i,i.refCount++,b.memoizedState={element:u,isDehydrated:l,cache:i},Yc(b),s}function Y0(s){return s?(s=Vr,s):Vr}function K0(s,i,l,u,y,b){y=Y0(y),u.context===null?u.context=y:u.pendingContext=y,u=Ts(i),u.payload={element:l},b=b===void 0?null:b,b!==null&&(u.callback=b),l=Ns(s,u,i),l!==null&&(Kt(l,s,i),ra(l,s,i))}function Q0(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function fd(s,i){Q0(s,i),(s=s.alternate)&&Q0(s,i)}function X0(s){if(s.tag===13||s.tag===31){var i=tr(s,67108864);i!==null&&Kt(i,s,67108864),fd(s,67108864)}}function W0(s){if(s.tag===13||s.tag===31){var i=on();i=oc(i);var l=tr(s,i);l!==null&&Kt(l,s,i),fd(s,i)}}var al=!0;function VS(s,i,l,u){var y=R.T;R.T=null;var b=G.p;try{G.p=2,hd(s,i,l,u)}finally{G.p=b,R.T=y}}function GS(s,i,l,u){var y=R.T;R.T=null;var b=G.p;try{G.p=8,hd(s,i,l,u)}finally{G.p=b,R.T=y}}function hd(s,i,l,u){if(al){var y=pd(u);if(y===null)Zu(s,i,u,ol,l),eg(s,u);else if(zS(y,s,i,l,u))u.stopPropagation();else if(eg(s,u),i&4&&-1<HS.indexOf(s)){for(;y!==null;){var b=Rr(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var S=Qs(b.pendingLanes);if(S!==0){var T=b;for(T.pendingLanes|=2,T.entangledLanes|=2;S;){var j=1<<31-Zt(S);T.entanglements[1]|=j,S&=~j}Hn(b),(Ye&6)===0&&(Ho=oe()+500,ba(0))}}break;case 31:case 13:T=tr(b,2),T!==null&&Kt(T,b,2),Fo(),fd(b,2)}if(b=pd(u),b===null&&Zu(s,i,u,ol,l),b===y)break;y=b}y!==null&&u.stopPropagation()}else Zu(s,i,u,null,l)}}function pd(s){return s=gc(s),md(s)}var ol=null;function md(s){if(ol=null,s=Ir(s),s!==null){var i=o(s);if(i===null)s=null;else{var l=i.tag;if(l===13){if(s=c(i),s!==null)return s;s=null}else if(l===31){if(s=f(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return ol=s,null}function Z0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ie()){case He:return 2;case $n:return 8;case De:case Tt:return 32;case qn:return 268435456;default:return 32}default:return 32}}var gd=!1,Os=null,Ls=null,qs=null,Ca=new Map,Aa=new Map,Bs=[],HS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function eg(s,i){switch(s){case"focusin":case"focusout":Os=null;break;case"dragenter":case"dragleave":Ls=null;break;case"mouseover":case"mouseout":qs=null;break;case"pointerover":case"pointerout":Ca.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Aa.delete(i.pointerId)}}function Ia(s,i,l,u,y,b){return s===null||s.nativeEvent!==b?(s={blockedOn:i,domEventName:l,eventSystemFlags:u,nativeEvent:b,targetContainers:[y]},i!==null&&(i=Rr(i),i!==null&&X0(i)),s):(s.eventSystemFlags|=u,i=s.targetContainers,y!==null&&i.indexOf(y)===-1&&i.push(y),s)}function zS(s,i,l,u,y){switch(i){case"focusin":return Os=Ia(Os,s,i,l,u,y),!0;case"dragenter":return Ls=Ia(Ls,s,i,l,u,y),!0;case"mouseover":return qs=Ia(qs,s,i,l,u,y),!0;case"pointerover":var b=y.pointerId;return Ca.set(b,Ia(Ca.get(b)||null,s,i,l,u,y)),!0;case"gotpointercapture":return b=y.pointerId,Aa.set(b,Ia(Aa.get(b)||null,s,i,l,u,y)),!0}return!1}function tg(s){var i=Ir(s.target);if(i!==null){var l=o(i);if(l!==null){if(i=l.tag,i===13){if(i=c(l),i!==null){s.blockedOn=i,mh(s.priority,function(){W0(l)});return}}else if(i===31){if(i=f(l),i!==null){s.blockedOn=i,mh(s.priority,function(){W0(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function ll(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=pd(s.nativeEvent);if(l===null){l=s.nativeEvent;var u=new l.constructor(l.type,l);mc=u,l.target.dispatchEvent(u),mc=null}else return i=Rr(l),i!==null&&X0(i),s.blockedOn=l,!1;i.shift()}return!0}function ng(s,i,l){ll(s)&&l.delete(i)}function FS(){gd=!1,Os!==null&&ll(Os)&&(Os=null),Ls!==null&&ll(Ls)&&(Ls=null),qs!==null&&ll(qs)&&(qs=null),Ca.forEach(ng),Aa.forEach(ng)}function cl(s,i){s.blockedOn===i&&(s.blockedOn=null,gd||(gd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,FS)))}var ul=null;function sg(s){ul!==s&&(ul=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){ul===s&&(ul=null);for(var i=0;i<s.length;i+=3){var l=s[i],u=s[i+1],y=s[i+2];if(typeof u!="function"){if(md(u||l)===null)continue;break}var b=Rr(l);b!==null&&(s.splice(i,3),i-=3,pu(b,{pending:!0,data:y,method:l.method,action:u},u,y))}}))}function di(s){function i(j){return cl(j,s)}Os!==null&&cl(Os,s),Ls!==null&&cl(Ls,s),qs!==null&&cl(qs,s),Ca.forEach(i),Aa.forEach(i);for(var l=0;l<Bs.length;l++){var u=Bs[l];u.blockedOn===s&&(u.blockedOn=null)}for(;0<Bs.length&&(l=Bs[0],l.blockedOn===null);)tg(l),l.blockedOn===null&&Bs.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var y=l[u],b=l[u+1],S=y[Ht]||null;if(typeof b=="function")S||sg(l);else if(S){var T=null;if(b&&b.hasAttribute("formAction")){if(y=b,S=b[Ht]||null)T=S.formAction;else if(md(y)!==null)continue}else T=S.action;typeof T=="function"?l[u+1]=T:(l.splice(u,3),u-=3),sg(l)}}}function rg(){function s(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(S){return y=S})},focusReset:"manual",scroll:"manual"})}function i(){y!==null&&(y(),y=null),u||setTimeout(l,20)}function l(){if(!u&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,y=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(l,100),function(){u=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),y!==null&&(y(),y=null)}}}function yd(s){this._internalRoot=s}dl.prototype.render=yd.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(r(409));var l=i.current,u=on();K0(l,u,s,i,null,null)},dl.prototype.unmount=yd.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;K0(s.current,2,null,s,null,null),Fo(),i[Ar]=null}};function dl(s){this._internalRoot=s}dl.prototype.unstable_scheduleHydration=function(s){if(s){var i=ph();s={blockedOn:null,target:s,priority:i};for(var l=0;l<Bs.length&&i!==0&&i<Bs[l].priority;l++);Bs.splice(l,0,s),l===0&&tg(s)}};var ig=e.version;if(ig!=="19.2.0")throw Error(r(527,ig,"19.2.0"));G.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=h(i),s=s!==null?x(s):null,s=s===null?null:s.stateNode,s};var $S={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fl.isDisabled&&fl.supportsFiber)try{Li=fl.inject($S),Wt=fl}catch{}}return Da.createRoot=function(s,i){if(!a(s))throw Error(r(299));var l=!1,u="",y=fm,b=hm,S=pm;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onUncaughtError!==void 0&&(y=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(S=i.onRecoverableError)),i=J0(s,1,!1,null,null,l,u,null,y,b,S,rg),s[Ar]=i.current,Wu(s),new yd(i)},Da.hydrateRoot=function(s,i,l){if(!a(s))throw Error(r(299));var u=!1,y="",b=fm,S=hm,T=pm,j=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(S=l.onCaughtError),l.onRecoverableError!==void 0&&(T=l.onRecoverableError),l.formState!==void 0&&(j=l.formState)),i=J0(s,1,!0,i,l??null,u,y,j,b,S,T,rg),i.context=Y0(null),l=i.current,u=on(),u=oc(u),y=Ts(u),y.callback=null,Ns(l,y,u),l=u,i.current.lanes=l,Bi(i,l),Hn(i),s[Ar]=i.current,Wu(s),new dl(i)},Da.version="19.2.0",Da}var mg;function rE(){if(mg)return bd.exports;mg=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),bd.exports=sE(),bd.exports}var iE=rE();const aE=vf(iE);var Al={isNone:function(){return!0},orElse:function(t){return t},orCall:function(t){return t()},orNull:function(){return null},orThrow:function(t){throw t===void 0&&(t="Unexpected null value"),new TypeError(t)},map:function(){return Al},get:function(){return Al}},Px=(function(){function t(e){this.value=e}return t.prototype.isNone=function(){return!1},t.prototype.orElse=function(){return this.value},t.prototype.orCall=function(){return this.value},t.prototype.orNull=function(){return this.value},t.prototype.orThrow=function(){return this.value},t.prototype.map=function(e){return _e(e(this.value))},t.prototype.get=function(e){return this.map(function(n){return n[e]})},t})();function oE(t){return t===Al||t instanceof Px}function _e(t){return oE(t)?t:t==null?Al:lE(t)}function lE(t){if(t==null)throw new TypeError("some() does not accept null or undefined");return new Px(t)}let Il=class extends Error{constructor(e){super(e.statusText),Object.setPrototypeOf(this,new.target.prototype),this.headers=e.headers,this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.data=e.data}},Vd,kx;"rawJSON"in JSON&&(Vd=function(t,e,n){if(Number.isInteger(e)&&!Number.isSafeInteger(e))try{return BigInt(n.source)}catch{return e}return e},kx=function(t,e){return typeof e=="bigint"?JSON.rawJSON(String(e)):e});const wf=t=>t==="post"||t==="put"||t==="patch"||t==="delete";function cE(t){const e=[],n=(r,a)=>`${encodeURIComponent(r)}=${encodeURIComponent(String(a))}`;return Object.keys(t).forEach(r=>{const a=t[r];a!=null&&(Array.isArray(a)?a.forEach(o=>e.push(n(r,o))):e.push(n(r,a)))}),e.length>0?`?${e.join("&")}`:""}function uE(t,e){return t.replace(/\{([^}]+)\}/g,(n,r)=>{const a=encodeURIComponent(e[r]);return delete e[r],a})}function dE(t,e,n){let r={};return wf(t)?n.forEach(a=>{r[a]=e[a],delete e[a]}):r={...e},cE(r)}function fE(t,e){const n=new Headers(e);return t!==void 0&&!(t instanceof FormData)&&!n.has("Content-Type")&&n.append("Content-Type","application/json"),n.has("Accept")||n.append("Accept","application/json"),n}function hE(t,e){if(!wf(t))return;const n=e instanceof FormData?e:JSON.stringify(e,kx);return t==="delete"&&n==="{}"?void 0:n}function pE(t,e){const n=new Headers(t==null?void 0:t.headers),r=new Headers(e==null?void 0:e.headers);for(const a of r.keys()){const o=r.get(a);o!=null&&n.set(a,o)}return{...t,...e,headers:n}}function mE(t){var p,h;const e=Object.assign(Array.isArray(t.payload)?[]:{},t.payload),n=uE(t.path,e),r=dE(t.method,e,t.queryParams),a=hE(t.method,e),o=wf(t.method)?fE(a,(p=t.init)==null?void 0:p.headers):new Headers((h=t.init)==null?void 0:h.headers),c=t.baseUrl+n+r,f={...t.init,method:t.method.toUpperCase(),headers:o,body:a};return{url:c,init:f}}async function gE(t){if(t.status===204)return;const e=t.headers.get("content-type"),n=await t.text();if(e&&e.includes("application/json"))return JSON.parse(n,Vd);try{return JSON.parse(n,Vd)}catch{return n}}async function yE(t,e){const n=await fetch(t,e),r=await gE(n),a={headers:n.headers,url:n.url,ok:n.ok,status:n.status,statusText:n.statusText,data:r};if(a.ok)return a;throw new Il(a)}function xE(t,e){const n=async(r,a,o)=>{if(t==null||r===t.length)return e(a,o);const c=t[r];return await c(a,o,(f,p)=>n(r+1,f,p))};return(r,a)=>n(0,r,a)}async function vE(t){const{url:e,init:n}=mE(t);return await t.fetch(e,n)}function bE(t){const e=async(n,r)=>{try{return await t(n,r)}catch(a){throw a instanceof Il?new e.Error(a):a}};return e.Error=class extends Il{constructor(n){super(n),Object.setPrototypeOf(this,new.target.prototype)}getActualType(){return{status:this.status,data:this.data}}},e}function wE(){let t="",e={};const n=[],r=xE(n,yE);return{configure:a=>{t=a.baseUrl||"",e=a.init||{},n.splice(0),n.push(...a.use||[])},use:a=>n.push(a),path:a=>({method:o=>({create:(c=>bE((f,p)=>vE({baseUrl:t||"",path:a,method:o,queryParams:Object.keys(c||{}),payload:f,init:pE(e,p),fetch:r})))})})}}const _E={for:()=>wE()},SE=200;class La extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class _f extends La{static forResponse(e){const n=`${e.status}`,r=e.statusText?`(${e.statusText})`:"(Unrecognized Status Code)",a=`${n} ${r}`.trim(),o=e.data?JSON.stringify(e.data,null,2):null;let c="";o&&(c=o.length<=SE?o:o.slice(0,-4)+" ...");const f=`Raw response content:
${c}`;return new _f(`Unexpected Response: ${a}
${f}`)}}class hl extends La{}class EE extends La{}class TE extends La{constructor(e,n){super(e);const r=Number(n);if(isNaN(r))throw new La(`Invalid retryAfter value: ${n}`);this.retry_after=r,Object.setPrototypeOf(this,new.target.prototype)}}function NE(t){return{createShardKey:t.path("/collections/{collection_name}/shards").method("put").create({timeout:!0}),deleteShardKey:t.path("/collections/{collection_name}/shards/delete").method("post").create({timeout:!0}),root:t.path("/").method("get").create(),telemetry:t.path("/telemetry").method("get").create(),metrics:t.path("/metrics").method("get").create(),getLocks:t.path("/locks").method("get").create(),postLocks:t.path("/locks").method("post").create(),healthz:t.path("/healthz").method("get").create(),livez:t.path("/livez").method("get").create(),readyz:t.path("/readyz").method("get").create(),getIssues:t.path("/issues").method("get").create(),clearIssues:t.path("/issues").method("delete").create(),clusterStatus:t.path("/cluster").method("get").create(),recoverCurrentPeer:t.path("/cluster/recover").method("post").create(),removePeer:t.path("/cluster/peer/{peer_id}").method("delete").create({force:!0}),getCollections:t.path("/collections").method("get").create(),getCollection:t.path("/collections/{collection_name}").method("get").create(),createCollection:t.path("/collections/{collection_name}").method("put").create({timeout:!0}),deleteCollection:t.path("/collections/{collection_name}").method("delete").create({timeout:!0}),updateCollection:t.path("/collections/{collection_name}").method("patch").create({timeout:!0}),updateAliases:t.path("/collections/aliases").method("post").create({timeout:!0}),createFieldIndex:t.path("/collections/{collection_name}/index").method("put").create({wait:!0,ordering:!0}),collectionExists:t.path("/collections/{collection_name}/exists").method("get").create(),deleteFieldIndex:t.path("/collections/{collection_name}/index/{field_name}").method("delete").create({wait:!0,ordering:!0}),collectionClusterInfo:t.path("/collections/{collection_name}/cluster").method("get").create(),updateCollectionCluster:t.path("/collections/{collection_name}/cluster").method("post").create({timeout:!0}),getCollectionAliases:t.path("/collections/{collection_name}/aliases").method("get").create(),getCollectionsAliases:t.path("/aliases").method("get").create(),recoverFromUploadedSnapshot:t.path("/collections/{collection_name}/snapshots/upload").method("post").create({wait:!0,priority:!0,checksum:!0}),recoverFromSnapshot:t.path("/collections/{collection_name}/snapshots/recover").method("put").create({wait:!0}),listSnapshots:t.path("/collections/{collection_name}/snapshots").method("get").create(),createSnapshot:t.path("/collections/{collection_name}/snapshots").method("post").create({wait:!0}),getSnapshot:t.path("/collections/{collection_name}/snapshots/{snapshot_name}").method("get").create(),deleteSnapshot:t.path("/collections/{collection_name}/snapshots/{snapshot_name}").method("delete").create({wait:!0}),listFullSnapshots:t.path("/snapshots").method("get").create(),createFullSnapshot:t.path("/snapshots").method("post").create({wait:!0}),getFullSnapshot:t.path("/snapshots/{snapshot_name}").method("get").create(),deleteFullSnapshot:t.path("/snapshots/{snapshot_name}").method("delete").create({wait:!0}),recoverShardFromUploadedSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/upload").method("post").create({wait:!0,priority:!0,checksum:!0}),recoverShardFromSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/recover").method("put").create({wait:!0}),listShardSnapshots:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots").method("get").create(),createShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots").method("post").create({wait:!0}),getShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/{snapshot_name}").method("get").create(),deleteShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/{snapshot_name}").method("delete").create({wait:!0}),getPoint:t.path("/collections/{collection_name}/points/{id}").method("get").create(),upsertPoints:t.path("/collections/{collection_name}/points").method("put").create({wait:!0,ordering:!0}),getPoints:t.path("/collections/{collection_name}/points").method("post").create({consistency:!0,timeout:!0}),deletePoints:t.path("/collections/{collection_name}/points/delete").method("post").create({wait:!0,ordering:!0}),updateVectors:t.path("/collections/{collection_name}/points/vectors").method("put").create({wait:!0,ordering:!0}),deleteVectors:t.path("/collections/{collection_name}/points/vectors/delete").method("post").create({wait:!0,ordering:!0}),overwritePayload:t.path("/collections/{collection_name}/points/payload").method("put").create({wait:!0,ordering:!0}),setPayload:t.path("/collections/{collection_name}/points/payload").method("post").create({wait:!0,ordering:!0}),deletePayload:t.path("/collections/{collection_name}/points/payload/delete").method("post").create({wait:!0,ordering:!0}),clearPayload:t.path("/collections/{collection_name}/points/payload/clear").method("post").create({wait:!0,ordering:!0}),batchUpdate:t.path("/collections/{collection_name}/points/batch").method("post").create({wait:!0,ordering:!0}),scrollPoints:t.path("/collections/{collection_name}/points/scroll").method("post").create({consistency:!0,timeout:!0}),searchPoints:t.path("/collections/{collection_name}/points/search").method("post").create({consistency:!0,timeout:!0}),searchBatchPoints:t.path("/collections/{collection_name}/points/search/batch").method("post").create({consistency:!0,timeout:!0}),searchPointGroups:t.path("/collections/{collection_name}/points/search/groups").method("post").create({consistency:!0,timeout:!0}),recommendPoints:t.path("/collections/{collection_name}/points/recommend").method("post").create({consistency:!0,timeout:!0}),recommendBatchPoints:t.path("/collections/{collection_name}/points/recommend/batch").method("post").create({consistency:!0,timeout:!0}),recommendPointGroups:t.path("/collections/{collection_name}/points/recommend/groups").method("post").create({consistency:!0,timeout:!0}),discoverPoints:t.path("/collections/{collection_name}/points/discover").method("post").create({consistency:!0,timeout:!0}),discoverBatchPoints:t.path("/collections/{collection_name}/points/discover/batch").method("post").create({consistency:!0,timeout:!0}),countPoints:t.path("/collections/{collection_name}/points/count").method("post").create({timeout:!0}),facet:t.path("/collections/{collection_name}/facet").method("post").create({timeout:!0,consistency:!0}),queryPoints:t.path("/collections/{collection_name}/points/query").method("post").create({consistency:!0,timeout:!0}),queryBatchPoints:t.path("/collections/{collection_name}/points/query/batch").method("post").create({consistency:!0,timeout:!0}),queryPointsGroups:t.path("/collections/{collection_name}/points/query/groups").method("post").create({consistency:!0,timeout:!0}),searchMatrixPairs:t.path("/collections/{collection_name}/points/search/matrix/pairs").method("post").create({consistency:!0,timeout:!0}),searchMatrixOffsets:t.path("/collections/{collection_name}/points/search/matrix/offsets").method("post").create({consistency:!0,timeout:!0})}}function CE(t,e){const n=AE(t,e);return NE(n)}function AE(t,{headers:e,timeout:n,connections:r}){const a=[];Number.isFinite(n)&&a.push(async(c,f,p)=>{const h=new AbortController,x=setTimeout(()=>h.abort(),n);try{return await p(c,Object.assign(f,{signal:h.signal}))}catch(v){throw v instanceof Error&&v.name==="AbortError"?new EE(v.message):v}finally{clearTimeout(x)}}),a.push(async(c,f,p)=>{var x;let h;try{if(h=await p(c,f),h.status===200||h.status===201)return h}catch(v){if(v instanceof Il&&v.status===429){const w=(x=v.headers.get("retry-after"))==null?void 0:x[0];if(w)throw new TE(v.message,w)}throw v}throw _f.forResponse(h)});const o=_E.for();return o.configure({baseUrl:t,init:{headers:e,dispatcher:void 0},use:a}),o}const Ed="1.15.1",Gd={parseVersion(t){if(!t)throw new Error("Version is null");let e,n;if([e,n]=t.split(".",2),e=parseInt(e,10),n=parseInt(n,10),isNaN(e)||isNaN(n))throw new Error(`Unable to parse version, expected format: x.y[.z], found: ${t}`);return{major:e,minor:n}},isCompatible(t,e){if(!t||!e)return console.debug(`Unable to compare versions with null values. Client: ${t}, Server: ${e}`),!1;if(t===e)return!0;try{const n=Gd.parseVersion(t),r=Gd.parseVersion(e);return n.major===r.major&&Math.abs(n.minor-r.minor)<=1}catch(n){return console.debug(`Unable to compare versions: ${n}`),!1}}};class IE{constructor({url:e,host:n,apiKey:r,https:a,prefix:o,port:c=6333,timeout:f=3e5,checkCompatibility:p=!0,...h}={}){if(this._https=a??typeof r=="string",this._scheme=this._https?"https":"http",this._prefix=o??"",this._prefix.length>0&&!this._prefix.startsWith("/")&&(this._prefix=`/${this._prefix}`),e&&n)throw new hl(`Only one of \`url\`, \`host\` params can be set. Url is ${e}, host is ${n}`);if(n&&(n.startsWith("http://")||n.startsWith("https://")||/:\d+$/.test(n)))throw new hl("The `host` param is not expected to contain neither protocol (http:// or https://) nor port (:6333).\nTry to use the `url` parameter instead.");if(e){if(!(e.startsWith("http://")||e.startsWith("https://")))throw new hl("The `url` param expected to contain a valid URL starting with a protocol (http:// or https://).");const N=new URL(e);if(this._host=N.hostname,this._port=N.port?Number(N.port):c,this._scheme=N.protocol.replace(":",""),this._prefix.length>0&&N.pathname!=="/")throw new hl(`Prefix can be set either in \`url\` or in \`prefix\`.
url is ${e}, prefix is ${N.pathname}`)}else this._port=c,this._host=n??"127.0.0.1";const x=new Headers([["user-agent","qdrant-js/"+String(Ed)]]),v=h.headers??{};Object.keys(v).forEach(N=>{v[N]&&x.set(N,String(v[N]))}),typeof r=="string"&&(this._scheme==="http"&&console.warn("Api key is used with unsecure connection."),x.set("api-key",r));const w=this._port?`${this._host}:${this._port}`:this._host;this._restUri=`${this._scheme}://${w}${this._prefix}`;const _=h.maxConnections,E={headers:x,timeout:f,connections:_};this._openApiClient=CE(this._restUri,E),p&&this._openApiClient.root({}).then(N=>{const D=N.data.version;Gd.isCompatible(Ed,D)||console.warn(`Client version ${Ed} is incompatible with server version ${D}. Major versions should match and minor version difference must not exceed 1. Set checkCompatibility=false to skip version check.`)}).catch(()=>{console.warn("Failed to obtain server version. Unable to check client-server compatibility. Set checkCompatibility=false to skip version check.")})}api(){return this._openApiClient}async searchBatch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.searchBatchPoints({collection_name:e,consistency:r,timeout:a,searches:n});return _e(o.data.result).orThrow("Search batch returned empty")}async search(e,{shard_key:n,vector:r,limit:a=10,offset:o=0,filter:c,params:f,with_payload:p=!0,with_vector:h=!1,score_threshold:x,consistency:v,timeout:w}){const _=await this._openApiClient.searchPoints({collection_name:e,consistency:v,timeout:w,shard_key:n,vector:r,limit:a,offset:o,filter:c,params:f,with_payload:p,with_vector:h,score_threshold:x});return _e(_.data.result).orThrow("Search returned empty")}async recommendBatch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.recommendBatchPoints({collection_name:e,searches:n,consistency:r,timeout:a});return _e(o.data.result).orElse([])}async recommend_batch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.recommendBatchPoints({collection_name:e,searches:n,consistency:r,timeout:a});return _e(o.data.result).orElse([])}async recommend(e,{shard_key:n,positive:r,negative:a,strategy:o,filter:c,params:f,limit:p=10,offset:h=0,with_payload:x=!0,with_vector:v=!1,score_threshold:w,using:_,lookup_from:E,consistency:N,timeout:D}){const k=await this._openApiClient.recommendPoints({collection_name:e,limit:p,shard_key:n,positive:r,negative:a,strategy:o,filter:c,params:f,offset:h,with_payload:x,with_vector:v,score_threshold:w,using:_,lookup_from:E,consistency:N,timeout:D});return _e(k.data.result).orThrow("Recommend points API returned empty")}async scroll(e,{shard_key:n,filter:r,consistency:a,timeout:o,limit:c=10,offset:f,with_payload:p=!0,with_vector:h=!1,order_by:x}={}){const v=await this._openApiClient.scrollPoints({collection_name:e,shard_key:n,limit:c,offset:f,filter:r,with_payload:p,with_vector:h,order_by:x,consistency:a,timeout:o});return _e(v.data.result).orThrow("Scroll points API returned empty")}async count(e,{shard_key:n,filter:r,exact:a=!0,timeout:o}={}){const c=await this._openApiClient.countPoints({collection_name:e,shard_key:n,filter:r,exact:a,timeout:o});return _e(c.data.result).orThrow("Count points returned empty")}async collectionClusterInfo(e){const n=await this._openApiClient.collectionClusterInfo({collection_name:e});return _e(n.data.result).orThrow("Collection cluster info returned empty")}async updateCollectionCluster(e,{timeout:n,...r}){const a=await this._openApiClient.updateCollectionCluster({collection_name:e,timeout:n,...r});return _e(a.data.result).orThrow("Update collection cluster returned empty")}async updateVectors(e,{wait:n=!0,ordering:r,points:a,shard_key:o}){const c=await this._openApiClient.updateVectors({collection_name:e,wait:n,ordering:r,points:a,shard_key:o});return _e(c.data.result).orThrow("Update vectors returned empty")}async deleteVectors(e,{wait:n=!0,ordering:r,points:a,filter:o,vector:c,shard_key:f}){const p=await this._openApiClient.deleteVectors({collection_name:e,wait:n,ordering:r,points:a,filter:o,vector:c,shard_key:f});return _e(p.data.result).orThrow("Delete vectors returned empty")}async searchPointGroups(e,{consistency:n,timeout:r,shard_key:a,vector:o,filter:c,params:f,with_payload:p=null,with_vector:h=null,score_threshold:x,group_by:v,group_size:w,limit:_}){const E=await this._openApiClient.searchPointGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,vector:o,filter:c,params:f,with_payload:p,with_vector:h,score_threshold:x,group_by:v,group_size:w,limit:_});return _e(E.data.result).orThrow("Search point groups returned empty")}async recommendPointGroups(e,{consistency:n,timeout:r,shard_key:a,positive:o,strategy:c,negative:f=[],filter:p,params:h,with_payload:x=null,with_vector:v=null,score_threshold:w,using:_=null,lookup_from:E=null,group_by:N,group_size:D,limit:k}){const U=await this._openApiClient.recommendPointGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,positive:o,negative:f,strategy:c,filter:p,params:h,with_payload:x,with_vector:v,score_threshold:w,using:_,lookup_from:E,group_by:N,group_size:D,limit:k});return _e(U.data.result).orThrow("Recommend point groups API returned empty")}async upsert(e,{wait:n=!0,ordering:r,...a}){const o=await this._openApiClient.upsertPoints({collection_name:e,wait:n,ordering:r,...a});return _e(o.data.result).orThrow("Upsert returned empty")}async retrieve(e,{shard_key:n,ids:r,with_payload:a=!0,with_vector:o,consistency:c,timeout:f}){const p=await this._openApiClient.getPoints({collection_name:e,shard_key:n,ids:r,with_payload:a,with_vector:o,consistency:c,timeout:f});return _e(p.data.result).orThrow("Retrieve API returned empty")}async delete(e,{wait:n,ordering:r,...a}){const o=await this._openApiClient.deletePoints({collection_name:e,wait:n,ordering:r,...a});return _e(o.data.result).orThrow("Delete points returned empty")}async setPayload(e,{payload:n,points:r,filter:a,shard_key:o,key:c,ordering:f,wait:p=!0}){const h=await this._openApiClient.setPayload({collection_name:e,payload:n,points:r,filter:a,shard_key:o,key:c,wait:p,ordering:f});return _e(h.data.result).orThrow("Set payload returned empty")}async overwritePayload(e,{ordering:n,payload:r,points:a,filter:o,shard_key:c,key:f,wait:p=!0}){const h=await this._openApiClient.overwritePayload({collection_name:e,payload:r,points:a,filter:o,shard_key:c,key:f,wait:p,ordering:n});return _e(h.data.result).orThrow("Overwrite payload returned empty")}async deletePayload(e,{ordering:n,keys:r,points:a,filter:o,shard_key:c,wait:f=!0}){const p=await this._openApiClient.deletePayload({collection_name:e,keys:r,points:a,filter:o,shard_key:c,wait:f,ordering:n});return _e(p.data.result).orThrow("Delete payload returned empty")}async clearPayload(e,{ordering:n,wait:r=!0,...a}){const o=await this._openApiClient.clearPayload({collection_name:e,wait:r,ordering:n,...a});return _e(o.data.result).orThrow("Clear payload returned empty")}async updateCollectionAliases({actions:e,timeout:n}){const r=await this._openApiClient.updateAliases({actions:e,timeout:n});return _e(r.data.result).orThrow("Update aliases returned empty")}async getCollectionAliases(e){const n=await this._openApiClient.getCollectionAliases({collection_name:e});return _e(n.data.result).orThrow("Get collection aliases returned empty")}async getAliases(){const e=await this._openApiClient.getCollectionsAliases({});return _e(e.data.result).orThrow("Get aliases returned empty")}async getCollections(){const e=await this._openApiClient.getCollections({});return _e(e.data.result).orThrow("Get collections returned empty")}async getCollection(e){const n=await this._openApiClient.getCollection({collection_name:e});return _e(n.data.result).orThrow("Get collection returned empty")}async updateCollection(e,n){const r=await this._openApiClient.updateCollection({collection_name:e,...n});return _e(r.data.result).orThrow("Update collection returned empty")}async deleteCollection(e,n){const r=await this._openApiClient.deleteCollection({collection_name:e,...n});return _e(r.data.result).orThrow("Delete collection returned empty")}async createCollection(e,{timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:f,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N}){const D=await this._openApiClient.createCollection({collection_name:e,timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:f,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N});return _e(D.data.result).orThrow("Create collection returned empty")}async recreateCollection(e,{timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:f,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N}){_e(await this._openApiClient.deleteCollection({collection_name:e,timeout:n})).get("ok").orThrow("Delete collection returned failed");const D=await this._openApiClient.createCollection({collection_name:e,timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:f,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:N});return _e(D).orThrow("Create collection returned empty")}async createPayloadIndex(e,{wait:n,ordering:r,field_name:a,field_schema:o}){const c=await this._openApiClient.createFieldIndex({collection_name:e,field_name:a,field_schema:o,wait:n,ordering:r});return _e(c.data.result).orThrow("Create field index returned empty")}async deletePayloadIndex(e,n,{wait:r=!0,ordering:a}={}){const o=await this._openApiClient.deleteFieldIndex({collection_name:e,field_name:n,wait:r,ordering:a});return _e(o.data.result).orThrow("Delete field index returned empty")}async listSnapshots(e){const n=await this._openApiClient.listSnapshots({collection_name:e});return _e(n.data.result).orThrow("List snapshots API returned empty")}async createSnapshot(e,n){const r=await this._openApiClient.createSnapshot({collection_name:e,...n});return _e(r.data.result).orNull()}async deleteSnapshot(e,n,r){const a=await this._openApiClient.deleteSnapshot({collection_name:e,snapshot_name:n,...r});return _e(a.data.result).orThrow("Delete snapshot API returned empty")}async listFullSnapshots(){const e=await this._openApiClient.listFullSnapshots({});return _e(e.data.result).orThrow("List full snapshots API returned empty")}async createFullSnapshot(e){const n=await this._openApiClient.createFullSnapshot(e??{});return _e(n.data.result).orThrow("Create full snapshot API returned empty")}async deleteFullSnapshot(e,n){const r=await this._openApiClient.deleteFullSnapshot({snapshot_name:e,...n});return _e(r.data.result).orThrow("Delete full snapshot API returned empty")}async recoverSnapshot(e,{location:n,priority:r,checksum:a,api_key:o}){const c=await this._openApiClient.recoverFromSnapshot({collection_name:e,location:n,priority:r,checksum:a,api_key:o});return _e(c.data.result).orThrow("Recover from snapshot API returned empty")}async lockStorage(e){const n=await this._openApiClient.postLocks({write:!0,error_message:e});return _e(n.data.result).orThrow("Lock storage returned empty")}async unlockStorage(){const e=await this._openApiClient.postLocks({write:!1});return _e(e.data.result).orThrow("Post locks returned empty")}async getLocks(){const e=await this._openApiClient.getLocks({});return _e(e.data.result).orThrow("Get locks returned empty")}async batchUpdate(e,{wait:n=!0,ordering:r,...a}){const o=await this._openApiClient.batchUpdate({collection_name:e,wait:n,ordering:r,...a});return _e(o.data.result).orThrow("Batch update returned empty")}async recoverShardFromSnapshot(e,n,{wait:r=!0,...a}){const o=await this._openApiClient.recoverShardFromSnapshot({collection_name:e,shard_id:n,wait:r,...a});return _e(o.data.result).orThrow("Recover shard from snapshot returned empty")}async listShardSnapshots(e,n){const r=await this._openApiClient.listShardSnapshots({collection_name:e,shard_id:n});return _e(r.data.result).orThrow("List shard snapshots returned empty")}async createShardSnapshot(e,n,{wait:r=!0}){const a=await this._openApiClient.createShardSnapshot({collection_name:e,shard_id:n,wait:r});return _e(a.data.result).orThrow("Create shard snapshot returned empty")}async deleteShardSnapshot(e,n,r,{wait:a=!0}){const o=await this._openApiClient.deleteShardSnapshot({collection_name:e,shard_id:n,snapshot_name:r,wait:a});return _e(o.data.result).orThrow("Create shard snapshot returned empty")}async createShardKey(e,{shard_key:n,shards_number:r,replication_factor:a,placement:o,timeout:c}){const f=await this._openApiClient.createShardKey({collection_name:e,shard_key:n,shards_number:r,replication_factor:a,placement:o,timeout:c});return _e(f.data.result).orThrow("Create shard key returned empty")}async deleteShardKey(e,{shard_key:n,timeout:r}){const a=await this._openApiClient.deleteShardKey({collection_name:e,shard_key:n,timeout:r});return _e(a.data.result).orThrow("Create shard key returned empty")}async discoverPoints(e,{consistency:n,timeout:r,shard_key:a,target:o,context:c,params:f,limit:p,offset:h,with_payload:x,with_vector:v,using:w,lookup_from:_}){const E=await this._openApiClient.discoverPoints({collection_name:e,consistency:n,timeout:r,shard_key:a,target:o,context:c,params:f,limit:p,offset:h,with_payload:x,with_vector:v,using:w,lookup_from:_});return _e(E.data.result).orThrow("Discover points returned empty")}async discoverBatchPoints(e,{consistency:n,timeout:r,searches:a}){const o=await this._openApiClient.discoverBatchPoints({collection_name:e,consistency:n,timeout:r,searches:a});return _e(o.data.result).orThrow("Discover batch points returned empty")}async versionInfo(){const e=await this._openApiClient.root({});return _e(e.data).orThrow("Version Info returned empty")}async collectionExists(e){const n=await this._openApiClient.collectionExists({collection_name:e});return _e(n.data.result).orThrow("Collection exists returned empty")}async query(e,{consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:f,filter:p,params:h,score_threshold:x,limit:v,offset:w,with_vector:_,with_payload:E,lookup_from:N}){const D=await this._openApiClient.queryPoints({collection_name:e,consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:f,filter:p,params:h,score_threshold:x,limit:v,offset:w,with_vector:_,with_payload:E,lookup_from:N});return _e(D.data.result).orThrow("Query points returned empty")}async queryBatch(e,{consistency:n,timeout:r,searches:a}){const o=await this._openApiClient.queryBatchPoints({collection_name:e,consistency:n,timeout:r,searches:a});return _e(o.data.result).orThrow("Query points returned empty")}async queryGroups(e,{consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:f,filter:p,params:h,score_threshold:x,with_vector:v,with_payload:w,group_by:_,group_size:E,limit:N,with_lookup:D}){const k=await this._openApiClient.queryPointsGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:f,filter:p,params:h,score_threshold:x,with_vector:v,with_payload:w,group_by:_,group_size:E,limit:N,with_lookup:D});return _e(k.data.result).orThrow("Query groups returned empty")}async facet(e,{consistency:n,timeout:r,shard_key:a,key:o,limit:c,filter:f,exact:p}){const h=await this._openApiClient.facet({collection_name:e,consistency:n,timeout:r,shard_key:a,key:o,limit:c,filter:f,exact:p});return _e(h.data.result).orThrow("Facet returned empty")}async searchMatrixPairs(e,{consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:f,using:p}){const h=await this._openApiClient.searchMatrixPairs({collection_name:e,consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:f,using:p});return _e(h.data.result).orThrow("Search points matrix pairs returned empty")}async searchMatrixOffsets(e,{consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:f,using:p}){const h=await this._openApiClient.searchMatrixOffsets({collection_name:e,consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:f,using:p});return _e(h.data.result).orThrow("Search points matrix offsets returned empty")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let RE,DE;function ME(){return{geminiUrl:RE,vertexUrl:DE}}function PE(t,e,n,r){var a,o;if(!(t!=null&&t.baseUrl)){const c=ME();return e?(a=c.vertexUrl)!==null&&a!==void 0?a:n:(o=c.geminiUrl)!==null&&o!==void 0?o:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ms{}function fe(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,a)=>{if(Object.prototype.hasOwnProperty.call(e,a)){const o=e[a];return o!=null?String(o):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function g(t,e,n){for(let o=0;o<e.length-1;o++){const c=e[o];if(c.endsWith("[]")){const f=c.slice(0,-2);if(!(f in t))if(Array.isArray(n))t[f]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(t[f])){const p=t[f];if(Array.isArray(n))for(let h=0;h<p.length;h++){const x=p[h];g(x,e.slice(o+1),n[h])}else for(const h of p)g(h,e.slice(o+1),n)}return}else if(c.endsWith("[0]")){const f=c.slice(0,-3);f in t||(t[f]=[{}]);const p=t[f];g(p[0],e.slice(o+1),n);return}(!t[c]||typeof t[c]!="object")&&(t[c]={}),t=t[c]}const r=e[e.length-1],a=t[r];if(a!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===a)return;if(typeof a=="object"&&typeof n=="object"&&a!==null&&n!==null)Object.assign(a,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function m(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const a=e[r];if(a.endsWith("[]")){const o=a.slice(0,-2);if(o in t){const c=t[o];return Array.isArray(c)?c.map(f=>m(f,e.slice(r+1),n)):n}else return n}else t=t[a]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function kE(t,e){for(const[n,r]of Object.entries(e)){const a=n.split("."),o=r.split("."),c=new Set;let f=-1;for(let p=0;p<a.length;p++)if(a[p]==="*"){f=p;break}if(f!==-1&&o.length>f)for(let p=f;p<o.length;p++){const h=o[p];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&c.add(h)}Hd(t,a,o,0,c)}}function Hd(t,e,n,r,a){if(r>=e.length||typeof t!="object"||t===null)return;const o=e[r];if(o.endsWith("[]")){const c=o.slice(0,-2),f=t;if(c in f&&Array.isArray(f[c]))for(const p of f[c])Hd(p,e,n,r+1,a)}else if(o==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const c=t,f=Object.keys(c).filter(h=>!h.startsWith("_")&&!a.has(h)),p={};for(const h of f)p[h]=c[h];for(const[h,x]of Object.entries(p)){const v=[];for(const w of n.slice(r))w==="*"?v.push(h):v.push(w);g(c,v,x)}for(const h of f)delete c[h]}}else{const c=t;o in c&&Hd(c[o],e,n,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Sf(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function UE(t){const e={},n=m(t,["operationName"]);n!=null&&g(e,["operationName"],n);const r=m(t,["resourceName"]);return r!=null&&g(e,["_url","resourceName"],r),e}function jE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response","generateVideoResponse"]);return c!=null&&g(e,["response"],LE(c)),e}function OE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],qE(c)),e}function LE(t){const e={},n=m(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>BE(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function qE(t){const e={},n=m(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>VE(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function BE(t){const e={},n=m(t,["video"]);return n!=null&&g(e,["video"],JE(n)),e}function VE(t){const e={},n=m(t,["_self"]);return n!=null&&g(e,["video"],YE(n)),e}function GE(t){const e={},n=m(t,["operationName"]);return n!=null&&g(e,["_url","operationName"],n),e}function HE(t){const e={},n=m(t,["operationName"]);return n!=null&&g(e,["_url","operationName"],n),e}function zE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],FE(c)),e}function FE(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function Ux(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],$E(c)),e}function $E(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function JE(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["encodedVideo"]);r!=null&&g(e,["videoBytes"],Sf(r));const a=m(t,["encoding"]);return a!=null&&g(e,["mimeType"],a),e}function YE(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["uri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["videoBytes"],Sf(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var gg;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(gg||(gg={}));var yg;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(yg||(yg={}));var xg;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(xg||(xg={}));var xe;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(xe||(xe={}));var vg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(vg||(vg={}));var bg;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(bg||(bg={}));var wg;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(wg||(wg={}));var _g;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(_g||(_g={}));var Sg;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Sg||(Sg={}));var Eg;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Eg||(Eg={}));var Tg;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Tg||(Tg={}));var Ng;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Ng||(Ng={}));var Cg;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(Cg||(Cg={}));var Ag;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Ag||(Ag={}));var Ig;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Ig||(Ig={}));var Rg;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Rg||(Rg={}));var Dg;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(Dg||(Dg={}));var Mg;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Mg||(Mg={}));var Rl;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Rl||(Rl={}));var Pg;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Pg||(Pg={}));var kg;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(kg||(kg={}));var Ug;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Ug||(Ug={}));var zd;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(zd||(zd={}));var jg;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(jg||(jg={}));var Og;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Og||(Og={}));var Lg;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Lg||(Lg={}));var qg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(qg||(qg={}));var Bg;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Bg||(Bg={}));var Vg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Vg||(Vg={}));var Gg;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Gg||(Gg={}));var Hg;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Hg||(Hg={}));var zg;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(zg||(zg={}));var Fg;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Fg||(Fg={}));var $g;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})($g||($g={}));var Jg;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Jg||(Jg={}));var Yg;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Yg||(Yg={}));var Kg;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Kg||(Kg={}));var Qg;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Qg||(Qg={}));var Xg;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Xg||(Xg={}));var Wg;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Wg||(Wg={}));var Zg;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Zg||(Zg={}));var ey;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(ey||(ey={}));var ty;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(ty||(ty={}));var ny;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(ny||(ny={}));var sy;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(sy||(sy={}));var ry;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(ry||(ry={}));var iy;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(iy||(iy={}));var ay;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(ay||(ay={}));var oy;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(oy||(oy={}));var ly;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(ly||(ly={}));var cy;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(cy||(cy={}));var uy;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(uy||(uy={}));var wi;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(wi||(wi={}));class Fd{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Ma{get text(){var e,n,r,a,o,c,f,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",x=!1;const v=[];for(const w of(p=(f=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)!==null&&p!==void 0?p:[]){for(const[_,E]of Object.entries(w))_!=="text"&&_!=="thought"&&_!=="thoughtSignature"&&(E!==null||E!==void 0)&&v.push(_);if(typeof w.text=="string"){if(typeof w.thought=="boolean"&&w.thought)continue;x=!0,h+=w.text}}return v.length>0&&console.warn(`there are non-text parts ${v} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),x?h:void 0}get data(){var e,n,r,a,o,c,f,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const x=[];for(const v of(p=(f=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)!==null&&p!==void 0?p:[]){for(const[w,_]of Object.entries(v))w!=="inlineData"&&(_!==null||_!==void 0)&&x.push(w);v.inlineData&&typeof v.inlineData.data=="string"&&(h+=atob(v.inlineData.data))}return x.length>0&&console.warn(`there are non-data parts ${x} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,n,r,a,o,c,f,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(p=(f=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)===null||p===void 0?void 0:p.filter(x=>x.functionCall).map(x=>x.functionCall).filter(x=>x!==void 0);if((h==null?void 0:h.length)!==0)return h}get executableCode(){var e,n,r,a,o,c,f,p,h;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const x=(p=(f=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)===null||p===void 0?void 0:p.filter(v=>v.executableCode).map(v=>v.executableCode).filter(v=>v!==void 0);if((x==null?void 0:x.length)!==0)return(h=x==null?void 0:x[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,n,r,a,o,c,f,p,h;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const x=(p=(f=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||f===void 0?void 0:f.parts)===null||p===void 0?void 0:p.filter(v=>v.codeExecutionResult).map(v=>v.codeExecutionResult).filter(v=>v!==void 0);if((x==null?void 0:x.length)!==0)return(h=x==null?void 0:x[0])===null||h===void 0?void 0:h.output}}class dy{}class fy{}class KE{}class QE{}class XE{}class WE{}class hy{}class py{}class my{}class ZE{}class Dl{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Dl;let a;const o=e;return n?a=OE(o):a=jE(o),Object.assign(r,a),r}}class gy{}class yy{}class xy{}class eT{}class tT{}class nT{}class Ef{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Ef,o=zE(e);return Object.assign(r,o),r}}class sT{}class rT{}class iT{}class vy{}class aT{get text(){var e,n,r;let a="",o=!1;const c=[];for(const f of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[p,h]of Object.entries(f))p!=="text"&&p!=="thought"&&h!==null&&c.push(p);if(typeof f.text=="string"){if(typeof f.thought=="boolean"&&f.thought)continue;o=!0,a+=f.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?a:void 0}get data(){var e,n,r;let a="";const o=[];for(const c of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[f,p]of Object.entries(c))f!=="inlineData"&&p!==null&&o.push(f);c.inlineData&&typeof c.inlineData.data=="string"&&(a+=atob(c.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class oT{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Tf{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Tf,o=Ux(e);return Object.assign(r,o),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Je(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function jx(t,e){const n=Je(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function Ox(t){return Array.isArray(t)?t.map(e=>Ml(e)):[Ml(t)]}function Ml(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Lx(t){const e=Ml(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function qx(t){const e=Ml(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function by(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Bx(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>by(e)):[by(t)]}function $d(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function wy(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function _y(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Lt(t){if(t==null)throw new Error("ContentUnion is required");return $d(t)?t:{role:"user",parts:Bx(t)}}function Nf(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=Lt(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=Lt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Lt(n)):[Lt(e)]}function En(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(wy(t)||_y(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Lt(t)]}const e=[],n=[],r=$d(t[0]);for(const a of t){const o=$d(a);if(o!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(a);else{if(wy(a)||_y(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(a)}}return r||e.push({role:"user",parts:Bx(n)}),e}function lT(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(xe).includes(n[0].toUpperCase())?n[0].toUpperCase():xe.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(xe).includes(r.toUpperCase())?r.toUpperCase():xe.TYPE_UNSPECIFIED})}}function _i(t){const e={},n=["items"],r=["anyOf"],a=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&lT(t.type,e);for(const[c,f]of Object.entries(t))if(f!=null)if(c=="type"){if(f==="null")throw new Error("type: null can not be the only possible type for the field.");if(f instanceof Array)continue;e.type=Object.values(xe).includes(f.toUpperCase())?f.toUpperCase():xe.TYPE_UNSPECIFIED}else if(n.includes(c))e[c]=_i(f);else if(r.includes(c)){const p=[];for(const h of f){if(h.type=="null"){e.nullable=!0;continue}p.push(_i(h))}e[c]=p}else if(a.includes(c)){const p={};for(const[h,x]of Object.entries(f))p[h]=_i(x);e[c]=p}else{if(c==="additionalProperties")continue;e[c]=f}return e}function Cf(t){return _i(t)}function Af(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function If(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Ri(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=_i(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=_i(e.response));return t}function Di(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function cT(t,e,n,r=1){const a=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:a?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:a?`${n}/${e}`:e}function gs(t,e){if(typeof e!="string")throw new Error("name must be a string");return cT(t,e,"cachedContents")}function Vx(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Js(t){return Sf(t)}function uT(t){return t!=null&&typeof t=="object"&&"name"in t}function dT(t){return t!=null&&typeof t=="object"&&"video"in t}function fT(t){return t!=null&&typeof t=="object"&&"uri"in t}function Gx(t){var e;let n;if(uT(t)&&(n=t.name),!(fT(t)&&(n=t.uri,n===void 0))&&!(dT(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const a=n.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${n}`);n=a[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Hx(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function zx(t){for(const e of["models","tunedModels","publisherModels"])if(hT(t,e))return t[e];return[]}function hT(t,e){return t!==null&&typeof t=="object"&&e in t}function pT(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function mT(t,e={}){const n=[],r=new Set;for(const a of t){const o=a.name;if(r.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);r.add(o);const c=pT(a,e);c.functionDeclarations&&n.push(...c.functionDeclarations)}return{functionDeclarations:n}}function Fx(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,a=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function gT(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function $x(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const a=n.inlinedResponses;if(!Array.isArray(a)||a.length===0)return t;let o=!1;for(const c of a){if(typeof c!="object"||c===null)continue;const p=c.response;if(typeof p!="object"||p===null)continue;if(p.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Mi(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Jx(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yT(t){const e={},n=m(t,["responsesFile"]);n!=null&&g(e,["fileName"],n);const r=m(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>YT(c))),g(e,["inlinedResponses"],o)}const a=m(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["inlinedEmbedContentResponses"],o)}return e}function xT(t){const e={},n=m(t,["predictionsFormat"]);n!=null&&g(e,["format"],n);const r=m(t,["gcsDestination","outputUriPrefix"]);r!=null&&g(e,["gcsUri"],r);const a=m(t,["bigqueryDestination","outputUri"]);return a!=null&&g(e,["bigqueryUri"],a),e}function vT(t){const e={},n=m(t,["format"]);n!=null&&g(e,["predictionsFormat"],n);const r=m(t,["gcsUri"]);r!=null&&g(e,["gcsDestination","outputUriPrefix"],r);const a=m(t,["bigqueryUri"]);if(a!=null&&g(e,["bigqueryDestination","outputUri"],a),m(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(m(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Nl(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata","displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["metadata","state"]);a!=null&&g(e,["state"],Jx(a));const o=m(t,["metadata","createTime"]);o!=null&&g(e,["createTime"],o);const c=m(t,["metadata","endTime"]);c!=null&&g(e,["endTime"],c);const f=m(t,["metadata","updateTime"]);f!=null&&g(e,["updateTime"],f);const p=m(t,["metadata","model"]);p!=null&&g(e,["model"],p);const h=m(t,["metadata","output"]);return h!=null&&g(e,["dest"],yT($x(h))),e}function Jd(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["state"]);a!=null&&g(e,["state"],Jx(a));const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["createTime"]);c!=null&&g(e,["createTime"],c);const f=m(t,["startTime"]);f!=null&&g(e,["startTime"],f);const p=m(t,["endTime"]);p!=null&&g(e,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(e,["updateTime"],h);const x=m(t,["model"]);x!=null&&g(e,["model"],x);const v=m(t,["inputConfig"]);v!=null&&g(e,["src"],bT(v));const w=m(t,["outputConfig"]);w!=null&&g(e,["dest"],xT($x(w)));const _=m(t,["completionStats"]);return _!=null&&g(e,["completionStats"],_),e}function bT(t){const e={},n=m(t,["instancesFormat"]);n!=null&&g(e,["format"],n);const r=m(t,["gcsSource","uris"]);r!=null&&g(e,["gcsUri"],r);const a=m(t,["bigquerySource","inputUri"]);return a!=null&&g(e,["bigqueryUri"],a),e}function wT(t,e){const n={};if(m(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(m(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=m(e,["fileName"]);r!=null&&g(n,["fileName"],r);const a=m(e,["inlinedRequests"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>JT(t,c))),g(n,["requests","requests"],o)}return n}function _T(t){const e={},n=m(t,["format"]);n!=null&&g(e,["instancesFormat"],n);const r=m(t,["gcsUri"]);r!=null&&g(e,["gcsSource","uris"],r);const a=m(t,["bigqueryUri"]);if(a!=null&&g(e,["bigquerySource","inputUri"],a),m(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function ST(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function ET(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Mi(t,r)),n}function TT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Mi(t,r)),n}function NT(t){const e={},n=m(t,["content"]);n!=null&&g(e,["content"],n);const r=m(t,["citationMetadata"]);r!=null&&g(e,["citationMetadata"],CT(r));const a=m(t,["tokenCount"]);a!=null&&g(e,["tokenCount"],a);const o=m(t,["finishReason"]);o!=null&&g(e,["finishReason"],o);const c=m(t,["avgLogprobs"]);c!=null&&g(e,["avgLogprobs"],c);const f=m(t,["groundingMetadata"]);f!=null&&g(e,["groundingMetadata"],f);const p=m(t,["index"]);p!=null&&g(e,["index"],p);const h=m(t,["logprobsResult"]);h!=null&&g(e,["logprobsResult"],h);const x=m(t,["safetyRatings"]);if(x!=null){let w=x;Array.isArray(w)&&(w=w.map(_=>_)),g(e,["safetyRatings"],w)}const v=m(t,["urlContextMetadata"]);return v!=null&&g(e,["urlContextMetadata"],v),e}function CT(t){const e={},n=m(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["citations"],r)}return e}function Yx(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>tN(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function AT(t,e){const n={},r=m(t,["displayName"]);if(e!==void 0&&r!=null&&g(e,["batch","displayName"],r),m(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function IT(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["dest"]);return e!==void 0&&a!=null&&g(e,["outputConfig"],vT(gT(a))),n}function Sy(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["src"]);a!=null&&g(n,["batch","inputConfig"],wT(t,Fx(t,a)));const o=m(e,["config"]);return o!=null&&AT(o,n),n}function RT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],Je(t,r));const a=m(e,["src"]);a!=null&&g(n,["inputConfig"],_T(Fx(t,a)));const o=m(e,["config"]);return o!=null&&IT(o,n),n}function DT(t,e){const n={},r=m(t,["displayName"]);return e!==void 0&&r!=null&&g(e,["batch","displayName"],r),n}function MT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["src"]);a!=null&&g(n,["batch","inputConfig"],qT(t,a));const o=m(e,["config"]);return o!=null&&DT(o,n),n}function PT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Mi(t,r)),n}function kT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Mi(t,r)),n}function UT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);return o!=null&&g(e,["error"],o),e}function jT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);return o!=null&&g(e,["error"],o),e}function OT(t,e){const n={},r=m(e,["contents"]);if(r!=null){let o=Nf(t,r);Array.isArray(o)&&(o=o.map(c=>c)),g(n,["requests[]","request","content"],o)}const a=m(e,["config"]);return a!=null&&(g(n,["_self"],LT(a,n)),kE(n,{"requests[].*":"requests[].request.*"})),n}function LT(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["requests[]","taskType"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["requests[]","title"],a);const o=m(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&g(e,["requests[]","outputDimensionality"],o),m(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function qT(t,e){const n={},r=m(e,["fileName"]);r!=null&&g(n,["file_name"],r);const a=m(e,["inlinedRequests"]);return a!=null&&g(n,["requests"],OT(t,a)),n}function BT(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function VT(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],Yx(Lt(a)));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const f=m(e,["topK"]);f!=null&&g(r,["topK"],f);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const N=m(e,["seed"]);N!=null&&g(r,["seed"],N);const D=m(e,["responseMimeType"]);D!=null&&g(r,["responseMimeType"],D);const k=m(e,["responseSchema"]);k!=null&&g(r,["responseSchema"],Cf(k));const U=m(e,["responseJsonSchema"]);if(U!=null&&g(r,["responseJsonSchema"],U),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=m(e,["safetySettings"]);if(n!==void 0&&A!=null){let ae=A;Array.isArray(ae)&&(ae=ae.map(ve=>nN(ve))),g(n,["safetySettings"],ae)}const I=m(e,["tools"]);if(n!==void 0&&I!=null){let ae=Di(I);Array.isArray(ae)&&(ae=ae.map(ve=>sN(Ri(ve)))),g(n,["tools"],ae)}const P=m(e,["toolConfig"]);if(n!==void 0&&P!=null&&g(n,["toolConfig"],P),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const B=m(e,["cachedContent"]);n!==void 0&&B!=null&&g(n,["cachedContent"],gs(t,B));const H=m(e,["responseModalities"]);H!=null&&g(r,["responseModalities"],H);const Q=m(e,["mediaResolution"]);Q!=null&&g(r,["mediaResolution"],Q);const J=m(e,["speechConfig"]);if(J!=null&&g(r,["speechConfig"],Af(J)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=m(e,["thinkingConfig"]);O!=null&&g(r,["thinkingConfig"],O);const Z=m(e,["imageConfig"]);return Z!=null&&g(r,["imageConfig"],Z),r}function GT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(h=>NT(h))),g(e,["candidates"],p)}const a=m(t,["modelVersion"]);a!=null&&g(e,["modelVersion"],a);const o=m(t,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);const c=m(t,["responseId"]);c!=null&&g(e,["responseId"],c);const f=m(t,["usageMetadata"]);return f!=null&&g(e,["usageMetadata"],f),e}function HT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Mi(t,r)),n}function zT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Mi(t,r)),n}function FT(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function $T(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function JT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["request","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let f=En(a);Array.isArray(f)&&(f=f.map(p=>Yx(p))),g(n,["request","contents"],f)}const o=m(e,["metadata"]);o!=null&&g(n,["metadata"],o);const c=m(e,["config"]);return c!=null&&g(n,["request","generationConfig"],VT(t,c,m(n,["request"],{}))),n}function YT(t){const e={},n=m(t,["response"]);n!=null&&g(e,["response"],GT(n));const r=m(t,["error"]);return r!=null&&g(e,["error"],r),e}function KT(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);if(e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),m(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function QT(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);e!==void 0&&a!=null&&g(e,["_query","pageToken"],a);const o=m(t,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function XT(t){const e={},n=m(t,["config"]);return n!=null&&KT(n,e),e}function WT(t){const e={},n=m(t,["config"]);return n!=null&&QT(n,e),e}function ZT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["operations"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>Nl(c))),g(e,["batchJobs"],o)}return e}function eN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["batchPredictionJobs"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>Jd(c))),g(e,["batchJobs"],o)}return e}function tN(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],BT(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const f=m(t,["inlineData"]);f!=null&&g(e,["inlineData"],ST(f));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function nN(t){const e={},n=m(t,["category"]);if(n!=null&&g(e,["category"],n),m(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(t,["threshold"]);return r!=null&&g(e,["threshold"],r),e}function sN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=m(t,["googleMaps"]);f!=null&&g(e,["googleMaps"],FT(f));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],$T(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var hs;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(hs||(hs={}));class Tr{constructor(e,n,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,a)}init(e,n,r){var a,o;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!r||Object.keys(r).length===0?c={config:{}}:typeof r=="object"?c=Object.assign({},r):c=r,c.config&&(c.config.pageToken=n.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(o=(a=c.config)===null||a===void 0?void 0:a.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rN extends ms{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new Tr(hs.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=Sy(this.apiClient,e),r=n._url,a=fe("{model}:batchGenerateContent",r),f=n.batch.inputConfig.requests,p=f.requests,h=[];for(const x of p){const v=Object.assign({},x);if(v.systemInstruction){const w=v.systemInstruction;delete v.systemInstruction;const _=v.request;_.systemInstruction=w,v.request=_}h.push(v)}return f.requests=h,delete n.config,delete n._url,delete n._query,{path:a,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const o=this.getGcsUri(e),c=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?r.dest=`${o.slice(0,-6)}/dest`:r.dest=`${o}_dest_${a}`;else if(c)r.dest=`${c}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=RT(this.apiClient,e);return f=fe("batchPredictionJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Jd(x))}else{const h=Sy(this.apiClient,e);return f=fe("{model}:batchGenerateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Nl(x))}}async createEmbeddingsInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=MT(this.apiClient,e);return o=fe("{model}:asyncBatchEmbedContent",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>Nl(p))}}async get(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=zT(this.apiClient,e);return f=fe("batchPredictionJobs/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Jd(x))}else{const h=HT(this.apiClient,e);return f=fe("batches/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Nl(x))}}async cancel(e){var n,r,a,o;let c="",f={};if(this.apiClient.isVertexAI()){const p=TT(this.apiClient,e);c=fe("batchPredictionJobs/{name}:cancel",p._url),f=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const p=ET(this.apiClient,e);c=fe("batches/{name}:cancel",p._url),f=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=WT(e);return f=fe("batchPredictionJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=eN(x),w=new vy;return Object.assign(w,v),w})}else{const h=XT(e);return f=fe("batches",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=ZT(x),w=new vy;return Object.assign(w,v),w})}}async delete(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=kT(this.apiClient,e);return f=fe("batchPredictionJobs/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>jT(x))}else{const h=PT(this.apiClient,e);return f=fe("batches/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>UT(x))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iN(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function Ey(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>NN(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function aN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);e!==void 0&&a!=null&&g(e,["expireTime"],a);const o=m(t,["displayName"]);e!==void 0&&o!=null&&g(e,["displayName"],o);const c=m(t,["contents"]);if(e!==void 0&&c!=null){let x=En(c);Array.isArray(x)&&(x=x.map(v=>Ey(v))),g(e,["contents"],x)}const f=m(t,["systemInstruction"]);e!==void 0&&f!=null&&g(e,["systemInstruction"],Ey(Lt(f)));const p=m(t,["tools"]);if(e!==void 0&&p!=null){let x=p;Array.isArray(x)&&(x=x.map(v=>CN(v))),g(e,["tools"],x)}const h=m(t,["toolConfig"]);if(e!==void 0&&h!=null&&g(e,["toolConfig"],h),m(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function oN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);e!==void 0&&a!=null&&g(e,["expireTime"],a);const o=m(t,["displayName"]);e!==void 0&&o!=null&&g(e,["displayName"],o);const c=m(t,["contents"]);if(e!==void 0&&c!=null){let v=En(c);Array.isArray(v)&&(v=v.map(w=>w)),g(e,["contents"],v)}const f=m(t,["systemInstruction"]);e!==void 0&&f!=null&&g(e,["systemInstruction"],Lt(f));const p=m(t,["tools"]);if(e!==void 0&&p!=null){let v=p;Array.isArray(v)&&(v=v.map(w=>AN(w))),g(e,["tools"],v)}const h=m(t,["toolConfig"]);e!==void 0&&h!=null&&g(e,["toolConfig"],h);const x=m(t,["kmsKeyName"]);return e!==void 0&&x!=null&&g(e,["encryption_spec","kmsKeyName"],x),n}function lN(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],jx(t,r));const a=m(e,["config"]);return a!=null&&aN(a,n),n}function cN(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],jx(t,r));const a=m(e,["config"]);return a!=null&&oN(a,n),n}function uN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],gs(t,r)),n}function dN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],gs(t,r)),n}function fN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function hN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function pN(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function mN(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const f=m(t,["responseJsonSchema"]);return f!=null&&g(e,["responseJsonSchema"],f),e}function gN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],gs(t,r)),n}function yN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],gs(t,r)),n}function xN(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function vN(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function bN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function wN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function _N(t){const e={},n=m(t,["config"]);return n!=null&&bN(n,e),e}function SN(t){const e={},n=m(t,["config"]);return n!=null&&wN(n,e),e}function EN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["cachedContents"],o)}return e}function TN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["cachedContents"],o)}return e}function NN(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],pN(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const f=m(t,["inlineData"]);f!=null&&g(e,["inlineData"],iN(f));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function CN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=m(t,["googleMaps"]);f!=null&&g(e,["googleMaps"],xN(f));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],vN(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function AN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>mN(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const f=m(t,["enterpriseWebSearch"]);f!=null&&g(e,["enterpriseWebSearch"],f);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function IN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);return e!==void 0&&a!=null&&g(e,["expireTime"],a),n}function RN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);return e!==void 0&&a!=null&&g(e,["expireTime"],a),n}function DN(t,e){const n={},r=m(e,["name"]);r!=null&&g(n,["_url","name"],gs(t,r));const a=m(e,["config"]);return a!=null&&IN(a,n),n}function MN(t,e){const n={},r=m(e,["name"]);r!=null&&g(n,["_url","name"],gs(t,r));const a=m(e,["config"]);return a!=null&&RN(a,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PN extends ms{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Tr(hs.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=cN(this.apiClient,e);return f=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=lN(this.apiClient,e);return f=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async get(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=yN(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=gN(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async delete(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=dN(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=hN(x),w=new yy;return Object.assign(w,v),w})}else{const h=uN(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=fN(x),w=new yy;return Object.assign(w,v),w})}}async update(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=MN(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=DN(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async listInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=SN(e);return f=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=TN(x),w=new xy;return Object.assign(w,v),w})}else{const h=_N(e);return f=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=EN(x),w=new xy;return Object.assign(w,v),w})}}}function Ty(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function lt(t){return this instanceof lt?(this.v=t,this):new lt(t)}function Si(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(_){return function(E){return Promise.resolve(E).then(_,v)}}function f(_,E){r[_]&&(a[_]=function(N){return new Promise(function(D,k){o.push([_,N,D,k])>1||p(_,N)})},E&&(a[_]=E(a[_])))}function p(_,E){try{h(r[_](E))}catch(N){w(o[0][3],N)}}function h(_){_.value instanceof lt?Promise.resolve(_.value.v).then(x,v):w(o[0][2],_)}function x(_){p("next",_)}function v(_){p("throw",_)}function w(_,E){_(E),o.shift(),o.length&&p(o[0][0],o[0][1])}}function ka(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ty=="function"?Ty(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(f,p){c=t[o](c),a(f,p,c.done,c.value)})}}function a(o,c,f,p){Promise.resolve(p).then(function(h){o({value:h,done:f})},c)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function kN(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:Kx(n)}function Kx(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function UN(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Ny(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const a=[];let o=!0;for(;r<n&&t[r].role==="model";)a.push(t[r]),o&&!Kx(t[r])&&(o=!1),r++;o?e.push(...a):e.pop()}return e}class jN{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new ON(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class ON{constructor(e,n,r,a={},o=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=a,this.history=o,this.sendPromise=Promise.resolve(),UN(o)}async sendMessage(e){var n;await this.sendPromise;const r=Lt(e.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,c,f;const p=await a,h=(c=(o=p.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content,x=p.automaticFunctionCallingHistory,v=this.getHistory(!0).length;let w=[];x!=null&&(w=(f=x.slice(v))!==null&&f!==void 0?f:[]);const _=h?[h]:[];this.recordHistory(r,_,w)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(e){var n;await this.sendPromise;const r=Lt(e.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const o=await a;return this.processStreamResponse(o,r)}getHistory(e=!1){const n=e?Ny(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var r,a;return Si(this,arguments,function*(){var c,f,p,h;const x=[];try{for(var v=!0,w=ka(e),_;_=yield lt(w.next()),c=_.done,!c;v=!0){h=_.value,v=!1;const E=h;if(kN(E)){const N=(a=(r=E.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content;N!==void 0&&x.push(N)}yield yield lt(E)}}catch(E){f={error:E}}finally{try{!v&&!c&&(p=w.return)&&(yield lt(p.call(w)))}finally{if(f)throw f.error}}this.recordHistory(n,x)})}recordHistory(e,n,r){let a=[];n.length>0&&n.every(o=>o.role!==void 0)?a=n:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Ny(r)):this.history.push(e),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fl extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Fl.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function LN(t){const e={},n=m(t,["file"]);return n!=null&&g(e,["file"],n),e}function qN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function BN(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","file"],Gx(n)),e}function VN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function GN(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","file"],Gx(n)),e}function HN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function zN(t){const e={},n=m(t,["config"]);return n!=null&&HN(n,e),e}function FN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["files"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $N extends ms{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Tr(hs.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=zN(e);return o=fe("files",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=FN(p),x=new sT;return Object.assign(x,h),x})}}async createInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=LN(e);return o=fe("upload/v1beta/files",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=qN(p),x=new rT;return Object.assign(x,h),x})}}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=GN(e);return o=fe("files/{file}",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=BN(e);return o=fe("files/{file}",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=VN(p),x=new iT;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Cl(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function JN(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>lC(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function YN(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function KN(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const f=m(t,["responseJsonSchema"]);return f!=null&&g(e,["responseJsonSchema"],f),e}function QN(t){const e={},n=m(t,["modelSelectionConfig"]);n!=null&&g(e,["modelConfig"],n);const r=m(t,["responseJsonSchema"]);r!=null&&g(e,["responseJsonSchema"],r);const a=m(t,["audioTimestamp"]);a!=null&&g(e,["audioTimestamp"],a);const o=m(t,["candidateCount"]);o!=null&&g(e,["candidateCount"],o);const c=m(t,["enableAffectiveDialog"]);c!=null&&g(e,["enableAffectiveDialog"],c);const f=m(t,["frequencyPenalty"]);f!=null&&g(e,["frequencyPenalty"],f);const p=m(t,["logprobs"]);p!=null&&g(e,["logprobs"],p);const h=m(t,["maxOutputTokens"]);h!=null&&g(e,["maxOutputTokens"],h);const x=m(t,["mediaResolution"]);x!=null&&g(e,["mediaResolution"],x);const v=m(t,["presencePenalty"]);v!=null&&g(e,["presencePenalty"],v);const w=m(t,["responseLogprobs"]);w!=null&&g(e,["responseLogprobs"],w);const _=m(t,["responseMimeType"]);_!=null&&g(e,["responseMimeType"],_);const E=m(t,["responseModalities"]);E!=null&&g(e,["responseModalities"],E);const N=m(t,["responseSchema"]);N!=null&&g(e,["responseSchema"],N);const D=m(t,["routingConfig"]);D!=null&&g(e,["routingConfig"],D);const k=m(t,["seed"]);k!=null&&g(e,["seed"],k);const U=m(t,["speechConfig"]);U!=null&&g(e,["speechConfig"],Qx(U));const A=m(t,["stopSequences"]);A!=null&&g(e,["stopSequences"],A);const I=m(t,["temperature"]);I!=null&&g(e,["temperature"],I);const P=m(t,["thinkingConfig"]);P!=null&&g(e,["thinkingConfig"],P);const B=m(t,["topK"]);B!=null&&g(e,["topK"],B);const H=m(t,["topP"]);if(H!=null&&g(e,["topP"],H),m(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function XN(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function WN(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function ZN(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],r);const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const f=m(t,["topK"]);e!==void 0&&f!=null&&g(e,["setup","generationConfig","topK"],f);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],If(v));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],JN(Lt(E)));const N=m(t,["tools"]);if(e!==void 0&&N!=null){let B=Di(N);Array.isArray(B)&&(B=B.map(H=>uC(Ri(H)))),g(e,["setup","tools"],B)}const D=m(t,["sessionResumption"]);e!==void 0&&D!=null&&g(e,["setup","sessionResumption"],cC(D));const k=m(t,["inputAudioTranscription"]);e!==void 0&&k!=null&&g(e,["setup","inputAudioTranscription"],k);const U=m(t,["outputAudioTranscription"]);e!==void 0&&U!=null&&g(e,["setup","outputAudioTranscription"],U);const A=m(t,["realtimeInputConfig"]);e!==void 0&&A!=null&&g(e,["setup","realtimeInputConfig"],A);const I=m(t,["contextWindowCompression"]);e!==void 0&&I!=null&&g(e,["setup","contextWindowCompression"],I);const P=m(t,["proactivity"]);return e!==void 0&&P!=null&&g(e,["setup","proactivity"],P),n}function eC(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],QN(r));const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const f=m(t,["topK"]);e!==void 0&&f!=null&&g(e,["setup","generationConfig","topK"],f);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],Qx(If(v)));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],Lt(E));const N=m(t,["tools"]);if(e!==void 0&&N!=null){let B=Di(N);Array.isArray(B)&&(B=B.map(H=>dC(Ri(H)))),g(e,["setup","tools"],B)}const D=m(t,["sessionResumption"]);e!==void 0&&D!=null&&g(e,["setup","sessionResumption"],D);const k=m(t,["inputAudioTranscription"]);e!==void 0&&k!=null&&g(e,["setup","inputAudioTranscription"],k);const U=m(t,["outputAudioTranscription"]);e!==void 0&&U!=null&&g(e,["setup","outputAudioTranscription"],U);const A=m(t,["realtimeInputConfig"]);e!==void 0&&A!=null&&g(e,["setup","realtimeInputConfig"],A);const I=m(t,["contextWindowCompression"]);e!==void 0&&I!=null&&g(e,["setup","contextWindowCompression"],I);const P=m(t,["proactivity"]);return e!==void 0&&P!=null&&g(e,["setup","proactivity"],P),n}function tC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],ZN(a,n)),n}function nC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],eC(a,n)),n}function sC(t){const e={},n=m(t,["musicGenerationConfig"]);return n!=null&&g(e,["musicGenerationConfig"],n),e}function rC(t){const e={},n=m(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["weightedPrompts"],r)}return e}function iC(t){const e={},n=m(t,["media"]);if(n!=null){let h=Ox(n);Array.isArray(h)&&(h=h.map(x=>Cl(x))),g(e,["mediaChunks"],h)}const r=m(t,["audio"]);r!=null&&g(e,["audio"],Cl(qx(r)));const a=m(t,["audioStreamEnd"]);a!=null&&g(e,["audioStreamEnd"],a);const o=m(t,["video"]);o!=null&&g(e,["video"],Cl(Lx(o)));const c=m(t,["text"]);c!=null&&g(e,["text"],c);const f=m(t,["activityStart"]);f!=null&&g(e,["activityStart"],f);const p=m(t,["activityEnd"]);return p!=null&&g(e,["activityEnd"],p),e}function aC(t){const e={},n=m(t,["media"]);if(n!=null){let h=Ox(n);Array.isArray(h)&&(h=h.map(x=>x)),g(e,["mediaChunks"],h)}const r=m(t,["audio"]);r!=null&&g(e,["audio"],qx(r));const a=m(t,["audioStreamEnd"]);a!=null&&g(e,["audioStreamEnd"],a);const o=m(t,["video"]);o!=null&&g(e,["video"],Lx(o));const c=m(t,["text"]);c!=null&&g(e,["text"],c);const f=m(t,["activityStart"]);f!=null&&g(e,["activityStart"],f);const p=m(t,["activityEnd"]);return p!=null&&g(e,["activityEnd"],p),e}function oC(t){const e={},n=m(t,["setupComplete"]);n!=null&&g(e,["setupComplete"],n);const r=m(t,["serverContent"]);r!=null&&g(e,["serverContent"],r);const a=m(t,["toolCall"]);a!=null&&g(e,["toolCall"],a);const o=m(t,["toolCallCancellation"]);o!=null&&g(e,["toolCallCancellation"],o);const c=m(t,["usageMetadata"]);c!=null&&g(e,["usageMetadata"],fC(c));const f=m(t,["goAway"]);f!=null&&g(e,["goAway"],f);const p=m(t,["sessionResumptionUpdate"]);return p!=null&&g(e,["sessionResumptionUpdate"],p),e}function lC(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],YN(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const f=m(t,["inlineData"]);f!=null&&g(e,["inlineData"],Cl(f));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function cC(t){const e={},n=m(t,["handle"]);if(n!=null&&g(e,["handle"],n),m(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Qx(t){const e={},n=m(t,["languageCode"]);n!=null&&g(e,["languageCode"],n);const r=m(t,["voiceConfig"]);if(r!=null&&g(e,["voiceConfig"],r),m(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function uC(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=m(t,["googleMaps"]);f!=null&&g(e,["googleMaps"],XN(f));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],WN(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function dC(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>KN(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const f=m(t,["enterpriseWebSearch"]);f!=null&&g(e,["enterpriseWebSearch"],f);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function fC(t){const e={},n=m(t,["promptTokenCount"]);n!=null&&g(e,["promptTokenCount"],n);const r=m(t,["cachedContentTokenCount"]);r!=null&&g(e,["cachedContentTokenCount"],r);const a=m(t,["candidatesTokenCount"]);a!=null&&g(e,["responseTokenCount"],a);const o=m(t,["toolUsePromptTokenCount"]);o!=null&&g(e,["toolUsePromptTokenCount"],o);const c=m(t,["thoughtsTokenCount"]);c!=null&&g(e,["thoughtsTokenCount"],c);const f=m(t,["totalTokenCount"]);f!=null&&g(e,["totalTokenCount"],f);const p=m(t,["promptTokensDetails"]);if(p!=null){let _=p;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["promptTokensDetails"],_)}const h=m(t,["cacheTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["cacheTokensDetails"],_)}const x=m(t,["candidatesTokensDetails"]);if(x!=null){let _=x;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["responseTokensDetails"],_)}const v=m(t,["toolUsePromptTokensDetails"]);if(v!=null){let _=v;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["toolUsePromptTokensDetails"],_)}const w=m(t,["trafficType"]);return w!=null&&g(e,["trafficType"],w),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hC(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function pC(t){const e={},n=m(t,["content"]);n!=null&&g(e,["content"],n);const r=m(t,["citationMetadata"]);r!=null&&g(e,["citationMetadata"],mC(r));const a=m(t,["tokenCount"]);a!=null&&g(e,["tokenCount"],a);const o=m(t,["finishReason"]);o!=null&&g(e,["finishReason"],o);const c=m(t,["avgLogprobs"]);c!=null&&g(e,["avgLogprobs"],c);const f=m(t,["groundingMetadata"]);f!=null&&g(e,["groundingMetadata"],f);const p=m(t,["index"]);p!=null&&g(e,["index"],p);const h=m(t,["logprobsResult"]);h!=null&&g(e,["logprobsResult"],h);const x=m(t,["safetyRatings"]);if(x!=null){let w=x;Array.isArray(w)&&(w=w.map(_=>_)),g(e,["safetyRatings"],w)}const v=m(t,["urlContextMetadata"]);return v!=null&&g(e,["urlContextMetadata"],v),e}function mC(t){const e={},n=m(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["citations"],r)}return e}function gC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let o=En(a);Array.isArray(o)&&(o=o.map(c=>c)),g(n,["contents"],o)}return n}function yC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(e,["tokensInfo"],a)}return e}function xC(t){const e={},n=m(t,["values"]);n!=null&&g(e,["values"],n);const r=m(t,["statistics"]);return r!=null&&g(e,["statistics"],vC(r)),e}function vC(t){const e={},n=m(t,["truncated"]);n!=null&&g(e,["truncated"],n);const r=m(t,["token_count"]);return r!=null&&g(e,["tokenCount"],r),e}function $l(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>E1(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function bC(t){const e={},n=m(t,["controlType"]);n!=null&&g(e,["controlType"],n);const r=m(t,["enableControlImageComputation"]);return r!=null&&g(e,["computeControl"],r),e}function wC(t){const e={};if(m(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(m(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(m(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function _C(t,e){const n={},r=m(t,["systemInstruction"]);e!==void 0&&r!=null&&g(e,["systemInstruction"],Lt(r));const a=m(t,["tools"]);if(e!==void 0&&a!=null){let c=a;Array.isArray(c)&&(c=c.map(f=>tv(f))),g(e,["tools"],c)}const o=m(t,["generationConfig"]);return e!==void 0&&o!=null&&g(e,["generationConfig"],d1(o)),n}function SC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(f=>$l(f))),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&wC(o),n}function EC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(f=>f)),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&_C(o,n),n}function TC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["totalTokens"]);r!=null&&g(e,["totalTokens"],r);const a=m(t,["cachedContentTokenCount"]);return a!=null&&g(e,["cachedContentTokenCount"],a),e}function NC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["totalTokens"]);return r!=null&&g(e,["totalTokens"],r),e}function CC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function AC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function IC(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function RC(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function DC(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["negativePrompt"]);e!==void 0&&a!=null&&g(e,["parameters","negativePrompt"],a);const o=m(t,["numberOfImages"]);e!==void 0&&o!=null&&g(e,["parameters","sampleCount"],o);const c=m(t,["aspectRatio"]);e!==void 0&&c!=null&&g(e,["parameters","aspectRatio"],c);const f=m(t,["guidanceScale"]);e!==void 0&&f!=null&&g(e,["parameters","guidanceScale"],f);const p=m(t,["seed"]);e!==void 0&&p!=null&&g(e,["parameters","seed"],p);const h=m(t,["safetyFilterLevel"]);e!==void 0&&h!=null&&g(e,["parameters","safetySetting"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&g(e,["parameters","includeSafetyAttributes"],v);const w=m(t,["includeRaiReason"]);e!==void 0&&w!=null&&g(e,["parameters","includeRaiReason"],w);const _=m(t,["language"]);e!==void 0&&_!=null&&g(e,["parameters","language"],_);const E=m(t,["outputMimeType"]);e!==void 0&&E!=null&&g(e,["parameters","outputOptions","mimeType"],E);const N=m(t,["outputCompressionQuality"]);e!==void 0&&N!=null&&g(e,["parameters","outputOptions","compressionQuality"],N);const D=m(t,["addWatermark"]);e!==void 0&&D!=null&&g(e,["parameters","addWatermark"],D);const k=m(t,["labels"]);e!==void 0&&k!=null&&g(e,["labels"],k);const U=m(t,["editMode"]);e!==void 0&&U!=null&&g(e,["parameters","editMode"],U);const A=m(t,["baseSteps"]);return e!==void 0&&A!=null&&g(e,["parameters","editConfig","baseSteps"],A),n}function MC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["referenceImages"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(p=>R1(p))),g(n,["instances[0]","referenceImages"],f)}const c=m(e,["config"]);return c!=null&&DC(c,n),n}function PC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>Jl(o))),g(e,["generatedImages"],a)}return e}function kC(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["requests[]","taskType"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["requests[]","title"],a);const o=m(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&g(e,["requests[]","outputDimensionality"],o),m(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function UC(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["instances[]","task_type"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["instances[]","title"],a);const o=m(t,["outputDimensionality"]);e!==void 0&&o!=null&&g(e,["parameters","outputDimensionality"],o);const c=m(t,["mimeType"]);e!==void 0&&c!=null&&g(e,["instances[]","mimeType"],c);const f=m(t,["autoTruncate"]);return e!==void 0&&f!=null&&g(e,["parameters","autoTruncate"],f),n}function jC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let f=Nf(t,a);Array.isArray(f)&&(f=f.map(p=>p)),g(n,["requests[]","content"],f)}const o=m(e,["config"]);o!=null&&kC(o,n);const c=m(e,["model"]);return c!==void 0&&g(n,["requests[]","model"],Je(t,c)),n}function OC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=Nf(t,a);Array.isArray(c)&&(c=c.map(f=>f)),g(n,["instances[]","content"],c)}const o=m(e,["config"]);return o!=null&&UC(o,n),n}function LC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["embeddings"],o)}const a=m(t,["metadata"]);return a!=null&&g(e,["metadata"],a),e}function qC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>xC(c))),g(e,["embeddings"],o)}const a=m(t,["metadata"]);return a!=null&&g(e,["metadata"],a),e}function BC(t){const e={},n=m(t,["endpoint"]);n!=null&&g(e,["name"],n);const r=m(t,["deployedModelId"]);return r!=null&&g(e,["deployedModelId"],r),e}function VC(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function GC(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const f=m(t,["responseJsonSchema"]);return f!=null&&g(e,["responseJsonSchema"],f),e}function HC(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],$l(Lt(a)));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const f=m(e,["topK"]);f!=null&&g(r,["topK"],f);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const N=m(e,["seed"]);N!=null&&g(r,["seed"],N);const D=m(e,["responseMimeType"]);D!=null&&g(r,["responseMimeType"],D);const k=m(e,["responseSchema"]);k!=null&&g(r,["responseSchema"],Cf(k));const U=m(e,["responseJsonSchema"]);if(U!=null&&g(r,["responseJsonSchema"],U),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=m(e,["safetySettings"]);if(n!==void 0&&A!=null){let ae=A;Array.isArray(ae)&&(ae=ae.map(ve=>D1(ve))),g(n,["safetySettings"],ae)}const I=m(e,["tools"]);if(n!==void 0&&I!=null){let ae=Di(I);Array.isArray(ae)&&(ae=ae.map(ve=>O1(Ri(ve)))),g(n,["tools"],ae)}const P=m(e,["toolConfig"]);if(n!==void 0&&P!=null&&g(n,["toolConfig"],P),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const B=m(e,["cachedContent"]);n!==void 0&&B!=null&&g(n,["cachedContent"],gs(t,B));const H=m(e,["responseModalities"]);H!=null&&g(r,["responseModalities"],H);const Q=m(e,["mediaResolution"]);Q!=null&&g(r,["mediaResolution"],Q);const J=m(e,["speechConfig"]);if(J!=null&&g(r,["speechConfig"],Af(J)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=m(e,["thinkingConfig"]);O!=null&&g(r,["thinkingConfig"],O);const Z=m(e,["imageConfig"]);return Z!=null&&g(r,["imageConfig"],Z),r}function zC(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],Lt(a));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const f=m(e,["topK"]);f!=null&&g(r,["topK"],f);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const N=m(e,["seed"]);N!=null&&g(r,["seed"],N);const D=m(e,["responseMimeType"]);D!=null&&g(r,["responseMimeType"],D);const k=m(e,["responseSchema"]);k!=null&&g(r,["responseSchema"],Cf(k));const U=m(e,["responseJsonSchema"]);U!=null&&g(r,["responseJsonSchema"],U);const A=m(e,["routingConfig"]);A!=null&&g(r,["routingConfig"],A);const I=m(e,["modelSelectionConfig"]);I!=null&&g(r,["modelConfig"],I);const P=m(e,["safetySettings"]);if(n!==void 0&&P!=null){let R=P;Array.isArray(R)&&(R=R.map(G=>G)),g(n,["safetySettings"],R)}const B=m(e,["tools"]);if(n!==void 0&&B!=null){let R=Di(B);Array.isArray(R)&&(R=R.map(G=>tv(Ri(G)))),g(n,["tools"],R)}const H=m(e,["toolConfig"]);n!==void 0&&H!=null&&g(n,["toolConfig"],H);const Q=m(e,["labels"]);n!==void 0&&Q!=null&&g(n,["labels"],Q);const J=m(e,["cachedContent"]);n!==void 0&&J!=null&&g(n,["cachedContent"],gs(t,J));const O=m(e,["responseModalities"]);O!=null&&g(r,["responseModalities"],O);const Z=m(e,["mediaResolution"]);Z!=null&&g(r,["mediaResolution"],Z);const ae=m(e,["speechConfig"]);ae!=null&&g(r,["speechConfig"],ev(Af(ae)));const ve=m(e,["audioTimestamp"]);ve!=null&&g(r,["audioTimestamp"],ve);const ye=m(e,["thinkingConfig"]);ye!=null&&g(r,["thinkingConfig"],ye);const Me=m(e,["imageConfig"]);return Me!=null&&g(r,["imageConfig"],Me),r}function Cy(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(f=>$l(f))),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&g(n,["generationConfig"],HC(t,o,n)),n}function Ay(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["contents"]);if(a!=null){let c=En(a);Array.isArray(c)&&(c=c.map(f=>f)),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&g(n,["generationConfig"],zC(t,o,n)),n}function Iy(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(h=>pC(h))),g(e,["candidates"],p)}const a=m(t,["modelVersion"]);a!=null&&g(e,["modelVersion"],a);const o=m(t,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);const c=m(t,["responseId"]);c!=null&&g(e,["responseId"],c);const f=m(t,["usageMetadata"]);return f!=null&&g(e,["usageMetadata"],f),e}function Ry(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let h=r;Array.isArray(h)&&(h=h.map(x=>x)),g(e,["candidates"],h)}const a=m(t,["createTime"]);a!=null&&g(e,["createTime"],a);const o=m(t,["modelVersion"]);o!=null&&g(e,["modelVersion"],o);const c=m(t,["promptFeedback"]);c!=null&&g(e,["promptFeedback"],c);const f=m(t,["responseId"]);f!=null&&g(e,["responseId"],f);const p=m(t,["usageMetadata"]);return p!=null&&g(e,["usageMetadata"],p),e}function FC(t,e){const n={};if(m(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=m(t,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["aspectRatio"]);e!==void 0&&a!=null&&g(e,["parameters","aspectRatio"],a);const o=m(t,["guidanceScale"]);if(e!==void 0&&o!=null&&g(e,["parameters","guidanceScale"],o),m(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=m(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);const f=m(t,["personGeneration"]);e!==void 0&&f!=null&&g(e,["parameters","personGeneration"],f);const p=m(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&g(e,["parameters","includeSafetyAttributes"],p);const h=m(t,["includeRaiReason"]);e!==void 0&&h!=null&&g(e,["parameters","includeRaiReason"],h);const x=m(t,["language"]);e!==void 0&&x!=null&&g(e,["parameters","language"],x);const v=m(t,["outputMimeType"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","mimeType"],v);const w=m(t,["outputCompressionQuality"]);if(e!==void 0&&w!=null&&g(e,["parameters","outputOptions","compressionQuality"],w),m(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _=m(t,["imageSize"]);if(e!==void 0&&_!=null&&g(e,["parameters","sampleImageSize"],_),m(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function $C(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["negativePrompt"]);e!==void 0&&a!=null&&g(e,["parameters","negativePrompt"],a);const o=m(t,["numberOfImages"]);e!==void 0&&o!=null&&g(e,["parameters","sampleCount"],o);const c=m(t,["aspectRatio"]);e!==void 0&&c!=null&&g(e,["parameters","aspectRatio"],c);const f=m(t,["guidanceScale"]);e!==void 0&&f!=null&&g(e,["parameters","guidanceScale"],f);const p=m(t,["seed"]);e!==void 0&&p!=null&&g(e,["parameters","seed"],p);const h=m(t,["safetyFilterLevel"]);e!==void 0&&h!=null&&g(e,["parameters","safetySetting"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&g(e,["parameters","includeSafetyAttributes"],v);const w=m(t,["includeRaiReason"]);e!==void 0&&w!=null&&g(e,["parameters","includeRaiReason"],w);const _=m(t,["language"]);e!==void 0&&_!=null&&g(e,["parameters","language"],_);const E=m(t,["outputMimeType"]);e!==void 0&&E!=null&&g(e,["parameters","outputOptions","mimeType"],E);const N=m(t,["outputCompressionQuality"]);e!==void 0&&N!=null&&g(e,["parameters","outputOptions","compressionQuality"],N);const D=m(t,["addWatermark"]);e!==void 0&&D!=null&&g(e,["parameters","addWatermark"],D);const k=m(t,["labels"]);e!==void 0&&k!=null&&g(e,["labels"],k);const U=m(t,["imageSize"]);e!==void 0&&U!=null&&g(e,["parameters","sampleImageSize"],U);const A=m(t,["enhancePrompt"]);return e!==void 0&&A!=null&&g(e,["parameters","enhancePrompt"],A),n}function JC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["config"]);return o!=null&&FC(o,n),n}function YC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["config"]);return o!=null&&$C(o,n),n}function KC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>o1(c))),g(e,["generatedImages"],o)}const a=m(t,["positivePromptSafetyAttributes"]);return a!=null&&g(e,["positivePromptSafetyAttributes"],Wx(a)),e}function QC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>Jl(c))),g(e,["generatedImages"],o)}const a=m(t,["positivePromptSafetyAttributes"]);return a!=null&&g(e,["positivePromptSafetyAttributes"],Zx(a)),e}function XC(t,e){const n={},r=m(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r),m(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=m(t,["durationSeconds"]);if(e!==void 0&&a!=null&&g(e,["parameters","durationSeconds"],a),m(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=m(t,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);const c=m(t,["resolution"]);e!==void 0&&c!=null&&g(e,["parameters","resolution"],c);const f=m(t,["personGeneration"]);if(e!==void 0&&f!=null&&g(e,["parameters","personGeneration"],f),m(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const p=m(t,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);const h=m(t,["enhancePrompt"]);if(e!==void 0&&h!=null&&g(e,["parameters","enhancePrompt"],h),m(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const x=m(t,["lastFrame"]);e!==void 0&&x!=null&&g(e,["instances[0]","lastFrame"],Yl(x));const v=m(t,["referenceImages"]);if(e!==void 0&&v!=null){let w=v;Array.isArray(w)&&(w=w.map(_=>Q1(_))),g(e,["instances[0]","referenceImages"],w)}if(m(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(m(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function WC(t,e){const n={},r=m(t,["numberOfVideos"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["outputGcsUri"]);e!==void 0&&a!=null&&g(e,["parameters","storageUri"],a);const o=m(t,["fps"]);e!==void 0&&o!=null&&g(e,["parameters","fps"],o);const c=m(t,["durationSeconds"]);e!==void 0&&c!=null&&g(e,["parameters","durationSeconds"],c);const f=m(t,["seed"]);e!==void 0&&f!=null&&g(e,["parameters","seed"],f);const p=m(t,["aspectRatio"]);e!==void 0&&p!=null&&g(e,["parameters","aspectRatio"],p);const h=m(t,["resolution"]);e!==void 0&&h!=null&&g(e,["parameters","resolution"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["pubsubTopic"]);e!==void 0&&v!=null&&g(e,["parameters","pubsubTopic"],v);const w=m(t,["negativePrompt"]);e!==void 0&&w!=null&&g(e,["parameters","negativePrompt"],w);const _=m(t,["enhancePrompt"]);e!==void 0&&_!=null&&g(e,["parameters","enhancePrompt"],_);const E=m(t,["generateAudio"]);e!==void 0&&E!=null&&g(e,["parameters","generateAudio"],E);const N=m(t,["lastFrame"]);e!==void 0&&N!=null&&g(e,["instances[0]","lastFrame"],Un(N));const D=m(t,["referenceImages"]);if(e!==void 0&&D!=null){let A=D;Array.isArray(A)&&(A=A.map(I=>X1(I))),g(e,["instances[0]","referenceImages"],A)}const k=m(t,["mask"]);e!==void 0&&k!=null&&g(e,["instances[0]","mask"],K1(k));const U=m(t,["compressionQuality"]);return e!==void 0&&U!=null&&g(e,["parameters","compressionQuality"],U),n}function ZC(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response","generateVideoResponse"]);return c!=null&&g(e,["response"],s1(c)),e}function e1(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],r1(c)),e}function t1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["image"]);o!=null&&g(n,["instances[0]","image"],Yl(o));const c=m(e,["video"]);c!=null&&g(n,["instances[0]","video"],nv(c));const f=m(e,["source"]);f!=null&&i1(f,n);const p=m(e,["config"]);return p!=null&&XC(p,n),n}function n1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["image"]);o!=null&&g(n,["instances[0]","image"],Un(o));const c=m(e,["video"]);c!=null&&g(n,["instances[0]","video"],sv(c));const f=m(e,["source"]);f!=null&&a1(f,n);const p=m(e,["config"]);return p!=null&&WC(p,n),n}function s1(t){const e={},n=m(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>c1(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function r1(t){const e={},n=m(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>u1(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function i1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Yl(a));const o=m(t,["video"]);return e!==void 0&&o!=null&&g(e,["instances[0]","video"],nv(o)),n}function a1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Un(a));const o=m(t,["video"]);return e!==void 0&&o!=null&&g(e,["instances[0]","video"],sv(o)),n}function o1(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["image"],g1(n));const r=m(t,["raiFilteredReason"]);r!=null&&g(e,["raiFilteredReason"],r);const a=m(t,["_self"]);return a!=null&&g(e,["safetyAttributes"],Wx(a)),e}function Jl(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["image"],Xx(n));const r=m(t,["raiFilteredReason"]);r!=null&&g(e,["raiFilteredReason"],r);const a=m(t,["_self"]);a!=null&&g(e,["safetyAttributes"],Zx(a));const o=m(t,["prompt"]);return o!=null&&g(e,["enhancedPrompt"],o),e}function l1(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["mask"],Xx(n));const r=m(t,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(e,["labels"],a)}return e}function c1(t){const e={},n=m(t,["video"]);return n!=null&&g(e,["video"],J1(n)),e}function u1(t){const e={},n=m(t,["_self"]);return n!=null&&g(e,["video"],Y1(n)),e}function d1(t){const e={},n=m(t,["modelSelectionConfig"]);n!=null&&g(e,["modelConfig"],n);const r=m(t,["responseJsonSchema"]);r!=null&&g(e,["responseJsonSchema"],r);const a=m(t,["audioTimestamp"]);a!=null&&g(e,["audioTimestamp"],a);const o=m(t,["candidateCount"]);o!=null&&g(e,["candidateCount"],o);const c=m(t,["enableAffectiveDialog"]);c!=null&&g(e,["enableAffectiveDialog"],c);const f=m(t,["frequencyPenalty"]);f!=null&&g(e,["frequencyPenalty"],f);const p=m(t,["logprobs"]);p!=null&&g(e,["logprobs"],p);const h=m(t,["maxOutputTokens"]);h!=null&&g(e,["maxOutputTokens"],h);const x=m(t,["mediaResolution"]);x!=null&&g(e,["mediaResolution"],x);const v=m(t,["presencePenalty"]);v!=null&&g(e,["presencePenalty"],v);const w=m(t,["responseLogprobs"]);w!=null&&g(e,["responseLogprobs"],w);const _=m(t,["responseMimeType"]);_!=null&&g(e,["responseMimeType"],_);const E=m(t,["responseModalities"]);E!=null&&g(e,["responseModalities"],E);const N=m(t,["responseSchema"]);N!=null&&g(e,["responseSchema"],N);const D=m(t,["routingConfig"]);D!=null&&g(e,["routingConfig"],D);const k=m(t,["seed"]);k!=null&&g(e,["seed"],k);const U=m(t,["speechConfig"]);U!=null&&g(e,["speechConfig"],ev(U));const A=m(t,["stopSequences"]);A!=null&&g(e,["stopSequences"],A);const I=m(t,["temperature"]);I!=null&&g(e,["temperature"],I);const P=m(t,["thinkingConfig"]);P!=null&&g(e,["thinkingConfig"],P);const B=m(t,["topK"]);B!=null&&g(e,["topK"],B);const H=m(t,["topP"]);if(H!=null&&g(e,["topP"],H),m(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function f1(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function h1(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Je(t,r)),n}function p1(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function m1(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function g1(t){const e={},n=m(t,["bytesBase64Encoded"]);n!=null&&g(e,["imageBytes"],Js(n));const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function Xx(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["imageBytes"],Js(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function Yl(t){const e={};if(m(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=m(t,["imageBytes"]);n!=null&&g(e,["bytesBase64Encoded"],Js(n));const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function Un(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["imageBytes"]);r!=null&&g(e,["bytesBase64Encoded"],Js(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function y1(t,e,n){const r={},a=m(e,["pageSize"]);n!==void 0&&a!=null&&g(n,["_query","pageSize"],a);const o=m(e,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const c=m(e,["filter"]);n!==void 0&&c!=null&&g(n,["_query","filter"],c);const f=m(e,["queryBase"]);return n!==void 0&&f!=null&&g(n,["_url","models_url"],Hx(t,f)),r}function x1(t,e,n){const r={},a=m(e,["pageSize"]);n!==void 0&&a!=null&&g(n,["_query","pageSize"],a);const o=m(e,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const c=m(e,["filter"]);n!==void 0&&c!=null&&g(n,["_query","filter"],c);const f=m(e,["queryBase"]);return n!==void 0&&f!=null&&g(n,["_url","models_url"],Hx(t,f)),r}function v1(t,e){const n={},r=m(e,["config"]);return r!=null&&y1(t,r,n),n}function b1(t,e){const n={},r=m(e,["config"]);return r!=null&&x1(t,r,n),n}function w1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["_self"]);if(a!=null){let o=zx(a);Array.isArray(o)&&(o=o.map(c=>Yd(c))),g(e,["models"],o)}return e}function _1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["_self"]);if(a!=null){let o=zx(a);Array.isArray(o)&&(o=o.map(c=>Kd(c))),g(e,["models"],o)}return e}function S1(t){const e={},n=m(t,["maskMode"]);n!=null&&g(e,["maskMode"],n);const r=m(t,["segmentationClasses"]);r!=null&&g(e,["maskClasses"],r);const a=m(t,["maskDilation"]);return a!=null&&g(e,["dilation"],a),e}function Yd(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);a!=null&&g(e,["description"],a);const o=m(t,["version"]);o!=null&&g(e,["version"],o);const c=m(t,["_self"]);c!=null&&g(e,["tunedModelInfo"],L1(c));const f=m(t,["inputTokenLimit"]);f!=null&&g(e,["inputTokenLimit"],f);const p=m(t,["outputTokenLimit"]);p!=null&&g(e,["outputTokenLimit"],p);const h=m(t,["supportedGenerationMethods"]);h!=null&&g(e,["supportedActions"],h);const x=m(t,["temperature"]);x!=null&&g(e,["temperature"],x);const v=m(t,["maxTemperature"]);v!=null&&g(e,["maxTemperature"],v);const w=m(t,["topP"]);w!=null&&g(e,["topP"],w);const _=m(t,["topK"]);_!=null&&g(e,["topK"],_);const E=m(t,["thinking"]);return E!=null&&g(e,["thinking"],E),e}function Kd(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);a!=null&&g(e,["description"],a);const o=m(t,["versionId"]);o!=null&&g(e,["version"],o);const c=m(t,["deployedModels"]);if(c!=null){let v=c;Array.isArray(v)&&(v=v.map(w=>BC(w))),g(e,["endpoints"],v)}const f=m(t,["labels"]);f!=null&&g(e,["labels"],f);const p=m(t,["_self"]);p!=null&&g(e,["tunedModelInfo"],q1(p));const h=m(t,["defaultCheckpointId"]);h!=null&&g(e,["defaultCheckpointId"],h);const x=m(t,["checkpoints"]);if(x!=null){let v=x;Array.isArray(v)&&(v=v.map(w=>w)),g(e,["checkpoints"],v)}return e}function E1(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],VC(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const f=m(t,["inlineData"]);f!=null&&g(e,["inlineData"],hC(f));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function T1(t){const e={},n=m(t,["productImage"]);return n!=null&&g(e,["image"],Un(n)),e}function N1(t,e){const n={},r=m(t,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["baseSteps"]);e!==void 0&&a!=null&&g(e,["parameters","baseSteps"],a);const o=m(t,["outputGcsUri"]);e!==void 0&&o!=null&&g(e,["parameters","storageUri"],o);const c=m(t,["seed"]);e!==void 0&&c!=null&&g(e,["parameters","seed"],c);const f=m(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&g(e,["parameters","safetySetting"],f);const p=m(t,["personGeneration"]);e!==void 0&&p!=null&&g(e,["parameters","personGeneration"],p);const h=m(t,["addWatermark"]);e!==void 0&&h!=null&&g(e,["parameters","addWatermark"],h);const x=m(t,["outputMimeType"]);e!==void 0&&x!=null&&g(e,["parameters","outputOptions","mimeType"],x);const v=m(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);const w=m(t,["enhancePrompt"]);e!==void 0&&w!=null&&g(e,["parameters","enhancePrompt"],w);const _=m(t,["labels"]);return e!==void 0&&_!=null&&g(e,["labels"],_),n}function C1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["source"]);a!=null&&I1(a,n);const o=m(e,["config"]);return o!=null&&N1(o,n),n}function A1(t){const e={},n=m(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Jl(a))),g(e,["generatedImages"],r)}return e}function I1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["personImage"]);e!==void 0&&a!=null&&g(e,["instances[0]","personImage","image"],Un(a));const o=m(t,["productImages"]);if(e!==void 0&&o!=null){let c=o;Array.isArray(c)&&(c=c.map(f=>T1(f))),g(e,["instances[0]","productImages"],c)}return n}function R1(t){const e={},n=m(t,["referenceImage"]);n!=null&&g(e,["referenceImage"],Un(n));const r=m(t,["referenceId"]);r!=null&&g(e,["referenceId"],r);const a=m(t,["referenceType"]);a!=null&&g(e,["referenceType"],a);const o=m(t,["maskImageConfig"]);o!=null&&g(e,["maskImageConfig"],S1(o));const c=m(t,["controlImageConfig"]);c!=null&&g(e,["controlImageConfig"],bC(c));const f=m(t,["styleImageConfig"]);f!=null&&g(e,["styleImageConfig"],f);const p=m(t,["subjectImageConfig"]);return p!=null&&g(e,["subjectImageConfig"],p),e}function Wx(t){const e={},n=m(t,["safetyAttributes","categories"]);n!=null&&g(e,["categories"],n);const r=m(t,["safetyAttributes","scores"]);r!=null&&g(e,["scores"],r);const a=m(t,["contentType"]);return a!=null&&g(e,["contentType"],a),e}function Zx(t){const e={},n=m(t,["safetyAttributes","categories"]);n!=null&&g(e,["categories"],n);const r=m(t,["safetyAttributes","scores"]);r!=null&&g(e,["scores"],r);const a=m(t,["contentType"]);return a!=null&&g(e,["contentType"],a),e}function D1(t){const e={},n=m(t,["category"]);if(n!=null&&g(e,["category"],n),m(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(t,["threshold"]);return r!=null&&g(e,["threshold"],r),e}function M1(t){const e={},n=m(t,["image"]);return n!=null&&g(e,["image"],Un(n)),e}function P1(t,e){const n={},r=m(t,["mode"]);e!==void 0&&r!=null&&g(e,["parameters","mode"],r);const a=m(t,["maxPredictions"]);e!==void 0&&a!=null&&g(e,["parameters","maxPredictions"],a);const o=m(t,["confidenceThreshold"]);e!==void 0&&o!=null&&g(e,["parameters","confidenceThreshold"],o);const c=m(t,["maskDilation"]);e!==void 0&&c!=null&&g(e,["parameters","maskDilation"],c);const f=m(t,["binaryColorThreshold"]);e!==void 0&&f!=null&&g(e,["parameters","binaryColorThreshold"],f);const p=m(t,["labels"]);return e!==void 0&&p!=null&&g(e,["labels"],p),n}function k1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["source"]);a!=null&&j1(a,n);const o=m(e,["config"]);return o!=null&&P1(o,n),n}function U1(t){const e={},n=m(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>l1(a))),g(e,["generatedMasks"],r)}return e}function j1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Un(a));const o=m(t,["scribbleImage"]);return e!==void 0&&o!=null&&g(e,["instances[0]","scribble"],M1(o)),n}function ev(t){const e={},n=m(t,["languageCode"]);n!=null&&g(e,["languageCode"],n);const r=m(t,["voiceConfig"]);if(r!=null&&g(e,["voiceConfig"],r),m(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function O1(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=m(t,["googleMaps"]);f!=null&&g(e,["googleMaps"],p1(f));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],m1(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function tv(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>GC(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const f=m(t,["enterpriseWebSearch"]);f!=null&&g(e,["enterpriseWebSearch"],f);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function L1(t){const e={},n=m(t,["baseModel"]);n!=null&&g(e,["baseModel"],n);const r=m(t,["createTime"]);r!=null&&g(e,["createTime"],r);const a=m(t,["updateTime"]);return a!=null&&g(e,["updateTime"],a),e}function q1(t){const e={},n=m(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&g(e,["baseModel"],n);const r=m(t,["createTime"]);r!=null&&g(e,["createTime"],r);const a=m(t,["updateTime"]);return a!=null&&g(e,["updateTime"],a),e}function B1(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);e!==void 0&&a!=null&&g(e,["description"],a);const o=m(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&g(e,["defaultCheckpointId"],o),n}function V1(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);e!==void 0&&a!=null&&g(e,["description"],a);const o=m(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&g(e,["defaultCheckpointId"],o),n}function G1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","name"],Je(t,r));const a=m(e,["config"]);return a!=null&&B1(a,n),n}function H1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&V1(a,n),n}function z1(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);const o=m(t,["personGeneration"]);e!==void 0&&o!=null&&g(e,["parameters","personGeneration"],o);const c=m(t,["includeRaiReason"]);e!==void 0&&c!=null&&g(e,["parameters","includeRaiReason"],c);const f=m(t,["outputMimeType"]);e!==void 0&&f!=null&&g(e,["parameters","outputOptions","mimeType"],f);const p=m(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p);const h=m(t,["enhanceInputImage"]);e!==void 0&&h!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],h);const x=m(t,["imagePreservationFactor"]);e!==void 0&&x!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],x);const v=m(t,["labels"]);e!==void 0&&v!=null&&g(e,["labels"],v);const w=m(t,["numberOfImages"]);e!==void 0&&w!=null&&g(e,["parameters","sampleCount"],w);const _=m(t,["mode"]);return e!==void 0&&_!=null&&g(e,["parameters","mode"],_),n}function F1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Je(t,r));const a=m(e,["image"]);a!=null&&g(n,["instances[0]","image"],Un(a));const o=m(e,["upscaleFactor"]);o!=null&&g(n,["parameters","upscaleConfig","upscaleFactor"],o);const c=m(e,["config"]);return c!=null&&z1(c,n),n}function $1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>Jl(o))),g(e,["generatedImages"],a)}return e}function J1(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["encodedVideo"]);r!=null&&g(e,["videoBytes"],Js(r));const a=m(t,["encoding"]);return a!=null&&g(e,["mimeType"],a),e}function Y1(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["uri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["videoBytes"],Js(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function K1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["_self"],Un(n));const r=m(t,["maskMode"]);return r!=null&&g(e,["maskMode"],r),e}function Q1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["image"],Yl(n));const r=m(t,["referenceType"]);return r!=null&&g(e,["referenceType"],r),e}function X1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["image"],Un(n));const r=m(t,["referenceType"]);return r!=null&&g(e,["referenceType"],r),e}function nv(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["videoBytes"]);r!=null&&g(e,["encodedVideo"],Js(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["encoding"],a),e}function sv(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["videoBytes"]);r!=null&&g(e,["bytesBase64Encoded"],Js(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const W1="Content-Type",Z1="X-Server-Timeout",eA="User-Agent",Qd="x-goog-api-client",tA="1.29.1",nA=`google-genai-sdk/${tA}`,sA="v1beta1",rA="v1beta",Dy=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class iA{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:sA,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:rA,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const a=[this.getRequestUrlInternal(n)];return r&&a.push(this.getBaseResourcePath()),e!==""&&a.push(e),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[c,f]of Object.entries(e.queryParams))a.searchParams.append(c,String(f));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,a.toString(),e.abortSignal),this.unaryApiCall(a,o,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[a,o]of Object.entries(n))typeof o=="object"?r[a]=Object.assign(Object.assign({},r[a]),o):o!==void 0&&(r[a]=o);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,n,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,a.toString(),e.abortSignal),this.streamApiCall(a,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,a){if(n&&n.timeout||a){const o=new AbortController,c=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const f=setTimeout(()=>o.abort(),n.timeout);f&&typeof f.unref=="function"&&f.unref()}a&&a.addEventListener("abort",()=>{o.abort()}),e.signal=c}return n&&n.extraBody!==null&&aA(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await My(a),new Fd(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await My(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(e){var n;return Si(this,arguments,function*(){const a=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let c="";for(;;){const{done:f,value:p}=yield lt(a.read());if(f){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const h=o.decode(p,{stream:!0});try{const v=JSON.parse(h);if("error"in v){const w=JSON.parse(JSON.stringify(v.error)),_=w.status,E=w.code,N=`got status: ${_}. ${JSON.stringify(v)}`;if(E>=400&&E<600)throw new Fl({message:N,status:E})}}catch(v){if(v.name==="ApiError")throw v}c+=h;let x=c.match(Dy);for(;x;){const v=x[1];try{const w=new Response(v,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield lt(new Fd(w)),c=c.slice(x[0].length),x=c.match(Dy)}catch(w){throw new Error(`exception parsing stream chunk ${v}. ${w}`)}}}}finally{a.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=nA+" "+this.clientOptions.userAgentExtra;return e[eA]=n,e[Qd]=n,e[W1]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[a,o]of Object.entries(e.headers))r.append(a,o);e.timeout&&e.timeout>0&&r.append(Z1,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const a={};n!=null&&(a.mimeType=n.mimeType,a.name=n.name,a.displayName=n.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const o=this.clientOptions.uploader,c=await o.stat(e);a.sizeBytes=String(c.size);const f=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:c.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=f;const p={file:a},h=this.getFileName(e),x=fe("upload/v1beta/files",p._url),v=await this.fetchUploadUrl(x,a.sizeBytes,a.mimeType,h,p,n==null?void 0:n.httpOptions);return o.upload(e,v,this)}async uploadFileToFileSearchStore(e,n,r){var a;const o=this.clientOptions.uploader,c=await o.stat(n),f=String(c.size),p=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:c.type;if(p===void 0||p==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${e}:uploadToFileSearchStore`,x=this.getFileName(n),v={};r!=null&&r.customMetadata&&(v.customMetadata=r.customMetadata),r!=null&&r.chunkingConfig&&(v.chunkingConfig=r.chunkingConfig);const w=await this.fetchUploadUrl(h,f,p,x,v,r==null?void 0:r.httpOptions);return o.uploadToFileSearchStore(n,w,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,a,o,c){var f;let p={};c?p=c:p={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const h=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:p});if(!h||!(h!=null&&h.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const x=(f=h==null?void 0:h.headers)===null||f===void 0?void 0:f["x-goog-upload-url"];if(x===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return x}}async function My(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const a=JSON.stringify(r);throw n>=400&&n<600?new Fl({message:a,status:n}):new Error(a)}}function aA(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(o,c){const f=Object.assign({},o);for(const p in c)if(Object.prototype.hasOwnProperty.call(c,p)){const h=c[p],x=f[p];h&&typeof h=="object"&&!Array.isArray(h)&&x&&typeof x=="object"&&!Array.isArray(x)?f[p]=r(x,h):(x&&h&&typeof x!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${p}". Original type: ${typeof x}, New type: ${typeof h}. Overwriting.`),f[p]=h)}return f}const a=r(n,e);t.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oA="mcp_used/unknown";let lA=!1;function rv(t){for(const e of t)if(cA(e)||typeof e=="object"&&"inputSchema"in e)return!0;return lA}function iv(t){var e;const n=(e=t[Qd])!==null&&e!==void 0?e:"";t[Qd]=(n+` ${oA}`).trimStart()}function cA(t){return t!==null&&typeof t=="object"&&t instanceof Rf}function uA(t,e=100){return Si(this,arguments,function*(){let r,a=0;for(;a<e;){const o=yield lt(t.listTools({cursor:r}));for(const c of o.tools)yield yield lt(c),a++;if(!o.nextCursor)break;r=o.nextCursor}})}class Rf{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Rf(e,n)}async initialize(){var e,n,r,a;if(this.mcpTools.length>0)return;const o={},c=[];for(const x of this.mcpClients)try{for(var f=!0,p=(n=void 0,ka(uA(x))),h;h=await p.next(),e=h.done,!e;f=!0){a=h.value,f=!1;const v=a;c.push(v);const w=v.name;if(o[w])throw new Error(`Duplicate function name ${w} found in MCP tools. Please ensure function names are unique.`);o[w]=x}}catch(v){n={error:v}}finally{try{!f&&!e&&(r=p.return)&&await r.call(p)}finally{if(n)throw n.error}}this.mcpTools=c,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),mT(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const c=await a.callTool({name:r.name,arguments:r.args},void 0,o);n.push({functionResponse:{name:r.name,response:c.isError?{error:c}:c}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function dA(t,e,n){const r=new oT;let a;n.data instanceof Blob?a=JSON.parse(await n.data.text()):a=JSON.parse(n.data),Object.assign(r,a),e(r)}class fA{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),c=mA(this.apiClient.getDefaultHeaders()),f=this.apiClient.getApiKey(),p=`${a}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${f}`;let h=()=>{};const x=new Promise(A=>{h=A}),v=e.callbacks,w=function(){h({})},_=this.apiClient,E={onopen:w,onmessage:A=>{dA(_,v.onmessage,A)},onerror:(n=v==null?void 0:v.onerror)!==null&&n!==void 0?n:function(A){},onclose:(r=v==null?void 0:v.onclose)!==null&&r!==void 0?r:function(A){}},N=this.webSocketFactory.create(p,pA(c),E);N.connect(),await x;const U={setup:{model:Je(this.apiClient,e.model)}};return N.send(JSON.stringify(U)),new hA(N,this.apiClient)}}class hA{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=rC(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=sC(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(wi.PLAY)}pause(){this.sendPlaybackControl(wi.PAUSE)}stop(){this.sendPlaybackControl(wi.STOP)}resetContext(){this.sendPlaybackControl(wi.RESET_CONTEXT)}close(){this.conn.close()}}function pA(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function mA(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const gA="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function yA(t,e,n){const r=new aT;let a;n.data instanceof Blob?a=await n.data.text():n.data instanceof ArrayBuffer?a=new TextDecoder().decode(n.data):a=n.data;const o=JSON.parse(a);if(t.isVertexAI()){const c=oC(o);Object.assign(r,c)}else Object.assign(r,o);e(r)}class xA{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new fA(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,a,o,c,f;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const p=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let x;const v=this.apiClient.getHeaders();e.config&&e.config.tools&&rv(e.config.tools)&&iv(v);const w=_A(v);if(this.apiClient.isVertexAI())x=`${p}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(w,x);else{const J=this.apiClient.getApiKey();let O="BidiGenerateContent",Z="key";J!=null&&J.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),O="BidiGenerateContentConstrained",Z="access_token"),x=`${p}/ws/google.ai.generativelanguage.${h}.GenerativeService.${O}?${Z}=${J}`}let _=()=>{};const E=new Promise(J=>{_=J}),N=e.callbacks,D=function(){var J;(J=N==null?void 0:N.onopen)===null||J===void 0||J.call(N),_({})},k=this.apiClient,U={onopen:D,onmessage:J=>{yA(k,N.onmessage,J)},onerror:(n=N==null?void 0:N.onerror)!==null&&n!==void 0?n:function(J){},onclose:(r=N==null?void 0:N.onclose)!==null&&r!==void 0?r:function(J){}},A=this.webSocketFactory.create(x,wA(w),U);A.connect(),await E;let I=Je(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&I.startsWith("publishers/")){const J=this.apiClient.getProject(),O=this.apiClient.getLocation();I=`projects/${J}/locations/${O}/`+I}let P={};this.apiClient.isVertexAI()&&((a=e.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Rl.AUDIO]}:e.config.responseModalities=[Rl.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const B=(f=(c=e.config)===null||c===void 0?void 0:c.tools)!==null&&f!==void 0?f:[],H=[];for(const J of B)if(this.isCallableTool(J)){const O=J;H.push(await O.tool())}else H.push(J);H.length>0&&(e.config.tools=H);const Q={model:I,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?P=nC(this.apiClient,Q):P=tC(this.apiClient,Q),delete P.config,A.send(JSON.stringify(P)),new bA(A,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const vA={turnComplete:!0};class bA{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=En(n.turns),e.isVertexAI()||(r=r.map(a=>$l(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(gA)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},vA),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:aC(e)}:n={realtimeInput:iC(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function wA(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function _A(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Py=10;function ky(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let a=!1;for(const c of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(Ei(c)){a=!0;break}if(!a)return!0;const o=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Ei(t){return"callTool"in t&&typeof t.callTool=="function"}function SA(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(a=>Ei(a)))!==null&&r!==void 0?r:!1}function Uy(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,a)=>{if(Ei(r))return;const o=r;o.functionDeclarations&&o.functionDeclarations.length>0&&n.push(a)}),n}function jy(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class EA extends ms{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,a,o,c,f;const p=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!SA(n)||ky(n.config))return await this.generateContentInternal(p);const h=Uy(n);if(h.length>0){const N=h.map(D=>`tools[${D}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${N}.`)}let x,v;const w=En(p.contents),_=(o=(a=(r=p.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&o!==void 0?o:Py;let E=0;for(;E<_&&(x=await this.generateContentInternal(p),!(!x.functionCalls||x.functionCalls.length===0));){const N=x.candidates[0].content,D=[];for(const k of(f=(c=n.config)===null||c===void 0?void 0:c.tools)!==null&&f!==void 0?f:[])if(Ei(k)){const A=await k.callTool(x.functionCalls);D.push(...A)}E++,v={role:"user",parts:D},p.contents=En(p.contents),p.contents.push(N),p.contents.push(v),jy(p.config)&&(w.push(N),w.push(v))}return jy(p.config)&&(x.automaticFunctionCallingHistory=w),x},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),ky(n.config)){const a=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(a)}const r=Uy(n);if(r.length>0){const a=r.map(o=>`tools[${o}]`).join(", ");throw new Error(`Incompatible tools found at ${a}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var a;let o;const c=[];if(r!=null&&r.generatedImages)for(const p of r.generatedImages)p&&(p!=null&&p.safetyAttributes)&&((a=p==null?void 0:p.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?o=p==null?void 0:p.safetyAttributes:c.push(p);let f;return o?f={generatedImages:c,positivePromptSafetyAttributes:o,sdkHttpResponse:r.sdkHttpResponse}:f={generatedImages:c,sdkHttpResponse:r.sdkHttpResponse},f}),this.list=async n=>{var r;const c={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((r=c.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new Tr(hs.PAGED_ITEM_MODELS,f=>this.listInternal(f),await this.listInternal(c),c)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const a={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async n=>{var r,a,o,c,f,p;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((a=n.video)===null||a===void 0)&&a.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((c=(o=n.source)===null||o===void 0?void 0:o.video)===null||c===void 0)&&c.uri&&(!((p=(f=n.source)===null||f===void 0?void 0:f.video)===null||p===void 0)&&p.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,a;const o=(n=e.config)===null||n===void 0?void 0:n.tools;if(!o)return e;const c=await Promise.all(o.map(async p=>Ei(p)?await p.tool():p)),f={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:c})};if(f.config.tools=c,e.config&&e.config.tools&&rv(e.config.tools)){const p=(a=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let h=Object.assign({},p);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),iv(h),f.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return f}async initAfcToolsMap(e){var n,r,a;const o=new Map;for(const c of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(Ei(c)){const f=c,p=await f.tool();for(const h of(a=p.functionDeclarations)!==null&&a!==void 0?a:[]){if(!h.name)throw new Error("Function declaration name is required.");if(o.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);o.set(h.name,f)}}return o}async processAfcStream(e){var n,r,a;const o=(a=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:Py;let c=!1,f=0;const p=await this.initAfcToolsMap(e);return(function(h,x,v){var w,_;return Si(this,arguments,function*(){for(var E,N,D,k;f<o;){c&&(f++,c=!1);const P=yield lt(h.processParamsMaybeAddMcpUsage(v)),B=yield lt(h.generateContentStreamInternal(P)),H=[],Q=[];try{for(var U=!0,A=(N=void 0,ka(B)),I;I=yield lt(A.next()),E=I.done,!E;U=!0){k=I.value,U=!1;const J=k;if(yield yield lt(J),J.candidates&&(!((w=J.candidates[0])===null||w===void 0)&&w.content)){Q.push(J.candidates[0].content);for(const O of(_=J.candidates[0].content.parts)!==null&&_!==void 0?_:[])if(f<o&&O.functionCall){if(!O.functionCall.name)throw new Error("Function call name was not returned by the model.");if(x.has(O.functionCall.name)){const Z=yield lt(x.get(O.functionCall.name).callTool([O.functionCall]));H.push(...Z)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${x.keys()}, mising tool: ${O.functionCall.name}`)}}}}catch(J){N={error:J}}finally{try{!U&&!E&&(D=A.return)&&(yield lt(D.call(A)))}finally{if(N)throw N.error}}if(H.length>0){c=!0;const J=new Ma;J.candidates=[{content:{role:"user",parts:H}}],yield yield lt(J);const O=[];O.push(...Q),O.push({role:"user",parts:H});const Z=En(v.contents).concat(O);v.contents=Z}else break}})})(this,p,e)}async generateContentInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=Ay(this.apiClient,e);return f=fe("{model}:generateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=Ry(x),w=new Ma;return Object.assign(w,v),w})}else{const h=Cy(this.apiClient,e);return f=fe("{model}:generateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=Iy(x),w=new Ma;return Object.assign(w,v),w})}}async generateContentStreamInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=Ay(this.apiClient,e);return f=fe("{model}:streamGenerateContent?alt=sse",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),c.then(function(v){return Si(this,arguments,function*(){var w,_,E,N;try{for(var D=!0,k=ka(v),U;U=yield lt(k.next()),w=U.done,!w;D=!0){N=U.value,D=!1;const A=N,I=Ry(yield lt(A.json()));I.sdkHttpResponse={headers:A.headers};const P=new Ma;Object.assign(P,I),yield yield lt(P)}}catch(A){_={error:A}}finally{try{!D&&!w&&(E=k.return)&&(yield lt(E.call(k)))}finally{if(_)throw _.error}}})})}else{const h=Cy(this.apiClient,e);return f=fe("{model}:streamGenerateContent?alt=sse",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),c.then(function(v){return Si(this,arguments,function*(){var w,_,E,N;try{for(var D=!0,k=ka(v),U;U=yield lt(k.next()),w=U.done,!w;D=!0){N=U.value,D=!1;const A=N,I=Iy(yield lt(A.json()));I.sdkHttpResponse={headers:A.headers};const P=new Ma;Object.assign(P,I),yield yield lt(P)}}catch(A){_={error:A}}finally{try{!D&&!w&&(E=k.return)&&(yield lt(E.call(k)))}finally{if(_)throw _.error}}})})}}async embedContent(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=OC(this.apiClient,e);return f=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=qC(x),w=new dy;return Object.assign(w,v),w})}else{const h=jC(this.apiClient,e);return f=fe("{model}:batchEmbedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=LC(x),w=new dy;return Object.assign(w,v),w})}}async generateImagesInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=YC(this.apiClient,e);return f=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=QC(x),w=new fy;return Object.assign(w,v),w})}else{const h=JC(this.apiClient,e);return f=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=KC(x),w=new fy;return Object.assign(w,v),w})}}async editImageInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const f=MC(this.apiClient,e);return o=fe("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=PC(p),x=new KE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const f=F1(this.apiClient,e);return o=fe("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=$1(p),x=new QE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const f=C1(this.apiClient,e);return o=fe("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=A1(p),x=new XE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const f=k1(this.apiClient,e);return o=fe("{model}:predict",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=U1(p),x=new WE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=h1(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Kd(x))}else{const h=f1(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Yd(x))}}async listInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=b1(this.apiClient,e);return f=fe("{models_url}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=_1(x),w=new hy;return Object.assign(w,v),w})}else{const h=v1(this.apiClient,e);return f=fe("{models_url}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=w1(x),w=new hy;return Object.assign(w,v),w})}}async update(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=H1(this.apiClient,e);return f=fe("{model}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Kd(x))}else{const h=G1(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Yd(x))}}async delete(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=AC(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=RC(x),w=new py;return Object.assign(w,v),w})}else{const h=CC(this.apiClient,e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=IC(x),w=new py;return Object.assign(w,v),w})}}async countTokens(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=EC(this.apiClient,e);return f=fe("{model}:countTokens",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=NC(x),w=new my;return Object.assign(w,v),w})}else{const h=SC(this.apiClient,e);return f=fe("{model}:countTokens",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=TC(x),w=new my;return Object.assign(w,v),w})}}async computeTokens(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const f=gC(this.apiClient,e);return o=fe("{model}:computeTokens",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=yC(p),x=new ZE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=n1(this.apiClient,e);return f=fe("{model}:predictLongRunning",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>{const v=e1(x),w=new Dl;return Object.assign(w,v),w})}else{const h=t1(this.apiClient,e);return f=fe("{model}:predictLongRunning",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>{const v=ZC(x),w=new Dl;return Object.assign(w,v),w})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class TA extends ms{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=HE(e);return f=fe("{operationName}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c}else{const h=GE(e);return f=fe("{operationName}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c}}async fetchPredictVideosOperationInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const f=UE(e);return o=fe("{resourceName}:fetchPredictOperation",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function NA(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function CA(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>UA(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function AA(t,e,n){const r={},a=m(e,["expireTime"]);n!==void 0&&a!=null&&g(n,["expireTime"],a);const o=m(e,["newSessionExpireTime"]);n!==void 0&&o!=null&&g(n,["newSessionExpireTime"],o);const c=m(e,["uses"]);n!==void 0&&c!=null&&g(n,["uses"],c);const f=m(e,["liveConnectConstraints"]);n!==void 0&&f!=null&&g(n,["bidiGenerateContentSetup"],kA(t,f));const p=m(e,["lockAdditionalFields"]);return n!==void 0&&p!=null&&g(n,["fieldMask"],p),r}function IA(t,e){const n={},r=m(e,["config"]);return r!=null&&g(n,["config"],AA(t,r,n)),n}function RA(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function DA(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function MA(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function PA(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],r);const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const f=m(t,["topK"]);e!==void 0&&f!=null&&g(e,["setup","generationConfig","topK"],f);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],If(v));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],CA(Lt(E)));const N=m(t,["tools"]);if(e!==void 0&&N!=null){let B=Di(N);Array.isArray(B)&&(B=B.map(H=>OA(Ri(H)))),g(e,["setup","tools"],B)}const D=m(t,["sessionResumption"]);e!==void 0&&D!=null&&g(e,["setup","sessionResumption"],jA(D));const k=m(t,["inputAudioTranscription"]);e!==void 0&&k!=null&&g(e,["setup","inputAudioTranscription"],k);const U=m(t,["outputAudioTranscription"]);e!==void 0&&U!=null&&g(e,["setup","outputAudioTranscription"],U);const A=m(t,["realtimeInputConfig"]);e!==void 0&&A!=null&&g(e,["setup","realtimeInputConfig"],A);const I=m(t,["contextWindowCompression"]);e!==void 0&&I!=null&&g(e,["setup","contextWindowCompression"],I);const P=m(t,["proactivity"]);return e!==void 0&&P!=null&&g(e,["setup","proactivity"],P),n}function kA(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Je(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],PA(a,n)),n}function UA(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],RA(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const f=m(t,["inlineData"]);f!=null&&g(e,["inlineData"],NA(f));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function jA(t){const e={},n=m(t,["handle"]);if(n!=null&&g(e,["handle"],n),m(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function OA(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const f=m(t,["googleMaps"]);f!=null&&g(e,["googleMaps"],DA(f));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],MA(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function LA(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(o=>`${n}.${o}`);e.push(...a)}else e.push(n)}return e.join(",")}function qA(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const o=r.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,n=o):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const a=t.fieldMask;if(n){const o=LA(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?t.fieldMask=o:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let f=[];a.length>0&&(f=a.map(h=>c.includes(h)?`generationConfig.${h}`:h));const p=[];o&&p.push(o),f.length>0&&p.push(...f),p.length>0?t.fieldMask=p.join(","):delete t.fieldMask}else delete t.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?t.fieldMask=a.join(","):delete t.fieldMask;return t}class BA extends ms{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const f=IA(this.apiClient,e);o=fe("auth_tokens",f._url),c=f._query,delete f.config,delete f._url,delete f._query;const p=qA(f,e.config);return a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),a.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function VA(t,e){const n={},r=m(t,["displayName"]);return e!==void 0&&r!=null&&g(e,["displayName"],r),n}function GA(t){const e={},n=m(t,["config"]);return n!=null&&VA(n,e),e}function HA(t,e){const n={},r=m(t,["force"]);return e!==void 0&&r!=null&&g(e,["_query","force"],r),n}function zA(t){const e={},n=m(t,["name"]);n!=null&&g(e,["_url","name"],n);const r=m(t,["config"]);return r!=null&&HA(r,e),e}function FA(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","name"],n),e}function $A(t,e){const n={},r=m(t,["customMetadata"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["customMetadata"],o)}const a=m(t,["chunkingConfig"]);return e!==void 0&&a!=null&&g(e,["chunkingConfig"],a),n}function JA(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],KA(c)),e}function YA(t){const e={},n=m(t,["fileSearchStoreName"]);n!=null&&g(e,["_url","file_search_store_name"],n);const r=m(t,["fileName"]);r!=null&&g(e,["fileName"],r);const a=m(t,["config"]);return a!=null&&$A(a,e),e}function KA(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function QA(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function XA(t){const e={},n=m(t,["config"]);return n!=null&&QA(n,e),e}function WA(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["fileSearchStores"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["fileSearchStores"],o)}return e}function ZA(t,e){const n={},r=m(t,["mimeType"]);e!==void 0&&r!=null&&g(e,["mimeType"],r);const a=m(t,["displayName"]);e!==void 0&&a!=null&&g(e,["displayName"],a);const o=m(t,["customMetadata"]);if(e!==void 0&&o!=null){let f=o;Array.isArray(f)&&(f=f.map(p=>p)),g(e,["customMetadata"],f)}const c=m(t,["chunkingConfig"]);return e!==void 0&&c!=null&&g(e,["chunkingConfig"],c),n}function e2(t){const e={},n=m(t,["fileSearchStoreName"]);n!=null&&g(e,["_url","file_search_store_name"],n);const r=m(t,["config"]);return r!=null&&ZA(r,e),e}function t2(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function n2(t,e){const n={},r=m(t,["force"]);return e!==void 0&&r!=null&&g(e,["_query","force"],r),n}function s2(t){const e={},n=m(t,["name"]);n!=null&&g(e,["_url","name"],n);const r=m(t,["config"]);return r!=null&&n2(r,e),e}function r2(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","name"],n),e}function i2(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function a2(t){const e={},n=m(t,["parent"]);n!=null&&g(e,["_url","parent"],n);const r=m(t,["config"]);return r!=null&&i2(r,e),e}function o2(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["documents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class l2 extends ms{constructor(e){super(),this.apiClient=e,this.list=async n=>new Tr(hs.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=r2(e);return o=fe("{name}",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=s2(e);a=fe("{name}",c._url),o=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=a2(e);return o=fe("{parent}/documents",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=o2(p),x=new eT;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class c2 extends ms{constructor(e,n=new l2(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new Tr(hs.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=GA(e);return o=fe("fileSearchStores",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=FA(e);return o=fe("{name}",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=zA(e);a=fe("{name}",c._url),o=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=XA(e);return o=fe("fileSearchStores",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=WA(p),x=new tT;return Object.assign(x,h),x})}}async uploadToFileSearchStoreInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=e2(e);return o=fe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=t2(p),x=new nT;return Object.assign(x,h),x})}}async importFile(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=YA(e);return o=fe("{file_search_store_name}:importFile",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=JA(p),x=new Ef;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function u2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function d2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function f2(t,e,n){const r={};if(m(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=m(t,["tunedModelDisplayName"]);if(e!==void 0&&a!=null&&g(e,["displayName"],a),m(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=m(t,["epochCount"]);e!==void 0&&o!=null&&g(e,["tuningTask","hyperparameters","epochCount"],o);const c=m(t,["learningRateMultiplier"]);if(c!=null&&g(r,["tuningTask","hyperparameters","learningRateMultiplier"],c),m(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(m(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(m(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const f=m(t,["batchSize"]);e!==void 0&&f!=null&&g(e,["tuningTask","hyperparameters","batchSize"],f);const p=m(t,["learningRate"]);if(e!==void 0&&p!=null&&g(e,["tuningTask","hyperparameters","learningRate"],p),m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(m(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function h2(t,e,n){const r={};let a=m(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const _=m(t,["validationDataset"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec"],Oy(_))}else if(a==="PREFERENCE_TUNING"){const _=m(t,["validationDataset"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec"],Oy(_))}const o=m(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&g(e,["tunedModelDisplayName"],o);const c=m(t,["description"]);e!==void 0&&c!=null&&g(e,["description"],c);let f=m(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const _=m(t,["epochCount"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],_)}else if(f==="PREFERENCE_TUNING"){const _=m(t,["epochCount"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],_)}let p=m(n,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const _=m(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],_)}else if(p==="PREFERENCE_TUNING"){const _=m(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],_)}let h=m(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const _=m(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],_)}else if(h==="PREFERENCE_TUNING"){const _=m(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],_)}let x=m(n,["config","method"]);if(x===void 0&&(x="SUPERVISED_FINE_TUNING"),x==="SUPERVISED_FINE_TUNING"){const _=m(t,["adapterSize"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],_)}else if(x==="PREFERENCE_TUNING"){const _=m(t,["adapterSize"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],_)}if(m(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(m(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const v=m(t,["labels"]);e!==void 0&&v!=null&&g(e,["labels"],v);const w=m(t,["beta"]);return e!==void 0&&w!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],w),r}function p2(t,e){const n={},r=m(t,["baseModel"]);r!=null&&g(n,["baseModel"],r);const a=m(t,["preTunedModel"]);a!=null&&g(n,["preTunedModel"],a);const o=m(t,["trainingDataset"]);o!=null&&T2(o);const c=m(t,["config"]);return c!=null&&f2(c,n),n}function m2(t,e){const n={},r=m(t,["baseModel"]);r!=null&&g(n,["baseModel"],r);const a=m(t,["preTunedModel"]);a!=null&&g(n,["preTunedModel"],a);const o=m(t,["trainingDataset"]);o!=null&&N2(o,n,e);const c=m(t,["config"]);return c!=null&&h2(c,n,e),n}function g2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function y2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function x2(t,e,n){const r={},a=m(t,["pageSize"]);e!==void 0&&a!=null&&g(e,["_query","pageSize"],a);const o=m(t,["pageToken"]);e!==void 0&&o!=null&&g(e,["_query","pageToken"],o);const c=m(t,["filter"]);return e!==void 0&&c!=null&&g(e,["_query","filter"],c),r}function v2(t,e,n){const r={},a=m(t,["pageSize"]);e!==void 0&&a!=null&&g(e,["_query","pageSize"],a);const o=m(t,["pageToken"]);e!==void 0&&o!=null&&g(e,["_query","pageToken"],o);const c=m(t,["filter"]);return e!==void 0&&c!=null&&g(e,["_query","filter"],c),r}function b2(t,e){const n={},r=m(t,["config"]);return r!=null&&x2(r,n),n}function w2(t,e){const n={},r=m(t,["config"]);return r!=null&&v2(r,n),n}function _2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["nextPageToken"]);a!=null&&g(n,["nextPageToken"],a);const o=m(t,["tunedModels"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(f=>av(f))),g(n,["tuningJobs"],c)}return n}function S2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["nextPageToken"]);a!=null&&g(n,["nextPageToken"],a);const o=m(t,["tuningJobs"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(f=>Xd(f))),g(n,["tuningJobs"],c)}return n}function E2(t,e){const n={},r=m(t,["name"]);r!=null&&g(n,["model"],r);const a=m(t,["name"]);return a!=null&&g(n,["endpoint"],a),n}function T2(t,e){const n={};if(m(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=m(t,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(n,["examples","examples"],a)}return n}function N2(t,e,n){const r={};let a=m(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const c=m(t,["gcsUri"]);e!==void 0&&c!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(a==="PREFERENCE_TUNING"){const c=m(t,["gcsUri"]);e!==void 0&&c!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}let o=m(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const c=m(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(o==="PREFERENCE_TUNING"){const c=m(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}if(m(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function av(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["state"]);o!=null&&g(n,["state"],Vx(o));const c=m(t,["createTime"]);c!=null&&g(n,["createTime"],c);const f=m(t,["tuningTask","startTime"]);f!=null&&g(n,["startTime"],f);const p=m(t,["tuningTask","completeTime"]);p!=null&&g(n,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(n,["updateTime"],h);const x=m(t,["description"]);x!=null&&g(n,["description"],x);const v=m(t,["baseModel"]);v!=null&&g(n,["baseModel"],v);const w=m(t,["_self"]);return w!=null&&g(n,["tunedModel"],E2(w)),n}function Xd(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["state"]);o!=null&&g(n,["state"],Vx(o));const c=m(t,["createTime"]);c!=null&&g(n,["createTime"],c);const f=m(t,["startTime"]);f!=null&&g(n,["startTime"],f);const p=m(t,["endTime"]);p!=null&&g(n,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(n,["updateTime"],h);const x=m(t,["error"]);x!=null&&g(n,["error"],x);const v=m(t,["description"]);v!=null&&g(n,["description"],v);const w=m(t,["baseModel"]);w!=null&&g(n,["baseModel"],w);const _=m(t,["tunedModel"]);_!=null&&g(n,["tunedModel"],_);const E=m(t,["preTunedModel"]);E!=null&&g(n,["preTunedModel"],E);const N=m(t,["supervisedTuningSpec"]);N!=null&&g(n,["supervisedTuningSpec"],N);const D=m(t,["preferenceOptimizationSpec"]);D!=null&&g(n,["preferenceOptimizationSpec"],D);const k=m(t,["tuningDataStats"]);k!=null&&g(n,["tuningDataStats"],k);const U=m(t,["encryptionSpec"]);U!=null&&g(n,["encryptionSpec"],U);const A=m(t,["partnerModelTuningSpec"]);A!=null&&g(n,["partnerModelTuningSpec"],A);const I=m(t,["customBaseModel"]);I!=null&&g(n,["customBaseModel"],I);const P=m(t,["experiment"]);P!=null&&g(n,["experiment"],P);const B=m(t,["labels"]);B!=null&&g(n,["labels"],B);const H=m(t,["outputUri"]);H!=null&&g(n,["outputUri"],H);const Q=m(t,["pipelineJob"]);Q!=null&&g(n,["pipelineJob"],Q);const J=m(t,["serviceAccount"]);J!=null&&g(n,["serviceAccount"],J);const O=m(t,["tunedModelDisplayName"]);O!=null&&g(n,["tunedModelDisplayName"],O);const Z=m(t,["veoTuningSpec"]);return Z!=null&&g(n,["veoTuningSpec"],Z),n}function C2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["metadata"]);o!=null&&g(n,["metadata"],o);const c=m(t,["done"]);c!=null&&g(n,["done"],c);const f=m(t,["error"]);return f!=null&&g(n,["error"],f),n}function Oy(t,e){const n={},r=m(t,["gcsUri"]);r!=null&&g(n,["validationDatasetUri"],r);const a=m(t,["vertexDatasetResource"]);return a!=null&&g(n,["validationDatasetUri"],a),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class A2 extends ms{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new Tr(hs.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const a={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=n.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},n),{preTunedModel:a});return o.baseModel=void 0,await this.tuneInternal(o)}else{const a=Object.assign({},n);return await this.tuneInternal(a)}else{const a=Object.assign({},n),o=await this.tuneMldevInternal(a);let c="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?c=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(c=o.name.split("/operations/")[0]),{name:c,state:zd.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=y2(e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>Xd(x))}else{const h=g2(e);return f=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>av(x))}}async listInternal(e){var n,r,a,o;let c,f="",p={};if(this.apiClient.isVertexAI()){const h=w2(e);return f=fe("tuningJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=S2(x),w=new gy;return Object.assign(w,v),w})}else{const h=b2(e);return f=fe("tunedModels",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:f,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=_2(x),w=new gy;return Object.assign(w,v),w})}}async cancel(e){var n,r,a,o;let c="",f={};if(this.apiClient.isVertexAI()){const p=d2(e);c=fe("{name}:cancel",p._url),f=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const p=u2(e);c=fe("{name}:cancel",p._url),f=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const f=m2(e,e);return o=fe("tuningJobs",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>Xd(p))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const f=p2(e);return o=fe("tunedModels",f._url),c=f._query,delete f._url,delete f._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>C2(p))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class I2{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const R2=1024*1024*8,D2=3,M2=1e3,P2=2,Pl="x-goog-upload-status";async function k2(t,e,n){var r;const a=await ov(t,e,n),o=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[Pl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function U2(t,e,n){var r;const a=await ov(t,e,n),o=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[Pl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const c=Ux(o),f=new Tf;return Object.assign(f,c),f}async function ov(t,e,n){var r,a;let o=0,c=0,f=new Fd(new Response),p="upload";for(o=t.size;c<o;){const h=Math.min(R2,o-c),x=t.slice(c,c+h);c+h>=o&&(p+=", finalize");let v=0,w=M2;for(;v<D2&&(f=await n.request({path:"",body:x,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(c),"Content-Length":String(h)}}}),!(!((r=f==null?void 0:f.headers)===null||r===void 0)&&r[Pl]));)v++,await O2(w),w=w*P2;if(c+=h,((a=f==null?void 0:f.headers)===null||a===void 0?void 0:a[Pl])!=="active")break;if(o<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return f}async function j2(t){return{size:t.size,type:t.type}}function O2(t){return new Promise(e=>setTimeout(e,t))}class L2{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await k2(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await U2(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await j2(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class q2{create(e,n,r){return new B2(e,n,r)}}class B2{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ly="x-goog-api-key";class V2{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(Ly)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Ly,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const G2="gl-node/";class Qt{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=PE(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const a=new V2(this.apiKey);this.apiClient=new iA({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:G2+"web",uploader:new L2,downloader:new I2}),this.models=new EA(this.apiClient),this.live=new xA(this.apiClient,a,new q2),this.batches=new rN(this.apiClient),this.chats=new jN(this.models,this.apiClient),this.caches=new PN(this.apiClient),this.files=new $N(this.apiClient),this.operations=new TA(this.apiClient),this.authTokens=new BA(this.apiClient),this.tunings=new A2(this.apiClient),this.fileSearchStores=new c2(this.apiClient)}}const lv="text-embedding-004",$s=768,H2=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>{const o=r.result.split(",")[1];e({inlineData:{data:o,mimeType:t.type}})},r.onerror=a=>n(a)}),jn=async t=>{var e,n;if(!t||t.trim()==="")return new Array($s).fill(0);try{const a=await new Qt({apiKey:"AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c"}).models.embedContent({model:lv,contents:[{parts:[{text:t}]}]});if((n=(e=a.embeddings)==null?void 0:e[0])!=null&&n.values)return a.embeddings[0].values;throw new Error("No embedding values returned from embedding service.")}catch(r){return console.error("Error generating embedding:",r),new Array($s).fill(0)}},z2=async t=>{var e,n;try{const r=new Qt({apiKey:"AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c"}),a=await H2(t),o=await r.models.embedContent({model:lv,contents:[{parts:[a]}]});if((n=(e=o.embeddings)==null?void 0:e[0])!=null&&n.values)return o.embeddings[0].values;throw new Error("No embedding values returned from image embedding service.")}catch(r){return console.error("Error generating image embedding:",r),new Array($s).fill(0)}},F2=async(t,e,n=.7,r=.3)=>{const a=await jn(t);if(!e)return a;const o=await z2(e);return a.map((c,f)=>c*n+o[f]*r)},Td=["users","shops","customers","suppliers","products","items","inventory","batches","sales","drivers","visual","marketplace","dan_inventory"],$2="58fc3ff2-2f13-11ef-b75e-0242ac110002",kl={size:$s,distance:"Cosine"},J2=t=>{var n,r,a;let e=t.trim();for(;e.endsWith("/");)e=e.slice(0,-1);if((e.includes(":6333")||e.includes("localhost:6333")||e.includes("127.0.0.1:6333"))&&console.warn("[Qdrant Core] Detected port 6333 in URL - this is the default Qdrant port and may not work in production:",e),e&&!e.startsWith("http://")&&!e.startsWith("https://"))if(typeof window<"u"&&window.location){const o=window.location.origin,c=e.startsWith("/")?e:`/${e}`;e=`${o}${c}`,console.log("[Qdrant Core] Converted relative URL to absolute:",t,"->",e)}else if(console.warn("[Qdrant Core] Relative URL detected but window.location not available. Raw URL:",t),typeof window<"u")try{const o=((n=window.location)==null?void 0:n.origin)||((r=window.location)!=null&&r.protocol&&((a=window.location)!=null&&a.host)?`${window.location.protocol}//${window.location.host}`:"https://localhost"),c=e.startsWith("/")?e:`/${e}`;e=`${o}${c}`,console.log("[Qdrant Core] Fallback URL conversion:",t,"->",e)}catch(o){console.error("[Qdrant Core] Failed to convert relative URL, using localhost fallback:",o),e=`http://localhost:8787${e.startsWith("/")?e:`/${e}`}`}else e=`http://localhost:8787${e.startsWith("/")?e:`/${e}`}`;return e},Y2=()=>"/qdrant";let pl=null,qy=!1;const Nd=()=>{if(pl)return pl;if(qy)return null;qy=!0;const t=Y2(),e=J2(t);if(!e)return console.error("[Qdrant Core] No Qdrant URL provided"),null;if(!e.startsWith("http://")&&!e.startsWith("https://"))return console.error("[Qdrant Core] Invalid Qdrant URL - must start with http:// or https://:",e),null;try{const n=new URL(e);console.log("[Qdrant Core] Initializing Qdrant client with URL:",e),console.log("[Qdrant Core] URL breakdown - protocol:",n.protocol,"host:",n.host,"pathname:",n.pathname);let r=e;if(!r.endsWith("/qdrant")&&!r.endsWith("/qdrant/")){const a=new URL(e);a.pathname==="/"||a.pathname===""?a.pathname="/qdrant":a.pathname.endsWith("/qdrant")||(a.pathname=a.pathname.replace(/\/$/,"")+"/qdrant"),r=a.toString(),console.log("[Qdrant Core] Adjusted URL to ensure /qdrant path:",r)}return pl=new IE({url:r}),console.log("[Qdrant Core] QdrantClient created successfully with URL:",r),console.log("[Qdrant Core] Client will make requests to:",r+"/collections"),pl}catch(n){return console.error("[Qdrant Core] Failed to create Qdrant client - invalid URL:",e,n),null}},pe=new Proxy({},{get(t,e){const n=Nd();if(!n)return;const r=n[e];return typeof r=="function"?r.bind(n):r},has(t,e){const n=Nd();return n?e in n:!1},ownKeys(t){const e=Nd();return e?Object.keys(e):[]}});let ue=null,Pi=null,$a=null;const By=t=>{const e=ue;ue=(t==null?void 0:t.id)||null,Pi=(t==null?void 0:t.name)||null,t!=null&&t.contactEmail,t!=null&&t.location,$a=(t==null?void 0:t.qdrantNamespace)||null,e!==ue&&console.log(`[Core] setActiveShopContext: ${e||"null"} -> ${ue||"null"}`)},K2={users:{userId:{type:"keyword"},displayName:{type:"keyword"},contactEmail:{type:"keyword"},email:{type:"keyword"},shopId:{type:"keyword"},isVerified:{type:"bool"},isDriverVerified:{type:"bool"}},shops:{shopId:{type:"keyword"},userId:{type:"keyword"},name:{type:"keyword"}},suppliers:{supplierId:{type:"keyword"},shopId:{type:"keyword"},linkedUserId:{type:"keyword"},name:{type:"keyword"}},products:{productId:{type:"keyword"},category:{type:"keyword"},manufacturer:{type:"keyword"},defaultSupplierId:{type:"keyword"}},items:{inventoryUuid:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"},batchId:{type:"keyword"},supplierId:{type:"keyword"},status:{type:"keyword"},quantity:{type:"integer"},expiration:{type:"keyword"}},batches:{batchId:{type:"keyword"},shopId:{type:"keyword"},supplierId:{type:"keyword"},deliveryDate:{type:"keyword"},inventoryDate:{type:"keyword"}},sales:{saleId:{type:"keyword"},shopId:{type:"keyword"},timestamp:{type:"keyword"}},customers:{customerId:{type:"keyword"},userId:{type:"keyword"},name:{type:"keyword"}},drivers:{driverId:{type:"keyword"},userId:{type:"keyword"},status:{type:"keyword"}},visual:{shopId:{type:"keyword"},productId:{type:"keyword"},fieldName:{type:"keyword"}},marketplace:{listingId:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"}},dan_inventory:{inventoryUuid:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"},productName:{type:"keyword"},locationBucket:{type:"keyword"},shareScope:{type:"keyword"},expirationDate:{type:"keyword"}}},Rn=new Map,Ti=t=>t?typeof t=="string"?t:t.message||t.statusText||JSON.stringify(t):"Unknown error",Bt=(t,e)=>{new Date().toISOString();const n=`[Qdrant] ${e}`;t==="error"?console.error(n):t==="warn"?console.warn(n):console.info(n)},Q2=t=>{if(!t)return{params:null,named:!1,vectorName:null};if(typeof t.size=="number")return{params:t,named:!1,vectorName:null};const e=Object.keys(t||{});if("default"in t&&t.default&&typeof t.default.size=="number"){const n=e.some(r=>r!=="default");return{params:t.default,named:n,vectorName:n?"default":null}}if(e.length>=1){const n=e.find(r=>t[r]&&typeof t[r].size=="number");if(n)return{params:t[n],named:n!=="default",vectorName:n}}return{params:null,named:!0,vectorName:null}},X2=async t=>{if(!pe)return!1;const e=K2[t];if(!e)return!0;try{const n=await pe.getCollection(t),r=(n==null?void 0:n.payload_schema)||{};for(const[a,o]of Object.entries(e)){const c=r==null?void 0:r[a],f=c==null?void 0:c.data_type;if(f!==o.type){if(c&&f!==o.type)try{await pe.deletePayloadIndex(t,a),Bt("info",`Deleted existing index '${t}.${a}' (wrong type)`)}catch(p){Bt("warn",`Failed to delete index '${t}.${a}': ${Ti(p)}`)}try{await pe.createPayloadIndex(t,{field_name:a,field_schema:o}),Bt("info",`Created index '${t}.${a}' (${o.type})`)}catch(p){Bt("error",`Failed to create index '${t}.${a}': ${Ti(p)}`)}}}return!0}catch(n){return Bt("error",`Failed to ensure indexes for '${t}': ${Ti(n)}`),!1}},W2=async t=>{var e,n;if(!pe)return{exists:!1,valid:!1,vectorConfig:null};try{const r=await pe.getCollection(t),{params:a,named:o,vectorName:c}=Q2((n=(e=r==null?void 0:r.config)==null?void 0:e.params)==null?void 0:n.vectors),f=(a==null?void 0:a.size)===kl.size&&(a==null?void 0:a.distance)===kl.distance;return{exists:!0,valid:f,vectorConfig:f?{named:o,vectorName:o?c||"default":null}:null}}catch(r){return r.status===404?{exists:!1,valid:!1,vectorConfig:null}:(Bt("error",`Error verifying collection '${t}': ${Ti(r)}`),{exists:!1,valid:!1,vectorConfig:null})}},cv=async t=>{if(!pe)return!1;const e=Rn.get(t);if(e!=null&&e.ready)return!0;if(e!=null&&e.promise)return e.promise;e||Rn.set(t,{ready:!1,promise:null,vectorConfig:null});const n=(async()=>{try{const{exists:r,valid:a,vectorConfig:o}=await W2(t);return r?a?(Rn.set(t,{ready:!1,promise:null,vectorConfig:o}),await X2(t)?(Rn.set(t,{ready:!0,promise:null,vectorConfig:o}),Bt("info",`Collection '${t}' is ready`),!0):(Rn.set(t,{ready:!1,promise:null,vectorConfig:o}),!1)):(Bt("error",`Collection '${t}' has invalid configuration. Expected: size=${kl.size}, distance=${kl.distance}`),Rn.set(t,{ready:!1,promise:null,vectorConfig:null}),!1):(Bt("error",`Collection '${t}' does not exist. Please run setup script first.`),Rn.set(t,{ready:!1,promise:null,vectorConfig:null}),!1)}catch(r){return Bt("error",`Failed to ensure collection '${t}': ${Ti(r)}`),Rn.set(t,{ready:!1,promise:null,vectorConfig:null}),!1}finally{const r=Rn.get(t);r&&(r.promise=null)}})();return Rn.set(t,{ready:!1,promise:n,vectorConfig:null}),n},uv=async()=>{if(!pe){Bt("warn","Qdrant client not available");return}Bt("info","Ensuring all base collections are ready...");const t=await Promise.allSettled(Td.map(r=>cv(r))),e=[],n=[];t.forEach((r,a)=>{const o=Td[a];if(r.status==="fulfilled"&&r.value)e.push(o);else{n.push(o);const c=r.status==="rejected"?Ti(r.reason):"Not ready";Bt("warn",`Collection '${o}' failed: ${c}`)}}),Bt("info",`Collections ready: ${e.length}/${Td.length}. Ready: ${e.join(", ")}${n.length>0?` | Failed: ${n.join(", ")}`:""}`)},dv=t=>{var e;return((e=Rn.get(t))==null?void 0:e.vectorConfig)||null},tt=async t=>{const e=await cv(t);return e||Bt("warn",`Collection '${t}' is not ready  operation will be skipped`),e},Z2=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function eI(t){return typeof t=="string"&&Z2.test(t)}function Vy(t){if(!eI(t))throw TypeError("Invalid UUID");let e;return Uint8Array.of((e=parseInt(t.slice(0,8),16))>>>24,e>>>16&255,e>>>8&255,e&255,(e=parseInt(t.slice(9,13),16))>>>8,e&255,(e=parseInt(t.slice(14,18),16))>>>8,e&255,(e=parseInt(t.slice(19,23),16))>>>8,e&255,(e=parseInt(t.slice(24,36),16))/1099511627776&255,e/4294967296&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255)}const kt=[];for(let t=0;t<256;++t)kt.push((t+256).toString(16).slice(1));function fv(t,e=0){return(kt[t[e+0]]+kt[t[e+1]]+kt[t[e+2]]+kt[t[e+3]]+"-"+kt[t[e+4]]+kt[t[e+5]]+"-"+kt[t[e+6]]+kt[t[e+7]]+"-"+kt[t[e+8]]+kt[t[e+9]]+"-"+kt[t[e+10]]+kt[t[e+11]]+kt[t[e+12]]+kt[t[e+13]]+kt[t[e+14]]+kt[t[e+15]]).toLowerCase()}let Cd;const tI=new Uint8Array(16);function nI(){if(!Cd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Cd=crypto.getRandomValues.bind(crypto)}return Cd(tI)}function sI(t){t=unescape(encodeURIComponent(t));const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e}const rI="6ba7b810-9dad-11d1-80b4-00c04fd430c8",iI="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function aI(t,e,n,r,a,o){const c=typeof n=="string"?sI(n):n,f=typeof r=="string"?Vy(r):r;if(typeof r=="string"&&(r=Vy(r)),(r==null?void 0:r.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let p=new Uint8Array(16+c.length);if(p.set(f),p.set(c,f.length),p=e(p),p[6]=p[6]&15|t,p[8]=p[8]&63|128,a){o=o||0;for(let h=0;h<16;++h)a[o+h]=p[h];return a}return fv(p)}const oI=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Gy={randomUUID:oI};function lI(t,e,n){var a;t=t||{};const r=t.random??((a=t.rng)==null?void 0:a.call(t))??nI();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,fv(r)}function ht(t,e,n){return Gy.randomUUID&&!t?Gy.randomUUID():lI(t)}function cI(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}}function Ad(t,e){return t<<e|t>>>32-e}function uI(t){const e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520],r=new Uint8Array(t.length+1);r.set(t),r[t.length]=128,t=r;const a=t.length/4+2,o=Math.ceil(a/16),c=new Array(o);for(let f=0;f<o;++f){const p=new Uint32Array(16);for(let h=0;h<16;++h)p[h]=t[f*64+h*4]<<24|t[f*64+h*4+1]<<16|t[f*64+h*4+2]<<8|t[f*64+h*4+3];c[f]=p}c[o-1][14]=(t.length-1)*8/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=(t.length-1)*8&4294967295;for(let f=0;f<o;++f){const p=new Uint32Array(80);for(let E=0;E<16;++E)p[E]=c[f][E];for(let E=16;E<80;++E)p[E]=Ad(p[E-3]^p[E-8]^p[E-14]^p[E-16],1);let h=n[0],x=n[1],v=n[2],w=n[3],_=n[4];for(let E=0;E<80;++E){const N=Math.floor(E/20),D=Ad(h,5)+cI(N,x,v,w)+_+e[N]+p[E]>>>0;_=w,w=v,v=Ad(x,30)>>>0,x=h,h=D}n[0]=n[0]+h>>>0,n[1]=n[1]+x>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+w>>>0,n[4]=n[4]+_>>>0}return Uint8Array.of(n[0]>>24,n[0]>>16,n[0]>>8,n[0],n[1]>>24,n[1]>>16,n[1]>>8,n[1],n[2]>>24,n[2]>>16,n[2]>>8,n[2],n[3]>>24,n[3]>>16,n[3]>>8,n[3],n[4]>>24,n[4]>>16,n[4]>>8,n[4])}function Df(t,e,n,r){return aI(80,uI,t,e,n,r)}Df.DNS=rI;Df.URL=iI;const Vt=(t,e)=>Df(`${t}:${e}`,$2),zn=t=>{const e=String(t||"default"),n=new Array($s).fill(0);for(let r=0;r<$s;r++)n[r]=(e.charCodeAt(r%e.length)||0)%100/1e3;return n},Gt=(t,e,n)=>{const r=()=>zn(e);if(!Array.isArray(t))return r();if(t.length!==$s)return console.warn(`[Qdrant] ${n}: Vector length ${t.length} != ${$s}. Using placeholder.`),r();for(let a=0;a<t.length;a++){const o=t[a];if(typeof o!="number"||!Number.isFinite(o))return console.warn(`[Qdrant] ${n}: Invalid vector value at index ${a}: ${o}. Using placeholder.`),r()}return t},dn=(t,e)=>{const n=dv(t);return n!=null&&n.named?{vectors:{[n.vectorName||"default"]:e}}:{vector:e}},dI=(t,e)=>{const n=dv(t);return n!=null&&n.named?{name:n.vectorName||"default",vector:e}:e},hv=(t,e)=>!e||t==="items"?null:{key:"shopId",match:{value:e}},gt=async(t,e)=>{if(!pe)return[];if(!await tt(t))return[];const n=[];let r,a=3,o=null;if(e&&(typeof e=="string"?o=e:typeof e=="object"&&e!==null&&"id"in e?(o=e.id||null,console.warn(`[Qdrant] fetchAllPoints received shopFilter as object instead of string. Extracted id: ${o}`)):console.warn(`[Qdrant] fetchAllPoints received invalid shopFilter type: ${typeof e}`)),o&&t==="items"){const p=[];let h;do try{const v=await pe.scroll(t,{with_payload:!0,limit:100,offset:h??void 0});p.push(...(v==null?void 0:v.points)??[]),h=(v==null?void 0:v.next_page_offset)??void 0}catch(v){console.error("[Qdrant] Error fetching items for JavaScript filter:",v);break}while(h);return p.filter(v=>{var _;const w=(_=v.payload)==null?void 0:_.shopId;return typeof w=="string"?w===o:w&&typeof w=="object"&&"id"in w?w.id===o:!1})}const c=hv(t,o),f=c?{must:[c]}:void 0;do{try{const p=await pe.scroll(t,{with_payload:!0,limit:100,offset:r??void 0,filter:f}),h=(p==null?void 0:p.points)??[];n.push(...h),r=(p==null?void 0:p.next_page_offset)??void 0}catch(p){if(console.error(`[Qdrant] Scroll error in '${t}' (Retry ${a}, Filter: ${JSON.stringify(f)}):`,p),(p==null?void 0:p.status)===400&&a>0){console.info(`[Qdrant] Retrying scroll in '${t}'...`),a--,await new Promise(h=>setTimeout(h,1e3));continue}r=void 0}if(!r||n.length>1e5)break}while(r);return n},fI=async(t,e,n,r=10)=>{if(!pe)return[];if(!await tt(t))return[];const a=[];if(n.shopId){const o=typeof n.shopId=="string"?n.shopId:n.shopId&&typeof n.shopId=="object"&&n.shopId!==null&&"id"in n.shopId?n.shopId.id:null;if(o){const c=hv(t,o);c&&a.push(c)}}n.status&&a.push({key:"status",match:{value:n.status}}),n.quantityMin!==void 0&&a.push({key:"quantity",range:{gt:n.quantityMin}}),Object.entries(n).forEach(([o,c])=>{!["shopId","status","quantityMin"].includes(o)&&c!==void 0&&a.push({key:o,match:{value:c}})});try{const o=await pe.search(t,{vector:e,limit:r,with_payload:!0,filter:a.length>0?{must:a}:void 0});return Array.isArray(o)?o:(o==null?void 0:o.points)??[]}catch(o){return console.error(`[Qdrant] Search failed in '${t}':`,o),[]}},pv=t=>{const e=t.payload;return{id:(e==null?void 0:e.productId)||String(t.id),name:(e==null?void 0:e.name)||"Unnamed Product",manufacturer:(e==null?void 0:e.manufacturer)||"",category:(e==null?void 0:e.category)||"",description:(e==null?void 0:e.description)||"",defaultSupplierId:(e==null?void 0:e.defaultSupplierId)||null,images:(e==null?void 0:e.images)||[],audit:(e==null?void 0:e.audit)||[],embeddings:(e==null?void 0:e.embeddings)||void 0}},Ja=async()=>pe?(await gt("products",null)).map(pv):[],Mf=async(t,e)=>{if(!pe||!await tt("products"))return;const n=Array.isArray(t.embeddings)&&t.embeddings.length>0,r=Gt(n?t.embeddings:null,t.id,`products:${t.id}`),a=n&&r===t.embeddings?r:void 0,o=Vt("products",t.id),c={productId:t.id,name:t.name,manufacturer:t.manufacturer,category:t.category,description:t.description||"",defaultSupplierId:t.defaultSupplierId||null,images:t.images||[],audit:e?[...t.audit||[],e]:t.audit||[],embeddings:a};await pe.upsert("products",{wait:!0,points:[{id:o,...dn("products",r),payload:c}]})},ki=async t=>{var r;const e={id:ht(),name:t.name.trim(),manufacturer:t.manufacturer.trim(),category:t.category.trim(),description:((r=t.description)==null?void 0:r.trim())||"",defaultSupplierId:t.defaultSupplierId||null,images:t.images||[],audit:[],embeddings:t.embeddings||(t.name?await jn(t.name):zn(ht()))},n=ue?{userId:ue,shopId:ue,action:"create",timestamp:new Date().toISOString()}:void 0;return await Mf(e,n),e},mv=async(t,e)=>{var f,p,h;const r=(await Ja()).find(x=>x.id===t);if(!r)throw new Error(`Product with ID ${t} not found`);const a=e.embeddings||(e.name&&e.name!==r.name?await jn(e.name):r.embeddings),o={...r,name:((f=e.name)==null?void 0:f.trim())||r.name,manufacturer:((p=e.manufacturer)==null?void 0:p.trim())||r.manufacturer,category:((h=e.category)==null?void 0:h.trim())||r.category,description:e.description!==void 0?e.description.trim():r.description,defaultSupplierId:e.defaultSupplierId!==void 0?e.defaultSupplierId:r.defaultSupplierId,images:e.images!==void 0?e.images:r.images,embeddings:a},c=ue?{userId:ue,shopId:ue,action:"update",timestamp:new Date().toISOString()}:void 0;return await Mf(o,c),o},gv=async t=>{pe&&await tt("products")&&await pe.delete("products",{wait:!0,points:[Vt("products",t)]})},yv=async(t,e=24)=>{if(!pe)return[];const n=t.trim();if(!n)return(await Ja()).slice(0,e);if(!await tt("products"))return[];const r=await jn(n),a=Gt(r,`products:search:${n}`,`products-search:${Date.now()}`);return(await pe.search("products",{vector:a,limit:e,with_payload:!0})).map(pv).filter(c=>!!c.name)},xv=async t=>pe?(await gt("batches",t)).map(n=>{const r=n.payload;return{id:(r==null?void 0:r.batchId)||String(n.id),shopId:r==null?void 0:r.shopId,supplierId:r==null?void 0:r.supplierId,deliveryDate:r==null?void 0:r.deliveryDate,inventoryDate:r==null?void 0:r.inventoryDate,invoiceNumber:r==null?void 0:r.invoiceNumber,documents:(r==null?void 0:r.documents)||[],lineItems:(r==null?void 0:r.lineItems)||[],createdAt:r==null?void 0:r.createdAt,createdByUserId:r==null?void 0:r.createdByUserId}}):[],vv=async()=>ue?xv(ue):[],Pf=async t=>{if(!pe||!await tt("batches"))return;const e=Gt(zn(t.id),t.id,`batches:${t.id}`),n=Vt("batches",t.id),r={batchId:t.id,shopId:t.shopId,supplierId:t.supplierId||null,deliveryDate:t.deliveryDate,inventoryDate:t.inventoryDate||null,invoiceNumber:t.invoiceNumber||null,documents:t.documents||[],lineItems:t.lineItems||[],createdAt:t.createdAt,createdByUserId:t.createdByUserId};await pe.upsert("batches",{wait:!0,points:[{id:n,...dn("batches",e),payload:r}]})},Nr=async t=>{if(!pe||!await tt("users"))return;const e=t.qdrantUserId||t.userId,n=Vt("users",e);let r={};try{const c=await pe.retrieve("users",{ids:[n],with_payload:!0});if(c.points&&c.points.length>0){const f=c.points[0].payload;r={isVerified:f.isVerified,isDriverVerified:f.isDriverVerified}}}catch{}const a={userId:t.userId,displayName:t.displayName||t.email||t.userId,contactEmail:t.contactEmail||t.email||"",email:t.email||t.contactEmail||"",shopId:t.shopId||ue||null,isVerified:t.isVerified!==void 0?t.isVerified:r.isVerified,isDriverVerified:t.isDriverVerified!==void 0?t.isDriverVerified:r.isDriverVerified},o=Gt(zn(e),e,`users:${e}`);await pe.upsert("users",{wait:!0,points:[{id:n,payload:a,...dn("users",o)}]})},bv=async()=>{},wv=async t=>{if(!pe||!await tt("shops"))return;const e=Gt(zn(t.id),t.id,`shops:${t.id}`),n=Vt("shops",t.id),r={shopId:t.id,userId:t.userId||"",name:t.name,contact:t.contactEmail||"",contactEmail:t.contactEmail||"",qdrantNamespace:t.qdrantNamespace||null,metadata:t.location?{location:t.location}:{}};await pe.upsert("shops",{wait:!0,points:[{id:n,...dn("shops",e),payload:r}]})},_v=async t=>{if(!pe||!await tt("customers"))return;const e=Gt(zn(t.id),t.id,`customers:${t.id}`),n=Vt("customers",t.id);await pe.upsert("customers",{wait:!0,points:[{id:n,...dn("customers",e),payload:{customerId:t.id,userId:t.userId||null,name:t.fullName,contact:t.contactEmail||""}}]})},Kl=async t=>{if(!pe||!await tt("drivers"))return;const e=Gt(zn(t.id),t.id,`drivers:${t.id}`),n=Vt("drivers",t.id);await pe.upsert("drivers",{wait:!0,points:[{id:n,...dn("drivers",e),payload:{driverId:t.id,userId:t.userId||null,name:t.fullName,contact:t.contactEmail||"",status:t.status||"pending"}}]})},kf=async t=>{if(!pe||!await tt("suppliers"))return;const e=t.name?await jn(t.name):null,n=Gt(e,t.id,`suppliers:${t.id}`),r=Vt("suppliers",t.id),a={supplierId:t.id,name:t.name,contact:t.contactEmail||"",contactEmail:t.contactEmail||"",shopId:t.shopId||null,linkedUserId:t.linkedUserId||t.userId||null,metadata:t.metadata||{},embeddings:n};await pe.upsert("suppliers",{wait:!0,points:[{id:r,...dn("suppliers",n),payload:a}]})},Ys=async()=>!pe||!ue?[]:(await gt("suppliers",null)).map(e=>{const n=e.payload;return{id:(n==null?void 0:n.supplierId)||String(e.id),shopId:(n==null?void 0:n.shopId)||null,linkedUserId:(n==null?void 0:n.linkedUserId)||(n==null?void 0:n.userId)||null,name:(n==null?void 0:n.name)||"Supplier",contact:(n==null?void 0:n.contact)||"",contactEmail:(n==null?void 0:n.contact)||(n==null?void 0:n.contactEmail)||"",metadata:(n==null?void 0:n.metadata)||{}}}).filter(e=>e.shopId===ue||e.linkedUserId!==null),Ui=async t=>{if(!ue)throw new Error("No shop selected.");const e=ht();return await kf({id:e,name:t.name,contactEmail:t.contactEmail,shopId:ue,linkedUserId:null}),{id:e,shopId:ue,linkedUserId:null,name:t.name,contact:t.contactEmail,contactEmail:t.contactEmail,metadata:{}}},Sv=async()=>pe?await tt("shops")?(await gt("shops",null)).map(e=>{const n=e.payload;return{id:n.shopId,name:n.name,contactEmail:n.contactEmail||n.contact}}):[]:[],Ev=async t=>{if(!pe||!await tt("shops"))return null;try{const e=Vt("shops",t),n=await pe.retrieve("shops",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;return{id:r.shopId,name:r.name,contactEmail:r.contactEmail||r.contact}}return null}catch(e){return console.error("[Users] Error validating shop:",e),null}},Id=new Map,Tv=async t=>{if(Id.has(t))return Id.get(t).name;const n=(await gt("products",null)).find(r=>{var a;return((a=r.payload)==null?void 0:a.productId)===t});if(n){const r=n.payload;return Id.set(t,{name:r.name||"unknown product",manufacturer:r.manufacturer||"",category:r.category||""}),r.name||"unknown product"}return"unknown product"},Cr=async(t,e)=>{if(!pe||!ue||!await tt("items"))return;const n=t.inventoryUuid||t.qdrantId||ht();t.inventoryUuid||(t.inventoryUuid=n),t.qdrantId||(t.qdrantId=n);const r=new Date().toISOString(),a=t.status||(t.quantity>0?"ACTIVE":"EMPTY"),o=await Tv(t.productId),c=await jn(o),f=Gt(c,n,`items:${n}`),p=e||t.scanMetadata||null,h=t.buyPrice??t.costPerUnit??null,x=t.sellPrice??(h?h*1.4:null),v=t.shareScope||["local"],w={inventoryUuid:n,shopId:ue,productId:t.productId,batchId:t.batchId||"",supplierId:t.supplierId||void 0,buyPrice:h??void 0,sellPrice:x??void 0,quantity:t.quantity||0,expiration:t.expirationDate||r,location:t.location||void 0,status:a,images:t.images||[],scanMetadata:p,createdByUserId:ue,createdAt:t.createdAt||r,updatedAt:t.updatedAt||r,embeddings:f,shareScope:v,shareProofHash:t.shareProofHash};await pe.upsert("items",{wait:!0,points:[{id:n,...dn("items",f),payload:w}]})},Uf=async t=>{if(!pe)return;const e=t.inventoryUuid||t.qdrantId;if(e){await pe.delete("items",{wait:!0,points:[e]});return}ue&&await pe.delete("items",{wait:!0,filter:{must:[{key:"shopId",match:{value:ue}},{key:"productId",match:{value:t.productId}}]}})},Nv=async(t,e,n)=>{if(!pe||!ue||!await tt("items"))return;const r=new Date().toISOString(),a=new Date(t.deliveryDate),o=new Date(a.setFullYear(a.getFullYear()+1)).toISOString().split("T")[0],c=await Promise.all(e.filter(f=>f.productId&&f.quantity>0).map(async f=>{const p=ht(),h=f.cost||0,x=h*1.4,v=await Tv(f.productId),w=await jn(v),_=Gt(w,p,`items:${p}`),E=n==null?void 0:n.get(f.productId),N={inventoryUuid:p,shopId:ue,productId:f.productId,batchId:t.id,supplierId:t.supplierId||void 0,buyPrice:h,sellPrice:x,quantity:f.quantity,expiration:o,location:void 0,status:"ACTIVE",images:(E==null?void 0:E.images)||[],scanMetadata:(E==null?void 0:E.scanMetadata)||null,createdByUserId:ue,createdAt:r,updatedAt:r,embeddings:_,shareScope:["local"]};return{id:p,...dn("items",_),payload:N}}));c.length>0&&(await pe.upsert("items",{wait:!0,points:c}),console.log(`[Inventory] Added ${c.length} inventory items from batch ${t.id}`))},jf=async(t,e,n=10)=>{if(!pe||!e)return[];if(!await tt("items"))return[];const r=Gt(t,`${e}-query`,`search:${e}`),a=dI("items",r);return(await fI("items",a,{shopId:e,quantityMin:0,status:"ACTIVE"},n)).map(c=>{const f=c.payload,p=f==null?void 0:f.shopId,h=typeof p=="string"?p:p&&typeof p=="object"&&p!==null&&"id"in p?p.id:e;return{id:Date.now()+Math.random(),inventoryUuid:f.inventoryUuid||String(c.id),shopId:h,productId:f.productId,batchId:f.batchId,expirationDate:f.expiration,quantity:f.quantity,costPerUnit:f.buyPrice||0,location:f.location||void 0,supplierId:f.supplierId||void 0,buyPrice:f.buyPrice,sellPrice:f.sellPrice,images:f.images||[],scanMetadata:f.scanMetadata,qdrantId:f.inventoryUuid||String(c.id),status:f.status,createdByUserId:f.createdByUserId,createdAt:f.createdAt,updatedAt:f.updatedAt,shareScope:f.shareScope||["local"],shareProofHash:f.shareProofHash}})},Cv=async t=>(await gt("items",t)).map(n=>{const r=n.payload,a=r==null?void 0:r.shopId,o=typeof a=="string"?a:a&&typeof a=="object"&&a!==null&&"id"in a?a.id:t;return{id:Date.now()+Math.random(),inventoryUuid:r.inventoryUuid||String(n.id),shopId:o,productId:r.productId,batchId:r.batchId,expirationDate:r.expiration,quantity:r.quantity,costPerUnit:r.buyPrice||0,location:r.location||void 0,supplierId:r.supplierId||void 0,buyPrice:r.buyPrice,sellPrice:r.sellPrice,images:r.images||[],scanMetadata:r.scanMetadata,qdrantId:r.inventoryUuid||String(n.id),status:r.status,createdByUserId:r.createdByUserId,createdAt:r.createdAt,updatedAt:r.updatedAt,shareScope:r.shareScope||["local"],shareProofHash:r.shareProofHash}}).filter(n=>n.quantity>0&&n.status!=="EMPTY"&&n.status!=="EXPIRED"),Of=async t=>{if(!pe||!ue||!await tt("sales"))return;const e=Gt(zn(t.id),t.id,`sales:${t.id}`),n=Vt("sales",t.id),r=dn("sales",e);await pe.upsert("sales",{wait:!0,points:[{id:n,...r,payload:{saleId:t.id,shopId:ue,timestamp:t.timestamp,lineItems:t.items,totalAmount:t.totalAmount}}]})},hI=async(t,e)=>{if(!ue)throw new Error("No shop selected.");const n=[];let r=0;const a=1.4,o=[],c=[],f=await Cv(ue);for(const h of t){let x=h.quantity;const v=e.get(h.productName);if(!v)continue;const w=f.filter(_=>_.productId===v.id&&_.quantity>0).sort((_,E)=>new Date(_.expirationDate).getTime()-new Date(E.expirationDate).getTime());for(const _ of w){if(x<=0)break;const E=Math.min(_.quantity,x);_.quantity-=E,x-=E;const N=_.costPerUnit*a;n.push({productId:v.id,quantity:E,priceAtSale:N}),r+=E*N,_.quantity===0?c.push(_):o.push(_)}}const p={id:Date.now(),timestamp:new Date().toISOString(),items:n,totalAmount:r};for(const h of o)await Cr(h);return await Promise.all(c.map(Uf)),await Of(p),console.log(`[Sales] Recorded sale ${p.id} with total $${r.toFixed(2)}.`),p},Av=async t=>(await gt("sales",t)).map(n=>{const r=n.payload;return{id:r.saleId,timestamp:r.timestamp,items:r.lineItems||[],totalAmount:r.totalAmount||0}}),Wd=new Map,pI=async t=>{if(!pe||!ue||!await tt("marketplace"))return;const e=Gt(zn(t.id),t.id,`marketplace:${t.id}`),n=Vt("marketplace",t.id);await pe.upsert("marketplace",{wait:!0,points:[{id:n,...dn("marketplace",e),payload:{shopId:ue,listingId:t.id,productId:t.productId,productName:t.productName,quantity:t.quantity,price:t.price}}]})},Iv=async t=>{if(!ue)throw new Error("No shop selected.");const e={...t,id:Date.now()};Wd.set(e.id,e),await pI(e),console.info(`[Marketplace] Listed ${e.quantity} of ${e.productName}.`)},Rv=async()=>Wd.size>0?Array.from(Wd.values()):ue?(await gt("marketplace",ue)).map(e=>{const n=e.payload;return{id:n.listingId||Date.now(),productId:n.productId,productName:n.productName,quantity:n.quantity,price:n.price}}):[],mI=async(t,e,n,r)=>{if(!ue)throw new Error("No shop selected.");const a=new Date().toISOString().split("T")[0],o={supplier:t.seller.name,deliveryDate:a,inventoryDate:a},c={productName:t.productName,manufacturer:t.manufacturer,category:t.category,expirationDate:"2025-12-31",quantity:e,quantityType:t.quantityType,costPerUnit:t.price,location:"Marketplace Intake"};await n(o,[c]);const f={id:Date.now(),timestamp:new Date().toISOString(),items:[{productId:t.productName.toLowerCase().trim().replace(/\s+/g,"-"),quantity:e,priceAtSale:t.price}],totalAmount:t.price*e,source:{type:"marketplace",supplierName:t.seller.name,listingId:t.listingId}};await r(f),console.info(`[Marketplace] Purchased ${e} of ${t.productName} from ${t.seller.name}.`)},gI=new Map,Dv=t=>t.toLowerCase().trim().replace(/\s+/g,"-"),yI=t=>`${ue||"global"}:${t}`,xI=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(r.result.split(",")[1]),r.onerror=a=>n(a)}),vI=(t,e)=>t&&t.trim().length>0?t.trim():e?Dv(e):"unlabeled-product",Lf=async(t,e,n,r)=>{const a=vI(r==null?void 0:r.productId,t),o=yI(a),c=await xI(n),f=`${o}-${e}`;if(gI.set(f,{imageBase64:c,mimeType:n.type}),!pe||!ue||!await tt("visual"))return f;const p=Gt(zn(f),f,`visual:${f}`);try{await pe.upsert("visual",{wait:!0,points:[{id:Vt("visual",f),...dn("visual",p),payload:{shopId:ue,productId:o,fieldName:e,imageBase64:c,mimeType:n.type,source:(r==null?void 0:r.source)||"manual",batchId:(r==null?void 0:r.batchId)||null,metadata:(r==null?void 0:r.metadata)||null,capturedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}]})}catch(h){console.error("[Qdrant] Failed to upsert visual feature:",h)}return f},Hy=t=>{const e=ue||"global";return t.startsWith(`${e}:`)?t:`${e}:${t}`},Mv=async t=>{const e=new Map;if(!ue||!pe)return e;const n=new Set;t.includes(":")?n.add(t):(n.add(Hy(t)),n.add(Hy(Dv(t))));const r=async a=>{let o;do{const c=await pe.scroll("visual",{filter:{must:[{key:"shopId",match:{value:ue}},{key:"productId",match:{value:a}}]},with_payload:!0,limit:50,offset:o??void 0});((c==null?void 0:c.points)??[]).forEach(p=>{const h=p.payload;h!=null&&h.fieldName&&(h!=null&&h.imageBase64)&&(h!=null&&h.mimeType)&&e.set(h.fieldName,{imageBase64:h.imageBase64,mimeType:h.mimeType})}),o=(c==null?void 0:c.next_page_offset)??void 0}while(o)};for(const a of n)if(await r(a),e.size>0)break;return e},wr="dan_inventory",Pv=async t=>{if(!pe||!await tt(wr))return;const e=t.vector||await jn(`${t.productName} ${t.locationBucket||""} ${t.quantity}`),n=Gt(e,t.inventoryUuid,`${wr}:${t.inventoryUuid}`),r={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:t.productName,quantity:t.quantity,expirationDate:t.expirationDate,locationBucket:t.locationBucket||null,sellPrice:t.sellPrice??null,shopId:t.shopId,shopName:t.shopName||null,shareScope:t.shareScope,proofHash:t.proofHash,updatedAt:t.updatedAt||new Date().toISOString()};await pe.upsert(wr,{wait:!0,points:[{id:t.inventoryUuid,...dn(wr,n),payload:r}]})},bI=async t=>{pe&&await tt(wr)&&await pe.delete(wr,{wait:!0,points:[t]})},wI=async()=>(await gt(wr,null)).map(e=>{var r;const n=e.payload;return{inventoryUuid:(n==null?void 0:n.inventoryUuid)||String(e.id),shopId:(n==null?void 0:n.shopId)||"",shopName:(n==null?void 0:n.shopName)||null,productId:(n==null?void 0:n.productId)||"",productName:(n==null?void 0:n.productName)||"",quantity:(n==null?void 0:n.quantity)||0,expirationDate:(n==null?void 0:n.expirationDate)||"",locationBucket:(n==null?void 0:n.locationBucket)||null,sellPrice:(n==null?void 0:n.sellPrice)??null,shareScope:(n==null?void 0:n.shareScope)||["local"],proofHash:n==null?void 0:n.proofHash,updatedAt:(n==null?void 0:n.updatedAt)||((r=e.payload)==null?void 0:r.updatedAt)||""}}).filter(e=>e.quantity>0).sort((e,n)=>{const r=new Date(e.expirationDate).getTime(),a=new Date(n.expirationDate).getTime();return r-a}),Ve={products:new Map,batches:new Map,stockItems:new Map,salesTransactions:new Map,productVisualFeatures:new Map,marketplaceListings:new Map};let Zd=!1;const kv=t=>{Zd=t},ef=t=>t.toLowerCase().trim().replace(/\s+/g,"-"),_I=async(t,e)=>{const n=new Map,r=await t();for(const f of r){if(f.quantity<=0||f.status==="EMPTY"||f.status==="EXPIRED"||f.status&&f.status!=="ACTIVE")continue;const p=Ve.products.get(f.productId);if(!p)continue;const h=n.get(p.id);if(h)h.totalQuantity+=f.quantity,f.expirationDate<h.earliestExpiration&&(h.earliestExpiration=f.expirationDate),f.supplierId&&h.supplierIdsSet.add(f.supplierId),h.batches.push({batchId:String(f.batchId),quantity:f.quantity,expirationDate:f.expirationDate}),h.totalCost+=f.costPerUnit*f.quantity,h.itemCount+=f.quantity;else{const x=new Set;f.supplierId&&x.add(f.supplierId),n.set(p.id,{productId:p.id,productName:p.name,manufacturer:p.manufacturer,category:p.category,totalQuantity:f.quantity,quantityType:"units",earliestExpiration:f.expirationDate,supplierIdsSet:x,batches:[{batchId:String(f.batchId),quantity:f.quantity,expirationDate:f.expirationDate}],totalCost:f.costPerUnit*f.quantity,itemCount:f.quantity,averageCostPerUnit:0})}}const a=await e(),o=new Set(a.map(f=>f.id)),c=[];return n.forEach(f=>{if(!(f.supplierIdsSet.size===0||Array.from(f.supplierIdsSet).some(_=>o.has(_))))return;const{totalCost:h,itemCount:x,supplierIdsSet:v,...w}=f;c.push({...w,supplierIds:Array.from(v).filter(_=>o.has(_)),averageCostPerUnit:x>0?h/x:0})}),c.sort((f,p)=>f.productName.localeCompare(p.productName))},Uv=()=>{Ve.products.clear(),Ve.batches.clear(),Ve.stockItems.clear(),Ve.salesTransactions.clear(),Ve.marketplaceListings.clear(),Ve.productVisualFeatures.clear()},Ul=async()=>{if(console.log("[DataLoader] loadDataFromQdrant called, activeShopId:",ue),!ue){console.warn("[DataLoader] activeShopId is not set, cannot load data");return}const t=typeof ue=="string"?ue:ue&&typeof ue=="object"&&ue!==null&&"id"in ue?(()=>{const x=ue;return console.warn(`[DataLoader] activeShopId is an object instead of string. Extracting id: ${x.id}`),x.id})():null;if(!t){console.warn("[DataLoader] Could not extract shopIdString from activeShopId");return}console.log(`[DataLoader] Loading data for shopId: ${t}`);const[e,n,r,a,o,c]=await Promise.all([gt("suppliers",t),gt("products",null),gt("batches",t),gt("items",t),gt("sales",t),gt("marketplace",t)]);if(console.log(`[DataLoader] Fetched from Qdrant: ${a.length} items, ${n.length} products, ${r.length} batches`),a.length===0){console.warn(`[DataLoader] No items found for shopId: ${t}. Checking all items in Qdrant...`);try{const x=await gt("items",null),v=new Set;x.forEach(w=>{var N;const _=(N=w.payload)==null?void 0:N.shopId,E=typeof _=="string"?_:_&&typeof _=="object"&&"id"in _?_.id:null;E&&v.add(E)}),console.warn(`[DataLoader] Found ${x.length} total items in Qdrant. ShopIds present:`,Array.from(v)),x.length>0&&!v.has(t)&&(console.error(`[DataLoader] CRITICAL: Items exist but none have shopId "${t}". Items have shopIds:`,Array.from(v)),console.error(`[DataLoader] Expected shopId: ${t}`),console.error("[DataLoader] Found shopIds:",Array.from(v)))}catch(x){console.error("[DataLoader] Error checking all items:",x)}}Uv(),n.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.productId)||String(x.id);w&&Ve.products.set(w,{id:w,name:(v==null?void 0:v.name)||"Unnamed Product",manufacturer:(v==null?void 0:v.manufacturer)||"",category:(v==null?void 0:v.category)||""})}),r.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.batchId)||String(x.id);w&&Ve.batches.set(String(w),{id:String(w),supplier:(v==null?void 0:v.supplierId)||"Unknown Supplier",deliveryDate:(v==null?void 0:v.deliveryDate)||"",inventoryDate:(v==null?void 0:v.inventoryDate)||(v==null?void 0:v.deliveryDate)||""})});let f=0,p=0;const h={};a.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.productId)||(v==null?void 0:v.itemId),_=(v==null?void 0:v.inventoryUuid)||String(x.id);if(!_||!w){p++,h.missing_uuid_or_productId=(h.missing_uuid_or_productId||0)+1;return}const E=v.quantity||0,N=v.status||(E>0?"ACTIVE":"EMPTY");if(E<=0||N==="EMPTY"||N==="EXPIRED"){p++;const A=E<=0?"quantity_zero":N.toLowerCase();h[A]=(h[A]||0)+1;return}const D=typeof v.shopId=="string"?v.shopId:v.shopId&&typeof v.shopId=="object"&&"id"in v.shopId?v.shopId.id:null;D&&D!==t&&console.warn(`[DataLoader] Item ${_} has shopId "${D}" but expected "${t}"`);const U={id:v.inventoryId||Date.now()+Math.random(),inventoryUuid:_,shopId:D||t||"",productId:w,batchId:v.batchId,expirationDate:v.expiration||v.expirationDate||"",quantity:E,costPerUnit:v.costPerUnit||v.buyPrice||0,location:v.location||void 0,supplierId:v.supplierId||void 0,buyPrice:v.buyPrice??v.costPerUnit,sellPrice:v.sellPrice??void 0,images:v.images||[],scanMetadata:v.scanMetadata||null,createdByUserId:v.createdByUserId||void 0,createdAt:v.createdAt,updatedAt:v.updatedAt,qdrantId:_,status:N};Ve.stockItems.set(U.id,U),f++}),console.log(`[DataLoader] Loaded ${f} items into cache, skipped ${p} items:`,h),o.forEach(x=>{const v=x.payload;v!=null&&v.saleId&&Ve.salesTransactions.set(v.saleId,{id:v.saleId,timestamp:v.timestamp,items:v.lineItems||[],totalAmount:v.totalAmount||0})}),c.forEach(x=>{const v=x.payload;v!=null&&v.listingId&&Ve.marketplaceListings.set(v.listingId,{id:v.listingId,productId:v.productId,productName:v.productName,quantity:v.quantity,price:v.price})})};var tf=function(t,e){return tf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])},tf(t,e)};function jv(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");tf(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var jl=function(){return jl=Object.assign||function(e){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},jl.apply(this,arguments)};function ji(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function Ov(t,e,n,r){var a=arguments.length,o=a<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,r);else for(var f=t.length-1;f>=0;f--)(c=t[f])&&(o=(a<3?c(o):a>3?c(e,n,o):c(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o}function Lv(t,e){return function(n,r){e(n,r,t)}}function qv(t,e,n,r,a,o){function c(k){if(k!==void 0&&typeof k!="function")throw new TypeError("Function expected");return k}for(var f=r.kind,p=f==="getter"?"get":f==="setter"?"set":"value",h=!e&&t?r.static?t:t.prototype:null,x=e||(h?Object.getOwnPropertyDescriptor(h,r.name):{}),v,w=!1,_=n.length-1;_>=0;_--){var E={};for(var N in r)E[N]=N==="access"?{}:r[N];for(var N in r.access)E.access[N]=r.access[N];E.addInitializer=function(k){if(w)throw new TypeError("Cannot add initializers after decoration has completed");o.push(c(k||null))};var D=(0,n[_])(f==="accessor"?{get:x.get,set:x.set}:x[p],E);if(f==="accessor"){if(D===void 0)continue;if(D===null||typeof D!="object")throw new TypeError("Object expected");(v=c(D.get))&&(x.get=v),(v=c(D.set))&&(x.set=v),(v=c(D.init))&&a.unshift(v)}else(v=c(D))&&(f==="field"?a.unshift(v):x[p]=v)}h&&Object.defineProperty(h,r.name,x),w=!0}function Bv(t,e,n){for(var r=arguments.length>2,a=0;a<e.length;a++)n=r?e[a].call(t,n):e[a].call(t);return r?n:void 0}function Vv(t){return typeof t=="symbol"?t:"".concat(t)}function Gv(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function Hv(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Se(t,e,n,r){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function f(x){try{h(r.next(x))}catch(v){c(v)}}function p(x){try{h(r.throw(x))}catch(v){c(v)}}function h(x){x.done?o(x.value):a(x.value).then(f,p)}h((r=r.apply(t,e||[])).next())})}function zv(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,a,o,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=f(0),c.throw=f(1),c.return=f(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function f(h){return function(x){return p([h,x])}}function p(h){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,h[0]&&(n=0)),n;)try{if(r=1,a&&(o=h[0]&2?a.return:h[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,h[1])).done)return o;switch(a=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,a=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){n.label=h[1];break}if(h[0]===6&&n.label<o[1]){n.label=o[1],o=h;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(h);break}o[2]&&n.ops.pop(),n.trys.pop();continue}h=e.call(t,n)}catch(x){h=[6,x],a=0}finally{r=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var Ql=Object.create?(function(t,e,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]});function Fv(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Ql(e,t,n)}function Ol(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function qf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),a,o=[],c;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)o.push(a.value)}catch(f){c={error:f}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return o}function $v(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(qf(arguments[e]));return t}function Jv(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),a=0,e=0;e<n;e++)for(var o=arguments[e],c=0,f=o.length;c<f;c++,a++)r[a]=o[c];return r}function Yv(t,e,n){if(n||arguments.length===2)for(var r=0,a=e.length,o;r<a;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function Ii(t){return this instanceof Ii?(this.v=t,this):new Ii(t)}function Kv(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(_){return function(E){return Promise.resolve(E).then(_,v)}}function f(_,E){r[_]&&(a[_]=function(N){return new Promise(function(D,k){o.push([_,N,D,k])>1||p(_,N)})},E&&(a[_]=E(a[_])))}function p(_,E){try{h(r[_](E))}catch(N){w(o[0][3],N)}}function h(_){_.value instanceof Ii?Promise.resolve(_.value.v).then(x,v):w(o[0][2],_)}function x(_){p("next",_)}function v(_){p("throw",_)}function w(_,E){_(E),o.shift(),o.length&&p(o[0][0],o[0][1])}}function Qv(t){var e,n;return e={},r("next"),r("throw",function(a){throw a}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(a,o){e[a]=t[a]?function(c){return(n=!n)?{value:Ii(t[a](c)),done:!1}:o?o(c):c}:o}}function Xv(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ol=="function"?Ol(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(f,p){c=t[o](c),a(f,p,c.done,c.value)})}}function a(o,c,f,p){Promise.resolve(p).then(function(h){o({value:h,done:f})},c)}}function Wv(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var SI=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},nf=function(t){return nf=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},nf(t)};function Zv(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=nf(t),r=0;r<n.length;r++)n[r]!=="default"&&Ql(e,t,n[r]);return SI(e,t),e}function eb(t){return t&&t.__esModule?t:{default:t}}function tb(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function nb(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n}function sb(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function rb(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,a;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(a=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");a&&(r=function(){try{a.call(this)}catch(o){return Promise.reject(o)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var EI=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function ib(t){function e(o){t.error=t.hasError?new EI(o,t.error,"An error was suppressed during disposal."):o,t.hasError=!0}var n,r=0;function a(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(a);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(o).then(a,function(c){return e(c),a()})}else r|=1}catch(c){e(c)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}function ab(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,a,o,c){return r?e?".jsx":".js":a&&(!o||!c)?n:a+o+"."+c.toLowerCase()+"js"}):t}const TI={__extends:jv,__assign:jl,__rest:ji,__decorate:Ov,__param:Lv,__esDecorate:qv,__runInitializers:Bv,__propKey:Vv,__setFunctionName:Gv,__metadata:Hv,__awaiter:Se,__generator:zv,__createBinding:Ql,__exportStar:Fv,__values:Ol,__read:qf,__spread:$v,__spreadArrays:Jv,__spreadArray:Yv,__await:Ii,__asyncGenerator:Kv,__asyncDelegator:Qv,__asyncValues:Xv,__makeTemplateObject:Wv,__importStar:Zv,__importDefault:eb,__classPrivateFieldGet:tb,__classPrivateFieldSet:nb,__classPrivateFieldIn:sb,__addDisposableResource:rb,__disposeResources:ib,__rewriteRelativeImportExtension:ab},NI=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:rb,get __assign(){return jl},__asyncDelegator:Qv,__asyncGenerator:Kv,__asyncValues:Xv,__await:Ii,__awaiter:Se,__classPrivateFieldGet:tb,__classPrivateFieldIn:sb,__classPrivateFieldSet:nb,__createBinding:Ql,__decorate:Ov,__disposeResources:ib,__esDecorate:qv,__exportStar:Fv,__extends:jv,__generator:zv,__importDefault:eb,__importStar:Zv,__makeTemplateObject:Wv,__metadata:Hv,__param:Lv,__propKey:Vv,__read:qf,__rest:ji,__rewriteRelativeImportExtension:ab,__runInitializers:Bv,__setFunctionName:Gv,__spread:$v,__spreadArray:Yv,__spreadArrays:Jv,__values:Ol,default:TI},Symbol.toStringTag,{value:"Module"})),CI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Bf extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class AI extends Bf{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zy extends Bf{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Fy extends Bf{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var sf;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(sf||(sf={}));class II{constructor(e,{headers:n={},customFetch:r,region:a=sf.Any}={}){this.url=e,this.headers=n,this.region=a,this.fetch=CI(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Se(this,arguments,void 0,function*(n,r={}){var a;let o,c;try{const{headers:f,method:p,body:h,signal:x,timeout:v}=r;let w={},{region:_}=r;_||(_=this.region);const E=new URL(`${this.url}/${n}`);_&&_!=="any"&&(w["x-region"]=_,E.searchParams.set("forceFunctionRegion",_));let N;h&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(w["Content-Type"]="application/octet-stream",N=h):typeof h=="string"?(w["Content-Type"]="text/plain",N=h):typeof FormData<"u"&&h instanceof FormData?N=h:(w["Content-Type"]="application/json",N=JSON.stringify(h)):N=h;let D=x;v&&(c=new AbortController,o=setTimeout(()=>c.abort(),v),x?(D=c.signal,x.addEventListener("abort",()=>c.abort())):D=c.signal);const k=yield this.fetch(E.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},w),this.headers),f),body:N,signal:D}).catch(P=>{throw new AI(P)}),U=k.headers.get("x-relay-error");if(U&&U==="true")throw new zy(k);if(!k.ok)throw new Fy(k);let A=((a=k.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),I;return A==="application/json"?I=yield k.json():A==="application/octet-stream"||A==="application/pdf"?I=yield k.blob():A==="text/event-stream"?I=k:A==="multipart/form-data"?I=yield k.formData():I=yield k.text(),{data:I,error:null,response:k}}catch(f){return{data:null,error:f,response:f instanceof Fy||f instanceof zy?f.context:void 0}}finally{o&&clearTimeout(o)}})}}var Ot={};const Oi=KS(NI);var ml={},gl={},yl={},xl={},vl={},bl={},$y;function ob(){if($y)return bl;$y=1,Object.defineProperty(bl,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return bl.default=t,bl}var Jy;function lb(){if(Jy)return vl;Jy=1,Object.defineProperty(vl,"__esModule",{value:!0});const e=Oi.__importDefault(ob());class n{constructor(a){var o,c;this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=new Headers(a.headers),this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=(o=a.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=a.signal,this.isMaybeSingle=(c=a.isMaybeSingle)!==null&&c!==void 0?c:!1,a.fetch?this.fetch=a.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,o){return this.headers=new Headers(this.headers),this.headers.set(a,o),this}then(a,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let f=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async p=>{var h,x,v,w;let _=null,E=null,N=null,D=p.status,k=p.statusText;if(p.ok){if(this.method!=="HEAD"){const P=await p.text();P===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((h=this.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text"))?E=P:E=JSON.parse(P))}const A=(x=this.headers.get("Prefer"))===null||x===void 0?void 0:x.match(/count=(exact|planned|estimated)/),I=(v=p.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");A&&I&&I.length>1&&(N=parseInt(I[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(E)&&(E.length>1?(_={code:"PGRST116",details:`Results contain ${E.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},E=null,N=null,D=406,k="Not Acceptable"):E.length===1?E=E[0]:E=null)}else{const A=await p.text();try{_=JSON.parse(A),Array.isArray(_)&&p.status===404&&(E=[],_=null,D=200,k="OK")}catch{p.status===404&&A===""?(D=204,k="No Content"):_={message:A}}if(_&&this.isMaybeSingle&&(!((w=_==null?void 0:_.details)===null||w===void 0)&&w.includes("0 rows"))&&(_=null,D=200,k="OK"),_&&this.shouldThrowOnError)throw new e.default(_)}return{error:_,data:E,count:N,status:D,statusText:k}});return this.shouldThrowOnError||(f=f.catch(p=>{var h,x,v;return{error:{message:`${(h=p==null?void 0:p.name)!==null&&h!==void 0?h:"FetchError"}: ${p==null?void 0:p.message}`,details:`${(x=p==null?void 0:p.stack)!==null&&x!==void 0?x:""}`,hint:"",code:`${(v=p==null?void 0:p.code)!==null&&v!==void 0?v:""}`},data:null,count:null,status:0,statusText:""}})),f.then(a,o)}returns(){return this}overrideTypes(){return this}}return vl.default=n,vl}var Yy;function cb(){if(Yy)return xl;Yy=1,Object.defineProperty(xl,"__esModule",{value:!0});const e=Oi.__importDefault(lb());class n extends e.default{select(a){let o=!1;const c=(a??"*").split("").map(f=>/\s/.test(f)&&!o?"":(f==='"'&&(o=!o),f)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:o=!0,nullsFirst:c,foreignTable:f,referencedTable:p=f}={}){const h=p?`${p}.order`:"order",x=this.url.searchParams.get(h);return this.url.searchParams.set(h,`${x?`${x},`:""}${a}.${o?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:o,referencedTable:c=o}={}){const f=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(f,`${a}`),this}range(a,o,{foreignTable:c,referencedTable:f=c}={}){const p=typeof f>"u"?"offset":`${f}.offset`,h=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(p,`${a}`),this.url.searchParams.set(h,`${o-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:o=!1,settings:c=!1,buffers:f=!1,wal:p=!1,format:h="text"}={}){var x;const v=[a?"analyze":null,o?"verbose":null,c?"settings":null,f?"buffers":null,p?"wal":null].filter(Boolean).join("|"),w=(x=this.headers.get("Accept"))!==null&&x!==void 0?x:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${h}; for="${w}"; options=${v};`),h==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}}return xl.default=n,xl}var Ky;function Vf(){if(Ky)return yl;Ky=1,Object.defineProperty(yl,"__esModule",{value:!0});const e=Oi.__importDefault(cb()),n=new RegExp("[,()]");class r extends e.default{eq(o,c){return this.url.searchParams.append(o,`eq.${c}`),this}neq(o,c){return this.url.searchParams.append(o,`neq.${c}`),this}gt(o,c){return this.url.searchParams.append(o,`gt.${c}`),this}gte(o,c){return this.url.searchParams.append(o,`gte.${c}`),this}lt(o,c){return this.url.searchParams.append(o,`lt.${c}`),this}lte(o,c){return this.url.searchParams.append(o,`lte.${c}`),this}like(o,c){return this.url.searchParams.append(o,`like.${c}`),this}likeAllOf(o,c){return this.url.searchParams.append(o,`like(all).{${c.join(",")}}`),this}likeAnyOf(o,c){return this.url.searchParams.append(o,`like(any).{${c.join(",")}}`),this}ilike(o,c){return this.url.searchParams.append(o,`ilike.${c}`),this}ilikeAllOf(o,c){return this.url.searchParams.append(o,`ilike(all).{${c.join(",")}}`),this}ilikeAnyOf(o,c){return this.url.searchParams.append(o,`ilike(any).{${c.join(",")}}`),this}is(o,c){return this.url.searchParams.append(o,`is.${c}`),this}in(o,c){const f=Array.from(new Set(c)).map(p=>typeof p=="string"&&n.test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(o,`in.(${f})`),this}contains(o,c){return typeof c=="string"?this.url.searchParams.append(o,`cs.${c}`):Array.isArray(c)?this.url.searchParams.append(o,`cs.{${c.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(c)}`),this}containedBy(o,c){return typeof c=="string"?this.url.searchParams.append(o,`cd.${c}`):Array.isArray(c)?this.url.searchParams.append(o,`cd.{${c.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(c)}`),this}rangeGt(o,c){return this.url.searchParams.append(o,`sr.${c}`),this}rangeGte(o,c){return this.url.searchParams.append(o,`nxl.${c}`),this}rangeLt(o,c){return this.url.searchParams.append(o,`sl.${c}`),this}rangeLte(o,c){return this.url.searchParams.append(o,`nxr.${c}`),this}rangeAdjacent(o,c){return this.url.searchParams.append(o,`adj.${c}`),this}overlaps(o,c){return typeof c=="string"?this.url.searchParams.append(o,`ov.${c}`):this.url.searchParams.append(o,`ov.{${c.join(",")}}`),this}textSearch(o,c,{config:f,type:p}={}){let h="";p==="plain"?h="pl":p==="phrase"?h="ph":p==="websearch"&&(h="w");const x=f===void 0?"":`(${f})`;return this.url.searchParams.append(o,`${h}fts${x}.${c}`),this}match(o){return Object.entries(o).forEach(([c,f])=>{this.url.searchParams.append(c,`eq.${f}`)}),this}not(o,c,f){return this.url.searchParams.append(o,`not.${c}.${f}`),this}or(o,{foreignTable:c,referencedTable:f=c}={}){const p=f?`${f}.or`:"or";return this.url.searchParams.append(p,`(${o})`),this}filter(o,c,f){return this.url.searchParams.append(o,`${c}.${f}`),this}}return yl.default=r,yl}var Qy;function ub(){if(Qy)return gl;Qy=1,Object.defineProperty(gl,"__esModule",{value:!0});const e=Oi.__importDefault(Vf());class n{constructor(a,{headers:o={},schema:c,fetch:f}){this.url=a,this.headers=new Headers(o),this.schema=c,this.fetch=f}select(a,o){const{head:c=!1,count:f}=o??{},p=c?"HEAD":"GET";let h=!1;const x=(a??"*").split("").map(v=>/\s/.test(v)&&!h?"":(v==='"'&&(h=!h),v)).join("");return this.url.searchParams.set("select",x),f&&this.headers.append("Prefer",`count=${f}`),new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:o,defaultToNull:c=!0}={}){var f;const p="POST";if(o&&this.headers.append("Prefer",`count=${o}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const h=a.reduce((x,v)=>x.concat(Object.keys(v)),[]);if(h.length>0){const x=[...new Set(h)].map(v=>`"${v}"`);this.url.searchParams.set("columns",x.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}upsert(a,{onConflict:o,ignoreDuplicates:c=!1,count:f,defaultToNull:p=!0}={}){var h;const x="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),f&&this.headers.append("Prefer",`count=${f}`),p||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const v=a.reduce((w,_)=>w.concat(Object.keys(_)),[]);if(v.length>0){const w=[...new Set(v)].map(_=>`"${_}"`);this.url.searchParams.set("columns",w.join(","))}}return new e.default({method:x,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}update(a,{count:o}={}){var c;const f="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:f,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:a}={}){var o;const c="DELETE";return a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return gl.default=n,gl}var Xy;function RI(){if(Xy)return ml;Xy=1,Object.defineProperty(ml,"__esModule",{value:!0});const t=Oi,e=t.__importDefault(ub()),n=t.__importDefault(Vf());class r{constructor(o,{headers:c={},schema:f,fetch:p}={}){this.url=o,this.headers=new Headers(c),this.schemaName=f,this.fetch=p}from(o){const c=new URL(`${this.url}/${o}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new r(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,c={},{head:f=!1,get:p=!1,count:h}={}){var x;let v;const w=new URL(`${this.url}/rpc/${o}`);let _;f||p?(v=f?"HEAD":"GET",Object.entries(c).filter(([N,D])=>D!==void 0).map(([N,D])=>[N,Array.isArray(D)?`{${D.join(",")}}`:`${D}`]).forEach(([N,D])=>{w.searchParams.append(N,D)})):(v="POST",_=c);const E=new Headers(this.headers);return h&&E.set("Prefer",`count=${h}`),new n.default({method:v,url:w,headers:E,schema:this.schemaName,body:_,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}}return ml.default=r,ml}var Wy;function DI(){if(Wy)return Ot;Wy=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.PostgrestError=Ot.PostgrestBuilder=Ot.PostgrestTransformBuilder=Ot.PostgrestFilterBuilder=Ot.PostgrestQueryBuilder=Ot.PostgrestClient=void 0;const t=Oi,e=t.__importDefault(RI());Ot.PostgrestClient=e.default;const n=t.__importDefault(ub());Ot.PostgrestQueryBuilder=n.default;const r=t.__importDefault(Vf());Ot.PostgrestFilterBuilder=r.default;const a=t.__importDefault(cb());Ot.PostgrestTransformBuilder=a.default;const o=t.__importDefault(lb());Ot.PostgrestBuilder=o.default;const c=t.__importDefault(ob());return Ot.PostgrestError=c.default,Ot.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:o.default,PostgrestError:c.default},Ot}var db=DI();const fb=vf(db),MI=YS({__proto__:null,default:fb},[db]),{PostgrestClient:PI,PostgrestQueryBuilder:z3,PostgrestFilterBuilder:F3,PostgrestTransformBuilder:$3,PostgrestBuilder:J3,PostgrestError:Y3}=fb||MI;class kI{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,a=parseInt(r.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const UI="2.81.1",jI=`realtime-js/${UI}`,hb="1.0.0",OI="2.0.0",Zy=hb,rf=1e4,LI=1e3,qI=100;var xr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(xr||(xr={}));var Et;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Et||(Et={}));var _n;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(_n||(_n={}));var af;(function(t){t.websocket="websocket"})(af||(af={}));var vr;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(vr||(vr={}));class BI{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,n){if(this._isArrayBuffer(e.payload))return n(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodePush(e){const{join_ref:n,ref:r,event:a,topic:o,payload:c}=e,f=this.META_LENGTH+n.length+r.length+o.length+a.length,p=new ArrayBuffer(this.HEADER_LENGTH+f);let h=new DataView(p),x=0;h.setUint8(x++,this.KINDS.push),h.setUint8(x++,n.length),h.setUint8(x++,r.length),h.setUint8(x++,o.length),h.setUint8(x++,a.length),Array.from(n,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(r,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(o,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(a,w=>h.setUint8(x++,w.charCodeAt(0)));var v=new Uint8Array(p.byteLength+c.byteLength);return v.set(new Uint8Array(p),0),v.set(new Uint8Array(c),p.byteLength),v.buffer}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const{join_ref:a,ref:o,topic:c}=e,f=e.payload.event,p=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0),h=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+c.length+f.length,x=new ArrayBuffer(this.HEADER_LENGTH+h);let v=new DataView(x),w=0;v.setUint8(w++,this.KINDS.userBroadcastPush),v.setUint8(w++,a.length),v.setUint8(w++,o.length),v.setUint8(w++,c.length),v.setUint8(w++,f.length),v.setUint8(w++,this.BINARY_ENCODING),Array.from(a,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(o,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(c,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(f,E=>v.setUint8(w++,E.charCodeAt(0)));var _=new Uint8Array(x.byteLength+p.byteLength);return _.set(new Uint8Array(x),0),_.set(new Uint8Array(p),x.byteLength),_.buffer}_encodeJsonUserBroadcastPush(e){var n,r;const{join_ref:a,ref:o,topic:c}=e,f=e.payload.event,p=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},x=new TextEncoder().encode(JSON.stringify(p)).buffer,v=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+c.length+f.length,w=new ArrayBuffer(this.HEADER_LENGTH+v);let _=new DataView(w),E=0;_.setUint8(E++,this.KINDS.userBroadcastPush),_.setUint8(E++,a.length),_.setUint8(E++,o.length),_.setUint8(E++,c.length),_.setUint8(E++,f.length),_.setUint8(E++,this.JSON_ENCODING),Array.from(a,D=>_.setUint8(E++,D.charCodeAt(0))),Array.from(o,D=>_.setUint8(E++,D.charCodeAt(0))),Array.from(c,D=>_.setUint8(E++,D.charCodeAt(0))),Array.from(f,D=>_.setUint8(E++,D.charCodeAt(0)));var N=new Uint8Array(w.byteLength+x.byteLength);return N.set(new Uint8Array(w),0),N.set(new Uint8Array(x),w.byteLength),N.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[a,o,c,f,p]=r;return n({join_ref:a,ref:o,topic:c,event:f,payload:p})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),a=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,n,a);case this.KINDS.reply:return this._decodeReply(e,n,a);case this.KINDS.broadcast:return this._decodeBroadcast(e,n,a);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,a)}}_decodePush(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3);let f=this.HEADER_LENGTH+this.META_LENGTH-1;const p=r.decode(e.slice(f,f+a));f=f+a;const h=r.decode(e.slice(f,f+o));f=f+o;const x=r.decode(e.slice(f,f+c));f=f+c;const v=JSON.parse(r.decode(e.slice(f,e.byteLength)));return{join_ref:p,ref:null,topic:h,event:x,payload:v}}_decodeReply(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3),f=n.getUint8(4);let p=this.HEADER_LENGTH+this.META_LENGTH;const h=r.decode(e.slice(p,p+a));p=p+a;const x=r.decode(e.slice(p,p+o));p=p+o;const v=r.decode(e.slice(p,p+c));p=p+c;const w=r.decode(e.slice(p,p+f));p=p+f;const _=JSON.parse(r.decode(e.slice(p,e.byteLength))),E={status:w,response:_};return{join_ref:h,ref:x,topic:v,event:_n.reply,payload:E}}_decodeBroadcast(e,n,r){const a=n.getUint8(1),o=n.getUint8(2);let c=this.HEADER_LENGTH+2;const f=r.decode(e.slice(c,c+a));c=c+a;const p=r.decode(e.slice(c,c+o));c=c+o;const h=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{join_ref:null,ref:null,topic:f,event:p,payload:h}}_decodeUserBroadcast(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3),f=n.getUint8(4);let p=this.HEADER_LENGTH+4;const h=r.decode(e.slice(p,p+a));p=p+a;const x=r.decode(e.slice(p,p+o));p=p+o;const v=r.decode(e.slice(p,p+c));p=p+c;const w=e.slice(p,e.byteLength),_=f===this.JSON_ENCODING?JSON.parse(r.decode(w)):w,E={type:this.BROADCAST,event:x,payload:_};return c>0&&(E.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST,payload:E}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}}class pb{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var rt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(rt||(rt={}));const ex=(t,e,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((o,c)=>(o[c]=VI(c,t,e,a),o),{}):{}},VI=(t,e,n,r)=>{const a=e.find(f=>f.name===t),o=a==null?void 0:a.type,c=n[t];return o&&!r.includes(o)?mb(o,c):of(c)},mb=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return FI(e,n)}switch(t){case rt.bool:return GI(e);case rt.float4:case rt.float8:case rt.int2:case rt.int4:case rt.int8:case rt.numeric:case rt.oid:return HI(e);case rt.json:case rt.jsonb:return zI(e);case rt.timestamp:return $I(e);case rt.abstime:case rt.date:case rt.daterange:case rt.int4range:case rt.int8range:case rt.money:case rt.reltime:case rt.text:case rt.time:case rt.timestamptz:case rt.timetz:case rt.tsrange:case rt.tstzrange:return of(e);default:return of(e)}},of=t=>t,GI=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},HI=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},zI=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},FI=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let o;const c=t.slice(1,n);try{o=JSON.parse("["+c+"]")}catch{o=c?c.split(","):[]}return o.map(f=>mb(e,f))}return t},$I=t=>typeof t=="string"?t.replace(" ","T"):t,gb=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Rd{constructor(e,n,r={},a=rf){this.channel=e,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var tx;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(tx||(tx={}));class Ua{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:o,onLeave:c,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ua.syncState(this.state,a,o,c),this.pendingDiffs.forEach(p=>{this.state=Ua.syncDiff(this.state,p,o,c)}),this.pendingDiffs=[],f()}),this.channel._on(r.diff,{},a=>{const{onJoin:o,onLeave:c,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Ua.syncDiff(this.state,a,o,c),f())}),this.onJoin((a,o,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:c})}),this.onLeave((a,o,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,a){const o=this.cloneDeep(e),c=this.transformState(n),f={},p={};return this.map(o,(h,x)=>{c[h]||(p[h]=x)}),this.map(c,(h,x)=>{const v=o[h];if(v){const w=x.map(D=>D.presence_ref),_=v.map(D=>D.presence_ref),E=x.filter(D=>_.indexOf(D.presence_ref)<0),N=v.filter(D=>w.indexOf(D.presence_ref)<0);E.length>0&&(f[h]=E),N.length>0&&(p[h]=N)}else f[h]=x}),this.syncDiff(o,{joins:f,leaves:p},r,a)}static syncDiff(e,n,r,a){const{joins:o,leaves:c}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(o,(f,p)=>{var h;const x=(h=e[f])!==null&&h!==void 0?h:[];if(e[f]=this.cloneDeep(p),x.length>0){const v=e[f].map(_=>_.presence_ref),w=x.filter(_=>v.indexOf(_.presence_ref)<0);e[f].unshift(...w)}r(f,x,p)}),this.map(c,(f,p)=>{let h=e[f];if(!h)return;const x=p.map(v=>v.presence_ref);h=h.filter(v=>x.indexOf(v.presence_ref)<0),e[f]=h,a(f,h,p),h.length===0&&delete e[f]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const a=e[r];return"metas"in a?n[r]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):n[r]=a,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var nx;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(nx||(nx={}));var ja;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(ja||(ja={}));var ds;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ds||(ds={}));class Gf{constructor(e,n={config:{}},r){var a,o;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Et.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Rd(this,_n.join,this.params,this.timeout),this.rejoinTimer=new pb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Et.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Et.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this._on(_n.reply,{},(c,f)=>{this._trigger(this._replyEventName(f),c)}),this.presence=new Ua(this),this.broadcastEndpointURL=gb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,a,o;if(this.socket.isConnected()||this.socket.connect(),this.state==Et.closed){const{config:{broadcast:c,presence:f,private:p}}=this.params,h=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(_=>_.filter))!==null&&a!==void 0?a:[],x=!!this.bindings[ja.PRESENCE]&&this.bindings[ja.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,v={},w={broadcast:c,presence:Object.assign(Object.assign({},f),{enabled:x}),postgres_changes:h,private:p};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(_=>e==null?void 0:e(ds.CHANNEL_ERROR,_)),this._onClose(()=>e==null?void 0:e(ds.CLOSED)),this.updateJoinPayload(Object.assign({config:w},v)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:_})=>{var E;if(this.socket.setAuth(),_===void 0){e==null||e(ds.SUBSCRIBED);return}else{const N=this.bindings.postgres_changes,D=(E=N==null?void 0:N.length)!==null&&E!==void 0?E:0,k=[];for(let U=0;U<D;U++){const A=N[U],{filter:{event:I,schema:P,table:B,filter:H}}=A,Q=_&&_[U];if(Q&&Q.event===I&&Q.schema===P&&Q.table===B&&Q.filter===H)k.push(Object.assign(Object.assign({},A),{id:Q.id}));else{this.unsubscribe(),this.state=Et.errored,e==null||e(ds.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=k,e&&e(ds.SUBSCRIBED);return}}).receive("error",_=>{this.state=Et.errored,e==null||e(ds.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(_).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ds.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Et.joined&&e===ja.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var a;const o=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const c={method:"POST",headers:{Authorization:o,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},f=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(f.status===202)return{success:!0};let p=f.statusText;try{const h=await f.json();p=h.error||h.message||p}catch{}return Promise.reject(new Error(p))}async send(e,n={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:c}=e,p={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:c,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=h.body)===null||a===void 0?void 0:a.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var c,f,p;const h=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(f=(c=this.params)===null||c===void 0?void 0:c.config)===null||f===void 0?void 0:f.broadcast)===null||p===void 0)&&p.ack)&&o("ok"),h.receive("ok",()=>o("ok")),h.receive("error",()=>o("error")),h.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Et.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(_n.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new Rd(this,_n.leave,{},e),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Et.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const a=new AbortController,o=setTimeout(()=>a.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(o),c}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Rd(this,e,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>qI){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var a,o;const c=e.toLocaleLowerCase(),{close:f,error:p,leave:h,join:x}=_n;if(r&&[f,p,h,x].indexOf(c)>=0&&r!==this._joinRef())return;let w=this._onMessage(c,n,r);if(n&&!w)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(_=>{var E,N,D;return((E=_.filter)===null||E===void 0?void 0:E.event)==="*"||((D=(N=_.filter)===null||N===void 0?void 0:N.event)===null||D===void 0?void 0:D.toLocaleLowerCase())===c}).map(_=>_.callback(w,r)):(o=this.bindings[c])===null||o===void 0||o.filter(_=>{var E,N,D,k,U,A;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in _){const I=_.id,P=(E=_.filter)===null||E===void 0?void 0:E.event;return I&&((N=n.ids)===null||N===void 0?void 0:N.includes(I))&&(P==="*"||(P==null?void 0:P.toLocaleLowerCase())===((D=n.data)===null||D===void 0?void 0:D.type.toLocaleLowerCase()))}else{const I=(U=(k=_==null?void 0:_.filter)===null||k===void 0?void 0:k.event)===null||U===void 0?void 0:U.toLocaleLowerCase();return I==="*"||I===((A=n==null?void 0:n.event)===null||A===void 0?void 0:A.toLocaleLowerCase())}else return _.type.toLocaleLowerCase()===c}).map(_=>{if(typeof w=="object"&&"ids"in w){const E=w.data,{schema:N,table:D,commit_timestamp:k,type:U,errors:A}=E;w=Object.assign(Object.assign({},{schema:N,table:D,commit_timestamp:k,eventType:U,new:{},old:{},errors:A}),this._getPayloadRecords(E))}_.callback(w,r)})}_isClosed(){return this.state===Et.closed}_isJoined(){return this.state===Et.joined}_isJoining(){return this.state===Et.joining}_isLeaving(){return this.state===Et.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const a=e.toLocaleLowerCase(),o={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Gf.isEqual(a.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(_n.close,{},e)}_onError(e){this._on(_n.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Et.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=ex(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=ex(e.columns,e.old_record)),n}}const Dd=()=>{},wl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},JI=[1e3,2e3,5e3,1e4],YI=1e4,KI=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class QI{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=rf,this.transport=null,this.heartbeatIntervalMs=wl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Dd,this.ref=0,this.reconnectTimer=null,this.vsn=Zy,this.logger=Dd,this.conn=null,this.sendBuffer=[],this.serializer=new BI,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>a?(...o)=>a(...o):(...o)=>fetch(...o),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${af.websocket}`,this.httpEndpoint=gb(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=kI.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case xr.connecting:return vr.Connecting;case xr.open:return vr.Open;case xr.closing:return vr.Closing;default:return vr.Closed}}isConnected(){return this.connectionState()===vr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(o=>o.topic===r);if(a)return a;{const o=new Gf(`realtime:${e}`,n,this);return this.channels.push(o),o}}push(e){const{topic:n,event:r,payload:a,ref:o}=e,c=()=>{this.encode(e,f=>{var p;(p=this.conn)===null||p===void 0||p.send(f)})};this.log("push",`${n} ${r} (${o})`,a),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(LI,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},wl.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(h){this.log("error","error in heartbeat callback",h)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:o,ref:c}=n,f=c?`(${c})`:"",p=o.status||"";this.log("receive",`${p} ${r} ${a} ${f}`.trim(),o),this.channels.filter(h=>h._isMember(r)).forEach(h=>h._trigger(a,o,c)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===xr.open||this.conn.readyState===xr.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(_n.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${e}${r}${a}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([KI],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const a={access_token:n,version:jI};n&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(_n.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new pb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},wl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,a,o,c,f,p,h,x,v,w,_;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:rf,this.heartbeatIntervalMs=(a=e==null?void 0:e.heartbeatIntervalMs)!==null&&a!==void 0?a:wl.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(c=e==null?void 0:e.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(f=e==null?void 0:e.heartbeatCallback)!==null&&f!==void 0?f:Dd,this.vsn=(p=e==null?void 0:e.vsn)!==null&&p!==void 0?p:Zy,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e==null?void 0:e.reconnectAfterMs)!==null&&h!==void 0?h:(E=>JI[E-1]||YI),this.vsn){case hb:this.encode=(x=e==null?void 0:e.encode)!==null&&x!==void 0?x:((E,N)=>N(JSON.stringify(E))),this.decode=(v=e==null?void 0:e.decode)!==null&&v!==void 0?v:((E,N)=>N(JSON.parse(E)));break;case OI:this.encode=(w=e==null?void 0:e.encode)!==null&&w!==void 0?w:this.serializer.encode.bind(this.serializer),this.decode=(_=e==null?void 0:e.decode)!==null&&_!==void 0?_:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Hf extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ut(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class XI extends Hf{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class lf extends Hf{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const zf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),WI=()=>Response,cf=t=>{if(Array.isArray(t))return t.map(n=>cf(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[a]=cf(r)}),e},ZI=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Md=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},eR=(t,e,n)=>Se(void 0,void 0,void 0,function*(){const r=yield WI();t instanceof r&&!(n!=null&&n.noResolveJson)?t.json().then(a=>{const o=t.status||500,c=(a==null?void 0:a.statusCode)||o+"";e(new XI(Md(a),o,c))}).catch(a=>{e(new lf(Md(a),a))}):e(new lf(Md(t),t))}),tR=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?a:(ZI(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,e!=null&&e.duplex&&(a.duplex=e.duplex),Object.assign(Object.assign({},a),n))};function Ya(t,e,n,r,a,o){return Se(this,void 0,void 0,function*(){return new Promise((c,f)=>{t(n,tR(e,r,a,o)).then(p=>{if(!p.ok)throw p;return r!=null&&r.noResolveJson?p:p.json()}).then(p=>c(p)).catch(p=>eR(p,f,r))})})}function qa(t,e,n,r){return Se(this,void 0,void 0,function*(){return Ya(t,"GET",e,n,r)})}function Pn(t,e,n,r,a){return Se(this,void 0,void 0,function*(){return Ya(t,"POST",e,r,a,n)})}function uf(t,e,n,r,a){return Se(this,void 0,void 0,function*(){return Ya(t,"PUT",e,r,a,n)})}function nR(t,e,n,r){return Se(this,void 0,void 0,function*(){return Ya(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Ff(t,e,n,r,a){return Se(this,void 0,void 0,function*(){return Ya(t,"DELETE",e,r,a,n)})}class sR{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return Se(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ut(e))return{data:null,error:e};throw e}})}}var yb;class rR{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[yb]="BlobDownloadBuilder",this.promise=null}asStream(){return new sR(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Se(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ut(e))return{data:null,error:e};throw e}})}}yb=Symbol.toStringTag;const iR={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},sx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class aR{constructor(e,n={},r,a){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=zf(a)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,a){return Se(this,void 0,void 0,function*(){try{let o;const c=Object.assign(Object.assign({},sx),a);let f=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const p=c.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",c.cacheControl),p&&o.append("metadata",this.encodeMetadata(p)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.has("cacheControl")||o.append("cacheControl",c.cacheControl),p&&!o.has("metadata")&&o.append("metadata",this.encodeMetadata(p))):(o=r,f["cache-control"]=`max-age=${c.cacheControl}`,f["content-type"]=c.contentType,p&&(f["x-metadata"]=this.toBase64(this.encodeMetadata(p))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!c.duplex&&(c.duplex="half")),a!=null&&a.headers&&(f=Object.assign(Object.assign({},f),a.headers));const h=this._removeEmptyFolders(n),x=this._getFinalPath(h),v=yield(e=="PUT"?uf:Pn)(this.fetch,`${this.url}/object/${x}`,o,Object.assign({headers:f},c!=null&&c.duplex?{duplex:c.duplex}:{}));return{data:{path:h,id:v.Id,fullPath:v.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(ut(o))return{data:null,error:o};throw o}})}upload(e,n,r){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,a){return Se(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),c=this._getFinalPath(o),f=new URL(this.url+`/object/upload/sign/${c}`);f.searchParams.set("token",n);try{let p;const h=Object.assign({upsert:sx.upsert},a),x=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(p=new FormData,p.append("cacheControl",h.cacheControl),p.append("",r)):typeof FormData<"u"&&r instanceof FormData?(p=r,p.append("cacheControl",h.cacheControl)):(p=r,x["cache-control"]=`max-age=${h.cacheControl}`,x["content-type"]=h.contentType);const v=yield uf(this.fetch,f.toString(),p,{headers:x});return{data:{path:o,fullPath:v.Key},error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(ut(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e,n){return Se(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const a=Object.assign({},this.headers);n!=null&&n.upsert&&(a["x-upsert"]="true");const o=yield Pn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),c=new URL(this.url+o.url),f=c.searchParams.get("token");if(!f)throw new Hf("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:f},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}update(e,n,r){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Se(this,void 0,void 0,function*(){try{return{data:yield Pn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}copy(e,n,r){return Se(this,void 0,void 0,function*(){try{return{data:{path:(yield Pn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}createSignedUrl(e,n,r){return Se(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),o=yield Pn(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${c}`)},{data:o,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}createSignedUrls(e,n,r){return Se(this,void 0,void 0,function*(){try{const a=yield Pn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${o}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}download(e,n){const a=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),c=o?`?${o}`:"",f=this._getFinalPath(e),p=()=>qa(this.fetch,`${this.url}/${a}/${f}${c}`,{headers:this.headers,noResolveJson:!0});return new rR(p,this.shouldThrowOnError)}info(e){return Se(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield qa(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:cf(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}exists(e){return Se(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield nR(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r)&&r instanceof lf){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),a=[],o=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";o!==""&&a.push(o);const f=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",p=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});p!==""&&a.push(p);let h=a.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${r}${h}`)}}}remove(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Ff(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}list(e,n,r){return Se(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},iR),n),{prefix:e||""});return{data:yield Pn(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}listV2(e,n){return Se(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Pn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const xb="2.81.1",vb={"X-Client-Info":`storage-js/${xb}`};class oR{constructor(e,n={},r,a){this.shouldThrowOnError=!1;const o=new URL(e);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},vb),n),this.fetch=zf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return Se(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield qa(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}getBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield qa(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}createBucket(e){return Se(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield Pn(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}updateBucket(e,n){return Se(this,void 0,void 0,function*(){try{return{data:yield uf(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Pn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Ff(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class lR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},vb),n),this.fetch=zf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Pn(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}listBuckets(e){return Se(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),a=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield qa(this.fetch,a,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield Ff(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}}const $f={"X-Client-Info":`storage-js/${xb}`,"Content-Type":"application/json"};class bb extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function ln(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class Pd extends bb{constructor(e,n,r){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class cR extends bb{constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var rx;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(rx||(rx={}));const Jf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),uR=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},ix=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),dR=(t,e,n)=>Se(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const a=t.status||500,o=t;if(typeof o.json=="function")o.json().then(c=>{const f=(c==null?void 0:c.statusCode)||(c==null?void 0:c.code)||a+"";e(new Pd(ix(c),a,f))}).catch(()=>{const c=a+"",f=o.statusText||`HTTP ${a} error`;e(new Pd(f,a,c))});else{const c=a+"",f=o.statusText||`HTTP ${a} error`;e(new Pd(f,a,c))}}else e(new cR(ix(t),t))}),fR=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return r?(uR(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,Object.assign(Object.assign({},a),n)):a};function hR(t,e,n,r,a,o){return Se(this,void 0,void 0,function*(){return new Promise((c,f)=>{t(n,fR(e,r,a,o)).then(p=>{if(!p.ok)throw p;if(r!=null&&r.noResolveJson)return p;const h=p.headers.get("content-type");return!h||!h.includes("application/json")?{}:p.json()}).then(p=>c(p)).catch(p=>dR(p,f,r))})})}function cn(t,e,n,r,a){return Se(this,void 0,void 0,function*(){return hR(t,"POST",e,r,a,n)})}class pR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$f),n),this.fetch=Jf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return Se(this,void 0,void 0,function*(){try{return{data:(yield cn(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}getIndex(e,n){return Se(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ln(r))return{data:null,error:r};throw r}})}listIndexes(e){return Se(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return Se(this,void 0,void 0,function*(){try{return{data:(yield cn(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ln(r))return{data:null,error:r};throw r}})}}class mR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$f),n),this.fetch=Jf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return Se(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield cn(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}getVectors(e){return Se(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}listVectors(e){return Se(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield cn(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}queryVectors(e){return Se(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}deleteVectors(e){return Se(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield cn(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}}class gR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$f),n),this.fetch=Jf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:(yield cn(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}getBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}listBuckets(){return Se(this,arguments,void 0,function*(e={}){try{return{data:yield cn(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Se(this,void 0,void 0,function*(){try{return{data:(yield cn(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ln(n))return{data:null,error:n};throw n}})}}class yR extends gR{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new xR(this.url,this.headers,e,this.fetch)}}class xR extends pR{constructor(e,n,r,a){super(e,n,a),this.vectorBucketName=r}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Se(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Se(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Se(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Se(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new vR(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class vR extends mR{constructor(e,n,r,a,o){super(e,n,o),this.vectorBucketName=r,this.indexName=a}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Se(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Se(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Se(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Se(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Se(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class bR extends oR{constructor(e,n={},r,a){super(e,n,r,a)}from(e){return new aR(this.url,this.headers,e,this.fetch)}get vectors(){return new yR(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new lR(this.url+"/iceberg",this.headers,this.fetch)}}const wR="2.81.1";let Pa="";typeof Deno<"u"?Pa="deno":typeof document<"u"?Pa="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Pa="react-native":Pa="node";const _R={"X-Client-Info":`supabase-js-${Pa}/${wR}`},SR={headers:_R},ER={schema:"public"},TR={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},NR={},CR=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),AR=()=>Headers,IR=(t,e,n)=>{const r=CR(n),a=AR();return async(o,c)=>{var f;const p=(f=await e())!==null&&f!==void 0?f:t;let h=new a(c==null?void 0:c.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${p}`),r(o,Object.assign(Object.assign({},c),{headers:h}))}};function RR(t){return t.endsWith("/")?t:t+"/"}function DR(t,e){var n,r;const{db:a,auth:o,realtime:c,global:f}=t,{db:p,auth:h,realtime:x,global:v}=e,w={db:Object.assign(Object.assign({},p),a),auth:Object.assign(Object.assign({},h),o),realtime:Object.assign(Object.assign({},x),c),storage:{},global:Object.assign(Object.assign(Object.assign({},v),f),{headers:Object.assign(Object.assign({},(n=v==null?void 0:v.headers)!==null&&n!==void 0?n:{}),(r=f==null?void 0:f.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?w.accessToken=t.accessToken:delete w.accessToken,w}function MR(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(RR(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const wb="2.81.1",xi=30*1e3,df=3,kd=df*xi,PR="http://localhost:9999",kR="supabase.auth.token",UR={"X-Client-Info":`gotrue-js/${wb}`},ff="X-Supabase-Api-Version",_b={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},jR=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,OR=600*1e3;class Ba extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Ne(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class LR extends Ba{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function qR(t){return Ne(t)&&t.name==="AuthApiError"}class br extends Ba{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Ks extends Ba{constructor(e,n,r,a){super(e,r,a),this.name=n,this.status=r}}class Dn extends Ks{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function BR(t){return Ne(t)&&t.name==="AuthSessionMissingError"}class fi extends Ks{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _l extends Ks{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Sl extends Ks{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function VR(t){return Ne(t)&&t.name==="AuthImplicitGrantRedirectError"}class ax extends Ks{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hf extends Ks{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Ud(t){return Ne(t)&&t.name==="AuthRetryableFetchError"}class ox extends Ks{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class pf extends Ks{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ll="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),lx=` 	
\r=`.split(""),GR=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<lx.length;e+=1)t[lx[e].charCodeAt(0)]=-2;for(let e=0;e<Ll.length;e+=1)t[Ll[e].charCodeAt(0)]=e;return t})();function cx(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ll[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ll[r]),e.queuedBits-=6}}function Sb(t,e,n){const r=GR[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function ux(t){const e=[],n=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},o=c=>{FR(c,r,n)};for(let c=0;c<t.length;c+=1)Sb(t.charCodeAt(c),a,o);return e.join("")}function HR(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function zR(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}HR(r,e)}}function FR(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Ni(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<t.length;a+=1)Sb(t.charCodeAt(a),n,r);return new Uint8Array(e)}function $R(t){const e=[];return zR(t,n=>e.push(n)),new Uint8Array(e)}function _r(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};return t.forEach(a=>cx(a,n,r)),cx(null,n,r),e.join("")}function JR(t){return Math.round(Date.now()/1e3)+t}function YR(){return Symbol("auth-callback")}const Ut=()=>typeof window<"u"&&typeof document<"u",pr={tested:!1,writable:!1},Eb=()=>{if(!Ut())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(pr.tested)return pr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),pr.tested=!0,pr.writable=!0}catch{pr.tested=!0,pr.writable=!1}return pr.writable};function KR(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,o)=>{e[o]=a})}catch{}return n.searchParams.forEach((r,a)=>{e[a]=r}),e}const Tb=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),QR=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",vi=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},mr=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Gs=async(t,e)=>{await t.removeItem(e)};class Xl{constructor(){this.promise=new Xl.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Xl.promiseConstructor=Promise;function jd(t){const e=t.split(".");if(e.length!==3)throw new pf("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!jR.test(e[r]))throw new pf("JWT not in base64url format");return{header:JSON.parse(ux(e[0])),payload:JSON.parse(ux(e[1])),signature:Ni(e[2]),raw:{header:e[0],payload:e[1]}}}async function XR(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function WR(t,e){return new Promise((r,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const c=await t(o);if(!e(o,null,c)){r(c);return}}catch(c){if(!e(o,c)){a(c);return}}})()})}function ZR(t){return("0"+t.toString(16)).substr(-2)}function e4(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let o=0;o<56;o++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,ZR).join("")}async function t4(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}async function n4(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await t4(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function hi(t,e,n=!1){const r=e4();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await vi(t,`${e}-code-verifier`,a);const o=await n4(r);return[o,r===o?"plain":"s256"]}const s4=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function r4(t){const e=t.headers.get(ff);if(!e||!e.match(s4))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function i4(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function a4(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const o4=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function pi(t){if(!o4.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Od(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function l4(t,e){return new Proxy(t,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const o=r.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,a)}})}function dx(t){return JSON.parse(JSON.stringify(t))}const yr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),c4=[502,503,504];async function fx(t){var e;if(!QR(t))throw new hf(yr(t),0);if(c4.includes(t.status))throw new hf(yr(t),t.status);let n;try{n=await t.json()}catch(o){throw new br(yr(o),o)}let r;const a=r4(t);if(a&&a.getTime()>=_b["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new ox(yr(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Dn}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((o,c)=>o&&typeof c=="string",!0))throw new ox(yr(n),t.status,n.weak_password.reasons);throw new LR(yr(n),t.status||500,r)}const u4=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function Re(t,e,n,r){var a;const o=Object.assign({},r==null?void 0:r.headers);o[ff]||(o[ff]=_b["2024-01-01"].name),r!=null&&r.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const c=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(c.redirect_to=r.redirectTo);const f=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",p=await d4(t,e,n+f,{headers:o,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(p):{data:Object.assign({},p),error:null}}async function d4(t,e,n,r,a,o){const c=u4(e,r,a,o);let f;try{f=await t(n,Object.assign({},c))}catch(p){throw console.error(p),new hf(yr(p),0)}if(f.ok||await fx(f),r!=null&&r.noResolveJson)return f;try{return await f.json()}catch(p){await fx(p)}}function Mn(t){var e;let n=null;p4(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=JR(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function hx(t){const e=Mn(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function zs(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function f4(t){return{data:t,error:null}}function h4(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:o}=t,c=ji(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:o},p=Object.assign({},c);return{data:{properties:f,user:p},error:null}}function px(t){return t}function p4(t){return t.access_token&&t.refresh_token&&t.expires_in}const Ld=["global","local","others"];class m4{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=Tb(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Ld[0]){if(Ld.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ld.join(", ")}`);try{return await Re(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await Re(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:zs})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=ji(e,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await Re(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:h4,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Ne(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Re(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:zs})}catch(n){if(Ne(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,a,o,c,f,p;try{const h={nextPage:null,lastPage:0,total:0},x=await Re(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:px});if(x.error)throw x.error;const v=await x.json(),w=(c=x.headers.get("x-total-count"))!==null&&c!==void 0?c:0,_=(p=(f=x.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&p!==void 0?p:[];return _.length>0&&(_.forEach(E=>{const N=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),D=JSON.parse(E.split(";")[1].split("=")[1]);h[`${D}Page`]=N}),h.total=parseInt(w)),{data:Object.assign(Object.assign({},v),h),error:null}}catch(h){if(Ne(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){pi(e);try{return await Re(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:zs})}catch(n){if(Ne(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){pi(e);try{return await Re(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:zs})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){pi(e);try{return await Re(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:zs})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){pi(e.userId);try{const{data:n,error:r}=await Re(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(Ne(n))return{data:null,error:n};throw n}}async _deleteFactor(e){pi(e.userId),pi(e.id);try{return{data:await Re(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Ne(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,a,o,c,f,p;try{const h={nextPage:null,lastPage:0,total:0},x=await Re(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:px});if(x.error)throw x.error;const v=await x.json(),w=(c=x.headers.get("x-total-count"))!==null&&c!==void 0?c:0,_=(p=(f=x.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&p!==void 0?p:[];return _.length>0&&(_.forEach(E=>{const N=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),D=JSON.parse(E.split(";")[1].split("=")[1]);h[`${D}Page`]=N}),h.total=parseInt(w)),{data:Object.assign(Object.assign({},v),h),error:null}}catch(h){if(Ne(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await Re(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ne(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Re(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ne(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Re(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ne(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await Re(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ne(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Re(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ne(n))return{data:null,error:n};throw n}}}function mx(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const mi={debug:!!(globalThis&&Eb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Nb extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class g4 extends Nb{}async function y4(t,e,n){mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),mi.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await n()}finally{mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(e===0)throw mi.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new g4(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(mi.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function x4(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Cb(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function v4(t){return parseInt(t,16)}function b4(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function w4(t){var e;const{chainId:n,domain:r,expirationTime:a,issuedAt:o=new Date,nonce:c,notBefore:f,requestId:p,resources:h,scheme:x,uri:v,version:w}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(w!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${w}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const _=Cb(t.address),E=x?`${x}://${r}`:r,N=t.statement?`${t.statement}
`:"",D=`${E} wants you to sign in with your Ethereum account:
${_}

${N}`;let k=`URI: ${v}
Version: ${w}
Chain ID: ${n}${c?`
Nonce: ${c}`:""}
Issued At: ${o.toISOString()}`;if(a&&(k+=`
Expiration Time: ${a.toISOString()}`),f&&(k+=`
Not Before: ${f.toISOString()}`),p&&(k+=`
Request ID: ${p}`),h){let U=`
Resources:`;for(const A of h){if(!A||typeof A!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${A}`);U+=`
- ${A}`}k+=U}return`${D}
${k}`}class wt extends Error{constructor({message:e,code:n,cause:r,name:a}){var o;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(o=a??(r instanceof Error?r.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=n}}class ql extends wt{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function _4({error:t,options:e}){var n,r,a;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new wt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=o.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new wt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new wt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=o.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new wt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new wt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new wt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return o.pubKeyCredParams.filter(f=>f.type==="public-key").length===0?new wt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new wt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const c=window.location.hostname;if(Ab(c)){if(o.rp.id!==c)return new wt({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new wt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new wt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new wt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new wt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function S4({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new wt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new wt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(Ab(r)){if(n.rpId!==r)return new wt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new wt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new wt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new wt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class E4{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const T4=new E4;function N4(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,a=ji(t,["challenge","user","excludeCredentials"]),o=Ni(e).buffer,c=Object.assign(Object.assign({},n),{id:Ni(n.id).buffer}),f=Object.assign(Object.assign({},a),{challenge:o,user:c});if(r&&r.length>0){f.excludeCredentials=new Array(r.length);for(let p=0;p<r.length;p++){const h=r[p];f.excludeCredentials[p]=Object.assign(Object.assign({},h),{id:Ni(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return f}function C4(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=ji(t,["challenge","allowCredentials"]),a=Ni(e).buffer,o=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){o.allowCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const f=n[c];o.allowCredentials[c]=Object.assign(Object.assign({},f),{id:Ni(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return o}function A4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:_r(new Uint8Array(t.response.attestationObject)),clientDataJSON:_r(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function I4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:_r(new Uint8Array(a.authenticatorData)),clientDataJSON:_r(new Uint8Array(a.clientDataJSON)),signature:_r(new Uint8Array(a.signature)),userHandle:a.userHandle?_r(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Ab(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function gx(){var t,e;return!!(Ut()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function R4(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new ql("Browser returned unexpected credential type",e)}:{data:null,error:new ql("Empty credential response",e)}}catch(e){return{data:null,error:_4({error:e,options:t})}}}async function D4(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new ql("Browser returned unexpected credential type",e)}:{data:null,error:new ql("Empty credential response",e)}}catch(e){return{data:null,error:S4({error:e,options:t})}}}const M4={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},P4={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Bl(...t){const e=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of t)if(a)for(const o in a){const c=a[o];if(c!==void 0)if(Array.isArray(c))r[o]=c;else if(n(c))r[o]=c;else if(e(c)){const f=r[o];e(f)?r[o]=Bl(f,c):r[o]=Bl(c)}else r[o]=c}return r}function k4(t,e){return Bl(M4,t,e||{})}function U4(t,e){return Bl(P4,t,e||{})}class j4{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:a},o){try{const{data:c,error:f}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!c)return{data:null,error:f};const p=a??T4.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:h}=c.webauthn.credential_options.publicKey;h.name||(h.name=`${h.id}:${r}`),h.displayName||(h.displayName=h.name)}switch(c.webauthn.type){case"create":{const h=k4(c.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:x,error:v}=await R4({publicKey:h,signal:p});return x?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:x}},error:null}:{data:null,error:v}}case"request":{const h=U4(c.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:x,error:v}=await D4(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:h,signal:p}));return x?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:x}},error:null}:{data:null,error:v}}}}catch(c){return Ne(c)?{data:null,error:c}:{data:null,error:new br("Unexpected error in challenge",c)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!n)return{data:null,error:new Ba("rpId is required for WebAuthn authentication")};try{if(!gx())return{data:null,error:new br("Browser does not support WebAuthn",null)};const{data:c,error:f}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:o});if(!c)return{data:null,error:f};const{webauthn:p}=c;return this._verify({factorId:e,challengeId:c.challengeId,webauthn:{type:p.type,rpId:n,rpOrigins:r,credential_response:p.credential_response}})}catch(c){return Ne(c)?{data:null,error:c}:{data:null,error:new br("Unexpected error in authenticate",c)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!n)return{data:null,error:new Ba("rpId is required for WebAuthn registration")};try{if(!gx())return{data:null,error:new br("Browser does not support WebAuthn",null)};const{data:c,error:f}=await this._enroll({friendlyName:e});if(!c)return await this.client.mfa.listFactors().then(x=>{var v;return(v=x.data)===null||v===void 0?void 0:v.all.find(w=>w.factor_type==="webauthn"&&w.friendly_name===e&&w.status!=="unverified")}).then(x=>x?this.client.mfa.unenroll({factorId:x==null?void 0:x.id}):void 0),{data:null,error:f};const{data:p,error:h}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:o});return p?this._verify({factorId:c.id,challengeId:p.challengeId,webauthn:{rpId:n,rpOrigins:r,type:p.webauthn.type,credential_response:p.webauthn.credential_response}}):{data:null,error:h}}catch(c){return Ne(c)?{data:null,error:c}:{data:null,error:new br("Unexpected error in register",c)}}}}x4();const O4={url:PR,storageKey:kR,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:UR,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function yx(t,e,n){return await n()}const gi={};class Va{get jwks(){var e,n;return(n=(e=gi[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){gi[this.storageKey]=Object.assign(Object.assign({},gi[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=gi[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){gi[this.storageKey]=Object.assign(Object.assign({},gi[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},O4),e);if(this.storageKey=o.storageKey,this.instanceID=(n=Va.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,Va.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&Ut()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new m4({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Tb(o.fetch),this.lock=o.lock||yx,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:Ut()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=y4:this.lock=yx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new j4(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Eb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=mx(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=mx(this.memoryStorage)),Ut()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c),await this._notifyAllSubscribers(c.data.event,c.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${wb}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Ut()&&(n=KR(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Ut()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:o}=await this._getSessionFromURL(n,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),VR(o)){const p=(e=o.details)===null||e===void 0?void 0:e.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:c,redirectType:f}=a;return this._debug("#_initialize()","detected session in URL",c,"redirect type",f),await this._saveSession(c),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Ne(n)?this._returnResult({error:n}):this._returnResult({error:new br("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,a;try{const o=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e==null?void 0:e.options)===null||a===void 0?void 0:a.captchaToken}},xform:Mn}),{data:c,error:f}=o;if(f||!c)return this._returnResult({data:{user:null,session:null},error:f});const p=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(o){if(Ne(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var n,r,a;try{let o;if("email"in e){const{email:x,password:v,options:w}=e;let _=null,E=null;this.flowType==="pkce"&&([_,E]=await hi(this.storage,this.storageKey)),o=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:w==null?void 0:w.emailRedirectTo,body:{email:x,password:v,data:(n=w==null?void 0:w.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},code_challenge:_,code_challenge_method:E},xform:Mn})}else if("phone"in e){const{phone:x,password:v,options:w}=e;o=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:x,password:v,data:(r=w==null?void 0:w.data)!==null&&r!==void 0?r:{},channel:(a=w==null?void 0:w.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken}},xform:Mn})}else throw new _l("You must provide either an email or phone number and a password");const{data:c,error:f}=o;if(f||!c)return this._returnResult({data:{user:null,session:null},error:f});const p=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(o){if(Ne(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let n;if("email"in e){const{email:o,password:c,options:f}=e;n=await Re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:c,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:hx})}else if("phone"in e){const{phone:o,password:c,options:f}=e;n=await Re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:c,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:hx})}else throw new _l("You must provide either an email or phone number and a password");const{data:r,error:a}=n;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!r||!r.session||!r.user){const o=new fi;return this._returnResult({data:{user:null,session:null},error:o})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(Ne(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,a,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,a,o,c,f,p,h,x,v,w;let _,E;if("message"in e)_=e.message,E=e.signature;else{const{chain:N,wallet:D,statement:k,options:U}=e;let A;if(Ut())if(typeof D=="object")A=D;else{const J=window;if("ethereum"in J&&typeof J.ethereum=="object"&&"request"in J.ethereum&&typeof J.ethereum.request=="function")A=J.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof D!="object"||!(U!=null&&U.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");A=D}const I=new URL((n=U==null?void 0:U.url)!==null&&n!==void 0?n:window.location.href),P=await A.request({method:"eth_requestAccounts"}).then(J=>J).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!P||P.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const B=Cb(P[0]);let H=(r=U==null?void 0:U.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!H){const J=await A.request({method:"eth_chainId"});H=v4(J)}const Q={domain:I.host,address:B,statement:k,uri:I.href,version:"1",chainId:H,nonce:(a=U==null?void 0:U.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(c=(o=U==null?void 0:U.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(f=U==null?void 0:U.signInWithEthereum)===null||f===void 0?void 0:f.expirationTime,notBefore:(p=U==null?void 0:U.signInWithEthereum)===null||p===void 0?void 0:p.notBefore,requestId:(h=U==null?void 0:U.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(x=U==null?void 0:U.signInWithEthereum)===null||x===void 0?void 0:x.resources};_=w4(Q),E=await A.request({method:"personal_sign",params:[b4(_),B]})}try{const{data:N,error:D}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:_,signature:E},!((v=e.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(w=e.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Mn});if(D)throw D;if(!N||!N.session||!N.user){const k=new fi;return this._returnResult({data:{user:null,session:null},error:k})}return N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),this._returnResult({data:Object.assign({},N),error:D})}catch(N){if(Ne(N))return this._returnResult({data:{user:null,session:null},error:N});throw N}}async signInWithSolana(e){var n,r,a,o,c,f,p,h,x,v,w,_;let E,N;if("message"in e)E=e.message,N=e.signature;else{const{chain:D,wallet:k,statement:U,options:A}=e;let I;if(Ut())if(typeof k=="object")I=k;else{const B=window;if("solana"in B&&typeof B.solana=="object"&&("signIn"in B.solana&&typeof B.solana.signIn=="function"||"signMessage"in B.solana&&typeof B.solana.signMessage=="function"))I=B.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof k!="object"||!(A!=null&&A.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");I=k}const P=new URL((n=A==null?void 0:A.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in I&&I.signIn){const B=await I.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},A==null?void 0:A.signInWithSolana),{version:"1",domain:P.host,uri:P.href}),U?{statement:U}:null));let H;if(Array.isArray(B)&&B[0]&&typeof B[0]=="object")H=B[0];else if(B&&typeof B=="object"&&"signedMessage"in B&&"signature"in B)H=B;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in H&&"signature"in H&&(typeof H.signedMessage=="string"||H.signedMessage instanceof Uint8Array)&&H.signature instanceof Uint8Array)E=typeof H.signedMessage=="string"?H.signedMessage:new TextDecoder().decode(H.signedMessage),N=H.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in I)||typeof I.signMessage!="function"||!("publicKey"in I)||typeof I!="object"||!I.publicKey||!("toBase58"in I.publicKey)||typeof I.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${P.host} wants you to sign in with your Solana account:`,I.publicKey.toBase58(),...U?["",U,""]:[""],"Version: 1",`URI: ${P.href}`,`Issued At: ${(a=(r=A==null?void 0:A.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((o=A==null?void 0:A.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${A.signInWithSolana.notBefore}`]:[],...!((c=A==null?void 0:A.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${A.signInWithSolana.expirationTime}`]:[],...!((f=A==null?void 0:A.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${A.signInWithSolana.chainId}`]:[],...!((p=A==null?void 0:A.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${A.signInWithSolana.nonce}`]:[],...!((h=A==null?void 0:A.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${A.signInWithSolana.requestId}`]:[],...!((v=(x=A==null?void 0:A.signInWithSolana)===null||x===void 0?void 0:x.resources)===null||v===void 0)&&v.length?["Resources",...A.signInWithSolana.resources.map(H=>`- ${H}`)]:[]].join(`
`);const B=await I.signMessage(new TextEncoder().encode(E),"utf8");if(!B||!(B instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=B}}try{const{data:D,error:k}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:_r(N)},!((w=e.options)===null||w===void 0)&&w.captchaToken?{gotrue_meta_security:{captcha_token:(_=e.options)===null||_===void 0?void 0:_.captchaToken}}:null),xform:Mn});if(k)throw k;if(!D||!D.session||!D.user){const U=new fi;return this._returnResult({data:{user:null,session:null},error:U})}return D.session&&(await this._saveSession(D.session),await this._notifyAllSubscribers("SIGNED_IN",D.session)),this._returnResult({data:Object.assign({},D),error:k})}catch(D){if(Ne(D))return this._returnResult({data:{user:null,session:null},error:D});throw D}}async _exchangeCodeForSession(e){const n=await mr(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{const{data:o,error:c}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Mn});if(await Gs(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!o||!o.session||!o.user){const f=new fi;return this._returnResult({data:{user:null,session:null,redirectType:null},error:f})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:c})}catch(o){if(Ne(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:n,provider:r,token:a,access_token:o,nonce:c}=e,f=await Re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:o,nonce:c,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Mn}),{data:p,error:h}=f;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!p||!p.session||!p.user){const x=new fi;return this._returnResult({data:{user:null,session:null},error:x})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:p,error:h})}catch(n){if(Ne(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,a,o,c;try{if("email"in e){const{email:f,options:p}=e;let h=null,x=null;this.flowType==="pkce"&&([h,x]=await hi(this.storage,this.storageKey));const{error:v}=await Re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},create_user:(r=p==null?void 0:p.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:h,code_challenge_method:x},redirectTo:p==null?void 0:p.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in e){const{phone:f,options:p}=e,{data:h,error:x}=await Re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(a=p==null?void 0:p.data)!==null&&a!==void 0?a:{},create_user:(o=p==null?void 0:p.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},channel:(c=p==null?void 0:p.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:x})}throw new _l("You must provide either an email or phone number.")}catch(f){if(Ne(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async verifyOtp(e){var n,r;try{let a,o;"options"in e&&(a=(n=e.options)===null||n===void 0?void 0:n.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:f}=await Re(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:Mn});if(f)throw f;if(!c)throw new Error("An error occurred on token verification.");const p=c.session,h=c.user;return p!=null&&p.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(a){if(Ne(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(e){var n,r,a,o,c;try{let f=null,p=null;this.flowType==="pkce"&&([f,p]=await hi(this.storage,this.storageKey));const h=await Re(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e==null?void 0:e.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:p}),headers:this.headers,xform:f4});return!((o=h.data)===null||o===void 0)&&o.url&&Ut()&&!(!((c=e.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(f){if(Ne(f))return this._returnResult({data:null,error:f});throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Dn;const{error:a}=await Re(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(e){if(Ne(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:o}=e,{error:c}=await Re(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in e){const{phone:r,type:a,options:o}=e,{data:c,error:f}=await Re(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:f})}throw new _l("You must provide either an email or phone number and a type")}catch(n){if(Ne(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await mr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<kd:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await mr(this.userStorage,this.storageKey+"-user");c!=null&&c.user?e.user=c.user:e.user=Od()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};e.user=l4(e.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:zs}):await this._useSession(async n=>{var r,a,o;const{data:c,error:f}=n;if(f)throw f;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Dn}:await Re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:zs})})}catch(n){if(Ne(n))return BR(n)&&(await this._removeSession(),await Gs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:a,error:o}=r;if(o)throw o;if(!a.session)throw new Dn;const c=a.session;let f=null,p=null;this.flowType==="pkce"&&e.email!=null&&([f,p]=await hi(this.storage,this.storageKey));const{data:h,error:x}=await Re(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:f,code_challenge_method:p}),jwt:c.access_token,xform:zs});if(x)throw x;return c.user=h.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(r){if(Ne(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Dn;const n=Date.now()/1e3;let r=n,a=!0,o=null;const{payload:c}=jd(e.access_token);if(c.exp&&(r=c.exp,a=r<=n),a){const{data:f,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!f)return{data:{user:null,session:null},error:null};o=f}else{const{data:f,error:p}=await this._getUser(e.access_token);if(p)throw p;o={access_token:e.access_token,refresh_token:e.refresh_token,user:f.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(n){if(Ne(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:c,error:f}=n;if(f)throw f;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Dn;const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Ne(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Ut())throw new Sl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Sl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new ax("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Sl("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ax("No code detected.");const{data:U,error:A}=await this._exchangeCodeForSession(e.code);if(A)throw A;const I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:U.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:o,refresh_token:c,expires_in:f,expires_at:p,token_type:h}=e;if(!o||!f||!c||!h)throw new Sl("No session defined in URL");const x=Math.round(Date.now()/1e3),v=parseInt(f);let w=x+v;p&&(w=parseInt(p));const _=w-x;_*1e3<=xi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${_}s, should have been closer to ${v}s`);const E=w-v;x-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,w,x):x-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,w,x);const{data:N,error:D}=await this._getUser(o);if(D)throw D;const k={provider_token:r,provider_refresh_token:a,access_token:o,expires_in:v,expires_at:w,refresh_token:c,token_type:h,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:k,redirectType:e.type},error:null})}catch(r){if(Ne(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await mr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({error:o});const c=(r=a.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:f}=await this.admin.signOut(c,e);if(f&&!(qR(f)&&(f.status===404||f.status===401||f.status===403)))return this._returnResult({error:f})}return e!=="others"&&(await this._removeSession(),await Gs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=YR(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,a;try{const{data:{session:o},error:c}=n;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await hi(this.storage,this.storageKey,!0));try{return await Re(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(o){if(Ne(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Ne(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:a}=await this._useSession(async o=>{var c,f,p,h,x;const{data:v,error:w}=o;if(w)throw w;const _=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(f=e.options)===null||f===void 0?void 0:f.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await Re(this.fetch,"GET",_,{headers:this.headers,jwt:(x=(h=v.session)===null||h===void 0?void 0:h.access_token)!==null&&x!==void 0?x:void 0})});if(a)throw a;return Ut()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Ne(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:o}}=n;if(a)throw a;const{options:c,provider:f,token:p,access_token:h,nonce:x}=e,v=await Re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=o==null?void 0:o.access_token)!==null&&r!==void 0?r:void 0,body:{provider:f,id_token:p,access_token:h,nonce:x,link_identity:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Mn}),{data:w,error:_}=v;return _?this._returnResult({data:{user:null,session:null},error:_}):!w||!w.session||!w.user?this._returnResult({data:{user:null,session:null},error:new fi}):(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("USER_UPDATED",w.session)),this._returnResult({data:w,error:_}))}catch(a){if(Ne(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,a;const{data:o,error:c}=n;if(c)throw c;return await Re(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(Ne(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await WR(async a=>(a>0&&await XR(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await Re(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Mn})),(a,o)=>{const c=200*Math.pow(2,a);return o&&Ud(o)&&Date.now()+c-r<xi})}catch(r){if(this._debug(n,"error",r),Ne(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Ut()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await mr(this.storage,this.storageKey);if(a&&this.userStorage){let c=await mr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:a.user},await vi(this.userStorage,this.storageKey+"-user",c)),a.user=(e=c==null?void 0:c.user)!==null&&e!==void 0?e:Od()}else if(a&&!a.user&&!a.user){const c=await mr(this.storage,this.storageKey+"-user");c&&(c!=null&&c.user)?(a.user=c.user,await Gs(this.storage,this.storageKey+"-user"),await vi(this.storage,this.storageKey,a)):a.user=Od()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const o=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<kd;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${kd}s`),o){if(this.autoRefreshToken&&a.refresh_token){const{error:c}=await this._callRefreshToken(a.refresh_token);c&&(console.error(c),Ud(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:f}=await this._getUser(a.access_token);!f&&(c!=null&&c.user)?(a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Dn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Xl;const{data:o,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!o.session)throw new Dn;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const f={data:o.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(o){if(this._debug(a,"error",o),Ne(o)){const c={data:null,error:o};return Ud(o)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,n,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const o=[],c=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(e,n)}catch(p){o.push(p)}});if(await Promise.all(c),o.length>0){for(let f=0;f<o.length;f+=1)console.error(o[f]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await vi(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const o=dx(a);await vi(this.storage,this.storageKey,o)}else{const a=dx(n);await vi(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await Gs(this.storage,this.storageKey),await Gs(this.storage,this.storageKey+"-code-verifier"),await Gs(this.storage,this.storageKey+"-user"),this.userStorage&&await Gs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ut()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),xi);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/xi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${xi}ms, refresh threshold is ${df} ticks`),a<=df&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Nb)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ut()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,c]=await hi(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(c)}`});a.push(f.toString())}if(r!=null&&r.queryParams){const o=new URLSearchParams(r.queryParams);a.push(o.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;return o?this._returnResult({data:null,error:o}):await Re(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Ne(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,a;const{data:o,error:c}=n;if(c)return this._returnResult({data:null,error:c});const f=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:p,error:h}=await Re(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(r=o==null?void 0:o.session)===null||r===void 0?void 0:r.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&p.type==="totp"&&(!((a=p==null?void 0:p.totp)===null||a===void 0)&&a.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),this._returnResult({data:p,error:null}))})}catch(n){if(Ne(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({data:null,error:o});const c=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?A4(e.webauthn.credential_response):I4(e.webauthn.credential_response)})}:{code:e.code}),{data:f,error:p}=await Re(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:c,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return p?this._returnResult({data:null,error:p}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),this._returnResult({data:f,error:p}))})}catch(n){if(Ne(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({data:null,error:o});const c=await Re(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});if(c.error)return c;const{data:f}=c;if(f.type!=="webauthn")return{data:f,error:null};switch(f.webauthn.type){case"create":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:N4(f.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:C4(f.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Ne(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])a.all.push(o),o.status==="verified"&&a[o.factor_type].push(o);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=jd(r.access_token);let c=null;o.aal&&(c=o.aal);let f=c;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(x=>x.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(f="aal2");const h=o.amr||[];return{data:{currentLevel:c,nextLevel:f,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?await Re(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Dn})})}catch(n){if(Ne(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new Dn});const c=await Re(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:f=>({data:f,error:null})});return c.data&&c.data.redirect_url&&Ut()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(r){if(Ne(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new Dn});const c=await Re(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:f=>({data:f,error:null})});return c.data&&c.data.redirect_url&&Ut()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(r){if(Ne(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(f=>f.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(f=>f.kid===e),r&&this.jwks_cached_at+OR>a)return r;const{data:o,error:c}=await Re(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=a,r=o.keys.find(f=>f.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:_,error:E}=await this.getSession();if(E||!_.session)return this._returnResult({data:null,error:E});r=_.session.access_token}const{header:a,payload:o,signature:c,raw:{header:f,payload:p}}=jd(r);n!=null&&n.allowExpired||i4(o.exp);const h=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!h){const{error:_}=await this.getUser(r);if(_)throw _;return{data:{claims:o,header:a,signature:c},error:null}}const x=a4(a.alg),v=await crypto.subtle.importKey("jwk",h,x,!0,["verify"]);if(!await crypto.subtle.verify(x,v,c,$R(`${f}.${p}`)))throw new pf("Invalid JWT signature");return{data:{claims:o,header:a,signature:c},error:null}}catch(r){if(Ne(r))return this._returnResult({data:null,error:r});throw r}}}Va.nextInstanceID={};const L4=Va;class q4 extends L4{constructor(e){super(e)}}class B4{constructor(e,n,r){var a,o,c;this.supabaseUrl=e,this.supabaseKey=n;const f=MR(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const p=`sb-${f.hostname.split(".")[0]}-auth-token`,h={db:ER,realtime:NR,auth:Object.assign(Object.assign({},TR),{storageKey:p}),global:SR},x=DR(r??{},h);this.storageKey=(a=x.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=x.global.headers)!==null&&o!==void 0?o:{},x.accessToken?(this.accessToken=x.accessToken,this.auth=new Proxy({},{get:(v,w)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(w)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=x.auth)!==null&&c!==void 0?c:{},this.headers,x.global.fetch),this.fetch=IR(n,this._getAccessToken.bind(this),x.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},x.realtime)),this.accessToken&&this.accessToken().then(v=>this.realtime.setAuth(v)).catch(v=>console.warn("Failed to set initial Realtime auth token:",v)),this.rest=new PI(new URL("rest/v1",f).href,{headers:this.headers,schema:x.db.schema,fetch:this.fetch}),this.storage=new bR(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),x.accessToken||this._listenForAuthEvents()}get functions(){return new II(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:o,storageKey:c,flowType:f,lock:p,debug:h,throwOnError:x},v,w){const _={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new q4({url:this.authUrl.href,headers:Object.assign(Object.assign({},_),v),storageKey:c,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:o,flowType:f,lock:p,debug:h,throwOnError:x,fetch:w,hasCustomAuthorizationHeader:Object.keys(this.headers).some(E=>E.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new QI(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const V4=(t,e,n)=>new B4(t,e,n);function G4(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}G4()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const H4="https://xzlqxctmgygpghaubsvt.supabase.co",z4="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6bHF4Y3RtZ3lncGdoYXVic3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxODk3MDUsImV4cCI6MjA3ODc2NTcwNX0.SJKSgc4fwoS9mLamnU75DNmxilBqho-Hi6OgZWEgiO4";let Ib=null;Ib=V4(H4,z4,{auth:{persistSession:!1}});const ps=Ib,xx={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var vx={};const F4="simulated_local",$4=F4==="simulated_local",Er=(t,e)=>{const n=typeof import.meta<"u"&&xx?xx[t]:void 0,r=typeof process<"u"&&vx?vx[t]:void 0;return(n??r??e??"").toString()},fs=(()=>{const t=Er("VITE_ENABLE_DAN","false").toLowerCase();return t==="1"||t==="true"||t==="yes"})(),J4=Er("VITE_DAN_DERIVATION_SALT","dan-dev-salt");Er("VITE_DAN_REALTIME_CHANNEL","dan_events");const Y4=Er("VITE_SUPABASE_URL",Er("SUPABASE_URL","")),K4=Er("VITE_SUPABASE_ANON_KEY",Er("SUPABASE_ANON_KEY",""));fs&&(!Y4||!K4)&&console.warn("[Config] DAN is enabled but Supabase credentials are missing. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY (or SUPABASE_URL/SUPABASE_ANON_KEY) in your environment.");const Rb="dan:keypairs:v1",Vl="dan:event-buffer:v1",Db=()=>typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null,Yf=(t,e)=>{const n=Db();if(!n)return e;try{const r=n.getItem(t);return r?JSON.parse(r):e}catch{return e}},Kf=(t,e)=>{const n=Db();if(n)try{n.setItem(t,JSON.stringify(e))}catch{}},Q4=t=>Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join(""),X4=()=>{if(typeof globalThis>"u")return null;const t=globalThis.crypto;return t&&t.subtle?t.subtle:null},Gl=async t=>{const e=X4();if(!e){let a=0;for(let o=0;o<t.length;o+=1)a=(a<<5)-a+t.charCodeAt(o),a|=0;return`fallback-${Math.abs(a).toString(16)}`}const n=new TextEncoder().encode(t),r=await e.digest("SHA-256",n);return Q4(r)},Wl=async t=>{const e=typeof t=="string"?t:JSON.stringify(t??{});return Gl(e)},W4=async t=>{const e=`${t}:${$a||"global"}:${J4}`,n=await Gl(`${e}:private`),r=await Gl(`${n}:public`),a=r.slice(0,16);return{publicKey:r,fingerprint:a,derivedAt:new Date().toISOString(),privateKey:n}},Mb=()=>Yf(Rb,{}),Z4=t=>Kf(Rb,t),eD=t=>Mb()[t]||null,Pb=(t,e)=>{const n=Mb();n[t]=e,Z4(n)},tD=async(t,e)=>{if(!ps)return!1;try{const n=new Date().toISOString(),{error:r}=await ps.from("dan_keys").upsert({shop_id:t,namespace:$a,public_key:e.publicKey,fingerprint:e.fingerprint,capability_scope:["local","dan"],last_seen_at:n},{onConflict:"shop_id"});return r?(console.warn("[DAN] Failed to register key with control plane",r),!1):(Pb(t,{...e,lastRegisteredAt:n}),!0)}catch(n){return console.warn("[DAN] Error registering key",n),!1}},nD=async()=>{const t=ue;if(!t||!fs)return null;let e=eD(t);return e||(e=await W4(t),Pb(t,e)),ps&&await tD(t,e),e},sD=async()=>{if(!ps)return;const t=Yf(Vl,[]);if(t.length)try{const e=t.map(r=>({event_id:r.eventId,shop_id:r.shopId,namespace:r.namespace,event_type:r.eventType,payload:r.payload,share_scope:r.shareScope,vector_context:r.vectorContext,proofs:r.proofs,actor_public_key:r.actor.publicKey,actor_fingerprint:r.actor.fingerprint,actor_signature:r.actor.signature,created_at:r.createdAt})),{error:n}=await ps.from("dan_events").insert(e);n||Kf(Vl,[])}catch(e){console.warn("[DAN] Failed to flush buffered events",e)}},Qf=t=>{const e=new Set(["local"]);return(t||[]).forEach(n=>{n&&e.add(n)}),Array.from(e)},rD=t=>Qf(t).includes("dan"),kb=()=>fs,qd=t=>{const e=Yf(Vl,[]);e.push(t),Kf(Vl,e)},Xf=async t=>{if(!fs)return null;const e=ue;if(!e)return null;const n=await nD();if(!n)return null;const r=Qf(t.shareScope),a=JSON.parse(JSON.stringify(t.payload||{})),o=await Wl(a),c=await Gl(`${n.privateKey}:${o}`),f={eventId:ht(),eventType:t.eventType,shopId:e,namespace:$a||null,payload:a,shareScope:r,vectorContext:t.vectorContext||null,proofs:{...t.proofs||{},hash:o},actor:{publicKey:n.publicKey,fingerprint:n.fingerprint,signature:c},createdAt:new Date().toISOString()};if(await sD(),!ps)return qd(f),f;try{const{error:p}=await ps.from("dan_events").insert({event_id:f.eventId,shop_id:f.shopId,namespace:f.namespace,event_type:f.eventType,payload:f.payload,share_scope:f.shareScope,vector_context:f.vectorContext,proofs:f.proofs,actor_public_key:f.actor.publicKey,actor_fingerprint:f.actor.fingerprint,actor_signature:f.actor.signature,created_at:f.createdAt});p&&(console.warn("[DAN] Failed to send event to Supabase, buffering",p),qd(f))}catch(p){console.warn("[DAN] Error publishing event, buffering instead",p),qd(f)}return f},Ub="dan:policies:v1",jb="dan:policy-runs:v1",Ob=()=>typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null,Lb=(t,e)=>{const n=Ob();if(!n)return e;try{const r=n.getItem(t);return r?JSON.parse(r):e}catch{return e}},qb=(t,e)=>{const n=Ob();if(n)try{n.setItem(t,JSON.stringify(e))}catch{}},Bb=()=>Lb(Ub,{}),iD=t=>qb(Ub,t),aD=()=>Lb(jb,{}),oD=t=>qb(jb,t),Vb=async(t,e)=>{var a;const n=Bb();if((a=n[t])!=null&&a.length)return;const r={id:ht(),shopId:t,name:"Auto-flag low inventory offers",description:"Warns when a DAN offer is created with quantity below 10 units so the shop can replenish locally before sharing.",eventType:"inventory.offer.created",scope:"inventory",version:"1.0",enabled:!0,conditions:[{field:"quantity",operator:"lt",value:10},{field:"shareScope",operator:"includes",value:"dan"}],actions:[{type:"notify",params:{message:"DAN offer shared while stock is below 10 units. Confirm replenishment or adjust sharing scope."}},{type:"create_dan_event",params:{trigger:"policy.auto-alert",shopName:e||"unknown shop"}}],author:"system",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};n[t]=[r],iD(n)},bx=async t=>{const e=t||ue;return e?Bb()[e]||[]:[]},lD=t=>{const e=aD(),n=e[t.shopId]||[];n.unshift(t),e[t.shopId]=n.slice(0,50),oD(e)},cD=(t,e)=>e.split(".").reduce((n,r)=>{if(n&&typeof n=="object"&&r in n)return n[r]},t),uD=(t,e)=>{const n=cD(e,t.field),r=t.value;switch(t.operator){case"eq":return n===r;case"neq":return n!==r;case"gt":return typeof n=="number"&&n>Number(r);case"gte":return typeof n=="number"&&n>=Number(r);case"lt":return typeof n=="number"&&n<Number(r);case"lte":return typeof n=="number"&&n<=Number(r);case"includes":case"contains":return Array.isArray(n)?n.includes(r):typeof n=="string"?n.toLowerCase().includes(String(r).toLowerCase()):!1;default:return!1}},dD=async(t,e,n)=>{var r,a,o;switch(t.type){case"notify":{const c=((r=t.params)==null?void 0:r.message)||`Policy "${e.name}" triggered for event ${n.eventType}`;console.info(`[PolicyEngine] ${c}`,{policyId:e.id,payload:n.payload});break}case"create_dan_event":{await Xf({eventType:"policy.trigger.executed",payload:{policyId:e.id,policyName:e.name,scope:e.scope,trigger:((a=t.params)==null?void 0:a.trigger)||"policy.action",eventPayload:n.payload}});break}case"tag_inventory":{console.debug("[PolicyEngine] tag_inventory action queued",{policyId:e.id,params:t.params});break}case"call_webhook":{const c=(o=t.params)==null?void 0:o.url;if(!c||typeof fetch>"u")break;try{await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({policyId:e.id,policyName:e.name,payload:n.payload})})}catch(f){console.warn("[PolicyEngine] call_webhook failed",f)}break}default:console.warn("[PolicyEngine] Unknown action type",t.type)}},Gb=async t=>{var o,c,f;const e=((o=t.payload)==null?void 0:o.shopId)||ue||((f=(c=t.payload)==null?void 0:c.shop)==null?void 0:f.id)||null;if(!e)return;(await bx(e)).length||await Vb(e,Pi);const a=(await bx(e)).filter(p=>p.enabled&&p.eventType===t.eventType);if(a.length)for(const p of a){const h=p.conditions.every(v=>uD(v,t.payload)),x={id:ht(),policyId:p.id,shopId:e,eventType:t.eventType,eventPayload:t.payload,outcome:h?"triggered":"skipped",notes:h?`Policy ${p.name} triggered`:"Condition check failed",createdAt:new Date().toISOString()};if(h)try{for(const v of p.actions)await dD(v,p,t)}catch(v){x.outcome="error",x.notes=`Action error: ${(v==null?void 0:v.message)||"unknown"}`}lD(x)}},Hb=()=>ue||null,fD=t=>{const e=Hb();return e?t.filter(n=>n.shopId===e):t},hD=t=>t.quantity>0&&t.status!=="EMPTY"&&t.status!=="EXPIRED"&&(!t.status||t.status==="ACTIVE"),zb=()=>{const t=Array.from(Ve.stockItems.values()).filter(hD);return fD(t)},Wf=t=>Qf(t),Zl=t=>kb()&&rD(t),pD=t=>t?t.split("T")[0]:new Date().toISOString().split("T")[0],Fb=t=>{if(!t)return null;const e=t.trim();if(!e)return null;const n=e.split(/[\s-]/)[0];return n?n.toUpperCase():null},mD=(t,e)=>{const n=Ve.products.get(t);return e||(n==null?void 0:n.name)||t},$b=t=>{for(const e of Ve.stockItems.values())if(e.inventoryUuid===t||e.qdrantId===t||String(e.id)===t)return e},gD=async(t,e,n)=>{if(Zl(e.shareScope||t.shareScope))try{const r=Wf(e.shareScope||t.shareScope),a={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:mD(t.productId,e.productName),quantity:t.quantity,expirationDate:pD(t.expirationDate),locationBucket:Fb(t.location),sellPrice:t.sellPrice??e.sellPrice??null,batchId:n.batchId,supplierId:t.supplierId||n.supplierId||null,supplierName:n.supplierName||null,shopId:t.shopId,shareScope:r},o=await Wl(a),c=await jn(`${a.productName} ${a.quantity} ${a.locationBucket||""}`);await Xf({eventType:"inventory.offer.created",payload:{...a,proofHash:o},shareScope:r,vectorContext:c,proofs:{hash:o,link:`qdrant://items/${t.inventoryUuid}`}}),await Gb({eventType:"inventory.offer.created",payload:{...a},proofs:{hash:o}}),await Pv({inventoryUuid:t.inventoryUuid,productId:t.productId,productName:a.productName,quantity:t.quantity,expirationDate:a.expirationDate,locationBucket:a.locationBucket,sellPrice:a.sellPrice??null,shopId:t.shopId,shopName:Pi,shareScope:r,proofHash:o,vector:c})}catch(r){console.warn("[DAN] Failed to publish inventory.offer.created",r)}},yD=async(t,e,n)=>{if(Zl(t.shareScope))try{const r=Wf(t.shareScope),a=Math.max((t.quantity||0)-n,0),o={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:e,fulfilledQuantity:n,remainingQuantity:a,saleTimestamp:new Date().toISOString(),batchId:t.batchId,shopId:t.shopId,shareScope:r},c=await Wl(o),f=await jn(`${o.productName} fulfilled ${n}`);await Xf({eventType:"inventory.offer.fulfilled",payload:{...o,proofHash:c},shareScope:r,vectorContext:f,proofs:{hash:c,link:`qdrant://items/${t.inventoryUuid}`}}),await Gb({eventType:"inventory.offer.fulfilled",payload:o,proofs:{hash:c}}),a<=0?await bI(t.inventoryUuid):await Pv({inventoryUuid:t.inventoryUuid,productId:t.productId,productName:e,quantity:a,expirationDate:t.expirationDate,locationBucket:Fb(t.location),sellPrice:t.sellPrice,shopId:t.shopId,shopName:Pi,shareScope:r,proofHash:c})}catch(r){console.warn("[DAN] Failed to publish inventory.offer.fulfilled",r)}},xD=async t=>{if(!kb())return;const e=Array.from(Ve.stockItems.values()).filter(n=>Zl(n.shareScope));if(e.length)for(const n of t){const r=Array.from(Ve.products.values()).find(o=>o.name.toLowerCase()===n.productName.toLowerCase());if(!r)continue;const a=e.find(o=>o.productId===r.id);a&&await yD(a,n.productName,n.quantity)}},ec=Ja,mf=yv,Jb=()=>wI(),Ga=t=>{const e=ue,n=(t==null?void 0:t.id)||null;By(n?{...t,id:n}:null),e!==n&&(Uv(),kv(!1),console.log(`[VectorDB] Shop context changed: ${e||"null"} -> ${n||"null"}, resetting initialization`))},tc=()=>Hb(),Yb=async()=>{if(console.log(`[VectorDB] initializeAndSeedDatabase called, _activeShopId: ${ue}, _initialized: ${Zd}`),!ue){console.warn("[VectorDB] initializeAndSeedDatabase: _activeShopId is not set, cannot initialize");return}if(Zd){console.log("[VectorDB] initializeAndSeedDatabase: Already initialized, skipping");return}console.log(`[VectorDB] Initializing database for shopId: ${ue}`),await uv(),await Ul(),console.log(`[VectorDB] After loadDataFromQdrant: ${Ve.products.size} products, ${Ve.stockItems.size} stock items`),Ve.products.size===0&&Ve.stockItems.size===0&&(console.log("[VectorDB] No data found, seeding local store..."),await vD(ue),await Ul(),console.log(`[VectorDB] After seeding: ${Ve.products.size} products, ${Ve.stockItems.size} stock items`)),await Vb(ue,Pi),kv(!0),console.log("[VectorDB] Database initialization complete")},vD=async t=>{const n=(await Ui({name:"Organic Foods Dist."})).id,r=[{supplier:"Organic Foods Dist.",deliveryDate:"2024-06-05",inventoryDate:"2024-06-05"}],a=[{batchIndex:0,productName:"Organic Oat Milk",manufacturer:"Oatly",category:"Beverages",expirationDate:"2024-12-15",quantity:50,quantityType:"cartons",costPerUnit:2.5,location:"Shelf A"}],o=[];r.forEach(c=>{const f=ht(),p={...c,id:f};Ve.batches.set(f,p),o.push(p)});for(const c of a){const f=o[c.batchIndex],p=ef(c.productName),h={id:p,name:c.productName,manufacturer:c.manufacturer,category:c.category};Ve.products.set(p,h),await ki({name:c.productName,manufacturer:c.manufacturer,category:c.category});const x=ht(),v={id:Date.now()+Math.random(),inventoryUuid:x,shopId:t,productId:p,batchId:f.id,expirationDate:c.expirationDate,quantity:c.quantity,costPerUnit:c.costPerUnit,location:c.location,supplierId:n||void 0,buyPrice:c.costPerUnit,sellPrice:c.costPerUnit*1.4,images:c.images,scanMetadata:c.scanMetadata||null,createdByUserId:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),qdrantId:x,status:"ACTIVE",shareScope:["local"]};Ve.stockItems.set(v.id,v),await Cr(v)}console.info(`[Data Service] Seeded starter data for shop ${t}`)},Ci=async(t,e)=>{if(!ue)throw new Error("No shop selected. Shop role/ID required.");await uv();let r=(await Ys()).find(v=>{var w;return v.name.toLowerCase()===((w=t.supplier)==null?void 0:w.toLowerCase())});!r&&t.supplier&&(r=await Ui({name:t.supplier}));const a=r==null?void 0:r.id;(await Ja()).forEach(v=>{Ve.products.has(v.id)||Ve.products.set(v.id,{id:v.id,name:v.name,manufacturer:v.manufacturer,category:v.category})});const c=new Map;for(const v of e){let w=Array.from(Ve.products.values()).find(_=>_.name.toLowerCase()===v.productName.toLowerCase());if(w)c.set(v.productName,w.id);else{const _=await ki({name:v.productName,manufacturer:v.manufacturer,category:v.category});Ve.products.set(_.id,{id:_.id,name:_.name,manufacturer:_.manufacturer,category:_.category}),c.set(v.productName,_.id)}}const f=ht(),p={...t,id:f};Ve.batches.set(f,p);const h=new Date().toISOString(),x={id:f,shopId:ue||"",supplierId:a||null,deliveryDate:t.deliveryDate||h.split("T")[0],inventoryDate:t.inventoryDate||t.deliveryDate||h.split("T")[0],invoiceNumber:void 0,documents:[],lineItems:e.map(v=>({productId:c.get(v.productName)||ef(v.productName),productName:v.productName,quantity:v.quantity||0,cost:v.buyPrice??v.costPerUnit??0})),createdAt:h,createdByUserId:ue||""};await Pf(x);for(const v of e){const w=c.get(v.productName)||ef(v.productName),_=ht(),E=Wf(v.shareScope),N=Zl(E),D={id:Date.now()+Math.random(),inventoryUuid:_,shopId:ue||"",productId:w,batchId:f,expirationDate:v.expirationDate,quantity:v.quantity,costPerUnit:v.costPerUnit,location:v.location,supplierId:v.supplierId||a||void 0,buyPrice:v.buyPrice??v.costPerUnit,sellPrice:v.sellPrice??void 0,images:v.images,scanMetadata:v.scanMetadata||null,createdByUserId:ue||void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),qdrantId:_,status:"ACTIVE",shareScope:E};N&&(D.shareProofHash=await Wl({inventoryUuid:_,productId:w,batchId:f,quantity:D.quantity})),Ve.stockItems.set(D.id,D),await Cr(D,D.scanMetadata||void 0),N&&await gD(D,v,{batchId:f,supplierId:D.supplierId,supplierName:t.supplier})}console.log(`[Data Service] Added batch ${p.id} with ${e.length} item types.`)},Kb=async(t,e)=>{if(!ue)throw new Error("No shop selected. Shop role/ID required.");const n=$b(t);if(!n)throw new Error(`Inventory item ${t} not found`);const r=e.quantity??n.quantity,a={...n,quantity:r,expirationDate:e.expirationDate??n.expirationDate,costPerUnit:e.costPerUnit??n.costPerUnit,buyPrice:e.buyPrice??e.costPerUnit??n.buyPrice??n.costPerUnit,sellPrice:e.sellPrice??n.sellPrice,location:e.location??n.location,updatedAt:new Date().toISOString(),status:r>0?"ACTIVE":"EMPTY"};return Ve.stockItems.set(a.id,a),await Cr(a),a},Qb=async t=>{if(!ue)throw new Error("No shop selected. Shop role/ID required.");const e=$b(t);if(!e)throw new Error(`Inventory item ${t} not found`);Ve.stockItems.delete(e.id),await Uf(e)},Zf=async t=>{if(!ue)throw new Error("No shop selected.");const e=new Map;for(const n of Ve.products.values())e.set(n.name,{id:n.id,name:n.name});await hI(t,e),await Ul(),await xD(t)},nc=async()=>_I(()=>Promise.resolve(zb()),Ys),Xb=async()=>Array.from(Ve.batches.values()),eh=async()=>zb(),Oa=async t=>{if(!ue)throw new Error("No shop selected.");const e=new Date().toISOString(),n={id:ht(),shopId:ue,supplierId:t.supplierId,deliveryDate:t.deliveryDate,inventoryDate:t.inventoryDate,invoiceNumber:t.invoiceNumber,documents:t.documents||[],lineItems:t.lineItems||[],createdAt:e,createdByUserId:ue};return await Pf(n),t.lineItems&&t.lineItems.length>0&&await Nv(n,t.lineItems),n},Wb=async(t,e)=>{await mI(t,e,async(n,r)=>{await Ci(n,r)},async n=>{await Of(n)}),await Ul()},bD=Object.freeze(Object.defineProperty({__proto__:null,get activeNamespace(){return $a},get activeShopId(){return ue},get activeShopName(){return Pi},addImageForField:Lf,addInventoryBatch:Ci,createBatchForShop:Oa,createCanonicalProduct:ki,createInventoryFromBatch:Nv,createShopNamespace:bv,deleteCanonicalProduct:gv,deleteInventoryEntry:Uf,fetchBatchRecords:vv,fetchCanonicalProducts:ec,fetchSuppliersForActiveShop:Ys,getActiveShopId:tc,getAllBatches:Xb,getAllSales:Av,getAllShops:Sv,getAllStockItems:eh,getBatchRecords:xv,getCanonicalProducts:Ja,getDanInventoryOffers:Jb,getLearnedFieldsForProduct:Mv,getMyMarketplaceListings:Rv,getProductSummaries:nc,initializeAndSeedDatabase:Yb,listProductOnMarketplace:Iv,persistInventoryEntry:Cr,persistSale:Of,purchaseFromMarketplace:Wb,recordSale:Zf,registerLocalSupplier:Ui,removeInventoryItem:Qb,searchCanonicalProducts:yv,searchCatalogProducts:mf,searchRelevantInventoryItems:jf,setActiveShopContext:Ga,updateCanonicalProduct:mv,updateInventoryItem:Kb,upsertBatchRecord:Pf,upsertCustomerRecord:_v,upsertDriverRecord:Kl,upsertProductDefinition:Mf,upsertShopRecord:wv,upsertSupplierProfile:kf,upsertUserProfile:Nr,validateShopExists:Ev},Symbol.toStringTag,{value:"Module"})),wD=async t=>{var e;(e=t.roles)!=null&&e.shop&&await Nr({userId:t.clientId,displayName:t.companyName,email:t.email,contactEmail:t.email,shopId:t.shopId||null,isVerified:!1})},_D=async t=>{var e;(e=t.roles)!=null&&e.driver&&(await Nr({userId:t.clientId,displayName:t.companyName,email:t.email,contactEmail:t.email,isDriverVerified:!1}),t.driverId&&await Kl({id:t.driverId,fullName:t.companyName,contactEmail:t.email,status:"pending",userId:t.clientId}))},SD=async(t,e)=>{if(!pe||!await tt("users"))return{isVerified:!0,isDriverVerified:!0};try{const n=Vt("users",t),r=await pe.retrieve("users",{ids:[n],with_payload:!0});if(r.points&&r.points.length>0){const a=r.points[0].payload;return{isVerified:e!=null&&e.requiresShopVerification?a.isVerified??!1:!0,isDriverVerified:e!=null&&e.requiresDriverVerification?a.isDriverVerified??!1:!0}}}catch(n){console.error("[Backend] Error fetching verification status:",n)}return{isVerified:!(e!=null&&e.requiresShopVerification),isDriverVerified:!(e!=null&&e.requiresDriverVerification)}},ED=async()=>{if(!pe||!await tt("users"))return[];try{return(await gt("users",null)).map(e=>{const n=e.payload;return n.shopId&&(n.isVerified===!1||n.isVerified===void 0)?{clientId:n.userId,companyName:n.displayName,contactPerson:n.displayName,address:"",email:n.email,role:"shop",isVerified:!1,isDriverVerified:n.isDriverVerified??!1,shopId:n.shopId,roles:{shop:!0,customer:!1,driver:!1,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching pending clients:",t),[]}},TD=async()=>{if(!pe||!await tt("users"))return[];try{return(await gt("users",null)).map(e=>{const n=e.payload;return n.shopId&&n.isVerified===!0?{clientId:n.userId,companyName:n.displayName,contactPerson:n.displayName,address:"",email:n.email,role:"shop",isVerified:!0,isDriverVerified:n.isDriverVerified??!1,shopId:n.shopId,roles:{shop:!0,customer:!1,driver:!1,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching verified clients:",t),[]}},ND=async()=>{if(!pe||!await tt("drivers"))return[];try{return(await gt("drivers",null)).map(e=>{const n=e.payload;return n.status==="pending"&&n.userId?{clientId:n.userId,companyName:n.name||"Driver",contactPerson:n.name||"Driver",address:"",email:n.contact||n.contactEmail||"",role:"driver",isVerified:!0,isDriverVerified:!1,driverId:n.driverId,roles:{shop:!1,customer:!1,driver:!0,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching pending drivers:",t),[]}},CD=async()=>{if(!pe||!await tt("drivers"))return[];try{return(await gt("drivers",null)).map(e=>{const n=e.payload;return n.status==="verified"&&n.userId?{clientId:n.userId,companyName:n.name||"Driver",contactPerson:n.name||"Driver",address:"",email:n.contact||n.contactEmail||"",role:"driver",isVerified:!0,isDriverVerified:!0,driverId:n.driverId,roles:{shop:!1,customer:!1,driver:!0,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching verified drivers:",t),[]}},AD=async t=>{if(!pe||!await tt("users")){console.warn("[Backend] Qdrant not available for verification");return}try{const e=Vt("users",t),n=await pe.retrieve("users",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;await Nr({userId:t,displayName:r.displayName,email:r.email,contactEmail:r.contactEmail,shopId:r.shopId,isVerified:!0,isDriverVerified:r.isDriverVerified}),console.log(`[Backend] Verified shop client: ${r.displayName}`)}else console.warn(`[Backend] User not found for verification: ${t}`)}catch(e){console.error("[Backend] Error verifying client:",e)}},ID=async t=>{if(!pe||!await tt("users")){console.warn("[Backend] Qdrant not available for driver verification");return}try{const e=Vt("users",t),n=await pe.retrieve("users",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;await Nr({userId:t,displayName:r.displayName,email:r.email,contactEmail:r.contactEmail,shopId:r.shopId,isVerified:r.isVerified,isDriverVerified:!0});const o=(await gt("drivers",null)).find(c=>c.payload.userId===t);if(o){const c=o.payload;await Kl({id:c.driverId,fullName:c.name||r.displayName,contactEmail:c.contact||c.contactEmail||r.email,status:"verified",userId:t})}console.log(`[Backend] Verified driver: ${r.displayName}`)}else console.warn(`[Backend] User not found for driver verification: ${t}`)}catch(e){console.error("[Backend] Error verifying driver:",e)}},RD=[{id:"peer_1",name:"Gourmet Goods",listings:[{listingId:"gg_1",productName:"Artisanal Cheese",manufacturer:"Cheese Masters",category:"Dairy",quantity:20,quantityType:"kg",price:25.5,seller:{id:"peer_1",name:"Gourmet Goods"}},{listingId:"gg_2",productName:"Truffle Oil",manufacturer:"Italian Imports",category:"Pantry",quantity:50,quantityType:"bottles",price:15,seller:{id:"peer_1",name:"Gourmet Goods"}}]},{id:"peer_2",name:"The Fresh Market",listings:[{listingId:"tfm_1",productName:"Organic Avocados",manufacturer:"Fresh Farms",category:"Produce",quantity:100,quantityType:"units",price:1.5,seller:{id:"peer_2",name:"The Fresh Market"}}]}],DD=async t=>{if(!t.isVerified)throw new Error("User is not verified.");return Promise.resolve(RD.filter(e=>e.id!==t.clientId))},MD=async(t,e)=>{console.log(`[Backend] Consuming listing ${t}, quantity: ${e}`)},PD={};var gf=null;function kD(t){try{return crypto.getRandomValues(new Uint8Array(t))}catch{}try{return PD.randomBytes(t)}catch{}if(!gf)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return gf(t)}function UD(t){gf=t}function th(t,e){if(t=t||nh,typeof t!="number")throw Error("Illegal arguments: "+typeof t+", "+typeof e);t<4?t=4:t>31&&(t=31);var n=[];return n.push("$2b$"),t<10&&n.push("0"),n.push(t.toString()),n.push("$"),n.push(Hl(kD(Ha),Ha)),n.join("")}function Zb(t,e,n){if(typeof e=="function"&&(n=e,e=void 0),typeof t=="function"&&(n=t,t=void 0),typeof t>"u")t=nh;else if(typeof t!="number")throw Error("illegal arguments: "+typeof t);function r(a){kn(function(){try{a(null,th(t))}catch(o){a(o)}})}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);r(n)}else return new Promise(function(a,o){r(function(c,f){if(c){o(c);return}a(f)})})}function ew(t,e){if(typeof e>"u"&&(e=nh),typeof e=="number"&&(e=th(e)),typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return yf(t,e)}function tw(t,e,n,r){function a(o){typeof t=="string"&&typeof e=="number"?Zb(e,function(c,f){yf(t,f,o,r)}):typeof t=="string"&&typeof e=="string"?yf(t,e,o,r):kn(o.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)))}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);a(n)}else return new Promise(function(o,c){a(function(f,p){if(f){c(f);return}o(p)})})}function nw(t,e){for(var n=t.length^e.length,r=0;r<t.length;++r)n|=t.charCodeAt(r)^e.charCodeAt(r);return n===0}function jD(t,e){if(typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return e.length!==60?!1:nw(ew(t,e.substring(0,e.length-31)),e)}function OD(t,e,n,r){function a(o){if(typeof t!="string"||typeof e!="string"){kn(o.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)));return}if(e.length!==60){kn(o.bind(this,null,!1));return}tw(t,e.substring(0,29),function(c,f){c?o(c):o(null,nw(f,e))},r)}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);a(n)}else return new Promise(function(o,c){a(function(f,p){if(f){c(f);return}o(p)})})}function LD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return parseInt(t.split("$")[2],10)}function qD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);if(t.length!==60)throw Error("Illegal hash length: "+t.length+" != 60");return t.substring(0,29)}function BD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return sw(t)>72}var kn=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function sw(t){for(var e=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?e+=1:n<2048?e+=2:(n&64512)===55296&&(t.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e}function VD(t){for(var e=0,n,r,a=new Array(sw(t)),o=0,c=t.length;o<c;++o)n=t.charCodeAt(o),n<128?a[e++]=n:n<2048?(a[e++]=n>>6|192,a[e++]=n&63|128):(n&64512)===55296&&((r=t.charCodeAt(o+1))&64512)===56320?(n=65536+((n&1023)<<10)+(r&1023),++o,a[e++]=n>>18|240,a[e++]=n>>12&63|128,a[e++]=n>>6&63|128,a[e++]=n&63|128):(a[e++]=n>>12|224,a[e++]=n>>6&63|128,a[e++]=n&63|128);return a}var yi="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),Hs=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function Hl(t,e){var n=0,r=[],a,o;if(e<=0||e>t.length)throw Error("Illegal len: "+e);for(;n<e;){if(a=t[n++]&255,r.push(yi[a>>2&63]),a=(a&3)<<4,n>=e){r.push(yi[a&63]);break}if(o=t[n++]&255,a|=o>>4&15,r.push(yi[a&63]),a=(o&15)<<2,n>=e){r.push(yi[a&63]);break}o=t[n++]&255,a|=o>>6&3,r.push(yi[a&63]),r.push(yi[o&63])}return r.join("")}function rw(t,e){var n=0,r=t.length,a=0,o=[],c,f,p,h,x,v;if(e<=0)throw Error("Illegal len: "+e);for(;n<r-1&&a<e&&(v=t.charCodeAt(n++),c=v<Hs.length?Hs[v]:-1,v=t.charCodeAt(n++),f=v<Hs.length?Hs[v]:-1,!(c==-1||f==-1||(x=c<<2>>>0,x|=(f&48)>>4,o.push(String.fromCharCode(x)),++a>=e||n>=r)||(v=t.charCodeAt(n++),p=v<Hs.length?Hs[v]:-1,p==-1)||(x=(f&15)<<4>>>0,x|=(p&60)>>2,o.push(String.fromCharCode(x)),++a>=e||n>=r)));)v=t.charCodeAt(n++),h=v<Hs.length?Hs[v]:-1,x=(p&3)<<6>>>0,x|=h,o.push(String.fromCharCode(x)),++a;var w=[];for(n=0;n<a;n++)w.push(o[n].charCodeAt(0));return w}var Ha=16,nh=10,GD=16,HD=100,wx=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],_x=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],iw=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function za(t,e,n,r){var a,o=t[e],c=t[e+1];return o^=n[0],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[1],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[2],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[3],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[4],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[5],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[6],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[7],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[8],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[9],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[10],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[11],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[12],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[13],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[14],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[15],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[16],t[e]=c^n[GD+1],t[e+1]=o,t}function bi(t,e){for(var n=0,r=0;n<4;++n)r=r<<8|t[e]&255,e=(e+1)%t.length;return{key:r,offp:e}}function Sx(t,e,n){for(var r=0,a=[0,0],o=e.length,c=n.length,f,p=0;p<o;p++)f=bi(t,r),r=f.offp,e[p]=e[p]^f.key;for(p=0;p<o;p+=2)a=za(a,0,e,n),e[p]=a[0],e[p+1]=a[1];for(p=0;p<c;p+=2)a=za(a,0,e,n),n[p]=a[0],n[p+1]=a[1]}function zD(t,e,n,r){for(var a=0,o=[0,0],c=n.length,f=r.length,p,h=0;h<c;h++)p=bi(e,a),a=p.offp,n[h]=n[h]^p.key;for(a=0,h=0;h<c;h+=2)p=bi(t,a),a=p.offp,o[0]^=p.key,p=bi(t,a),a=p.offp,o[1]^=p.key,o=za(o,0,n,r),n[h]=o[0],n[h+1]=o[1];for(h=0;h<f;h+=2)p=bi(t,a),a=p.offp,o[0]^=p.key,p=bi(t,a),a=p.offp,o[1]^=p.key,o=za(o,0,n,r),r[h]=o[0],r[h+1]=o[1]}function Ex(t,e,n,r,a){var o=iw.slice(),c=o.length,f;if(n<4||n>31)if(f=Error("Illegal number of rounds (4-31): "+n),r){kn(r.bind(this,f));return}else throw f;if(e.length!==Ha)if(f=Error("Illegal salt length: "+e.length+" != "+Ha),r){kn(r.bind(this,f));return}else throw f;n=1<<n>>>0;var p,h,x=0,v;typeof Int32Array=="function"?(p=new Int32Array(wx),h=new Int32Array(_x)):(p=wx.slice(),h=_x.slice()),zD(e,t,p,h);function w(){if(a&&a(x/n),x<n)for(var E=Date.now();x<n&&(x=x+1,Sx(t,p,h),Sx(e,p,h),!(Date.now()-E>HD)););else{for(x=0;x<64;x++)for(v=0;v<c>>1;v++)za(o,v<<1,p,h);var N=[];for(x=0;x<c;x++)N.push((o[x]>>24&255)>>>0),N.push((o[x]>>16&255)>>>0),N.push((o[x]>>8&255)>>>0),N.push((o[x]&255)>>>0);if(r){r(null,N);return}else return N}r&&kn(w)}if(typeof r<"u")w();else for(var _;;)if(typeof(_=w())<"u")return _||[]}function yf(t,e,n,r){var a;if(typeof t!="string"||typeof e!="string")if(a=Error("Invalid string / salt: Not a string"),n){kn(n.bind(this,a));return}else throw a;var o,c;if(e.charAt(0)!=="$"||e.charAt(1)!=="2")if(a=Error("Invalid salt version: "+e.substring(0,2)),n){kn(n.bind(this,a));return}else throw a;if(e.charAt(2)==="$")o="\0",c=3;else{if(o=e.charAt(2),o!=="a"&&o!=="b"&&o!=="y"||e.charAt(3)!=="$")if(a=Error("Invalid salt revision: "+e.substring(2,4)),n){kn(n.bind(this,a));return}else throw a;c=4}if(e.charAt(c+2)>"$")if(a=Error("Missing salt rounds"),n){kn(n.bind(this,a));return}else throw a;var f=parseInt(e.substring(c,c+1),10)*10,p=parseInt(e.substring(c+1,c+2),10),h=f+p,x=e.substring(c+3,c+25);t+=o>="a"?"\0":"";var v=VD(t),w=rw(x,Ha);function _(E){var N=[];return N.push("$2"),o>="a"&&N.push(o),N.push("$"),h<10&&N.push("0"),N.push(h.toString()),N.push("$"),N.push(Hl(w,w.length)),N.push(Hl(E,iw.length*4-1)),N.join("")}if(typeof n>"u")return _(Ex(v,w,h));Ex(v,w,h,function(E,N){E?n(E,null):n(null,_(N))},r)}function FD(t,e){return Hl(t,e)}function $D(t,e){return rw(t,e)}const aw={setRandomFallback:UD,genSaltSync:th,genSalt:Zb,hashSync:ew,hash:tw,compareSync:jD,compare:OD,getRounds:LD,getSalt:qD,truncates:BD,encodeBase64:FD,decodeBase64:$D},sh=()=>{if(!ps)throw new Error("Supabase is not configured.");return ps},ow=t=>t.shop?"shop":t.customer?"customer":t.driver?"driver":"supplier",lw=async t=>{const e={shop:t.is_shop,customer:t.is_customer,driver:t.is_driver,supplier:t.is_supplier},n=await SD(t.id,{requiresShopVerification:t.is_shop,requiresDriverVerification:t.is_driver}),r={clientId:t.id,companyName:t.display_name,contactPerson:t.display_name,address:"",email:t.email,role:ow(e),isVerified:n.isVerified,isDriverVerified:n.isDriverVerified,shopId:t.shop_qdrant_id||void 0,customerId:t.customer_qdrant_id||void 0,driverId:t.driver_qdrant_id||void 0,supplierId:t.supplier_qdrant_id||void 0,roles:e};let a=null;return t.is_shop&&t.shop_qdrant_id&&(a={id:t.shop_qdrant_id,name:t.display_name,contactEmail:t.contact_email,qdrantNamespace:t.qdrant_namespace||void 0}),Ga(a),Nr({userId:t.id,qdrantUserId:t.qdrant_user_id||t.id,displayName:t.display_name,email:t.contact_email||t.email,contactEmail:t.contact_email||t.email,shopId:t.shop_qdrant_id||null}).catch(o=>console.error("[Auth] Failed to sync user to Qdrant:",o)),{user:r,shopContext:a}},JD=async t=>{const e=sh(),{error:n}=await e.from("users").insert([t]);if(n)throw n},YD=async t=>{sh();const e=t.roles;if(!e.shop&&!e.customer&&!e.driver&&!e.supplier)throw new Error("Please select at least one role.");const n=await aw.hash(t.password,10),r=ht(),a=e.shop?ht():null,o=e.customer?ht():null,c=e.driver?ht():null,f=e.supplier?ht():null;await JD({id:r,username:t.username.trim(),email:t.email.trim(),contact_email:t.email.trim(),display_name:t.displayName.trim(),password_hash:n,is_shop:e.shop,is_customer:e.customer,is_driver:e.driver,is_supplier:e.supplier,qdrant_user_id:r,shop_qdrant_id:a,qdrant_namespace:a?`shop-${a}`:null,customer_qdrant_id:o,driver_qdrant_id:c,supplier_qdrant_id:f,metadata:e.driver&&t.licenseId?{licenseId:t.licenseId}:{}}),await Nr({userId:r,qdrantUserId:r,displayName:t.displayName.trim(),email:t.email.trim(),contactEmail:t.email.trim(),shopId:a}),e.shop&&a&&(await bv(),await wv({id:a,name:t.displayName.trim(),contactEmail:t.email.trim(),userId:r,qdrantNamespace:`shop-${a}`})),e.customer&&o&&await _v({id:o,fullName:t.displayName.trim(),contactEmail:t.email.trim()}),e.driver&&c&&await Kl({id:c,fullName:t.displayName.trim(),contactEmail:t.email.trim(),status:"pending"}),e.supplier&&f&&await kf({id:f,name:t.displayName.trim(),contactEmail:t.email.trim(),shopId:t.supplierShopId||null,linkedUserId:t.supplierShopId?null:r});const p={id:r,username:t.username.trim(),email:t.email.trim(),display_name:t.displayName.trim(),contact_email:t.email.trim(),is_shop:e.shop,is_customer:e.customer,is_driver:e.driver,is_supplier:e.supplier,qdrant_user_id:r,shop_qdrant_id:a,qdrant_namespace:a?`shop-${a}`:null,customer_qdrant_id:o,driver_qdrant_id:c,supplier_qdrant_id:f,metadata:{...e.driver&&t.licenseId?{licenseId:t.licenseId}:{},...e.supplier&&t.supplierShopId?{linkedShop:t.supplierShopId}:{}}},h={clientId:r,companyName:t.displayName.trim(),contactPerson:t.displayName.trim(),email:t.email.trim(),role:ow(e),isVerified:!e.shop,isDriverVerified:!e.driver,shopId:a||void 0,driverId:c||void 0,roles:e};return e.shop&&await wD(h),e.driver&&await _D(h),await lw(p)},KD=async t=>{const e=sh(),{data:n,error:r}=await e.from("users").select("*").eq("username",t.username.trim()).single();if(r||!n)throw new Error("Invalid username or password.");if(!await aw.compare(t.password,n.password_hash??""))throw new Error("Invalid username or password.");return await lw(n)},QD=({onSuccess:t})=>{const[e,n]=C.useState(""),[r,a]=C.useState(""),[o,c]=C.useState(null),[f,p]=C.useState(!1),h=async x=>{x.preventDefault(),p(!0),c(null);try{const v=await KD({username:e.trim(),password:r});t(v)}catch(v){c(v instanceof Error?v.message:"Login failed")}finally{p(!1)}};return d.jsxs("form",{onSubmit:h,className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),d.jsx("input",{type:"text",value:e,onChange:x=>n(x.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",autoComplete:"username",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),d.jsx("input",{type:"password",value:r,onChange:x=>a(x.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",autoComplete:"current-password",required:!0})]}),o&&d.jsx("div",{className:"text-sm text-red-400 bg-red-900/30 border border-red-700 rounded-md px-3 py-2",children:o}),d.jsx("button",{type:"submit",disabled:f,className:"w-full py-2.5 rounded-md bg-cyan-600 hover:bg-cyan-700 text-white font-semibold transition disabled:opacity-60",children:f?"Signing in...":"Sign In"})]})},XD=({onSuccess:t})=>{const[e,n]=C.useState(""),[r,a]=C.useState(""),[o,c]=C.useState(""),[f,p]=C.useState(""),[h,x]=C.useState(""),[v,w]=C.useState({shop:!1,customer:!1,driver:!1,supplier:!1}),[_,E]=C.useState(""),[N,D]=C.useState(null),[k,U]=C.useState(!1),A=P=>{w(B=>({...B,[P]:!B[P]}))},I=async P=>{P.preventDefault(),U(!0),D(null);try{if(!(v.shop||v.customer||v.driver||v.supplier))throw new Error("Please select at least one role.");if(v.shop&&!e.trim())throw new Error("Shop owners must provide a shop name.");if(!v.shop&&!e.trim())throw new Error("Please provide your display name.");const H=await YD({username:r.trim(),email:o.trim(),password:f,displayName:e.trim(),roles:v,licenseId:v.driver?h.trim():void 0,supplierShopId:v.supplier&&_.trim()||void 0});t(H)}catch(B){D(B instanceof Error?B.message:"Registration failed")}finally{U(!1)}};return d.jsxs("form",{onSubmit:I,className:"space-y-4",children:[d.jsx("div",{className:"flex space-x-2",children:["shop","customer","driver","supplier"].map(P=>d.jsx("button",{type:"button",onClick:()=>A(P),className:`flex-1 py-2 rounded-md text-sm font-semibold capitalize ${v[P]?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:P},P))}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:v.shop?"Shop Name":"Display Name"}),d.jsx("input",{type:"text",value:e,onChange:P=>n(P.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),d.jsx("input",{type:"email",value:o,onChange:P=>c(P.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),d.jsx("input",{type:"text",value:r,onChange:P=>a(P.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),d.jsx("input",{type:"password",value:f,onChange:P=>p(P.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),v.driver&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"License ID (optional)"}),d.jsx("input",{type:"text",value:h,onChange:P=>x(P.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),v.supplier&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Associated Shop ID (optional)"}),d.jsx("input",{type:"text",value:_,onChange:P=>E(P.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Link yourself to a shop UUID if applicable"})]}),N&&d.jsx("div",{className:"text-sm text-red-400 bg-red-900/30 border border-red-700 rounded-md px-3 py-2",children:N}),d.jsx("button",{type:"submit",disabled:k,className:"w-full py-2.5 rounded-md bg-cyan-600 hover:bg-cyan-700 text-white font-semibold transition disabled:opacity-60",children:k?"Creating...":"Create Account"})]})},cw=({onAuthenticated:t})=>{const[e,n]=C.useState("login");return d.jsx("div",{className:"min-h-screen bg-gray-900 flex flex-col items-center justify-center p-6",children:d.jsxs("div",{className:"w-full max-w-lg bg-gray-800 border border-gray-700 rounded-xl p-6 shadow-2xl",children:[d.jsxs("div",{className:"flex space-x-2 mb-6",children:[d.jsx("button",{onClick:()=>n("login"),className:`flex-1 py-2 rounded-md font-semibold ${e==="login"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Login"}),d.jsx("button",{onClick:()=>n("register"),className:`flex-1 py-2 rounded-md font-semibold ${e==="register"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Create Account"})]}),e==="login"?d.jsx(QD,{onSuccess:t}):d.jsx(XD,{onSuccess:r=>{t(r),n("login")}})]})})},rh=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M12 2L9 9l-7 3 7 3 3 7 3-7 7-3-7-3-3-7z"}),d.jsx("path",{d:"M22 12l-3-1-1-3-1 3-3 1 3 1 1 3 1-3 3-1z"}),d.jsx("path",{d:"M5 3l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z"})]}),WD=({activeTab:t,onTabChange:e,user:n,onLogout:r,isBackendAvailable:a})=>{var _,E,N,D;const[o,c]=C.useState(!1),f=!!((_=n.roles)!=null&&_.shop||n.shopId),p=!!((E=n.roles)!=null&&E.customer||n.customerId),h=!!((N=n.roles)!=null&&N.driver||n.driverId),x=!!((D=n.roles)!=null&&D.supplier||n.supplierId),v=(k,U=!1)=>{let A="px-3 py-2 rounded-md text-sm font-medium transition-colors";return U?`${A} text-gray-500 cursor-not-allowed`:(A+=" cursor-pointer",t===k?`${A} bg-cyan-600 text-white`:`${A} text-gray-300 hover:bg-gray-700 hover:text-white`)},w=!n.isVerified;return d.jsx("header",{className:"bg-gray-800/50 backdrop-blur-sm sticky top-0 z-10",children:d.jsx("div",{className:"container mx-auto px-4 md:px-8",children:d.jsxs("div",{className:"flex items-center justify-between h-20 border-b border-gray-700",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx(rh,{className:"w-8 h-8 text-cyan-400"}),d.jsx("h1",{className:"text-2xl font-bold tracking-tight text-white",children:"NexusShop"})]}),d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsxs("nav",{className:"hidden md:flex items-center space-x-2 p-1 bg-gray-900/50 rounded-lg border border-gray-700",children:[d.jsx("a",{onClick:()=>e("dashboard"),className:v("dashboard"),children:"Dashboard"}),f&&d.jsxs(d.Fragment,{children:[d.jsx("a",{onClick:()=>e("inventory"),className:v("inventory"),children:"Inventory"}),d.jsx("a",{onClick:()=>e("catalog"),className:v("catalog"),children:"Products"}),d.jsx("a",{onClick:()=>e("batches"),className:v("batches"),children:"Batches"}),d.jsx("a",{onClick:()=>!w&&e("marketplace"),className:v("marketplace",w),title:w?"Verification Pending":"Marketplace",children:"Marketplace"}),d.jsx("a",{onClick:()=>e("kiosk"),className:v("kiosk"),children:"Kiosk"})]}),p&&d.jsx("a",{onClick:()=>e("customer"),className:v("customer"),children:"Customer"}),x&&d.jsx("a",{onClick:()=>e("supplier"),className:v("supplier"),children:"Supplier"}),a&&d.jsx("a",{onClick:()=>e("backend"),className:v("backend"),children:"Backend"})]}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{onClick:()=>c(!o),className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-700",children:[d.jsx("div",{className:"w-8 h-8 bg-cyan-800 rounded-full flex items-center justify-center text-cyan-300 font-bold",children:n.companyName.charAt(0)}),d.jsx("span",{className:"hidden lg:inline text-sm font-medium text-white",children:n.companyName})]}),o&&d.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-gray-800 border border-gray-700 rounded-md shadow-lg z-20",children:[d.jsxs("div",{className:"px-4 py-3 border-b border-gray-700",children:[d.jsx("p",{className:"text-sm font-semibold text-white truncate",children:n.companyName}),d.jsx("p",{className:"text-xs text-gray-400 capitalize",children:n.role})]}),d.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Shop: ",f?d.jsx("span",{className:"text-green-400",children:"Enabled"}):d.jsx("span",{className:"text-gray-500",children:"Off"}),n.shopId&&d.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.shopId.slice(0,8),"...)"]})]}),d.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Customer: ",p?d.jsx("span",{className:"text-green-400",children:"Enabled"}):d.jsx("span",{className:"text-gray-500",children:"Off"}),n.customerId&&d.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.customerId.slice(0,8),"...)"]})]}),d.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Driver: ",h?d.jsx("span",{className:"text-green-400",children:"Enabled"}):d.jsx("span",{className:"text-gray-500",children:"Off"}),n.driverId&&d.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.driverId.slice(0,8),"...)"]})]}),d.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400 border-b border-gray-700",children:["Supplier: ",x?d.jsx("span",{className:"text-green-400",children:"Enabled"}):d.jsx("span",{className:"text-gray-500",children:"Off"}),n.supplierId&&d.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.supplierId.slice(0,8),"...)"]})]}),d.jsx("a",{onClick:r,className:"block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Logout"})]})]})]}),d.jsx("button",{className:"md:hidden text-gray-300",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]})})})},ZD="modulepreload",e3=function(t){return"/"+t},Tx={},uw=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(x=>Promise.resolve(x).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),p=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));a=c(n.map(h=>{if(h=e3(h),h in Tx)return;Tx[h]=!0;const x=h.endsWith(".css"),v=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${v}`))return;const w=document.createElement("link");if(w.rel=x?"stylesheet":ZD,x||(w.as="script"),w.crossOrigin="",w.href=h,p&&w.setAttribute("nonce",p),document.head.appendChild(w),x)return new Promise((_,E)=>{w.addEventListener("load",_),w.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return a.then(c=>{for(const f of c||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})},t3=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),d.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),dw=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),d.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),d.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),Ai=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),d.jsx("polyline",{points:"12 6 12 12 16 14"})]}),n3=({toast:t,onRemove:e})=>{const[n,r]=C.useState(!1);C.useEffect(()=>{setTimeout(()=>r(!0),10);const c=t.duration??5e3,f=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),300)},c);return()=>clearTimeout(f)},[t.id,t.duration,e]);const a=()=>{switch(t.type){case"success":return"bg-green-900/90 border-green-700 text-green-100";case"error":return"bg-red-900/90 border-red-700 text-red-100";case"warning":return"bg-yellow-900/90 border-yellow-700 text-yellow-100";case"info":return"bg-cyan-900/90 border-cyan-700 text-cyan-100";default:return"bg-gray-900/90 border-gray-700 text-gray-100"}},o=()=>{switch(t.type){case"success":return d.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})});case"error":return d.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})});case"warning":return d.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});case"info":return d.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}};return d.jsxs("div",{className:`
        ${a()}
        border rounded-lg shadow-lg p-4 flex items-start space-x-3
        transition-all duration-300 ease-in-out
        ${n?"opacity-100 translate-x-0":"opacity-0 translate-x-full"}
      `,children:[d.jsx("div",{className:"flex-shrink-0 mt-0.5",children:o()}),d.jsx("div",{className:"flex-1 min-w-0",children:d.jsx("p",{className:"text-sm font-medium",children:t.message})}),d.jsx("button",{onClick:()=>{r(!1),setTimeout(()=>e(t.id),300)},className:"flex-shrink-0 text-current opacity-70 hover:opacity-100 transition-opacity","aria-label":"Close",children:d.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})},s3=({toasts:t,onRemove:e})=>d.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-md",children:t.map(n=>d.jsx(n3,{toast:n,onRemove:e},n.id))});let r3=0;const El=new Set,gr=[],Fn=()=>{const[t,e]=C.useState(gr);return C.useEffect(()=>{const a=o=>e([...o]);return El.add(a),a(gr),()=>{El.delete(a)}},[]),{toasts:t,showToast:(a,o="info",c)=>{const p={id:`toast-${r3++}`,message:a,type:o,duration:c};gr.push(p),El.forEach(h=>h([...gr]))},removeToast:a=>{const o=gr.findIndex(c=>c.id===a);o!==-1&&(gr.splice(o,1),El.forEach(c=>c([...gr])))}}},Nn="AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c";class Sn extends Error{constructor(e="Gemini API is currently overloaded. Please try again in a moment."){super(e),this.name="GeminiOverloadError"}}const Ka=t=>{if(!t)return!1;const e=String(t.message||t.toString()||"").toLowerCase(),n=t.code||t.status||t.statusCode;return n===429||n===503||n==="RESOURCE_EXHAUSTED"||e.includes("quota")||e.includes("rate limit")||e.includes("overload")||e.includes("resource exhausted")||e.includes("too many requests")||e.includes("service unavailable")||e.includes("backend error")||n>=500&&n<600},un={productId:{displayName:"Product ID",description:"Canonical product identifier",type:"string"},productName:{displayName:"Product Name",description:"Name of the product",type:"string"},manufacturer:{displayName:"Manufacturer",description:"Manufacturer of the product",type:"string"},category:{displayName:"Category",description:"Product category (e.g., Beverages, Snacks, Produce)",type:"string"},productDescription:{displayName:"Product Description",description:"Detailed description of the product",type:"string"},expirationDate:{displayName:"Exp. Date",description:"Expiration date in YYYY-MM-DD format",type:"string"},quantity:{displayName:"Quantity",description:"Quantity of the product",type:"number"},quantityType:{displayName:"Quantity Type",description:"Unit of measurement (e.g., units, kg, lbs, liters)",type:"string"},costPerUnit:{displayName:"Cost/Unit",description:"Cost per single unit of the product",type:"number"},supplier:{displayName:"Supplier",description:"Supplier or distributor name",type:"string"},deliveryDate:{displayName:"Delivery Date",description:"Delivery date in YYYY-MM-DD format",type:"string"},inventoryDate:{displayName:"Inventory Date",description:"Today's date in YYYY-MM-DD format",type:"string"}},i3={type:xe.OBJECT,properties:{productName:{type:xe.STRING,description:"Name of the product"},manufacturer:{type:xe.STRING,description:"Manufacturer of the product"},category:{type:xe.STRING,description:"A suitable category for the product (e.g., Beverages, Snacks, Dairy, Produce)"},expirationDate:{type:xe.STRING,description:"Expiration date in YYYY-MM-DD format"},quantity:{type:xe.NUMBER,description:"Quantity of the product"},quantityType:{type:xe.STRING,description:"Unit of measurement (e.g., units, kg, lbs, liters)"},costPerUnit:{type:xe.NUMBER,description:"Cost per single unit of the product"},supplier:{type:xe.STRING,description:"Supplier or distributor name, if visible"},deliveryDate:{type:xe.STRING,description:"Delivery date in YYYY-MM-DD format, if visible"}},required:["productName","manufacturer","category","expirationDate","quantity","quantityType","costPerUnit"]},a3={type:xe.OBJECT,properties:{supplierName:{type:xe.STRING,description:"The name of the supplier or vendor."},invoiceNumber:{type:xe.STRING,description:"The invoice or reference number for the delivery."},deliveryDate:{type:xe.STRING,description:"The delivery date in YYYY-MM-DD format."},items:{type:xe.ARRAY,description:"A complete list of all line items from the document.",items:{type:xe.OBJECT,properties:{productName:{type:xe.STRING,description:"The full name of the product as written on the document."},quantity:{type:xe.NUMBER,description:"The quantity of the product delivered."},costPerUnit:{type:xe.NUMBER,description:"The cost for a single unit of the product."}},required:["productName","quantity","costPerUnit"]}}}},Tn=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>{const o=r.result.split(",")[1];e({inlineData:{data:o,mimeType:t.type}})},r.onerror=a=>n(a)}),fw=async t=>{if(t.length===0)throw new Error("No documents provided for analysis.");try{const e=new Qt({apiKey:Nn}),n=await Promise.all(t.map(f=>Tn(f))),o=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[...n,{text:"Analyze these images of shipping documents (e.g., invoice, packing slip). Extract the supplier name, invoice number, delivery date, and a complete list of all line items. For each line item, provide the product name, quantity, and cost per unit. If a value isn't clearly present, omit it. Consolidate information if multiple documents are provided."}]},config:{responseMimeType:"application/json",responseSchema:a3}})).text.trim(),c=JSON.parse(o);if(typeof c!="object"||c===null)throw new Error("Invalid JSON structure received from API");return{supplierName:c.supplierName,invoiceNumber:c.invoiceNumber,deliveryDate:c.deliveryDate,items:c.items||[]}}catch(e){throw console.error("Error analyzing batch documents with Gemini:",e),new Error("Failed to extract batch data from the documents.")}},sc=async t=>{try{const e=new Qt({apiKey:Nn}),n=await Tn(t),a=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[n,{text:"Analyze this image of a product or delivery note. Extract inventory details. If a value isn't present, make a reasonable guess or use 'N/A' for strings and 0 for numbers. For dates, use YYYY-MM-DD format."}]},config:{responseMimeType:"application/json",responseSchema:i3}})).text.trim(),o=JSON.parse(a);if(typeof o!="object"||o===null)throw new Error("Invalid JSON structure received from API");return{productName:o.productName||"N/A",manufacturer:o.manufacturer||"N/A",category:o.category||"General",expirationDate:o.expirationDate||"N/A",quantity:Number(o.quantity)||0,quantityType:o.quantityType||"units",costPerUnit:Number(o.costPerUnit)||0,supplier:o.supplier,deliveryDate:o.deliveryDate}}catch(e){throw console.error("Error analyzing image with Gemini:",e),Ka(e)?new Sn("Gemini API is currently overloaded. Please wait a moment and try again."):new Error("Failed to extract inventory data from the image.")}},ih=async(t,e)=>{try{const n=new Qt({apiKey:Nn}),r=await Tn(t),a=un[e],o=`This image contains the ${a.displayName}. Extract ONLY the value for this field. Do not add any extra text, labels, or explanations. Return just the raw value. For dates, use YYYY-MM-DD format.`,f=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:o}]}})).text.trim();if(a.type==="number"){const p=parseFloat(f.replace(/[^0-9.-]+/g,""));return isNaN(p)?0:p}return f}catch(n){throw console.error(`Error analyzing cropped image for field ${e}:`,n),Ka(n)?new Sn("Gemini API is currently overloaded. Please wait a moment and try again."):new Error(`Failed to extract data for ${e}.`)}},hw=async(t,e,n)=>{if(t.length===0&&!ue)return"The inventory is currently empty. Please add items to generate a report.";const r=new Qt({apiKey:Nn});try{let a="",o=[];if(ue&&n.trim().length>0){const p=await jn(n);if(o=await jf(p,ue,20),o.length>0){const h=o.map(x=>{const v=e.find(_=>_.id===x.batchId),w=t.find(_=>_.productId===x.productId&&String(_.batchId)===String(x.batchId));return{inventoryUuid:x.inventoryUuid,productName:(w==null?void 0:w.productName)||"N/A",manufacturer:(w==null?void 0:w.manufacturer)||"N/A",category:(w==null?void 0:w.category)||"General",expirationDate:x.expirationDate,quantity:x.quantity,quantityType:(w==null?void 0:w.quantityType)||"units",costPerUnit:x.costPerUnit,supplier:v==null?void 0:v.supplier,deliveryDate:v==null?void 0:v.deliveryDate,inventoryDate:v==null?void 0:v.inventoryDate,location:x.location,buyPrice:x.buyPrice,sellPrice:x.sellPrice}});a=JSON.stringify(h,null,2),console.log("RAG applied: sending relevant inventory data to Gemini.")}else a=JSON.stringify(t.map(h=>{const x=e.find(v=>v.id===h.batchId);return{...h,supplier:x==null?void 0:x.supplier,deliveryDate:x==null?void 0:x.deliveryDate,inventoryDate:x==null?void 0:x.inventoryDate}}),null,2),console.warn("No relevant items found via RAG for the given prompt, falling back to full inventory context.")}else a=JSON.stringify(t.map(p=>{const h=e.find(x=>x.id===p.batchId);return{...p,supplier:h==null?void 0:h.supplier,deliveryDate:h==null?void 0:h.deliveryDate,inventoryDate:h==null?void 0:h.inventoryDate}}),null,2),console.log("RAG skipped: using full inventory context for analysis.");const c=`
      Based on the following inventory data, please provide an analysis for the request: "${n}".
      
      Inventory Data:
      ${a}
      
      Please format your response in clear, easy-to-read markdown.
    `;return(await r.models.generateContent({model:"gemini-2.5-pro",contents:c,config:{thinkingConfig:{thinkingBudget:32768}}})).text}catch(a){throw console.error("Error generating inventory report with Gemini Pro:",a),new Error("Failed to generate the inventory report.")}},ah=async(t,e)=>{if(e.length===0)return null;try{const n=new Qt({apiKey:Nn}),r=await Tn(t),a=`
      Analyze this image. Identify the main product visible.
      From the following list of known products, which one is it?
      Product list: [${e.join(", ")}]
      Respond with ONLY the name of the product from the list that matches best.
      If no product from the list is clearly identifiable, respond with the exact text "NO_PRODUCT".
    `,c=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:a}]}})).text.trim();return c==="NO_PRODUCT"||!e.includes(c)?null:c}catch(n){if(console.error("Error identifying product:",n),Ka(n))throw new Sn("Gemini API is currently overloaded. Please wait a moment and try again.");return null}},pw=t=>{const e=t.split(","),n=e[0].match(/:(.*?);/);if(!n)throw new Error("Invalid data URL");const r=n[1],a=atob(e[1]);let o=a.length;const c=new Uint8Array(o);for(;o--;)c[o]=a.charCodeAt(o);return new Blob([c],{type:r})},mw=async(t,e,n)=>{try{const r=new Qt({apiKey:Nn}),a=await Tn(t),o=await Tn(e),c=un[n],f=`The first image is a close-up of a '${c.displayName}'. The second image is a wider view of a product. Find the exact feature from the first image within the second image and extract ONLY its value. Do not add any extra text, labels, or explanations. Return just the raw value. If you cannot find the feature, return the text "NOT_FOUND". For dates, use YYYY-MM-DD format.`,h=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[o,a,{text:f}]}})).text.trim();if(h==="NOT_FOUND")return null;if(c.type==="number"){const x=parseFloat(h.replace(/[^0-9.-]+/g,""));return isNaN(x)?null:x}return h}catch(r){if(console.error(`Error finding feature for field ${n}:`,r),Ka(r))throw new Sn("Gemini API is currently overloaded. Please wait a moment and try again.");return null}},o3={type:xe.OBJECT,properties:{estimatedQuantity:{type:xe.NUMBER,description:"Estimated total quantity including hidden units"},confidence:{type:xe.NUMBER,description:"Confidence score from 0 to 1"},reasoning:{type:xe.STRING,description:"Explanation of the estimation"},visualAnalysis:{type:xe.STRING,description:"Detailed visual observations"},shelfFullness:{type:xe.NUMBER,description:"Shelf fullness percentage (0-100)"},visibleUnits:{type:xe.NUMBER,description:"Number of units clearly visible"},hiddenUnits:{type:xe.NUMBER,description:"Estimated units hidden behind others"}},required:["estimatedQuantity","confidence","reasoning","visualAnalysis","shelfFullness","visibleUnits"]},gw=async(t,e,n)=>{try{const r=new Qt({apiKey:Nn}),a=await Tn(t),o=n?`Expected shelf capacity: ${n} units.`:"No expected capacity provided.",c=`Analyze this shelf photo for ${e}.
        
        Tasks:
        1. Count visible units of the product
        2. Estimate if there are units hidden behind others
        3. Assess shelf fullness (0-100%)
        4. Identify any damage or quality issues
        5. Check expiration dates if visible
        
        ${o}
        
        Provide detailed analysis with confidence score.`,f=await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[a,{text:c}]},config:{responseMimeType:"application/json",responseSchema:o3}}),p=JSON.parse(f.text.trim());return{estimatedQuantity:p.estimatedQuantity||0,confidence:Math.max(0,Math.min(1,p.confidence||.5)),reasoning:p.reasoning||"",visualAnalysis:p.visualAnalysis||"",shelfFullness:Math.max(0,Math.min(100,p.shelfFullness||0)),visibleUnits:p.visibleUnits||0,hiddenUnits:p.hiddenUnits}}catch(r){throw console.error("Error estimating stock from shelf photo:",r),new Error("Failed to estimate stock from shelf photo.")}},l3={type:xe.OBJECT,properties:{qualityScore:{type:xe.NUMBER,description:"Overall quality score from 0 to 100"},issues:{type:xe.ARRAY,items:{type:xe.STRING},description:"List of quality issues found"},recommendations:{type:xe.ARRAY,items:{type:xe.STRING},description:"Recommendations for action"},expirationVisible:{type:xe.BOOLEAN,description:"Whether expiration date is visible"},expirationDate:{type:xe.STRING,description:"Detected expiration date in YYYY-MM-DD format if visible"},damageDetected:{type:xe.BOOLEAN,description:"Whether any damage was detected"},damageDescription:{type:xe.STRING,description:"Description of damage if found"},packagingIntegrity:{type:xe.STRING,description:"Packaging condition: good, fair, or poor"}},required:["qualityScore","issues","recommendations","expirationVisible","damageDetected","packagingIntegrity"]},yw=async(t,e,n)=>{try{const r=new Qt({apiKey:Nn}),a=await Tn(t),o=n?`Expected expiration: ${n}. Compare detected date with expected.`:"",c=`Analyze this image of ${e} for quality assessment.
        
        Check for:
        - Physical damage (dents, tears, broken seals)
        - Expiration date visibility and validity
        - Packaging integrity
        - Signs of spoilage (for perishables)
        - Overall condition
        
        ${o}
        
        Provide detailed quality assessment with actionable recommendations.`,f=await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[a,{text:c}]},config:{responseMimeType:"application/json",responseSchema:l3}}),p=JSON.parse(f.text.trim());return{qualityScore:Math.max(0,Math.min(100,p.qualityScore||50)),issues:p.issues||[],recommendations:p.recommendations||[],expirationVisible:p.expirationVisible||!1,expirationDate:p.expirationDate,damageDetected:p.damageDetected||!1,damageDescription:p.damageDescription,packagingIntegrity:p.packagingIntegrity||"fair"}}catch(r){throw console.error("Error assessing product quality:",r),new Error("Failed to assess product quality.")}},oh=async(t,e)=>{try{const n=new Qt({apiKey:Nn}),r=await Tn(t),c=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:`Describe this product in detail. Include:
        - Product name/brand
        - Category
        - Key visual features
        - Packaging type
        - Any text visible on packaging
        
        Return a concise product description suitable for search.`}]}})).text.trim(),f=await F2(c,t,.5,.5);return await jf(f,e,10)}catch(n){return console.error("Error searching inventory by image:",n),[]}},xw=async t=>{try{const e=new Qt({apiKey:Nn});return await Promise.all(t.map(async({image:r,expectedExpiration:a,productName:o})=>{try{const c=await Tn(r),f=`Find and read the expiration date on this ${o}.
                    
                    Expected expiration: ${a}
                    
                    Return ONLY the expiration date in YYYY-MM-DD format if visible, or "NOT_VISIBLE" if not found.
                    Also indicate your confidence (0-1) in the detection.`,h=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[c,{text:f}]}})).text.trim();if(h.includes("NOT_VISIBLE")||h.includes("not visible"))return{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Expiration date not visible in image"};const v=h.match(/\d{4}-\d{2}-\d{2}/),w=v?v[0]:null;if(!w)return{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Could not parse date from image"};const _=w===a||w.split("-")[0]===a.split("-")[0];return{productName:o,expectedExpiration:a,detectedExpiration:w,match:_,discrepancy:_?void 0:`Expected ${a}, found ${w}`,confidence:_?.9:.7}}catch(c){return console.error(`Error verifying expiration for ${o}:`,c),{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Error processing image"}}}))}catch(e){throw console.error("Error verifying expiration dates:",e),new Error("Failed to verify expiration dates.")}},c3={type:xe.OBJECT,properties:{products:{type:xe.ARRAY,items:{type:xe.OBJECT,properties:{productName:{type:xe.STRING,description:"Name of the product"},manufacturer:{type:xe.STRING,description:"Manufacturer/brand name if visible"},category:{type:xe.STRING,description:"Product category (e.g., Beverages, Snacks, Dairy)"},estimatedQuantity:{type:xe.NUMBER,description:"Total estimated quantity including hidden units"},visibleUnits:{type:xe.NUMBER,description:"Number of units clearly visible"},expirationDate:{type:xe.STRING,description:"Expiration date in YYYY-MM-DD format if visible"},expirationVisible:{type:xe.BOOLEAN,description:"Whether expiration date is visible"},location:{type:xe.STRING,description:"Shelf position or location description"},confidence:{type:xe.NUMBER,description:"Confidence score from 0 to 1"},notes:{type:xe.STRING,description:"Additional observations or notes"}},required:["productName","estimatedQuantity","visibleUnits","expirationVisible","confidence"]}},shelfFullness:{type:xe.NUMBER,description:"Overall shelf fullness percentage (0-100)"},totalProductsDetected:{type:xe.NUMBER,description:"Total number of different products detected"},recommendations:{type:xe.ARRAY,items:{type:xe.STRING},description:"Recommendations based on the scan"}},required:["products","shelfFullness","totalProductsDetected"]},vw=async(t,e)=>{try{const n=new Qt({apiKey:Nn}),r=await Tn(t),o=`Analyze this shelf photo and identify ALL products visible on the shelf.

        For each product detected:
        1. Identify the product name (match to known products if provided)
        2. Count visible units
        3. Estimate total quantity (including units hidden behind others)
        4. Check for expiration dates if visible
        5. Note shelf position/location
        6. Assess confidence in detection
        
        Also provide:
        - Overall shelf fullness percentage (0-100%)
        - Total number of different products detected
        - Any recommendations (e.g., restocking needed, expiration alerts)
        
        ${e&&e.length>0?`

Known products in inventory: ${e.join(", ")}
Try to match detected products to these names when possible.`:""}
        
        Return a comprehensive analysis of all products on this shelf.`,c=await n.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[r,{text:o}]},config:{responseMimeType:"application/json",responseSchema:c3}}),f=JSON.parse(c.text.trim());return{products:f.products||[],shelfFullness:Math.max(0,Math.min(100,f.shelfFullness||0)),totalProductsDetected:f.totalProductsDetected||0,scanTimestamp:new Date().toISOString(),recommendations:f.recommendations||[]}}catch(n){throw console.error("Error scanning shelf:",n),Ka(n)?new Sn("Gemini API is currently overloaded. Please wait a moment and try again."):new Error("Failed to scan shelf for products.")}},bw=async(t,e,n)=>{try{if(t.length===0)throw new Error("No shelf images provided.");const r=new Qt({apiKey:Nn}),a=await Promise.all(t.map(Tn)),c=`Analyze these shelf photos combined with inventory data.
        
        Inventory Data:
        ${JSON.stringify({inventory:e.slice(0,50).map(x=>({productId:x.productId,quantity:x.quantity,expirationDate:x.expirationDate})),recentSales:n.slice(-20).map(x=>({timestamp:x.timestamp,items:x.items,totalAmount:x.totalAmount}))},null,2)}
        
        Tasks:
        1. Compare visual stock levels with recorded inventory
        2. Identify discrepancies (visual vs recorded)
        3. Find products that look expired/damaged
        4. Suggest reordering based on visual stock levels
        5. Identify layout optimization opportunities
        6. Flag high-risk items (expiring soon, low stock, damaged)
        
        Provide actionable insights combining visual and data analysis.
        Format as structured recommendations with severity levels.`;return{insights:(await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[...a,{text:c}]},config:{thinkingConfig:{thinkingBudget:32768}}})).text.split(`
`).filter(x=>x.trim().length>0&&(x.includes("insight")||x.includes("finding")||x.match(/^\d+\./))).slice(0,10),visualFindings:[],recommendations:[],riskItems:[],dataDiscrepancies:[]}}catch(r){throw console.error("Error generating visual insights:",r),new Error("Failed to generate visual inventory insights.")}},u3=Object.freeze(Object.defineProperty({__proto__:null,GeminiOverloadError:Sn,analyzeBatchDocuments:fw,analyzeCroppedImageForField:ih,analyzeImageForInventory:sc,assessProductQuality:yw,dataUrlToBlob:pw,estimateStockFromShelfPhoto:gw,fieldMetadata:un,findAndReadFeature:mw,generateInventoryReport:hw,generateVisualInventoryInsights:bw,identifyProductNameFromImage:ah,scanShelfForProducts:vw,searchInventoryByImage:oh,verifyExpirationDates:xw},Symbol.toStringTag,{value:"Module"})),ww=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v1a2.5 2.5 0 0 1-2.5 2.5h-1A2.5 2.5 0 0 1 6 5.5v-1A2.5 2.5 0 0 1 8.5 2h1Z"}),d.jsx("path",{d:"M14.5 2A2.5 2.5 0 0 1 17 4.5v1a2.5 2.5 0 0 1-2.5 2.5h-1a2.5 2.5 0 0 1-2.5-2.5v-1A2.5 2.5 0 0 1 12.5 2h2Z"}),d.jsx("path",{d:"M18 12a4.5 4.5 0 0 1-4.5 4.5h-3A4.5 4.5 0 0 1 6 12v-2a4.5 4.5 0 0 1 4.5-4.5h3A4.5 4.5 0 0 1 18 10v2Z"}),d.jsx("path",{d:"M6 12a2.5 2.5 0 0 0-2.5 2.5v1A2.5 2.5 0 0 0 6 18h1a2.5 2.5 0 0 0 2.5-2.5v-1A2.5 2.5 0 0 0 7 12h-1Z"}),d.jsx("path",{d:"M18 12a2.5 2.5 0 0 1 2.5 2.5v1a2.5 2.5 0 0 1-2.5 2.5h-1a2.5 2.5 0 0 1-2.5-2.5v-1a2.5 2.5 0 0 1 2.5-2.5h1Z"}),d.jsx("path",{d:"M12 11v1"}),d.jsx("path",{d:"M12 18v2"})]}),Fs=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),d.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),_w=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),d.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),Sw=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M12 5a3 3 0 1 0-5.993.142"}),d.jsx("path",{d:"M12 5a3 3 0 1 1 5.993.142"}),d.jsx("path",{d:"M15 13a3 3 0 1 0-5.993.142"}),d.jsx("path",{d:"M15 13a3 3 0 1 1 5.993.142"}),d.jsx("path",{d:"M9 13a3 3 0 1 0-5.993.142"}),d.jsx("path",{d:"M9 13a3 3 0 1 1 5.993.142"}),d.jsx("path",{d:"M12 21a3 3 0 1 0-5.993-.142"}),d.jsx("path",{d:"M12 21a3 3 0 1 1 5.993.142"}),d.jsx("path",{d:"M12 13h.01"}),d.jsx("path",{d:"M12 5h.01"}),d.jsx("path",{d:"M12 21h.01"}),d.jsx("path",{d:"M18 13h.01"}),d.jsx("path",{d:"M6 13h.01"}),d.jsx("path",{d:"M18 5h.01"}),d.jsx("path",{d:"M6 5h.01"}),d.jsx("path",{d:"m18 5-3 4"}),d.jsx("path",{d:"m6 5 3 4"}),d.jsx("path",{d:"m18 13-3-4"}),d.jsx("path",{d:"m6 13 3-4"}),d.jsx("path",{d:"m15 21-3-4"}),d.jsx("path",{d:"m9 21 3-4"})]}),Fa=({onDataScanned:t,onClose:e,productOptions:n,mode:r="scan"})=>{const a=C.useRef(null),o=C.useRef(null),c=C.useRef(null),f=C.useRef(null),[p,h]=C.useState(null),[x,v]=C.useState(!1),[w,_]=C.useState({}),[E,N]=C.useState(new Map),[D,k]=C.useState(new Map),[U,A]=C.useState("auto-scanning"),[I,P]=C.useState(null),[B,H]=C.useState(null),[Q,J]=C.useState(null),[O,Z]=C.useState(new Set),[ae,ve]=C.useState(new Map),[ye,Me]=C.useState(null),[R,G]=C.useState(new Set),X=C.useMemo(()=>{const he=new Map;return n.forEach(Ee=>{he.has(Ee.productName)||he.set(Ee.productName,Ee)}),he},[n]),ce=C.useMemo(()=>Array.from(X.keys()),[X]),re=C.useRef(w),M=C.useRef(D);C.useEffect(()=>{re.current=w},[w]),C.useEffect(()=>{M.current=D},[D]);const q=C.useCallback((he,Ee,ze,Ke)=>{if(Ee==null||typeof Ee=="string"&&Ee.trim()==="")return;const st=M.current.get(he)??0;re.current[he]!==void 0&&re.current[he]!==null&&String(re.current[he]).length>0&&st>=Ke||(_(it=>({...it,[he]:Ee})),N(it=>{const _t=new Map(it);return _t.set(he,ze),_t}),k(it=>{const _t=new Map(it);return _t.set(he,Ke),_t}))},[]),K=C.useCallback(()=>{f.current&&(clearInterval(f.current),f.current=null)},[]),ie=C.useCallback(()=>{if(a.current&&c.current){const he=a.current,Ee=c.current,ze=he.getBoundingClientRect();Ee.width=ze.width,Ee.height=ze.height}},[]);C.useEffect(()=>{let he=null;return(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){h("Camera not supported on this browser. Please use a modern browser on a secure (HTTPS) connection.");return}try{he=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),a.current&&(a.current.srcObject=he,a.current.onloadedmetadata=()=>ie())}catch(ze){console.error("Error accessing camera:",ze),h("Could not access the camera. Please ensure permissions are granted and you are on a secure (HTTPS) site.")}})(),window.addEventListener("resize",ie),()=>{window.removeEventListener("resize",ie),K(),he&&he.getTracks().forEach(ze=>ze.stop())}},[ie,K]);const de=C.useCallback(async()=>{if(!a.current||!o.current||document.hidden||U!=="auto-scanning")return;const he=a.current,Ee=o.current;Ee.width=he.videoWidth,Ee.height=he.videoHeight;const ze=Ee.getContext("2d");if(!ze)return;ze.drawImage(he,0,0,he.videoWidth,he.videoHeight);const Ke=await new Promise(je=>Ee.toBlob(je,"image/jpeg",.8));if(!Ke||U!=="auto-scanning")return;let st=null;try{const je=await ah(Ke,ce);st=je&&X.get(je)||null,(st==null?void 0:st.productId)!==(ye==null?void 0:ye.productId)&&Me(st),x&&(v(!1),h(null))}catch(je){if(je instanceof Sn){v(!0),h(je.message),K();return}console.warn("Product identification failed:",je)}if(st)try{const je=await Mv(st.productId);je.size>0&&await Promise.all(Array.from(je.entries()).map(async([it,_t])=>{const At=it;if(O.has(At)||R.has(At)||(M.current.get(At)??0)>=.85)return;const Ln=pw(`data:${_t.mimeType};base64,${_t.imageBase64}`);try{const Xt=await mw(Ke,Ln,At);Xt!==null&&(q(At,Xt,"learned",.85),G(le=>new Set(le).add(At)))}catch(Xt){if(Xt instanceof Sn)throw Xt}})),x&&(v(!1),h(null))}catch(je){if(je instanceof Sn){v(!0),h(je.message),K();return}console.warn("Learned field scan failed:",je)}try{const je=await sc(Ke);for(const it in je){const _t=it;O.has(_t)||q(_t,je[_t],"auto",.6)}x&&(v(!1),h(null))}catch(je){if(je instanceof Sn){v(!0),h(je.message),K();return}console.warn("Generic auto-scan analysis failed:",je)}},[ye,O,U,X,ce,q,R,x,K]);C.useEffect(()=>{U==="auto-scanning"&&!f.current?f.current=window.setInterval(de,4e3):U!=="auto-scanning"&&K()},[U,de,K]),C.useEffect(()=>{const he=c.current,Ee=he==null?void 0:he.getContext("2d");Ee&&he&&(Ee.clearRect(0,0,he.width,he.height),B&&(Ee.fillStyle="#06b6d4",Ee.beginPath(),Ee.arc(B.x,B.y,10,0,2*Math.PI),Ee.fill(),Ee.strokeStyle="white",Ee.lineWidth=2,Ee.stroke()),Q&&(Ee.strokeStyle="#06b6d4",Ee.lineWidth=3,Ee.strokeRect(Q.x,Q.y,Q.width,Q.height)))},[B,Q]);const me=he=>{P(he),A("manual-capture"),H(null),J(null)},Te=he=>{var Ee;if(U==="auto-scanning"){A("selecting-field");return}if(U==="manual-capture"&&I){const ze=(Ee=c.current)==null?void 0:Ee.getBoundingClientRect();if(!ze)return;const Ke=he.clientX-ze.left,st=he.clientY-ze.top;if(!B)H({x:Ke,y:st});else{const je={x:Math.min(B.x,Ke),y:Math.min(B.y,st),width:Math.abs(Ke-B.x),height:Math.abs(st-B.y)};je.width>10&&je.height>10?(J(je),ne(je)):H(null)}}},ne=C.useCallback(async he=>{if(!a.current||!o.current||!I)return;A("analyzing"),H(null);const Ee=a.current,ze=o.current,Ke=Ee.getBoundingClientRect(),st=Ee.videoWidth/Ke.width,je=Ee.videoHeight/Ke.height,it=he.x*st,_t=he.y*je,At=he.width*st,On=he.height*je;ze.width=At,ze.height=On;const Ln=ze.getContext("2d");Ln&&(Ln.drawImage(Ee,it,_t,At,On,0,0,At,On),ze.toBlob(async Xt=>{if(Xt)try{ve(oe=>new Map(oe).set(I,Xt));const le=await ih(Xt,I);q(I,le,"manual",1),Z(oe=>new Set(oe).add(I)),G(oe=>{const Ie=new Set(oe);return Ie.delete(I),Ie})}catch(le){le instanceof Sn?(v(!0),h(le.message)):(console.error(le),h(le instanceof Error?le.message:"Analysis failed"))}P(null),J(null),A("auto-scanning")},"image/jpeg",.9))},[I,q]),ee=async()=>{if(r==="visual-search"){if(!a.current||!o.current){h("Camera not ready");return}const he=a.current,Ee=o.current;Ee.width=he.videoWidth,Ee.height=he.videoHeight;const ze=Ee.getContext("2d");if(!ze){h("Failed to get canvas context");return}ze.drawImage(he,0,0,he.videoWidth,he.videoHeight);const Ke=await new Promise(st=>Ee.toBlob(st,"image/jpeg",.85));Ke?(t({data:{},blobs:new Map([["productName",Ke]]),fieldSources:new Map,fieldConfidences:new Map}),e()):h("Failed to capture image");return}t({data:{...w},blobs:new Map(ae),identifiedProductId:ye==null?void 0:ye.productId,fieldSources:new Map(E),fieldConfidences:new Map(D)}),e()},be=()=>{switch(U){case"auto-scanning":return ye?`Identified: ${ye.productName}. Using learned fields to scan.`:"Scanning automatically... Tap screen to select a field manually.";case"selecting-field":return"Select a field to capture manually.";case"manual-capture":return I?B?"Tap the opposite corner.":`Tap the first corner for ${un[I].displayName}.`:"Select a field.";case"analyzing":return`Analyzing ${un[I].displayName}...`;default:return"Ready to scan."}};return d.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center","aria-modal":"true",children:[d.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),d.jsx("canvas",{ref:o,className:"hidden"}),d.jsx("canvas",{ref:c,className:"absolute inset-0 w-full h-full object-cover z-10 cursor-pointer",onClick:Te}),U==="selecting-field"&&d.jsxs("div",{className:"absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20 p-4",children:[d.jsx("h3",{className:"text-xl font-bold mb-6 text-white",children:"Select a field to capture"}),d.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 w-full max-w-2xl",children:Object.keys(un).map(he=>d.jsx("button",{onClick:()=>me(he),className:"p-3 bg-gray-700 text-white rounded-lg hover:bg-cyan-600 transition-colors text-sm",children:un[he].displayName},he))}),d.jsx("button",{onClick:()=>A("auto-scanning"),className:"mt-8 bg-gray-600 px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors",children:"Cancel & Resume Auto-Scan"})]}),x&&d.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-yellow-600/95 text-white p-4 rounded-lg text-center z-30 max-w-md mx-auto shadow-2xl border-2 border-yellow-400",children:[d.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[d.jsx("svg",{className:"w-6 h-6 animate-pulse",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),d.jsx("h3",{className:"text-lg font-bold",children:"Gemini API Overloaded"})]}),d.jsx("p",{className:"text-sm mb-3",children:p||"Gemini API is currently overloaded. Please wait a moment and try again."}),d.jsx("button",{onClick:()=>{v(!1),h(null),U==="auto-scanning"&&!f.current&&(f.current=window.setInterval(de,4e3))},className:"px-4 py-2 bg-yellow-700 hover:bg-yellow-800 rounded-md text-sm font-semibold transition-colors",children:"Retry Now"})]}),p&&!x&&d.jsx("div",{className:"absolute top-4 bg-red-800/80 text-white p-3 rounded-lg text-center z-30 max-w-md mx-auto",children:p}),d.jsx("div",{className:"absolute top-4 bg-black/50 text-white px-4 py-2 rounded-full z-20 text-center",children:d.jsx("p",{children:be()})}),U==="analyzing"&&d.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"})}),d.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-30","aria-label":"Close scanner",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 backdrop-blur-sm p-4 text-white rounded-t-lg shadow-2xl shadow-black z-20",children:[r==="visual-search"?d.jsxs(d.Fragment,{children:[d.jsx("h3",{className:"text-lg font-bold text-cyan-400 mb-2",children:"Visual Search"}),d.jsx("p",{className:"text-sm text-gray-300 mb-4",children:`Position the product in view and click "Capture & Search" to check if it's in inventory.`})]}):d.jsxs(d.Fragment,{children:[d.jsx("h3",{className:"text-lg font-bold text-cyan-400 mb-2",children:"Scanned Data"}),d.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 text-sm max-h-32 overflow-y-auto",children:Object.keys(w).length>0?Object.entries(w).map(([he,Ee])=>{const ze=he,Ke=E.get(ze);return d.jsxs("div",{className:"truncate flex items-center",children:[d.jsxs("span",{className:"font-semibold capitalize text-gray-400",children:[un[ze].displayName,": "]}),d.jsx("span",{className:"text-gray-100 ml-1",children:String(Ee)}),Ke==="manual"&&d.jsx(_w,{className:"w-3 h-3 ml-2 text-cyan-400 flex-shrink-0"}),Ke==="learned"&&d.jsx(Sw,{className:"w-4 h-4 ml-2 text-indigo-400 flex-shrink-0"})]},he)}):d.jsx("p",{className:"col-span-full text-gray-500 text-center py-4",children:"Data will appear here as it's scanned..."})})]}),d.jsx("button",{onClick:ee,disabled:r==="scan"&&Object.keys(w).length===0||U==="analyzing",className:"mt-4 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:r==="visual-search"?"Capture & Search":"Confirm & Use This Data"})]})]})},d3=({inventoryData:t,salesHistory:e,productCatalog:n})=>{const[r,a]=C.useState("insights"),[o,c]=C.useState(!1),[f,p]=C.useState(null),[h,x]=C.useState([]),[v,w]=C.useState(null),[_,E]=C.useState(!1),{showToast:N}=Fn(),D=C.useCallback(A=>{x([A]),E(!1),p(null),N('Image captured! Click "Analyze Images" to process.',"success")},[N]),k=async()=>{if(h.length===0){p("Please capture at least one image.");return}c(!0),p(null),w(null);try{switch(r){case"insights":const A=await bw(h,t,e);w(A),N("Visual insights generated successfully!","success");break;case"stock-estimation":const I=prompt("Enter product name for stock estimation:")||"Unknown Product",P=prompt("Enter expected shelf capacity (optional):"),B=await gw(h[0],I,P?parseInt(P):void 0);w(B),N("Stock estimation completed!","success");break;case"quality-assessment":const H=prompt("Enter product name:")||"Unknown Product",Q=prompt("Enter expected expiration date (YYYY-MM-DD, optional):"),J=await yw(h[0],H,Q||void 0);w(J),N("Quality assessment completed!","success");break;case"visual-search":{const ae=tc();if(!ae){p("No active shop context. Please ensure you are logged in."),c(!1);return}const ve=await oh(h[0],ae);w({items:ve,count:ve.length}),N(`Found ${ve.length} matching items!`,"success")}break;case"expiration-verify":const O=await Promise.all(h.map(async(ae,ve)=>{const ye=prompt(`Enter product name for image ${ve+1}:`)||"Unknown Product",Me=prompt(`Enter expected expiration (YYYY-MM-DD) for image ${ve+1}:`)||"";return{image:ae,productName:ye,expectedExpiration:Me}})),Z=await xw(O);w({verifications:Z}),N("Expiration verification completed!","success");break}}catch(A){const I=A instanceof Error?A.message:"An unknown error occurred.";p(I),N(`Error: ${I}`,"error")}finally{c(!1)}},U=()=>{if(!v)return null;switch(r){case"insights":const A=v;return d.jsxs("div",{className:"mt-6 space-y-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:"Visual Insights"}),A.insights.length>0&&d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Key Insights"}),d.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:A.insights.map((J,O)=>d.jsx("li",{children:J},O))})]}),A.riskItems.length>0&&d.jsxs("div",{className:"bg-red-900/20 p-4 rounded-lg border border-red-700",children:[d.jsx("h4",{className:"text-red-400 font-medium mb-2",children:"Risk Items"}),d.jsx("ul",{className:"space-y-2",children:A.riskItems.map((J,O)=>d.jsxs("li",{className:"text-sm text-gray-300",children:[d.jsx("span",{className:"font-semibold",children:J.product}),": ",J.issue,d.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${J.severity==="high"?"bg-red-600":J.severity==="medium"?"bg-yellow-600":"bg-gray-600"}`,children:J.severity})]},O))})]})]});case"stock-estimation":const I=v;return d.jsxs("div",{className:"mt-6 space-y-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:"Stock Estimation Results"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Estimated Quantity"}),d.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:I.estimatedQuantity})]}),d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Confidence"}),d.jsxs("p",{className:"text-2xl font-bold text-cyan-400",children:[(I.confidence*100).toFixed(0),"%"]})]}),d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Visible Units"}),d.jsx("p",{className:"text-2xl font-bold text-white",children:I.visibleUnits})]}),d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Shelf Fullness"}),d.jsxs("p",{className:"text-2xl font-bold text-white",children:[I.shelfFullness,"%"]})]})]}),d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Reasoning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:I.reasoning})]}),d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Visual Analysis"}),d.jsx("p",{className:"text-gray-300 text-sm",children:I.visualAnalysis})]})]});case"quality-assessment":const P=v,B=P.qualityScore>=80?"text-green-400":P.qualityScore>=60?"text-yellow-400":"text-red-400";return d.jsxs("div",{className:"mt-6 space-y-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:"Quality Assessment"}),d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Quality Score"}),d.jsxs("p",{className:`text-4xl font-bold ${B}`,children:[P.qualityScore,"/100"]})]}),P.issues.length>0&&d.jsxs("div",{className:"bg-red-900/20 p-4 rounded-lg border border-red-700",children:[d.jsx("h4",{className:"text-red-400 font-medium mb-2",children:"Issues Found"}),d.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:P.issues.map((J,O)=>d.jsx("li",{children:J},O))})]}),P.recommendations.length>0&&d.jsxs("div",{className:"bg-cyan-900/20 p-4 rounded-lg border border-cyan-700",children:[d.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Recommendations"}),d.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:P.recommendations.map((J,O)=>d.jsx("li",{children:J},O))})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Packaging"}),d.jsx("p",{className:"text-lg font-semibold text-white capitalize",children:P.packagingIntegrity})]}),d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Damage Detected"}),d.jsx("p",{className:`text-lg font-semibold ${P.damageDetected?"text-red-400":"text-green-400"}`,children:P.damageDetected?"Yes":"No"})]})]}),P.expirationDate&&d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsx("p",{className:"text-sm text-gray-400",children:"Detected Expiration"}),d.jsx("p",{className:"text-lg font-semibold text-white",children:P.expirationDate})]})]});case"visual-search":const H=v;return d.jsxs("div",{className:"mt-6 space-y-4",children:[d.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Search Results (",H.count," items found)"]}),H.items.length>0?d.jsx("div",{className:"space-y-2",children:H.items.map((J,O)=>d.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[d.jsxs("p",{className:"font-semibold text-white",children:["Product ID: ",J.productId]}),d.jsxs("p",{className:"text-sm text-gray-400",children:["Quantity: ",J.quantity," | Expiration: ",J.expirationDate]})]},O))}):d.jsx("p",{className:"text-gray-400",children:"No matching items found in inventory."})]});case"expiration-verify":const Q=v;return d.jsxs("div",{className:"mt-6 space-y-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:"Expiration Verification Results"}),d.jsx("div",{className:"space-y-3",children:Q.verifications.map((J,O)=>d.jsxs("div",{className:`p-4 rounded-lg border ${J.match?"bg-green-900/20 border-green-700":"bg-red-900/20 border-red-700"}`,children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("p",{className:"font-semibold text-white",children:J.productName}),d.jsx("span",{className:`px-2 py-1 rounded text-xs ${J.match?"bg-green-600":"bg-red-600"}`,children:J.match?"Match":"Mismatch"})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Expected"}),d.jsx("p",{className:"text-white",children:J.expectedExpiration})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Detected"}),d.jsx("p",{className:"text-white",children:J.detectedExpiration||"Not visible"})]})]}),J.discrepancy&&d.jsx("p",{className:"text-red-400 text-sm mt-2",children:J.discrepancy})]},O))})]});default:return null}};return d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsxs("h2",{className:"text-xl font-semibold mb-4 text-white flex items-center",children:[d.jsx(ww,{className:"w-6 h-6 mr-2 text-cyan-400"}),"Multi-Modal AI Visual Analysis"]}),d.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use AI-powered visual analysis to gain insights from shelf photos, assess product quality, estimate stock levels, and more."}),d.jsx("div",{className:"mb-4 flex flex-wrap gap-2",children:["insights","stock-estimation","quality-assessment","visual-search","expiration-verify"].map(A=>d.jsx("button",{onClick:()=>{a(A),w(null),x([]),p(null),E(!1)},className:`px-3 py-2 rounded-md text-sm font-medium transition ${r===A?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:A.split("-").map(I=>I.charAt(0).toUpperCase()+I.slice(1)).join(" ")},A))}),d.jsxs("div",{className:"mb-4",children:[d.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Capture Image ",r==="insights"||r==="expiration-verify"?"(Can capture multiple)":"(Single capture)"]}),d.jsxs("button",{onClick:()=>E(!0),disabled:_||o,className:"w-full flex items-center justify-center gap-2 py-3 px-4 border border-gray-600 rounded-md text-sm font-medium text-gray-200 bg-gray-700/50 hover:bg-gray-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[d.jsx(Fs,{className:"w-5 h-5"}),h.length>0?`Re-capture Image (${h.length} captured)`:"Capture Image with Camera"]}),h.length>0&&d.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[h.length,' image(s) ready for analysis. Click "Analyze Images" to process.']})]}),_&&d.jsx(Fa,{mode:"visual-search",productOptions:[],onDataScanned:A=>{if(A.blobs&&A.blobs.size>0){const I=A.blobs.get("productName")||Array.from(A.blobs.values())[0];I?D(I):(N("Failed to capture image. Please try again.","error"),E(!1))}else N("Failed to capture image. Please try again.","error"),E(!1)},onClose:()=>E(!1)}),d.jsx("button",{onClick:k,disabled:o||h.length===0,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:o?"Analyzing...":"Analyze Images"}),f&&d.jsx("div",{className:"mt-4 p-3 bg-red-900/50 border border-red-700 rounded-lg",children:d.jsx("p",{className:"text-red-400 text-sm",children:f})}),o&&d.jsxs("div",{className:"flex items-center justify-center my-4 p-4 bg-gray-900/50 rounded-lg",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"}),d.jsx("p",{className:"ml-3 text-cyan-400",children:"AI is analyzing your images..."})]}),U()]})},f3=({summaries:t,onNavigateToInventory:e,onRefreshData:n})=>{const[r,a]=C.useState(!1),[o,c]=C.useState([]),[f,p]=C.useState([]),{showToast:h}=Fn();C.useEffect(()=>{(async()=>{try{const _=await eh();c(_);try{const{getActiveShopId:E}=await uw(async()=>{const{getActiveShopId:D}=await Promise.resolve().then(()=>bD);return{getActiveShopId:D}},void 0),N=E();if(N){const D=await Av(N);p(D)}}catch(E){console.warn("Could not load sales history:",E)}}catch(_){console.error("Error loading inventory data:",_)}})()},[t]);const x=async()=>{var w,_,E,N,D,k,U,A,I;if(confirm("This will create sample products, suppliers, batches, and inventory items. Continue?")){a(!0);try{const P=[{name:"Organic Milk - Whole",manufacturer:"Fresh Dairy Co.",category:"Dairy",description:"Fresh organic whole milk, 1 gallon",imageUrl:"https://images.unsplash.com/photo-1563636619-e9143da7973b?w=200"},{name:"Whole Wheat Bread",manufacturer:"Baker's Delight",category:"Bakery",description:"Fresh baked whole wheat bread, 1 loaf",imageUrl:"https://images.unsplash.com/photo-1509440159596-0249088772ff?w=200"},{name:"Bananas - Organic",manufacturer:"Tropical Farms",category:"Produce",description:"Organic bananas, 1 bunch (~2 lbs)",imageUrl:"https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=200"},{name:"Chicken Breast - Free Range",manufacturer:"Farm Fresh Poultry",category:"Meat",description:"Free range chicken breast, 1 lb",imageUrl:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=200"},{name:"Organic Eggs - Large",manufacturer:"Happy Hens Farm",category:"Dairy",description:"Organic large eggs, 12 count",imageUrl:"https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?w=200"},{name:"Tomatoes - Roma",manufacturer:"Garden Fresh",category:"Produce",description:"Fresh Roma tomatoes, 1 lb",imageUrl:"https://images.unsplash.com/photo-1546470427-e26264be0b01?w=200"}],B=[{name:"Fresh Dairy Co.",contactEmail:"orders@fresherdairy.com"},{name:"Baker's Delight",contactEmail:"supply@bakersdelight.com"},{name:"Tropical Farms",contactEmail:"sales@tropicalfarms.com"},{name:"Farm Fresh Poultry",contactEmail:"info@farmfreshpoultry.com"},{name:"Happy Hens Farm",contactEmail:"orders@happyhens.com"},{name:"Garden Fresh",contactEmail:"wholesale@gardenfresh.com"},{name:"Organic Foods Dist.",contactEmail:"sales@organicfoods.com"},{name:"Premium Meats Co.",contactEmail:"orders@premiummeats.com"}],H=[];for(const M of B)try{const q=await Ui(M);H.push(q)}catch(q){console.warn("Failed to create supplier:",q)}const Q=[];for(let M=0;M<P.length;M++){const q=P[M],K=H.find(ie=>ie.name.toLowerCase().includes(q.manufacturer.toLowerCase().split(" ")[0]))||H[M]||H[0];try{const ie=q.imageUrl?[{url:q.imageUrl,type:"manual",source:"user",addedAt:new Date().toISOString()}]:[],de=await ki({...q,defaultSupplierId:K==null?void 0:K.id,images:ie});Q.push(de)}catch(ie){console.warn("Failed to create product:",ie)}}const J=new Date,O=new Date(J);O.setDate(O.getDate()-7);const Z=new Date(J);Z.setDate(Z.getDate()-5);const ae=Q.slice(0,3).map(M=>({productId:M.id,productName:M.name,quantity:Math.floor(Math.random()*80)+20,cost:Math.random()*8+2})),ve=await Oa({supplierId:(w=H[0])==null?void 0:w.id,deliveryDate:O.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-1`,documents:[],lineItems:ae}),ye=Q.slice(0,2).map(M=>({productId:M.id,productName:M.name,quantity:Math.floor(Math.random()*60)+15,cost:Math.random()*10+3})),Me=await Oa({supplierId:(_=H[1])==null?void 0:_.id,deliveryDate:Z.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-2`,documents:[],lineItems:ye}),R=Q.slice(3,6).map(M=>({productId:M.id,productName:M.name,quantity:Math.floor(Math.random()*70)+20,cost:Math.random()*9+2})),G=await Oa({supplierId:((E=H[3])==null?void 0:E.id)||((N=H[2])==null?void 0:N.id)||((D=H[0])==null?void 0:D.id),deliveryDate:O.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-3`,documents:[],lineItems:R}),X=ae.map((M,q)=>{var ne;const K=Q[q],ie=[7,14,21,30][Math.floor(Math.random()*4)],de=new Date(J);de.setDate(de.getDate()+ie);const me=M.cost,Te=me*1.5;return{productName:K.name,manufacturer:K.manufacturer,category:K.category,quantity:M.quantity,quantityType:"units",costPerUnit:me,buyPrice:me,sellPrice:Te,expirationDate:de.toISOString().split("T")[0],location:["A-1","B-2","C-3"][Math.floor(Math.random()*3)],images:K.images||[],supplierId:(ne=H[0])==null?void 0:ne.id,scanMetadata:null}}),ce=ye.map((M,q)=>{var ne;const K=Q[q],ie=[10,17,24,31][Math.floor(Math.random()*4)],de=new Date(J);de.setDate(de.getDate()+ie);const me=M.cost,Te=me*1.5;return{productName:K.name,manufacturer:K.manufacturer,category:K.category,quantity:M.quantity,quantityType:"units",costPerUnit:me,buyPrice:me,sellPrice:Te,expirationDate:de.toISOString().split("T")[0],location:["D-1","E-2","F-3"][Math.floor(Math.random()*3)],images:K.images||[],supplierId:(ne=H[1])==null?void 0:ne.id,scanMetadata:null}}),re=R.map((M,q)=>{var ne,ee,be;const K=Q[3+q],ie=[7,14,21,30][Math.floor(Math.random()*4)],de=new Date(J);de.setDate(de.getDate()+ie);const me=M.cost,Te=me*1.5;return{productName:K.name,manufacturer:K.manufacturer,category:K.category,quantity:M.quantity,quantityType:"units",costPerUnit:me,buyPrice:me,sellPrice:Te,expirationDate:de.toISOString().split("T")[0],location:["G-1","H-2","I-3"][Math.floor(Math.random()*3)],images:K.images||[],supplierId:((ne=H[3])==null?void 0:ne.id)||((ee=H[2])==null?void 0:ee.id)||((be=H[0])==null?void 0:be.id),scanMetadata:null}});await Ci({supplier:((k=H[0])==null?void 0:k.name)||"Test Supplier",deliveryDate:O.toISOString().split("T")[0],inventoryDate:J.toISOString().split("T")[0]},X),await Ci({supplier:((U=H[1])==null?void 0:U.name)||"Test Supplier 2",deliveryDate:Z.toISOString().split("T")[0],inventoryDate:J.toISOString().split("T")[0]},ce),await Ci({supplier:((A=H[3])==null?void 0:A.name)||((I=H[2])==null?void 0:I.name)||"Test Supplier 3",deliveryDate:O.toISOString().split("T")[0],inventoryDate:J.toISOString().split("T")[0]},re),h(`Test data created: ${H.length} suppliers, ${Q.length} products, 3 batches, ${X.length+ce.length+re.length} inventory items`,"success"),n&&await n()}catch(P){console.error("Error creating test data:",P),h("Failed to create test data: "+(P instanceof Error?P.message:"Unknown error"),"error")}finally{a(!1)}}},v=C.useMemo(()=>{const w=t.reduce((U,A)=>{const I=A.averageCostPerUnit||0;return U+A.totalQuantity*I},0),_=t.length,E=new Date;E.setHours(0,0,0,0);const N=new Date;N.setDate(E.getDate()+30),N.setHours(23,59,59,999);const D=t.filter(U=>{const A=new Date(U.earliestExpiration);return A.setHours(0,0,0,0),A>=E&&A<=N}),k=t.filter(U=>{const A=new Date(U.earliestExpiration);return A.setHours(0,0,0,0),A<E});return{totalValue:w,uniqueProducts:_,expiringSoon:D.length,expired:k.length,expiringSoonList:D,expiredList:k}},[t]);return d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold text-white",children:"Dashboard"}),d.jsx("p",{className:"text-lg text-gray-400",children:"A high-level overview of your inventory status."})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[d.jsx("div",{className:"p-3 bg-cyan-900/50 rounded-lg",children:d.jsx(t3,{className:"w-8 h-8 text-cyan-400"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Total Inventory Value"}),d.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",v.totalValue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[d.jsx("div",{className:"p-3 bg-cyan-900/50 rounded-lg",children:d.jsx(dw,{className:"w-8 h-8 text-cyan-400"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Unique Products"}),d.jsx("p",{className:"text-2xl font-bold text-white",children:v.uniqueProducts})]})]}),d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[d.jsx("div",{className:"p-3 bg-red-900/50 rounded-lg",children:d.jsx(Ai,{className:"w-8 h-8 text-red-400"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Expiring in 30 Days"}),d.jsxs("p",{className:"text-2xl font-bold text-white",children:[v.expiringSoon," items"]}),v.expired>0&&d.jsxs("p",{className:"text-xs text-red-400 mt-1",children:[v.expired," expired"]})]})]})]}),(v.expired>0||v.expiringSoon>0)&&d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-red-700",children:[d.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[d.jsx(Ai,{className:"w-6 h-6 text-red-400"}),"Expiration Alerts"]}),v.expired>0&&d.jsxs("div",{className:"mb-4",children:[d.jsxs("p",{className:"text-red-400 font-semibold mb-2",children:[" Expired Items (",v.expired,")"]}),d.jsx("ul",{className:"space-y-2",children:v.expiredList.slice(0,5).map(w=>d.jsxs("li",{className:"text-sm p-2 bg-red-900/30 rounded-md",children:[d.jsx("span",{className:"text-white font-medium",children:w.productName}),d.jsxs("span",{className:"text-red-300 ml-2",children:["Expired: ",w.earliestExpiration]})]},w.productName))})]}),v.expiringSoon>0&&d.jsxs("div",{children:[d.jsxs("p",{className:"text-yellow-400 font-semibold mb-2",children:[" Expiring Soon (",v.expiringSoon,")"]}),d.jsx("ul",{className:"space-y-2",children:v.expiringSoonList.slice(0,5).map(w=>{const _=new Date(w.earliestExpiration),E=Math.ceil((_.getTime()-new Date().getTime())/(1e3*60*60*24));return d.jsxs("li",{className:"text-sm p-2 bg-yellow-900/30 rounded-md",children:[d.jsx("span",{className:"text-white font-medium",children:w.productName}),d.jsxs("span",{className:"text-yellow-300 ml-2",children:["Expires in ",E," days: ",w.earliestExpiration]})]},w.productName)})})]})]}),d.jsx(d3,{inventoryData:o,salesHistory:f,productCatalog:t}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Quick Actions"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:e,className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Add New Inventory Batch"}),t.length===0&&d.jsx("button",{onClick:x,disabled:r,className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Creating Test Data...":" Create Test Data"})]})]}),d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Recently Added Products"}),t.length>0?d.jsx("ul",{className:"space-y-3",children:t.slice(0,3).map(w=>d.jsxs("li",{className:"flex justify-between items-center text-sm p-3 bg-gray-900/50 rounded-md",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-white",children:w.productName}),d.jsx("p",{className:"text-gray-400",children:w.manufacturer})]}),d.jsxs("div",{className:"text-right",children:[d.jsxs("p",{className:"font-bold text-white",children:[w.totalQuantity," ",w.quantityType]}),d.jsxs("p",{className:"text-gray-400",children:["Exp: ",w.earliestExpiration]})]})]},w.productName))}):d.jsx("p",{className:"text-center text-gray-500 py-4",children:"No inventory data available."})]})]})]})},Sr=t=>{if(!t)return"N/A";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toISOString().split("T")[0]},h3=t=>{const e=t.trim().split(" ");return e.length===1?e[0].slice(0,2).toUpperCase():(e[0][0]+e[e.length-1][0]).toUpperCase()},Nx=7,Cx=10,p3=({summaries:t,inventoryItems:e,onSelectProduct:n,onEditItem:r,onDeleteItem:a})=>{var A;const[o,c]=C.useState([]),[f,p]=C.useState(""),[h,x]=C.useState("all"),[v,w]=C.useState({});C.useEffect(()=>{(async()=>{try{const P=await Ys();c(P)}catch(P){console.error("Failed to load suppliers:",P)}})()},[]);const _=C.useMemo(()=>f?t.filter(I=>I.supplierIds&&I.supplierIds.includes(f)):t,[t,f]),E=C.useMemo(()=>{if(h==="all")return _;const I=new Date,P=1e3*60*60*24;return _.filter(B=>{if(h==="expiringSoon"){const H=new Date(B.earliestExpiration);if(Number.isNaN(H.getTime()))return!1;const Q=Math.ceil((H.getTime()-I.getTime())/P);return Q>=0&&Q<=Nx}return h==="lowStock"?B.totalQuantity<=Cx:!0})},[_,h]);if(!t.length)return d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[d.jsx("p",{className:"mb-4",children:"Your inventory is empty. Products need inventory items (stock) to appear here."}),d.jsxs("div",{className:"mt-4 p-4 bg-gray-900/50 rounded-lg text-left text-sm",children:[d.jsx("p",{className:"text-yellow-400 font-semibold mb-2",children:" How to add inventory:"}),d.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-gray-300",children:[d.jsx("li",{children:"Use the form on the left to add inventory items for existing products"}),d.jsx("li",{children:'Or use the "Batches" tab to log a delivery batch with multiple items'}),d.jsx("li",{children:"Products from Product Catalog need inventory items added to show up here"})]})]})]});if(t.length>0&&!E.length)return d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[d.jsx("p",{className:"mb-2",children:"No products match the current filters."}),d.jsx("p",{className:"text-sm text-gray-400",children:"Try clearing the supplier or inventory filter above to see the full inventory list."})]});const D=I=>!I||I.length===0?[]:I.map(P=>{var B;return(B=o.find(H=>H.id===P))==null?void 0:B.name}).filter(P=>!!P),k=C.useMemo(()=>{const I=new Map;return e.forEach(P=>{const B=I.get(P.productId)||[];B.push(P),I.set(P.productId,B)}),I},[e]),U=I=>{w(P=>({...P,[I]:!P[I]}))};return d.jsxs("div",{children:[d.jsx("div",{className:"flex items-center justify-end mb-4",children:d.jsxs("div",{className:"flex flex-col gap-3 text-sm text-gray-300 md:flex-row md:items-center",children:[o.length>0&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("label",{children:"Supplier:"}),d.jsxs("select",{value:f,onChange:I=>p(I.target.value),className:"px-3 py-1.5 rounded-md bg-gray-900 border border-gray-700 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[d.jsx("option",{value:"",children:"All Suppliers"}),o.map(I=>d.jsx("option",{value:I.id,children:I.name},I.id))]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("label",{children:"Inventory filter:"}),d.jsxs("select",{value:h,onChange:I=>x(I.target.value),className:"px-3 py-1.5 rounded-md bg-gray-900 border border-gray-700 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[d.jsx("option",{value:"all",children:"All items"}),d.jsxs("option",{value:"expiringSoon",children:["Expiring in  ",Nx," days"]}),d.jsxs("option",{value:"lowStock",children:["Low stock ( ",Cx,")"]})]})]})]})}),f&&d.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Showing ",E.length," product(s) from ",((A=o.find(I=>I.id===f))==null?void 0:A.name)||"selected supplier"]}),d.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:E.map(I=>{const P=D(I.supplierIds),B=k.get(I.productId)||[],H=v[I.productId];return d.jsxs("div",{onClick:()=>n(I),className:"bg-gray-800/60 border border-gray-700 rounded-xl overflow-hidden text-left hover:border-cyan-500 transition cursor-pointer",children:[d.jsx("div",{className:"h-32 bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-3xl font-bold text-gray-300",children:h3(I.productName)}),d.jsxs("div",{className:"p-4 space-y-2",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-lg font-semibold text-white",children:I.productName}),d.jsx("p",{className:"text-sm text-gray-400",children:I.manufacturer})]}),d.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300",children:[d.jsxs("span",{className:"font-medium text-white",children:[I.totalQuantity," ",I.quantityType]}),d.jsxs("span",{className:"text-xs uppercase tracking-wide text-gray-400",children:["Exp: ",Sr(I.earliestExpiration)]})]}),P.length>0&&d.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[d.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Suppliers:"}),d.jsx("div",{className:"flex flex-wrap gap-1",children:P.map((Q,J)=>d.jsx("span",{className:"px-2 py-0.5 text-xs bg-cyan-900/30 text-cyan-300 rounded border border-cyan-700/50",children:Q},J))})]}),d.jsx("p",{className:"text-xs text-gray-500",children:"Location: Not set"}),B.length>0&&d.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-2",children:[d.jsxs("span",{children:[B.length," inventory item",B.length>1?"s":""]}),d.jsx("button",{onClick:Q=>{Q.stopPropagation(),U(I.productId)},className:"text-cyan-300 hover:text-cyan-200",children:H?"Hide items":"Manage items"})]}),H&&d.jsx("div",{className:"space-y-2",children:B.map(Q=>d.jsxs("div",{className:"p-2 bg-gray-900/60 rounded text-xs text-gray-300 border border-gray-800 flex flex-col gap-1",onClick:J=>J.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsxs("span",{children:["Qty: ",Q.quantity," ",Q.quantityType]}),d.jsxs("span",{children:["Exp: ",Sr(Q.expirationDate)]})]}),d.jsxs("div",{className:"flex justify-between text-gray-400",children:[d.jsx("span",{children:Q.location?`Loc: ${Q.location}`:"Location N/A"}),d.jsxs("span",{children:["$",Q.costPerUnit.toFixed(2),"/unit"]})]}),d.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[d.jsx("button",{onClick:J=>{J.stopPropagation(),r(Q)},disabled:!Q.inventoryUuid,className:"px-2 py-1 rounded bg-gray-700 text-white disabled:opacity-40 disabled:cursor-not-allowed",children:"Edit"}),d.jsx("button",{onClick:J=>{J.stopPropagation(),a(Q)},disabled:!Q.inventoryUuid,className:"px-2 py-1 rounded bg-red-700/80 text-white disabled:opacity-40 disabled:cursor-not-allowed",children:"Delete"})]})]},Q.inventoryUuid||Q.id))})]})]})]},I.productId)})})]})},m3=({inventory:t,batches:e,onEditRequest:n,onDeleteRequest:r})=>t.length===0?d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[d.jsx("h2",{className:"text-xl font-semibold mb-2 text-white",children:"Current Inventory"}),d.jsx("p",{children:"Your inventory is empty. Add items using the form to see them here."})]}):d.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700 overflow-hidden",children:[d.jsx("h2",{className:"text-xl font-semibold text-white p-6",children:"Current Inventory"}),d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[d.jsx("thead",{className:"bg-gray-800",children:d.jsxs("tr",{children:[d.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-6",children:"Product Name"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Manufacturer"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Exp. Date"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Quantity"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Supplier"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Cost/Unit"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-right text-sm font-semibold text-gray-300",children:"Actions"})]})}),d.jsx("tbody",{className:"divide-y divide-gray-700 bg-gray-900/50",children:t.map(a=>{var o;return d.jsxs("tr",{className:"hover:bg-gray-800 transition-colors",children:[d.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-6",children:a.productName}),d.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:a.manufacturer}),d.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:Sr(a.expirationDate)}),d.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:[a.quantity," ",a.quantityType]}),d.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:((o=e.find(c=>c.id===a.batchId))==null?void 0:o.supplier)||"N/A"}),d.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:["$",a.costPerUnit.toFixed(2)]}),d.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-right text-gray-400",children:d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx("button",{onClick:()=>n(a),disabled:!a.inventoryUuid,className:"px-3 py-1 rounded-md bg-gray-700 text-white text-xs hover:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed",children:"Edit"}),d.jsx("button",{onClick:()=>r(a),disabled:!a.inventoryUuid,className:"px-3 py-1 rounded-md bg-red-700/70 text-white text-xs hover:bg-red-700 disabled:opacity-40 disabled:cursor-not-allowed",children:"Delete"})]})})]},a.id)})})]})})]}),g3=({items:t,batches:e})=>{const[n,r]=C.useState(""),[a,o]=C.useState(null),[c,f]=C.useState(!1),[p,h]=C.useState(null),x=["Which items expire in the next 30 days?","What is the total value of my current inventory?","Summarize stock levels by supplier.","Identify my most expensive items per unit."],v=async()=>{if(!n){h("Please enter a query for the report.");return}f(!0),h(null),o(null);try{const w=await hw(t,e,n);o(w)}catch(w){h(w instanceof Error?w.message:"An unknown error occurred.")}finally{f(!1)}};return d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsxs("h2",{className:"text-xl font-semibold mb-4 text-white flex items-center",children:[d.jsx(ww,{className:"w-6 h-6 mr-2 text-cyan-400"}),"Advanced Inventory Analysis (Gemini Pro)"]}),d.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use our most powerful model to get deep insights into your inventory. Ask complex questions to make better business decisions."}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{htmlFor:"analysis-prompt",className:"block text-sm font-medium text-gray-300 mb-2",children:"Your Analysis Request"}),d.jsx("textarea",{id:"analysis-prompt",rows:3,className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm",placeholder:"e.g., What is the total value of my current stock?",value:n,onChange:w=>r(w.target.value)})]}),d.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[d.jsx("span",{className:"text-sm text-gray-400 self-center",children:"Try:"}),x.map(w=>d.jsx("button",{onClick:()=>r(w),className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded-md hover:bg-cyan-800 hover:text-white transition-colors",children:w},w))]}),d.jsx("button",{onClick:v,disabled:c||t.length===0,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:c?"Thinking...":"Generate Report"}),t.length===0&&d.jsx("p",{className:"text-yellow-400 text-sm mt-2 text-center",children:"Add items to inventory to enable analysis."}),p&&d.jsx("p",{className:"text-red-400 text-sm mt-2",children:p}),c&&d.jsxs("div",{className:"flex items-center justify-center my-4 p-4 bg-gray-900/50 rounded-lg",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"}),d.jsx("p",{className:"ml-3 text-cyan-400",children:"Gemini Pro is processing your request..."})]}),a&&d.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Analysis Report"}),d.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-gray-300",dangerouslySetInnerHTML:{__html:a.replace(/\n/g,"<br />")}})]})]})},y3=({product:t,allItems:e,allBatches:n,onClose:r})=>{const a=h=>typeof h!="number"||Number.isNaN(h)?"N/A":`$${h.toFixed(2)}`,o=e.filter(h=>h.productName===t.productName).map(h=>{const x=n.find(v=>v.id===h.batchId);return{...h,batch:x}}).sort((h,x)=>new Date(h.expirationDate).getTime()-new Date(x.expirationDate).getTime()),c=C.useMemo(()=>o.reduce((h,x)=>{const v=typeof x.costPerUnit=="number"?x.costPerUnit:0;return h+v*x.quantity},0),[o]),f=t.totalQuantity>0?c/t.totalQuantity:0,p=C.useMemo(()=>{const h=new Map;return o.forEach(x=>{var k,U,A;const v=((k=x.batch)==null?void 0:k.id)??x.batchId??`line-${x.id}`,w=String(v),_=((U=x.batch)==null?void 0:U.supplier)??"N/A",E=(A=x.batch)==null?void 0:A.inventoryDate,N=typeof x.costPerUnit=="number"?x.costPerUnit:0,D=h.get(w)??{batchId:w,supplier:_,inventoryDate:E,quantity:0,totalValue:0};D.quantity+=x.quantity,D.totalValue+=N*x.quantity,D.supplier=_,D.inventoryDate=E,h.set(w,D)}),Array.from(h.values()).sort((x,v)=>x.batchId.localeCompare(v.batchId))},[o]);return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-center justify-center p-4",onClick:r,children:d.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",onClick:h=>h.stopPropagation(),children:[d.jsxs("div",{className:"p-6 border-b border-gray-700",children:[d.jsxs("div",{className:"flex justify-between items-start",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold text-white",children:t.productName}),d.jsx("p",{className:"text-sm text-gray-400",children:t.manufacturer})]}),d.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white transition-colors",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),d.jsxs("div",{className:"mt-4 flex space-x-8 text-sm",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Total Quantity"}),d.jsxs("p",{className:"text-white font-semibold text-lg",children:[t.totalQuantity," ",t.quantityType]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Earliest Expiration"}),d.jsx("p",{className:"text-yellow-400 font-semibold text-lg",children:Sr(t.earliestExpiration)})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Average Unit Cost"}),d.jsx("p",{className:"text-cyan-400 font-semibold text-lg",children:a(f)})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Inventory Value"}),d.jsx("p",{className:"text-green-400 font-semibold text-lg",children:a(c)})]})]})]}),d.jsxs("div",{className:"p-6 overflow-y-auto",children:[d.jsx("h3",{className:"text-lg font-semibold text-cyan-400 mb-3",children:"Batch Details (First-Expired, First-Out)"}),d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[d.jsx("thead",{className:"bg-gray-800",children:d.jsxs("tr",{children:[d.jsx("th",{scope:"col",className:"py-3 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-0",children:"Quantity"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Exp. Date"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Supplier"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Inventory Date"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Cost / Unit"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Buy Price"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Sell Price"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Line Value"}),d.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Batch"})]})}),d.jsx("tbody",{className:"divide-y divide-gray-700",children:o.map(h=>{var x,v,w;return d.jsxs("tr",{children:[d.jsxs("td",{className:"py-3 pl-4 pr-3 text-sm text-white sm:pl-0",children:[h.quantity," ",h.quantityType]}),d.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:Sr(h.expirationDate)}),d.jsx("td",{className:"px-3 py-3 text-sm text-gray-400",children:((x=h.batch)==null?void 0:x.supplier)??"N/A"}),d.jsx("td",{className:"px-3 py-3 text-sm text-gray-400",children:Sr((v=h.batch)==null?void 0:v.inventoryDate)}),d.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a(h.costPerUnit)}),d.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a(h.buyPrice)}),d.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:typeof h.sellPrice=="number"?a(h.sellPrice):""}),d.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a((h.costPerUnit||0)*h.quantity)}),d.jsx("td",{className:"px-3 py-3 text-xs text-gray-500",children:((w=h.batch)==null?void 0:w.id)??String(h.batchId)})]},h.id)})})]})}),p.length>0&&d.jsxs("div",{className:"mt-6",children:[d.jsx("h4",{className:"text-md font-semibold text-gray-200 mb-3",children:"Cost Overview by Batch"}),d.jsx("div",{className:"space-y-3",children:p.map(h=>d.jsxs("div",{className:"p-4 bg-gray-900/40 border border-gray-700 rounded-lg flex flex-wrap gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Batch"}),d.jsx("p",{className:"text-white font-semibold",children:h.batchId})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Supplier"}),d.jsx("p",{className:"text-white",children:h.supplier})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Inventory Date"}),d.jsx("p",{className:"text-white",children:Sr(h.inventoryDate)})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Quantity"}),d.jsxs("p",{className:"text-white",children:[h.quantity," ",t.quantityType]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400",children:"Batch Value"}),d.jsx("p",{className:"text-green-400 font-semibold",children:a(h.totalValue)})]})]},h.batchId))})]}),d.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-cyan-800/50",children:[d.jsx("h4",{className:"font-semibold text-cyan-500",children:"POS Integration Note"}),d.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'The list above is sorted by expiration date. For a "First-Expired, First-Out" (FEFO) strategy, a Point-of-Sale system would automatically deduct sold items from the top of this list, ensuring optimal stock rotation and minimizing waste.'})]})]})]})})},Ew=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),d.jsx("polyline",{points:"17 8 12 3 7 8"}),d.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),Bd={supplier:"",deliveryDate:"",inventoryDate:new Date().toISOString().split("T")[0]},Ax={productName:"",manufacturer:"",category:"",productDescription:"",productId:void 0,supplierId:void 0,expirationDate:"",quantity:0,quantityType:"units",costPerUnit:0,location:"",buyPrice:0,sellPrice:void 0,images:[],scanMetadata:null,shareScope:["local"]},x3=({onAddBatch:t,summaries:e,pendingScanResult:n})=>{const[r,a]=C.useState(Bd),[o,c]=C.useState(Ax),[f,p]=C.useState([]),[h,x]=C.useState(!1),[v,w]=C.useState(null),[_,E]=C.useState(null),[N,D]=C.useState(!1),k=C.useRef(null),[U,A]=C.useState(new Map),[I,P]=C.useState(new Map),[B,H]=C.useState([]),[Q,J]=C.useState([]),[O,Z]=C.useState(""),[ae,ve]=C.useState(""),[ye,Me]=C.useState("existing"),[R,G]=C.useState("existing"),[X,ce]=C.useState({name:"",email:""}),[re,M]=C.useState(!1),[q,K]=C.useState(null),[ie,de]=C.useState(!1),me=C.useRef(null),Te=C.useRef(!1),ne=C.useMemo(()=>{const le=new Map;return B.forEach(oe=>{le.set(oe.name,{productId:oe.id,productName:oe.name})}),e.forEach(oe=>{le.has(oe.productName)||le.set(oe.productName,{productId:oe.productId,productName:oe.productName})}),Array.from(le.values())},[B,e]),ee=C.useCallback(le=>{const oe=new Set(["local"]);return(le||[]).forEach(Ie=>Ie&&oe.add(Ie)),Array.from(oe)},[]),be=C.useCallback(le=>le?le.toLowerCase().trim().replace(/[^a-z0-9]+/gi,"-"):"unlabeled-product",[]),he=C.useCallback((le,oe)=>{c(Ie=>{const He=new Set(ee(Ie.shareScope));return oe?He.add(le):He.delete(le),He.size||He.add("local"),{...Ie,shareScope:Array.from(He)}})},[ee]);C.useEffect(()=>()=>{I.forEach(le=>URL.revokeObjectURL(le))},[I]),C.useEffect(()=>{ye==="new"&&(Z(""),c(le=>({...le,productId:void 0})))},[ye]),C.useEffect(()=>{R==="new"&&(ve(""),c(le=>({...le,supplierId:void 0})))},[R]);const Ee=C.useCallback(async()=>{try{const[le,oe]=await Promise.all([ec(),Ys()]);H(le),J(oe)}catch(le){console.error("Failed to load reference data",le)}},[]);C.useEffect(()=>{Ee()},[Ee]);const ze=C.useCallback(async le=>{E(URL.createObjectURL(le)),x(!0),w(null);try{const oe=await sc(le);a(Ie=>({...Ie,supplier:Ie.supplier||oe.supplier||"",deliveryDate:Ie.deliveryDate||oe.deliveryDate||""})),c(Ie=>({...Ie,productName:oe.productName||"",manufacturer:oe.manufacturer||"",category:oe.category||"",expirationDate:oe.expirationDate||"",quantity:oe.quantity||0,quantityType:oe.quantityType||"units",costPerUnit:oe.costPerUnit||0}))}catch(oe){w(oe instanceof Error?oe.message:"An unknown error occurred.")}finally{x(!1)}},[]),Ke=C.useCallback(le=>{var Ie;const oe=(Ie=le.target.files)==null?void 0:Ie[0];oe&&ze(oe)},[ze]),st=C.useCallback(le=>{const{data:oe,blobs:Ie,identifiedProductId:He}=le;D(!1),E(null),k.current&&(k.current.value=""),K(le),I.forEach(De=>URL.revokeObjectURL(De));const $n=new Map;if(Ie.forEach((De,Tt)=>$n.set(Tt,URL.createObjectURL(De))),P($n),A(Ie),a(De=>({...De,supplier:De.supplier||oe.supplier||"",deliveryDate:De.deliveryDate||oe.deliveryDate||""})),He){const De=B.find(Tt=>Tt.id===He);if(De){de(!1),Me("existing"),Z(De.id),c(Tt=>({...Tt,productId:De.id,productName:De.name,manufacturer:De.manufacturer,category:De.category,productDescription:De.description||"",expirationDate:oe.expirationDate||Tt.expirationDate||"",quantity:oe.quantity||Tt.quantity||1,quantityType:oe.quantityType||Tt.quantityType||"units",costPerUnit:oe.costPerUnit||Tt.costPerUnit||0,buyPrice:oe.buyPrice||Tt.buyPrice||0,sellPrice:oe.sellPrice||Tt.sellPrice,location:oe.location||Tt.location||""}));return}}Me("new"),de(!0),c(De=>({...De,productName:oe.productName||De.productName||"",manufacturer:oe.manufacturer||De.manufacturer||"",category:oe.category||De.category||"",productDescription:oe.productDescription||De.productDescription||"",expirationDate:oe.expirationDate||De.expirationDate||"",quantity:oe.quantity||De.quantity||0,quantityType:oe.quantityType||De.quantityType||"units",costPerUnit:oe.costPerUnit||De.costPerUnit||0,buyPrice:oe.buyPrice||De.buyPrice||0,sellPrice:oe.sellPrice||De.sellPrice,location:oe.location||De.location||""}))},[I,B]);C.useEffect(()=>{n&&n!==me.current&&!Te.current&&(Te.current=!0,me.current=n,st(n),setTimeout(()=>{Te.current=!1},100))},[n]);const je=le=>{const{name:oe,value:Ie}=le.target;a(He=>({...He,[oe]:Ie}))},it=le=>{const{name:oe,value:Ie,type:He}=le.target,$n=He==="number";c(De=>({...De,[oe]:$n?parseFloat(Ie)||0:Ie}))},_t=le=>{var Ie;ve(le),c(He=>({...He,supplierId:le||void 0}));const oe=(Ie=Q.find(He=>He.id===le))==null?void 0:Ie.name;oe&&a(He=>({...He,supplier:oe}))},At=le=>{const{name:oe,value:Ie}=le.target;ce(He=>({...He,[oe]:Ie}))},On=async le=>{if(le.preventDefault(),!X.name.trim()){w("Supplier name is required.");return}M(!0),w(null);try{const oe=await Ui({name:X.name.trim(),contactEmail:X.email.trim()||void 0});await Ee(),G("existing"),ve(oe.id),c(Ie=>({...Ie,supplierId:oe.id})),a(Ie=>({...Ie,supplier:oe.name||oe.id})),ce({name:"",email:""})}catch(oe){w(oe instanceof Error?oe.message:"Failed to create supplier.")}finally{M(!1)}},Ln=async le=>{if(le.preventDefault(),o.productName&&o.quantity>0){let oe=[];if(U.size>0&&o.productName){x(!0),w(null);try{const De=await Promise.all(Array.from(U.entries()).map(async([qn,rc])=>{const ic=await Lf(o.productName,qn,rc,{productId:O||o.productId||be(o.productName),source:(q==null?void 0:q.fieldSources.get(qn))||"manual"});return{field:String(qn),captureId:ic,source:(q==null?void 0:q.fieldSources.get(qn))||"manual",confidence:q==null?void 0:q.fieldConfidences.get(qn)}})),Tt=new Date().toISOString();oe=De.map(qn=>({...qn,capturedAt:Tt}))}catch(De){console.error(De),w("Could not save scan images.")}finally{x(!1)}}const Ie=q?Array.from(q.fieldConfidences.values()).filter(De=>typeof De=="number"):[],He=Ie.length>0?Ie.reduce((De,Tt)=>De+Tt,0)/Ie.length:void 0,$n=oe.length?{confidence:He,fieldCaptures:oe}:He!==void 0?{confidence:He}:null;p(De=>[...De,{...o,productId:O||o.productId,supplierId:ae||o.supplierId,shareScope:ee(o.shareScope),scanMetadata:$n}]),c(Ax),Z(""),ve(""),E(null),K(null),de(!1),k.current&&(k.current.value=""),A(new Map),I.forEach(De=>URL.revokeObjectURL(De)),P(new Map),me.current=null,Te.current=!1}},Xt=()=>{f.length>0&&r.supplier&&r.deliveryDate?(t(r,f),a(Bd),p([])):w("Please add at least one item and fill in all batch details (Supplier, Delivery Date).")};return d.jsxs(d.Fragment,{children:[N&&d.jsx(Fa,{onDataScanned:st,onClose:()=>D(!1),productOptions:ne}),d.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm p-8 rounded-xl border border-gray-700/50 shadow-2xl",children:[d.jsxs("h2",{className:"text-2xl font-bold mb-6 text-white flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:d.jsx(rh,{className:"w-6 h-6 text-cyan-400"})}),"Add New Inventory Batch"]}),d.jsxs("div",{className:"space-y-6 p-6 bg-gray-900/40 border border-gray-700/50 rounded-xl mb-6 backdrop-blur-sm shadow-inner",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx("div",{className:"w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center",children:d.jsx("span",{className:"text-cyan-400 font-bold text-sm",children:"1"})}),d.jsx("h3",{className:"font-bold text-xl text-gray-100",children:"Batch Details"})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[d.jsxs("div",{className:"space-y-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700/30",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-semibold text-gray-200 mb-3",children:"Product Selection"}),d.jsx("div",{className:"flex gap-2 mb-4",children:["existing","new"].map(le=>d.jsx("button",{type:"button",onClick:()=>Me(le),className:`flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 ${ye===le?"bg-gradient-to-r from-cyan-600 to-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:le==="existing"?"Existing Product":"New Product"},le))})]}),ie&&ye==="new"&&d.jsx("div",{className:"p-3 bg-amber-500/10 border border-amber-500/40 rounded-lg text-sm text-amber-100",children:"New product detected. Review the static fields below so we can register it in the catalog when this batch is saved."}),ye==="existing"?d.jsx("div",{children:d.jsxs("select",{className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",value:O,onChange:le=>{const oe=le.target.value;if(Z(oe),!oe){c(He=>({...He,productId:void 0,productName:"",manufacturer:"",category:"",productDescription:""}));return}const Ie=B.find(He=>He.id===oe);Ie&&c(He=>({...He,productId:Ie.id,productName:Ie.name,manufacturer:Ie.manufacturer,category:Ie.category,productDescription:Ie.description||""}))},children:[d.jsx("option",{value:"",children:"Select from catalog"}),B.map(le=>d.jsxs("option",{value:le.id,children:[le.name,"  ",le.manufacturer]},le.id))]})}):d.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:d.jsx("p",{className:"text-sm text-blue-300",children:"Manual entry enabled. Fill in the product fields below to register a new product as you scan it."})})]}),d.jsxs("div",{className:"space-y-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700/30",children:[d.jsx("div",{className:"flex items-center justify-between gap-2 mb-2",children:d.jsx("p",{className:"text-sm font-semibold text-gray-200",children:"Supplier Management"})}),d.jsx("div",{className:"flex gap-2 mb-4",children:["existing","new"].map(le=>d.jsx("button",{type:"button",onClick:()=>G(le),className:`flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 ${R===le?"bg-gradient-to-r from-cyan-600 to-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:le==="existing"?"Choose Supplier":"Create Supplier"},le))}),R==="existing"?d.jsxs("select",{className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",value:ae,onChange:le=>_t(le.target.value),children:[d.jsx("option",{value:"",children:"Select Supplier"}),Q.map(le=>d.jsx("option",{value:le.id,children:le.name},le.id))]}):d.jsxs("form",{onSubmit:On,className:"space-y-3",children:[d.jsx("input",{name:"name",value:X.name,onChange:At,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",placeholder:"Supplier name"}),d.jsx("input",{type:"email",name:"email",value:X.email,onChange:At,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",placeholder:"Contact email (optional)"}),d.jsx("button",{type:"submit",disabled:re,className:"w-full px-4 py-2.5 rounded-lg bg-gradient-to-r from-cyan-600 to-cyan-500 text-white text-sm font-semibold disabled:opacity-60 hover:from-cyan-500 hover:to-cyan-400 transition-all shadow-lg shadow-cyan-500/20",children:re?"Creating...":"Create & Use Supplier"})]})]})]}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-700/50",children:Object.keys(Bd).map(le=>d.jsxs("div",{children:[d.jsx("label",{htmlFor:`batch-${le}`,className:"block text-sm font-medium text-gray-300 mb-2 capitalize",children:le.replace(/([A-Z])/g," $1")}),d.jsx("input",{type:le.includes("Date")?"date":"text",name:le,id:`batch-${le}`,value:r[le],onChange:je,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all shadow-sm"})]},le))})]}),d.jsxs("div",{className:"space-y-6 p-6 bg-gray-900/40 border border-gray-700/50 rounded-xl backdrop-blur-sm shadow-inner",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx("div",{className:"w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center",children:d.jsx("span",{className:"text-cyan-400 font-bold text-sm",children:"2"})}),d.jsx("h3",{className:"font-bold text-xl text-gray-100",children:"Add Items to Batch"})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("div",{className:"flex justify-center px-6 pt-6 pb-6 border-2 border-gray-600/50 border-dashed rounded-xl cursor-pointer hover:border-cyan-400/50 hover:bg-cyan-500/5 transition-all duration-200 group",onClick:()=>{var le;return(le=k.current)==null?void 0:le.click()},children:d.jsxs("div",{className:"space-y-2 text-center",children:[_?d.jsx("img",{src:_,alt:"Preview",className:"mx-auto h-32 w-auto rounded-lg object-cover shadow-lg"}):d.jsx("div",{className:"mx-auto p-4 bg-gray-800/50 rounded-full group-hover:bg-cyan-500/10 transition-all",children:d.jsx(Ew,{className:"h-10 w-10 text-gray-400 group-hover:text-cyan-400 transition-colors"})}),d.jsx("p",{className:"text-sm text-gray-400 group-hover:text-cyan-300 transition-colors",children:h?"Analyzing...":"Click to upload image"})]})}),d.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:Ke,ref:k,accept:"image/*"}),d.jsxs("button",{type:"button",onClick:()=>D(!0),className:"w-full flex items-center justify-center gap-2 py-3 px-4 border border-gray-600/50 rounded-lg text-sm font-semibold text-gray-200 bg-gray-700/30 hover:bg-gray-700/50 hover:border-cyan-500/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all shadow-sm",children:[d.jsx(Fs,{className:"w-5 h-5"}),"Live Scan Item"]})]}),h&&d.jsxs("div",{className:"flex items-center justify-center py-4",children:[d.jsx("div",{className:"animate-spin rounded-full h-7 w-7 border-2 border-cyan-400 border-t-transparent"}),d.jsx("p",{className:"ml-3 text-cyan-400 font-medium",children:"Extracting data..."})]}),v&&d.jsx("div",{className:"p-3 bg-red-900/30 border border-red-700/50 rounded-lg",children:d.jsx("p",{className:"text-red-400 text-sm",children:v})}),d.jsxs("form",{onSubmit:Ln,className:"space-y-5 pt-2",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Product Name"}),d.jsx("input",{name:"productName",value:o.productName,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!O})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Manufacturer"}),d.jsx("input",{name:"manufacturer",value:o.manufacturer,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!O})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),d.jsx("input",{name:"category",value:o.category,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!O})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Expiration Date"}),d.jsx("input",{type:"date",name:"expirationDate",value:o.expirationDate,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Product Description"}),d.jsx("textarea",{name:"productDescription",value:o.productDescription,onChange:it,rows:3,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all resize-none",disabled:!!O})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quantity"}),d.jsx("input",{type:"number",name:"quantity",value:o.quantity,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quantity Type"}),d.jsx("input",{name:"quantityType",value:o.quantityType,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),d.jsx("input",{name:"location",value:o.location,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Cost Per Unit"}),d.jsx("input",{type:"number",name:"costPerUnit",value:o.costPerUnit,onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Buy Price"}),d.jsx("input",{type:"number",name:"buyPrice",value:o.buyPrice??"",onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Sell Price"}),d.jsx("input",{type:"number",name:"sellPrice",value:o.sellPrice??"",onChange:it,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]})]}),fs&&d.jsxs("div",{className:"p-4 bg-cyan-900/10 border border-cyan-800/40 rounded-lg space-y-2",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("input",{id:"dan-sharing",type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-500 text-cyan-500 focus:ring-cyan-400 bg-gray-900",checked:(o.shareScope||[]).includes("dan"),onChange:le=>he("dan",le.target.checked)}),d.jsxs("label",{htmlFor:"dan-sharing",className:"text-sm text-gray-200",children:[d.jsx("span",{className:"font-semibold text-cyan-200",children:"Share with DAN network (beta)"}),d.jsx("span",{className:"block text-gray-400",children:"Broadcast anonymized surplus signals (product, quantity, expiration bucket, aisle zone) so trusted partners can discover this offer."})]})]}),d.jsx("p",{className:"text-xs text-gray-500 pl-7",children:"Provenance proofs are signed with your shop key. Disable anytime to keep inventory local-only."})]}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-indigo-600 to-indigo-500 hover:from-indigo-500 hover:to-indigo-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 disabled:from-gray-600 disabled:to-gray-600 disabled:cursor-not-allowed transition-all shadow-lg shadow-indigo-500/20",children:h?"Saving Scan...":"Add This Item"})]})]}),f.length>0&&d.jsxs("div",{className:"mt-6",children:[d.jsxs("h3",{className:"font-semibold text-lg text-gray-200 mb-2",children:["Items in this Batch (",f.length,")"]}),d.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto p-2 bg-gray-900/50 rounded-md",children:f.map((le,oe)=>{var Ie;return d.jsxs("li",{className:"text-sm text-gray-300 p-2 bg-gray-700/50 rounded-md flex justify-between items-center gap-3",children:[d.jsxs("span",{children:[le.quantity,"x ",le.productName]}),d.jsxs("span",{className:"flex items-center gap-2",children:[d.jsxs("span",{children:["Exp: ",le.expirationDate]}),((Ie=le.shareScope)==null?void 0:Ie.includes("dan"))&&d.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border border-cyan-600/40 bg-cyan-900/40 text-cyan-200",children:"DAN"})]})]},oe)})})]}),d.jsx("button",{onClick:Xt,disabled:f.length===0,className:"mt-6 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:"Finish and Save Batch"})]})]})},lh=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),d.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),v3=({summaries:t,onScanComplete:e,onClose:n})=>{const r=C.useRef(null),a=C.useRef(null),[o,c]=C.useState("idle"),[f,p]=C.useState(null),[h,x]=C.useState(null),[v,w]=C.useState(new Set),[_,E]=C.useState(0),{showToast:N}=Fn(),[D,k]=C.useState(!1),U=t.map(O=>O.productName),A=new Map(t.map(O=>[O.productName.toLowerCase(),O]));C.useEffect(()=>{let O=null;return(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){p("Camera not supported. Please use a modern browser on HTTPS.");return}try{O=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),r.current&&(r.current.srcObject=O)}catch{p("Could not access camera. Please grant permissions.")}})(),()=>{O&&O.getTracks().forEach(ae=>ae.stop())}},[]);const I=C.useCallback(async()=>{if(!r.current||!a.current)return null;const O=r.current,Z=a.current;Z.width=O.videoWidth,Z.height=O.videoHeight;const ae=Z.getContext("2d");return ae?(ae.drawImage(O,0,0,O.videoWidth,O.videoHeight),new Promise(ve=>Z.toBlob(ve,"image/jpeg",.85))):null},[]),P=C.useCallback(async()=>{c("scanning"),p(null),k(!1);const O=await I();if(!O){p("Failed to capture photo"),c("idle");return}c("processing");try{const Z=await vw(O,U);x(Z),c("results"),N(`Detected ${Z.totalProductsDetected} products on shelf!`,"success")}catch(Z){Z instanceof Sn?(k(!0),p(Z.message),c("idle")):(p(Z instanceof Error?Z.message:"Failed to scan shelf"),c("idle"))}},[I,U,N]),B=C.useCallback(async(O,Z)=>{const ae=tc();if(!ae)return N("No active shop context","error"),!1;const ve=(Z==null?void 0:Z.productId)||ht(),ye=new Date().toISOString(),Me=ht();let R=O.expirationDate;if(!R){const ce=new Date;ce.setDate(ce.getDate()+30),R=ce.toISOString().split("T")[0]}const G={ocrText:O.productName,confidence:O.confidence,sourcePhotoId:Me,fieldCaptures:[]},X={id:Date.now(),inventoryUuid:Me,shopId:ae,productId:ve,batchId:"",expirationDate:R,quantity:Math.max(1,Math.round(O.estimatedQuantity)),costPerUnit:(Z==null?void 0:Z.averageCostPerUnit)||0,buyPrice:(Z==null?void 0:Z.averageCostPerUnit)||0,sellPrice:Z!=null&&Z.averageCostPerUnit?Z.averageCostPerUnit*1.4:void 0,location:O.location,scanMetadata:G,qdrantId:Me,status:"ACTIVE",createdByUserId:ae,createdAt:ye,updatedAt:ye,shareScope:["local"]};try{return await Cr(X,G),!0}catch(ce){return console.error("Failed to update inventory:",ce),!1}},[N]),H=C.useCallback(async()=>{if(!h)return;c("updating"),w(new Set),E(0);let O=0,Z=0;for(const ae of h.products){const ve=ae.productName.toLowerCase();w(R=>new Set(R).add(ae.productName));const ye=A.get(ve);await B(ae,ye||void 0)?(O++,E(O)):Z++,w(R=>{const G=new Set(R);return G.delete(ae.productName),G})}c("results"),N(`Inventory updated: ${O} products added, ${Z} failed`,O>0?"success":"error"),e&&e()},[h,A,B,e,N]),Q=O=>{if(!O)return"ok";const Z=new Date(O),ae=new Date,ve=Math.ceil((Z.getTime()-ae.getTime())/(1e3*60*60*24));return ve<0?"expired":ve<=7?"expiring-soon":"ok"},J=(h==null?void 0:h.products.filter(O=>{const Z=Q(O.expirationDate);return Z==="expired"||Z==="expiring-soon"}))||[];return o==="results"&&h?d.jsxs("div",{className:"fixed inset-0 bg-gray-900 z-50 flex flex-col overflow-hidden",children:[d.jsxs("div",{className:"flex-shrink-0 bg-gray-800 border-b border-gray-700 p-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h2",{className:"text-2xl font-bold text-white",children:"Shelf Scan Results"}),d.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white text-2xl leading-5",children:""})]}),d.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-300",children:[d.jsxs("span",{children:["Shelf Fullness: ",d.jsxs("strong",{className:"text-cyan-400",children:[h.shelfFullness,"%"]})]}),d.jsxs("span",{children:["Products Detected: ",d.jsx("strong",{className:"text-cyan-400",children:h.totalProductsDetected})]})]})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[J.length>0&&d.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[d.jsx(Ai,{className:"w-5 h-5 text-red-400"}),d.jsxs("h3",{className:"font-semibold text-red-300",children:["Expiration Alerts (",J.length,")"]})]}),d.jsx("div",{className:"space-y-2",children:J.map((O,Z)=>{const ae=Q(O.expirationDate),ve=O.expirationDate?Math.ceil((new Date(O.expirationDate).getTime()-new Date().getTime())/(1e3*60*60*24)):null;return d.jsxs("div",{className:"bg-red-900/30 rounded p-2 text-sm",children:[d.jsx("span",{className:"font-medium text-white",children:O.productName}),O.expirationDate&&d.jsx("span",{className:`ml-2 ${ae==="expired"?"text-red-300":"text-yellow-300"}`,children:ae==="expired"?`Expired: ${O.expirationDate}`:`Expires in ${ve} days: ${O.expirationDate}`})]},Z)})})]}),d.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Detected Products"}),d.jsx("div",{className:"space-y-3",children:h.products.map((O,Z)=>{const ae=v.has(O.productName),ve=A.get(O.productName.toLowerCase()),ye=Q(O.expirationDate);return d.jsx("div",{className:`p-3 rounded-lg border ${ye==="expired"?"bg-red-900/20 border-red-700":ye==="expiring-soon"?"bg-yellow-900/20 border-yellow-700":"bg-gray-700/50 border-gray-600"}`,children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("h4",{className:"font-semibold text-white",children:O.productName}),ve&&d.jsx("span",{className:"text-xs px-2 py-0.5 bg-green-700/50 text-green-300 rounded",children:"In Catalog"}),ye==="expired"&&d.jsx(Ai,{className:"w-4 h-4 text-red-400"}),ye==="expiring-soon"&&d.jsx(Ai,{className:"w-4 h-4 text-yellow-400"})]}),O.manufacturer&&d.jsx("p",{className:"text-sm text-gray-400",children:O.manufacturer}),d.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-400",children:"Quantity: "}),d.jsxs("span",{className:"text-white font-medium",children:[O.estimatedQuantity," (",O.visibleUnits," visible)"]})]}),O.expirationDate&&d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-400",children:"Expires: "}),d.jsx("span",{className:`font-medium ${ye==="expired"?"text-red-300":ye==="expiring-soon"?"text-yellow-300":"text-green-300"}`,children:O.expirationDate})]}),O.location&&d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-400",children:"Location: "}),d.jsx("span",{className:"text-white",children:O.location})]}),d.jsxs("div",{children:[d.jsx("span",{className:"text-gray-400",children:"Confidence: "}),d.jsxs("span",{className:"text-white",children:[Math.round(O.confidence*100),"%"]})]})]}),O.notes&&d.jsx("p",{className:"text-xs text-gray-500 mt-1",children:O.notes})]}),ae&&d.jsx("div",{className:"ml-4",children:d.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-400"})})]})},Z)})})]}),J.length>0&&d.jsxs("div",{className:"bg-indigo-900/20 border border-indigo-700 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[d.jsx("svg",{className:"w-5 h-5 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})}),d.jsxs("h3",{className:"font-semibold text-indigo-300",children:["Marketplace Opportunities (",J.length,")"]})]}),d.jsx("p",{className:"text-sm text-gray-300 mb-3",children:"These products are expiring soon and could be listed on the marketplace to reduce waste:"}),d.jsx("div",{className:"space-y-2",children:J.slice(0,5).map((O,Z)=>{const ae=O.expirationDate?Math.ceil((new Date(O.expirationDate).getTime()-new Date().getTime())/864e5):null;return d.jsxs("div",{className:"bg-indigo-900/30 rounded p-2 text-sm flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-white",children:O.productName}),O.expirationDate&&d.jsx("span",{className:"ml-2 text-indigo-300",children:ae!==null&&ae>0?`${ae} days left`:"Expired"}),d.jsxs("span",{className:"ml-2 text-gray-400",children:["Qty: ",O.estimatedQuantity]})]}),d.jsx("button",{onClick:()=>{N(`Consider listing ${O.productName} on marketplace to reduce waste`,"info")},className:"text-xs px-3 py-1 bg-indigo-600 hover:bg-indigo-700 rounded text-white transition-colors",children:"List on Marketplace"})]},Z)})})]}),h.recommendations&&h.recommendations.length>0&&d.jsxs("div",{className:"bg-blue-900/20 border border-blue-700 rounded-lg p-4",children:[d.jsx("h3",{className:"font-semibold text-blue-300 mb-2",children:"Recommendations"}),d.jsx("ul",{className:"space-y-1 text-sm text-gray-300",children:h.recommendations.map((O,Z)=>d.jsxs("li",{className:"flex items-start gap-2",children:[d.jsx("span",{className:"text-blue-400",children:""}),d.jsx("span",{children:O})]},Z))})]})]}),d.jsx("div",{className:"flex-shrink-0 bg-gray-800 border-t border-gray-700 p-4",children:d.jsxs("div",{className:"flex items-center justify-between gap-4",children:[d.jsx("div",{className:"text-sm text-gray-400",children:o==="updating"&&d.jsxs("span",{children:["Updating inventory... (",_,"/",h.products.length,")"]})}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:()=>{c("idle"),x(null)},className:"px-4 py-2 rounded-md bg-gray-700 text-white hover:bg-gray-600",children:"Scan Again"}),d.jsx("button",{onClick:H,disabled:o==="updating",className:"px-6 py-2 rounded-md bg-cyan-600 text-white hover:bg-cyan-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:o==="updating"?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):d.jsxs(d.Fragment,{children:[d.jsx(lh,{className:"w-5 h-5"}),"Update Inventory"]})})]})]})})]}):d.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col","aria-modal":"true",children:[d.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),d.jsx("canvas",{ref:a,className:"hidden"}),D&&d.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-yellow-600/95 text-white p-4 rounded-lg text-center z-30 max-w-md mx-auto shadow-2xl border-2 border-yellow-400",children:[d.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[d.jsx("svg",{className:"w-6 h-6 animate-pulse",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),d.jsx("h3",{className:"text-lg font-bold",children:"Gemini API Overloaded"})]}),d.jsx("p",{className:"text-sm mb-3",children:f||"Please wait a moment and try again."}),d.jsx("button",{onClick:()=>{k(!1),p(null)},className:"px-4 py-2 bg-yellow-700 hover:bg-yellow-800 rounded-md text-sm font-semibold transition-colors",children:"Retry"})]}),f&&!D&&d.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-red-800/80 text-white p-3 rounded-lg text-center z-30 max-w-md",children:f}),d.jsxs("div",{className:"absolute top-4 left-4 bg-black/50 text-white px-4 py-2 rounded-full z-20",children:[o==="scanning"&&"Capturing shelf photo...",o==="processing"&&"Analyzing shelf for products...",o==="idle"&&"Position your phone to scan the shelf"]}),o==="processing"&&d.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-cyan-400 mx-auto mb-4"}),d.jsx("p",{className:"text-white text-lg",children:"Analyzing shelf..."}),d.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Detecting products and quantities"})]})}),d.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-30","aria-label":"Close scanner",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 backdrop-blur-sm p-6 z-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto",children:[d.jsxs("h3",{className:"text-xl font-bold text-white mb-2 flex items-center gap-2",children:[d.jsx(Fs,{className:"w-6 h-6 text-cyan-400"}),"Shelf Scanner"]}),d.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Point your camera at a shelf to automatically detect all products, update stock levels, and check expiration dates."}),d.jsx("button",{onClick:P,disabled:o==="scanning"||o==="processing",className:"w-full flex items-center justify-center gap-3 py-4 px-6 bg-cyan-600 text-white font-semibold rounded-lg hover:bg-cyan-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-lg",children:o==="scanning"||o==="processing"?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),o==="scanning"?"Capturing...":"Processing..."]}):d.jsxs(d.Fragment,{children:[d.jsx(Fs,{className:"w-6 h-6"}),"Scan Shelf"]})})]})})]})},b3=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),d.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),d.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),d.jsx("rect",{x:"14",y:"14",width:"7",height:"7"})]}),w3=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),d.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),d.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),d.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),d.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),_3=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),d.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),d.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),d.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),d.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),S3=({summaries:t,items:e,batches:n,onAddBatch:r,onDataRefresh:a})=>{const[o,c]=C.useState(null),[f,p]=C.useState("grid"),[h,x]=C.useState("overview"),[v,w]=C.useState(!1),[_,E]=C.useState(!1),[N,D]=C.useState(null),[k,U]=C.useState(!1),{showToast:A}=Fn(),[I,P]=C.useState(null),[B,H]=C.useState({}),[Q,J]=C.useState(null),[O,Z]=C.useState(null),[ae,ve]=C.useState(!1),ye=C.useMemo(()=>t.map(ee=>({productId:ee.productId,productName:ee.productName})),[t]),Me=C.useMemo(()=>{const ee=new Date,be=new Date(ee.getTime()+10080*60*1e3);return t.filter(he=>{const Ee=new Date(he.earliestExpiration);return Ee<=be&&Ee>=ee})},[t]),R=C.useMemo(()=>{const ee=new Date;return t.filter(be=>new Date(be.earliestExpiration)<ee)},[t]);C.useCallback(()=>{a(),A("New product successfully learned and added to catalog!","success")},[a,A]);const[G,X]=C.useState(null),ce=C.useCallback(ee=>{w(!1),X(ee),x("manual"),A("Scan complete! Please verify and edit the pre-populated data in the form below before adding to inventory.","success")},[A]),re=C.useCallback(()=>{x("overview"),a(),A("Inventory batch added successfully!","success")},[a,A]),[M,q]=C.useState(!1),K=C.useCallback(async ee=>{q(!1),U(!0),D(null);try{const be=tc();if(!be){A("No active shop context. Please ensure you are logged in.","error"),U(!1);return}const he=await oh(ee,be);D(he),he.length>0?A(`Found ${he.length} matching items in inventory!`,"success"):A("This item is not in the inventory.","info")}catch(be){A("Visual search failed: "+(be instanceof Error?be.message:"Unknown error"),"error")}finally{U(!1)}},[A]),ie=C.useCallback(ee=>{if(!ee.inventoryUuid){A("This entry was imported without a Qdrant reference and cannot be edited.","error");return}Z(null),H({quantity:ee.quantity,expirationDate:ee.expirationDate,location:ee.location||"",costPerUnit:ee.costPerUnit,sellPrice:ee.sellPrice??void 0}),P(ee)},[A]),de=C.useCallback(ee=>{if(!ee.inventoryUuid){A("This entry was imported without a Qdrant reference and cannot be deleted.","error");return}Z(null),J(ee)},[A]),me=C.useCallback((ee,be)=>{if(ee==="quantity"||ee==="costPerUnit"||ee==="sellPrice"){H(he=>({...he,[ee]:be===""?void 0:Number(be)}));return}H(he=>({...he,[ee]:be}))},[]),Te=C.useCallback(async ee=>{if(ee.preventDefault(),!!(I!=null&&I.inventoryUuid)){ve(!0),Z(null);try{await Kb(I.inventoryUuid,B),await Promise.resolve(a()),A("Inventory item updated.","success"),P(null)}catch(be){Z(be instanceof Error?be.message:"Failed to update inventory item.")}finally{ve(!1)}}},[I,B,a,A]),ne=C.useCallback(async()=>{if(Q!=null&&Q.inventoryUuid){ve(!0),Z(null);try{await Qb(Q.inventoryUuid),await Promise.resolve(a()),A("Inventory item deleted.","success"),J(null)}catch(ee){Z(ee instanceof Error?ee.message:"Failed to delete inventory item.")}finally{ve(!1)}}},[Q,a,A]);return d.jsxs(d.Fragment,{children:[o&&d.jsx(y3,{product:o,allItems:e,allBatches:n,onClose:()=>c(null)}),v&&d.jsx(Fa,{onDataScanned:ce,onClose:()=>w(!1),productOptions:ye}),_&&d.jsx(v3,{summaries:t,onScanComplete:()=>{E(!1),a()},onClose:()=>E(!1)}),M&&d.jsx(Fa,{onDataScanned:ee=>{const be=ee.blobs.get("productName")||ee.blobs.get("manufacturer")||Array.from(ee.blobs.values())[0];be?K(be):(A("No image captured. Please try again.","error"),q(!1))},onClose:()=>q(!1),productOptions:ye,mode:"visual-search"}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h1",{className:"text-2xl font-bold text-white",children:"Inventory Management"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:()=>x("overview"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${h==="overview"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Overview"}),d.jsx("button",{onClick:()=>x("manual"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${h==="manual"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Manual Entry"})]})]}),(Me.length>0||R.length>0)&&d.jsxs("div",{className:"mt-4 p-4 rounded-lg border-l-4 bg-yellow-900/20 border-yellow-500",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx(Ai,{className:"w-5 h-5 text-yellow-400"}),d.jsxs("h3",{className:"font-semibold text-yellow-300",children:[R.length>0&&`${R.length} Expired`,R.length>0&&Me.length>0&&"  ",Me.length>0&&`${Me.length} Expiring Soon`]})]}),d.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[R.slice(0,5).map(ee=>d.jsxs("span",{className:"px-2 py-1 bg-red-900/50 text-red-300 rounded text-xs",children:[ee.productName," (Expired)"]},ee.productId)),Me.slice(0,5).map(ee=>d.jsxs("span",{className:"px-2 py-1 bg-yellow-900/50 text-yellow-300 rounded text-xs",children:[ee.productName," (Expires: ",new Date(ee.earliestExpiration).toLocaleDateString(),")"]},ee.productId))]})]})]}),h==="overview"&&d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[d.jsxs("div",{className:"lg:col-span-4 space-y-6",children:[d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 shadow-lg",children:[d.jsx("h2",{className:"text-xl font-semibold mb-4 text-white",children:"Quick Actions"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("button",{onClick:()=>E(!0),className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:[d.jsx(Fs,{className:"w-6 h-6"}),"Scan Shelf"]}),d.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Scan entire shelf - detects all products, updates stock, shows expiration alerts"}),d.jsxs("button",{onClick:()=>w(!0),className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:[d.jsx(Fs,{className:"w-6 h-6"}),"Live Scan Item"]}),d.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Use your camera to automatically extract product data"}),d.jsxs("button",{onClick:()=>q(!0),disabled:k,className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[d.jsx(Fs,{className:"w-6 h-6"}),k?"Searching...":"Live Imagery Search"]}),d.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Use your camera to search inventory by image"}),d.jsxs("button",{onClick:()=>x("manual"),className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-gray-600 rounded-md shadow-sm text-base font-medium text-gray-200 bg-gray-700/50 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:[d.jsx(_3,{className:"w-6 h-6"}),"Manual Entry"]}),d.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Enter inventory details manually or complete a scan"})]}),N&&N.length>0&&d.jsxs("div",{className:"mt-4 p-4 bg-purple-900/20 border border-purple-700 rounded-lg",children:[d.jsxs("h3",{className:"text-sm font-semibold text-purple-300 mb-2",children:["Visual Search Results (",N.length," found)"]}),d.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:N.map((ee,be)=>d.jsxs("div",{className:"text-xs p-2 bg-gray-900/50 rounded",children:[d.jsxs("p",{className:"text-white font-medium",children:["Product ID: ",ee.productId]}),d.jsxs("p",{className:"text-gray-400",children:["Qty: ",ee.quantity," | Exp: ",ee.expirationDate]})]},be))}),d.jsx("button",{onClick:()=>D(null),className:"mt-2 text-xs text-purple-400 hover:text-purple-300",children:"Clear results"})]})]}),d.jsx(g3,{items:e,batches:n})]}),d.jsxs("div",{className:"lg:col-span-8 space-y-4",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h2",{className:"text-xl font-semibold text-white",children:"Current Inventory"}),d.jsxs("div",{className:"flex items-center p-1 bg-gray-900/50 rounded-lg border border-gray-700",children:[d.jsx("button",{onClick:()=>p("grid"),className:`p-2 rounded-md transition-colors ${f==="grid"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,"aria-label":"Grid view",title:"Grid View",children:d.jsx(b3,{className:"w-5 h-5"})}),d.jsx("button",{onClick:()=>p("table"),className:`p-2 rounded-md transition-colors ${f==="table"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,"aria-label":"Table view",title:"Table View",children:d.jsx(w3,{className:"w-5 h-5"})})]})]}),f==="grid"?d.jsx(p3,{summaries:t,inventoryItems:e,onSelectProduct:c,onEditItem:ie,onDeleteItem:de}):d.jsx(m3,{inventory:e,batches:n,onEditRequest:ie,onDeleteRequest:de})]})]}),h==="manual"&&d.jsx(x3,{onAddBatch:(ee,be)=>{r(ee,be),re(),X(null)},summaries:t,pendingScanResult:G,onScanResultProcessed:()=>X(null)}),I&&d.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-lg",children:[d.jsxs("div",{className:"flex justify-between items-center border-b border-gray-700 p-4",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:"Edit Inventory Item"}),d.jsx("p",{className:"text-sm text-gray-400",children:I.productName})]}),d.jsx("button",{onClick:()=>{P(null),Z(null)},className:"text-gray-400 hover:text-white text-2xl leading-5","aria-label":"Close edit item modal",children:""})]}),d.jsxs("form",{onSubmit:Te,className:"p-4 space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[d.jsxs("label",{className:"text-sm text-gray-300",children:["Quantity",d.jsx("input",{type:"number",min:0,className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:B.quantity??"",onChange:ee=>me("quantity",ee.target.value)})]}),d.jsxs("label",{className:"text-sm text-gray-300",children:["Expiration Date",d.jsx("input",{type:"date",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:B.expirationDate??"",onChange:ee=>me("expirationDate",ee.target.value)})]}),d.jsxs("label",{className:"text-sm text-gray-300",children:["Cost / Unit",d.jsx("input",{type:"number",step:"0.01",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:B.costPerUnit??"",onChange:ee=>me("costPerUnit",ee.target.value)})]}),d.jsxs("label",{className:"text-sm text-gray-300",children:["Sell Price",d.jsx("input",{type:"number",step:"0.01",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:B.sellPrice??"",onChange:ee=>me("sellPrice",ee.target.value)})]})]}),d.jsxs("label",{className:"text-sm text-gray-300 block",children:["Location",d.jsx("input",{type:"text",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:B.location??"",onChange:ee=>me("location",ee.target.value)})]}),O&&d.jsx("p",{className:"text-sm text-red-400",children:O}),d.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[d.jsx("button",{type:"button",onClick:()=>{P(null),Z(null)},className:"px-4 py-2 rounded-md bg-gray-700 text-white hover:bg-gray-600",children:"Cancel"}),d.jsx("button",{type:"submit",disabled:ae,className:"px-4 py-2 rounded-md bg-cyan-600 text-white hover:bg-cyan-500 disabled:opacity-60",children:ae?"Saving...":"Save Changes"})]})]})]})}),Q&&d.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-md p-6",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete Inventory Item"}),d.jsxs("p",{className:"text-sm text-gray-300",children:["Are you sure you want to remove ",d.jsx("span",{className:"text-white font-semibold",children:Q.productName})," from inventory? This action cannot be undone."]}),O&&d.jsx("p",{className:"text-sm text-red-400 mt-3",children:O}),d.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[d.jsx("button",{onClick:()=>{J(null),Z(null)},className:"px-4 py-2 rounded-md bg-gray-700 text-white hover:bg-gray-600",children:"Cancel"}),d.jsx("button",{onClick:ne,disabled:ae,className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-500 disabled:opacity-60",children:ae?"Deleting...":"Delete"})]})]})})]})]})},xf=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("circle",{cx:"9",cy:"21",r:"1"}),d.jsx("circle",{cx:"20",cy:"21",r:"1"}),d.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]}),Tw=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),d.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Nw=t=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:d.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})}),zl=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("polyline",{points:"3 6 5 6 21 6"}),d.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),d.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),d.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Cw=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),d.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),d.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),d.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),d.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),E3=({summaries:t,onProductScanned:e,onClose:n})=>{const r=C.useRef(null),a=C.useRef(null),o=C.useRef(null),[c,f]=C.useState("SCANNING"),[p,h]=C.useState(null),[x,v]=C.useState(null),w=C.useMemo(()=>t.map(U=>U.productName),[t]),_=C.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=null)},[]),E=C.useCallback(async()=>{if(!r.current||!a.current||document.hidden)return;const U=r.current,A=a.current;A.width=U.videoWidth,A.height=U.videoHeight;const I=A.getContext("2d");I&&(I.drawImage(U,0,0,U.videoWidth,U.videoHeight),A.toBlob(async P=>{if(P&&o.current)try{const B=await ah(P,w);B?(h(B),f("DETECTED"),e(B),_(),setTimeout(()=>{f("SCANNING"),h(null),o.current=window.setInterval(E,2e3)},2500)):f("NO_PRODUCT")}catch(B){console.warn("Scan failed:",B),f("ERROR")}},"image/jpeg",.8))},[w,e,_]);C.useEffect(()=>{let U=null;return(async()=>{try{U=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),r.current&&(r.current.srcObject=U),_(),o.current=window.setInterval(E,2e3)}catch(I){console.error("Error accessing camera:",I),v("Could not access the camera. Please ensure permissions are granted."),f("ERROR")}})(),()=>{_(),U&&U.getTracks().forEach(I=>I.stop())}},[E,_]);const N=()=>{switch(c){case"SCANNING":return{message:"Point camera at a product",color:"border-gray-500"};case"DETECTED":return{message:`${p} added to cart!`,color:"border-green-500 animate-pulse-border"};case"NO_PRODUCT":return{message:"Searching for product...",color:"border-yellow-500"};case"ERROR":return{message:"Scanner error. Please try again.",color:"border-red-500"};default:return{message:"",color:"border-transparent"}}},{message:D,color:k}=N();return d.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center","aria-modal":"true",children:[d.jsx("style",{children:`
            @keyframes pulse-border {
                0%, 100% { box-shadow: 0 0 0 0 rgba(4, 120, 87, 0.7); }
                50% { box-shadow: 0 0 0 10px rgba(4, 120, 87, 0); }
            }
            .animate-pulse-border {
                animation: pulse-border 1.5s infinite;
            }
        `}),d.jsxs("div",{className:`relative w-full max-w-4xl aspect-video bg-black rounded-lg overflow-hidden border-4 ${k} transition-all`,children:[d.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),d.jsx("canvas",{ref:a,className:"hidden"})]}),d.jsxs("div",{className:"mt-4 text-center",children:[d.jsx("p",{className:"text-white text-lg font-semibold",children:D}),x&&d.jsx("p",{className:"text-red-400 text-sm mt-1",children:x})]}),d.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-30","aria-label":"Close scanner",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsx("button",{onClick:n,className:"mt-8 px-8 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors shadow-lg",children:"Done Scanning"})]})},Ix=1.4,T3=({summaries:t,onPurchase:e})=>{const[n,r]=C.useState([]),[a,o]=C.useState(!1),[c,f]=C.useState("All"),[p,h]=C.useState(!1),x=C.useMemo(()=>t.map(I=>({...I,price:I.averageCostPerUnit*Ix})).filter(I=>c==="All"?!0:I.category===c),[t,c]),v=C.useMemo(()=>{const I=new Set(t.map(P=>P.category));return["All",...Array.from(I)]},[t]),w=I=>{r(P=>{const B=P.find(H=>H.productName===I.productName);if(B){const H=k(I.productName);return B.quantity>=H?P:P.map(Q=>Q.productName===I.productName?{...Q,quantity:Q.quantity+1}:Q)}return[...P,{productName:I.productName,quantity:1,price:I.price}]})},_=(I,P)=>{r(B=>B.map(Q=>Q.productName===I?{...Q,quantity:Q.quantity+P}:Q).filter(Q=>Q.quantity>0))},E=I=>{r(P=>P.filter(B=>B.productName!==I))},N=C.useMemo(()=>n.reduce((I,P)=>I+P.price*P.quantity,0),[n]),D=()=>{e(n.map(({productName:I,quantity:P})=>({productName:I,quantity:P}))),r([]),o(!0),setTimeout(()=>o(!1),4e3)},k=I=>{var P;return((P=t.find(B=>B.productName===I))==null?void 0:P.totalQuantity)||0},U=I=>{var P;return((P=n.find(B=>B.productName===I))==null?void 0:P.quantity)||0},A=I=>{const P=t.find(B=>B.productName===I);if(P){const B={...P,price:P.averageCostPerUnit*Ix};w(B)}};return d.jsxs(d.Fragment,{children:[p&&d.jsx(E3,{summaries:t,onProductScanned:A,onClose:()=>h(!1)}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[d.jsxs("div",{className:"lg:col-span-2",children:[d.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4",children:[d.jsx("h1",{className:"text-3xl font-bold text-white",children:"Welcome to the Kiosk"}),d.jsxs("button",{onClick:()=>h(!0),className:"flex items-center justify-center gap-2 py-2 px-4 border border-cyan-600 rounded-md shadow-sm text-sm font-medium text-cyan-400 bg-cyan-900/30 hover:bg-cyan-900/60 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:[d.jsx(Cw,{className:"w-5 h-5"}),"Scan Item to Add"]})]}),d.jsx("div",{className:"mb-6",children:d.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(I=>d.jsx("button",{onClick:()=>f(I),className:`px-4 py-2 text-sm font-medium rounded-full transition-colors ${c===I?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:I},I))})}),x.length===0?d.jsx("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:d.jsx("p",{children:"There are no products available in this category. Please check back later."})}):d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:x.map(I=>{const P=U(I.productName),B=I.totalQuantity,H=P<B;return d.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700 overflow-hidden flex flex-col",children:[d.jsxs("div",{className:"p-4 flex-grow",children:[d.jsx("div",{className:"flex justify-center items-center h-24 w-24 bg-gray-700/50 rounded-lg mx-auto mb-4",children:d.jsx(dw,{className:"w-12 h-12 text-gray-500"})}),d.jsx("h3",{className:"font-semibold text-white truncate",children:I.productName}),d.jsx("p",{className:"text-sm text-gray-400 mb-2 truncate",children:I.manufacturer}),d.jsxs("p",{className:"text-xl font-bold text-cyan-400",children:["$",I.price.toFixed(2)]})]}),d.jsx("div",{className:"p-4 bg-gray-900/50",children:d.jsxs("button",{onClick:()=>w(I),disabled:!H,className:"w-full flex items-center justify-center gap-2 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all disabled:bg-gray-600 disabled:cursor-not-allowed",children:[d.jsx(xf,{className:"w-5 h-5"}),H?"Add to Cart":"Out of Stock"]})})]},I.productName)})})]}),d.jsx("div",{className:"lg:col-span-1",children:d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 sticky top-28",children:[d.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[d.jsx(xf,{className:"w-6 h-6 text-cyan-400"}),"Your Cart"]}),a&&d.jsxs("div",{className:"bg-green-800/50 border border-green-600 text-green-300 p-4 rounded-lg mb-4 text-center",children:[d.jsx("h3",{className:"font-bold",children:"Purchase Successful!"}),d.jsx("p",{className:"text-sm",children:"Thank you for your order."})]}),n.length>0?d.jsxs("div",{className:"space-y-4",children:[d.jsx("ul",{className:"space-y-3 max-h-80 overflow-y-auto pr-2 -mr-2",children:n.map(I=>d.jsxs("li",{className:"flex items-center gap-4 text-sm",children:[d.jsxs("div",{className:"flex-grow",children:[d.jsx("p",{className:"font-medium text-white truncate",children:I.productName}),d.jsxs("p",{className:"text-gray-400",children:["$",I.price.toFixed(2)]})]}),d.jsxs("div",{className:"flex items-center gap-1 bg-gray-700/50 rounded-md",children:[d.jsx("button",{onClick:()=>_(I.productName,-1),className:"p-1 text-gray-300 hover:text-white",children:d.jsx(Nw,{className:"w-4 h-4"})}),d.jsx("span",{className:"font-bold text-white px-1",children:I.quantity}),d.jsx("button",{onClick:()=>_(I.productName,1),disabled:I.quantity>=k(I.productName),className:"p-1 text-gray-300 hover:text-white disabled:text-gray-600",children:d.jsx(Tw,{className:"w-4 h-4"})})]}),d.jsx("button",{onClick:()=>E(I.productName),className:"p-1 text-gray-400 hover:text-red-400",children:d.jsx(zl,{className:"w-4 h-4"})})]},I.productName))}),d.jsxs("div",{className:"border-t border-gray-700 pt-4 space-y-4",children:[d.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[d.jsx("span",{className:"text-gray-300",children:"Total:"}),d.jsxs("span",{className:"text-white",children:["$",N.toFixed(2)]})]}),d.jsx("button",{onClick:D,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Checkout"})]})]}):d.jsx("p",{className:"text-center text-gray-500 py-8",children:"Your cart is empty."})]})})]})]})},N3=({summaries:t,onClose:e,onListProduct:n})=>{const[r,a]=C.useState(""),[o,c]=C.useState(1),[f,p]=C.useState(0),[h,x]=C.useState(""),v=t.find(E=>E.productName===r),w=(v==null?void 0:v.totalQuantity)||0,_=E=>{if(E.preventDefault(),x(""),!r||o<=0||f<=0){x("Please fill all fields with valid values.");return}if(o>w){x(`Quantity cannot exceed available stock of ${w}.`);return}n(r,o,f)};return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-center justify-center p-4",onClick:e,children:d.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-full max-w-lg",onClick:E=>E.stopPropagation(),children:[d.jsxs("div",{className:"p-6 border-b border-gray-700 flex justify-between items-center",children:[d.jsx("h2",{className:"text-2xl font-bold text-white",children:"List Product on Marketplace"}),d.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),d.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"product",className:"block text-sm font-medium text-gray-300",children:"Product"}),d.jsxs("select",{id:"product",value:r,onChange:E=>a(E.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm",children:[d.jsx("option",{value:"",children:"Select a product..."}),t.map(E=>d.jsxs("option",{value:E.productName,children:[E.productName," (In Stock: ",E.totalQuantity,")"]},E.productName))]})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-300",children:"Quantity to List"}),d.jsx("input",{type:"number",id:"quantity",value:o,onChange:E=>c(Math.max(1,parseInt(E.target.value)||1)),min:"1",max:w,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-300",children:"Price per Unit ($)"}),d.jsx("input",{type:"number",id:"price",value:f,onChange:E=>p(parseFloat(E.target.value)||0),min:"0.01",step:"0.01",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm"})]}),h&&d.jsx("p",{className:"text-red-400 text-sm",children:h}),d.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[d.jsx("button",{type:"button",onClick:e,className:"py-2 px-4 border border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-300 bg-gray-700/50 hover:bg-gray-700",children:"Cancel"}),d.jsx("button",{type:"submit",className:"py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700",children:"List Product"})]})]})]})})},C3=({summaries:t,user:e,onPurchase:n})=>{const[r,a]=C.useState([]),[o,c]=C.useState([]),[f,p]=C.useState(!0),[h,x]=C.useState(null),[v,w]=C.useState(!1),[_,E]=C.useState("peer"),[N,D]=C.useState([]),[k,U]=C.useState(!1),[A,I]=C.useState(null),P=C.useCallback(async()=>{if(!e.isVerified){p(!1);return}p(!0),x(null);try{const[O,Z]=await Promise.all([DD(e),Rv()]);a(O),c(Z)}catch(O){x(O instanceof Error?O.message:"Failed to load marketplace data.")}finally{p(!1)}},[e]),B=C.useCallback(async()=>{if(fs){U(!0),I(null);try{const O=await Jb();D(O)}catch(O){I(O instanceof Error?O.message:"Failed to load DAN offers.")}finally{U(!1)}}},[]);C.useEffect(()=>{P()},[P]),C.useEffect(()=>{fs&&_==="dan"&&B()},[_,B]);const H=async(O,Z,ae)=>{if(!t.find(Me=>Me.productName===O))return;const ye=O.toLowerCase().replace(/ /g,"-");await Iv({productId:ye,productName:O,quantity:Z,price:ae}),w(!1),P()},Q=O=>{alert(`Signal sent! Coordinate with ${O.shopName||O.shopId} to fulfill ${O.productName}.`)},J=O=>{const Z=prompt(`How many units of ${O.productName} would you like to buy? (Available: ${O.quantity})`,"1");if(Z){const ae=parseInt(Z,10);!isNaN(ae)&&ae>0&&ae<=O.quantity?(n(O,ae),alert(`Successfully purchased ${ae} ${O.productName}! It has been added to your inventory.`)):alert("Invalid quantity entered.")}};return e.isVerified?d.jsxs(d.Fragment,{children:[v&&d.jsx(N3,{summaries:t,onClose:()=>w(!1),onListProduct:H}),d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold text-white",children:"Marketplace"}),d.jsx("p",{className:"text-lg text-gray-400",children:"Buy and sell inventory with other verified shops in the network."})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[d.jsx("div",{className:"lg:col-span-4",children:d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"My Listings"}),d.jsx("button",{onClick:()=>w(!0),className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:"List a Product"}),d.jsx("div",{className:"mt-4 space-y-3 max-h-96 overflow-y-auto",children:o.length>0?o.map(O=>d.jsxs("div",{className:"p-3 bg-gray-900/50 rounded-md text-sm",children:[d.jsx("p",{className:"font-semibold text-white",children:O.productName}),d.jsxs("p",{className:"text-gray-400",children:[O.quantity," units at $",O.price.toFixed(2),"/each"]})]},O.id)):d.jsx("p",{className:"text-center text-gray-500 py-4",children:"You haven't listed any products."})})]})}),d.jsx("div",{className:"lg:col-span-8",children:d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[d.jsx("h2",{className:"text-xl font-semibold text-white",children:_==="dan"?"DAN Offers":"Peer Offerings"}),fs&&d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>E("peer"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${_==="peer"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Peer Network"}),d.jsx("button",{onClick:()=>E("dan"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${_==="dan"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"DAN Offers Only"})]})]}),_==="peer"&&d.jsxs(d.Fragment,{children:[f&&d.jsx("p",{className:"text-cyan-400 mt-4",children:"Loading peer listings..."}),h&&d.jsx("p",{className:"text-red-400 mt-4",children:h}),!f&&!h&&d.jsx("div",{className:"space-y-6 mt-4",children:r.map(O=>d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-bold text-cyan-400",children:O.name}),d.jsx("div",{className:"mt-2 divide-y divide-gray-700 border-t border-b border-gray-700",children:O.listings.map(Z=>d.jsxs("div",{className:"p-3 grid grid-cols-1 md:grid-cols-4 gap-4 items-center",children:[d.jsxs("div",{children:[d.jsx("p",{className:"font-semibold text-white",children:Z.productName}),d.jsx("p",{className:"text-xs text-gray-400",children:Z.manufacturer})]}),d.jsx("div",{className:"text-sm",children:d.jsxs("p",{className:"text-gray-300",children:[Z.quantity," ",Z.quantityType]})}),d.jsx("div",{className:"text-sm font-bold",children:d.jsxs("p",{className:"text-white",children:["$",Z.price.toFixed(2)]})}),d.jsx("div",{children:d.jsx("button",{onClick:()=>J(Z),className:"w-full md:w-auto text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Buy"})})]},Z.listingId))})]},O.id))})]}),_==="dan"&&fs&&d.jsxs("div",{className:"mt-4 space-y-4",children:[k&&d.jsx("p",{className:"text-indigo-300",children:"Syncing DAN offers..."}),A&&d.jsx("p",{className:"text-red-400",children:A}),!k&&!A&&d.jsx(d.Fragment,{children:N.filter(O=>O.shopId!==(e.shopId||e.clientId)).length===0?d.jsx("p",{className:"text-gray-400",children:"No external DAN offers yet. Encourage peers to opt-in sharing from Inventory > Manual Entry."}):d.jsx("div",{className:"grid grid-cols-1 gap-4",children:N.filter(O=>O.shopId!==(e.shopId||e.clientId)).map(O=>{var Z;return d.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 bg-gray-900/40",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-lg font-semibold text-white",children:O.productName}),d.jsxs("p",{className:"text-xs text-gray-400",children:["From ",O.shopName||O.shopId]})]}),d.jsx("span",{className:"text-xs px-2 py-1 rounded-full border border-indigo-400 text-indigo-300",children:"DAN"})]}),d.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-3 text-sm text-gray-300",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Quantity"}),d.jsxs("p",{children:[O.quantity," units"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Expires"}),d.jsx("p",{children:new Date(O.expirationDate).toLocaleDateString()})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Aisle Zone"}),d.jsx("p",{children:O.locationBucket||"Hidden"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Signal Hash"}),d.jsx("p",{className:"font-mono text-xs",children:((Z=O.proofHash)==null?void 0:Z.slice(0,12))??""})]})]}),d.jsxs("div",{className:"mt-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[d.jsx("div",{className:"text-sm text-gray-400",children:O.sellPrice?`Listed at $${O.sellPrice.toFixed(2)} / unit`:"Price shared privately"}),d.jsx("button",{onClick:()=>Q(O),className:"w-full md:w-auto text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:"Signal Interest"})]})]},O.inventoryUuid)})})})]})]})})]})]})]}):d.jsxs("div",{className:"text-center bg-gray-800/50 p-12 rounded-lg border border-gray-700",children:[d.jsx("h1",{className:"text-2xl font-bold text-yellow-400",children:"Verification Pending"}),d.jsx("p",{className:"text-lg text-gray-400 mt-2",children:"Your shop is awaiting verification by the network admin."}),d.jsx("p",{className:"text-gray-500 mt-4",children:"Once verified, you will be able to access the peer-to-peer marketplace here."}),d.jsx("p",{className:"text-gray-500 mt-1",children:'Navigate to the "Backend" tab to simulate the admin view and verify this shop.'})]})},A3=()=>{const[t,e]=C.useState([]),[n,r]=C.useState([]),[a,o]=C.useState([]),[c,f]=C.useState([]),[p,h]=C.useState(!0),[x,v]=C.useState(new Date),w=C.useCallback(async()=>{h(!0);const[N,D,k,U]=await Promise.all([ED(),TD(),ND(),CD()]);e(N),r(D),o(k),f(U),h(!1)},[]);C.useEffect(()=>{w()},[w,x]);const _=async N=>{await AD(N),v(new Date)},E=async N=>{await ID(N),v(new Date)};return d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold text-white",children:"Backend Admin Panel"}),d.jsx("p",{className:"text-lg text-gray-400",children:"Simulated proxy server for verifying new shops and drivers."})]}),d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Pending Shop Verifications (",t.length,")"]}),d.jsx("button",{onClick:()=>v(new Date),className:"text-sm text-cyan-400 hover:text-cyan-300",children:"Refresh"})]}),p?d.jsx("p",{className:"text-center text-gray-400",children:"Loading..."}):t.length===0?d.jsx("p",{className:"text-center text-gray-500 py-8",children:"No shops are awaiting verification."}):d.jsx(Tl,{users:t,onVerify:_})]}),d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsxs("h2",{className:"text-xl font-semibold text-white mb-4",children:["Pending Driver Verifications (",a.length,")"]}),p?d.jsx("p",{className:"text-center text-gray-400",children:"Loading..."}):a.length===0?d.jsx("p",{className:"text-center text-gray-500 py-8",children:"No drivers are awaiting verification."}):d.jsx(Tl,{users:a,onVerify:E,isDriverTable:!0})]}),d.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[d.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Active Network Participants"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("h3",{className:"text-lg font-semibold text-cyan-400",children:["Verified Shops (",n.length,")"]}),n.length>0?d.jsx(Tl,{users:n}):d.jsx("p",{className:"text-gray-500 text-sm",children:"No verified shops."}),d.jsxs("h3",{className:"text-lg font-semibold text-cyan-400 mt-6",children:["Verified Drivers (",c.length,")"]}),c.length>0?d.jsx(Tl,{users:c,isDriverTable:!0}):d.jsx("p",{className:"text-gray-500 text-sm",children:"No verified drivers."})]})]}),d.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-cyan-800/50",children:[d.jsx("h4",{className:"font-semibold text-cyan-500",children:"How this simulation works:"}),d.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'When a new user registers, they appear in the appropriate "Pending" list. Clicking "Verify" updates a shared `localStorage` value. The main application is continuously polling for this change. Once it detects it has been verified, it will automatically unlock the relevant features (Marketplace, Orders, or Driver panel).'})]})]})},Tl=({users:t,onVerify:e,isDriverTable:n})=>d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[d.jsx("thead",{className:"bg-gray-800",children:d.jsxs("tr",{children:[d.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-6",children:n?"Name":"Company"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Email"}),d.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Client ID"}),e&&d.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:d.jsx("span",{className:"sr-only",children:"Verify"})})]})}),d.jsx("tbody",{className:"divide-y divide-gray-700 bg-gray-900/50",children:t.map(r=>d.jsxs("tr",{children:[d.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-6",children:r.companyName}),d.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:r.email}),d.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500 font-mono text-xs",children:r.clientId}),e&&d.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:d.jsx("button",{onClick:()=>e(r.clientId),className:"py-1 px-3 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-green-600 hover:bg-green-700",children:"Verify"})})]},r.clientId))})]})}),Aw=C.createContext(void 0),I3=({children:t})=>{const[e,n]=C.useState(()=>{if(typeof window<"u"){const r=sessionStorage.getItem("current_shop");return r?JSON.parse(r):null}return null});return C.useEffect(()=>{typeof window<"u"&&(e?sessionStorage.setItem("current_shop",JSON.stringify(e)):sessionStorage.removeItem("current_shop"))},[e]),d.jsx(Aw.Provider,{value:{currentShop:e,setCurrentShop:n},children:t})},ch=()=>{const t=C.useContext(Aw);if(t===void 0)throw new Error("useShopContext must be used within a ShopContextProvider");return t},Iw=C.createContext(void 0),R3=({children:t,initialCustomer:e})=>{const[n,r]=C.useState(()=>{if(e)return e;if(typeof window<"u"){const c=sessionStorage.getItem("customer_profile");return c?JSON.parse(c):null}return null});C.useEffect(()=>{e&&r(c=>(c==null?void 0:c.user.clientId)===e.user.clientId?c:e)},[e]),C.useEffect(()=>{typeof window<"u"&&(n?sessionStorage.setItem("customer_profile",JSON.stringify(n)):sessionStorage.removeItem("customer_profile"))},[n]);const a=c=>{r(c)},o=()=>{r(null)};return d.jsx(Iw.Provider,{value:{customer:n,setCustomer:a,clearCustomer:o},children:t})},Rw=()=>{const t=C.useContext(Iw);if(t===void 0)throw new Error("useCustomerContext must be used within a CustomerContextProvider");return t},Rx=({onShopSelected:t,showQRScanner:e=!1})=>{const{currentShop:n,setCurrentShop:r}=ch(),[a,o]=C.useState([]),[c,f]=C.useState(!0),[p,h]=C.useState(!1),[x,v]=C.useState(""),{showToast:w}=Fn();C.useEffect(()=>{_()},[]);const _=async()=>{try{f(!0);const D=await Sv();o(D)}catch(D){console.error("Failed to load shops:",D),w("Failed to load shops","error")}finally{f(!1)}},E=D=>{r(D),w(`Selected shop: ${D.name}`,"success"),t&&t()},N=async()=>{if(!x.trim()){w("Please enter a shop ID","error");return}try{const D=await Ev(x.trim());D?(E(D),v(""),h(!1)):w("Shop not found. Please check the QR code.","error")}catch(D){console.error("Error validating shop:",D),w("Failed to validate shop","error")}};return n?d.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-white",children:"Current Shop"}),d.jsx("p",{className:"text-gray-300",children:n.name})]}),d.jsx("button",{onClick:()=>r(null),className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Change Shop"})]})}):d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Select a Shop"}),e&&d.jsxs("div",{className:"mb-6",children:[d.jsxs("button",{onClick:()=>h(!p),className:"w-full flex items-center justify-center gap-3 py-3 px-6 border border-transparent rounded-lg shadow-lg text-base font-semibold text-white bg-cyan-600 hover:bg-cyan-700 transition-all mb-4",children:[d.jsx(Cw,{className:"w-5 h-5"}),p?"Hide QR Scanner":"Scan Shop QR Code"]}),p&&d.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4",children:[d.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Enter shop ID from QR code:"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:x,onChange:D=>v(D.target.value),onKeyPress:D=>D.key==="Enter"&&N(),placeholder:"Shop ID",className:"flex-1 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),d.jsx("button",{onClick:N,className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold transition",children:"Go"})]})]})]}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Or Browse Shops"}),c?d.jsxs("div",{className:"text-center py-8",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400 mx-auto"}),d.jsx("p",{className:"text-gray-400 mt-2",children:"Loading shops..."})]}):a.length===0?d.jsx("div",{className:"text-center py-8",children:d.jsx("p",{className:"text-gray-400",children:"No shops available"})}):d.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.map(D=>d.jsxs("button",{onClick:()=>E(D),className:"w-full text-left px-4 py-3 bg-gray-900/50 border border-gray-700 rounded-lg hover:bg-gray-900 hover:border-cyan-600 transition text-white",children:[d.jsx("div",{className:"font-semibold",children:D.name}),D.contactEmail&&d.jsx("div",{className:"text-sm text-gray-400",children:D.contactEmail})]},D.id))})]})]})},D3=({cart:t,totalPrice:e,shopId:n,customerId:r,onComplete:a,onCancel:o})=>{const[c,f]=C.useState(!1),[p,h]=C.useState(!1),{showToast:x}=Fn(),v=async()=>{try{f(!0);const w=await nc(),_=new Map(w.map(N=>[N.productName,{id:N.productId,name:N.productName}])),E=t.map(N=>({productName:N.productName,quantity:N.quantity}));Ga({id:n,name:null,contactEmail:null,location:null,qdrantNamespace:null});try{await Zf(E,_)}finally{Ga(null)}h(!0),x("Purchase completed successfully!","success"),setTimeout(()=>{a()},2e3)}catch(w){console.error("Purchase error:",w),x("Purchase failed: "+(w instanceof Error?w.message:"Unknown error"),"error"),f(!1)}};return p?d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:[d.jsx(lh,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Purchase Complete!"}),d.jsx("p",{className:"text-gray-400",children:"Thank you for your purchase"})]}):d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Checkout"}),d.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4 mb-4",children:[d.jsx("h3",{className:"font-semibold text-white mb-3",children:"Order Summary"}),d.jsx("div",{className:"space-y-2",children:t.map(w=>d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsxs("span",{className:"text-gray-300",children:[w.productName," x ",w.quantity]}),d.jsxs("span",{className:"text-white font-semibold",children:["$",(w.price*w.quantity).toFixed(2)]})]},w.productId))}),d.jsxs("div",{className:"border-t border-gray-700 mt-3 pt-3 flex justify-between",children:[d.jsx("span",{className:"text-lg font-semibold text-white",children:"Total"}),d.jsxs("span",{className:"text-xl font-bold text-cyan-400",children:["$",e.toFixed(2)]})]})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Payment Method"}),d.jsx("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-3",children:d.jsx("p",{className:"text-gray-300 text-sm",children:"Cash / Card at pickup"})})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:o,disabled:c,className:"flex-1 py-3 px-4 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition disabled:opacity-50",children:"Cancel"}),d.jsx("button",{onClick:v,disabled:c,className:"flex-1 py-3 px-4 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition disabled:opacity-50",children:c?"Processing...":"Complete Purchase"})]})]})},M3=({cart:t,onUpdateQuantity:e,onRemoveItem:n,totalPrice:r,shopId:a,onPurchaseComplete:o})=>{const{customer:c}=Rw(),[f,p]=C.useState(!1);return f?d.jsx(D3,{cart:t,totalPrice:r,shopId:a,customerId:(c==null?void 0:c.user.customerId)||(c==null?void 0:c.user.clientId),onComplete:o,onCancel:()=>p(!1)}):d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 sticky top-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx(xf,{className:"w-6 h-6 text-cyan-400"}),d.jsx("h2",{className:"text-xl font-bold text-white",children:"Cart"}),t.length>0&&d.jsx("span",{className:"bg-cyan-600 text-white text-xs font-semibold px-2 py-1 rounded-full",children:t.length})]}),t.length===0?d.jsxs("div",{className:"text-center py-8",children:[d.jsx("p",{className:"text-gray-400",children:"Your cart is empty"}),d.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Add items to get started"})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto mb-4",children:t.map(h=>d.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-3",children:[d.jsxs("div",{className:"flex justify-between items-start mb-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-semibold text-white text-sm",children:h.productName}),d.jsxs("p",{className:"text-xs text-gray-400",children:["$",h.price.toFixed(2)," each"]})]}),d.jsx("button",{onClick:()=>n(h.productId),className:"text-gray-400 hover:text-red-400 transition","aria-label":"Remove item",children:d.jsx(zl,{className:"w-4 h-4"})})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:()=>e(h.productId,-1),className:"p-1 bg-gray-700 hover:bg-gray-600 rounded text-white transition","aria-label":"Decrease quantity",children:d.jsx(Nw,{className:"w-4 h-4"})}),d.jsx("span",{className:"text-white font-semibold w-8 text-center",children:h.quantity}),d.jsx("button",{onClick:()=>e(h.productId,1),className:"p-1 bg-gray-700 hover:bg-gray-600 rounded text-white transition","aria-label":"Increase quantity",children:d.jsx(Tw,{className:"w-4 h-4"})})]}),d.jsxs("p",{className:"text-cyan-400 font-semibold",children:["$",(h.price*h.quantity).toFixed(2)]})]})]},h.productId))}),d.jsxs("div",{className:"border-t border-gray-700 pt-4 space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"text-lg font-semibold text-white",children:"Total"}),d.jsxs("span",{className:"text-2xl font-bold text-cyan-400",children:["$",r.toFixed(2)]})]}),d.jsx("button",{onClick:()=>{if(!c){alert("Please log in to checkout");return}p(!0)},className:"w-full py-3 px-4 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition",children:c?"Checkout":"Login to Checkout"})]})]})]})},P3=()=>{const{currentShop:t,setCurrentShop:e}=ch(),[n,r]=C.useState([]),[a,o]=C.useState([]),[c,f]=C.useState([]),[p,h]=C.useState(!0),{showToast:x}=Fn();C.useEffect(()=>{t&&v()},[t]);const v=async()=>{if(t)try{h(!0);const U=(await Cv(t.id)).filter(I=>I.quantity>0&&(!I.status||I.status==="ACTIVE"));r(U);const A=await nc();o(A)}catch(k){console.error("Failed to load inventory:",k),x("Failed to load inventory","error")}finally{h(!1)}},w=k=>{const U=a.find(A=>A.productId===k);return(U==null?void 0:U.productName)||"Unknown Product"},_=k=>{const U=w(k.productId),A=c.find(I=>I.productId===k.productId);if(A)A.quantity<k.quantity?(f(c.map(I=>I.productId===k.productId?{...I,quantity:I.quantity+1}:I)),x(`Added ${U} to cart`,"success")):x(`Only ${k.quantity} available`,"warning");else{const I=k.sellPrice||k.costPerUnit*1.4;f([...c,{productId:k.productId,productName:U,quantity:1,price:I,stockItem:k}]),x(`Added ${U} to cart`,"success")}},E=(k,U)=>{f(c.map(A=>{if(A.productId===k){const I=A.quantity+U,P=A.stockItem.quantity;return I<=0?null:I>P?(x(`Only ${P} available`,"warning"),A):{...A,quantity:I}}return A}).filter(Boolean))},N=k=>{f(c.filter(U=>U.productId!==k))};if(!t)return d.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:d.jsx("p",{className:"text-gray-400",children:"Please select a shop to start shopping"})});const D=c.reduce((k,U)=>k+U.price*U.quantity,0);return d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-white",children:t.name}),t.contactEmail&&d.jsx("p",{className:"text-gray-400 text-sm",children:t.contactEmail})]}),d.jsx("button",{onClick:()=>{e(null),f([])},className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition whitespace-nowrap",children:"Change Shop"})]})}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[d.jsx("div",{className:"lg:col-span-2",children:d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Available Products"}),p?d.jsxs("div",{className:"text-center py-12",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto"}),d.jsx("p",{className:"text-gray-400 mt-4",children:"Loading inventory..."})]}):n.length===0?d.jsx("div",{className:"text-center py-12",children:d.jsx("p",{className:"text-gray-400",children:"No products available at this shop"})}):d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(k=>{const U=w(k.productId),A=k.sellPrice||k.costPerUnit*1.4,I=c.find(B=>B.productId===k.productId),P=I!==void 0;return d.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4 hover:border-cyan-600 transition",children:[d.jsxs("div",{className:"flex justify-between items-start mb-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-semibold text-white",children:U}),d.jsxs("p",{className:"text-sm text-gray-400",children:[k.quantity," ",k.quantityType||"units"," available"]})]}),d.jsxs("div",{className:"text-right",children:[d.jsxs("p",{className:"text-lg font-bold text-cyan-400",children:["$",A.toFixed(2)]}),k.expirationDate&&d.jsxs("p",{className:"text-xs text-gray-500",children:["Exp: ",new Date(k.expirationDate).toLocaleDateString()]})]})]}),d.jsx("button",{onClick:()=>_(k),disabled:k.quantity===0||P&&I.quantity>=k.quantity,className:`w-full py-2 px-4 rounded-lg font-semibold transition ${k.quantity===0||P&&I.quantity>=k.quantity?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-cyan-600 hover:bg-cyan-700 text-white"}`,children:P?`In Cart (${I.quantity})`:"Add to Cart"})]},k.id)})})]})}),d.jsx("div",{className:"lg:col-span-1",children:d.jsx(M3,{cart:c,onUpdateQuantity:E,onRemoveItem:N,totalPrice:D,shopId:t.id,onPurchaseComplete:()=>{f([]),v()}})})]})]})},k3=({name:t})=>{const[e,n]=C.useState([]),[r,a]=C.useState([]),[o,c]=C.useState(""),[f,p]=C.useState(!0),[h,x]=C.useState(!1),[v,w]=C.useState(null),[_,E]=C.useState(!1),[N,D]=C.useState(null),[k,U]=C.useState(""),A=C.useRef(!1);C.useEffect(()=>{let P=!1;const B=setTimeout(async()=>{const H=o.trim();x(!!H),!H&&!A.current&&p(!0);try{const Q=await mf(H,30);if(P)return;H&&Q.length===0?(w("No such product found!"),n([])):(n(Q),w(null)),A.current=!0}catch(Q){P||w(Q instanceof Error?Q.message:"Failed to load products.")}finally{P||(p(!1),x(!1))}},250);return()=>{P=!0,clearTimeout(B)}},[o]),C.useEffect(()=>{(async()=>{try{const B=await mf("",200);a(B)}catch(B){console.warn("Failed to preload scanner catalog",B)}})()},[]);const I=async P=>{E(!1),x(!0),w(null);try{const B=r.length>0?r:e,{identifyProductNameFromImage:H}=await uw(async()=>{const{identifyProductNameFromImage:O}=await Promise.resolve().then(()=>u3);return{identifyProductNameFromImage:O}},void 0),Q=B.map(O=>O.name),J=await H(P,Q);if(J){const O=B.find(Z=>Z.name===J);O?(n([O]),U(O.name),c(O.name),D(O),w(null)):(w("Product found in image but not in catalog."),n([]))}else w("Could not identify product from image. Please try again."),n([])}catch(B){w("Visual search failed: "+(B instanceof Error?B.message:"Unknown error"))}finally{x(!1)}};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsxs("h1",{className:"text-3xl font-bold text-white mb-2",children:["Welcome, ",t,"!"]}),d.jsx("p",{className:"text-gray-300",children:"Search the live catalog to see if a product is available in nearby autonomous shops. You can search by name, manufacturer, category, or use the live visual search to find products by image."}),d.jsxs("div",{className:"mt-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[d.jsx("input",{type:"search",value:o,onChange:P=>c(P.target.value),placeholder:"Search products by name, category, or manufacturer...",className:"flex-1 px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),d.jsxs("button",{onClick:()=>E(!0),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-indigo-600 text-white font-semibold hover:bg-indigo-500",children:[d.jsx(Fs,{className:"w-5 h-5"}),"Live Visual Search"]})]}),(N||k)&&d.jsx("p",{className:"mt-3 text-sm text-cyan-300",children:k?d.jsxs(d.Fragment,{children:["Showing results for visual search: ",d.jsx("span",{className:"font-semibold",children:k})]}):d.jsxs(d.Fragment,{children:["Showing matches for ",d.jsx("span",{className:"font-semibold",children:N==null?void 0:N.name})," based on the latest scan."]})}),v&&d.jsx("p",{className:"mt-3 text-sm text-red-400",children:v})]}),d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-xl font-semibold text-white",children:"Product Catalog"}),f?d.jsx("span",{className:"text-sm text-gray-400",children:"Loading catalog..."}):h?d.jsx("span",{className:"text-sm text-gray-400",children:"Searching"}):d.jsxs("span",{className:"text-sm text-gray-400",children:[e.length," result(s)"]})]}),f?d.jsx("p",{className:"text-gray-400",children:"Fetching catalog..."}):e.length===0&&o.trim()?d.jsx("p",{className:"text-gray-400",children:"No such product found! Try a different keyword or use the live visual search."}):e.length===0?d.jsx("p",{className:"text-gray-400",children:"No products available. Try searching or use the live visual search."}):d.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.map(P=>d.jsxs("div",{className:"p-4 rounded-lg bg-gray-900/60 border border-gray-700",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("h3",{className:"text-lg font-semibold text-white truncate",title:P.name,children:P.name}),P.category&&d.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-cyan-900/40 text-cyan-200 border border-cyan-700/40",children:P.category})]}),d.jsx("p",{className:"text-sm text-gray-400 mb-2",children:P.manufacturer||"Unknown manufacturer"}),P.description&&d.jsx("p",{className:"text-xs text-gray-400 line-clamp-3",children:P.description})]},P.id))})]}),_&&d.jsx(Fa,{onDataScanned:P=>{const B=P.blobs.get("productName")||P.blobs.get("manufacturer")||Array.from(P.blobs.values())[0];B?I(B):(w("No image captured. Please try again."),E(!1))},onClose:()=>E(!1),productOptions:r.map(P=>({productId:P.id,productName:P.name})),mode:"visual-search"})]})},U3=({onLogout:t,name:e})=>{const{currentShop:n,setCurrentShop:r}=ch(),{customer:a,setCustomer:o,clearCustomer:c}=Rw(),[f,p]=C.useState(!1),[h,x]=C.useState("discovery"),{showToast:v}=Fn(),w=E=>{var D;const N=E.user;if((D=N.roles)!=null&&D.shop||N.shopId){v("Shop account detected. Please sign in via the shop dashboard.","info"),p(!1);return}o(E),p(!1),v("Welcome! You can now checkout.","success")},_=()=>{c(),v("Logged out successfully","success"),t==null||t(),p(!1)};return C.useEffect(()=>{n&&x("shop")},[n]),d.jsxs("div",{className:"min-h-screen bg-gray-900",children:[d.jsx("div",{className:"bg-gray-800/50 border-b border-gray-700 p-4",children:d.jsxs("div",{className:"container mx-auto flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-xl font-bold text-white",children:"ShopNexus Customer"}),a&&d.jsxs("p",{className:"text-sm text-gray-400",children:["Logged in as ",a.user.companyName||a.user.email]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[n&&d.jsx("button",{onClick:()=>{r(null),x("discovery")},className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Change Shop"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>x("discovery"),className:`px-4 py-2 text-sm border rounded-lg transition ${h==="discovery"?"bg-cyan-600 text-white border-cyan-600":"text-gray-300 border-gray-600 hover:bg-gray-700"}`,children:"Browse Catalog"}),n&&d.jsx("button",{onClick:()=>x("shop"),className:`px-4 py-2 text-sm border rounded-lg transition ${h==="shop"?"bg-cyan-600 text-white border-cyan-600":"text-gray-300 border-gray-600 hover:bg-gray-700"}`,children:"Shop View"})]}),a?d.jsx("button",{onClick:_,className:"px-4 py-2 text-sm text-gray-300 hover:text-white border border-gray-600 rounded-lg hover:bg-gray-700 transition",children:"Logout"}):d.jsx("button",{onClick:()=>p(!0),className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Login"})]})]})}),d.jsx("div",{className:"container mx-auto p-4 md:p-8",children:f?d.jsxs("div",{className:"max-w-lg mx-auto",children:[d.jsx(cw,{onAuthenticated:w}),d.jsx("button",{onClick:()=>p(!1),className:"mt-4 w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition",children:"Cancel"})]}):h==="discovery"?d.jsxs(d.Fragment,{children:[!n&&d.jsx(Rx,{}),n&&d.jsx("div",{className:"mb-6",children:d.jsx(Rx,{})}),d.jsx(k3,{name:e||"Guest"})]}):d.jsx(P3,{})})]})},Dx=({name:t,initialProfile:e,onLogout:n})=>d.jsx(I3,{children:d.jsx(R3,{initialCustomer:e,children:d.jsx(U3,{name:t,onLogout:n})})}),j3=({name:t})=>{const[e,n]=C.useState([]),[r,a]=C.useState(!0),[o,c]=C.useState(""),[f,p]=C.useState(""),[h,x]=C.useState(null),v=async()=>{a(!0),x(null);try{const _=await Ys();n(_)}catch(_){x(_ instanceof Error?_.message:"Failed to load suppliers.")}finally{a(!1)}};C.useEffect(()=>{v()},[]);const w=async _=>{if(_.preventDefault(),!o.trim()){x("Supplier name is required.");return}x(null);try{await Ui({name:o.trim(),contactEmail:f.trim()||void 0}),c(""),p(""),await v()}catch(E){x(E instanceof Error?E.message:"Failed to create supplier.")}};return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Supplier Console"}),d.jsxs("p",{className:"text-gray-300",children:["Hello ",t,"! Manage your supplier network here. Register local suppliers (created by your shop) or review existing ones (local or global suppliers linked to registered users)."]})]}),d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Register Local Supplier"}),d.jsxs("form",{onSubmit:w,className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Supplier Name"}),d.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:o,onChange:_=>c(_.target.value),required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Contact Email (optional)"}),d.jsx("input",{type:"email",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:f,onChange:_=>p(_.target.value)})]}),d.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold",children:"Add Supplier"})]}),h&&d.jsx("p",{className:"text-red-400 text-sm mt-2",children:h})]}),d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-xl font-semibold text-white",children:"Suppliers"}),d.jsx("button",{onClick:v,className:"px-3 py-1.5 bg-gray-700 rounded-md text-sm text-white hover:bg-gray-600",children:"Refresh"})]}),r?d.jsx("p",{className:"text-gray-400",children:"Loading suppliers..."}):e.length===0?d.jsx("p",{className:"text-gray-500",children:"No suppliers yet. Add a local supplier above."}):d.jsx("div",{className:"space-y-3",children:e.map(_=>d.jsx("div",{className:"p-3 bg-gray-900/40 rounded-lg border border-gray-700 hover:bg-gray-900/60 transition-colors",children:d.jsx("div",{className:"flex items-start justify-between",children:d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("p",{className:"text-white font-semibold",children:_.name}),_.shopId?d.jsx("span",{className:"text-xs bg-cyan-600/20 text-cyan-400 px-2 py-1 rounded",children:"Local"}):_.linkedUserId?d.jsx("span",{className:"text-xs bg-green-600/20 text-green-400 px-2 py-1 rounded",children:"Global"}):null]}),_.contact&&d.jsx("p",{className:"text-sm text-gray-400 mt-1",children:_.contact}),_.linkedUserId&&d.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Linked User ID: ",_.linkedUserId]}),_.shopId&&d.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Shop ID: ",_.shopId]})]})})},_.id))})]})]})},O3=({onClose:t,onProductCreated:e})=>{const n=C.useRef(null),r=C.useRef(null),a=C.useRef(null),o=C.useRef(null),[c,f]=C.useState("scanning"),[p,h]=C.useState(null),[x,v]=C.useState({}),[w,_]=C.useState(new Set),[E,N]=C.useState(new Map),[D,k]=C.useState(null),[U,A]=C.useState(null),[I,P]=C.useState(null),[B,H]=C.useState(!1),Q=C.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=null)},[]),J=C.useCallback(()=>{if(n.current&&a.current){const R=n.current,G=a.current,X=R.getBoundingClientRect();G.width=X.width,G.height=X.height}},[]);C.useEffect(()=>{let R=null;return(async()=>{try{R=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),n.current&&(n.current.srcObject=R,n.current.onloadedmetadata=()=>J())}catch{h("Could not access camera. Please grant permissions.")}})(),window.addEventListener("resize",J),()=>{window.removeEventListener("resize",J),Q(),R==null||R.getTracks().forEach(X=>X.stop())}},[J,Q]);const O=C.useCallback(async()=>{if(!n.current||!r.current||document.hidden||c!=="scanning")return;const R=n.current,G=r.current;G.width=R.videoWidth,G.height=R.videoHeight;const X=G.getContext("2d");if(!X)return;X.drawImage(R,0,0,R.videoWidth,R.videoHeight);const ce=await new Promise(re=>G.toBlob(re,"image/jpeg",.8));if(!(!ce||c!=="scanning"))try{const re=await sc(ce);v(M=>{const q={...M};for(const K in re){const ie=K;w.has(ie)||(q[ie]=re[ie])}return q})}catch(re){console.warn("Auto-scan failed:",re)}},[c,w]);C.useEffect(()=>{c==="scanning"&&!o.current?o.current=window.setInterval(O,3500):c!=="scanning"&&Q()},[c,O,Q]);const Z=R=>{k(R),f("drawingBox"),A(null),P(null)},ae=R=>{var re;if(c!=="drawingBox"||!D)return;const G=(re=a.current)==null?void 0:re.getBoundingClientRect();if(!G)return;const X=R.clientX-G.left,ce=R.clientY-G.top;if(!U)A({x:X,y:ce});else{const M={x:Math.min(U.x,X),y:Math.min(U.y,ce),width:Math.abs(X-U.x),height:Math.abs(ce-U.y)};M.width>5&&M.height>5&&(P(M),ve(M)),A(null)}},ve=C.useCallback(async R=>{if(!n.current||!r.current||!D)return;f("analyzing");const G=n.current,X=r.current,ce=G.videoWidth/G.clientWidth,re=G.videoHeight/G.clientHeight,M=R.x*ce,q=R.y*re,K=R.width*ce,ie=R.height*re;X.width=K,X.height=ie;const de=X.getContext("2d");if(de){de.drawImage(G,M,q,K,ie,0,0,K,ie);const me=await new Promise(Te=>X.toBlob(Te,"image/jpeg",.9));if(me){N(Te=>new Map(Te).set(D,me));try{const Te=await ih(me,D);v(ne=>({...ne,[D]:Te})),_(ne=>new Set(ne).add(D))}catch(Te){h(Te instanceof Error?Te.message:"Analysis failed")}}}k(null),P(null),f("scanning")},[D]),ye=async()=>{const R=x;if(!R.productName||!R.manufacturer||!R.category){h("Product Name, Manufacturer, and Category are required to save."),f("scanning");return}if(!ue){h("No shop selected. Please select a shop before saving."),f("scanning");return}H(!0),h(null);try{const G=await ki({name:R.productName,manufacturer:R.manufacturer,category:R.category,description:R.productDescription||""}),X=Array.from(E.entries()).map(([ie,de])=>Lf(G.name,ie,de,{productId:G.id,source:"manual"}));await Promise.all(X);const ce=new Date().toISOString(),re=ht(),M={ocrText:R.productName||"",confidence:1,sourcePhotoId:re,fieldCaptures:Array.from(E.keys()).map(ie=>({field:String(ie),captureId:ht(),source:"manual",capturedAt:ce,confidence:.9}))},q=Array.from(E.entries()).map(([ie,de])=>({url:"",type:"manual",source:String(ie),addedAt:ce})),K={id:Date.now(),inventoryUuid:re,shopId:ue,productId:G.id,batchId:"",expirationDate:R.expirationDate||new Date(Date.now()+365*24*60*60*1e3).toISOString(),quantity:R.quantity||1,costPerUnit:R.buyPrice||0,buyPrice:R.buyPrice,sellPrice:R.sellPrice||(R.buyPrice?R.buyPrice*1.4:void 0),location:R.location,images:q.length>0?q:void 0,scanMetadata:M,qdrantId:re,status:"ACTIVE",createdByUserId:ue,createdAt:ce,updatedAt:ce,shareScope:["local"]};await Cr(K,M),e(),t()}catch(G){h(G instanceof Error?G.message:"Failed to save product.")}finally{H(!1)}},Me=()=>c==="scanning"?"Auto-scanning product... Tap screen to manually select a field.":c==="drawingBox"?U?"Tap the opposite corner to create a selection.":`Tap the first corner for ${un[D].displayName}.`:c==="analyzing"?`Analyzing ${un[D].displayName}...`:c==="verifying"?"Review the extracted data and confirm to save the new product.":"";return c==="verifying"?d.jsxs("div",{className:"fixed inset-0 bg-gray-900 z-50 p-4 sm:p-8 flex flex-col","aria-modal":"true",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Verify New Product"}),p&&d.jsx("p",{className:"bg-red-900/50 text-red-300 p-3 rounded-md mb-4",children:p}),d.jsx("div",{className:"flex-grow overflow-y-auto space-y-4 bg-gray-800/50 p-4 rounded-lg",children:Object.entries(x).map(([R,G])=>{var re;const X=R,ce=E.get(X);return d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-400",children:((re=un[X])==null?void 0:re.displayName)||R}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("input",{value:String(G),onChange:M=>v(q=>({...q,[X]:M.target.value})),className:"flex-grow px-3 py-2 rounded-md bg-gray-700 border border-gray-600 text-white"}),ce&&d.jsx("img",{src:URL.createObjectURL(ce),alt:`Crop of ${R}`,className:"w-24 h-12 object-contain rounded-md bg-black"})]})]},R)})}),d.jsxs("div",{className:"flex-shrink-0 pt-6 flex justify-end gap-4",children:[d.jsx("button",{onClick:()=>f("scanning"),disabled:B,className:"px-6 py-2 rounded-md bg-gray-600 text-white font-semibold",children:"Back to Scanner"}),d.jsx("button",{onClick:ye,disabled:B,className:"px-6 py-2 rounded-md bg-cyan-600 text-white font-semibold",children:B?"Saving...":"Confirm & Save Product"})]})]}):d.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex","aria-modal":"true",children:[d.jsxs("div",{className:"flex-grow relative",children:[d.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),d.jsx("canvas",{ref:r,className:"hidden"}),d.jsx("canvas",{ref:a,className:"absolute inset-0 w-full h-full z-10",onClick:ae}),p&&d.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-red-800/80 text-white p-3 rounded-lg text-center z-30 max-w-md mx-auto",children:p}),d.jsx("div",{className:"absolute top-4 left-4 bg-black/50 text-white px-4 py-2 rounded-full z-20 text-center text-sm",children:Me()})]}),d.jsxs("div",{className:"w-full md:w-96 bg-gray-900/80 backdrop-blur-sm border-l border-gray-700 flex flex-col p-4 space-y-4",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h2",{className:"text-xl font-bold text-white",children:"Learn Product"}),d.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:""})]}),d.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 pr-2",children:Object.keys(un).map(R=>{const G=w.has(R),X=x[R]!==void 0&&x[R]!==""&&x[R]!==0;return d.jsxs("button",{onClick:()=>Z(R),className:`w-full text-left p-3 rounded-md transition-colors flex items-center justify-between ${G?"bg-indigo-800/50":"bg-gray-700/50 hover:bg-gray-700"}`,children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-semibold text-white",children:un[R].displayName}),X&&d.jsx("p",{className:"text-sm text-cyan-300 truncate",children:String(x[R])})]}),G&&d.jsx(_w,{className:"w-5 h-5 text-indigo-300 flex-shrink-0"})]},R)})}),d.jsx("div",{className:"flex-shrink-0",children:d.jsxs("button",{onClick:()=>f("verifying"),className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-cyan-600 text-white font-semibold rounded-md hover:bg-cyan-700 transition-colors",children:[d.jsx(lh,{className:"w-6 h-6"}),"Verify & Save"]})})]})]})},L3=t=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[d.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),d.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),q3=()=>{const[t,e]=C.useState([]),[n,r]=C.useState([]),[a,o]=C.useState(!0),[c,f]=C.useState(null),[p,h]=C.useState(""),[x,v]=C.useState(""),[w,_]=C.useState(""),[E,N]=C.useState(""),[D,k]=C.useState(void 0),[U,A]=C.useState(""),[I,P]=C.useState(!1),[B,H]=C.useState([]),[Q,J]=C.useState(""),[O,Z]=C.useState(""),[ae,ve]=C.useState(""),[ye,Me]=C.useState(null),[R,G]=C.useState(null),[X,ce]=C.useState(!1),{showToast:re}=Fn(),M=async()=>{o(!0),f(null);try{const[ne,ee]=await Promise.all([ec(),Ys()]);e(ne),r(ne),H(ee.map(be=>({id:be.id,name:be.name||be.id})))}catch(ne){f(ne instanceof Error?ne.message:"Failed to load products.")}finally{o(!1)}};Mx.useEffect(()=>{let ne=t;if(Q.trim()){const ee=Q.toLowerCase();ne=ne.filter(be=>be.name.toLowerCase().includes(ee)||be.manufacturer.toLowerCase().includes(ee)||be.category.toLowerCase().includes(ee)||be.description&&be.description.toLowerCase().includes(ee))}O&&(ne=ne.filter(ee=>ee.category===O)),ae&&(ne=ne.filter(ee=>ee.manufacturer===ae)),r(ne)},[t,Q,O,ae]),C.useEffect(()=>{M()},[]);const q=()=>{M(),re("New product successfully learned and added to catalog!","success")},K=async ne=>{if(ne.preventDefault(),!p.trim()){f("Name is required.");return}P(!0),f(null);try{const ee=U?[{url:U.trim(),type:"manual",source:"user",addedAt:new Date().toISOString()}]:[];await ki({name:p,manufacturer:x,category:w,description:E,defaultSupplierId:D,images:ee}),h(""),v(""),_(""),N(""),A(""),k(void 0),await M(),re("Product created successfully!","success")}catch(ee){const be=ee instanceof Error?ee.message:"Failed to create product.";f(be),re(be,"error")}finally{P(!1)}},ie=ne=>{var ee,be;Me(ne),h(ne.name),v(ne.manufacturer),_(ne.category),N(ne.description||""),A(((be=(ee=ne.images)==null?void 0:ee[0])==null?void 0:be.url)||""),k(ne.defaultSupplierId||void 0)},de=()=>{Me(null),h(""),v(""),_(""),N(""),A(""),k(void 0),f(null)},me=async ne=>{if(ne.preventDefault(),!ye||!p.trim()){f("Name is required.");return}P(!0),f(null);try{const ee=U?[{url:U.trim(),type:"manual",source:"user",addedAt:new Date().toISOString()}]:[];await mv(ye.id,{name:p,manufacturer:x,category:w,description:E,defaultSupplierId:D,images:ee}),de(),await M(),re("Product updated successfully!","success")}catch(ee){const be=ee instanceof Error?ee.message:"Failed to update product.";f(be),re(be,"error")}finally{P(!1)}},Te=async ne=>{try{await gv(ne),G(null),await M(),re("Product deleted successfully!","success")}catch(ee){const be=ee instanceof Error?ee.message:"Failed to delete product.";re(be,"error")}};return d.jsxs(d.Fragment,{children:[X&&d.jsx(O3,{onClose:()=>ce(!1),onProductCreated:q}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h1",{className:"text-2xl font-bold text-white",children:"Product Catalog"}),d.jsxs("button",{onClick:()=>ce(!0),className:"flex items-center justify-center gap-3 py-3 px-6 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:[d.jsx(Sw,{className:"w-6 h-6"}),"Scan & Train New Product"]})]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Use the AI scanner to learn new products. The system will extract all relevant information sections from the product image and learn where to look for specific data fields for future scans."})]}),d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:ye?"Edit Product":"Create Product Manually"}),d.jsxs("form",{onSubmit:ye?me:K,className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Name"}),d.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:p,onChange:ne=>h(ne.target.value),required:!0})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Manufacturer"}),d.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:x,onChange:ne=>v(ne.target.value)})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Category"}),d.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:w,onChange:ne=>_(ne.target.value)})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Description"}),d.jsx("textarea",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:E,onChange:ne=>N(ne.target.value),rows:3})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Default Supplier"}),d.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:D||"",onChange:ne=>k(ne.target.value||void 0),children:[d.jsx("option",{value:"",children:"None"}),B.map(ne=>d.jsx("option",{value:ne.id,children:ne.name},ne.id))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Image URL"}),d.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:U,onChange:ne=>A(ne.target.value),placeholder:"https://example.com/photo.jpg"})]})]}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"submit",disabled:I,className:"px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold disabled:opacity-60 hover:bg-cyan-700 transition-colors",children:I?ye?"Updating...":"Creating...":ye?"Update Product":"Create Product"}),ye&&d.jsx("button",{type:"button",onClick:de,disabled:I,className:"px-4 py-2 rounded-md bg-gray-700 text-white font-semibold disabled:opacity-60 hover:bg-gray-600 transition-colors",children:"Cancel"})]})]}),c&&d.jsx("p",{className:"text-red-400 text-sm mt-2",children:c})]}),d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-xl font-semibold text-white",children:"All Products"}),d.jsx("button",{onClick:M,className:"px-3 py-1.5 rounded-md bg-gray-700 text-sm text-white hover:bg-gray-600",children:"Refresh"})]}),d.jsxs("div",{className:"mb-6 space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Search Products"}),d.jsx("input",{type:"text",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",placeholder:"Search by name, manufacturer, category, or description...",value:Q,onChange:ne=>J(ne.target.value)})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Filter by Category"}),d.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:O,onChange:ne=>Z(ne.target.value),children:[d.jsx("option",{value:"",children:"All Categories"}),Array.from(new Set(t.map(ne=>ne.category).filter(Boolean))).sort().map(ne=>d.jsx("option",{value:ne,children:ne},ne))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Filter by Manufacturer"}),d.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:ae,onChange:ne=>ve(ne.target.value),children:[d.jsx("option",{value:"",children:"All Manufacturers"}),Array.from(new Set(t.map(ne=>ne.manufacturer).filter(Boolean))).sort().map(ne=>d.jsx("option",{value:ne,children:ne},ne))]})]})]})]}),a?d.jsx("p",{className:"text-gray-400",children:"Loading products..."}):n.length===0?d.jsxs("div",{className:"text-center py-12",children:[d.jsx(L3,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-500 text-lg mb-2",children:t.length===0?"No products yet.":"No products match your filters."}),t.length===0&&d.jsx("button",{onClick:()=>ce(!0),className:"mt-4 px-6 py-3 rounded-md bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition-colors",children:"Scan Your First Product"})]}):d.jsxs("div",{className:"space-y-3",children:[d.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",n.length," of ",t.length," products"]}),n.map(ne=>{var ee;return d.jsxs("div",{className:"p-4 bg-gray-900/40 rounded-lg border border-gray-700 hover:bg-gray-900/60 transition-colors",children:[d.jsxs("div",{className:"flex items-start justify-between gap-4",children:[d.jsx("div",{className:"flex-1 min-w-0",children:d.jsxs("div",{className:"flex items-start gap-3",children:[ne.images&&ne.images[0]&&d.jsx("img",{src:ne.images[0].url,alt:ne.name,className:"w-16 h-16 object-cover rounded-md flex-shrink-0",onError:be=>{be.target.style.display="none"}}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("p",{className:"text-white font-semibold text-lg",children:ne.name}),d.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[ne.manufacturer,"  ",ne.category]}),ne.description&&d.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:ne.description}),ne.defaultSupplierId&&d.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700",children:[d.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Default Supplier:"}),d.jsx("span",{className:"inline-block px-2 py-0.5 text-xs bg-blue-900/30 text-blue-300 rounded border border-blue-700/50",children:((ee=B.find(be=>be.id===ne.defaultSupplierId))==null?void 0:ee.name)||ne.defaultSupplierId})]})]})]})}),d.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[d.jsx("button",{onClick:()=>ie(ne),className:"px-3 py-1.5 rounded-md bg-blue-600/80 text-white text-sm hover:bg-blue-600 transition-colors",title:"Edit product",children:"Edit"}),d.jsx("button",{onClick:()=>G(ne.id),className:"px-3 py-1.5 rounded-md bg-red-600/80 text-white text-sm hover:bg-red-600 transition-colors",title:"Delete product",children:"Delete"})]})]}),R===ne.id&&d.jsxs("div",{className:"mt-4 p-3 bg-red-900/30 border border-red-700 rounded-md",children:[d.jsxs("p",{className:"text-red-300 text-sm mb-3",children:['Are you sure you want to delete "',ne.name,'"?']}),d.jsxs("div",{className:"flex space-x-2",children:[d.jsx("button",{onClick:()=>Te(ne.id),className:"px-3 py-1.5 rounded-md bg-red-600 text-white text-sm hover:bg-red-700 transition-colors",children:"Yes, Delete"}),d.jsx("button",{onClick:()=>G(null),className:"px-3 py-1.5 rounded-md bg-gray-700 text-white text-sm hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]},ne.id)})]})]})]})]})},B3=()=>{const[t,e]=C.useState([]),[n,r]=C.useState([]),[a,o]=C.useState([]),[c,f]=C.useState(!0),[p,h]=C.useState({deliveryDate:new Date().toISOString().split("T")[0],lineItems:[],documents:[]}),[x,v]=C.useState([]),[w,_]=C.useState(!1),[E,N]=C.useState(!1),[D,k]=C.useState(!1),[U,A]=C.useState(null),I=C.useRef(null),P=C.useMemo(()=>new Map(a.map(R=>[R.id,R])),[a]),B=C.useMemo(()=>new Map(n.map(R=>[R.id,R.name||R.id])),[n]),H=async()=>{f(!0),A(null);try{const[R,G,X]=await Promise.all([vv(),Ys(),ec()]);e(R.sort((ce,re)=>new Date(re.deliveryDate).getTime()-new Date(ce.deliveryDate).getTime())),r(G),o(X)}catch(R){A(R instanceof Error?R.message:"Failed to load data.")}finally{f(!1)}};C.useEffect(()=>{H()},[]);const Q=()=>{h({deliveryDate:new Date().toISOString().split("T")[0],lineItems:[],documents:[]}),v([]),I.current&&(I.current.value="")},J=R=>{R.target.files&&v(G=>[...G,...Array.from(R.target.files)])},O=R=>{v(G=>G.filter((X,ce)=>ce!==R))},Z=async()=>{if(x.length!==0){N(!0),A(null);try{const R=await fw(x),G=n.find(ce=>R.supplierName&&ce.name.toLowerCase().includes(R.supplierName.toLowerCase())),X=R.items.map(ce=>{const re=a.find(M=>M.name.toLowerCase()===ce.productName.toLowerCase());return{productId:(re==null?void 0:re.id)||"",productName:ce.productName,quantity:ce.quantity,cost:ce.costPerUnit}});h(ce=>({...ce,supplierId:(G==null?void 0:G.id)||ce.supplierId,invoiceNumber:R.invoiceNumber||ce.invoiceNumber,deliveryDate:R.deliveryDate||ce.deliveryDate,lineItems:X}))}catch(R){A(R instanceof Error?R.message:"Failed to analyze documents.")}finally{N(!1)}}},ae=(R,G,X)=>{const ce=[...p.lineItems||[]];if(ce[R]={...ce[R],[G]:X},G==="productId"){const re=P.get(X);re&&(ce[R].productName=re.name)}h(re=>({...re,lineItems:ce}))},ve=()=>{const R={productId:"",productName:"Manual Entry",quantity:1,cost:0};h(G=>({...G,lineItems:[...G.lineItems||[],R]}))},ye=R=>{h(G=>{var X;return{...G,lineItems:(X=G.lineItems)==null?void 0:X.filter((ce,re)=>re!==R)}})},Me=async R=>{if(R.preventDefault(),!p.deliveryDate||!p.lineItems||p.lineItems.length===0){A("Delivery date and at least one valid line item are required.");return}const G=p.lineItems.filter(X=>X.productId&&X.quantity>0);if(G.length===0){A("At least one line item must be assigned to a product.");return}_(!0),A(null);try{await Oa({...p,deliveryDate:p.deliveryDate,lineItems:G}),Q(),await H()}catch(X){A(X instanceof Error?X.message:"Failed to create batch.")}finally{_(!1)}};return d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[d.jsx(rh,{className:"w-6 h-6 text-cyan-400"}),"Log New Delivery Batch"]}),d.jsxs("form",{onSubmit:Me,className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Delivery Date"}),d.jsx("input",{type:"date",className:"form-input",value:p.deliveryDate||"",onChange:R=>h(G=>({...G,deliveryDate:R.target.value})),required:!0})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Supplier"}),d.jsxs("select",{className:"form-input",value:p.supplierId||"",onChange:R=>h(G=>({...G,supplierId:R.target.value||void 0})),children:[d.jsx("option",{value:"",children:"Select Supplier..."}),n.map(R=>d.jsx("option",{value:R.id,children:R.name},R.id))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Invoice Number"}),d.jsx("input",{className:"form-input",value:p.invoiceNumber||"",onChange:R=>h(G=>({...G,invoiceNumber:R.target.value}))})]})]}),d.jsxs("div",{className:"p-4 border border-gray-700 rounded-lg space-y-3",children:[d.jsx("h3",{className:"text-base font-semibold text-gray-200",children:"Upload Documents"}),d.jsx("input",{type:"file",ref:I,onChange:J,accept:"image/*",className:"hidden",multiple:!0}),d.jsxs("button",{type:"button",onClick:()=>{var R;return(R=I.current)==null?void 0:R.click()},className:"button-secondary w-full",children:[d.jsx(Ew,{className:"w-5 h-5"})," Add Document(s)"]}),d.jsx("div",{className:"space-y-2",children:x.map((R,G)=>d.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 p-2 rounded text-sm",children:[d.jsx("span",{className:"truncate text-gray-300",children:R.name}),d.jsx("button",{type:"button",onClick:()=>O(G),className:"text-red-400 hover:text-red-300",children:d.jsx(zl,{className:"w-4 h-4"})})]},G))}),x.length>0&&d.jsx("button",{type:"button",onClick:Z,disabled:E,className:"button-primary w-full",children:E?"Analyzing...":`Analyze ${x.length} Document(s) with AI`})]})]}),d.jsxs("div",{className:"space-y-4 p-4 border border-gray-700 rounded-lg bg-gray-900/20",children:[d.jsx("h3",{className:"text-base font-semibold text-gray-200",children:"Line Items"}),d.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(p.lineItems||[]).map((R,G)=>d.jsxs("div",{className:"p-2 rounded-md bg-gray-800/50 grid grid-cols-12 gap-2 items-center",children:[d.jsxs("div",{className:"col-span-6",children:[d.jsxs("select",{className:"form-input text-sm",value:R.productId,onChange:X=>ae(G,"productId",X.target.value),required:!0,children:[d.jsx("option",{value:"",children:"Match Product..."}),a.map(X=>d.jsx("option",{value:X.id,children:X.name},X.id))]}),R.productId===""&&d.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:['Unmatched: "',R.productName,'"']})]}),d.jsx("div",{className:"col-span-2",children:d.jsx("input",{type:"number",placeholder:"Qty",className:"form-input text-sm",value:R.quantity,onChange:X=>ae(G,"quantity",Number(X.target.value))})}),d.jsx("div",{className:"col-span-3",children:d.jsx("input",{type:"number",placeholder:"Cost",step:"0.01",className:"form-input text-sm",value:R.cost,onChange:X=>ae(G,"cost",Number(X.target.value))})}),d.jsx("div",{className:"col-span-1",children:d.jsx("button",{type:"button",onClick:()=>ye(G),className:"text-red-400 hover:text-red-300",children:d.jsx(zl,{className:"w-4 h-4"})})})]},G))}),d.jsx("button",{type:"button",onClick:ve,className:"button-secondary text-sm",children:"Add Manual Item"}),d.jsx("button",{type:"submit",disabled:w,className:"button-primary w-full",children:w?"Saving Batch...":"Save Batch"})]})]}),U&&d.jsx("p",{className:"text-red-400 text-sm mt-4",children:U})]}),d.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-xl font-semibold text-white",children:"Logged Batches"}),d.jsx("button",{onClick:H,className:"button-secondary text-sm",children:"Refresh"})]}),c?d.jsx("p",{className:"text-gray-400",children:"Loading batches..."}):t.length===0?d.jsx("p",{className:"text-gray-500 text-center py-4",children:"No batches logged yet."}):d.jsx("div",{className:"space-y-3",children:t.map(R=>{var G,X;return d.jsxs("details",{className:"p-3 bg-gray-900/40 rounded-lg border border-gray-700 transition-colors",children:[d.jsx("summary",{className:"cursor-pointer",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{children:[d.jsxs("p",{className:"text-white font-semibold",children:["Delivery: ",R.deliveryDate]}),d.jsxs("p",{className:"text-sm text-gray-400",children:["Supplier: ",B.get(R.supplierId||"")||R.supplierId||"N/A"]}),d.jsxs("p",{className:"text-xs text-gray-500",children:["Invoice #: ",R.invoiceNumber||"N/A"]})]}),d.jsx("div",{className:"text-right text-sm",children:d.jsxs("span",{className:"text-gray-300",children:[((G=R.lineItems)==null?void 0:G.length)||0," items"]})})]})}),d.jsx("div",{className:"mt-3 pt-3 border-t border-gray-700",children:d.jsx("ul",{className:"space-y-1 text-sm",children:(X=R.lineItems)==null?void 0:X.map((ce,re)=>{var M;return d.jsxs("li",{className:"flex justify-between text-gray-300",children:[d.jsxs("span",{children:[ce.quantity,"x ",((M=P.get(ce.productId))==null?void 0:M.name)||ce.productName]}),d.jsxs("span",{className:"text-gray-400",children:["$",ce.cost.toFixed(2),"/unit"]})]},re)})})})]},R.id)})})]}),d.jsx("style",{children:`
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            background-color: #1f2937;
            border: 1px solid #4b5563;
            color: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #22d3ee;
            box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.4);
        }
        .button-primary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            border-radius: 0.375rem;
            background-color: #0891b2;
            color: white;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .button-primary:hover {
            background-color: #0e7490;
        }
        .button-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .button-secondary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #4b5563;
            color: white;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .button-secondary:hover {
            background-color: #6b7280;
        }
      `})]})},V3=()=>{var R,G,X,ce;const[t,e]=C.useState(null),{toasts:n,removeToast:r}=Fn(),a=(t==null?void 0:t.user)??null,o=!!((R=a==null?void 0:a.roles)!=null&&R.shop||a!=null&&a.shopId),c=!!((G=a==null?void 0:a.roles)!=null&&G.customer||a!=null&&a.customerId),f=!!((X=a==null?void 0:a.roles)!=null&&X.supplier||a!=null&&a.supplierId),[p,h]=C.useState([]),[x,v]=C.useState([]),[w,_]=C.useState([]),[E,N]=C.useState("dashboard"),[D,k]=C.useState(!0),U=!a,A=C.useMemo(()=>{if(!(t!=null&&t.shopContext)||!a)return null;let re;if(typeof t.shopContext=="string")re=t.shopContext;else if(t.shopContext&&typeof t.shopContext=="object"&&"id"in t.shopContext)re=t.shopContext.id;else return null;return{id:re,name:a.companyName,contactEmail:a.email,location:a.address,qdrantNamespace:re}},[t==null?void 0:t.shopContext,(ce=t==null?void 0:t.user)==null?void 0:ce.shopId,a==null?void 0:a.shopId,a==null?void 0:a.companyName,a==null?void 0:a.email,a==null?void 0:a.address]),I=C.useRef(null);C.useEffect(()=>{var q;const re=(q=I.current)==null?void 0:q.id,M=A==null?void 0:A.id;re!==M&&(I.current=A,Ga(A))},[A]);const P=C.useCallback(async re=>{var q;if(!re){k(!1);return}const M=!!((q=re.roles)!=null&&q.shop||re.shopId);if(k(!0),M){const K=await nc(),ie=await Xb(),de=await eh();v(K),h(ie),_(de)}else v([]),h([]),_([]);k(!1)},[]),B=C.useRef(!1),H=C.useRef(null);C.useEffect(()=>{var K;if(U||!a){B.current=!1;return}const re=!!((K=a.roles)!=null&&K.shop||a.shopId),M=a.shopId||null;if(!re||B.current&&H.current===M)return;(async()=>{await Yb(),await P(a),B.current=!0,H.current=M})()},[U,a==null?void 0:a.shopId,P]),C.useEffect(()=>{if(!a||!o)return;const re=setInterval(()=>{P(a)},6e4);return()=>clearInterval(re)},[a,o,P]);const Q=C.useCallback(re=>{var q,K,ie;e(re),k(!1);const M=re.user;M.shopId||(q=M.roles)!=null&&q.shop?N("dashboard"):M.supplierId||(K=M.roles)!=null&&K.supplier?N("supplier"):M.customerId||(ie=M.roles)!=null&&ie.customer?N("customer"):N("dashboard")},[]),J=C.useCallback(()=>{e(null),h([]),v([]),_([]),N("dashboard")},[]),O=async(re,M)=>{await Ci(re,M),a&&await P(a)},Z=async re=>{await Zf(re),a&&await P(a)},ae=async(re,M)=>{await Wb(re,M),await MD(re.listingId,M),a&&await P(a)},ve=re=>N(re),ye=C.useMemo(()=>{if(!a||!o)return[];const re=w.filter(q=>q.quantity>0&&(!q.status||q.status==="ACTIVE")),M=new Map(x.map(q=>[q.productId,q]));return re.map(q=>{const K=M.get(q.productId);return{id:q.id,batchId:String(q.batchId),productId:q.productId,inventoryUuid:q.inventoryUuid,productName:(K==null?void 0:K.productName)||"N/A",manufacturer:(K==null?void 0:K.manufacturer)||"N/A",category:(K==null?void 0:K.category)||"N/A",expirationDate:q.expirationDate,quantity:q.quantity,quantityType:(K==null?void 0:K.quantityType)||"units",costPerUnit:q.costPerUnit,location:q.location||void 0,createdAt:q.createdAt,updatedAt:q.updatedAt,supplierId:q.supplierId||null,buyPrice:q.buyPrice??q.costPerUnit,sellPrice:q.sellPrice??void 0}})},[w,x,a==null?void 0:a.shopId,o]);return a&&c&&!o?d.jsx(Dx,{name:a.companyName||"Guest",initialProfile:t??void 0,onLogout:J}):U?d.jsx(cw,{onAuthenticated:Q}):!a||o&&D?d.jsxs("div",{className:"min-h-screen bg-gray-900 flex flex-col items-center justify-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"}),d.jsx("p",{className:"mt-4 text-lg",children:"Initializing Application..."})]}):d.jsxs("div",{className:"min-h-screen bg-gray-900 text-gray-100 font-sans",children:[d.jsx(WD,{activeTab:E,onTabChange:ve,user:a,onLogout:J,isBackendAvailable:$4}),d.jsxs("main",{className:"container mx-auto p-4 md:p-8",children:[E==="dashboard"&&d.jsx(f3,{summaries:o?x:[],onNavigateToInventory:()=>o&&ve("inventory"),onRefreshData:a?()=>P(a):void 0}),E==="inventory"&&o&&d.jsx(S3,{summaries:x,items:ye,batches:p,onAddBatch:O,onDataRefresh:()=>a&&P(a)}),E==="catalog"&&o&&d.jsx(q3,{}),E==="batches"&&o&&d.jsx(B3,{}),E==="kiosk"&&o&&d.jsx(T3,{summaries:x,onPurchase:Z}),E==="marketplace"&&o&&d.jsx(C3,{summaries:x,user:a,onPurchase:ae}),E==="customer"&&c&&d.jsx(Dx,{name:a.companyName}),E==="supplier"&&f&&d.jsx(j3,{name:a.companyName}),E==="backend"&&d.jsx(A3,{}),!o&&["inventory","catalog","batches","kiosk","marketplace"].includes(E)&&d.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:d.jsx("p",{className:"text-red-400",children:"Access Denied: Shop role required"})}),!c&&E==="customer"&&d.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:d.jsx("p",{className:"text-red-400",children:"Access Denied: Customer role required"})}),!f&&E==="supplier"&&d.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:d.jsx("p",{className:"text-red-400",children:"Access Denied: Supplier role required"})})]}),d.jsx("footer",{className:"text-center p-4 mt-8 text-gray-500 text-sm",children:d.jsx("p",{children:"Built for the modern autonomous shop.  2024 Inventory AI"})}),d.jsx(s3,{toasts:n,onRemove:r})]})};console.log("[index.tsx] Starting app initialization...");const Dw=document.getElementById("root");if(!Dw)throw console.error("[index.tsx] Root element not found!"),new Error("Could not find root element to mount to");console.log("[index.tsx] Root element found, creating React root...");const G3=aE.createRoot(Dw);console.log("[index.tsx] Rendering App component...");G3.render(d.jsx(Mx.StrictMode,{children:d.jsx(V3,{})}));console.log("[index.tsx] App rendered successfully");
