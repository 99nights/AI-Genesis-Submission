function kS(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in t)){const o=Object.getOwnPropertyDescriptor(r,a);o&&Object.defineProperty(t,a,o.get?o:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function cf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function PS(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}),n}var ld={exports:{}},Ta={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K0;function US(){if(K0)return Ta;K0=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,a,o){var c=null;if(o!==void 0&&(c=""+o),a.key!==void 0&&(c=""+a.key),"key"in a){o={};for(var d in a)d!=="key"&&(o[d]=a[d])}else o=a;return a=o.ref,{$$typeof:t,type:r,key:c,ref:a!==void 0?a:null,props:o}}return Ta.Fragment=e,Ta.jsx=n,Ta.jsxs=n,Ta}var Q0;function jS(){return Q0||(Q0=1,ld.exports=US()),ld.exports}var f=jS(),cd={exports:{}},Ae={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X0;function OS(){if(X0)return Ae;X0=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),w=Symbol.iterator;function _(D){return D===null||typeof D!="object"?null:(D=w&&D[w]||D["@@iterator"],typeof D=="function"?D:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,M={};function P(D,J,ne){this.props=D,this.context=J,this.refs=M,this.updater=ne||E}P.prototype.isReactComponent={},P.prototype.setState=function(D,J){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,J,"setState")},P.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function k(){}k.prototype=P.prototype;function C(D,J,ne){this.props=D,this.context=J,this.refs=M,this.updater=ne||E}var I=C.prototype=new k;I.constructor=C,T(I,P.prototype),I.isPureReactComponent=!0;var j=Array.isArray;function B(){}var H={H:null,A:null,T:null,S:null},Q=Object.prototype.hasOwnProperty;function Z(D,J,ne){var $=ne.ref;return{$$typeof:t,type:D,key:J,ref:$!==void 0?$:null,props:ne}}function W(D,J){return Z(D.type,J,D.props)}function le(D){return typeof D=="object"&&D!==null&&D.$$typeof===t}function ue(D){var J={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(ne){return J[ne]})}var Re=/\/+/g;function Ne(D,J){return typeof D=="object"&&D!==null&&D.key!=null?ue(""+D.key):J.toString(36)}function Ie(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(B,B):(D.status="pending",D.then(function(J){D.status==="pending"&&(D.status="fulfilled",D.value=J)},function(J){D.status==="pending"&&(D.status="rejected",D.reason=J)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function R(D,J,ne,$,oe){var he=typeof D;(he==="undefined"||he==="boolean")&&(D=null);var ye=!1;if(D===null)ye=!0;else switch(he){case"bigint":case"string":case"number":ye=!0;break;case"object":switch(D.$$typeof){case t:case e:ye=!0;break;case x:return ye=D._init,R(ye(D._payload),J,ne,$,oe)}}if(ye)return oe=oe(D),ye=$===""?"."+Ne(D,0):$,j(oe)?(ne="",ye!=null&&(ne=ye.replace(Re,"$&/")+"/"),R(oe,J,ne,"",function(xe){return xe})):oe!=null&&(le(oe)&&(oe=W(oe,ne+(oe.key==null||D&&D.key===oe.key?"":(""+oe.key).replace(Re,"$&/")+"/")+ye)),J.push(oe)),1;ye=0;var V=$===""?".":$+":";if(j(D))for(var se=0;se<D.length;se++)$=D[se],he=V+Ne($,se),ye+=R($,J,ne,he,oe);else if(se=_(D),typeof se=="function")for(D=se.call(D),se=0;!($=D.next()).done;)$=$.value,he=V+Ne($,se++),ye+=R($,J,ne,he,oe);else if(he==="object"){if(typeof D.then=="function")return R(Ie(D),J,ne,$,oe);throw J=String(D),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return ye}function O(D,J,ne){if(D==null)return D;var $=[],oe=0;return R(D,$,"","",function(he){return J.call(ne,he,oe++)}),$}function Y(D){if(D._status===-1){var J=D._result;J=J(),J.then(function(ne){(D._status===0||D._status===-1)&&(D._status=1,D._result=ne)},function(ne){(D._status===0||D._status===-1)&&(D._status=2,D._result=ne)}),D._status===-1&&(D._status=0,D._result=J)}if(D._status===1)return D._result.default;throw D._result}var re=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)},ae={map:O,forEach:function(D,J,ne){O(D,function(){J.apply(this,arguments)},ne)},count:function(D){var J=0;return O(D,function(){J++}),J},toArray:function(D){return O(D,function(J){return J})||[]},only:function(D){if(!le(D))throw Error("React.Children.only expected to receive a single React element child.");return D}};return Ae.Activity=v,Ae.Children=ae,Ae.Component=P,Ae.Fragment=n,Ae.Profiler=a,Ae.PureComponent=C,Ae.StrictMode=r,Ae.Suspense=p,Ae.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,Ae.__COMPILER_RUNTIME={__proto__:null,c:function(D){return H.H.useMemoCache(D)}},Ae.cache=function(D){return function(){return D.apply(null,arguments)}},Ae.cacheSignal=function(){return null},Ae.cloneElement=function(D,J,ne){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var $=T({},D.props),oe=D.key;if(J!=null)for(he in J.key!==void 0&&(oe=""+J.key),J)!Q.call(J,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&J.ref===void 0||($[he]=J[he]);var he=arguments.length-2;if(he===1)$.children=ne;else if(1<he){for(var ye=Array(he),V=0;V<he;V++)ye[V]=arguments[V+2];$.children=ye}return Z(D.type,oe,$)},Ae.createContext=function(D){return D={$$typeof:c,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:o,_context:D},D},Ae.createElement=function(D,J,ne){var $,oe={},he=null;if(J!=null)for($ in J.key!==void 0&&(he=""+J.key),J)Q.call(J,$)&&$!=="key"&&$!=="__self"&&$!=="__source"&&(oe[$]=J[$]);var ye=arguments.length-2;if(ye===1)oe.children=ne;else if(1<ye){for(var V=Array(ye),se=0;se<ye;se++)V[se]=arguments[se+2];oe.children=V}if(D&&D.defaultProps)for($ in ye=D.defaultProps,ye)oe[$]===void 0&&(oe[$]=ye[$]);return Z(D,he,oe)},Ae.createRef=function(){return{current:null}},Ae.forwardRef=function(D){return{$$typeof:d,render:D}},Ae.isValidElement=le,Ae.lazy=function(D){return{$$typeof:x,_payload:{_status:-1,_result:D},_init:Y}},Ae.memo=function(D,J){return{$$typeof:h,type:D,compare:J===void 0?null:J}},Ae.startTransition=function(D){var J=H.T,ne={};H.T=ne;try{var $=D(),oe=H.S;oe!==null&&oe(ne,$),typeof $=="object"&&$!==null&&typeof $.then=="function"&&$.then(B,re)}catch(he){re(he)}finally{J!==null&&ne.types!==null&&(J.types=ne.types),H.T=J}},Ae.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},Ae.use=function(D){return H.H.use(D)},Ae.useActionState=function(D,J,ne){return H.H.useActionState(D,J,ne)},Ae.useCallback=function(D,J){return H.H.useCallback(D,J)},Ae.useContext=function(D){return H.H.useContext(D)},Ae.useDebugValue=function(){},Ae.useDeferredValue=function(D,J){return H.H.useDeferredValue(D,J)},Ae.useEffect=function(D,J){return H.H.useEffect(D,J)},Ae.useEffectEvent=function(D){return H.H.useEffectEvent(D)},Ae.useId=function(){return H.H.useId()},Ae.useImperativeHandle=function(D,J,ne){return H.H.useImperativeHandle(D,J,ne)},Ae.useInsertionEffect=function(D,J){return H.H.useInsertionEffect(D,J)},Ae.useLayoutEffect=function(D,J){return H.H.useLayoutEffect(D,J)},Ae.useMemo=function(D,J){return H.H.useMemo(D,J)},Ae.useOptimistic=function(D,J){return H.H.useOptimistic(D,J)},Ae.useReducer=function(D,J,ne){return H.H.useReducer(D,J,ne)},Ae.useRef=function(D){return H.H.useRef(D)},Ae.useState=function(D){return H.H.useState(D)},Ae.useSyncExternalStore=function(D,J,ne){return H.H.useSyncExternalStore(D,J,ne)},Ae.useTransition=function(){return H.H.useTransition()},Ae.version="19.2.0",Ae}var W0;function uf(){return W0||(W0=1,cd.exports=OS()),cd.exports}var A=uf();const wx=cf(A);var ud={exports:{}},Na={},dd={exports:{}},fd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z0;function LS(){return Z0||(Z0=1,(function(t){function e(R,O){var Y=R.length;R.push(O);e:for(;0<Y;){var re=Y-1>>>1,ae=R[re];if(0<a(ae,O))R[re]=O,R[Y]=ae,Y=re;else break e}}function n(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var O=R[0],Y=R.pop();if(Y!==O){R[0]=Y;e:for(var re=0,ae=R.length,D=ae>>>1;re<D;){var J=2*(re+1)-1,ne=R[J],$=J+1,oe=R[$];if(0>a(ne,Y))$<ae&&0>a(oe,ne)?(R[re]=oe,R[$]=Y,re=$):(R[re]=ne,R[J]=Y,re=J);else if($<ae&&0>a(oe,Y))R[re]=oe,R[$]=Y,re=$;else break e}}return O}function a(R,O){var Y=R.sortIndex-O.sortIndex;return Y!==0?Y:R.id-O.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,d=c.now();t.unstable_now=function(){return c.now()-d}}var p=[],h=[],x=1,v=null,w=3,_=!1,E=!1,T=!1,M=!1,P=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function I(R){for(var O=n(h);O!==null;){if(O.callback===null)r(h);else if(O.startTime<=R)r(h),O.sortIndex=O.expirationTime,e(p,O);else break;O=n(h)}}function j(R){if(T=!1,I(R),!E)if(n(p)!==null)E=!0,B||(B=!0,ue());else{var O=n(h);O!==null&&Ie(j,O.startTime-R)}}var B=!1,H=-1,Q=5,Z=-1;function W(){return M?!0:!(t.unstable_now()-Z<Q)}function le(){if(M=!1,B){var R=t.unstable_now();Z=R;var O=!0;try{e:{E=!1,T&&(T=!1,k(H),H=-1),_=!0;var Y=w;try{t:{for(I(R),v=n(p);v!==null&&!(v.expirationTime>R&&W());){var re=v.callback;if(typeof re=="function"){v.callback=null,w=v.priorityLevel;var ae=re(v.expirationTime<=R);if(R=t.unstable_now(),typeof ae=="function"){v.callback=ae,I(R),O=!0;break t}v===n(p)&&r(p),I(R)}else r(p);v=n(p)}if(v!==null)O=!0;else{var D=n(h);D!==null&&Ie(j,D.startTime-R),O=!1}}break e}finally{v=null,w=Y,_=!1}O=void 0}}finally{O?ue():B=!1}}}var ue;if(typeof C=="function")ue=function(){C(le)};else if(typeof MessageChannel<"u"){var Re=new MessageChannel,Ne=Re.port2;Re.port1.onmessage=le,ue=function(){Ne.postMessage(null)}}else ue=function(){P(le,0)};function Ie(R,O){H=P(function(){R(t.unstable_now())},O)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(R){R.callback=null},t.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<R?Math.floor(1e3/R):5},t.unstable_getCurrentPriorityLevel=function(){return w},t.unstable_next=function(R){switch(w){case 1:case 2:case 3:var O=3;break;default:O=w}var Y=w;w=O;try{return R()}finally{w=Y}},t.unstable_requestPaint=function(){M=!0},t.unstable_runWithPriority=function(R,O){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var Y=w;w=R;try{return O()}finally{w=Y}},t.unstable_scheduleCallback=function(R,O,Y){var re=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?re+Y:re):Y=re,R){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=Y+ae,R={id:x++,callback:O,priorityLevel:R,startTime:Y,expirationTime:ae,sortIndex:-1},Y>re?(R.sortIndex=Y,e(h,R),n(p)===null&&R===n(h)&&(T?(k(H),H=-1):T=!0,Ie(j,Y-re))):(R.sortIndex=ae,e(p,R),E||_||(E=!0,B||(B=!0,ue()))),R},t.unstable_shouldYield=W,t.unstable_wrapCallback=function(R){var O=w;return function(){var Y=w;w=O;try{return R.apply(this,arguments)}finally{w=Y}}}})(fd)),fd}var eg;function qS(){return eg||(eg=1,dd.exports=LS()),dd.exports}var hd={exports:{}},Pt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tg;function BS(){if(tg)return Pt;tg=1;var t=uf();function e(p){var h="https://react.dev/errors/"+p;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)h+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+p+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(p,h,x){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:p,containerInfo:h,implementation:x}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(p,h){if(p==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Pt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Pt.createPortal=function(p,h){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return o(p,h,null,x)},Pt.flushSync=function(p){var h=c.T,x=r.p;try{if(c.T=null,r.p=2,p)return p()}finally{c.T=h,r.p=x,r.d.f()}},Pt.preconnect=function(p,h){typeof p=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(p,h))},Pt.prefetchDNS=function(p){typeof p=="string"&&r.d.D(p)},Pt.preinit=function(p,h){if(typeof p=="string"&&h&&typeof h.as=="string"){var x=h.as,v=d(x,h.crossOrigin),w=typeof h.integrity=="string"?h.integrity:void 0,_=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;x==="style"?r.d.S(p,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:v,integrity:w,fetchPriority:_}):x==="script"&&r.d.X(p,{crossOrigin:v,integrity:w,fetchPriority:_,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Pt.preinitModule=function(p,h){if(typeof p=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var x=d(h.as,h.crossOrigin);r.d.M(p,{crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(p)},Pt.preload=function(p,h){if(typeof p=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var x=h.as,v=d(x,h.crossOrigin);r.d.L(p,x,{crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Pt.preloadModule=function(p,h){if(typeof p=="string")if(h){var x=d(h.as,h.crossOrigin);r.d.m(p,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(p)},Pt.requestFormReset=function(p){r.d.r(p)},Pt.unstable_batchedUpdates=function(p,h){return p(h)},Pt.useFormState=function(p,h,x){return c.H.useFormState(p,h,x)},Pt.useFormStatus=function(){return c.H.useHostTransitionStatus()},Pt.version="19.2.0",Pt}var ng;function VS(){if(ng)return hd.exports;ng=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),hd.exports=BS(),hd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sg;function HS(){if(sg)return Na;sg=1;var t=qS(),e=uf(),n=VS();function r(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function c(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function d(s){if(s.tag===31){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function p(s){if(o(s)!==s)throw Error(r(188))}function h(s){var i=s.alternate;if(!i){if(i=o(s),i===null)throw Error(r(188));return i!==s?null:s}for(var l=s,u=i;;){var y=l.return;if(y===null)break;var b=y.alternate;if(b===null){if(u=y.return,u!==null){l=u;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===l)return p(y),s;if(b===u)return p(y),i;b=b.sibling}throw Error(r(188))}if(l.return!==u.return)l=y,u=b;else{for(var S=!1,N=y.child;N;){if(N===l){S=!0,l=y,u=b;break}if(N===u){S=!0,u=y,l=b;break}N=N.sibling}if(!S){for(N=b.child;N;){if(N===l){S=!0,l=b,u=y;break}if(N===u){S=!0,u=b,l=y;break}N=N.sibling}if(!S)throw Error(r(189))}}if(l.alternate!==u)throw Error(r(190))}if(l.tag!==3)throw Error(r(188));return l.stateNode.current===l?s:i}function x(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=x(s),i!==null)return i;s=s.sibling}return null}var v=Object.assign,w=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),C=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),Z=Symbol.for("react.activity"),W=Symbol.for("react.memo_cache_sentinel"),le=Symbol.iterator;function ue(s){return s===null||typeof s!="object"?null:(s=le&&s[le]||s["@@iterator"],typeof s=="function"?s:null)}var Re=Symbol.for("react.client.reference");function Ne(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Re?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case T:return"Fragment";case P:return"Profiler";case M:return"StrictMode";case j:return"Suspense";case B:return"SuspenseList";case Z:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case E:return"Portal";case C:return s.displayName||"Context";case k:return(s._context.displayName||"Context")+".Consumer";case I:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case H:return i=s.displayName||null,i!==null?i:Ne(s.type)||"Memo";case Q:i=s._payload,s=s._init;try{return Ne(s(i))}catch{}}return null}var Ie=Array.isArray,R=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},re=[],ae=-1;function D(s){return{current:s}}function J(s){0>ae||(s.current=re[ae],re[ae]=null,ae--)}function ne(s,i){ae++,re[ae]=s.current,s.current=i}var $=D(null),oe=D(null),he=D(null),ye=D(null);function V(s,i){switch(ne(he,i),ne(oe,s),ne($,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?x0(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=x0(i),s=v0(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}J($),ne($,s)}function se(){J($),J(oe),J(he)}function xe(s){s.memoizedState!==null&&ne(ye,s);var i=$.current,l=v0(i,s.type);i!==l&&(ne(oe,s),ne($,l))}function rt(s){oe.current===s&&(J($),J(oe)),ye.current===s&&(J(ye),wa._currentValue=Y)}var ot,$e;function ze(s){if(ot===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);ot=i&&i[1]||"",$e=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ot+s+$e}var ht=!1;function Tt(s,i){if(!s||ht)return"";ht=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(i){var te=function(){throw Error()};if(Object.defineProperty(te.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(te,[])}catch(K){var F=K}Reflect.construct(s,[],te)}else{try{te.call()}catch(K){F=K}s.call(te.prototype)}}else{try{throw Error()}catch(K){F=K}(te=s())&&typeof te.catch=="function"&&te.catch(function(){})}}catch(K){if(K&&F&&typeof K.stack=="string")return[K.stack,F.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=u.DetermineComponentFrameRoot(),S=b[0],N=b[1];if(S&&N){var U=S.split(`
`),z=N.split(`
`);for(y=u=0;u<U.length&&!U[u].includes("DetermineComponentFrameRoot");)u++;for(;y<z.length&&!z[y].includes("DetermineComponentFrameRoot");)y++;if(u===U.length||y===z.length)for(u=U.length-1,y=z.length-1;1<=u&&0<=y&&U[u]!==z[y];)y--;for(;1<=u&&0<=y;u--,y--)if(U[u]!==z[y]){if(u!==1||y!==1)do if(u--,y--,0>y||U[u]!==z[y]){var X=`
`+U[u].replace(" at new "," at ");return s.displayName&&X.includes("<anonymous>")&&(X=X.replace("<anonymous>",s.displayName)),X}while(1<=u&&0<=y);break}}}finally{ht=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?ze(l):""}function fs(s,i){switch(s.tag){case 26:case 27:case 5:return ze(s.type);case 16:return ze("Lazy");case 13:return s.child!==i&&i!==null?ze("Suspense Fallback"):ze("Suspense");case 19:return ze("SuspenseList");case 0:case 15:return Tt(s.type,!1);case 11:return Tt(s.type.render,!1);case 1:return Tt(s.type,!0);case 31:return ze("Activity");default:return""}}function Bn(s){try{var i="",l=null;do i+=fs(s,l),l=s,s=s.return;while(s);return i}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var ln=Object.prototype.hasOwnProperty,ie=t.unstable_scheduleCallback,ce=t.unstable_cancelCallback,Ee=t.unstable_shouldYield,Be=t.unstable_requestPaint,pt=t.unstable_now,ke=t.unstable_getCurrentPriorityLevel,kt=t.unstable_ImmediatePriority,Pn=t.unstable_UserBlockingPriority,_r=t.unstable_NormalPriority,Kl=t.unstable_LowPriority,Wf=t.unstable_IdlePriority,mw=t.log,gw=t.unstable_setDisableYieldValue,ki=null,Yt=null;function hs(s){if(typeof mw=="function"&&gw(s),Yt&&typeof Yt.setStrictMode=="function")try{Yt.setStrictMode(ki,s)}catch{}}var Kt=Math.clz32?Math.clz32:vw,yw=Math.log,xw=Math.LN2;function vw(s){return s>>>=0,s===0?32:31-(yw(s)/xw|0)|0}var Ga=256,za=262144,Fa=4194304;function Fs(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function $a(s,i,l){var u=s.pendingLanes;if(u===0)return 0;var y=0,b=s.suspendedLanes,S=s.pingedLanes;s=s.warmLanes;var N=u&134217727;return N!==0?(u=N&~b,u!==0?y=Fs(u):(S&=N,S!==0?y=Fs(S):l||(l=N&~s,l!==0&&(y=Fs(l))))):(N=u&~b,N!==0?y=Fs(N):S!==0?y=Fs(S):l||(l=u&~s,l!==0&&(y=Fs(l)))),y===0?0:i!==0&&i!==y&&(i&b)===0&&(b=y&-y,l=i&-i,b>=l||b===32&&(l&4194048)!==0)?i:y}function Pi(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function bw(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zf(){var s=Fa;return Fa<<=1,(Fa&62914560)===0&&(Fa=4194304),s}function Ql(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function Ui(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ww(s,i,l,u,y,b){var S=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var N=s.entanglements,U=s.expirationTimes,z=s.hiddenUpdates;for(l=S&~l;0<l;){var X=31-Kt(l),te=1<<X;N[X]=0,U[X]=-1;var F=z[X];if(F!==null)for(z[X]=null,X=0;X<F.length;X++){var K=F[X];K!==null&&(K.lane&=-536870913)}l&=~te}u!==0&&eh(s,u,0),b!==0&&y===0&&s.tag!==0&&(s.suspendedLanes|=b&~(S&~i))}function eh(s,i,l){s.pendingLanes|=i,s.suspendedLanes&=~i;var u=31-Kt(i);s.entangledLanes|=i,s.entanglements[u]=s.entanglements[u]|1073741824|l&261930}function th(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var u=31-Kt(l),y=1<<u;y&i|s[u]&i&&(s[u]|=i),l&=~y}}function nh(s,i){var l=i&-i;return l=(l&42)!==0?1:Xl(l),(l&(s.suspendedLanes|i))!==0?0:l}function Xl(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Wl(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function sh(){var s=O.p;return s!==0?s:(s=window.event,s===void 0?32:H0(s.type))}function rh(s,i){var l=O.p;try{return O.p=s,i()}finally{O.p=l}}var ps=Math.random().toString(36).slice(2),Nt="__reactFiber$"+ps,Vt="__reactProps$"+ps,Sr="__reactContainer$"+ps,Zl="__reactEvents$"+ps,_w="__reactListeners$"+ps,Sw="__reactHandles$"+ps,ih="__reactResources$"+ps,ji="__reactMarker$"+ps;function ec(s){delete s[Nt],delete s[Vt],delete s[Zl],delete s[_w],delete s[Sw]}function Er(s){var i=s[Nt];if(i)return i;for(var l=s.parentNode;l;){if(i=l[Sr]||l[Nt]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=N0(s);s!==null;){if(l=s[Nt])return l;s=N0(s)}return i}s=l,l=s.parentNode}return null}function Tr(s){if(s=s[Nt]||s[Sr]){var i=s.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return s}return null}function Oi(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(r(33))}function Nr(s){var i=s[ih];return i||(i=s[ih]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function _t(s){s[ji]=!0}var ah=new Set,oh={};function $s(s,i){Cr(s,i),Cr(s+"Capture",i)}function Cr(s,i){for(oh[s]=i,s=0;s<i.length;s++)ah.add(i[s])}var Ew=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),lh={},ch={};function Tw(s){return ln.call(ch,s)?!0:ln.call(lh,s)?!1:Ew.test(s)?ch[s]=!0:(lh[s]=!0,!1)}function Ja(s,i,l){if(Tw(i))if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var u=i.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+l)}}function Ya(s,i,l){if(l===null)s.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+l)}}function Vn(s,i,l,u){if(u===null)s.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(i,l,""+u)}}function cn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function uh(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Nw(s,i,l){var u=Object.getOwnPropertyDescriptor(s.constructor.prototype,i);if(!s.hasOwnProperty(i)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var y=u.get,b=u.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return y.call(this)},set:function(S){l=""+S,b.call(this,S)}}),Object.defineProperty(s,i,{enumerable:u.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function tc(s){if(!s._valueTracker){var i=uh(s)?"checked":"value";s._valueTracker=Nw(s,i,""+s[i])}}function dh(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),u="";return s&&(u=uh(s)?s.checked?"true":"false":s.value),s=u,s!==l?(i.setValue(s),!0):!1}function Ka(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Cw=/[\n"\\]/g;function un(s){return s.replace(Cw,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function nc(s,i,l,u,y,b,S,N){s.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?s.type=S:s.removeAttribute("type"),i!=null?S==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+cn(i)):s.value!==""+cn(i)&&(s.value=""+cn(i)):S!=="submit"&&S!=="reset"||s.removeAttribute("value"),i!=null?sc(s,S,cn(i)):l!=null?sc(s,S,cn(l)):u!=null&&s.removeAttribute("value"),y==null&&b!=null&&(s.defaultChecked=!!b),y!=null&&(s.checked=y&&typeof y!="function"&&typeof y!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?s.name=""+cn(N):s.removeAttribute("name")}function fh(s,i,l,u,y,b,S,N){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.type=b),i!=null||l!=null){if(!(b!=="submit"&&b!=="reset"||i!=null)){tc(s);return}l=l!=null?""+cn(l):"",i=i!=null?""+cn(i):l,N||i===s.value||(s.value=i),s.defaultValue=i}u=u??y,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=N?s.checked:!!u,s.defaultChecked=!!u,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(s.name=S),tc(s)}function sc(s,i,l){i==="number"&&Ka(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function Ar(s,i,l,u){if(s=s.options,i){i={};for(var y=0;y<l.length;y++)i["$"+l[y]]=!0;for(l=0;l<s.length;l++)y=i.hasOwnProperty("$"+s[l].value),s[l].selected!==y&&(s[l].selected=y),y&&u&&(s[l].defaultSelected=!0)}else{for(l=""+cn(l),i=null,y=0;y<s.length;y++){if(s[y].value===l){s[y].selected=!0,u&&(s[y].defaultSelected=!0);return}i!==null||s[y].disabled||(i=s[y])}i!==null&&(i.selected=!0)}}function hh(s,i,l){if(i!=null&&(i=""+cn(i),i!==s.value&&(s.value=i),l==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=l!=null?""+cn(l):""}function ph(s,i,l,u){if(i==null){if(u!=null){if(l!=null)throw Error(r(92));if(Ie(u)){if(1<u.length)throw Error(r(93));u=u[0]}l=u}l==null&&(l=""),i=l}l=cn(i),s.defaultValue=l,u=s.textContent,u===l&&u!==""&&u!==null&&(s.value=u),tc(s)}function Ir(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var Aw=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function mh(s,i,l){var u=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":u?s.setProperty(i,l):typeof l!="number"||l===0||Aw.has(i)?i==="float"?s.cssFloat=l:s[i]=(""+l).trim():s[i]=l+"px"}function gh(s,i,l){if(i!=null&&typeof i!="object")throw Error(r(62));if(s=s.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||i!=null&&i.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var y in i)u=i[y],i.hasOwnProperty(y)&&l[y]!==u&&mh(s,y,u)}else for(var b in i)i.hasOwnProperty(b)&&mh(s,b,i[b])}function rc(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Iw=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rw=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qa(s){return Rw.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Hn(){}var ic=null;function ac(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Rr=null,Dr=null;function yh(s){var i=Tr(s);if(i&&(s=i.stateNode)){var l=s[Vt]||null;e:switch(s=i.stateNode,i.type){case"input":if(nc(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+un(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var u=l[i];if(u!==s&&u.form===s.form){var y=u[Vt]||null;if(!y)throw Error(r(90));nc(u,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(i=0;i<l.length;i++)u=l[i],u.form===s.form&&dh(u)}break e;case"textarea":hh(s,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&Ar(s,!!l.multiple,i,!1)}}}var oc=!1;function xh(s,i,l){if(oc)return s(i,l);oc=!0;try{var u=s(i);return u}finally{if(oc=!1,(Rr!==null||Dr!==null)&&(Lo(),Rr&&(i=Rr,s=Dr,Dr=Rr=null,yh(i),s)))for(i=0;i<s.length;i++)yh(s[i])}}function Li(s,i){var l=s.stateNode;if(l===null)return null;var u=l[Vt]||null;if(u===null)return null;l=u[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(r(231,i,typeof l));return l}var Gn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lc=!1;if(Gn)try{var qi={};Object.defineProperty(qi,"passive",{get:function(){lc=!0}}),window.addEventListener("test",qi,qi),window.removeEventListener("test",qi,qi)}catch{lc=!1}var ms=null,cc=null,Xa=null;function vh(){if(Xa)return Xa;var s,i=cc,l=i.length,u,y="value"in ms?ms.value:ms.textContent,b=y.length;for(s=0;s<l&&i[s]===y[s];s++);var S=l-s;for(u=1;u<=S&&i[l-u]===y[b-u];u++);return Xa=y.slice(s,1<u?1-u:void 0)}function Wa(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function Za(){return!0}function bh(){return!1}function Ht(s){function i(l,u,y,b,S){this._reactName=l,this._targetInst=y,this.type=u,this.nativeEvent=b,this.target=S,this.currentTarget=null;for(var N in s)s.hasOwnProperty(N)&&(l=s[N],this[N]=l?l(b):b[N]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Za:bh,this.isPropagationStopped=bh,this}return v(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Za)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Za)},persist:function(){},isPersistent:Za}),i}var Js={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},eo=Ht(Js),Bi=v({},Js,{view:0,detail:0}),Dw=Ht(Bi),uc,dc,Vi,to=v({},Bi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Vi&&(Vi&&s.type==="mousemove"?(uc=s.screenX-Vi.screenX,dc=s.screenY-Vi.screenY):dc=uc=0,Vi=s),uc)},movementY:function(s){return"movementY"in s?s.movementY:dc}}),wh=Ht(to),Mw=v({},to,{dataTransfer:0}),kw=Ht(Mw),Pw=v({},Bi,{relatedTarget:0}),fc=Ht(Pw),Uw=v({},Js,{animationName:0,elapsedTime:0,pseudoElement:0}),jw=Ht(Uw),Ow=v({},Js,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Lw=Ht(Ow),qw=v({},Js,{data:0}),_h=Ht(qw),Bw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gw(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=Hw[s])?!!i[s]:!1}function hc(){return Gw}var zw=v({},Bi,{key:function(s){if(s.key){var i=Bw[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=Wa(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Vw[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hc,charCode:function(s){return s.type==="keypress"?Wa(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Wa(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Fw=Ht(zw),$w=v({},to,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sh=Ht($w),Jw=v({},Bi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hc}),Yw=Ht(Jw),Kw=v({},Js,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qw=Ht(Kw),Xw=v({},to,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Ww=Ht(Xw),Zw=v({},Js,{newState:0,oldState:0}),e_=Ht(Zw),t_=[9,13,27,32],pc=Gn&&"CompositionEvent"in window,Hi=null;Gn&&"documentMode"in document&&(Hi=document.documentMode);var n_=Gn&&"TextEvent"in window&&!Hi,Eh=Gn&&(!pc||Hi&&8<Hi&&11>=Hi),Th=" ",Nh=!1;function Ch(s,i){switch(s){case"keyup":return t_.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ah(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Mr=!1;function s_(s,i){switch(s){case"compositionend":return Ah(i);case"keypress":return i.which!==32?null:(Nh=!0,Th);case"textInput":return s=i.data,s===Th&&Nh?null:s;default:return null}}function r_(s,i){if(Mr)return s==="compositionend"||!pc&&Ch(s,i)?(s=vh(),Xa=cc=ms=null,Mr=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Eh&&i.locale!=="ko"?null:i.data;default:return null}}var i_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ih(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!i_[s.type]:i==="textarea"}function Rh(s,i,l,u){Rr?Dr?Dr.push(u):Dr=[u]:Rr=u,i=Fo(i,"onChange"),0<i.length&&(l=new eo("onChange","change",null,l,u),s.push({event:l,listeners:i}))}var Gi=null,zi=null;function a_(s){f0(s,0)}function no(s){var i=Oi(s);if(dh(i))return s}function Dh(s,i){if(s==="change")return i}var Mh=!1;if(Gn){var mc;if(Gn){var gc="oninput"in document;if(!gc){var kh=document.createElement("div");kh.setAttribute("oninput","return;"),gc=typeof kh.oninput=="function"}mc=gc}else mc=!1;Mh=mc&&(!document.documentMode||9<document.documentMode)}function Ph(){Gi&&(Gi.detachEvent("onpropertychange",Uh),zi=Gi=null)}function Uh(s){if(s.propertyName==="value"&&no(zi)){var i=[];Rh(i,zi,s,ac(s)),xh(a_,i)}}function o_(s,i,l){s==="focusin"?(Ph(),Gi=i,zi=l,Gi.attachEvent("onpropertychange",Uh)):s==="focusout"&&Ph()}function l_(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return no(zi)}function c_(s,i){if(s==="click")return no(i)}function u_(s,i){if(s==="input"||s==="change")return no(i)}function d_(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var Qt=typeof Object.is=="function"?Object.is:d_;function Fi(s,i){if(Qt(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),u=Object.keys(i);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var y=l[u];if(!ln.call(i,y)||!Qt(s[y],i[y]))return!1}return!0}function jh(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Oh(s,i){var l=jh(s);s=0;for(var u;l;){if(l.nodeType===3){if(u=s+l.textContent.length,s<=i&&u>=i)return{node:l,offset:i-s};s=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=jh(l)}}function Lh(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?Lh(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function qh(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=Ka(s.document);i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=Ka(s.document)}return i}function yc(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var f_=Gn&&"documentMode"in document&&11>=document.documentMode,kr=null,xc=null,$i=null,vc=!1;function Bh(s,i,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;vc||kr==null||kr!==Ka(u)||(u=kr,"selectionStart"in u&&yc(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),$i&&Fi($i,u)||($i=u,u=Fo(xc,"onSelect"),0<u.length&&(i=new eo("onSelect","select",null,i,l),s.push({event:i,listeners:u}),i.target=kr)))}function Ys(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var Pr={animationend:Ys("Animation","AnimationEnd"),animationiteration:Ys("Animation","AnimationIteration"),animationstart:Ys("Animation","AnimationStart"),transitionrun:Ys("Transition","TransitionRun"),transitionstart:Ys("Transition","TransitionStart"),transitioncancel:Ys("Transition","TransitionCancel"),transitionend:Ys("Transition","TransitionEnd")},bc={},Vh={};Gn&&(Vh=document.createElement("div").style,"AnimationEvent"in window||(delete Pr.animationend.animation,delete Pr.animationiteration.animation,delete Pr.animationstart.animation),"TransitionEvent"in window||delete Pr.transitionend.transition);function Ks(s){if(bc[s])return bc[s];if(!Pr[s])return s;var i=Pr[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in Vh)return bc[s]=i[l];return s}var Hh=Ks("animationend"),Gh=Ks("animationiteration"),zh=Ks("animationstart"),h_=Ks("transitionrun"),p_=Ks("transitionstart"),m_=Ks("transitioncancel"),Fh=Ks("transitionend"),$h=new Map,wc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");wc.push("scrollEnd");function _n(s,i){$h.set(s,i),$s(i,[s])}var so=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},dn=[],Ur=0,_c=0;function ro(){for(var s=Ur,i=_c=Ur=0;i<s;){var l=dn[i];dn[i++]=null;var u=dn[i];dn[i++]=null;var y=dn[i];dn[i++]=null;var b=dn[i];if(dn[i++]=null,u!==null&&y!==null){var S=u.pending;S===null?y.next=y:(y.next=S.next,S.next=y),u.pending=y}b!==0&&Jh(l,y,b)}}function io(s,i,l,u){dn[Ur++]=s,dn[Ur++]=i,dn[Ur++]=l,dn[Ur++]=u,_c|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function Sc(s,i,l,u){return io(s,i,l,u),ao(s)}function Qs(s,i){return io(s,null,null,i),ao(s)}function Jh(s,i,l){s.lanes|=l;var u=s.alternate;u!==null&&(u.lanes|=l);for(var y=!1,b=s.return;b!==null;)b.childLanes|=l,u=b.alternate,u!==null&&(u.childLanes|=l),b.tag===22&&(s=b.stateNode,s===null||s._visibility&1||(y=!0)),s=b,b=b.return;return s.tag===3?(b=s.stateNode,y&&i!==null&&(y=31-Kt(l),s=b.hiddenUpdates,u=s[y],u===null?s[y]=[i]:u.push(i),i.lane=l|536870912),b):null}function ao(s){if(50<pa)throw pa=0,Mu=null,Error(r(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var jr={};function g_(s,i,l,u){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xt(s,i,l,u){return new g_(s,i,l,u)}function Ec(s){return s=s.prototype,!(!s||!s.isReactComponent)}function zn(s,i){var l=s.alternate;return l===null?(l=Xt(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function Yh(s,i){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,i=l.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function oo(s,i,l,u,y,b){var S=0;if(u=s,typeof s=="function")Ec(s)&&(S=1);else if(typeof s=="string")S=wS(s,l,$.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case Z:return s=Xt(31,l,i,y),s.elementType=Z,s.lanes=b,s;case T:return Xs(l.children,y,b,i);case M:S=8,y|=24;break;case P:return s=Xt(12,l,i,y|2),s.elementType=P,s.lanes=b,s;case j:return s=Xt(13,l,i,y),s.elementType=j,s.lanes=b,s;case B:return s=Xt(19,l,i,y),s.elementType=B,s.lanes=b,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case C:S=10;break e;case k:S=9;break e;case I:S=11;break e;case H:S=14;break e;case Q:S=16,u=null;break e}S=29,l=Error(r(130,s===null?"null":typeof s,"")),u=null}return i=Xt(S,l,i,y),i.elementType=s,i.type=u,i.lanes=b,i}function Xs(s,i,l,u){return s=Xt(7,s,u,i),s.lanes=l,s}function Tc(s,i,l){return s=Xt(6,s,null,i),s.lanes=l,s}function Kh(s){var i=Xt(18,null,null,0);return i.stateNode=s,i}function Nc(s,i,l){return i=Xt(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var Qh=new WeakMap;function fn(s,i){if(typeof s=="object"&&s!==null){var l=Qh.get(s);return l!==void 0?l:(i={value:s,source:i,stack:Bn(i)},Qh.set(s,i),i)}return{value:s,source:i,stack:Bn(i)}}var Or=[],Lr=0,lo=null,Ji=0,hn=[],pn=0,gs=null,Un=1,jn="";function Fn(s,i){Or[Lr++]=Ji,Or[Lr++]=lo,lo=s,Ji=i}function Xh(s,i,l){hn[pn++]=Un,hn[pn++]=jn,hn[pn++]=gs,gs=s;var u=Un;s=jn;var y=32-Kt(u)-1;u&=~(1<<y),l+=1;var b=32-Kt(i)+y;if(30<b){var S=y-y%5;b=(u&(1<<S)-1).toString(32),u>>=S,y-=S,Un=1<<32-Kt(i)+y|l<<y|u,jn=b+s}else Un=1<<b|l<<y|u,jn=s}function Cc(s){s.return!==null&&(Fn(s,1),Xh(s,1,0))}function Ac(s){for(;s===lo;)lo=Or[--Lr],Or[Lr]=null,Ji=Or[--Lr],Or[Lr]=null;for(;s===gs;)gs=hn[--pn],hn[pn]=null,jn=hn[--pn],hn[pn]=null,Un=hn[--pn],hn[pn]=null}function Wh(s,i){hn[pn++]=Un,hn[pn++]=jn,hn[pn++]=gs,Un=i.id,jn=i.overflow,gs=s}var Ct=null,tt=null,qe=!1,ys=null,mn=!1,Ic=Error(r(519));function xs(s){var i=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Yi(fn(i,s)),Ic}function Zh(s){var i=s.stateNode,l=s.type,u=s.memoizedProps;switch(i[Nt]=s,i[Vt]=u,l){case"dialog":Ue("cancel",i),Ue("close",i);break;case"iframe":case"object":case"embed":Ue("load",i);break;case"video":case"audio":for(l=0;l<ga.length;l++)Ue(ga[l],i);break;case"source":Ue("error",i);break;case"img":case"image":case"link":Ue("error",i),Ue("load",i);break;case"details":Ue("toggle",i);break;case"input":Ue("invalid",i),fh(i,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":Ue("invalid",i);break;case"textarea":Ue("invalid",i),ph(i,u.value,u.defaultValue,u.children)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||u.suppressHydrationWarning===!0||g0(i.textContent,l)?(u.popover!=null&&(Ue("beforetoggle",i),Ue("toggle",i)),u.onScroll!=null&&Ue("scroll",i),u.onScrollEnd!=null&&Ue("scrollend",i),u.onClick!=null&&(i.onclick=Hn),i=!0):i=!1,i||xs(s,!0)}function ep(s){for(Ct=s.return;Ct;)switch(Ct.tag){case 5:case 31:case 13:mn=!1;return;case 27:case 3:mn=!0;return;default:Ct=Ct.return}}function qr(s){if(s!==Ct)return!1;if(!qe)return ep(s),qe=!0,!1;var i=s.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||Ju(s.type,s.memoizedProps)),l=!l),l&&tt&&xs(s),ep(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));tt=T0(s)}else if(i===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));tt=T0(s)}else i===27?(i=tt,Ms(s.type)?(s=Wu,Wu=null,tt=s):tt=i):tt=Ct?yn(s.stateNode.nextSibling):null;return!0}function Ws(){tt=Ct=null,qe=!1}function Rc(){var s=ys;return s!==null&&($t===null?$t=s:$t.push.apply($t,s),ys=null),s}function Yi(s){ys===null?ys=[s]:ys.push(s)}var Dc=D(null),Zs=null,$n=null;function vs(s,i,l){ne(Dc,i._currentValue),i._currentValue=l}function Jn(s){s._currentValue=Dc.current,J(Dc)}function Mc(s,i,l){for(;s!==null;){var u=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,u!==null&&(u.childLanes|=i)):u!==null&&(u.childLanes&i)!==i&&(u.childLanes|=i),s===l)break;s=s.return}}function kc(s,i,l,u){var y=s.child;for(y!==null&&(y.return=s);y!==null;){var b=y.dependencies;if(b!==null){var S=y.child;b=b.firstContext;e:for(;b!==null;){var N=b;b=y;for(var U=0;U<i.length;U++)if(N.context===i[U]){b.lanes|=l,N=b.alternate,N!==null&&(N.lanes|=l),Mc(b.return,l,s),u||(S=null);break e}b=N.next}}else if(y.tag===18){if(S=y.return,S===null)throw Error(r(341));S.lanes|=l,b=S.alternate,b!==null&&(b.lanes|=l),Mc(S,l,s),S=null}else S=y.child;if(S!==null)S.return=y;else for(S=y;S!==null;){if(S===s){S=null;break}if(y=S.sibling,y!==null){y.return=S.return,S=y;break}S=S.return}y=S}}function Br(s,i,l,u){s=null;for(var y=i,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var S=y.alternate;if(S===null)throw Error(r(387));if(S=S.memoizedProps,S!==null){var N=y.type;Qt(y.pendingProps.value,S.value)||(s!==null?s.push(N):s=[N])}}else if(y===ye.current){if(S=y.alternate,S===null)throw Error(r(387));S.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(s!==null?s.push(wa):s=[wa])}y=y.return}s!==null&&kc(i,s,l,u),i.flags|=262144}function co(s){for(s=s.firstContext;s!==null;){if(!Qt(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function er(s){Zs=s,$n=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function At(s){return tp(Zs,s)}function uo(s,i){return Zs===null&&er(s),tp(s,i)}function tp(s,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},$n===null){if(s===null)throw Error(r(308));$n=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else $n=$n.next=i;return l}var y_=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(l,u){s.push(u)}};this.abort=function(){i.aborted=!0,s.forEach(function(l){return l()})}},x_=t.unstable_scheduleCallback,v_=t.unstable_NormalPriority,mt={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pc(){return{controller:new y_,data:new Map,refCount:0}}function Ki(s){s.refCount--,s.refCount===0&&x_(v_,function(){s.controller.abort()})}var Qi=null,Uc=0,Vr=0,Hr=null;function b_(s,i){if(Qi===null){var l=Qi=[];Uc=0,Vr=Lu(),Hr={status:"pending",value:void 0,then:function(u){l.push(u)}}}return Uc++,i.then(np,np),i}function np(){if(--Uc===0&&Qi!==null){Hr!==null&&(Hr.status="fulfilled");var s=Qi;Qi=null,Vr=0,Hr=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function w_(s,i){var l=[],u={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return s.then(function(){u.status="fulfilled",u.value=i;for(var y=0;y<l.length;y++)(0,l[y])(i)},function(y){for(u.status="rejected",u.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),u}var sp=R.S;R.S=function(s,i){Bm=pt(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&b_(s,i),sp!==null&&sp(s,i)};var tr=D(null);function jc(){var s=tr.current;return s!==null?s:Ze.pooledCache}function fo(s,i){i===null?ne(tr,tr.current):ne(tr,i.pool)}function rp(){var s=jc();return s===null?null:{parent:mt._currentValue,pool:s}}var Gr=Error(r(460)),Oc=Error(r(474)),ho=Error(r(542)),po={then:function(){}};function ip(s){return s=s.status,s==="fulfilled"||s==="rejected"}function ap(s,i,l){switch(l=s[l],l===void 0?s.push(i):l!==i&&(i.then(Hn,Hn),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,lp(s),s;default:if(typeof i.status=="string")i.then(Hn,Hn);else{if(s=Ze,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=i,s.status="pending",s.then(function(u){if(i.status==="pending"){var y=i;y.status="fulfilled",y.value=u}},function(u){if(i.status==="pending"){var y=i;y.status="rejected",y.reason=u}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,lp(s),s}throw sr=i,Gr}}function nr(s){try{var i=s._init;return i(s._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(sr=l,Gr):l}}var sr=null;function op(){if(sr===null)throw Error(r(459));var s=sr;return sr=null,s}function lp(s){if(s===Gr||s===ho)throw Error(r(483))}var zr=null,Xi=0;function mo(s){var i=Xi;return Xi+=1,zr===null&&(zr=[]),ap(zr,s,i)}function Wi(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function go(s,i){throw i.$$typeof===w?Error(r(525)):(s=Object.prototype.toString.call(i),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function cp(s){function i(q,L){if(s){var G=q.deletions;G===null?(q.deletions=[L],q.flags|=16):G.push(L)}}function l(q,L){if(!s)return null;for(;L!==null;)i(q,L),L=L.sibling;return null}function u(q){for(var L=new Map;q!==null;)q.key!==null?L.set(q.key,q):L.set(q.index,q),q=q.sibling;return L}function y(q,L){return q=zn(q,L),q.index=0,q.sibling=null,q}function b(q,L,G){return q.index=G,s?(G=q.alternate,G!==null?(G=G.index,G<L?(q.flags|=67108866,L):G):(q.flags|=67108866,L)):(q.flags|=1048576,L)}function S(q){return s&&q.alternate===null&&(q.flags|=67108866),q}function N(q,L,G,ee){return L===null||L.tag!==6?(L=Tc(G,q.mode,ee),L.return=q,L):(L=y(L,G),L.return=q,L)}function U(q,L,G,ee){var _e=G.type;return _e===T?X(q,L,G.props.children,ee,G.key):L!==null&&(L.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===Q&&nr(_e)===L.type)?(L=y(L,G.props),Wi(L,G),L.return=q,L):(L=oo(G.type,G.key,G.props,null,q.mode,ee),Wi(L,G),L.return=q,L)}function z(q,L,G,ee){return L===null||L.tag!==4||L.stateNode.containerInfo!==G.containerInfo||L.stateNode.implementation!==G.implementation?(L=Nc(G,q.mode,ee),L.return=q,L):(L=y(L,G.children||[]),L.return=q,L)}function X(q,L,G,ee,_e){return L===null||L.tag!==7?(L=Xs(G,q.mode,ee,_e),L.return=q,L):(L=y(L,G),L.return=q,L)}function te(q,L,G){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return L=Tc(""+L,q.mode,G),L.return=q,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case _:return G=oo(L.type,L.key,L.props,null,q.mode,G),Wi(G,L),G.return=q,G;case E:return L=Nc(L,q.mode,G),L.return=q,L;case Q:return L=nr(L),te(q,L,G)}if(Ie(L)||ue(L))return L=Xs(L,q.mode,G,null),L.return=q,L;if(typeof L.then=="function")return te(q,mo(L),G);if(L.$$typeof===C)return te(q,uo(q,L),G);go(q,L)}return null}function F(q,L,G,ee){var _e=L!==null?L.key:null;if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return _e!==null?null:N(q,L,""+G,ee);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case _:return G.key===_e?U(q,L,G,ee):null;case E:return G.key===_e?z(q,L,G,ee):null;case Q:return G=nr(G),F(q,L,G,ee)}if(Ie(G)||ue(G))return _e!==null?null:X(q,L,G,ee,null);if(typeof G.then=="function")return F(q,L,mo(G),ee);if(G.$$typeof===C)return F(q,L,uo(q,G),ee);go(q,G)}return null}function K(q,L,G,ee,_e){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return q=q.get(G)||null,N(L,q,""+ee,_e);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case _:return q=q.get(ee.key===null?G:ee.key)||null,U(L,q,ee,_e);case E:return q=q.get(ee.key===null?G:ee.key)||null,z(L,q,ee,_e);case Q:return ee=nr(ee),K(q,L,G,ee,_e)}if(Ie(ee)||ue(ee))return q=q.get(G)||null,X(L,q,ee,_e,null);if(typeof ee.then=="function")return K(q,L,G,mo(ee),_e);if(ee.$$typeof===C)return K(q,L,G,uo(L,ee),_e);go(L,ee)}return null}function me(q,L,G,ee){for(var _e=null,Ve=null,ge=L,Me=L=0,Oe=null;ge!==null&&Me<G.length;Me++){ge.index>Me?(Oe=ge,ge=null):Oe=ge.sibling;var He=F(q,ge,G[Me],ee);if(He===null){ge===null&&(ge=Oe);break}s&&ge&&He.alternate===null&&i(q,ge),L=b(He,L,Me),Ve===null?_e=He:Ve.sibling=He,Ve=He,ge=Oe}if(Me===G.length)return l(q,ge),qe&&Fn(q,Me),_e;if(ge===null){for(;Me<G.length;Me++)ge=te(q,G[Me],ee),ge!==null&&(L=b(ge,L,Me),Ve===null?_e=ge:Ve.sibling=ge,Ve=ge);return qe&&Fn(q,Me),_e}for(ge=u(ge);Me<G.length;Me++)Oe=K(ge,q,Me,G[Me],ee),Oe!==null&&(s&&Oe.alternate!==null&&ge.delete(Oe.key===null?Me:Oe.key),L=b(Oe,L,Me),Ve===null?_e=Oe:Ve.sibling=Oe,Ve=Oe);return s&&ge.forEach(function(Os){return i(q,Os)}),qe&&Fn(q,Me),_e}function Se(q,L,G,ee){if(G==null)throw Error(r(151));for(var _e=null,Ve=null,ge=L,Me=L=0,Oe=null,He=G.next();ge!==null&&!He.done;Me++,He=G.next()){ge.index>Me?(Oe=ge,ge=null):Oe=ge.sibling;var Os=F(q,ge,He.value,ee);if(Os===null){ge===null&&(ge=Oe);break}s&&ge&&Os.alternate===null&&i(q,ge),L=b(Os,L,Me),Ve===null?_e=Os:Ve.sibling=Os,Ve=Os,ge=Oe}if(He.done)return l(q,ge),qe&&Fn(q,Me),_e;if(ge===null){for(;!He.done;Me++,He=G.next())He=te(q,He.value,ee),He!==null&&(L=b(He,L,Me),Ve===null?_e=He:Ve.sibling=He,Ve=He);return qe&&Fn(q,Me),_e}for(ge=u(ge);!He.done;Me++,He=G.next())He=K(ge,q,Me,He.value,ee),He!==null&&(s&&He.alternate!==null&&ge.delete(He.key===null?Me:He.key),L=b(He,L,Me),Ve===null?_e=He:Ve.sibling=He,Ve=He);return s&&ge.forEach(function(MS){return i(q,MS)}),qe&&Fn(q,Me),_e}function Xe(q,L,G,ee){if(typeof G=="object"&&G!==null&&G.type===T&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case _:e:{for(var _e=G.key;L!==null;){if(L.key===_e){if(_e=G.type,_e===T){if(L.tag===7){l(q,L.sibling),ee=y(L,G.props.children),ee.return=q,q=ee;break e}}else if(L.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===Q&&nr(_e)===L.type){l(q,L.sibling),ee=y(L,G.props),Wi(ee,G),ee.return=q,q=ee;break e}l(q,L);break}else i(q,L);L=L.sibling}G.type===T?(ee=Xs(G.props.children,q.mode,ee,G.key),ee.return=q,q=ee):(ee=oo(G.type,G.key,G.props,null,q.mode,ee),Wi(ee,G),ee.return=q,q=ee)}return S(q);case E:e:{for(_e=G.key;L!==null;){if(L.key===_e)if(L.tag===4&&L.stateNode.containerInfo===G.containerInfo&&L.stateNode.implementation===G.implementation){l(q,L.sibling),ee=y(L,G.children||[]),ee.return=q,q=ee;break e}else{l(q,L);break}else i(q,L);L=L.sibling}ee=Nc(G,q.mode,ee),ee.return=q,q=ee}return S(q);case Q:return G=nr(G),Xe(q,L,G,ee)}if(Ie(G))return me(q,L,G,ee);if(ue(G)){if(_e=ue(G),typeof _e!="function")throw Error(r(150));return G=_e.call(G),Se(q,L,G,ee)}if(typeof G.then=="function")return Xe(q,L,mo(G),ee);if(G.$$typeof===C)return Xe(q,L,uo(q,G),ee);go(q,G)}return typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint"?(G=""+G,L!==null&&L.tag===6?(l(q,L.sibling),ee=y(L,G),ee.return=q,q=ee):(l(q,L),ee=Tc(G,q.mode,ee),ee.return=q,q=ee),S(q)):l(q,L)}return function(q,L,G,ee){try{Xi=0;var _e=Xe(q,L,G,ee);return zr=null,_e}catch(ge){if(ge===Gr||ge===ho)throw ge;var Ve=Xt(29,ge,null,q.mode);return Ve.lanes=ee,Ve.return=q,Ve}finally{}}}var rr=cp(!0),up=cp(!1),bs=!1;function Lc(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function qc(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function ws(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function _s(s,i,l){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,(Fe&2)!==0){var y=u.pending;return y===null?i.next=i:(i.next=y.next,y.next=i),u.pending=i,i=ao(s),Jh(s,null,l),i}return io(s,u,i,l),ao(s)}function Zi(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var u=i.lanes;u&=s.pendingLanes,l|=u,i.lanes=l,th(s,l)}}function Bc(s,i){var l=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var y=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var S={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};b===null?y=b=S:b=b.next=S,l=l.next}while(l!==null);b===null?y=b=i:b=b.next=i}else y=b=i;l={baseState:u.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:u.shared,callbacks:u.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}var Vc=!1;function ea(){if(Vc){var s=Hr;if(s!==null)throw s}}function ta(s,i,l,u){Vc=!1;var y=s.updateQueue;bs=!1;var b=y.firstBaseUpdate,S=y.lastBaseUpdate,N=y.shared.pending;if(N!==null){y.shared.pending=null;var U=N,z=U.next;U.next=null,S===null?b=z:S.next=z,S=U;var X=s.alternate;X!==null&&(X=X.updateQueue,N=X.lastBaseUpdate,N!==S&&(N===null?X.firstBaseUpdate=z:N.next=z,X.lastBaseUpdate=U))}if(b!==null){var te=y.baseState;S=0,X=z=U=null,N=b;do{var F=N.lane&-536870913,K=F!==N.lane;if(K?(je&F)===F:(u&F)===F){F!==0&&F===Vr&&(Vc=!0),X!==null&&(X=X.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var me=s,Se=N;F=i;var Xe=l;switch(Se.tag){case 1:if(me=Se.payload,typeof me=="function"){te=me.call(Xe,te,F);break e}te=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=Se.payload,F=typeof me=="function"?me.call(Xe,te,F):me,F==null)break e;te=v({},te,F);break e;case 2:bs=!0}}F=N.callback,F!==null&&(s.flags|=64,K&&(s.flags|=8192),K=y.callbacks,K===null?y.callbacks=[F]:K.push(F))}else K={lane:F,tag:N.tag,payload:N.payload,callback:N.callback,next:null},X===null?(z=X=K,U=te):X=X.next=K,S|=F;if(N=N.next,N===null){if(N=y.shared.pending,N===null)break;K=N,N=K.next,K.next=null,y.lastBaseUpdate=K,y.shared.pending=null}}while(!0);X===null&&(U=te),y.baseState=U,y.firstBaseUpdate=z,y.lastBaseUpdate=X,b===null&&(y.shared.lanes=0),Cs|=S,s.lanes=S,s.memoizedState=te}}function dp(s,i){if(typeof s!="function")throw Error(r(191,s));s.call(i)}function fp(s,i){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)dp(l[s],i)}var Fr=D(null),yo=D(0);function hp(s,i){s=ns,ne(yo,s),ne(Fr,i),ns=s|i.baseLanes}function Hc(){ne(yo,ns),ne(Fr,Fr.current)}function Gc(){ns=yo.current,J(Fr),J(yo)}var Wt=D(null),gn=null;function Ss(s){var i=s.alternate;ne(ut,ut.current&1),ne(Wt,s),gn===null&&(i===null||Fr.current!==null||i.memoizedState!==null)&&(gn=s)}function zc(s){ne(ut,ut.current),ne(Wt,s),gn===null&&(gn=s)}function pp(s){s.tag===22?(ne(ut,ut.current),ne(Wt,s),gn===null&&(gn=s)):Es()}function Es(){ne(ut,ut.current),ne(Wt,Wt.current)}function Zt(s){J(Wt),gn===s&&(gn=null),J(ut)}var ut=D(0);function xo(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||Qu(l)||Xu(l)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Yn=0,De=null,Ke=null,gt=null,vo=!1,$r=!1,ir=!1,bo=0,na=0,Jr=null,__=0;function lt(){throw Error(r(321))}function Fc(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!Qt(s[l],i[l]))return!1;return!0}function $c(s,i,l,u,y,b){return Yn=b,De=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,R.H=s===null||s.memoizedState===null?Xp:ou,ir=!1,b=l(u,y),ir=!1,$r&&(b=gp(i,l,u,y)),mp(s),b}function mp(s){R.H=ia;var i=Ke!==null&&Ke.next!==null;if(Yn=0,gt=Ke=De=null,vo=!1,na=0,Jr=null,i)throw Error(r(300));s===null||yt||(s=s.dependencies,s!==null&&co(s)&&(yt=!0))}function gp(s,i,l,u){De=s;var y=0;do{if($r&&(Jr=null),na=0,$r=!1,25<=y)throw Error(r(301));if(y+=1,gt=Ke=null,s.updateQueue!=null){var b=s.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}R.H=Wp,b=i(l,u)}while($r);return b}function S_(){var s=R.H,i=s.useState()[0];return i=typeof i.then=="function"?sa(i):i,s=s.useState()[0],(Ke!==null?Ke.memoizedState:null)!==s&&(De.flags|=1024),i}function Jc(){var s=bo!==0;return bo=0,s}function Yc(s,i,l){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~l}function Kc(s){if(vo){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}vo=!1}Yn=0,gt=Ke=De=null,$r=!1,na=bo=0,Jr=null}function Ot(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?De.memoizedState=gt=s:gt=gt.next=s,gt}function dt(){if(Ke===null){var s=De.alternate;s=s!==null?s.memoizedState:null}else s=Ke.next;var i=gt===null?De.memoizedState:gt.next;if(i!==null)gt=i,Ke=s;else{if(s===null)throw De.alternate===null?Error(r(467)):Error(r(310));Ke=s,s={memoizedState:Ke.memoizedState,baseState:Ke.baseState,baseQueue:Ke.baseQueue,queue:Ke.queue,next:null},gt===null?De.memoizedState=gt=s:gt=gt.next=s}return gt}function wo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function sa(s){var i=na;return na+=1,Jr===null&&(Jr=[]),s=ap(Jr,s,i),i=De,(gt===null?i.memoizedState:gt.next)===null&&(i=i.alternate,R.H=i===null||i.memoizedState===null?Xp:ou),s}function _o(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return sa(s);if(s.$$typeof===C)return At(s)}throw Error(r(438,String(s)))}function Qc(s){var i=null,l=De.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var u=De.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(i={data:u.data.map(function(y){return y.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=wo(),De.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(s),u=0;u<s;u++)l[u]=W;return i.index++,l}function Kn(s,i){return typeof i=="function"?i(s):i}function So(s){var i=dt();return Xc(i,Ke,s)}function Xc(s,i,l){var u=s.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=l;var y=s.baseQueue,b=u.pending;if(b!==null){if(y!==null){var S=y.next;y.next=b.next,b.next=S}i.baseQueue=y=b,u.pending=null}if(b=s.baseState,y===null)s.memoizedState=b;else{i=y.next;var N=S=null,U=null,z=i,X=!1;do{var te=z.lane&-536870913;if(te!==z.lane?(je&te)===te:(Yn&te)===te){var F=z.revertLane;if(F===0)U!==null&&(U=U.next={lane:0,revertLane:0,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),te===Vr&&(X=!0);else if((Yn&F)===F){z=z.next,F===Vr&&(X=!0);continue}else te={lane:0,revertLane:z.revertLane,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},U===null?(N=U=te,S=b):U=U.next=te,De.lanes|=F,Cs|=F;te=z.action,ir&&l(b,te),b=z.hasEagerState?z.eagerState:l(b,te)}else F={lane:te,revertLane:z.revertLane,gesture:z.gesture,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},U===null?(N=U=F,S=b):U=U.next=F,De.lanes|=te,Cs|=te;z=z.next}while(z!==null&&z!==i);if(U===null?S=b:U.next=N,!Qt(b,s.memoizedState)&&(yt=!0,X&&(l=Hr,l!==null)))throw l;s.memoizedState=b,s.baseState=S,s.baseQueue=U,u.lastRenderedState=b}return y===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function Wc(s){var i=dt(),l=i.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=s;var u=l.dispatch,y=l.pending,b=i.memoizedState;if(y!==null){l.pending=null;var S=y=y.next;do b=s(b,S.action),S=S.next;while(S!==y);Qt(b,i.memoizedState)||(yt=!0),i.memoizedState=b,i.baseQueue===null&&(i.baseState=b),l.lastRenderedState=b}return[b,u]}function yp(s,i,l){var u=De,y=dt(),b=qe;if(b){if(l===void 0)throw Error(r(407));l=l()}else l=i();var S=!Qt((Ke||y).memoizedState,l);if(S&&(y.memoizedState=l,yt=!0),y=y.queue,tu(bp.bind(null,u,y,s),[s]),y.getSnapshot!==i||S||gt!==null&&gt.memoizedState.tag&1){if(u.flags|=2048,Yr(9,{destroy:void 0},vp.bind(null,u,y,l,i),null),Ze===null)throw Error(r(349));b||(Yn&127)!==0||xp(u,i,l)}return l}function xp(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=De.updateQueue,i===null?(i=wo(),De.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function vp(s,i,l,u){i.value=l,i.getSnapshot=u,wp(i)&&_p(s)}function bp(s,i,l){return l(function(){wp(i)&&_p(s)})}function wp(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!Qt(s,l)}catch{return!0}}function _p(s){var i=Qs(s,2);i!==null&&Jt(i,s,2)}function Zc(s){var i=Ot();if(typeof s=="function"){var l=s;if(s=l(),ir){hs(!0);try{l()}finally{hs(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kn,lastRenderedState:s},i}function Sp(s,i,l,u){return s.baseState=l,Xc(s,Ke,typeof u=="function"?u:Kn)}function E_(s,i,l,u,y){if(No(s))throw Error(r(485));if(s=i.action,s!==null){var b={payload:y,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){b.listeners.push(S)}};R.T!==null?l(!0):b.isTransition=!1,u(b),l=i.pending,l===null?(b.next=i.pending=b,Ep(i,b)):(b.next=l.next,i.pending=l.next=b)}}function Ep(s,i){var l=i.action,u=i.payload,y=s.state;if(i.isTransition){var b=R.T,S={};R.T=S;try{var N=l(y,u),U=R.S;U!==null&&U(S,N),Tp(s,i,N)}catch(z){eu(s,i,z)}finally{b!==null&&S.types!==null&&(b.types=S.types),R.T=b}}else try{b=l(y,u),Tp(s,i,b)}catch(z){eu(s,i,z)}}function Tp(s,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){Np(s,i,u)},function(u){return eu(s,i,u)}):Np(s,i,l)}function Np(s,i,l){i.status="fulfilled",i.value=l,Cp(i),s.state=l,i=s.pending,i!==null&&(l=i.next,l===i?s.pending=null:(l=l.next,i.next=l,Ep(s,l)))}function eu(s,i,l){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do i.status="rejected",i.reason=l,Cp(i),i=i.next;while(i!==u)}s.action=null}function Cp(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function Ap(s,i){return i}function Ip(s,i){if(qe){var l=Ze.formState;if(l!==null){e:{var u=De;if(qe){if(tt){t:{for(var y=tt,b=mn;y.nodeType!==8;){if(!b){y=null;break t}if(y=yn(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){tt=yn(y.nextSibling),u=y.data==="F!";break e}}xs(u)}u=!1}u&&(i=l[0])}}return l=Ot(),l.memoizedState=l.baseState=i,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ap,lastRenderedState:i},l.queue=u,l=Yp.bind(null,De,u),u.dispatch=l,u=Zc(!1),b=au.bind(null,De,!1,u.queue),u=Ot(),y={state:i,dispatch:null,action:s,pending:null},u.queue=y,l=E_.bind(null,De,y,b,l),y.dispatch=l,u.memoizedState=s,[i,l,!1]}function Rp(s){var i=dt();return Dp(i,Ke,s)}function Dp(s,i,l){if(i=Xc(s,i,Ap)[0],s=So(Kn)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var u=sa(i)}catch(S){throw S===Gr?ho:S}else u=i;i=dt();var y=i.queue,b=y.dispatch;return l!==i.memoizedState&&(De.flags|=2048,Yr(9,{destroy:void 0},T_.bind(null,y,l),null)),[u,b,s]}function T_(s,i){s.action=i}function Mp(s){var i=dt(),l=Ke;if(l!==null)return Dp(i,l,s);dt(),i=i.memoizedState,l=dt();var u=l.queue.dispatch;return l.memoizedState=s,[i,u,!1]}function Yr(s,i,l,u){return s={tag:s,create:l,deps:u,inst:i,next:null},i=De.updateQueue,i===null&&(i=wo(),De.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=s.next=s:(u=l.next,l.next=s,s.next=u,i.lastEffect=s),s}function kp(){return dt().memoizedState}function Eo(s,i,l,u){var y=Ot();De.flags|=s,y.memoizedState=Yr(1|i,{destroy:void 0},l,u===void 0?null:u)}function To(s,i,l,u){var y=dt();u=u===void 0?null:u;var b=y.memoizedState.inst;Ke!==null&&u!==null&&Fc(u,Ke.memoizedState.deps)?y.memoizedState=Yr(i,b,l,u):(De.flags|=s,y.memoizedState=Yr(1|i,b,l,u))}function Pp(s,i){Eo(8390656,8,s,i)}function tu(s,i){To(2048,8,s,i)}function N_(s){De.flags|=4;var i=De.updateQueue;if(i===null)i=wo(),De.updateQueue=i,i.events=[s];else{var l=i.events;l===null?i.events=[s]:l.push(s)}}function Up(s){var i=dt().memoizedState;return N_({ref:i,nextImpl:s}),function(){if((Fe&2)!==0)throw Error(r(440));return i.impl.apply(void 0,arguments)}}function jp(s,i){return To(4,2,s,i)}function Op(s,i){return To(4,4,s,i)}function Lp(s,i){if(typeof i=="function"){s=s();var l=i(s);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function qp(s,i,l){l=l!=null?l.concat([s]):null,To(4,4,Lp.bind(null,i,s),l)}function nu(){}function Bp(s,i){var l=dt();i=i===void 0?null:i;var u=l.memoizedState;return i!==null&&Fc(i,u[1])?u[0]:(l.memoizedState=[s,i],s)}function Vp(s,i){var l=dt();i=i===void 0?null:i;var u=l.memoizedState;if(i!==null&&Fc(i,u[1]))return u[0];if(u=s(),ir){hs(!0);try{s()}finally{hs(!1)}}return l.memoizedState=[u,i],u}function su(s,i,l){return l===void 0||(Yn&1073741824)!==0&&(je&261930)===0?s.memoizedState=i:(s.memoizedState=l,s=Hm(),De.lanes|=s,Cs|=s,l)}function Hp(s,i,l,u){return Qt(l,i)?l:Fr.current!==null?(s=su(s,l,u),Qt(s,i)||(yt=!0),s):(Yn&42)===0||(Yn&1073741824)!==0&&(je&261930)===0?(yt=!0,s.memoizedState=l):(s=Hm(),De.lanes|=s,Cs|=s,i)}function Gp(s,i,l,u,y){var b=O.p;O.p=b!==0&&8>b?b:8;var S=R.T,N={};R.T=N,au(s,!1,i,l);try{var U=y(),z=R.S;if(z!==null&&z(N,U),U!==null&&typeof U=="object"&&typeof U.then=="function"){var X=w_(U,u);ra(s,i,X,nn(s))}else ra(s,i,u,nn(s))}catch(te){ra(s,i,{then:function(){},status:"rejected",reason:te},nn())}finally{O.p=b,S!==null&&N.types!==null&&(S.types=N.types),R.T=S}}function C_(){}function ru(s,i,l,u){if(s.tag!==5)throw Error(r(476));var y=zp(s).queue;Gp(s,y,i,Y,l===null?C_:function(){return Fp(s),l(u)})}function zp(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kn,lastRenderedState:Y},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Kn,lastRenderedState:l},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function Fp(s){var i=zp(s);i.next===null&&(i=s.alternate.memoizedState),ra(s,i.next.queue,{},nn())}function iu(){return At(wa)}function $p(){return dt().memoizedState}function Jp(){return dt().memoizedState}function A_(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var l=nn();s=ws(l);var u=_s(i,s,l);u!==null&&(Jt(u,i,l),Zi(u,i,l)),i={cache:Pc()},s.payload=i;return}i=i.return}}function I_(s,i,l){var u=nn();l={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},No(s)?Kp(i,l):(l=Sc(s,i,l,u),l!==null&&(Jt(l,s,u),Qp(l,i,u)))}function Yp(s,i,l){var u=nn();ra(s,i,l,u)}function ra(s,i,l,u){var y={lane:u,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(No(s))Kp(i,y);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=i.lastRenderedReducer,b!==null))try{var S=i.lastRenderedState,N=b(S,l);if(y.hasEagerState=!0,y.eagerState=N,Qt(N,S))return io(s,i,y,0),Ze===null&&ro(),!1}catch{}finally{}if(l=Sc(s,i,y,u),l!==null)return Jt(l,s,u),Qp(l,i,u),!0}return!1}function au(s,i,l,u){if(u={lane:2,revertLane:Lu(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},No(s)){if(i)throw Error(r(479))}else i=Sc(s,l,u,2),i!==null&&Jt(i,s,2)}function No(s){var i=s.alternate;return s===De||i!==null&&i===De}function Kp(s,i){$r=vo=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function Qp(s,i,l){if((l&4194048)!==0){var u=i.lanes;u&=s.pendingLanes,l|=u,i.lanes=l,th(s,l)}}var ia={readContext:At,use:_o,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useLayoutEffect:lt,useInsertionEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useSyncExternalStore:lt,useId:lt,useHostTransitionStatus:lt,useFormState:lt,useActionState:lt,useOptimistic:lt,useMemoCache:lt,useCacheRefresh:lt};ia.useEffectEvent=lt;var Xp={readContext:At,use:_o,useCallback:function(s,i){return Ot().memoizedState=[s,i===void 0?null:i],s},useContext:At,useEffect:Pp,useImperativeHandle:function(s,i,l){l=l!=null?l.concat([s]):null,Eo(4194308,4,Lp.bind(null,i,s),l)},useLayoutEffect:function(s,i){return Eo(4194308,4,s,i)},useInsertionEffect:function(s,i){Eo(4,2,s,i)},useMemo:function(s,i){var l=Ot();i=i===void 0?null:i;var u=s();if(ir){hs(!0);try{s()}finally{hs(!1)}}return l.memoizedState=[u,i],u},useReducer:function(s,i,l){var u=Ot();if(l!==void 0){var y=l(i);if(ir){hs(!0);try{l(i)}finally{hs(!1)}}}else y=i;return u.memoizedState=u.baseState=y,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:y},u.queue=s,s=s.dispatch=I_.bind(null,De,s),[u.memoizedState,s]},useRef:function(s){var i=Ot();return s={current:s},i.memoizedState=s},useState:function(s){s=Zc(s);var i=s.queue,l=Yp.bind(null,De,i);return i.dispatch=l,[s.memoizedState,l]},useDebugValue:nu,useDeferredValue:function(s,i){var l=Ot();return su(l,s,i)},useTransition:function(){var s=Zc(!1);return s=Gp.bind(null,De,s.queue,!0,!1),Ot().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,l){var u=De,y=Ot();if(qe){if(l===void 0)throw Error(r(407));l=l()}else{if(l=i(),Ze===null)throw Error(r(349));(je&127)!==0||xp(u,i,l)}y.memoizedState=l;var b={value:l,getSnapshot:i};return y.queue=b,Pp(bp.bind(null,u,b,s),[s]),u.flags|=2048,Yr(9,{destroy:void 0},vp.bind(null,u,b,l,i),null),l},useId:function(){var s=Ot(),i=Ze.identifierPrefix;if(qe){var l=jn,u=Un;l=(u&~(1<<32-Kt(u)-1)).toString(32)+l,i="_"+i+"R_"+l,l=bo++,0<l&&(i+="H"+l.toString(32)),i+="_"}else l=__++,i="_"+i+"r_"+l.toString(32)+"_";return s.memoizedState=i},useHostTransitionStatus:iu,useFormState:Ip,useActionState:Ip,useOptimistic:function(s){var i=Ot();i.memoizedState=i.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=au.bind(null,De,!0,l),l.dispatch=i,[s,i]},useMemoCache:Qc,useCacheRefresh:function(){return Ot().memoizedState=A_.bind(null,De)},useEffectEvent:function(s){var i=Ot(),l={impl:s};return i.memoizedState=l,function(){if((Fe&2)!==0)throw Error(r(440));return l.impl.apply(void 0,arguments)}}},ou={readContext:At,use:_o,useCallback:Bp,useContext:At,useEffect:tu,useImperativeHandle:qp,useInsertionEffect:jp,useLayoutEffect:Op,useMemo:Vp,useReducer:So,useRef:kp,useState:function(){return So(Kn)},useDebugValue:nu,useDeferredValue:function(s,i){var l=dt();return Hp(l,Ke.memoizedState,s,i)},useTransition:function(){var s=So(Kn)[0],i=dt().memoizedState;return[typeof s=="boolean"?s:sa(s),i]},useSyncExternalStore:yp,useId:$p,useHostTransitionStatus:iu,useFormState:Rp,useActionState:Rp,useOptimistic:function(s,i){var l=dt();return Sp(l,Ke,s,i)},useMemoCache:Qc,useCacheRefresh:Jp};ou.useEffectEvent=Up;var Wp={readContext:At,use:_o,useCallback:Bp,useContext:At,useEffect:tu,useImperativeHandle:qp,useInsertionEffect:jp,useLayoutEffect:Op,useMemo:Vp,useReducer:Wc,useRef:kp,useState:function(){return Wc(Kn)},useDebugValue:nu,useDeferredValue:function(s,i){var l=dt();return Ke===null?su(l,s,i):Hp(l,Ke.memoizedState,s,i)},useTransition:function(){var s=Wc(Kn)[0],i=dt().memoizedState;return[typeof s=="boolean"?s:sa(s),i]},useSyncExternalStore:yp,useId:$p,useHostTransitionStatus:iu,useFormState:Mp,useActionState:Mp,useOptimistic:function(s,i){var l=dt();return Ke!==null?Sp(l,Ke,s,i):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:Qc,useCacheRefresh:Jp};Wp.useEffectEvent=Up;function lu(s,i,l,u){i=s.memoizedState,l=l(u,i),l=l==null?i:v({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var cu={enqueueSetState:function(s,i,l){s=s._reactInternals;var u=nn(),y=ws(u);y.payload=i,l!=null&&(y.callback=l),i=_s(s,y,u),i!==null&&(Jt(i,s,u),Zi(i,s,u))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var u=nn(),y=ws(u);y.tag=1,y.payload=i,l!=null&&(y.callback=l),i=_s(s,y,u),i!==null&&(Jt(i,s,u),Zi(i,s,u))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=nn(),u=ws(l);u.tag=2,i!=null&&(u.callback=i),i=_s(s,u,l),i!==null&&(Jt(i,s,l),Zi(i,s,l))}};function Zp(s,i,l,u,y,b,S){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,b,S):i.prototype&&i.prototype.isPureReactComponent?!Fi(l,u)||!Fi(y,b):!0}function em(s,i,l,u){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,u),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,u),i.state!==s&&cu.enqueueReplaceState(i,i.state,null)}function ar(s,i){var l=i;if("ref"in i){l={};for(var u in i)u!=="ref"&&(l[u]=i[u])}if(s=s.defaultProps){l===i&&(l=v({},l));for(var y in s)l[y]===void 0&&(l[y]=s[y])}return l}function tm(s){so(s)}function nm(s){console.error(s)}function sm(s){so(s)}function Co(s,i){try{var l=s.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(u){setTimeout(function(){throw u})}}function rm(s,i,l){try{var u=s.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function uu(s,i,l){return l=ws(l),l.tag=3,l.payload={element:null},l.callback=function(){Co(s,i)},l}function im(s){return s=ws(s),s.tag=3,s}function am(s,i,l,u){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var b=u.value;s.payload=function(){return y(b)},s.callback=function(){rm(i,l,u)}}var S=l.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(s.callback=function(){rm(i,l,u),typeof y!="function"&&(As===null?As=new Set([this]):As.add(this));var N=u.stack;this.componentDidCatch(u.value,{componentStack:N!==null?N:""})})}function R_(s,i,l,u,y){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(i=l.alternate,i!==null&&Br(i,l,y,!0),l=Wt.current,l!==null){switch(l.tag){case 31:case 13:return gn===null?qo():l.alternate===null&&ct===0&&(ct=3),l.flags&=-257,l.flags|=65536,l.lanes=y,u===po?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([u]):i.add(u),Uu(s,u,y)),!1;case 22:return l.flags|=65536,u===po?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([u]):l.add(u)),Uu(s,u,y)),!1}throw Error(r(435,l.tag))}return Uu(s,u,y),qo(),!1}if(qe)return i=Wt.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=y,u!==Ic&&(s=Error(r(422),{cause:u}),Yi(fn(s,l)))):(u!==Ic&&(i=Error(r(423),{cause:u}),Yi(fn(i,l))),s=s.current.alternate,s.flags|=65536,y&=-y,s.lanes|=y,u=fn(u,l),y=uu(s.stateNode,u,y),Bc(s,y),ct!==4&&(ct=2)),!1;var b=Error(r(520),{cause:u});if(b=fn(b,l),ha===null?ha=[b]:ha.push(b),ct!==4&&(ct=2),i===null)return!0;u=fn(u,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,s=y&-y,l.lanes|=s,s=uu(l.stateNode,u,s),Bc(l,s),!1;case 1:if(i=l.type,b=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(As===null||!As.has(b))))return l.flags|=65536,y&=-y,l.lanes|=y,y=im(y),am(y,s,l,u),Bc(l,y),!1}l=l.return}while(l!==null);return!1}var du=Error(r(461)),yt=!1;function It(s,i,l,u){i.child=s===null?up(i,null,l,u):rr(i,s.child,l,u)}function om(s,i,l,u,y){l=l.render;var b=i.ref;if("ref"in u){var S={};for(var N in u)N!=="ref"&&(S[N]=u[N])}else S=u;return er(i),u=$c(s,i,l,S,b,y),N=Jc(),s!==null&&!yt?(Yc(s,i,y),Qn(s,i,y)):(qe&&N&&Cc(i),i.flags|=1,It(s,i,u,y),i.child)}function lm(s,i,l,u,y){if(s===null){var b=l.type;return typeof b=="function"&&!Ec(b)&&b.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=b,cm(s,i,b,u,y)):(s=oo(l.type,null,u,i,i.mode,y),s.ref=i.ref,s.return=i,i.child=s)}if(b=s.child,!vu(s,y)){var S=b.memoizedProps;if(l=l.compare,l=l!==null?l:Fi,l(S,u)&&s.ref===i.ref)return Qn(s,i,y)}return i.flags|=1,s=zn(b,u),s.ref=i.ref,s.return=i,i.child=s}function cm(s,i,l,u,y){if(s!==null){var b=s.memoizedProps;if(Fi(b,u)&&s.ref===i.ref)if(yt=!1,i.pendingProps=u=b,vu(s,y))(s.flags&131072)!==0&&(yt=!0);else return i.lanes=s.lanes,Qn(s,i,y)}return fu(s,i,l,u,y)}function um(s,i,l,u){var y=u.children,b=s!==null?s.memoizedState:null;if(s===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((i.flags&128)!==0){if(b=b!==null?b.baseLanes|l:l,s!==null){for(u=i.child=s.child,y=0;u!==null;)y=y|u.lanes|u.childLanes,u=u.sibling;u=y&~b}else u=0,i.child=null;return dm(s,i,b,l,u)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&fo(i,b!==null?b.cachePool:null),b!==null?hp(i,b):Hc(),pp(i);else return u=i.lanes=536870912,dm(s,i,b!==null?b.baseLanes|l:l,l,u)}else b!==null?(fo(i,b.cachePool),hp(i,b),Es(),i.memoizedState=null):(s!==null&&fo(i,null),Hc(),Es());return It(s,i,y,l),i.child}function aa(s,i){return s!==null&&s.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function dm(s,i,l,u,y){var b=jc();return b=b===null?null:{parent:mt._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},s!==null&&fo(i,null),Hc(),pp(i),s!==null&&Br(s,i,u,!0),i.childLanes=y,null}function Ao(s,i){return i=Ro({mode:i.mode,children:i.children},s.mode),i.ref=s.ref,s.child=i,i.return=s,i}function fm(s,i,l){return rr(i,s.child,null,l),s=Ao(i,i.pendingProps),s.flags|=2,Zt(i),i.memoizedState=null,s}function D_(s,i,l){var u=i.pendingProps,y=(i.flags&128)!==0;if(i.flags&=-129,s===null){if(qe){if(u.mode==="hidden")return s=Ao(i,u),i.lanes=536870912,aa(null,s);if(zc(i),(s=tt)?(s=E0(s,mn),s=s!==null&&s.data==="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:gs!==null?{id:Un,overflow:jn}:null,retryLane:536870912,hydrationErrors:null},l=Kh(s),l.return=i,i.child=l,Ct=i,tt=null)):s=null,s===null)throw xs(i);return i.lanes=536870912,null}return Ao(i,u)}var b=s.memoizedState;if(b!==null){var S=b.dehydrated;if(zc(i),y)if(i.flags&256)i.flags&=-257,i=fm(s,i,l);else if(i.memoizedState!==null)i.child=s.child,i.flags|=128,i=null;else throw Error(r(558));else if(yt||Br(s,i,l,!1),y=(l&s.childLanes)!==0,yt||y){if(u=Ze,u!==null&&(S=nh(u,l),S!==0&&S!==b.retryLane))throw b.retryLane=S,Qs(s,S),Jt(u,s,S),du;qo(),i=fm(s,i,l)}else s=b.treeContext,tt=yn(S.nextSibling),Ct=i,qe=!0,ys=null,mn=!1,s!==null&&Wh(i,s),i=Ao(i,u),i.flags|=4096;return i}return s=zn(s.child,{mode:u.mode,children:u.children}),s.ref=i.ref,i.child=s,s.return=i,s}function Io(s,i){var l=i.ref;if(l===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(r(284));(s===null||s.ref!==l)&&(i.flags|=4194816)}}function fu(s,i,l,u,y){return er(i),l=$c(s,i,l,u,void 0,y),u=Jc(),s!==null&&!yt?(Yc(s,i,y),Qn(s,i,y)):(qe&&u&&Cc(i),i.flags|=1,It(s,i,l,y),i.child)}function hm(s,i,l,u,y,b){return er(i),i.updateQueue=null,l=gp(i,u,l,y),mp(s),u=Jc(),s!==null&&!yt?(Yc(s,i,b),Qn(s,i,b)):(qe&&u&&Cc(i),i.flags|=1,It(s,i,l,b),i.child)}function pm(s,i,l,u,y){if(er(i),i.stateNode===null){var b=jr,S=l.contextType;typeof S=="object"&&S!==null&&(b=At(S)),b=new l(u,b),i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=cu,i.stateNode=b,b._reactInternals=i,b=i.stateNode,b.props=u,b.state=i.memoizedState,b.refs={},Lc(i),S=l.contextType,b.context=typeof S=="object"&&S!==null?At(S):jr,b.state=i.memoizedState,S=l.getDerivedStateFromProps,typeof S=="function"&&(lu(i,l,S,u),b.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(S=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),S!==b.state&&cu.enqueueReplaceState(b,b.state,null),ta(i,u,b,y),ea(),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308),u=!0}else if(s===null){b=i.stateNode;var N=i.memoizedProps,U=ar(l,N);b.props=U;var z=b.context,X=l.contextType;S=jr,typeof X=="object"&&X!==null&&(S=At(X));var te=l.getDerivedStateFromProps;X=typeof te=="function"||typeof b.getSnapshotBeforeUpdate=="function",N=i.pendingProps!==N,X||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(N||z!==S)&&em(i,b,u,S),bs=!1;var F=i.memoizedState;b.state=F,ta(i,u,b,y),ea(),z=i.memoizedState,N||F!==z||bs?(typeof te=="function"&&(lu(i,l,te,u),z=i.memoizedState),(U=bs||Zp(i,l,U,u,F,z,S))?(X||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=u,i.memoizedState=z),b.props=u,b.state=z,b.context=S,u=U):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),u=!1)}else{b=i.stateNode,qc(s,i),S=i.memoizedProps,X=ar(l,S),b.props=X,te=i.pendingProps,F=b.context,z=l.contextType,U=jr,typeof z=="object"&&z!==null&&(U=At(z)),N=l.getDerivedStateFromProps,(z=typeof N=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(S!==te||F!==U)&&em(i,b,u,U),bs=!1,F=i.memoizedState,b.state=F,ta(i,u,b,y),ea();var K=i.memoizedState;S!==te||F!==K||bs||s!==null&&s.dependencies!==null&&co(s.dependencies)?(typeof N=="function"&&(lu(i,l,N,u),K=i.memoizedState),(X=bs||Zp(i,l,X,u,F,K,U)||s!==null&&s.dependencies!==null&&co(s.dependencies))?(z||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(u,K,U),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(u,K,U)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=1024),i.memoizedProps=u,i.memoizedState=K),b.props=u,b.state=K,b.context=U,u=X):(typeof b.componentDidUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||S===s.memoizedProps&&F===s.memoizedState||(i.flags|=1024),u=!1)}return b=u,Io(s,i),u=(i.flags&128)!==0,b||u?(b=i.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:b.render(),i.flags|=1,s!==null&&u?(i.child=rr(i,s.child,null,y),i.child=rr(i,null,l,y)):It(s,i,l,y),i.memoizedState=b.state,s=i.child):s=Qn(s,i,y),s}function mm(s,i,l,u){return Ws(),i.flags|=256,It(s,i,l,u),i.child}var hu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function pu(s){return{baseLanes:s,cachePool:rp()}}function mu(s,i,l){return s=s!==null?s.childLanes&~l:0,i&&(s|=tn),s}function gm(s,i,l){var u=i.pendingProps,y=!1,b=(i.flags&128)!==0,S;if((S=b)||(S=s!==null&&s.memoizedState===null?!1:(ut.current&2)!==0),S&&(y=!0,i.flags&=-129),S=(i.flags&32)!==0,i.flags&=-33,s===null){if(qe){if(y?Ss(i):Es(),(s=tt)?(s=E0(s,mn),s=s!==null&&s.data!=="&"?s:null,s!==null&&(i.memoizedState={dehydrated:s,treeContext:gs!==null?{id:Un,overflow:jn}:null,retryLane:536870912,hydrationErrors:null},l=Kh(s),l.return=i,i.child=l,Ct=i,tt=null)):s=null,s===null)throw xs(i);return Xu(s)?i.lanes=32:i.lanes=536870912,null}var N=u.children;return u=u.fallback,y?(Es(),y=i.mode,N=Ro({mode:"hidden",children:N},y),u=Xs(u,y,l,null),N.return=i,u.return=i,N.sibling=u,i.child=N,u=i.child,u.memoizedState=pu(l),u.childLanes=mu(s,S,l),i.memoizedState=hu,aa(null,u)):(Ss(i),gu(i,N))}var U=s.memoizedState;if(U!==null&&(N=U.dehydrated,N!==null)){if(b)i.flags&256?(Ss(i),i.flags&=-257,i=yu(s,i,l)):i.memoizedState!==null?(Es(),i.child=s.child,i.flags|=128,i=null):(Es(),N=u.fallback,y=i.mode,u=Ro({mode:"visible",children:u.children},y),N=Xs(N,y,l,null),N.flags|=2,u.return=i,N.return=i,u.sibling=N,i.child=u,rr(i,s.child,null,l),u=i.child,u.memoizedState=pu(l),u.childLanes=mu(s,S,l),i.memoizedState=hu,i=aa(null,u));else if(Ss(i),Xu(N)){if(S=N.nextSibling&&N.nextSibling.dataset,S)var z=S.dgst;S=z,u=Error(r(419)),u.stack="",u.digest=S,Yi({value:u,source:null,stack:null}),i=yu(s,i,l)}else if(yt||Br(s,i,l,!1),S=(l&s.childLanes)!==0,yt||S){if(S=Ze,S!==null&&(u=nh(S,l),u!==0&&u!==U.retryLane))throw U.retryLane=u,Qs(s,u),Jt(S,s,u),du;Qu(N)||qo(),i=yu(s,i,l)}else Qu(N)?(i.flags|=192,i.child=s.child,i=null):(s=U.treeContext,tt=yn(N.nextSibling),Ct=i,qe=!0,ys=null,mn=!1,s!==null&&Wh(i,s),i=gu(i,u.children),i.flags|=4096);return i}return y?(Es(),N=u.fallback,y=i.mode,U=s.child,z=U.sibling,u=zn(U,{mode:"hidden",children:u.children}),u.subtreeFlags=U.subtreeFlags&65011712,z!==null?N=zn(z,N):(N=Xs(N,y,l,null),N.flags|=2),N.return=i,u.return=i,u.sibling=N,i.child=u,aa(null,u),u=i.child,N=s.child.memoizedState,N===null?N=pu(l):(y=N.cachePool,y!==null?(U=mt._currentValue,y=y.parent!==U?{parent:U,pool:U}:y):y=rp(),N={baseLanes:N.baseLanes|l,cachePool:y}),u.memoizedState=N,u.childLanes=mu(s,S,l),i.memoizedState=hu,aa(s.child,u)):(Ss(i),l=s.child,s=l.sibling,l=zn(l,{mode:"visible",children:u.children}),l.return=i,l.sibling=null,s!==null&&(S=i.deletions,S===null?(i.deletions=[s],i.flags|=16):S.push(s)),i.child=l,i.memoizedState=null,l)}function gu(s,i){return i=Ro({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function Ro(s,i){return s=Xt(22,s,null,i),s.lanes=0,s}function yu(s,i,l){return rr(i,s.child,null,l),s=gu(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function ym(s,i,l){s.lanes|=i;var u=s.alternate;u!==null&&(u.lanes|=i),Mc(s.return,i,l)}function xu(s,i,l,u,y,b){var S=s.memoizedState;S===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:y,treeForkCount:b}:(S.isBackwards=i,S.rendering=null,S.renderingStartTime=0,S.last=u,S.tail=l,S.tailMode=y,S.treeForkCount=b)}function xm(s,i,l){var u=i.pendingProps,y=u.revealOrder,b=u.tail;u=u.children;var S=ut.current,N=(S&2)!==0;if(N?(S=S&1|2,i.flags|=128):S&=1,ne(ut,S),It(s,i,u,l),u=qe?Ji:0,!N&&s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&ym(s,l,i);else if(s.tag===19)ym(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(y){case"forwards":for(l=i.child,y=null;l!==null;)s=l.alternate,s!==null&&xo(s)===null&&(y=l),l=l.sibling;l=y,l===null?(y=i.child,i.child=null):(y=l.sibling,l.sibling=null),xu(i,!1,y,l,b,u);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=i.child,i.child=null;y!==null;){if(s=y.alternate,s!==null&&xo(s)===null){i.child=y;break}s=y.sibling,y.sibling=l,l=y,y=s}xu(i,!0,l,null,b,u);break;case"together":xu(i,!1,null,null,void 0,u);break;default:i.memoizedState=null}return i.child}function Qn(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),Cs|=i.lanes,(l&i.childLanes)===0)if(s!==null){if(Br(s,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(r(153));if(i.child!==null){for(s=i.child,l=zn(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=zn(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function vu(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&co(s)))}function M_(s,i,l){switch(i.tag){case 3:V(i,i.stateNode.containerInfo),vs(i,mt,s.memoizedState.cache),Ws();break;case 27:case 5:xe(i);break;case 4:V(i,i.stateNode.containerInfo);break;case 10:vs(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,zc(i),null;break;case 13:var u=i.memoizedState;if(u!==null)return u.dehydrated!==null?(Ss(i),i.flags|=128,null):(l&i.child.childLanes)!==0?gm(s,i,l):(Ss(i),s=Qn(s,i,l),s!==null?s.sibling:null);Ss(i);break;case 19:var y=(s.flags&128)!==0;if(u=(l&i.childLanes)!==0,u||(Br(s,i,l,!1),u=(l&i.childLanes)!==0),y){if(u)return xm(s,i,l);i.flags|=128}if(y=i.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),ne(ut,ut.current),u)break;return null;case 22:return i.lanes=0,um(s,i,l,i.pendingProps);case 24:vs(i,mt,s.memoizedState.cache)}return Qn(s,i,l)}function vm(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps)yt=!0;else{if(!vu(s,l)&&(i.flags&128)===0)return yt=!1,M_(s,i,l);yt=(s.flags&131072)!==0}else yt=!1,qe&&(i.flags&1048576)!==0&&Xh(i,Ji,i.index);switch(i.lanes=0,i.tag){case 16:e:{var u=i.pendingProps;if(s=nr(i.elementType),i.type=s,typeof s=="function")Ec(s)?(u=ar(s,u),i.tag=1,i=pm(null,i,s,u,l)):(i.tag=0,i=fu(null,i,s,u,l));else{if(s!=null){var y=s.$$typeof;if(y===I){i.tag=11,i=om(null,i,s,u,l);break e}else if(y===H){i.tag=14,i=lm(null,i,s,u,l);break e}}throw i=Ne(s)||s,Error(r(306,i,""))}}return i;case 0:return fu(s,i,i.type,i.pendingProps,l);case 1:return u=i.type,y=ar(u,i.pendingProps),pm(s,i,u,y,l);case 3:e:{if(V(i,i.stateNode.containerInfo),s===null)throw Error(r(387));u=i.pendingProps;var b=i.memoizedState;y=b.element,qc(s,i),ta(i,u,null,l);var S=i.memoizedState;if(u=S.cache,vs(i,mt,u),u!==b.cache&&kc(i,[mt],l,!0),ea(),u=S.element,b.isDehydrated)if(b={element:u,isDehydrated:!1,cache:S.cache},i.updateQueue.baseState=b,i.memoizedState=b,i.flags&256){i=mm(s,i,u,l);break e}else if(u!==y){y=fn(Error(r(424)),i),Yi(y),i=mm(s,i,u,l);break e}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(tt=yn(s.firstChild),Ct=i,qe=!0,ys=null,mn=!0,l=up(i,null,u,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Ws(),u===y){i=Qn(s,i,l);break e}It(s,i,u,l)}i=i.child}return i;case 26:return Io(s,i),s===null?(l=R0(i.type,null,i.pendingProps,null))?i.memoizedState=l:qe||(l=i.type,s=i.pendingProps,u=$o(he.current).createElement(l),u[Nt]=i,u[Vt]=s,Rt(u,l,s),_t(u),i.stateNode=u):i.memoizedState=R0(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return xe(i),s===null&&qe&&(u=i.stateNode=C0(i.type,i.pendingProps,he.current),Ct=i,mn=!0,y=tt,Ms(i.type)?(Wu=y,tt=yn(u.firstChild)):tt=y),It(s,i,i.pendingProps.children,l),Io(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&qe&&((y=u=tt)&&(u=lS(u,i.type,i.pendingProps,mn),u!==null?(i.stateNode=u,Ct=i,tt=yn(u.firstChild),mn=!1,y=!0):y=!1),y||xs(i)),xe(i),y=i.type,b=i.pendingProps,S=s!==null?s.memoizedProps:null,u=b.children,Ju(y,b)?u=null:S!==null&&Ju(y,S)&&(i.flags|=32),i.memoizedState!==null&&(y=$c(s,i,S_,null,null,l),wa._currentValue=y),Io(s,i),It(s,i,u,l),i.child;case 6:return s===null&&qe&&((s=l=tt)&&(l=cS(l,i.pendingProps,mn),l!==null?(i.stateNode=l,Ct=i,tt=null,s=!0):s=!1),s||xs(i)),null;case 13:return gm(s,i,l);case 4:return V(i,i.stateNode.containerInfo),u=i.pendingProps,s===null?i.child=rr(i,null,u,l):It(s,i,u,l),i.child;case 11:return om(s,i,i.type,i.pendingProps,l);case 7:return It(s,i,i.pendingProps,l),i.child;case 8:return It(s,i,i.pendingProps.children,l),i.child;case 12:return It(s,i,i.pendingProps.children,l),i.child;case 10:return u=i.pendingProps,vs(i,i.type,u.value),It(s,i,u.children,l),i.child;case 9:return y=i.type._context,u=i.pendingProps.children,er(i),y=At(y),u=u(y),i.flags|=1,It(s,i,u,l),i.child;case 14:return lm(s,i,i.type,i.pendingProps,l);case 15:return cm(s,i,i.type,i.pendingProps,l);case 19:return xm(s,i,l);case 31:return D_(s,i,l);case 22:return um(s,i,l,i.pendingProps);case 24:return er(i),u=At(mt),s===null?(y=jc(),y===null&&(y=Ze,b=Pc(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=l),y=b),i.memoizedState={parent:u,cache:y},Lc(i),vs(i,mt,y)):((s.lanes&l)!==0&&(qc(s,i),ta(i,null,null,l),ea()),y=s.memoizedState,b=i.memoizedState,y.parent!==u?(y={parent:u,cache:u},i.memoizedState=y,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=y),vs(i,mt,u)):(u=b.cache,vs(i,mt,u),u!==y.cache&&kc(i,[mt],l,!0))),It(s,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(r(156,i.tag))}function Xn(s){s.flags|=4}function bu(s,i,l,u,y){if((i=(s.mode&32)!==0)&&(i=!1),i){if(s.flags|=16777216,(y&335544128)===y)if(s.stateNode.complete)s.flags|=8192;else if($m())s.flags|=8192;else throw sr=po,Oc}else s.flags&=-16777217}function bm(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!U0(i))if($m())s.flags|=8192;else throw sr=po,Oc}function Do(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?Zf():536870912,s.lanes|=i,Wr|=i)}function oa(s,i){if(!qe)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function nt(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,u=0;if(i)for(var y=s.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags&65011712,u|=y.flags&65011712,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags,u|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=u,s.childLanes=l,i}function k_(s,i,l){var u=i.pendingProps;switch(Ac(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nt(i),null;case 1:return nt(i),null;case 3:return l=i.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),i.memoizedState.cache!==u&&(i.flags|=2048),Jn(mt),se(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(qr(i)?Xn(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Rc())),nt(i),null;case 26:var y=i.type,b=i.memoizedState;return s===null?(Xn(i),b!==null?(nt(i),bm(i,b)):(nt(i),bu(i,y,null,u,l))):b?b!==s.memoizedState?(Xn(i),nt(i),bm(i,b)):(nt(i),i.flags&=-16777217):(s=s.memoizedProps,s!==u&&Xn(i),nt(i),bu(i,y,s,u,l)),null;case 27:if(rt(i),l=he.current,y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&Xn(i);else{if(!u){if(i.stateNode===null)throw Error(r(166));return nt(i),null}s=$.current,qr(i)?Zh(i):(s=C0(y,u,l),i.stateNode=s,Xn(i))}return nt(i),null;case 5:if(rt(i),y=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==u&&Xn(i);else{if(!u){if(i.stateNode===null)throw Error(r(166));return nt(i),null}if(b=$.current,qr(i))Zh(i);else{var S=$o(he.current);switch(b){case 1:b=S.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=S.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=S.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=S.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=S.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof u.is=="string"?S.createElement("select",{is:u.is}):S.createElement("select"),u.multiple?b.multiple=!0:u.size&&(b.size=u.size);break;default:b=typeof u.is=="string"?S.createElement(y,{is:u.is}):S.createElement(y)}}b[Nt]=i,b[Vt]=u;e:for(S=i.child;S!==null;){if(S.tag===5||S.tag===6)b.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===i)break e;for(;S.sibling===null;){if(S.return===null||S.return===i)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}i.stateNode=b;e:switch(Rt(b,y,u),y){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&Xn(i)}}return nt(i),bu(i,i.type,s===null?null:s.memoizedProps,i.pendingProps,l),null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==u&&Xn(i);else{if(typeof u!="string"&&i.stateNode===null)throw Error(r(166));if(s=he.current,qr(i)){if(s=i.stateNode,l=i.memoizedProps,u=null,y=Ct,y!==null)switch(y.tag){case 27:case 5:u=y.memoizedProps}s[Nt]=i,s=!!(s.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||g0(s.nodeValue,l)),s||xs(i,!0)}else s=$o(s).createTextNode(u),s[Nt]=i,i.stateNode=s}return nt(i),null;case 31:if(l=i.memoizedState,s===null||s.memoizedState!==null){if(u=qr(i),l!==null){if(s===null){if(!u)throw Error(r(318));if(s=i.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[Nt]=i}else Ws(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;nt(i),s=!1}else l=Rc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=l),s=!0;if(!s)return i.flags&256?(Zt(i),i):(Zt(i),null);if((i.flags&128)!==0)throw Error(r(558))}return nt(i),null;case 13:if(u=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(y=qr(i),u!==null&&u.dehydrated!==null){if(s===null){if(!y)throw Error(r(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[Nt]=i}else Ws(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;nt(i),y=!1}else y=Rc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),y=!0;if(!y)return i.flags&256?(Zt(i),i):(Zt(i),null)}return Zt(i),(i.flags&128)!==0?(i.lanes=l,i):(l=u!==null,s=s!==null&&s.memoizedState!==null,l&&(u=i.child,y=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(y=u.alternate.memoizedState.cachePool.pool),b=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(b=u.memoizedState.cachePool.pool),b!==y&&(u.flags|=2048)),l!==s&&l&&(i.child.flags|=8192),Do(i,i.updateQueue),nt(i),null);case 4:return se(),s===null&&Hu(i.stateNode.containerInfo),nt(i),null;case 10:return Jn(i.type),nt(i),null;case 19:if(J(ut),u=i.memoizedState,u===null)return nt(i),null;if(y=(i.flags&128)!==0,b=u.rendering,b===null)if(y)oa(u,!1);else{if(ct!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(b=xo(s),b!==null){for(i.flags|=128,oa(u,!1),s=b.updateQueue,i.updateQueue=s,Do(i,s),i.subtreeFlags=0,s=l,l=i.child;l!==null;)Yh(l,s),l=l.sibling;return ne(ut,ut.current&1|2),qe&&Fn(i,u.treeForkCount),i.child}s=s.sibling}u.tail!==null&&pt()>jo&&(i.flags|=128,y=!0,oa(u,!1),i.lanes=4194304)}else{if(!y)if(s=xo(b),s!==null){if(i.flags|=128,y=!0,s=s.updateQueue,i.updateQueue=s,Do(i,s),oa(u,!0),u.tail===null&&u.tailMode==="hidden"&&!b.alternate&&!qe)return nt(i),null}else 2*pt()-u.renderingStartTime>jo&&l!==536870912&&(i.flags|=128,y=!0,oa(u,!1),i.lanes=4194304);u.isBackwards?(b.sibling=i.child,i.child=b):(s=u.last,s!==null?s.sibling=b:i.child=b,u.last=b)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=pt(),s.sibling=null,l=ut.current,ne(ut,y?l&1|2:l&1),qe&&Fn(i,u.treeForkCount),s):(nt(i),null);case 22:case 23:return Zt(i),Gc(),u=i.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(i.flags|=8192):u&&(i.flags|=8192),u?(l&536870912)!==0&&(i.flags&128)===0&&(nt(i),i.subtreeFlags&6&&(i.flags|=8192)):nt(i),l=i.updateQueue,l!==null&&Do(i,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),u=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),u!==l&&(i.flags|=2048),s!==null&&J(tr),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Jn(mt),nt(i),null;case 25:return null;case 30:return null}throw Error(r(156,i.tag))}function P_(s,i){switch(Ac(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return Jn(mt),se(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return rt(i),null;case 31:if(i.memoizedState!==null){if(Zt(i),i.alternate===null)throw Error(r(340));Ws()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 13:if(Zt(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(r(340));Ws()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return J(ut),null;case 4:return se(),null;case 10:return Jn(i.type),null;case 22:case 23:return Zt(i),Gc(),s!==null&&J(tr),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return Jn(mt),null;case 25:return null;default:return null}}function wm(s,i){switch(Ac(i),i.tag){case 3:Jn(mt),se();break;case 26:case 27:case 5:rt(i);break;case 4:se();break;case 31:i.memoizedState!==null&&Zt(i);break;case 13:Zt(i);break;case 19:J(ut);break;case 10:Jn(i.type);break;case 22:case 23:Zt(i),Gc(),s!==null&&J(tr);break;case 24:Jn(mt)}}function la(s,i){try{var l=i.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var y=u.next;l=y;do{if((l.tag&s)===s){u=void 0;var b=l.create,S=l.inst;u=b(),S.destroy=u}l=l.next}while(l!==y)}}catch(N){Ye(i,i.return,N)}}function Ts(s,i,l){try{var u=i.updateQueue,y=u!==null?u.lastEffect:null;if(y!==null){var b=y.next;u=b;do{if((u.tag&s)===s){var S=u.inst,N=S.destroy;if(N!==void 0){S.destroy=void 0,y=i;var U=l,z=N;try{z()}catch(X){Ye(y,U,X)}}}u=u.next}while(u!==b)}}catch(X){Ye(i,i.return,X)}}function _m(s){var i=s.updateQueue;if(i!==null){var l=s.stateNode;try{fp(i,l)}catch(u){Ye(s,s.return,u)}}}function Sm(s,i,l){l.props=ar(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(u){Ye(s,i,u)}}function ca(s,i){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var u=s.stateNode;break;case 30:u=s.stateNode;break;default:u=s.stateNode}typeof l=="function"?s.refCleanup=l(u):l.current=u}}catch(y){Ye(s,i,y)}}function On(s,i){var l=s.ref,u=s.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(y){Ye(s,i,y)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){Ye(s,i,y)}else l.current=null}function Em(s){var i=s.type,l=s.memoizedProps,u=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(y){Ye(s,s.return,y)}}function wu(s,i,l){try{var u=s.stateNode;nS(u,s.type,l,i),u[Vt]=i}catch(y){Ye(s,s.return,y)}}function Tm(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Ms(s.type)||s.tag===4}function _u(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Tm(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Ms(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Su(s,i,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(s),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=Hn));else if(u!==4&&(u===27&&Ms(s.type)&&(l=s.stateNode,i=null),s=s.child,s!==null))for(Su(s,i,l),s=s.sibling;s!==null;)Su(s,i,l),s=s.sibling}function Mo(s,i,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(u!==4&&(u===27&&Ms(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(Mo(s,i,l),s=s.sibling;s!==null;)Mo(s,i,l),s=s.sibling}function Nm(s){var i=s.stateNode,l=s.memoizedProps;try{for(var u=s.type,y=i.attributes;y.length;)i.removeAttributeNode(y[0]);Rt(i,u,l),i[Nt]=s,i[Vt]=l}catch(b){Ye(s,s.return,b)}}var Wn=!1,xt=!1,Eu=!1,Cm=typeof WeakSet=="function"?WeakSet:Set,St=null;function U_(s,i){if(s=s.containerInfo,Fu=Zo,s=qh(s),yc(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var y=u.anchorOffset,b=u.focusNode;u=u.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break e}var S=0,N=-1,U=-1,z=0,X=0,te=s,F=null;t:for(;;){for(var K;te!==l||y!==0&&te.nodeType!==3||(N=S+y),te!==b||u!==0&&te.nodeType!==3||(U=S+u),te.nodeType===3&&(S+=te.nodeValue.length),(K=te.firstChild)!==null;)F=te,te=K;for(;;){if(te===s)break t;if(F===l&&++z===y&&(N=S),F===b&&++X===u&&(U=S),(K=te.nextSibling)!==null)break;te=F,F=te.parentNode}te=K}l=N===-1||U===-1?null:{start:N,end:U}}else l=null}l=l||{start:0,end:0}}else l=null;for($u={focusedElem:s,selectionRange:l},Zo=!1,St=i;St!==null;)if(i=St,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,St=s;else for(;St!==null;){switch(i=St,b=i.alternate,s=i.flags,i.tag){case 0:if((s&4)!==0&&(s=i.updateQueue,s=s!==null?s.events:null,s!==null))for(l=0;l<s.length;l++)y=s[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&b!==null){s=void 0,l=i,y=b.memoizedProps,b=b.memoizedState,u=l.stateNode;try{var me=ar(l.type,y);s=u.getSnapshotBeforeUpdate(me,b),u.__reactInternalSnapshotBeforeUpdate=s}catch(Se){Ye(l,l.return,Se)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,l=s.nodeType,l===9)Ku(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Ku(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=i.sibling,s!==null){s.return=i.return,St=s;break}St=i.return}}function Am(s,i,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:es(s,l),u&4&&la(5,l);break;case 1:if(es(s,l),u&4)if(s=l.stateNode,i===null)try{s.componentDidMount()}catch(S){Ye(l,l.return,S)}else{var y=ar(l.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(y,i,s.__reactInternalSnapshotBeforeUpdate)}catch(S){Ye(l,l.return,S)}}u&64&&_m(l),u&512&&ca(l,l.return);break;case 3:if(es(s,l),u&64&&(s=l.updateQueue,s!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{fp(s,i)}catch(S){Ye(l,l.return,S)}}break;case 27:i===null&&u&4&&Nm(l);case 26:case 5:es(s,l),i===null&&u&4&&Em(l),u&512&&ca(l,l.return);break;case 12:es(s,l);break;case 31:es(s,l),u&4&&Dm(s,l);break;case 13:es(s,l),u&4&&Mm(s,l),u&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=z_.bind(null,l),uS(s,l))));break;case 22:if(u=l.memoizedState!==null||Wn,!u){i=i!==null&&i.memoizedState!==null||xt,y=Wn;var b=xt;Wn=u,(xt=i)&&!b?ts(s,l,(l.subtreeFlags&8772)!==0):es(s,l),Wn=y,xt=b}break;case 30:break;default:es(s,l)}}function Im(s){var i=s.alternate;i!==null&&(s.alternate=null,Im(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&ec(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var it=null,Gt=!1;function Zn(s,i,l){for(l=l.child;l!==null;)Rm(s,i,l),l=l.sibling}function Rm(s,i,l){if(Yt&&typeof Yt.onCommitFiberUnmount=="function")try{Yt.onCommitFiberUnmount(ki,l)}catch{}switch(l.tag){case 26:xt||On(l,i),Zn(s,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:xt||On(l,i);var u=it,y=Gt;Ms(l.type)&&(it=l.stateNode,Gt=!1),Zn(s,i,l),xa(l.stateNode),it=u,Gt=y;break;case 5:xt||On(l,i);case 6:if(u=it,y=Gt,it=null,Zn(s,i,l),it=u,Gt=y,it!==null)if(Gt)try{(it.nodeType===9?it.body:it.nodeName==="HTML"?it.ownerDocument.body:it).removeChild(l.stateNode)}catch(b){Ye(l,i,b)}else try{it.removeChild(l.stateNode)}catch(b){Ye(l,i,b)}break;case 18:it!==null&&(Gt?(s=it,_0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),ai(s)):_0(it,l.stateNode));break;case 4:u=it,y=Gt,it=l.stateNode.containerInfo,Gt=!0,Zn(s,i,l),it=u,Gt=y;break;case 0:case 11:case 14:case 15:Ts(2,l,i),xt||Ts(4,l,i),Zn(s,i,l);break;case 1:xt||(On(l,i),u=l.stateNode,typeof u.componentWillUnmount=="function"&&Sm(l,i,u)),Zn(s,i,l);break;case 21:Zn(s,i,l);break;case 22:xt=(u=xt)||l.memoizedState!==null,Zn(s,i,l),xt=u;break;default:Zn(s,i,l)}}function Dm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{ai(s)}catch(l){Ye(i,i.return,l)}}}function Mm(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{ai(s)}catch(l){Ye(i,i.return,l)}}function j_(s){switch(s.tag){case 31:case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Cm),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Cm),i;default:throw Error(r(435,s.tag))}}function ko(s,i){var l=j_(s);i.forEach(function(u){if(!l.has(u)){l.add(u);var y=F_.bind(null,s,u);u.then(y,y)}})}function zt(s,i){var l=i.deletions;if(l!==null)for(var u=0;u<l.length;u++){var y=l[u],b=s,S=i,N=S;e:for(;N!==null;){switch(N.tag){case 27:if(Ms(N.type)){it=N.stateNode,Gt=!1;break e}break;case 5:it=N.stateNode,Gt=!1;break e;case 3:case 4:it=N.stateNode.containerInfo,Gt=!0;break e}N=N.return}if(it===null)throw Error(r(160));Rm(b,S,y),it=null,Gt=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)km(i,s),i=i.sibling}var Sn=null;function km(s,i){var l=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:zt(i,s),Ft(s),u&4&&(Ts(3,s,s.return),la(3,s),Ts(5,s,s.return));break;case 1:zt(i,s),Ft(s),u&512&&(xt||l===null||On(l,l.return)),u&64&&Wn&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var y=Sn;if(zt(i,s),Ft(s),u&512&&(xt||l===null||On(l,l.return)),u&4){var b=l!==null?l.memoizedState:null;if(u=s.memoizedState,l===null)if(u===null)if(s.stateNode===null){e:{u=s.type,l=s.memoizedProps,y=y.ownerDocument||y;t:switch(u){case"title":b=y.getElementsByTagName("title")[0],(!b||b[ji]||b[Nt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(u),y.head.insertBefore(b,y.querySelector("head > title"))),Rt(b,u,l),b[Nt]=s,_t(b),u=b;break e;case"link":var S=k0("link","href",y).get(u+(l.href||""));if(S){for(var N=0;N<S.length;N++)if(b=S[N],b.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&b.getAttribute("rel")===(l.rel==null?null:l.rel)&&b.getAttribute("title")===(l.title==null?null:l.title)&&b.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){S.splice(N,1);break t}}b=y.createElement(u),Rt(b,u,l),y.head.appendChild(b);break;case"meta":if(S=k0("meta","content",y).get(u+(l.content||""))){for(N=0;N<S.length;N++)if(b=S[N],b.getAttribute("content")===(l.content==null?null:""+l.content)&&b.getAttribute("name")===(l.name==null?null:l.name)&&b.getAttribute("property")===(l.property==null?null:l.property)&&b.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&b.getAttribute("charset")===(l.charSet==null?null:l.charSet)){S.splice(N,1);break t}}b=y.createElement(u),Rt(b,u,l),y.head.appendChild(b);break;default:throw Error(r(468,u))}b[Nt]=s,_t(b),u=b}s.stateNode=u}else P0(y,s.type,s.stateNode);else s.stateNode=M0(y,u,s.memoizedProps);else b!==u?(b===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):b.count--,u===null?P0(y,s.type,s.stateNode):M0(y,u,s.memoizedProps)):u===null&&s.stateNode!==null&&wu(s,s.memoizedProps,l.memoizedProps)}break;case 27:zt(i,s),Ft(s),u&512&&(xt||l===null||On(l,l.return)),l!==null&&u&4&&wu(s,s.memoizedProps,l.memoizedProps);break;case 5:if(zt(i,s),Ft(s),u&512&&(xt||l===null||On(l,l.return)),s.flags&32){y=s.stateNode;try{Ir(y,"")}catch(me){Ye(s,s.return,me)}}u&4&&s.stateNode!=null&&(y=s.memoizedProps,wu(s,y,l!==null?l.memoizedProps:y)),u&1024&&(Eu=!0);break;case 6:if(zt(i,s),Ft(s),u&4){if(s.stateNode===null)throw Error(r(162));u=s.memoizedProps,l=s.stateNode;try{l.nodeValue=u}catch(me){Ye(s,s.return,me)}}break;case 3:if(Ko=null,y=Sn,Sn=Jo(i.containerInfo),zt(i,s),Sn=y,Ft(s),u&4&&l!==null&&l.memoizedState.isDehydrated)try{ai(i.containerInfo)}catch(me){Ye(s,s.return,me)}Eu&&(Eu=!1,Pm(s));break;case 4:u=Sn,Sn=Jo(s.stateNode.containerInfo),zt(i,s),Ft(s),Sn=u;break;case 12:zt(i,s),Ft(s);break;case 31:zt(i,s),Ft(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,ko(s,u)));break;case 13:zt(i,s),Ft(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Uo=pt()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,ko(s,u)));break;case 22:y=s.memoizedState!==null;var U=l!==null&&l.memoizedState!==null,z=Wn,X=xt;if(Wn=z||y,xt=X||U,zt(i,s),xt=X,Wn=z,Ft(s),u&8192)e:for(i=s.stateNode,i._visibility=y?i._visibility&-2:i._visibility|1,y&&(l===null||U||Wn||xt||or(s)),l=null,i=s;;){if(i.tag===5||i.tag===26){if(l===null){U=l=i;try{if(b=U.stateNode,y)S=b.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{N=U.stateNode;var te=U.memoizedProps.style,F=te!=null&&te.hasOwnProperty("display")?te.display:null;N.style.display=F==null||typeof F=="boolean"?"":(""+F).trim()}}catch(me){Ye(U,U.return,me)}}}else if(i.tag===6){if(l===null){U=i;try{U.stateNode.nodeValue=y?"":U.memoizedProps}catch(me){Ye(U,U.return,me)}}}else if(i.tag===18){if(l===null){U=i;try{var K=U.stateNode;y?S0(K,!0):S0(U.stateNode,!1)}catch(me){Ye(U,U.return,me)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}u&4&&(u=s.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,ko(s,l))));break;case 19:zt(i,s),Ft(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,ko(s,u)));break;case 30:break;case 21:break;default:zt(i,s),Ft(s)}}function Ft(s){var i=s.flags;if(i&2){try{for(var l,u=s.return;u!==null;){if(Tm(u)){l=u;break}u=u.return}if(l==null)throw Error(r(160));switch(l.tag){case 27:var y=l.stateNode,b=_u(s);Mo(s,b,y);break;case 5:var S=l.stateNode;l.flags&32&&(Ir(S,""),l.flags&=-33);var N=_u(s);Mo(s,N,S);break;case 3:case 4:var U=l.stateNode.containerInfo,z=_u(s);Su(s,z,U);break;default:throw Error(r(161))}}catch(X){Ye(s,s.return,X)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Pm(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Pm(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function es(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Am(s,i.alternate,i),i=i.sibling}function or(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:Ts(4,i,i.return),or(i);break;case 1:On(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&Sm(i,i.return,l),or(i);break;case 27:xa(i.stateNode);case 26:case 5:On(i,i.return),or(i);break;case 22:i.memoizedState===null&&or(i);break;case 30:or(i);break;default:or(i)}s=s.sibling}}function ts(s,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var u=i.alternate,y=s,b=i,S=b.flags;switch(b.tag){case 0:case 11:case 15:ts(y,b,l),la(4,b);break;case 1:if(ts(y,b,l),u=b,y=u.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(z){Ye(u,u.return,z)}if(u=b,y=u.updateQueue,y!==null){var N=u.stateNode;try{var U=y.shared.hiddenCallbacks;if(U!==null)for(y.shared.hiddenCallbacks=null,y=0;y<U.length;y++)dp(U[y],N)}catch(z){Ye(u,u.return,z)}}l&&S&64&&_m(b),ca(b,b.return);break;case 27:Nm(b);case 26:case 5:ts(y,b,l),l&&u===null&&S&4&&Em(b),ca(b,b.return);break;case 12:ts(y,b,l);break;case 31:ts(y,b,l),l&&S&4&&Dm(y,b);break;case 13:ts(y,b,l),l&&S&4&&Mm(y,b);break;case 22:b.memoizedState===null&&ts(y,b,l),ca(b,b.return);break;case 30:break;default:ts(y,b,l)}i=i.sibling}}function Tu(s,i){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&Ki(l))}function Nu(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Ki(s))}function En(s,i,l,u){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Um(s,i,l,u),i=i.sibling}function Um(s,i,l,u){var y=i.flags;switch(i.tag){case 0:case 11:case 15:En(s,i,l,u),y&2048&&la(9,i);break;case 1:En(s,i,l,u);break;case 3:En(s,i,l,u),y&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Ki(s)));break;case 12:if(y&2048){En(s,i,l,u),s=i.stateNode;try{var b=i.memoizedProps,S=b.id,N=b.onPostCommit;typeof N=="function"&&N(S,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(U){Ye(i,i.return,U)}}else En(s,i,l,u);break;case 31:En(s,i,l,u);break;case 13:En(s,i,l,u);break;case 23:break;case 22:b=i.stateNode,S=i.alternate,i.memoizedState!==null?b._visibility&2?En(s,i,l,u):ua(s,i):b._visibility&2?En(s,i,l,u):(b._visibility|=2,Kr(s,i,l,u,(i.subtreeFlags&10256)!==0||!1)),y&2048&&Tu(S,i);break;case 24:En(s,i,l,u),y&2048&&Nu(i.alternate,i);break;default:En(s,i,l,u)}}function Kr(s,i,l,u,y){for(y=y&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var b=s,S=i,N=l,U=u,z=S.flags;switch(S.tag){case 0:case 11:case 15:Kr(b,S,N,U,y),la(8,S);break;case 23:break;case 22:var X=S.stateNode;S.memoizedState!==null?X._visibility&2?Kr(b,S,N,U,y):ua(b,S):(X._visibility|=2,Kr(b,S,N,U,y)),y&&z&2048&&Tu(S.alternate,S);break;case 24:Kr(b,S,N,U,y),y&&z&2048&&Nu(S.alternate,S);break;default:Kr(b,S,N,U,y)}i=i.sibling}}function ua(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=s,u=i,y=u.flags;switch(u.tag){case 22:ua(l,u),y&2048&&Tu(u.alternate,u);break;case 24:ua(l,u),y&2048&&Nu(u.alternate,u);break;default:ua(l,u)}i=i.sibling}}var da=8192;function Qr(s,i,l){if(s.subtreeFlags&da)for(s=s.child;s!==null;)jm(s,i,l),s=s.sibling}function jm(s,i,l){switch(s.tag){case 26:Qr(s,i,l),s.flags&da&&s.memoizedState!==null&&_S(l,Sn,s.memoizedState,s.memoizedProps);break;case 5:Qr(s,i,l);break;case 3:case 4:var u=Sn;Sn=Jo(s.stateNode.containerInfo),Qr(s,i,l),Sn=u;break;case 22:s.memoizedState===null&&(u=s.alternate,u!==null&&u.memoizedState!==null?(u=da,da=16777216,Qr(s,i,l),da=u):Qr(s,i,l));break;default:Qr(s,i,l)}}function Om(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function fa(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var u=i[l];St=u,qm(u,s)}Om(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Lm(s),s=s.sibling}function Lm(s){switch(s.tag){case 0:case 11:case 15:fa(s),s.flags&2048&&Ts(9,s,s.return);break;case 3:fa(s);break;case 12:fa(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,Po(s)):fa(s);break;default:fa(s)}}function Po(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var u=i[l];St=u,qm(u,s)}Om(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:Ts(8,i,i.return),Po(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,Po(i));break;default:Po(i)}s=s.sibling}}function qm(s,i){for(;St!==null;){var l=St;switch(l.tag){case 0:case 11:case 15:Ts(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Ki(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,St=u;else e:for(l=s;St!==null;){u=St;var y=u.sibling,b=u.return;if(Im(u),u===l){St=null;break e}if(y!==null){y.return=b,St=y;break e}St=b}}}var O_={getCacheForType:function(s){var i=At(mt),l=i.data.get(s);return l===void 0&&(l=s(),i.data.set(s,l)),l},cacheSignal:function(){return At(mt).controller.signal}},L_=typeof WeakMap=="function"?WeakMap:Map,Fe=0,Ze=null,Pe=null,je=0,Je=0,en=null,Ns=!1,Xr=!1,Cu=!1,ns=0,ct=0,Cs=0,lr=0,Au=0,tn=0,Wr=0,ha=null,$t=null,Iu=!1,Uo=0,Bm=0,jo=1/0,Oo=null,As=null,bt=0,Is=null,Zr=null,ss=0,Ru=0,Du=null,Vm=null,pa=0,Mu=null;function nn(){return(Fe&2)!==0&&je!==0?je&-je:R.T!==null?Lu():sh()}function Hm(){if(tn===0)if((je&536870912)===0||qe){var s=za;za<<=1,(za&3932160)===0&&(za=262144),tn=s}else tn=536870912;return s=Wt.current,s!==null&&(s.flags|=32),tn}function Jt(s,i,l){(s===Ze&&(Je===2||Je===9)||s.cancelPendingCommit!==null)&&(ei(s,0),Rs(s,je,tn,!1)),Ui(s,l),((Fe&2)===0||s!==Ze)&&(s===Ze&&((Fe&2)===0&&(lr|=l),ct===4&&Rs(s,je,tn,!1)),Ln(s))}function Gm(s,i,l){if((Fe&6)!==0)throw Error(r(327));var u=!l&&(i&127)===0&&(i&s.expiredLanes)===0||Pi(s,i),y=u?V_(s,i):Pu(s,i,!0),b=u;do{if(y===0){Xr&&!u&&Rs(s,i,0,!1);break}else{if(l=s.current.alternate,b&&!q_(l)){y=Pu(s,i,!1),b=!1;continue}if(y===2){if(b=i,s.errorRecoveryDisabledLanes&b)var S=0;else S=s.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){i=S;e:{var N=s;y=ha;var U=N.current.memoizedState.isDehydrated;if(U&&(ei(N,S).flags|=256),S=Pu(N,S,!1),S!==2){if(Cu&&!U){N.errorRecoveryDisabledLanes|=b,lr|=b,y=4;break e}b=$t,$t=y,b!==null&&($t===null?$t=b:$t.push.apply($t,b))}y=S}if(b=!1,y!==2)continue}}if(y===1){ei(s,0),Rs(s,i,0,!0);break}e:{switch(u=s,b=y,b){case 0:case 1:throw Error(r(345));case 4:if((i&4194048)!==i)break;case 6:Rs(u,i,tn,!Ns);break e;case 2:$t=null;break;case 3:case 5:break;default:throw Error(r(329))}if((i&62914560)===i&&(y=Uo+300-pt(),10<y)){if(Rs(u,i,tn,!Ns),$a(u,0,!0)!==0)break e;ss=i,u.timeoutHandle=b0(zm.bind(null,u,l,$t,Oo,Iu,i,tn,lr,Wr,Ns,b,"Throttled",-0,0),y);break e}zm(u,l,$t,Oo,Iu,i,tn,lr,Wr,Ns,b,null,-0,0)}}break}while(!0);Ln(s)}function zm(s,i,l,u,y,b,S,N,U,z,X,te,F,K){if(s.timeoutHandle=-1,te=i.subtreeFlags,te&8192||(te&16785408)===16785408){te={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Hn},jm(i,b,te);var me=(b&62914560)===b?Uo-pt():(b&4194048)===b?Bm-pt():0;if(me=SS(te,me),me!==null){ss=b,s.cancelPendingCommit=me(Wm.bind(null,s,i,b,l,u,y,S,N,U,X,te,null,F,K)),Rs(s,b,S,!z);return}}Wm(s,i,b,l,u,y,S,N,U)}function q_(s){for(var i=s;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var y=l[u],b=y.getSnapshot;y=y.value;try{if(!Qt(b(),y))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Rs(s,i,l,u){i&=~Au,i&=~lr,s.suspendedLanes|=i,s.pingedLanes&=~i,u&&(s.warmLanes|=i),u=s.expirationTimes;for(var y=i;0<y;){var b=31-Kt(y),S=1<<b;u[b]=-1,y&=~S}l!==0&&eh(s,l,i)}function Lo(){return(Fe&6)===0?(ma(0),!1):!0}function ku(){if(Pe!==null){if(Je===0)var s=Pe.return;else s=Pe,$n=Zs=null,Kc(s),zr=null,Xi=0,s=Pe;for(;s!==null;)wm(s.alternate,s),s=s.return;Pe=null}}function ei(s,i){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,iS(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),ss=0,ku(),Ze=s,Pe=l=zn(s.current,null),je=i,Je=0,en=null,Ns=!1,Xr=Pi(s,i),Cu=!1,Wr=tn=Au=lr=Cs=ct=0,$t=ha=null,Iu=!1,(i&8)!==0&&(i|=i&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=i;0<u;){var y=31-Kt(u),b=1<<y;i|=s[y],u&=~b}return ns=i,ro(),l}function Fm(s,i){De=null,R.H=ia,i===Gr||i===ho?(i=op(),Je=3):i===Oc?(i=op(),Je=4):Je=i===du?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,en=i,Pe===null&&(ct=1,Co(s,fn(i,s.current)))}function $m(){var s=Wt.current;return s===null?!0:(je&4194048)===je?gn===null:(je&62914560)===je||(je&536870912)!==0?s===gn:!1}function Jm(){var s=R.H;return R.H=ia,s===null?ia:s}function Ym(){var s=R.A;return R.A=O_,s}function qo(){ct=4,Ns||(je&4194048)!==je&&Wt.current!==null||(Xr=!0),(Cs&134217727)===0&&(lr&134217727)===0||Ze===null||Rs(Ze,je,tn,!1)}function Pu(s,i,l){var u=Fe;Fe|=2;var y=Jm(),b=Ym();(Ze!==s||je!==i)&&(Oo=null,ei(s,i)),i=!1;var S=ct;e:do try{if(Je!==0&&Pe!==null){var N=Pe,U=en;switch(Je){case 8:ku(),S=6;break e;case 3:case 2:case 9:case 6:Wt.current===null&&(i=!0);var z=Je;if(Je=0,en=null,ti(s,N,U,z),l&&Xr){S=0;break e}break;default:z=Je,Je=0,en=null,ti(s,N,U,z)}}B_(),S=ct;break}catch(X){Fm(s,X)}while(!0);return i&&s.shellSuspendCounter++,$n=Zs=null,Fe=u,R.H=y,R.A=b,Pe===null&&(Ze=null,je=0,ro()),S}function B_(){for(;Pe!==null;)Km(Pe)}function V_(s,i){var l=Fe;Fe|=2;var u=Jm(),y=Ym();Ze!==s||je!==i?(Oo=null,jo=pt()+500,ei(s,i)):Xr=Pi(s,i);e:do try{if(Je!==0&&Pe!==null){i=Pe;var b=en;t:switch(Je){case 1:Je=0,en=null,ti(s,i,b,1);break;case 2:case 9:if(ip(b)){Je=0,en=null,Qm(i);break}i=function(){Je!==2&&Je!==9||Ze!==s||(Je=7),Ln(s)},b.then(i,i);break e;case 3:Je=7;break e;case 4:Je=5;break e;case 7:ip(b)?(Je=0,en=null,Qm(i)):(Je=0,en=null,ti(s,i,b,7));break;case 5:var S=null;switch(Pe.tag){case 26:S=Pe.memoizedState;case 5:case 27:var N=Pe;if(S?U0(S):N.stateNode.complete){Je=0,en=null;var U=N.sibling;if(U!==null)Pe=U;else{var z=N.return;z!==null?(Pe=z,Bo(z)):Pe=null}break t}}Je=0,en=null,ti(s,i,b,5);break;case 6:Je=0,en=null,ti(s,i,b,6);break;case 8:ku(),ct=6;break e;default:throw Error(r(462))}}H_();break}catch(X){Fm(s,X)}while(!0);return $n=Zs=null,R.H=u,R.A=y,Fe=l,Pe!==null?0:(Ze=null,je=0,ro(),ct)}function H_(){for(;Pe!==null&&!Ee();)Km(Pe)}function Km(s){var i=vm(s.alternate,s,ns);s.memoizedProps=s.pendingProps,i===null?Bo(s):Pe=i}function Qm(s){var i=s,l=i.alternate;switch(i.tag){case 15:case 0:i=hm(l,i,i.pendingProps,i.type,void 0,je);break;case 11:i=hm(l,i,i.pendingProps,i.type.render,i.ref,je);break;case 5:Kc(i);default:wm(l,i),i=Pe=Yh(i,ns),i=vm(l,i,ns)}s.memoizedProps=s.pendingProps,i===null?Bo(s):Pe=i}function ti(s,i,l,u){$n=Zs=null,Kc(i),zr=null,Xi=0;var y=i.return;try{if(R_(s,y,i,l,je)){ct=1,Co(s,fn(l,s.current)),Pe=null;return}}catch(b){if(y!==null)throw Pe=y,b;ct=1,Co(s,fn(l,s.current)),Pe=null;return}i.flags&32768?(qe||u===1?s=!0:Xr||(je&536870912)!==0?s=!1:(Ns=s=!0,(u===2||u===9||u===3||u===6)&&(u=Wt.current,u!==null&&u.tag===13&&(u.flags|=16384))),Xm(i,s)):Bo(i)}function Bo(s){var i=s;do{if((i.flags&32768)!==0){Xm(i,Ns);return}s=i.return;var l=k_(i.alternate,i,ns);if(l!==null){Pe=l;return}if(i=i.sibling,i!==null){Pe=i;return}Pe=i=s}while(i!==null);ct===0&&(ct=5)}function Xm(s,i){do{var l=P_(s.alternate,s);if(l!==null){l.flags&=32767,Pe=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(s=s.sibling,s!==null)){Pe=s;return}Pe=s=l}while(s!==null);ct=6,Pe=null}function Wm(s,i,l,u,y,b,S,N,U){s.cancelPendingCommit=null;do Vo();while(bt!==0);if((Fe&6)!==0)throw Error(r(327));if(i!==null){if(i===s.current)throw Error(r(177));if(b=i.lanes|i.childLanes,b|=_c,ww(s,l,b,S,N,U),s===Ze&&(Pe=Ze=null,je=0),Zr=i,Is=s,ss=l,Ru=b,Du=y,Vm=u,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,$_(_r,function(){return s0(),null})):(s.callbackNode=null,s.callbackPriority=0),u=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||u){u=R.T,R.T=null,y=O.p,O.p=2,S=Fe,Fe|=4;try{U_(s,i,l)}finally{Fe=S,O.p=y,R.T=u}}bt=1,Zm(),e0(),t0()}}function Zm(){if(bt===1){bt=0;var s=Is,i=Zr,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=R.T,R.T=null;var u=O.p;O.p=2;var y=Fe;Fe|=4;try{km(i,s);var b=$u,S=qh(s.containerInfo),N=b.focusedElem,U=b.selectionRange;if(S!==N&&N&&N.ownerDocument&&Lh(N.ownerDocument.documentElement,N)){if(U!==null&&yc(N)){var z=U.start,X=U.end;if(X===void 0&&(X=z),"selectionStart"in N)N.selectionStart=z,N.selectionEnd=Math.min(X,N.value.length);else{var te=N.ownerDocument||document,F=te&&te.defaultView||window;if(F.getSelection){var K=F.getSelection(),me=N.textContent.length,Se=Math.min(U.start,me),Xe=U.end===void 0?Se:Math.min(U.end,me);!K.extend&&Se>Xe&&(S=Xe,Xe=Se,Se=S);var q=Oh(N,Se),L=Oh(N,Xe);if(q&&L&&(K.rangeCount!==1||K.anchorNode!==q.node||K.anchorOffset!==q.offset||K.focusNode!==L.node||K.focusOffset!==L.offset)){var G=te.createRange();G.setStart(q.node,q.offset),K.removeAllRanges(),Se>Xe?(K.addRange(G),K.extend(L.node,L.offset)):(G.setEnd(L.node,L.offset),K.addRange(G))}}}}for(te=[],K=N;K=K.parentNode;)K.nodeType===1&&te.push({element:K,left:K.scrollLeft,top:K.scrollTop});for(typeof N.focus=="function"&&N.focus(),N=0;N<te.length;N++){var ee=te[N];ee.element.scrollLeft=ee.left,ee.element.scrollTop=ee.top}}Zo=!!Fu,$u=Fu=null}finally{Fe=y,O.p=u,R.T=l}}s.current=i,bt=2}}function e0(){if(bt===2){bt=0;var s=Is,i=Zr,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=R.T,R.T=null;var u=O.p;O.p=2;var y=Fe;Fe|=4;try{Am(s,i.alternate,i)}finally{Fe=y,O.p=u,R.T=l}}bt=3}}function t0(){if(bt===4||bt===3){bt=0,Be();var s=Is,i=Zr,l=ss,u=Vm;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?bt=5:(bt=0,Zr=Is=null,n0(s,s.pendingLanes));var y=s.pendingLanes;if(y===0&&(As=null),Wl(l),i=i.stateNode,Yt&&typeof Yt.onCommitFiberRoot=="function")try{Yt.onCommitFiberRoot(ki,i,void 0,(i.current.flags&128)===128)}catch{}if(u!==null){i=R.T,y=O.p,O.p=2,R.T=null;try{for(var b=s.onRecoverableError,S=0;S<u.length;S++){var N=u[S];b(N.value,{componentStack:N.stack})}}finally{R.T=i,O.p=y}}(ss&3)!==0&&Vo(),Ln(s),y=s.pendingLanes,(l&261930)!==0&&(y&42)!==0?s===Mu?pa++:(pa=0,Mu=s):pa=0,ma(0)}}function n0(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,Ki(i)))}function Vo(){return Zm(),e0(),t0(),s0()}function s0(){if(bt!==5)return!1;var s=Is,i=Ru;Ru=0;var l=Wl(ss),u=R.T,y=O.p;try{O.p=32>l?32:l,R.T=null,l=Du,Du=null;var b=Is,S=ss;if(bt=0,Zr=Is=null,ss=0,(Fe&6)!==0)throw Error(r(331));var N=Fe;if(Fe|=4,Lm(b.current),Um(b,b.current,S,l),Fe=N,ma(0,!1),Yt&&typeof Yt.onPostCommitFiberRoot=="function")try{Yt.onPostCommitFiberRoot(ki,b)}catch{}return!0}finally{O.p=y,R.T=u,n0(s,i)}}function r0(s,i,l){i=fn(l,i),i=uu(s.stateNode,i,2),s=_s(s,i,2),s!==null&&(Ui(s,2),Ln(s))}function Ye(s,i,l){if(s.tag===3)r0(s,s,l);else for(;i!==null;){if(i.tag===3){r0(i,s,l);break}else if(i.tag===1){var u=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(As===null||!As.has(u))){s=fn(l,s),l=im(2),u=_s(i,l,2),u!==null&&(am(l,u,i,s),Ui(u,2),Ln(u));break}}i=i.return}}function Uu(s,i,l){var u=s.pingCache;if(u===null){u=s.pingCache=new L_;var y=new Set;u.set(i,y)}else y=u.get(i),y===void 0&&(y=new Set,u.set(i,y));y.has(l)||(Cu=!0,y.add(l),s=G_.bind(null,s,i,l),i.then(s,s))}function G_(s,i,l){var u=s.pingCache;u!==null&&u.delete(i),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,Ze===s&&(je&l)===l&&(ct===4||ct===3&&(je&62914560)===je&&300>pt()-Uo?(Fe&2)===0&&ei(s,0):Au|=l,Wr===je&&(Wr=0)),Ln(s)}function i0(s,i){i===0&&(i=Zf()),s=Qs(s,i),s!==null&&(Ui(s,i),Ln(s))}function z_(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),i0(s,l)}function F_(s,i){var l=0;switch(s.tag){case 31:case 13:var u=s.stateNode,y=s.memoizedState;y!==null&&(l=y.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(r(314))}u!==null&&u.delete(i),i0(s,l)}function $_(s,i){return ie(s,i)}var Ho=null,ni=null,ju=!1,Go=!1,Ou=!1,Ds=0;function Ln(s){s!==ni&&s.next===null&&(ni===null?Ho=ni=s:ni=ni.next=s),Go=!0,ju||(ju=!0,Y_())}function ma(s,i){if(!Ou&&Go){Ou=!0;do for(var l=!1,u=Ho;u!==null;){if(s!==0){var y=u.pendingLanes;if(y===0)var b=0;else{var S=u.suspendedLanes,N=u.pingedLanes;b=(1<<31-Kt(42|s)+1)-1,b&=y&~(S&~N),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(l=!0,c0(u,b))}else b=je,b=$a(u,u===Ze?b:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(b&3)===0||Pi(u,b)||(l=!0,c0(u,b));u=u.next}while(l);Ou=!1}}function J_(){a0()}function a0(){Go=ju=!1;var s=0;Ds!==0&&rS()&&(s=Ds);for(var i=pt(),l=null,u=Ho;u!==null;){var y=u.next,b=o0(u,i);b===0?(u.next=null,l===null?Ho=y:l.next=y,y===null&&(ni=l)):(l=u,(s!==0||(b&3)!==0)&&(Go=!0)),u=y}bt!==0&&bt!==5||ma(s),Ds!==0&&(Ds=0)}function o0(s,i){for(var l=s.suspendedLanes,u=s.pingedLanes,y=s.expirationTimes,b=s.pendingLanes&-62914561;0<b;){var S=31-Kt(b),N=1<<S,U=y[S];U===-1?((N&l)===0||(N&u)!==0)&&(y[S]=bw(N,i)):U<=i&&(s.expiredLanes|=N),b&=~N}if(i=Ze,l=je,l=$a(s,s===i?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u=s.callbackNode,l===0||s===i&&(Je===2||Je===9)||s.cancelPendingCommit!==null)return u!==null&&u!==null&&ce(u),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||Pi(s,l)){if(i=l&-l,i===s.callbackPriority)return i;switch(u!==null&&ce(u),Wl(l)){case 2:case 8:l=Pn;break;case 32:l=_r;break;case 268435456:l=Wf;break;default:l=_r}return u=l0.bind(null,s),l=ie(l,u),s.callbackPriority=i,s.callbackNode=l,i}return u!==null&&u!==null&&ce(u),s.callbackPriority=2,s.callbackNode=null,2}function l0(s,i){if(bt!==0&&bt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(Vo()&&s.callbackNode!==l)return null;var u=je;return u=$a(s,s===Ze?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u===0?null:(Gm(s,u,i),o0(s,pt()),s.callbackNode!=null&&s.callbackNode===l?l0.bind(null,s):null)}function c0(s,i){if(Vo())return null;Gm(s,i,!0)}function Y_(){aS(function(){(Fe&6)!==0?ie(kt,J_):a0()})}function Lu(){if(Ds===0){var s=Vr;s===0&&(s=Ga,Ga<<=1,(Ga&261888)===0&&(Ga=256)),Ds=s}return Ds}function u0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Qa(""+s)}function d0(s,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,s.id&&l.setAttribute("form",s.id),i.parentNode.insertBefore(l,i),s=new FormData(s),l.parentNode.removeChild(l),s}function K_(s,i,l,u,y){if(i==="submit"&&l&&l.stateNode===y){var b=u0((y[Vt]||null).action),S=u.submitter;S&&(i=(i=S[Vt]||null)?u0(i.formAction):S.getAttribute("formAction"),i!==null&&(b=i,S=null));var N=new eo("action","action",null,u,y);s.push({event:N,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(Ds!==0){var U=S?d0(y,S):new FormData(y);ru(l,{pending:!0,data:U,method:y.method,action:b},null,U)}}else typeof b=="function"&&(N.preventDefault(),U=S?d0(y,S):new FormData(y),ru(l,{pending:!0,data:U,method:y.method,action:b},b,U))},currentTarget:y}]})}}for(var qu=0;qu<wc.length;qu++){var Bu=wc[qu],Q_=Bu.toLowerCase(),X_=Bu[0].toUpperCase()+Bu.slice(1);_n(Q_,"on"+X_)}_n(Hh,"onAnimationEnd"),_n(Gh,"onAnimationIteration"),_n(zh,"onAnimationStart"),_n("dblclick","onDoubleClick"),_n("focusin","onFocus"),_n("focusout","onBlur"),_n(h_,"onTransitionRun"),_n(p_,"onTransitionStart"),_n(m_,"onTransitionCancel"),_n(Fh,"onTransitionEnd"),Cr("onMouseEnter",["mouseout","mouseover"]),Cr("onMouseLeave",["mouseout","mouseover"]),Cr("onPointerEnter",["pointerout","pointerover"]),Cr("onPointerLeave",["pointerout","pointerover"]),$s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$s("onBeforeInput",["compositionend","keypress","textInput","paste"]),$s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ga="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),W_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ga));function f0(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var u=s[l],y=u.event;u=u.listeners;e:{var b=void 0;if(i)for(var S=u.length-1;0<=S;S--){var N=u[S],U=N.instance,z=N.currentTarget;if(N=N.listener,U!==b&&y.isPropagationStopped())break e;b=N,y.currentTarget=z;try{b(y)}catch(X){so(X)}y.currentTarget=null,b=U}else for(S=0;S<u.length;S++){if(N=u[S],U=N.instance,z=N.currentTarget,N=N.listener,U!==b&&y.isPropagationStopped())break e;b=N,y.currentTarget=z;try{b(y)}catch(X){so(X)}y.currentTarget=null,b=U}}}}function Ue(s,i){var l=i[Zl];l===void 0&&(l=i[Zl]=new Set);var u=s+"__bubble";l.has(u)||(h0(i,s,2,!1),l.add(u))}function Vu(s,i,l){var u=0;i&&(u|=4),h0(l,s,u,i)}var zo="_reactListening"+Math.random().toString(36).slice(2);function Hu(s){if(!s[zo]){s[zo]=!0,ah.forEach(function(l){l!=="selectionchange"&&(W_.has(l)||Vu(l,!1,s),Vu(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[zo]||(i[zo]=!0,Vu("selectionchange",!1,i))}}function h0(s,i,l,u){switch(H0(i)){case 2:var y=NS;break;case 8:y=CS;break;default:y=sd}l=y.bind(null,i,l,s),y=void 0,!lc||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(y=!0),u?y!==void 0?s.addEventListener(i,l,{capture:!0,passive:y}):s.addEventListener(i,l,!0):y!==void 0?s.addEventListener(i,l,{passive:y}):s.addEventListener(i,l,!1)}function Gu(s,i,l,u,y){var b=u;if((i&1)===0&&(i&2)===0&&u!==null)e:for(;;){if(u===null)return;var S=u.tag;if(S===3||S===4){var N=u.stateNode.containerInfo;if(N===y)break;if(S===4)for(S=u.return;S!==null;){var U=S.tag;if((U===3||U===4)&&S.stateNode.containerInfo===y)return;S=S.return}for(;N!==null;){if(S=Er(N),S===null)return;if(U=S.tag,U===5||U===6||U===26||U===27){u=b=S;continue e}N=N.parentNode}}u=u.return}xh(function(){var z=b,X=ac(l),te=[];e:{var F=$h.get(s);if(F!==void 0){var K=eo,me=s;switch(s){case"keypress":if(Wa(l)===0)break e;case"keydown":case"keyup":K=Fw;break;case"focusin":me="focus",K=fc;break;case"focusout":me="blur",K=fc;break;case"beforeblur":case"afterblur":K=fc;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":K=wh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":K=kw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":K=Yw;break;case Hh:case Gh:case zh:K=jw;break;case Fh:K=Qw;break;case"scroll":case"scrollend":K=Dw;break;case"wheel":K=Ww;break;case"copy":case"cut":case"paste":K=Lw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":K=Sh;break;case"toggle":case"beforetoggle":K=e_}var Se=(i&4)!==0,Xe=!Se&&(s==="scroll"||s==="scrollend"),q=Se?F!==null?F+"Capture":null:F;Se=[];for(var L=z,G;L!==null;){var ee=L;if(G=ee.stateNode,ee=ee.tag,ee!==5&&ee!==26&&ee!==27||G===null||q===null||(ee=Li(L,q),ee!=null&&Se.push(ya(L,ee,G))),Xe)break;L=L.return}0<Se.length&&(F=new K(F,me,null,l,X),te.push({event:F,listeners:Se}))}}if((i&7)===0){e:{if(F=s==="mouseover"||s==="pointerover",K=s==="mouseout"||s==="pointerout",F&&l!==ic&&(me=l.relatedTarget||l.fromElement)&&(Er(me)||me[Sr]))break e;if((K||F)&&(F=X.window===X?X:(F=X.ownerDocument)?F.defaultView||F.parentWindow:window,K?(me=l.relatedTarget||l.toElement,K=z,me=me?Er(me):null,me!==null&&(Xe=o(me),Se=me.tag,me!==Xe||Se!==5&&Se!==27&&Se!==6)&&(me=null)):(K=null,me=z),K!==me)){if(Se=wh,ee="onMouseLeave",q="onMouseEnter",L="mouse",(s==="pointerout"||s==="pointerover")&&(Se=Sh,ee="onPointerLeave",q="onPointerEnter",L="pointer"),Xe=K==null?F:Oi(K),G=me==null?F:Oi(me),F=new Se(ee,L+"leave",K,l,X),F.target=Xe,F.relatedTarget=G,ee=null,Er(X)===z&&(Se=new Se(q,L+"enter",me,l,X),Se.target=G,Se.relatedTarget=Xe,ee=Se),Xe=ee,K&&me)t:{for(Se=Z_,q=K,L=me,G=0,ee=q;ee;ee=Se(ee))G++;ee=0;for(var _e=L;_e;_e=Se(_e))ee++;for(;0<G-ee;)q=Se(q),G--;for(;0<ee-G;)L=Se(L),ee--;for(;G--;){if(q===L||L!==null&&q===L.alternate){Se=q;break t}q=Se(q),L=Se(L)}Se=null}else Se=null;K!==null&&p0(te,F,K,Se,!1),me!==null&&Xe!==null&&p0(te,Xe,me,Se,!0)}}e:{if(F=z?Oi(z):window,K=F.nodeName&&F.nodeName.toLowerCase(),K==="select"||K==="input"&&F.type==="file")var Ve=Dh;else if(Ih(F))if(Mh)Ve=u_;else{Ve=l_;var ge=o_}else K=F.nodeName,!K||K.toLowerCase()!=="input"||F.type!=="checkbox"&&F.type!=="radio"?z&&rc(z.elementType)&&(Ve=Dh):Ve=c_;if(Ve&&(Ve=Ve(s,z))){Rh(te,Ve,l,X);break e}ge&&ge(s,F,z),s==="focusout"&&z&&F.type==="number"&&z.memoizedProps.value!=null&&sc(F,"number",F.value)}switch(ge=z?Oi(z):window,s){case"focusin":(Ih(ge)||ge.contentEditable==="true")&&(kr=ge,xc=z,$i=null);break;case"focusout":$i=xc=kr=null;break;case"mousedown":vc=!0;break;case"contextmenu":case"mouseup":case"dragend":vc=!1,Bh(te,l,X);break;case"selectionchange":if(f_)break;case"keydown":case"keyup":Bh(te,l,X)}var Me;if(pc)e:{switch(s){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else Mr?Ch(s,l)&&(Oe="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(Oe="onCompositionStart");Oe&&(Eh&&l.locale!=="ko"&&(Mr||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&Mr&&(Me=vh()):(ms=X,cc="value"in ms?ms.value:ms.textContent,Mr=!0)),ge=Fo(z,Oe),0<ge.length&&(Oe=new _h(Oe,s,null,l,X),te.push({event:Oe,listeners:ge}),Me?Oe.data=Me:(Me=Ah(l),Me!==null&&(Oe.data=Me)))),(Me=n_?s_(s,l):r_(s,l))&&(Oe=Fo(z,"onBeforeInput"),0<Oe.length&&(ge=new _h("onBeforeInput","beforeinput",null,l,X),te.push({event:ge,listeners:Oe}),ge.data=Me)),K_(te,s,z,l,X)}f0(te,i)})}function ya(s,i,l){return{instance:s,listener:i,currentTarget:l}}function Fo(s,i){for(var l=i+"Capture",u=[];s!==null;){var y=s,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=Li(s,l),y!=null&&u.unshift(ya(s,y,b)),y=Li(s,i),y!=null&&u.push(ya(s,y,b))),s.tag===3)return u;s=s.return}return[]}function Z_(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function p0(s,i,l,u,y){for(var b=i._reactName,S=[];l!==null&&l!==u;){var N=l,U=N.alternate,z=N.stateNode;if(N=N.tag,U!==null&&U===u)break;N!==5&&N!==26&&N!==27||z===null||(U=z,y?(z=Li(l,b),z!=null&&S.unshift(ya(l,z,U))):y||(z=Li(l,b),z!=null&&S.push(ya(l,z,U)))),l=l.return}S.length!==0&&s.push({event:i,listeners:S})}var eS=/\r\n?/g,tS=/\u0000|\uFFFD/g;function m0(s){return(typeof s=="string"?s:""+s).replace(eS,`
`).replace(tS,"")}function g0(s,i){return i=m0(i),m0(s)===i}function Qe(s,i,l,u,y,b){switch(l){case"children":typeof u=="string"?i==="body"||i==="textarea"&&u===""||Ir(s,u):(typeof u=="number"||typeof u=="bigint")&&i!=="body"&&Ir(s,""+u);break;case"className":Ya(s,"class",u);break;case"tabIndex":Ya(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":Ya(s,l,u);break;case"style":gh(s,u,b);break;case"data":if(i!=="object"){Ya(s,"data",u);break}case"src":case"href":if(u===""&&(i!=="a"||l!=="href")){s.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=Qa(""+u),s.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(l==="formAction"?(i!=="input"&&Qe(s,i,"name",y.name,y,null),Qe(s,i,"formEncType",y.formEncType,y,null),Qe(s,i,"formMethod",y.formMethod,y,null),Qe(s,i,"formTarget",y.formTarget,y,null)):(Qe(s,i,"encType",y.encType,y,null),Qe(s,i,"method",y.method,y,null),Qe(s,i,"target",y.target,y,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=Qa(""+u),s.setAttribute(l,u);break;case"onClick":u!=null&&(s.onclick=Hn);break;case"onScroll":u!=null&&Ue("scroll",s);break;case"onScrollEnd":u!=null&&Ue("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(l=u.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}l=Qa(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""+u):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":u===!0?s.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,u):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(l,u):s.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(l):s.setAttribute(l,u);break;case"popover":Ue("beforetoggle",s),Ue("toggle",s),Ja(s,"popover",u);break;case"xlinkActuate":Vn(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Vn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Vn(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Vn(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Vn(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Vn(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Vn(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Vn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Vn(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Ja(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Iw.get(l)||l,Ja(s,l,u))}}function zu(s,i,l,u,y,b){switch(l){case"style":gh(s,u,b);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(l=u.__html,l!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=l}}break;case"children":typeof u=="string"?Ir(s,u):(typeof u=="number"||typeof u=="bigint")&&Ir(s,""+u);break;case"onScroll":u!=null&&Ue("scroll",s);break;case"onScrollEnd":u!=null&&Ue("scrollend",s);break;case"onClick":u!=null&&(s.onclick=Hn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!oh.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),i=l.slice(2,y?l.length-7:void 0),b=s[Vt]||null,b=b!=null?b[l]:null,typeof b=="function"&&s.removeEventListener(i,b,y),typeof u=="function")){typeof b!="function"&&b!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(i,u,y);break e}l in s?s[l]=u:u===!0?s.setAttribute(l,""):Ja(s,l,u)}}}function Rt(s,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ue("error",s),Ue("load",s);var u=!1,y=!1,b;for(b in l)if(l.hasOwnProperty(b)){var S=l[b];if(S!=null)switch(b){case"src":u=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Qe(s,i,b,S,l,null)}}y&&Qe(s,i,"srcSet",l.srcSet,l,null),u&&Qe(s,i,"src",l.src,l,null);return;case"input":Ue("invalid",s);var N=b=S=y=null,U=null,z=null;for(u in l)if(l.hasOwnProperty(u)){var X=l[u];if(X!=null)switch(u){case"name":y=X;break;case"type":S=X;break;case"checked":U=X;break;case"defaultChecked":z=X;break;case"value":b=X;break;case"defaultValue":N=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(r(137,i));break;default:Qe(s,i,u,X,l,null)}}fh(s,b,N,U,z,S,y,!1);return;case"select":Ue("invalid",s),u=S=b=null;for(y in l)if(l.hasOwnProperty(y)&&(N=l[y],N!=null))switch(y){case"value":b=N;break;case"defaultValue":S=N;break;case"multiple":u=N;default:Qe(s,i,y,N,l,null)}i=b,l=S,s.multiple=!!u,i!=null?Ar(s,!!u,i,!1):l!=null&&Ar(s,!!u,l,!0);return;case"textarea":Ue("invalid",s),b=y=u=null;for(S in l)if(l.hasOwnProperty(S)&&(N=l[S],N!=null))switch(S){case"value":u=N;break;case"defaultValue":y=N;break;case"children":b=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(r(91));break;default:Qe(s,i,S,N,l,null)}ph(s,u,y,b);return;case"option":for(U in l)if(l.hasOwnProperty(U)&&(u=l[U],u!=null))switch(U){case"selected":s.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:Qe(s,i,U,u,l,null)}return;case"dialog":Ue("beforetoggle",s),Ue("toggle",s),Ue("cancel",s),Ue("close",s);break;case"iframe":case"object":Ue("load",s);break;case"video":case"audio":for(u=0;u<ga.length;u++)Ue(ga[u],s);break;case"image":Ue("error",s),Ue("load",s);break;case"details":Ue("toggle",s);break;case"embed":case"source":case"link":Ue("error",s),Ue("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(z in l)if(l.hasOwnProperty(z)&&(u=l[z],u!=null))switch(z){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Qe(s,i,z,u,l,null)}return;default:if(rc(i)){for(X in l)l.hasOwnProperty(X)&&(u=l[X],u!==void 0&&zu(s,i,X,u,l,void 0));return}}for(N in l)l.hasOwnProperty(N)&&(u=l[N],u!=null&&Qe(s,i,N,u,l,null))}function nS(s,i,l,u){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,S=null,N=null,U=null,z=null,X=null;for(K in l){var te=l[K];if(l.hasOwnProperty(K)&&te!=null)switch(K){case"checked":break;case"value":break;case"defaultValue":U=te;default:u.hasOwnProperty(K)||Qe(s,i,K,null,u,te)}}for(var F in u){var K=u[F];if(te=l[F],u.hasOwnProperty(F)&&(K!=null||te!=null))switch(F){case"type":b=K;break;case"name":y=K;break;case"checked":z=K;break;case"defaultChecked":X=K;break;case"value":S=K;break;case"defaultValue":N=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(r(137,i));break;default:K!==te&&Qe(s,i,F,K,u,te)}}nc(s,S,N,U,z,X,b,y);return;case"select":K=S=N=F=null;for(b in l)if(U=l[b],l.hasOwnProperty(b)&&U!=null)switch(b){case"value":break;case"multiple":K=U;default:u.hasOwnProperty(b)||Qe(s,i,b,null,u,U)}for(y in u)if(b=u[y],U=l[y],u.hasOwnProperty(y)&&(b!=null||U!=null))switch(y){case"value":F=b;break;case"defaultValue":N=b;break;case"multiple":S=b;default:b!==U&&Qe(s,i,y,b,u,U)}i=N,l=S,u=K,F!=null?Ar(s,!!l,F,!1):!!u!=!!l&&(i!=null?Ar(s,!!l,i,!0):Ar(s,!!l,l?[]:"",!1));return;case"textarea":K=F=null;for(N in l)if(y=l[N],l.hasOwnProperty(N)&&y!=null&&!u.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:Qe(s,i,N,null,u,y)}for(S in u)if(y=u[S],b=l[S],u.hasOwnProperty(S)&&(y!=null||b!=null))switch(S){case"value":F=y;break;case"defaultValue":K=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==b&&Qe(s,i,S,y,u,b)}hh(s,F,K);return;case"option":for(var me in l)if(F=l[me],l.hasOwnProperty(me)&&F!=null&&!u.hasOwnProperty(me))switch(me){case"selected":s.selected=!1;break;default:Qe(s,i,me,null,u,F)}for(U in u)if(F=u[U],K=l[U],u.hasOwnProperty(U)&&F!==K&&(F!=null||K!=null))switch(U){case"selected":s.selected=F&&typeof F!="function"&&typeof F!="symbol";break;default:Qe(s,i,U,F,u,K)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Se in l)F=l[Se],l.hasOwnProperty(Se)&&F!=null&&!u.hasOwnProperty(Se)&&Qe(s,i,Se,null,u,F);for(z in u)if(F=u[z],K=l[z],u.hasOwnProperty(z)&&F!==K&&(F!=null||K!=null))switch(z){case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(r(137,i));break;default:Qe(s,i,z,F,u,K)}return;default:if(rc(i)){for(var Xe in l)F=l[Xe],l.hasOwnProperty(Xe)&&F!==void 0&&!u.hasOwnProperty(Xe)&&zu(s,i,Xe,void 0,u,F);for(X in u)F=u[X],K=l[X],!u.hasOwnProperty(X)||F===K||F===void 0&&K===void 0||zu(s,i,X,F,u,K);return}}for(var q in l)F=l[q],l.hasOwnProperty(q)&&F!=null&&!u.hasOwnProperty(q)&&Qe(s,i,q,null,u,F);for(te in u)F=u[te],K=l[te],!u.hasOwnProperty(te)||F===K||F==null&&K==null||Qe(s,i,te,F,u,K)}function y0(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function sS(){if(typeof performance.getEntriesByType=="function"){for(var s=0,i=0,l=performance.getEntriesByType("resource"),u=0;u<l.length;u++){var y=l[u],b=y.transferSize,S=y.initiatorType,N=y.duration;if(b&&N&&y0(S)){for(S=0,N=y.responseEnd,u+=1;u<l.length;u++){var U=l[u],z=U.startTime;if(z>N)break;var X=U.transferSize,te=U.initiatorType;X&&y0(te)&&(U=U.responseEnd,S+=X*(U<N?1:(N-z)/(U-z)))}if(--u,i+=8*(b+S)/(y.duration/1e3),s++,10<s)break}}if(0<s)return i/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Fu=null,$u=null;function $o(s){return s.nodeType===9?s:s.ownerDocument}function x0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function v0(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function Ju(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Yu=null;function rS(){var s=window.event;return s&&s.type==="popstate"?s===Yu?!1:(Yu=s,!0):(Yu=null,!1)}var b0=typeof setTimeout=="function"?setTimeout:void 0,iS=typeof clearTimeout=="function"?clearTimeout:void 0,w0=typeof Promise=="function"?Promise:void 0,aS=typeof queueMicrotask=="function"?queueMicrotask:typeof w0<"u"?function(s){return w0.resolve(null).then(s).catch(oS)}:b0;function oS(s){setTimeout(function(){throw s})}function Ms(s){return s==="head"}function _0(s,i){var l=i,u=0;do{var y=l.nextSibling;if(s.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(u===0){s.removeChild(y),ai(i);return}u--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")u++;else if(l==="html")xa(s.ownerDocument.documentElement);else if(l==="head"){l=s.ownerDocument.head,xa(l);for(var b=l.firstChild;b;){var S=b.nextSibling,N=b.nodeName;b[ji]||N==="SCRIPT"||N==="STYLE"||N==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=S}}else l==="body"&&xa(s.ownerDocument.body);l=y}while(l);ai(i)}function S0(s,i){var l=s;s=0;do{var u=l.nextSibling;if(l.nodeType===1?i?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(i?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),u&&u.nodeType===8)if(l=u.data,l==="/$"){if(s===0)break;s--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||s++;l=u}while(l)}function Ku(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Ku(l),ec(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function lS(s,i,l,u){for(;s.nodeType===1;){var y=l;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[ji])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(b=s.getAttribute("rel"),b==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(b!==y.rel||s.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||s.getAttribute("title")!==(y.title==null?null:y.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(b=s.getAttribute("src"),(b!==(y.src==null?null:y.src)||s.getAttribute("type")!==(y.type==null?null:y.type)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&s.getAttribute("name")===b)return s}else return s;if(s=yn(s.nextSibling),s===null)break}return null}function cS(s,i,l){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=yn(s.nextSibling),s===null))return null;return s}function E0(s,i){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!i||(s=yn(s.nextSibling),s===null))return null;return s}function Qu(s){return s.data==="$?"||s.data==="$~"}function Xu(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function uS(s,i){var l=s.ownerDocument;if(s.data==="$~")s._reactRetry=i;else if(s.data!=="$?"||l.readyState!=="loading")i();else{var u=function(){i(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),s._reactRetry=u}}function yn(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return s}var Wu=null;function T0(s){s=s.nextSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"||l==="/&"){if(i===0)return yn(s.nextSibling);i--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||i++}s=s.nextSibling}return null}function N0(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(i===0)return s;i--}else l!=="/$"&&l!=="/&"||i++}s=s.previousSibling}return null}function C0(s,i,l){switch(i=$o(l),s){case"html":if(s=i.documentElement,!s)throw Error(r(452));return s;case"head":if(s=i.head,!s)throw Error(r(453));return s;case"body":if(s=i.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function xa(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);ec(s)}var xn=new Map,A0=new Set;function Jo(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var rs=O.d;O.d={f:dS,r:fS,D:hS,C:pS,L:mS,m:gS,X:xS,S:yS,M:vS};function dS(){var s=rs.f(),i=Lo();return s||i}function fS(s){var i=Tr(s);i!==null&&i.tag===5&&i.type==="form"?Fp(i):rs.r(s)}var si=typeof document>"u"?null:document;function I0(s,i,l){var u=si;if(u&&typeof i=="string"&&i){var y=un(i);y='link[rel="'+s+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),A0.has(y)||(A0.add(y),s={rel:s,crossOrigin:l,href:i},u.querySelector(y)===null&&(i=u.createElement("link"),Rt(i,"link",s),_t(i),u.head.appendChild(i)))}}function hS(s){rs.D(s),I0("dns-prefetch",s,null)}function pS(s,i){rs.C(s,i),I0("preconnect",s,i)}function mS(s,i,l){rs.L(s,i,l);var u=si;if(u&&s&&i){var y='link[rel="preload"][as="'+un(i)+'"]';i==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+un(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+un(l.imageSizes)+'"]')):y+='[href="'+un(s)+'"]';var b=y;switch(i){case"style":b=ri(s);break;case"script":b=ii(s)}xn.has(b)||(s=v({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:s,as:i},l),xn.set(b,s),u.querySelector(y)!==null||i==="style"&&u.querySelector(va(b))||i==="script"&&u.querySelector(ba(b))||(i=u.createElement("link"),Rt(i,"link",s),_t(i),u.head.appendChild(i)))}}function gS(s,i){rs.m(s,i);var l=si;if(l&&s){var u=i&&typeof i.as=="string"?i.as:"script",y='link[rel="modulepreload"][as="'+un(u)+'"][href="'+un(s)+'"]',b=y;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=ii(s)}if(!xn.has(b)&&(s=v({rel:"modulepreload",href:s},i),xn.set(b,s),l.querySelector(y)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(ba(b)))return}u=l.createElement("link"),Rt(u,"link",s),_t(u),l.head.appendChild(u)}}}function yS(s,i,l){rs.S(s,i,l);var u=si;if(u&&s){var y=Nr(u).hoistableStyles,b=ri(s);i=i||"default";var S=y.get(b);if(!S){var N={loading:0,preload:null};if(S=u.querySelector(va(b)))N.loading=5;else{s=v({rel:"stylesheet",href:s,"data-precedence":i},l),(l=xn.get(b))&&Zu(s,l);var U=S=u.createElement("link");_t(U),Rt(U,"link",s),U._p=new Promise(function(z,X){U.onload=z,U.onerror=X}),U.addEventListener("load",function(){N.loading|=1}),U.addEventListener("error",function(){N.loading|=2}),N.loading|=4,Yo(S,i,u)}S={type:"stylesheet",instance:S,count:1,state:N},y.set(b,S)}}}function xS(s,i){rs.X(s,i);var l=si;if(l&&s){var u=Nr(l).hoistableScripts,y=ii(s),b=u.get(y);b||(b=l.querySelector(ba(y)),b||(s=v({src:s,async:!0},i),(i=xn.get(y))&&ed(s,i),b=l.createElement("script"),_t(b),Rt(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},u.set(y,b))}}function vS(s,i){rs.M(s,i);var l=si;if(l&&s){var u=Nr(l).hoistableScripts,y=ii(s),b=u.get(y);b||(b=l.querySelector(ba(y)),b||(s=v({src:s,async:!0,type:"module"},i),(i=xn.get(y))&&ed(s,i),b=l.createElement("script"),_t(b),Rt(b,"link",s),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},u.set(y,b))}}function R0(s,i,l,u){var y=(y=he.current)?Jo(y):null;if(!y)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=ri(l.href),l=Nr(y).hoistableStyles,u=l.get(i),u||(u={type:"style",instance:null,count:0,state:null},l.set(i,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=ri(l.href);var b=Nr(y).hoistableStyles,S=b.get(s);if(S||(y=y.ownerDocument||y,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(s,S),(b=y.querySelector(va(s)))&&!b._p&&(S.instance=b,S.state.loading=5),xn.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},xn.set(s,l),b||bS(y,s,l,S.state))),i&&u===null)throw Error(r(528,""));return S}if(i&&u!==null)throw Error(r(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=ii(l),l=Nr(y).hoistableScripts,u=l.get(i),u||(u={type:"script",instance:null,count:0,state:null},l.set(i,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function ri(s){return'href="'+un(s)+'"'}function va(s){return'link[rel="stylesheet"]['+s+"]"}function D0(s){return v({},s,{"data-precedence":s.precedence,precedence:null})}function bS(s,i,l,u){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?u.loading=1:(i=s.createElement("link"),u.preload=i,i.addEventListener("load",function(){return u.loading|=1}),i.addEventListener("error",function(){return u.loading|=2}),Rt(i,"link",l),_t(i),s.head.appendChild(i))}function ii(s){return'[src="'+un(s)+'"]'}function ba(s){return"script[async]"+s}function M0(s,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var u=s.querySelector('style[data-href~="'+un(l.href)+'"]');if(u)return i.instance=u,_t(u),u;var y=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),_t(u),Rt(u,"style",y),Yo(u,l.precedence,s),i.instance=u;case"stylesheet":y=ri(l.href);var b=s.querySelector(va(y));if(b)return i.state.loading|=4,i.instance=b,_t(b),b;u=D0(l),(y=xn.get(y))&&Zu(u,y),b=(s.ownerDocument||s).createElement("link"),_t(b);var S=b;return S._p=new Promise(function(N,U){S.onload=N,S.onerror=U}),Rt(b,"link",u),i.state.loading|=4,Yo(b,l.precedence,s),i.instance=b;case"script":return b=ii(l.src),(y=s.querySelector(ba(b)))?(i.instance=y,_t(y),y):(u=l,(y=xn.get(b))&&(u=v({},l),ed(u,y)),s=s.ownerDocument||s,y=s.createElement("script"),_t(y),Rt(y,"link",u),s.head.appendChild(y),i.instance=y);case"void":return null;default:throw Error(r(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(u=i.instance,i.state.loading|=4,Yo(u,l.precedence,s));return i.instance}function Yo(s,i,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=u.length?u[u.length-1]:null,b=y,S=0;S<u.length;S++){var N=u[S];if(N.dataset.precedence===i)b=N;else if(b!==y)break}b?b.parentNode.insertBefore(s,b.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(s,i.firstChild))}function Zu(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function ed(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var Ko=null;function k0(s,i,l){if(Ko===null){var u=new Map,y=Ko=new Map;y.set(l,u)}else y=Ko,u=y.get(l),u||(u=new Map,y.set(l,u));if(u.has(s))return u;for(u.set(s,null),l=l.getElementsByTagName(s),y=0;y<l.length;y++){var b=l[y];if(!(b[ji]||b[Nt]||s==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var S=b.getAttribute(i)||"";S=s+S;var N=u.get(S);N?N.push(b):u.set(S,[b])}}return u}function P0(s,i,l){s=s.ownerDocument||s,s.head.insertBefore(l,i==="title"?s.querySelector("head > title"):null)}function wS(s,i,l){if(l===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function U0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function _S(s,i,l,u){if(l.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=ri(u.href),b=i.querySelector(va(y));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(s.count++,s=Qo.bind(s),i.then(s,s)),l.state.loading|=4,l.instance=b,_t(b);return}b=i.ownerDocument||i,u=D0(u),(y=xn.get(y))&&Zu(u,y),b=b.createElement("link"),_t(b);var S=b;S._p=new Promise(function(N,U){S.onload=N,S.onerror=U}),Rt(b,"link",u),l.instance=b}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(l,i),(i=l.state.preload)&&(l.state.loading&3)===0&&(s.count++,l=Qo.bind(s),i.addEventListener("load",l),i.addEventListener("error",l))}}var td=0;function SS(s,i){return s.stylesheets&&s.count===0&&Wo(s,s.stylesheets),0<s.count||0<s.imgCount?function(l){var u=setTimeout(function(){if(s.stylesheets&&Wo(s,s.stylesheets),s.unsuspend){var b=s.unsuspend;s.unsuspend=null,b()}},6e4+i);0<s.imgBytes&&td===0&&(td=62500*sS());var y=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Wo(s,s.stylesheets),s.unsuspend)){var b=s.unsuspend;s.unsuspend=null,b()}},(s.imgBytes>td?50:800)+i);return s.unsuspend=l,function(){s.unsuspend=null,clearTimeout(u),clearTimeout(y)}}:null}function Qo(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Wo(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Xo=null;function Wo(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Xo=new Map,i.forEach(ES,s),Xo=null,Qo.call(s))}function ES(s,i){if(!(i.state.loading&4)){var l=Xo.get(s);if(l)var u=l.get(null);else{l=new Map,Xo.set(s,l);for(var y=s.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var S=y[b];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(l.set(S.dataset.precedence,S),u=S)}u&&l.set(null,u)}y=i.instance,S=y.getAttribute("data-precedence"),b=l.get(S)||u,b===u&&l.set(null,y),l.set(S,y),this.count++,u=Qo.bind(this),y.addEventListener("load",u),y.addEventListener("error",u),b?b.parentNode.insertBefore(y,b.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(y,s.firstChild)),i.state.loading|=4}}var wa={$$typeof:C,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function TS(s,i,l,u,y,b,S,N,U){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ql(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ql(0),this.hiddenUpdates=Ql(null),this.identifierPrefix=u,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function j0(s,i,l,u,y,b,S,N,U,z,X,te){return s=new TS(s,i,l,S,U,z,X,te,N),i=1,b===!0&&(i|=24),b=Xt(3,null,null,i),s.current=b,b.stateNode=s,i=Pc(),i.refCount++,s.pooledCache=i,i.refCount++,b.memoizedState={element:u,isDehydrated:l,cache:i},Lc(b),s}function O0(s){return s?(s=jr,s):jr}function L0(s,i,l,u,y,b){y=O0(y),u.context===null?u.context=y:u.pendingContext=y,u=ws(i),u.payload={element:l},b=b===void 0?null:b,b!==null&&(u.callback=b),l=_s(s,u,i),l!==null&&(Jt(l,s,i),Zi(l,s,i))}function q0(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function nd(s,i){q0(s,i),(s=s.alternate)&&q0(s,i)}function B0(s){if(s.tag===13||s.tag===31){var i=Qs(s,67108864);i!==null&&Jt(i,s,67108864),nd(s,67108864)}}function V0(s){if(s.tag===13||s.tag===31){var i=nn();i=Xl(i);var l=Qs(s,i);l!==null&&Jt(l,s,i),nd(s,i)}}var Zo=!0;function NS(s,i,l,u){var y=R.T;R.T=null;var b=O.p;try{O.p=2,sd(s,i,l,u)}finally{O.p=b,R.T=y}}function CS(s,i,l,u){var y=R.T;R.T=null;var b=O.p;try{O.p=8,sd(s,i,l,u)}finally{O.p=b,R.T=y}}function sd(s,i,l,u){if(Zo){var y=rd(u);if(y===null)Gu(s,i,u,el,l),G0(s,u);else if(IS(y,s,i,l,u))u.stopPropagation();else if(G0(s,u),i&4&&-1<AS.indexOf(s)){for(;y!==null;){var b=Tr(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var S=Fs(b.pendingLanes);if(S!==0){var N=b;for(N.pendingLanes|=2,N.entangledLanes|=2;S;){var U=1<<31-Kt(S);N.entanglements[1]|=U,S&=~U}Ln(b),(Fe&6)===0&&(jo=pt()+500,ma(0))}}break;case 31:case 13:N=Qs(b,2),N!==null&&Jt(N,b,2),Lo(),nd(b,2)}if(b=rd(u),b===null&&Gu(s,i,u,el,l),b===y)break;y=b}y!==null&&u.stopPropagation()}else Gu(s,i,u,null,l)}}function rd(s){return s=ac(s),id(s)}var el=null;function id(s){if(el=null,s=Er(s),s!==null){var i=o(s);if(i===null)s=null;else{var l=i.tag;if(l===13){if(s=c(i),s!==null)return s;s=null}else if(l===31){if(s=d(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return el=s,null}function H0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ke()){case kt:return 2;case Pn:return 8;case _r:case Kl:return 32;case Wf:return 268435456;default:return 32}default:return 32}}var ad=!1,ks=null,Ps=null,Us=null,_a=new Map,Sa=new Map,js=[],AS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function G0(s,i){switch(s){case"focusin":case"focusout":ks=null;break;case"dragenter":case"dragleave":Ps=null;break;case"mouseover":case"mouseout":Us=null;break;case"pointerover":case"pointerout":_a.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Sa.delete(i.pointerId)}}function Ea(s,i,l,u,y,b){return s===null||s.nativeEvent!==b?(s={blockedOn:i,domEventName:l,eventSystemFlags:u,nativeEvent:b,targetContainers:[y]},i!==null&&(i=Tr(i),i!==null&&B0(i)),s):(s.eventSystemFlags|=u,i=s.targetContainers,y!==null&&i.indexOf(y)===-1&&i.push(y),s)}function IS(s,i,l,u,y){switch(i){case"focusin":return ks=Ea(ks,s,i,l,u,y),!0;case"dragenter":return Ps=Ea(Ps,s,i,l,u,y),!0;case"mouseover":return Us=Ea(Us,s,i,l,u,y),!0;case"pointerover":var b=y.pointerId;return _a.set(b,Ea(_a.get(b)||null,s,i,l,u,y)),!0;case"gotpointercapture":return b=y.pointerId,Sa.set(b,Ea(Sa.get(b)||null,s,i,l,u,y)),!0}return!1}function z0(s){var i=Er(s.target);if(i!==null){var l=o(i);if(l!==null){if(i=l.tag,i===13){if(i=c(l),i!==null){s.blockedOn=i,rh(s.priority,function(){V0(l)});return}}else if(i===31){if(i=d(l),i!==null){s.blockedOn=i,rh(s.priority,function(){V0(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function tl(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=rd(s.nativeEvent);if(l===null){l=s.nativeEvent;var u=new l.constructor(l.type,l);ic=u,l.target.dispatchEvent(u),ic=null}else return i=Tr(l),i!==null&&B0(i),s.blockedOn=l,!1;i.shift()}return!0}function F0(s,i,l){tl(s)&&l.delete(i)}function RS(){ad=!1,ks!==null&&tl(ks)&&(ks=null),Ps!==null&&tl(Ps)&&(Ps=null),Us!==null&&tl(Us)&&(Us=null),_a.forEach(F0),Sa.forEach(F0)}function nl(s,i){s.blockedOn===i&&(s.blockedOn=null,ad||(ad=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,RS)))}var sl=null;function $0(s){sl!==s&&(sl=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){sl===s&&(sl=null);for(var i=0;i<s.length;i+=3){var l=s[i],u=s[i+1],y=s[i+2];if(typeof u!="function"){if(id(u||l)===null)continue;break}var b=Tr(l);b!==null&&(s.splice(i,3),i-=3,ru(b,{pending:!0,data:y,method:l.method,action:u},u,y))}}))}function ai(s){function i(U){return nl(U,s)}ks!==null&&nl(ks,s),Ps!==null&&nl(Ps,s),Us!==null&&nl(Us,s),_a.forEach(i),Sa.forEach(i);for(var l=0;l<js.length;l++){var u=js[l];u.blockedOn===s&&(u.blockedOn=null)}for(;0<js.length&&(l=js[0],l.blockedOn===null);)z0(l),l.blockedOn===null&&js.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var y=l[u],b=l[u+1],S=y[Vt]||null;if(typeof b=="function")S||$0(l);else if(S){var N=null;if(b&&b.hasAttribute("formAction")){if(y=b,S=b[Vt]||null)N=S.formAction;else if(id(y)!==null)continue}else N=S.action;typeof N=="function"?l[u+1]=N:(l.splice(u,3),u-=3),$0(l)}}}function J0(){function s(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(S){return y=S})},focusReset:"manual",scroll:"manual"})}function i(){y!==null&&(y(),y=null),u||setTimeout(l,20)}function l(){if(!u&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,y=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(l,100),function(){u=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),y!==null&&(y(),y=null)}}}function od(s){this._internalRoot=s}rl.prototype.render=od.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(r(409));var l=i.current,u=nn();L0(l,u,s,i,null,null)},rl.prototype.unmount=od.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;L0(s.current,2,null,s,null,null),Lo(),i[Sr]=null}};function rl(s){this._internalRoot=s}rl.prototype.unstable_scheduleHydration=function(s){if(s){var i=sh();s={blockedOn:null,target:s,priority:i};for(var l=0;l<js.length&&i!==0&&i<js[l].priority;l++);js.splice(l,0,s),l===0&&z0(s)}};var Y0=e.version;if(Y0!=="19.2.0")throw Error(r(527,Y0,"19.2.0"));O.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=h(i),s=s!==null?x(s):null,s=s===null?null:s.stateNode,s};var DS={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!il.isDisabled&&il.supportsFiber)try{ki=il.inject(DS),Yt=il}catch{}}return Na.createRoot=function(s,i){if(!a(s))throw Error(r(299));var l=!1,u="",y=tm,b=nm,S=sm;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onUncaughtError!==void 0&&(y=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(S=i.onRecoverableError)),i=j0(s,1,!1,null,null,l,u,null,y,b,S,J0),s[Sr]=i.current,Hu(s),new od(i)},Na.hydrateRoot=function(s,i,l){if(!a(s))throw Error(r(299));var u=!1,y="",b=tm,S=nm,N=sm,U=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(S=l.onCaughtError),l.onRecoverableError!==void 0&&(N=l.onRecoverableError),l.formState!==void 0&&(U=l.formState)),i=j0(s,1,!0,i,l??null,u,y,U,b,S,N,J0),i.context=O0(null),l=i.current,u=nn(),u=Xl(u),y=ws(u),y.callback=null,_s(l,y,u),l=u,i.current.lanes=l,Ui(i,l),Ln(i),s[Sr]=i.current,Hu(s),new rl(i)},Na.version="19.2.0",Na}var rg;function GS(){if(rg)return ud.exports;rg=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),ud.exports=HS(),ud.exports}var zS=GS();const FS=cf(zS);var bl={isNone:function(){return!0},orElse:function(t){return t},orCall:function(t){return t()},orNull:function(){return null},orThrow:function(t){throw t===void 0&&(t="Unexpected null value"),new TypeError(t)},map:function(){return bl},get:function(){return bl}},_x=(function(){function t(e){this.value=e}return t.prototype.isNone=function(){return!1},t.prototype.orElse=function(){return this.value},t.prototype.orCall=function(){return this.value},t.prototype.orNull=function(){return this.value},t.prototype.orThrow=function(){return this.value},t.prototype.map=function(e){return ve(e(this.value))},t.prototype.get=function(e){return this.map(function(n){return n[e]})},t})();function $S(t){return t===bl||t instanceof _x}function ve(t){return $S(t)?t:t==null?bl:JS(t)}function JS(t){if(t==null)throw new TypeError("some() does not accept null or undefined");return new _x(t)}let wl=class extends Error{constructor(e){super(e.statusText),Object.setPrototypeOf(this,new.target.prototype),this.headers=e.headers,this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.data=e.data}},Rd,Sx;"rawJSON"in JSON&&(Rd=function(t,e,n){if(Number.isInteger(e)&&!Number.isSafeInteger(e))try{return BigInt(n.source)}catch{return e}return e},Sx=function(t,e){return typeof e=="bigint"?JSON.rawJSON(String(e)):e});const df=t=>t==="post"||t==="put"||t==="patch"||t==="delete";function YS(t){const e=[],n=(r,a)=>`${encodeURIComponent(r)}=${encodeURIComponent(String(a))}`;return Object.keys(t).forEach(r=>{const a=t[r];a!=null&&(Array.isArray(a)?a.forEach(o=>e.push(n(r,o))):e.push(n(r,a)))}),e.length>0?`?${e.join("&")}`:""}function KS(t,e){return t.replace(/\{([^}]+)\}/g,(n,r)=>{const a=encodeURIComponent(e[r]);return delete e[r],a})}function QS(t,e,n){let r={};return df(t)?n.forEach(a=>{r[a]=e[a],delete e[a]}):r={...e},YS(r)}function XS(t,e){const n=new Headers(e);return t!==void 0&&!(t instanceof FormData)&&!n.has("Content-Type")&&n.append("Content-Type","application/json"),n.has("Accept")||n.append("Accept","application/json"),n}function WS(t,e){if(!df(t))return;const n=e instanceof FormData?e:JSON.stringify(e,Sx);return t==="delete"&&n==="{}"?void 0:n}function ZS(t,e){const n=new Headers(t==null?void 0:t.headers),r=new Headers(e==null?void 0:e.headers);for(const a of r.keys()){const o=r.get(a);o!=null&&n.set(a,o)}return{...t,...e,headers:n}}function eE(t){var p,h;const e=Object.assign(Array.isArray(t.payload)?[]:{},t.payload),n=KS(t.path,e),r=QS(t.method,e,t.queryParams),a=WS(t.method,e),o=df(t.method)?XS(a,(p=t.init)==null?void 0:p.headers):new Headers((h=t.init)==null?void 0:h.headers),c=t.baseUrl+n+r,d={...t.init,method:t.method.toUpperCase(),headers:o,body:a};return{url:c,init:d}}async function tE(t){if(t.status===204)return;const e=t.headers.get("content-type"),n=await t.text();if(e&&e.includes("application/json"))return JSON.parse(n,Rd);try{return JSON.parse(n,Rd)}catch{return n}}async function nE(t,e){const n=await fetch(t,e),r=await tE(n),a={headers:n.headers,url:n.url,ok:n.ok,status:n.status,statusText:n.statusText,data:r};if(a.ok)return a;throw new wl(a)}function sE(t,e){const n=async(r,a,o)=>{if(t==null||r===t.length)return e(a,o);const c=t[r];return await c(a,o,(d,p)=>n(r+1,d,p))};return(r,a)=>n(0,r,a)}async function rE(t){const{url:e,init:n}=eE(t);return await t.fetch(e,n)}function iE(t){const e=async(n,r)=>{try{return await t(n,r)}catch(a){throw a instanceof wl?new e.Error(a):a}};return e.Error=class extends wl{constructor(n){super(n),Object.setPrototypeOf(this,new.target.prototype)}getActualType(){return{status:this.status,data:this.data}}},e}function aE(){let t="",e={};const n=[],r=sE(n,nE);return{configure:a=>{t=a.baseUrl||"",e=a.init||{},n.splice(0),n.push(...a.use||[])},use:a=>n.push(a),path:a=>({method:o=>({create:(c=>iE((d,p)=>rE({baseUrl:t||"",path:a,method:o,queryParams:Object.keys(c||{}),payload:d,init:ZS(e,p),fetch:r})))})})}}const oE={for:()=>aE()},lE=200;class ka extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class ff extends ka{static forResponse(e){const n=`${e.status}`,r=e.statusText?`(${e.statusText})`:"(Unrecognized Status Code)",a=`${n} ${r}`.trim(),o=e.data?JSON.stringify(e.data,null,2):null;let c="";o&&(c=o.length<=lE?o:o.slice(0,-4)+" ...");const d=`Raw response content:
${c}`;return new ff(`Unexpected Response: ${a}
${d}`)}}class al extends ka{}class cE extends ka{}class uE extends ka{constructor(e,n){super(e);const r=Number(n);if(isNaN(r))throw new ka(`Invalid retryAfter value: ${n}`);this.retry_after=r,Object.setPrototypeOf(this,new.target.prototype)}}function dE(t){return{createShardKey:t.path("/collections/{collection_name}/shards").method("put").create({timeout:!0}),deleteShardKey:t.path("/collections/{collection_name}/shards/delete").method("post").create({timeout:!0}),root:t.path("/").method("get").create(),telemetry:t.path("/telemetry").method("get").create(),metrics:t.path("/metrics").method("get").create(),getLocks:t.path("/locks").method("get").create(),postLocks:t.path("/locks").method("post").create(),healthz:t.path("/healthz").method("get").create(),livez:t.path("/livez").method("get").create(),readyz:t.path("/readyz").method("get").create(),getIssues:t.path("/issues").method("get").create(),clearIssues:t.path("/issues").method("delete").create(),clusterStatus:t.path("/cluster").method("get").create(),recoverCurrentPeer:t.path("/cluster/recover").method("post").create(),removePeer:t.path("/cluster/peer/{peer_id}").method("delete").create({force:!0}),getCollections:t.path("/collections").method("get").create(),getCollection:t.path("/collections/{collection_name}").method("get").create(),createCollection:t.path("/collections/{collection_name}").method("put").create({timeout:!0}),deleteCollection:t.path("/collections/{collection_name}").method("delete").create({timeout:!0}),updateCollection:t.path("/collections/{collection_name}").method("patch").create({timeout:!0}),updateAliases:t.path("/collections/aliases").method("post").create({timeout:!0}),createFieldIndex:t.path("/collections/{collection_name}/index").method("put").create({wait:!0,ordering:!0}),collectionExists:t.path("/collections/{collection_name}/exists").method("get").create(),deleteFieldIndex:t.path("/collections/{collection_name}/index/{field_name}").method("delete").create({wait:!0,ordering:!0}),collectionClusterInfo:t.path("/collections/{collection_name}/cluster").method("get").create(),updateCollectionCluster:t.path("/collections/{collection_name}/cluster").method("post").create({timeout:!0}),getCollectionAliases:t.path("/collections/{collection_name}/aliases").method("get").create(),getCollectionsAliases:t.path("/aliases").method("get").create(),recoverFromUploadedSnapshot:t.path("/collections/{collection_name}/snapshots/upload").method("post").create({wait:!0,priority:!0,checksum:!0}),recoverFromSnapshot:t.path("/collections/{collection_name}/snapshots/recover").method("put").create({wait:!0}),listSnapshots:t.path("/collections/{collection_name}/snapshots").method("get").create(),createSnapshot:t.path("/collections/{collection_name}/snapshots").method("post").create({wait:!0}),getSnapshot:t.path("/collections/{collection_name}/snapshots/{snapshot_name}").method("get").create(),deleteSnapshot:t.path("/collections/{collection_name}/snapshots/{snapshot_name}").method("delete").create({wait:!0}),listFullSnapshots:t.path("/snapshots").method("get").create(),createFullSnapshot:t.path("/snapshots").method("post").create({wait:!0}),getFullSnapshot:t.path("/snapshots/{snapshot_name}").method("get").create(),deleteFullSnapshot:t.path("/snapshots/{snapshot_name}").method("delete").create({wait:!0}),recoverShardFromUploadedSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/upload").method("post").create({wait:!0,priority:!0,checksum:!0}),recoverShardFromSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/recover").method("put").create({wait:!0}),listShardSnapshots:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots").method("get").create(),createShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots").method("post").create({wait:!0}),getShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/{snapshot_name}").method("get").create(),deleteShardSnapshot:t.path("/collections/{collection_name}/shards/{shard_id}/snapshots/{snapshot_name}").method("delete").create({wait:!0}),getPoint:t.path("/collections/{collection_name}/points/{id}").method("get").create(),upsertPoints:t.path("/collections/{collection_name}/points").method("put").create({wait:!0,ordering:!0}),getPoints:t.path("/collections/{collection_name}/points").method("post").create({consistency:!0,timeout:!0}),deletePoints:t.path("/collections/{collection_name}/points/delete").method("post").create({wait:!0,ordering:!0}),updateVectors:t.path("/collections/{collection_name}/points/vectors").method("put").create({wait:!0,ordering:!0}),deleteVectors:t.path("/collections/{collection_name}/points/vectors/delete").method("post").create({wait:!0,ordering:!0}),overwritePayload:t.path("/collections/{collection_name}/points/payload").method("put").create({wait:!0,ordering:!0}),setPayload:t.path("/collections/{collection_name}/points/payload").method("post").create({wait:!0,ordering:!0}),deletePayload:t.path("/collections/{collection_name}/points/payload/delete").method("post").create({wait:!0,ordering:!0}),clearPayload:t.path("/collections/{collection_name}/points/payload/clear").method("post").create({wait:!0,ordering:!0}),batchUpdate:t.path("/collections/{collection_name}/points/batch").method("post").create({wait:!0,ordering:!0}),scrollPoints:t.path("/collections/{collection_name}/points/scroll").method("post").create({consistency:!0,timeout:!0}),searchPoints:t.path("/collections/{collection_name}/points/search").method("post").create({consistency:!0,timeout:!0}),searchBatchPoints:t.path("/collections/{collection_name}/points/search/batch").method("post").create({consistency:!0,timeout:!0}),searchPointGroups:t.path("/collections/{collection_name}/points/search/groups").method("post").create({consistency:!0,timeout:!0}),recommendPoints:t.path("/collections/{collection_name}/points/recommend").method("post").create({consistency:!0,timeout:!0}),recommendBatchPoints:t.path("/collections/{collection_name}/points/recommend/batch").method("post").create({consistency:!0,timeout:!0}),recommendPointGroups:t.path("/collections/{collection_name}/points/recommend/groups").method("post").create({consistency:!0,timeout:!0}),discoverPoints:t.path("/collections/{collection_name}/points/discover").method("post").create({consistency:!0,timeout:!0}),discoverBatchPoints:t.path("/collections/{collection_name}/points/discover/batch").method("post").create({consistency:!0,timeout:!0}),countPoints:t.path("/collections/{collection_name}/points/count").method("post").create({timeout:!0}),facet:t.path("/collections/{collection_name}/facet").method("post").create({timeout:!0,consistency:!0}),queryPoints:t.path("/collections/{collection_name}/points/query").method("post").create({consistency:!0,timeout:!0}),queryBatchPoints:t.path("/collections/{collection_name}/points/query/batch").method("post").create({consistency:!0,timeout:!0}),queryPointsGroups:t.path("/collections/{collection_name}/points/query/groups").method("post").create({consistency:!0,timeout:!0}),searchMatrixPairs:t.path("/collections/{collection_name}/points/search/matrix/pairs").method("post").create({consistency:!0,timeout:!0}),searchMatrixOffsets:t.path("/collections/{collection_name}/points/search/matrix/offsets").method("post").create({consistency:!0,timeout:!0})}}function fE(t,e){const n=hE(t,e);return dE(n)}function hE(t,{headers:e,timeout:n,connections:r}){const a=[];Number.isFinite(n)&&a.push(async(c,d,p)=>{const h=new AbortController,x=setTimeout(()=>h.abort(),n);try{return await p(c,Object.assign(d,{signal:h.signal}))}catch(v){throw v instanceof Error&&v.name==="AbortError"?new cE(v.message):v}finally{clearTimeout(x)}}),a.push(async(c,d,p)=>{var x;let h;try{if(h=await p(c,d),h.status===200||h.status===201)return h}catch(v){if(v instanceof wl&&v.status===429){const w=(x=v.headers.get("retry-after"))==null?void 0:x[0];if(w)throw new uE(v.message,w)}throw v}throw ff.forResponse(h)});const o=oE.for();return o.configure({baseUrl:t,init:{headers:e,dispatcher:void 0},use:a}),o}const pd="1.15.1",Dd={parseVersion(t){if(!t)throw new Error("Version is null");let e,n;if([e,n]=t.split(".",2),e=parseInt(e,10),n=parseInt(n,10),isNaN(e)||isNaN(n))throw new Error(`Unable to parse version, expected format: x.y[.z], found: ${t}`);return{major:e,minor:n}},isCompatible(t,e){if(!t||!e)return console.debug(`Unable to compare versions with null values. Client: ${t}, Server: ${e}`),!1;if(t===e)return!0;try{const n=Dd.parseVersion(t),r=Dd.parseVersion(e);return n.major===r.major&&Math.abs(n.minor-r.minor)<=1}catch(n){return console.debug(`Unable to compare versions: ${n}`),!1}}};class pE{constructor({url:e,host:n,apiKey:r,https:a,prefix:o,port:c=6333,timeout:d=3e5,checkCompatibility:p=!0,...h}={}){if(this._https=a??typeof r=="string",this._scheme=this._https?"https":"http",this._prefix=o??"",this._prefix.length>0&&!this._prefix.startsWith("/")&&(this._prefix=`/${this._prefix}`),e&&n)throw new al(`Only one of \`url\`, \`host\` params can be set. Url is ${e}, host is ${n}`);if(n&&(n.startsWith("http://")||n.startsWith("https://")||/:\d+$/.test(n)))throw new al("The `host` param is not expected to contain neither protocol (http:// or https://) nor port (:6333).\nTry to use the `url` parameter instead.");if(e){if(!(e.startsWith("http://")||e.startsWith("https://")))throw new al("The `url` param expected to contain a valid URL starting with a protocol (http:// or https://).");const T=new URL(e);if(this._host=T.hostname,this._port=T.port?Number(T.port):c,this._scheme=T.protocol.replace(":",""),this._prefix.length>0&&T.pathname!=="/")throw new al(`Prefix can be set either in \`url\` or in \`prefix\`.
url is ${e}, prefix is ${T.pathname}`)}else this._port=c,this._host=n??"127.0.0.1";const x=new Headers([["user-agent","qdrant-js/"+String(pd)]]),v=h.headers??{};Object.keys(v).forEach(T=>{v[T]&&x.set(T,String(v[T]))}),typeof r=="string"&&(this._scheme==="http"&&console.warn("Api key is used with unsecure connection."),x.set("api-key",r));const w=this._port?`${this._host}:${this._port}`:this._host;this._restUri=`${this._scheme}://${w}${this._prefix}`;const _=h.maxConnections,E={headers:x,timeout:d,connections:_};this._openApiClient=fE(this._restUri,E),p&&this._openApiClient.root({}).then(T=>{const M=T.data.version;Dd.isCompatible(pd,M)||console.warn(`Client version ${pd} is incompatible with server version ${M}. Major versions should match and minor version difference must not exceed 1. Set checkCompatibility=false to skip version check.`)}).catch(()=>{console.warn("Failed to obtain server version. Unable to check client-server compatibility. Set checkCompatibility=false to skip version check.")})}api(){return this._openApiClient}async searchBatch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.searchBatchPoints({collection_name:e,consistency:r,timeout:a,searches:n});return ve(o.data.result).orThrow("Search batch returned empty")}async search(e,{shard_key:n,vector:r,limit:a=10,offset:o=0,filter:c,params:d,with_payload:p=!0,with_vector:h=!1,score_threshold:x,consistency:v,timeout:w}){const _=await this._openApiClient.searchPoints({collection_name:e,consistency:v,timeout:w,shard_key:n,vector:r,limit:a,offset:o,filter:c,params:d,with_payload:p,with_vector:h,score_threshold:x});return ve(_.data.result).orThrow("Search returned empty")}async recommendBatch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.recommendBatchPoints({collection_name:e,searches:n,consistency:r,timeout:a});return ve(o.data.result).orElse([])}async recommend_batch(e,{searches:n,consistency:r,timeout:a}){const o=await this._openApiClient.recommendBatchPoints({collection_name:e,searches:n,consistency:r,timeout:a});return ve(o.data.result).orElse([])}async recommend(e,{shard_key:n,positive:r,negative:a,strategy:o,filter:c,params:d,limit:p=10,offset:h=0,with_payload:x=!0,with_vector:v=!1,score_threshold:w,using:_,lookup_from:E,consistency:T,timeout:M}){const P=await this._openApiClient.recommendPoints({collection_name:e,limit:p,shard_key:n,positive:r,negative:a,strategy:o,filter:c,params:d,offset:h,with_payload:x,with_vector:v,score_threshold:w,using:_,lookup_from:E,consistency:T,timeout:M});return ve(P.data.result).orThrow("Recommend points API returned empty")}async scroll(e,{shard_key:n,filter:r,consistency:a,timeout:o,limit:c=10,offset:d,with_payload:p=!0,with_vector:h=!1,order_by:x}={}){const v=await this._openApiClient.scrollPoints({collection_name:e,shard_key:n,limit:c,offset:d,filter:r,with_payload:p,with_vector:h,order_by:x,consistency:a,timeout:o});return ve(v.data.result).orThrow("Scroll points API returned empty")}async count(e,{shard_key:n,filter:r,exact:a=!0,timeout:o}={}){const c=await this._openApiClient.countPoints({collection_name:e,shard_key:n,filter:r,exact:a,timeout:o});return ve(c.data.result).orThrow("Count points returned empty")}async collectionClusterInfo(e){const n=await this._openApiClient.collectionClusterInfo({collection_name:e});return ve(n.data.result).orThrow("Collection cluster info returned empty")}async updateCollectionCluster(e,{timeout:n,...r}){const a=await this._openApiClient.updateCollectionCluster({collection_name:e,timeout:n,...r});return ve(a.data.result).orThrow("Update collection cluster returned empty")}async updateVectors(e,{wait:n=!0,ordering:r,points:a,shard_key:o}){const c=await this._openApiClient.updateVectors({collection_name:e,wait:n,ordering:r,points:a,shard_key:o});return ve(c.data.result).orThrow("Update vectors returned empty")}async deleteVectors(e,{wait:n=!0,ordering:r,points:a,filter:o,vector:c,shard_key:d}){const p=await this._openApiClient.deleteVectors({collection_name:e,wait:n,ordering:r,points:a,filter:o,vector:c,shard_key:d});return ve(p.data.result).orThrow("Delete vectors returned empty")}async searchPointGroups(e,{consistency:n,timeout:r,shard_key:a,vector:o,filter:c,params:d,with_payload:p=null,with_vector:h=null,score_threshold:x,group_by:v,group_size:w,limit:_}){const E=await this._openApiClient.searchPointGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,vector:o,filter:c,params:d,with_payload:p,with_vector:h,score_threshold:x,group_by:v,group_size:w,limit:_});return ve(E.data.result).orThrow("Search point groups returned empty")}async recommendPointGroups(e,{consistency:n,timeout:r,shard_key:a,positive:o,strategy:c,negative:d=[],filter:p,params:h,with_payload:x=null,with_vector:v=null,score_threshold:w,using:_=null,lookup_from:E=null,group_by:T,group_size:M,limit:P}){const k=await this._openApiClient.recommendPointGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,positive:o,negative:d,strategy:c,filter:p,params:h,with_payload:x,with_vector:v,score_threshold:w,using:_,lookup_from:E,group_by:T,group_size:M,limit:P});return ve(k.data.result).orThrow("Recommend point groups API returned empty")}async upsert(e,{wait:n=!0,ordering:r,...a}){const o=await this._openApiClient.upsertPoints({collection_name:e,wait:n,ordering:r,...a});return ve(o.data.result).orThrow("Upsert returned empty")}async retrieve(e,{shard_key:n,ids:r,with_payload:a=!0,with_vector:o,consistency:c,timeout:d}){const p=await this._openApiClient.getPoints({collection_name:e,shard_key:n,ids:r,with_payload:a,with_vector:o,consistency:c,timeout:d});return ve(p.data.result).orThrow("Retrieve API returned empty")}async delete(e,{wait:n,ordering:r,...a}){const o=await this._openApiClient.deletePoints({collection_name:e,wait:n,ordering:r,...a});return ve(o.data.result).orThrow("Delete points returned empty")}async setPayload(e,{payload:n,points:r,filter:a,shard_key:o,key:c,ordering:d,wait:p=!0}){const h=await this._openApiClient.setPayload({collection_name:e,payload:n,points:r,filter:a,shard_key:o,key:c,wait:p,ordering:d});return ve(h.data.result).orThrow("Set payload returned empty")}async overwritePayload(e,{ordering:n,payload:r,points:a,filter:o,shard_key:c,key:d,wait:p=!0}){const h=await this._openApiClient.overwritePayload({collection_name:e,payload:r,points:a,filter:o,shard_key:c,key:d,wait:p,ordering:n});return ve(h.data.result).orThrow("Overwrite payload returned empty")}async deletePayload(e,{ordering:n,keys:r,points:a,filter:o,shard_key:c,wait:d=!0}){const p=await this._openApiClient.deletePayload({collection_name:e,keys:r,points:a,filter:o,shard_key:c,wait:d,ordering:n});return ve(p.data.result).orThrow("Delete payload returned empty")}async clearPayload(e,{ordering:n,wait:r=!0,...a}){const o=await this._openApiClient.clearPayload({collection_name:e,wait:r,ordering:n,...a});return ve(o.data.result).orThrow("Clear payload returned empty")}async updateCollectionAliases({actions:e,timeout:n}){const r=await this._openApiClient.updateAliases({actions:e,timeout:n});return ve(r.data.result).orThrow("Update aliases returned empty")}async getCollectionAliases(e){const n=await this._openApiClient.getCollectionAliases({collection_name:e});return ve(n.data.result).orThrow("Get collection aliases returned empty")}async getAliases(){const e=await this._openApiClient.getCollectionsAliases({});return ve(e.data.result).orThrow("Get aliases returned empty")}async getCollections(){const e=await this._openApiClient.getCollections({});return ve(e.data.result).orThrow("Get collections returned empty")}async getCollection(e){const n=await this._openApiClient.getCollection({collection_name:e});return ve(n.data.result).orThrow("Get collection returned empty")}async updateCollection(e,n){const r=await this._openApiClient.updateCollection({collection_name:e,...n});return ve(r.data.result).orThrow("Update collection returned empty")}async deleteCollection(e,n){const r=await this._openApiClient.deleteCollection({collection_name:e,...n});return ve(r.data.result).orThrow("Delete collection returned empty")}async createCollection(e,{timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:T}){const M=await this._openApiClient.createCollection({collection_name:e,timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:T});return ve(M.data.result).orThrow("Create collection returned empty")}async recreateCollection(e,{timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:T}){ve(await this._openApiClient.deleteCollection({collection_name:e,timeout:n})).get("ok").orThrow("Delete collection returned failed");const M=await this._openApiClient.createCollection({collection_name:e,timeout:n,vectors:r,hnsw_config:a,init_from:o,on_disk_payload:c,optimizers_config:d,quantization_config:p,replication_factor:h,shard_number:x,sharding_method:v,wal_config:w,write_consistency_factor:_,sparse_vectors:E,strict_mode_config:T});return ve(M).orThrow("Create collection returned empty")}async createPayloadIndex(e,{wait:n,ordering:r,field_name:a,field_schema:o}){const c=await this._openApiClient.createFieldIndex({collection_name:e,field_name:a,field_schema:o,wait:n,ordering:r});return ve(c.data.result).orThrow("Create field index returned empty")}async deletePayloadIndex(e,n,{wait:r=!0,ordering:a}={}){const o=await this._openApiClient.deleteFieldIndex({collection_name:e,field_name:n,wait:r,ordering:a});return ve(o.data.result).orThrow("Delete field index returned empty")}async listSnapshots(e){const n=await this._openApiClient.listSnapshots({collection_name:e});return ve(n.data.result).orThrow("List snapshots API returned empty")}async createSnapshot(e,n){const r=await this._openApiClient.createSnapshot({collection_name:e,...n});return ve(r.data.result).orNull()}async deleteSnapshot(e,n,r){const a=await this._openApiClient.deleteSnapshot({collection_name:e,snapshot_name:n,...r});return ve(a.data.result).orThrow("Delete snapshot API returned empty")}async listFullSnapshots(){const e=await this._openApiClient.listFullSnapshots({});return ve(e.data.result).orThrow("List full snapshots API returned empty")}async createFullSnapshot(e){const n=await this._openApiClient.createFullSnapshot(e??{});return ve(n.data.result).orThrow("Create full snapshot API returned empty")}async deleteFullSnapshot(e,n){const r=await this._openApiClient.deleteFullSnapshot({snapshot_name:e,...n});return ve(r.data.result).orThrow("Delete full snapshot API returned empty")}async recoverSnapshot(e,{location:n,priority:r,checksum:a,api_key:o}){const c=await this._openApiClient.recoverFromSnapshot({collection_name:e,location:n,priority:r,checksum:a,api_key:o});return ve(c.data.result).orThrow("Recover from snapshot API returned empty")}async lockStorage(e){const n=await this._openApiClient.postLocks({write:!0,error_message:e});return ve(n.data.result).orThrow("Lock storage returned empty")}async unlockStorage(){const e=await this._openApiClient.postLocks({write:!1});return ve(e.data.result).orThrow("Post locks returned empty")}async getLocks(){const e=await this._openApiClient.getLocks({});return ve(e.data.result).orThrow("Get locks returned empty")}async batchUpdate(e,{wait:n=!0,ordering:r,...a}){const o=await this._openApiClient.batchUpdate({collection_name:e,wait:n,ordering:r,...a});return ve(o.data.result).orThrow("Batch update returned empty")}async recoverShardFromSnapshot(e,n,{wait:r=!0,...a}){const o=await this._openApiClient.recoverShardFromSnapshot({collection_name:e,shard_id:n,wait:r,...a});return ve(o.data.result).orThrow("Recover shard from snapshot returned empty")}async listShardSnapshots(e,n){const r=await this._openApiClient.listShardSnapshots({collection_name:e,shard_id:n});return ve(r.data.result).orThrow("List shard snapshots returned empty")}async createShardSnapshot(e,n,{wait:r=!0}){const a=await this._openApiClient.createShardSnapshot({collection_name:e,shard_id:n,wait:r});return ve(a.data.result).orThrow("Create shard snapshot returned empty")}async deleteShardSnapshot(e,n,r,{wait:a=!0}){const o=await this._openApiClient.deleteShardSnapshot({collection_name:e,shard_id:n,snapshot_name:r,wait:a});return ve(o.data.result).orThrow("Create shard snapshot returned empty")}async createShardKey(e,{shard_key:n,shards_number:r,replication_factor:a,placement:o,timeout:c}){const d=await this._openApiClient.createShardKey({collection_name:e,shard_key:n,shards_number:r,replication_factor:a,placement:o,timeout:c});return ve(d.data.result).orThrow("Create shard key returned empty")}async deleteShardKey(e,{shard_key:n,timeout:r}){const a=await this._openApiClient.deleteShardKey({collection_name:e,shard_key:n,timeout:r});return ve(a.data.result).orThrow("Create shard key returned empty")}async discoverPoints(e,{consistency:n,timeout:r,shard_key:a,target:o,context:c,params:d,limit:p,offset:h,with_payload:x,with_vector:v,using:w,lookup_from:_}){const E=await this._openApiClient.discoverPoints({collection_name:e,consistency:n,timeout:r,shard_key:a,target:o,context:c,params:d,limit:p,offset:h,with_payload:x,with_vector:v,using:w,lookup_from:_});return ve(E.data.result).orThrow("Discover points returned empty")}async discoverBatchPoints(e,{consistency:n,timeout:r,searches:a}){const o=await this._openApiClient.discoverBatchPoints({collection_name:e,consistency:n,timeout:r,searches:a});return ve(o.data.result).orThrow("Discover batch points returned empty")}async versionInfo(){const e=await this._openApiClient.root({});return ve(e.data).orThrow("Version Info returned empty")}async collectionExists(e){const n=await this._openApiClient.collectionExists({collection_name:e});return ve(n.data.result).orThrow("Collection exists returned empty")}async query(e,{consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,limit:v,offset:w,with_vector:_,with_payload:E,lookup_from:T}){const M=await this._openApiClient.queryPoints({collection_name:e,consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,limit:v,offset:w,with_vector:_,with_payload:E,lookup_from:T});return ve(M.data.result).orThrow("Query points returned empty")}async queryBatch(e,{consistency:n,timeout:r,searches:a}){const o=await this._openApiClient.queryBatchPoints({collection_name:e,consistency:n,timeout:r,searches:a});return ve(o.data.result).orThrow("Query points returned empty")}async queryGroups(e,{consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,with_vector:v,with_payload:w,group_by:_,group_size:E,limit:T,with_lookup:M}){const P=await this._openApiClient.queryPointsGroups({collection_name:e,consistency:n,timeout:r,shard_key:a,prefetch:o,query:c,using:d,filter:p,params:h,score_threshold:x,with_vector:v,with_payload:w,group_by:_,group_size:E,limit:T,with_lookup:M});return ve(P.data.result).orThrow("Query groups returned empty")}async facet(e,{consistency:n,timeout:r,shard_key:a,key:o,limit:c,filter:d,exact:p}){const h=await this._openApiClient.facet({collection_name:e,consistency:n,timeout:r,shard_key:a,key:o,limit:c,filter:d,exact:p});return ve(h.data.result).orThrow("Facet returned empty")}async searchMatrixPairs(e,{consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p}){const h=await this._openApiClient.searchMatrixPairs({collection_name:e,consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p});return ve(h.data.result).orThrow("Search points matrix pairs returned empty")}async searchMatrixOffsets(e,{consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p}){const h=await this._openApiClient.searchMatrixOffsets({collection_name:e,consistency:n,timeout:r,shard_key:a,filter:o,sample:c,limit:d,using:p});return ve(h.data.result).orThrow("Search points matrix offsets returned empty")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let mE,gE;function yE(){return{geminiUrl:mE,vertexUrl:gE}}function xE(t,e,n,r){var a,o;if(!(t!=null&&t.baseUrl)){const c=yE();return e?(a=c.vertexUrl)!==null&&a!==void 0?a:n:(o=c.geminiUrl)!==null&&o!==void 0?o:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cs{}function fe(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,a)=>{if(Object.prototype.hasOwnProperty.call(e,a)){const o=e[a];return o!=null?String(o):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function g(t,e,n){for(let o=0;o<e.length-1;o++){const c=e[o];if(c.endsWith("[]")){const d=c.slice(0,-2);if(!(d in t))if(Array.isArray(n))t[d]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(t[d])){const p=t[d];if(Array.isArray(n))for(let h=0;h<p.length;h++){const x=p[h];g(x,e.slice(o+1),n[h])}else for(const h of p)g(h,e.slice(o+1),n)}return}else if(c.endsWith("[0]")){const d=c.slice(0,-3);d in t||(t[d]=[{}]);const p=t[d];g(p[0],e.slice(o+1),n);return}(!t[c]||typeof t[c]!="object")&&(t[c]={}),t=t[c]}const r=e[e.length-1],a=t[r];if(a!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===a)return;if(typeof a=="object"&&typeof n=="object"&&a!==null&&n!==null)Object.assign(a,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function m(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const a=e[r];if(a.endsWith("[]")){const o=a.slice(0,-2);if(o in t){const c=t[o];return Array.isArray(c)?c.map(d=>m(d,e.slice(r+1),n)):n}else return n}else t=t[a]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function vE(t,e){for(const[n,r]of Object.entries(e)){const a=n.split("."),o=r.split("."),c=new Set;let d=-1;for(let p=0;p<a.length;p++)if(a[p]==="*"){d=p;break}if(d!==-1&&o.length>d)for(let p=d;p<o.length;p++){const h=o[p];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&c.add(h)}Md(t,a,o,0,c)}}function Md(t,e,n,r,a){if(r>=e.length||typeof t!="object"||t===null)return;const o=e[r];if(o.endsWith("[]")){const c=o.slice(0,-2),d=t;if(c in d&&Array.isArray(d[c]))for(const p of d[c])Md(p,e,n,r+1,a)}else if(o==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const c=t,d=Object.keys(c).filter(h=>!h.startsWith("_")&&!a.has(h)),p={};for(const h of d)p[h]=c[h];for(const[h,x]of Object.entries(p)){const v=[];for(const w of n.slice(r))w==="*"?v.push(h):v.push(w);g(c,v,x)}for(const h of d)delete c[h]}}else{const c=t;o in c&&Md(c[o],e,n,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hf(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bE(t){const e={},n=m(t,["operationName"]);n!=null&&g(e,["operationName"],n);const r=m(t,["resourceName"]);return r!=null&&g(e,["_url","resourceName"],r),e}function wE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response","generateVideoResponse"]);return c!=null&&g(e,["response"],SE(c)),e}function _E(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],EE(c)),e}function SE(t){const e={},n=m(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>TE(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function EE(t){const e={},n=m(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>NE(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function TE(t){const e={},n=m(t,["video"]);return n!=null&&g(e,["video"],ME(n)),e}function NE(t){const e={},n=m(t,["_self"]);return n!=null&&g(e,["video"],kE(n)),e}function CE(t){const e={},n=m(t,["operationName"]);return n!=null&&g(e,["_url","operationName"],n),e}function AE(t){const e={},n=m(t,["operationName"]);return n!=null&&g(e,["_url","operationName"],n),e}function IE(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],RE(c)),e}function RE(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function Ex(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],DE(c)),e}function DE(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function ME(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["encodedVideo"]);r!=null&&g(e,["videoBytes"],hf(r));const a=m(t,["encoding"]);return a!=null&&g(e,["mimeType"],a),e}function kE(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["uri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["videoBytes"],hf(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ig;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(ig||(ig={}));var ag;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(ag||(ag={}));var og;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(og||(og={}));var Ce;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Ce||(Ce={}));var lg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(lg||(lg={}));var cg;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(cg||(cg={}));var ug;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(ug||(ug={}));var dg;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(dg||(dg={}));var fg;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(fg||(fg={}));var hg;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(hg||(hg={}));var pg;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(pg||(pg={}));var mg;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(mg||(mg={}));var gg;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(gg||(gg={}));var yg;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(yg||(yg={}));var xg;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(xg||(xg={}));var vg;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(vg||(vg={}));var bg;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(bg||(bg={}));var wg;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(wg||(wg={}));var _l;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(_l||(_l={}));var _g;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(_g||(_g={}));var Sg;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Sg||(Sg={}));var Eg;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Eg||(Eg={}));var kd;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(kd||(kd={}));var Tg;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Tg||(Tg={}));var Ng;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Ng||(Ng={}));var Cg;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Cg||(Cg={}));var Ag;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Ag||(Ag={}));var Ig;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Ig||(Ig={}));var Rg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Rg||(Rg={}));var Dg;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Dg||(Dg={}));var Mg;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Mg||(Mg={}));var kg;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(kg||(kg={}));var Pg;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Pg||(Pg={}));var Ug;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Ug||(Ug={}));var jg;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(jg||(jg={}));var Og;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Og||(Og={}));var Lg;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Lg||(Lg={}));var qg;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(qg||(qg={}));var Bg;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Bg||(Bg={}));var Vg;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Vg||(Vg={}));var Hg;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Hg||(Hg={}));var Gg;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Gg||(Gg={}));var zg;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(zg||(zg={}));var Fg;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Fg||(Fg={}));var $g;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})($g||($g={}));var Jg;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Jg||(Jg={}));var Yg;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Yg||(Yg={}));var Kg;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Kg||(Kg={}));var Qg;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Qg||(Qg={}));var Xg;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Xg||(Xg={}));var Wg;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Wg||(Wg={}));var Zg;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(Zg||(Zg={}));var gi;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(gi||(gi={}));class Pd{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Ca{get text(){var e,n,r,a,o,c,d,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",x=!1;const v=[];for(const w of(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[_,E]of Object.entries(w))_!=="text"&&_!=="thought"&&_!=="thoughtSignature"&&(E!==null||E!==void 0)&&v.push(_);if(typeof w.text=="string"){if(typeof w.thought=="boolean"&&w.thought)continue;x=!0,h+=w.text}}return v.length>0&&console.warn(`there are non-text parts ${v} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),x?h:void 0}get data(){var e,n,r,a,o,c,d,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const x=[];for(const v of(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[w,_]of Object.entries(v))w!=="inlineData"&&(_!==null||_!==void 0)&&x.push(w);v.inlineData&&typeof v.inlineData.data=="string"&&(h+=atob(v.inlineData.data))}return x.length>0&&console.warn(`there are non-data parts ${x} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,n,r,a,o,c,d,p;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(x=>x.functionCall).map(x=>x.functionCall).filter(x=>x!==void 0);if((h==null?void 0:h.length)!==0)return h}get executableCode(){var e,n,r,a,o,c,d,p,h;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const x=(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(v=>v.executableCode).map(v=>v.executableCode).filter(v=>v!==void 0);if((x==null?void 0:x.length)!==0)return(h=x==null?void 0:x[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,n,r,a,o,c,d,p,h;if(((a=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const x=(p=(d=(c=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(v=>v.codeExecutionResult).map(v=>v.codeExecutionResult).filter(v=>v!==void 0);if((x==null?void 0:x.length)!==0)return(h=x==null?void 0:x[0])===null||h===void 0?void 0:h.output}}class ey{}class ty{}class PE{}class UE{}class jE{}class OE{}class ny{}class sy{}class ry{}class LE{}class Sl{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Sl;let a;const o=e;return n?a=_E(o):a=wE(o),Object.assign(r,a),r}}class iy{}class ay{}class oy{}class qE{}class BE{}class VE{}class pf{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new pf,o=IE(e);return Object.assign(r,o),r}}class HE{}class GE{}class zE{}class ly{}class FE{get text(){var e,n,r;let a="",o=!1;const c=[];for(const d of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[p,h]of Object.entries(d))p!=="text"&&p!=="thought"&&h!==null&&c.push(p);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;o=!0,a+=d.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?a:void 0}get data(){var e,n,r;let a="";const o=[];for(const c of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[d,p]of Object.entries(c))d!=="inlineData"&&p!==null&&o.push(d);c.inlineData&&typeof c.inlineData.data=="string"&&(a+=atob(c.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class $E{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class mf{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new mf,o=Ex(e);return Object.assign(r,o),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ge(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Tx(t,e){const n=Ge(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function Nx(t){return Array.isArray(t)?t.map(e=>El(e)):[El(t)]}function El(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Cx(t){const e=El(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ax(t){const e=El(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function cy(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Ix(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>cy(e)):[cy(t)]}function Ud(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function uy(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function dy(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function jt(t){if(t==null)throw new Error("ContentUnion is required");return Ud(t)?t:{role:"user",parts:Ix(t)}}function gf(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=jt(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=jt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>jt(n)):[jt(e)]}function wn(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(uy(t)||dy(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[jt(t)]}const e=[],n=[],r=Ud(t[0]);for(const a of t){const o=Ud(a);if(o!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(a);else{if(uy(a)||dy(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(a)}}return r||e.push({role:"user",parts:Ix(n)}),e}function JE(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(Ce).includes(n[0].toUpperCase())?n[0].toUpperCase():Ce.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(Ce).includes(r.toUpperCase())?r.toUpperCase():Ce.TYPE_UNSPECIFIED})}}function yi(t){const e={},n=["items"],r=["anyOf"],a=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&JE(t.type,e);for(const[c,d]of Object.entries(t))if(d!=null)if(c=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(Ce).includes(d.toUpperCase())?d.toUpperCase():Ce.TYPE_UNSPECIFIED}else if(n.includes(c))e[c]=yi(d);else if(r.includes(c)){const p=[];for(const h of d){if(h.type=="null"){e.nullable=!0;continue}p.push(yi(h))}e[c]=p}else if(a.includes(c)){const p={};for(const[h,x]of Object.entries(d))p[h]=yi(x);e[c]=p}else{if(c==="additionalProperties")continue;e[c]=d}return e}function yf(t){return yi(t)}function xf(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function vf(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Ti(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=yi(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=yi(e.response));return t}function Ni(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function YE(t,e,n,r=1){const a=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:a?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:a?`${n}/${e}`:e}function us(t,e){if(typeof e!="string")throw new Error("name must be a string");return YE(t,e,"cachedContents")}function Rx(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Hs(t){return hf(t)}function KE(t){return t!=null&&typeof t=="object"&&"name"in t}function QE(t){return t!=null&&typeof t=="object"&&"video"in t}function XE(t){return t!=null&&typeof t=="object"&&"uri"in t}function Dx(t){var e;let n;if(KE(t)&&(n=t.name),!(XE(t)&&(n=t.uri,n===void 0))&&!(QE(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const a=n.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${n}`);n=a[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Mx(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function kx(t){for(const e of["models","tunedModels","publisherModels"])if(WE(t,e))return t[e];return[]}function WE(t,e){return t!==null&&typeof t=="object"&&e in t}function ZE(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function eT(t,e={}){const n=[],r=new Set;for(const a of t){const o=a.name;if(r.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);r.add(o);const c=ZE(a,e);c.functionDeclarations&&n.push(...c.functionDeclarations)}return{functionDeclarations:n}}function Px(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,a=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function tT(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Ux(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const a=n.inlinedResponses;if(!Array.isArray(a)||a.length===0)return t;let o=!1;for(const c of a){if(typeof c!="object"||c===null)continue;const p=c.response;if(typeof p!="object"||p===null)continue;if(p.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Ci(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function jx(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function nT(t){const e={},n=m(t,["responsesFile"]);n!=null&&g(e,["fileName"],n);const r=m(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>kT(c))),g(e,["inlinedResponses"],o)}const a=m(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["inlinedEmbedContentResponses"],o)}return e}function sT(t){const e={},n=m(t,["predictionsFormat"]);n!=null&&g(e,["format"],n);const r=m(t,["gcsDestination","outputUriPrefix"]);r!=null&&g(e,["gcsUri"],r);const a=m(t,["bigqueryDestination","outputUri"]);return a!=null&&g(e,["bigqueryUri"],a),e}function rT(t){const e={},n=m(t,["format"]);n!=null&&g(e,["predictionsFormat"],n);const r=m(t,["gcsUri"]);r!=null&&g(e,["gcsDestination","outputUriPrefix"],r);const a=m(t,["bigqueryUri"]);if(a!=null&&g(e,["bigqueryDestination","outputUri"],a),m(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(m(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function xl(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata","displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["metadata","state"]);a!=null&&g(e,["state"],jx(a));const o=m(t,["metadata","createTime"]);o!=null&&g(e,["createTime"],o);const c=m(t,["metadata","endTime"]);c!=null&&g(e,["endTime"],c);const d=m(t,["metadata","updateTime"]);d!=null&&g(e,["updateTime"],d);const p=m(t,["metadata","model"]);p!=null&&g(e,["model"],p);const h=m(t,["metadata","output"]);return h!=null&&g(e,["dest"],nT(Ux(h))),e}function jd(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["state"]);a!=null&&g(e,["state"],jx(a));const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["createTime"]);c!=null&&g(e,["createTime"],c);const d=m(t,["startTime"]);d!=null&&g(e,["startTime"],d);const p=m(t,["endTime"]);p!=null&&g(e,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(e,["updateTime"],h);const x=m(t,["model"]);x!=null&&g(e,["model"],x);const v=m(t,["inputConfig"]);v!=null&&g(e,["src"],iT(v));const w=m(t,["outputConfig"]);w!=null&&g(e,["dest"],sT(Ux(w)));const _=m(t,["completionStats"]);return _!=null&&g(e,["completionStats"],_),e}function iT(t){const e={},n=m(t,["instancesFormat"]);n!=null&&g(e,["format"],n);const r=m(t,["gcsSource","uris"]);r!=null&&g(e,["gcsUri"],r);const a=m(t,["bigquerySource","inputUri"]);return a!=null&&g(e,["bigqueryUri"],a),e}function aT(t,e){const n={};if(m(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(m(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=m(e,["fileName"]);r!=null&&g(n,["fileName"],r);const a=m(e,["inlinedRequests"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>MT(t,c))),g(n,["requests","requests"],o)}return n}function oT(t){const e={},n=m(t,["format"]);n!=null&&g(e,["instancesFormat"],n);const r=m(t,["gcsUri"]);r!=null&&g(e,["gcsSource","uris"],r);const a=m(t,["bigqueryUri"]);if(a!=null&&g(e,["bigquerySource","inputUri"],a),m(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function lT(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function cT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ci(t,r)),n}function uT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ci(t,r)),n}function dT(t){const e={},n=m(t,["content"]);n!=null&&g(e,["content"],n);const r=m(t,["citationMetadata"]);r!=null&&g(e,["citationMetadata"],fT(r));const a=m(t,["tokenCount"]);a!=null&&g(e,["tokenCount"],a);const o=m(t,["finishReason"]);o!=null&&g(e,["finishReason"],o);const c=m(t,["avgLogprobs"]);c!=null&&g(e,["avgLogprobs"],c);const d=m(t,["groundingMetadata"]);d!=null&&g(e,["groundingMetadata"],d);const p=m(t,["index"]);p!=null&&g(e,["index"],p);const h=m(t,["logprobsResult"]);h!=null&&g(e,["logprobsResult"],h);const x=m(t,["safetyRatings"]);if(x!=null){let w=x;Array.isArray(w)&&(w=w.map(_=>_)),g(e,["safetyRatings"],w)}const v=m(t,["urlContextMetadata"]);return v!=null&&g(e,["urlContextMetadata"],v),e}function fT(t){const e={},n=m(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["citations"],r)}return e}function Ox(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>BT(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function hT(t,e){const n={},r=m(t,["displayName"]);if(e!==void 0&&r!=null&&g(e,["batch","displayName"],r),m(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function pT(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["dest"]);return e!==void 0&&a!=null&&g(e,["outputConfig"],rT(tT(a))),n}function fy(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["src"]);a!=null&&g(n,["batch","inputConfig"],aT(t,Px(t,a)));const o=m(e,["config"]);return o!=null&&hT(o,n),n}function mT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],Ge(t,r));const a=m(e,["src"]);a!=null&&g(n,["inputConfig"],oT(Px(t,a)));const o=m(e,["config"]);return o!=null&&pT(o,n),n}function gT(t,e){const n={},r=m(t,["displayName"]);return e!==void 0&&r!=null&&g(e,["batch","displayName"],r),n}function yT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["src"]);a!=null&&g(n,["batch","inputConfig"],ET(t,a));const o=m(e,["config"]);return o!=null&&gT(o,n),n}function xT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ci(t,r)),n}function vT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ci(t,r)),n}function bT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);return o!=null&&g(e,["error"],o),e}function wT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);return o!=null&&g(e,["error"],o),e}function _T(t,e){const n={},r=m(e,["contents"]);if(r!=null){let o=gf(t,r);Array.isArray(o)&&(o=o.map(c=>c)),g(n,["requests[]","request","content"],o)}const a=m(e,["config"]);return a!=null&&(g(n,["_self"],ST(a,n)),vE(n,{"requests[].*":"requests[].request.*"})),n}function ST(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["requests[]","taskType"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["requests[]","title"],a);const o=m(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&g(e,["requests[]","outputDimensionality"],o),m(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function ET(t,e){const n={},r=m(e,["fileName"]);r!=null&&g(n,["file_name"],r);const a=m(e,["inlinedRequests"]);return a!=null&&g(n,["requests"],_T(t,a)),n}function TT(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function NT(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],Ox(jt(a)));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const d=m(e,["topK"]);d!=null&&g(r,["topK"],d);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const T=m(e,["seed"]);T!=null&&g(r,["seed"],T);const M=m(e,["responseMimeType"]);M!=null&&g(r,["responseMimeType"],M);const P=m(e,["responseSchema"]);P!=null&&g(r,["responseSchema"],yf(P));const k=m(e,["responseJsonSchema"]);if(k!=null&&g(r,["responseJsonSchema"],k),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=m(e,["safetySettings"]);if(n!==void 0&&C!=null){let ue=C;Array.isArray(ue)&&(ue=ue.map(Re=>VT(Re))),g(n,["safetySettings"],ue)}const I=m(e,["tools"]);if(n!==void 0&&I!=null){let ue=Ni(I);Array.isArray(ue)&&(ue=ue.map(Re=>HT(Ti(Re)))),g(n,["tools"],ue)}const j=m(e,["toolConfig"]);if(n!==void 0&&j!=null&&g(n,["toolConfig"],j),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const B=m(e,["cachedContent"]);n!==void 0&&B!=null&&g(n,["cachedContent"],us(t,B));const H=m(e,["responseModalities"]);H!=null&&g(r,["responseModalities"],H);const Q=m(e,["mediaResolution"]);Q!=null&&g(r,["mediaResolution"],Q);const Z=m(e,["speechConfig"]);if(Z!=null&&g(r,["speechConfig"],xf(Z)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const W=m(e,["thinkingConfig"]);W!=null&&g(r,["thinkingConfig"],W);const le=m(e,["imageConfig"]);return le!=null&&g(r,["imageConfig"],le),r}function CT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(h=>dT(h))),g(e,["candidates"],p)}const a=m(t,["modelVersion"]);a!=null&&g(e,["modelVersion"],a);const o=m(t,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);const c=m(t,["responseId"]);c!=null&&g(e,["responseId"],c);const d=m(t,["usageMetadata"]);return d!=null&&g(e,["usageMetadata"],d),e}function AT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ci(t,r)),n}function IT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],Ci(t,r)),n}function RT(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function DT(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function MT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["request","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let d=wn(a);Array.isArray(d)&&(d=d.map(p=>Ox(p))),g(n,["request","contents"],d)}const o=m(e,["metadata"]);o!=null&&g(n,["metadata"],o);const c=m(e,["config"]);return c!=null&&g(n,["request","generationConfig"],NT(t,c,m(n,["request"],{}))),n}function kT(t){const e={},n=m(t,["response"]);n!=null&&g(e,["response"],CT(n));const r=m(t,["error"]);return r!=null&&g(e,["error"],r),e}function PT(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);if(e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),m(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function UT(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);e!==void 0&&a!=null&&g(e,["_query","pageToken"],a);const o=m(t,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),n}function jT(t){const e={},n=m(t,["config"]);return n!=null&&PT(n,e),e}function OT(t){const e={},n=m(t,["config"]);return n!=null&&UT(n,e),e}function LT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["operations"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>xl(c))),g(e,["batchJobs"],o)}return e}function qT(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["batchPredictionJobs"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>jd(c))),g(e,["batchJobs"],o)}return e}function BT(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],TT(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],lT(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function VT(t){const e={},n=m(t,["category"]);if(n!=null&&g(e,["category"],n),m(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(t,["threshold"]);return r!=null&&g(e,["threshold"],r),e}function HT(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],RT(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],DT(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var os;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(os||(os={}));class br{constructor(e,n,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,a)}init(e,n,r){var a,o;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!r||Object.keys(r).length===0?c={config:{}}:typeof r=="object"?c=Object.assign({},r):c=r,c.config&&(c.config.pageToken=n.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(o=(a=c.config)===null||a===void 0?void 0:a.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class GT extends cs{constructor(e){super(),this.apiClient=e,this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)},this.list=async(n={})=>new br(os.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=fy(this.apiClient,e),r=n._url,a=fe("{model}:batchGenerateContent",r),d=n.batch.inputConfig.requests,p=d.requests,h=[];for(const x of p){const v=Object.assign({},x);if(v.systemInstruction){const w=v.systemInstruction;delete v.systemInstruction;const _=v.request;_.systemInstruction=w,v.request=_}h.push(v)}return d.requests=h,delete n.config,delete n._url,delete n._query,{path:a,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const o=this.getGcsUri(e),c=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?r.dest=`${o.slice(0,-6)}/dest`:r.dest=`${o}_dest_${a}`;else if(c)r.dest=`${c}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=mT(this.apiClient,e);return d=fe("batchPredictionJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>jd(x))}else{const h=fy(this.apiClient,e);return d=fe("{model}:batchGenerateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>xl(x))}}async createEmbeddingsInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=yT(this.apiClient,e);return o=fe("{model}:asyncBatchEmbedContent",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>xl(p))}}async get(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=IT(this.apiClient,e);return d=fe("batchPredictionJobs/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>jd(x))}else{const h=AT(this.apiClient,e);return d=fe("batches/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>xl(x))}}async cancel(e){var n,r,a,o;let c="",d={};if(this.apiClient.isVertexAI()){const p=uT(this.apiClient,e);c=fe("batchPredictionJobs/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const p=cT(this.apiClient,e);c=fe("batches/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=OT(e);return d=fe("batchPredictionJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=qT(x),w=new ly;return Object.assign(w,v),w})}else{const h=jT(e);return d=fe("batches",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=LT(x),w=new ly;return Object.assign(w,v),w})}}async delete(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=vT(this.apiClient,e);return d=fe("batchPredictionJobs/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>wT(x))}else{const h=xT(this.apiClient,e);return d=fe("batches/{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>bT(x))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zT(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function hy(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>dN(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function FT(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);e!==void 0&&a!=null&&g(e,["expireTime"],a);const o=m(t,["displayName"]);e!==void 0&&o!=null&&g(e,["displayName"],o);const c=m(t,["contents"]);if(e!==void 0&&c!=null){let x=wn(c);Array.isArray(x)&&(x=x.map(v=>hy(v))),g(e,["contents"],x)}const d=m(t,["systemInstruction"]);e!==void 0&&d!=null&&g(e,["systemInstruction"],hy(jt(d)));const p=m(t,["tools"]);if(e!==void 0&&p!=null){let x=p;Array.isArray(x)&&(x=x.map(v=>fN(v))),g(e,["tools"],x)}const h=m(t,["toolConfig"]);if(e!==void 0&&h!=null&&g(e,["toolConfig"],h),m(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function $T(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);e!==void 0&&a!=null&&g(e,["expireTime"],a);const o=m(t,["displayName"]);e!==void 0&&o!=null&&g(e,["displayName"],o);const c=m(t,["contents"]);if(e!==void 0&&c!=null){let v=wn(c);Array.isArray(v)&&(v=v.map(w=>w)),g(e,["contents"],v)}const d=m(t,["systemInstruction"]);e!==void 0&&d!=null&&g(e,["systemInstruction"],jt(d));const p=m(t,["tools"]);if(e!==void 0&&p!=null){let v=p;Array.isArray(v)&&(v=v.map(w=>hN(w))),g(e,["tools"],v)}const h=m(t,["toolConfig"]);e!==void 0&&h!=null&&g(e,["toolConfig"],h);const x=m(t,["kmsKeyName"]);return e!==void 0&&x!=null&&g(e,["encryption_spec","kmsKeyName"],x),n}function JT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],Tx(t,r));const a=m(e,["config"]);return a!=null&&FT(a,n),n}function YT(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["model"],Tx(t,r));const a=m(e,["config"]);return a!=null&&$T(a,n),n}function KT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],us(t,r)),n}function QT(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],us(t,r)),n}function XT(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function WT(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function ZT(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function eN(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const d=m(t,["responseJsonSchema"]);return d!=null&&g(e,["responseJsonSchema"],d),e}function tN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],us(t,r)),n}function nN(t,e){const n={},r=m(e,["name"]);return r!=null&&g(n,["_url","name"],us(t,r)),n}function sN(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function rN(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function iN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function aN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function oN(t){const e={},n=m(t,["config"]);return n!=null&&iN(n,e),e}function lN(t){const e={},n=m(t,["config"]);return n!=null&&aN(n,e),e}function cN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["cachedContents"],o)}return e}function uN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["cachedContents"],o)}return e}function dN(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],ZT(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],zT(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function fN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],sN(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],rN(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function hN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>eN(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const d=m(t,["enterpriseWebSearch"]);d!=null&&g(e,["enterpriseWebSearch"],d);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function pN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);return e!==void 0&&a!=null&&g(e,["expireTime"],a),n}function mN(t,e){const n={},r=m(t,["ttl"]);e!==void 0&&r!=null&&g(e,["ttl"],r);const a=m(t,["expireTime"]);return e!==void 0&&a!=null&&g(e,["expireTime"],a),n}function gN(t,e){const n={},r=m(e,["name"]);r!=null&&g(n,["_url","name"],us(t,r));const a=m(e,["config"]);return a!=null&&pN(a,n),n}function yN(t,e){const n={},r=m(e,["name"]);r!=null&&g(n,["_url","name"],us(t,r));const a=m(e,["config"]);return a!=null&&mN(a,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xN extends cs{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new br(os.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=YT(this.apiClient,e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=JT(this.apiClient,e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async get(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=nN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=tN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async delete(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=QT(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=WT(x),w=new ay;return Object.assign(w,v),w})}else{const h=KT(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=XT(x),w=new ay;return Object.assign(w,v),w})}}async update(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=yN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>x)}else{const h=gN(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>x)}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=lN(e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=uN(x),w=new oy;return Object.assign(w,v),w})}else{const h=oN(e);return d=fe("cachedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=cN(x),w=new oy;return Object.assign(w,v),w})}}}function py(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function st(t){return this instanceof st?(this.v=t,this):new st(t)}function xi(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(_){return function(E){return Promise.resolve(E).then(_,v)}}function d(_,E){r[_]&&(a[_]=function(T){return new Promise(function(M,P){o.push([_,T,M,P])>1||p(_,T)})},E&&(a[_]=E(a[_])))}function p(_,E){try{h(r[_](E))}catch(T){w(o[0][3],T)}}function h(_){_.value instanceof st?Promise.resolve(_.value.v).then(x,v):w(o[0][2],_)}function x(_){p("next",_)}function v(_){p("throw",_)}function w(_,E){_(E),o.shift(),o.length&&p(o[0][0],o[0][1])}}function Ia(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof py=="function"?py(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(d,p){c=t[o](c),a(d,p,c.done,c.value)})}}function a(o,c,d,p){Promise.resolve(p).then(function(h){o({value:h,done:d})},c)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vN(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:Lx(n)}function Lx(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function bN(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function my(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const a=[];let o=!0;for(;r<n&&t[r].role==="model";)a.push(t[r]),o&&!Lx(t[r])&&(o=!1),r++;o?e.push(...a):e.pop()}return e}class wN{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new _N(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class _N{constructor(e,n,r,a={},o=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=a,this.history=o,this.sendPromise=Promise.resolve(),bN(o)}async sendMessage(e){var n;await this.sendPromise;const r=jt(e.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,c,d;const p=await a,h=(c=(o=p.candidates)===null||o===void 0?void 0:o[0])===null||c===void 0?void 0:c.content,x=p.automaticFunctionCallingHistory,v=this.getHistory(!0).length;let w=[];x!=null&&(w=(d=x.slice(v))!==null&&d!==void 0?d:[]);const _=h?[h]:[];this.recordHistory(r,_,w)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(e){var n;await this.sendPromise;const r=jt(e.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const o=await a;return this.processStreamResponse(o,r)}getHistory(e=!1){const n=e?my(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var r,a;return xi(this,arguments,function*(){var c,d,p,h;const x=[];try{for(var v=!0,w=Ia(e),_;_=yield st(w.next()),c=_.done,!c;v=!0){h=_.value,v=!1;const E=h;if(vN(E)){const T=(a=(r=E.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content;T!==void 0&&x.push(T)}yield yield st(E)}}catch(E){d={error:E}}finally{try{!v&&!c&&(p=w.return)&&(yield st(p.call(w)))}finally{if(d)throw d.error}}this.recordHistory(n,x)})}recordHistory(e,n,r){let a=[];n.length>0&&n.every(o=>o.role!==void 0)?a=n:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...my(r)):this.history.push(e),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ol extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Ol.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SN(t){const e={},n=m(t,["file"]);return n!=null&&g(e,["file"],n),e}function EN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function TN(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","file"],Dx(n)),e}function NN(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function CN(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","file"],Dx(n)),e}function AN(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function IN(t){const e={},n=m(t,["config"]);return n!=null&&AN(n,e),e}function RN(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["files"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class DN extends cs{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new br(os.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=IN(e);return o=fe("files",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=RN(p),x=new HE;return Object.assign(x,h),x})}}async createInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=SN(e);return o=fe("upload/v1beta/files",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=EN(p),x=new GE;return Object.assign(x,h),x})}}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=CN(e);return o=fe("files/{file}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=TN(e);return o=fe("files/{file}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=NN(p),x=new zE;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vl(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function MN(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>JN(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function kN(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function PN(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const d=m(t,["responseJsonSchema"]);return d!=null&&g(e,["responseJsonSchema"],d),e}function UN(t){const e={},n=m(t,["modelSelectionConfig"]);n!=null&&g(e,["modelConfig"],n);const r=m(t,["responseJsonSchema"]);r!=null&&g(e,["responseJsonSchema"],r);const a=m(t,["audioTimestamp"]);a!=null&&g(e,["audioTimestamp"],a);const o=m(t,["candidateCount"]);o!=null&&g(e,["candidateCount"],o);const c=m(t,["enableAffectiveDialog"]);c!=null&&g(e,["enableAffectiveDialog"],c);const d=m(t,["frequencyPenalty"]);d!=null&&g(e,["frequencyPenalty"],d);const p=m(t,["logprobs"]);p!=null&&g(e,["logprobs"],p);const h=m(t,["maxOutputTokens"]);h!=null&&g(e,["maxOutputTokens"],h);const x=m(t,["mediaResolution"]);x!=null&&g(e,["mediaResolution"],x);const v=m(t,["presencePenalty"]);v!=null&&g(e,["presencePenalty"],v);const w=m(t,["responseLogprobs"]);w!=null&&g(e,["responseLogprobs"],w);const _=m(t,["responseMimeType"]);_!=null&&g(e,["responseMimeType"],_);const E=m(t,["responseModalities"]);E!=null&&g(e,["responseModalities"],E);const T=m(t,["responseSchema"]);T!=null&&g(e,["responseSchema"],T);const M=m(t,["routingConfig"]);M!=null&&g(e,["routingConfig"],M);const P=m(t,["seed"]);P!=null&&g(e,["seed"],P);const k=m(t,["speechConfig"]);k!=null&&g(e,["speechConfig"],qx(k));const C=m(t,["stopSequences"]);C!=null&&g(e,["stopSequences"],C);const I=m(t,["temperature"]);I!=null&&g(e,["temperature"],I);const j=m(t,["thinkingConfig"]);j!=null&&g(e,["thinkingConfig"],j);const B=m(t,["topK"]);B!=null&&g(e,["topK"],B);const H=m(t,["topP"]);if(H!=null&&g(e,["topP"],H),m(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function jN(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function ON(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function LN(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],r);const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const d=m(t,["topK"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","topK"],d);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],vf(v));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],MN(jt(E)));const T=m(t,["tools"]);if(e!==void 0&&T!=null){let B=Ni(T);Array.isArray(B)&&(B=B.map(H=>KN(Ti(H)))),g(e,["setup","tools"],B)}const M=m(t,["sessionResumption"]);e!==void 0&&M!=null&&g(e,["setup","sessionResumption"],YN(M));const P=m(t,["inputAudioTranscription"]);e!==void 0&&P!=null&&g(e,["setup","inputAudioTranscription"],P);const k=m(t,["outputAudioTranscription"]);e!==void 0&&k!=null&&g(e,["setup","outputAudioTranscription"],k);const C=m(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);const I=m(t,["contextWindowCompression"]);e!==void 0&&I!=null&&g(e,["setup","contextWindowCompression"],I);const j=m(t,["proactivity"]);return e!==void 0&&j!=null&&g(e,["setup","proactivity"],j),n}function qN(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],UN(r));const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const d=m(t,["topK"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","topK"],d);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],qx(vf(v)));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],jt(E));const T=m(t,["tools"]);if(e!==void 0&&T!=null){let B=Ni(T);Array.isArray(B)&&(B=B.map(H=>QN(Ti(H)))),g(e,["setup","tools"],B)}const M=m(t,["sessionResumption"]);e!==void 0&&M!=null&&g(e,["setup","sessionResumption"],M);const P=m(t,["inputAudioTranscription"]);e!==void 0&&P!=null&&g(e,["setup","inputAudioTranscription"],P);const k=m(t,["outputAudioTranscription"]);e!==void 0&&k!=null&&g(e,["setup","outputAudioTranscription"],k);const C=m(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);const I=m(t,["contextWindowCompression"]);e!==void 0&&I!=null&&g(e,["setup","contextWindowCompression"],I);const j=m(t,["proactivity"]);return e!==void 0&&j!=null&&g(e,["setup","proactivity"],j),n}function BN(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Ge(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],LN(a,n)),n}function VN(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Ge(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],qN(a,n)),n}function HN(t){const e={},n=m(t,["musicGenerationConfig"]);return n!=null&&g(e,["musicGenerationConfig"],n),e}function GN(t){const e={},n=m(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["weightedPrompts"],r)}return e}function zN(t){const e={},n=m(t,["media"]);if(n!=null){let h=Nx(n);Array.isArray(h)&&(h=h.map(x=>vl(x))),g(e,["mediaChunks"],h)}const r=m(t,["audio"]);r!=null&&g(e,["audio"],vl(Ax(r)));const a=m(t,["audioStreamEnd"]);a!=null&&g(e,["audioStreamEnd"],a);const o=m(t,["video"]);o!=null&&g(e,["video"],vl(Cx(o)));const c=m(t,["text"]);c!=null&&g(e,["text"],c);const d=m(t,["activityStart"]);d!=null&&g(e,["activityStart"],d);const p=m(t,["activityEnd"]);return p!=null&&g(e,["activityEnd"],p),e}function FN(t){const e={},n=m(t,["media"]);if(n!=null){let h=Nx(n);Array.isArray(h)&&(h=h.map(x=>x)),g(e,["mediaChunks"],h)}const r=m(t,["audio"]);r!=null&&g(e,["audio"],Ax(r));const a=m(t,["audioStreamEnd"]);a!=null&&g(e,["audioStreamEnd"],a);const o=m(t,["video"]);o!=null&&g(e,["video"],Cx(o));const c=m(t,["text"]);c!=null&&g(e,["text"],c);const d=m(t,["activityStart"]);d!=null&&g(e,["activityStart"],d);const p=m(t,["activityEnd"]);return p!=null&&g(e,["activityEnd"],p),e}function $N(t){const e={},n=m(t,["setupComplete"]);n!=null&&g(e,["setupComplete"],n);const r=m(t,["serverContent"]);r!=null&&g(e,["serverContent"],r);const a=m(t,["toolCall"]);a!=null&&g(e,["toolCall"],a);const o=m(t,["toolCallCancellation"]);o!=null&&g(e,["toolCallCancellation"],o);const c=m(t,["usageMetadata"]);c!=null&&g(e,["usageMetadata"],XN(c));const d=m(t,["goAway"]);d!=null&&g(e,["goAway"],d);const p=m(t,["sessionResumptionUpdate"]);return p!=null&&g(e,["sessionResumptionUpdate"],p),e}function JN(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],kN(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],vl(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function YN(t){const e={},n=m(t,["handle"]);if(n!=null&&g(e,["handle"],n),m(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function qx(t){const e={},n=m(t,["languageCode"]);n!=null&&g(e,["languageCode"],n);const r=m(t,["voiceConfig"]);if(r!=null&&g(e,["voiceConfig"],r),m(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function KN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],jN(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],ON(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function QN(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>PN(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const d=m(t,["enterpriseWebSearch"]);d!=null&&g(e,["enterpriseWebSearch"],d);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function XN(t){const e={},n=m(t,["promptTokenCount"]);n!=null&&g(e,["promptTokenCount"],n);const r=m(t,["cachedContentTokenCount"]);r!=null&&g(e,["cachedContentTokenCount"],r);const a=m(t,["candidatesTokenCount"]);a!=null&&g(e,["responseTokenCount"],a);const o=m(t,["toolUsePromptTokenCount"]);o!=null&&g(e,["toolUsePromptTokenCount"],o);const c=m(t,["thoughtsTokenCount"]);c!=null&&g(e,["thoughtsTokenCount"],c);const d=m(t,["totalTokenCount"]);d!=null&&g(e,["totalTokenCount"],d);const p=m(t,["promptTokensDetails"]);if(p!=null){let _=p;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["promptTokensDetails"],_)}const h=m(t,["cacheTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["cacheTokensDetails"],_)}const x=m(t,["candidatesTokensDetails"]);if(x!=null){let _=x;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["responseTokensDetails"],_)}const v=m(t,["toolUsePromptTokensDetails"]);if(v!=null){let _=v;Array.isArray(_)&&(_=_.map(E=>E)),g(e,["toolUsePromptTokensDetails"],_)}const w=m(t,["trafficType"]);return w!=null&&g(e,["trafficType"],w),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WN(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function ZN(t){const e={},n=m(t,["content"]);n!=null&&g(e,["content"],n);const r=m(t,["citationMetadata"]);r!=null&&g(e,["citationMetadata"],eC(r));const a=m(t,["tokenCount"]);a!=null&&g(e,["tokenCount"],a);const o=m(t,["finishReason"]);o!=null&&g(e,["finishReason"],o);const c=m(t,["avgLogprobs"]);c!=null&&g(e,["avgLogprobs"],c);const d=m(t,["groundingMetadata"]);d!=null&&g(e,["groundingMetadata"],d);const p=m(t,["index"]);p!=null&&g(e,["index"],p);const h=m(t,["logprobsResult"]);h!=null&&g(e,["logprobsResult"],h);const x=m(t,["safetyRatings"]);if(x!=null){let w=x;Array.isArray(w)&&(w=w.map(_=>_)),g(e,["safetyRatings"],w)}const v=m(t,["urlContextMetadata"]);return v!=null&&g(e,["urlContextMetadata"],v),e}function eC(t){const e={},n=m(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),g(e,["citations"],r)}return e}function tC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let o=wn(a);Array.isArray(o)&&(o=o.map(c=>c)),g(n,["contents"],o)}return n}function nC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(e,["tokensInfo"],a)}return e}function sC(t){const e={},n=m(t,["values"]);n!=null&&g(e,["values"],n);const r=m(t,["statistics"]);return r!=null&&g(e,["statistics"],rC(r)),e}function rC(t){const e={},n=m(t,["truncated"]);n!=null&&g(e,["truncated"],n);const r=m(t,["token_count"]);return r!=null&&g(e,["tokenCount"],r),e}function Ll(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>c1(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function iC(t){const e={},n=m(t,["controlType"]);n!=null&&g(e,["controlType"],n);const r=m(t,["enableControlImageComputation"]);return r!=null&&g(e,["computeControl"],r),e}function aC(t){const e={};if(m(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(m(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(m(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function oC(t,e){const n={},r=m(t,["systemInstruction"]);e!==void 0&&r!=null&&g(e,["systemInstruction"],jt(r));const a=m(t,["tools"]);if(e!==void 0&&a!=null){let c=a;Array.isArray(c)&&(c=c.map(d=>zx(d))),g(e,["tools"],c)}const o=m(t,["generationConfig"]);return e!==void 0&&o!=null&&g(e,["generationConfig"],QC(o)),n}function lC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let c=wn(a);Array.isArray(c)&&(c=c.map(d=>Ll(d))),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&aC(o),n}function cC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let c=wn(a);Array.isArray(c)&&(c=c.map(d=>d)),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&oC(o,n),n}function uC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["totalTokens"]);r!=null&&g(e,["totalTokens"],r);const a=m(t,["cachedContentTokenCount"]);return a!=null&&g(e,["cachedContentTokenCount"],a),e}function dC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["totalTokens"]);return r!=null&&g(e,["totalTokens"],r),e}function fC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Ge(t,r)),n}function hC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Ge(t,r)),n}function pC(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function mC(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}function gC(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["negativePrompt"]);e!==void 0&&a!=null&&g(e,["parameters","negativePrompt"],a);const o=m(t,["numberOfImages"]);e!==void 0&&o!=null&&g(e,["parameters","sampleCount"],o);const c=m(t,["aspectRatio"]);e!==void 0&&c!=null&&g(e,["parameters","aspectRatio"],c);const d=m(t,["guidanceScale"]);e!==void 0&&d!=null&&g(e,["parameters","guidanceScale"],d);const p=m(t,["seed"]);e!==void 0&&p!=null&&g(e,["parameters","seed"],p);const h=m(t,["safetyFilterLevel"]);e!==void 0&&h!=null&&g(e,["parameters","safetySetting"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&g(e,["parameters","includeSafetyAttributes"],v);const w=m(t,["includeRaiReason"]);e!==void 0&&w!=null&&g(e,["parameters","includeRaiReason"],w);const _=m(t,["language"]);e!==void 0&&_!=null&&g(e,["parameters","language"],_);const E=m(t,["outputMimeType"]);e!==void 0&&E!=null&&g(e,["parameters","outputOptions","mimeType"],E);const T=m(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&g(e,["parameters","outputOptions","compressionQuality"],T);const M=m(t,["addWatermark"]);e!==void 0&&M!=null&&g(e,["parameters","addWatermark"],M);const P=m(t,["labels"]);e!==void 0&&P!=null&&g(e,["labels"],P);const k=m(t,["editMode"]);e!==void 0&&k!=null&&g(e,["parameters","editMode"],k);const C=m(t,["baseSteps"]);return e!==void 0&&C!=null&&g(e,["parameters","editConfig","baseSteps"],C),n}function yC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["referenceImages"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>m1(p))),g(n,["instances[0]","referenceImages"],d)}const c=m(e,["config"]);return c!=null&&gC(c,n),n}function xC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>ql(o))),g(e,["generatedImages"],a)}return e}function vC(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["requests[]","taskType"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["requests[]","title"],a);const o=m(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&g(e,["requests[]","outputDimensionality"],o),m(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function bC(t,e){const n={},r=m(t,["taskType"]);e!==void 0&&r!=null&&g(e,["instances[]","task_type"],r);const a=m(t,["title"]);e!==void 0&&a!=null&&g(e,["instances[]","title"],a);const o=m(t,["outputDimensionality"]);e!==void 0&&o!=null&&g(e,["parameters","outputDimensionality"],o);const c=m(t,["mimeType"]);e!==void 0&&c!=null&&g(e,["instances[]","mimeType"],c);const d=m(t,["autoTruncate"]);return e!==void 0&&d!=null&&g(e,["parameters","autoTruncate"],d),n}function wC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let d=gf(t,a);Array.isArray(d)&&(d=d.map(p=>p)),g(n,["requests[]","content"],d)}const o=m(e,["config"]);o!=null&&vC(o,n);const c=m(e,["model"]);return c!==void 0&&g(n,["requests[]","model"],Ge(t,c)),n}function _C(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let c=gf(t,a);Array.isArray(c)&&(c=c.map(d=>d)),g(n,["instances[]","content"],c)}const o=m(e,["config"]);return o!=null&&bC(o,n),n}function SC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["embeddings"],o)}const a=m(t,["metadata"]);return a!=null&&g(e,["metadata"],a),e}function EC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>sC(c))),g(e,["embeddings"],o)}const a=m(t,["metadata"]);return a!=null&&g(e,["metadata"],a),e}function TC(t){const e={},n=m(t,["endpoint"]);n!=null&&g(e,["name"],n);const r=m(t,["deployedModelId"]);return r!=null&&g(e,["deployedModelId"],r),e}function NC(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function CC(t){const e={};if(m(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=m(t,["description"]);n!=null&&g(e,["description"],n);const r=m(t,["name"]);r!=null&&g(e,["name"],r);const a=m(t,["parameters"]);a!=null&&g(e,["parameters"],a);const o=m(t,["parametersJsonSchema"]);o!=null&&g(e,["parametersJsonSchema"],o);const c=m(t,["response"]);c!=null&&g(e,["response"],c);const d=m(t,["responseJsonSchema"]);return d!=null&&g(e,["responseJsonSchema"],d),e}function AC(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],Ll(jt(a)));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const d=m(e,["topK"]);d!=null&&g(r,["topK"],d);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const T=m(e,["seed"]);T!=null&&g(r,["seed"],T);const M=m(e,["responseMimeType"]);M!=null&&g(r,["responseMimeType"],M);const P=m(e,["responseSchema"]);P!=null&&g(r,["responseSchema"],yf(P));const k=m(e,["responseJsonSchema"]);if(k!=null&&g(r,["responseJsonSchema"],k),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=m(e,["safetySettings"]);if(n!==void 0&&C!=null){let ue=C;Array.isArray(ue)&&(ue=ue.map(Re=>g1(Re))),g(n,["safetySettings"],ue)}const I=m(e,["tools"]);if(n!==void 0&&I!=null){let ue=Ni(I);Array.isArray(ue)&&(ue=ue.map(Re=>_1(Ti(Re)))),g(n,["tools"],ue)}const j=m(e,["toolConfig"]);if(n!==void 0&&j!=null&&g(n,["toolConfig"],j),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const B=m(e,["cachedContent"]);n!==void 0&&B!=null&&g(n,["cachedContent"],us(t,B));const H=m(e,["responseModalities"]);H!=null&&g(r,["responseModalities"],H);const Q=m(e,["mediaResolution"]);Q!=null&&g(r,["mediaResolution"],Q);const Z=m(e,["speechConfig"]);if(Z!=null&&g(r,["speechConfig"],xf(Z)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const W=m(e,["thinkingConfig"]);W!=null&&g(r,["thinkingConfig"],W);const le=m(e,["imageConfig"]);return le!=null&&g(r,["imageConfig"],le),r}function IC(t,e,n){const r={},a=m(e,["systemInstruction"]);n!==void 0&&a!=null&&g(n,["systemInstruction"],jt(a));const o=m(e,["temperature"]);o!=null&&g(r,["temperature"],o);const c=m(e,["topP"]);c!=null&&g(r,["topP"],c);const d=m(e,["topK"]);d!=null&&g(r,["topK"],d);const p=m(e,["candidateCount"]);p!=null&&g(r,["candidateCount"],p);const h=m(e,["maxOutputTokens"]);h!=null&&g(r,["maxOutputTokens"],h);const x=m(e,["stopSequences"]);x!=null&&g(r,["stopSequences"],x);const v=m(e,["responseLogprobs"]);v!=null&&g(r,["responseLogprobs"],v);const w=m(e,["logprobs"]);w!=null&&g(r,["logprobs"],w);const _=m(e,["presencePenalty"]);_!=null&&g(r,["presencePenalty"],_);const E=m(e,["frequencyPenalty"]);E!=null&&g(r,["frequencyPenalty"],E);const T=m(e,["seed"]);T!=null&&g(r,["seed"],T);const M=m(e,["responseMimeType"]);M!=null&&g(r,["responseMimeType"],M);const P=m(e,["responseSchema"]);P!=null&&g(r,["responseSchema"],yf(P));const k=m(e,["responseJsonSchema"]);k!=null&&g(r,["responseJsonSchema"],k);const C=m(e,["routingConfig"]);C!=null&&g(r,["routingConfig"],C);const I=m(e,["modelSelectionConfig"]);I!=null&&g(r,["modelConfig"],I);const j=m(e,["safetySettings"]);if(n!==void 0&&j!=null){let R=j;Array.isArray(R)&&(R=R.map(O=>O)),g(n,["safetySettings"],R)}const B=m(e,["tools"]);if(n!==void 0&&B!=null){let R=Ni(B);Array.isArray(R)&&(R=R.map(O=>zx(Ti(O)))),g(n,["tools"],R)}const H=m(e,["toolConfig"]);n!==void 0&&H!=null&&g(n,["toolConfig"],H);const Q=m(e,["labels"]);n!==void 0&&Q!=null&&g(n,["labels"],Q);const Z=m(e,["cachedContent"]);n!==void 0&&Z!=null&&g(n,["cachedContent"],us(t,Z));const W=m(e,["responseModalities"]);W!=null&&g(r,["responseModalities"],W);const le=m(e,["mediaResolution"]);le!=null&&g(r,["mediaResolution"],le);const ue=m(e,["speechConfig"]);ue!=null&&g(r,["speechConfig"],Gx(xf(ue)));const Re=m(e,["audioTimestamp"]);Re!=null&&g(r,["audioTimestamp"],Re);const Ne=m(e,["thinkingConfig"]);Ne!=null&&g(r,["thinkingConfig"],Ne);const Ie=m(e,["imageConfig"]);return Ie!=null&&g(r,["imageConfig"],Ie),r}function gy(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let c=wn(a);Array.isArray(c)&&(c=c.map(d=>Ll(d))),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&g(n,["generationConfig"],AC(t,o,n)),n}function yy(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["contents"]);if(a!=null){let c=wn(a);Array.isArray(c)&&(c=c.map(d=>d)),g(n,["contents"],c)}const o=m(e,["config"]);return o!=null&&g(n,["generationConfig"],IC(t,o,n)),n}function xy(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let p=r;Array.isArray(p)&&(p=p.map(h=>ZN(h))),g(e,["candidates"],p)}const a=m(t,["modelVersion"]);a!=null&&g(e,["modelVersion"],a);const o=m(t,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);const c=m(t,["responseId"]);c!=null&&g(e,["responseId"],c);const d=m(t,["usageMetadata"]);return d!=null&&g(e,["usageMetadata"],d),e}function vy(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["candidates"]);if(r!=null){let h=r;Array.isArray(h)&&(h=h.map(x=>x)),g(e,["candidates"],h)}const a=m(t,["createTime"]);a!=null&&g(e,["createTime"],a);const o=m(t,["modelVersion"]);o!=null&&g(e,["modelVersion"],o);const c=m(t,["promptFeedback"]);c!=null&&g(e,["promptFeedback"],c);const d=m(t,["responseId"]);d!=null&&g(e,["responseId"],d);const p=m(t,["usageMetadata"]);return p!=null&&g(e,["usageMetadata"],p),e}function RC(t,e){const n={};if(m(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=m(t,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["aspectRatio"]);e!==void 0&&a!=null&&g(e,["parameters","aspectRatio"],a);const o=m(t,["guidanceScale"]);if(e!==void 0&&o!=null&&g(e,["parameters","guidanceScale"],o),m(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=m(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&g(e,["parameters","safetySetting"],c);const d=m(t,["personGeneration"]);e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d);const p=m(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&g(e,["parameters","includeSafetyAttributes"],p);const h=m(t,["includeRaiReason"]);e!==void 0&&h!=null&&g(e,["parameters","includeRaiReason"],h);const x=m(t,["language"]);e!==void 0&&x!=null&&g(e,["parameters","language"],x);const v=m(t,["outputMimeType"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","mimeType"],v);const w=m(t,["outputCompressionQuality"]);if(e!==void 0&&w!=null&&g(e,["parameters","outputOptions","compressionQuality"],w),m(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _=m(t,["imageSize"]);if(e!==void 0&&_!=null&&g(e,["parameters","sampleImageSize"],_),m(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function DC(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["negativePrompt"]);e!==void 0&&a!=null&&g(e,["parameters","negativePrompt"],a);const o=m(t,["numberOfImages"]);e!==void 0&&o!=null&&g(e,["parameters","sampleCount"],o);const c=m(t,["aspectRatio"]);e!==void 0&&c!=null&&g(e,["parameters","aspectRatio"],c);const d=m(t,["guidanceScale"]);e!==void 0&&d!=null&&g(e,["parameters","guidanceScale"],d);const p=m(t,["seed"]);e!==void 0&&p!=null&&g(e,["parameters","seed"],p);const h=m(t,["safetyFilterLevel"]);e!==void 0&&h!=null&&g(e,["parameters","safetySetting"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["includeSafetyAttributes"]);e!==void 0&&v!=null&&g(e,["parameters","includeSafetyAttributes"],v);const w=m(t,["includeRaiReason"]);e!==void 0&&w!=null&&g(e,["parameters","includeRaiReason"],w);const _=m(t,["language"]);e!==void 0&&_!=null&&g(e,["parameters","language"],_);const E=m(t,["outputMimeType"]);e!==void 0&&E!=null&&g(e,["parameters","outputOptions","mimeType"],E);const T=m(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&g(e,["parameters","outputOptions","compressionQuality"],T);const M=m(t,["addWatermark"]);e!==void 0&&M!=null&&g(e,["parameters","addWatermark"],M);const P=m(t,["labels"]);e!==void 0&&P!=null&&g(e,["labels"],P);const k=m(t,["imageSize"]);e!==void 0&&k!=null&&g(e,["parameters","sampleImageSize"],k);const C=m(t,["enhancePrompt"]);return e!==void 0&&C!=null&&g(e,["parameters","enhancePrompt"],C),n}function MC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["config"]);return o!=null&&RC(o,n),n}function kC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["config"]);return o!=null&&DC(o,n),n}function PC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>$C(c))),g(e,["generatedImages"],o)}const a=m(t,["positivePromptSafetyAttributes"]);return a!=null&&g(e,["positivePromptSafetyAttributes"],Vx(a)),e}function UC(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>ql(c))),g(e,["generatedImages"],o)}const a=m(t,["positivePromptSafetyAttributes"]);return a!=null&&g(e,["positivePromptSafetyAttributes"],Hx(a)),e}function jC(t,e){const n={},r=m(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r),m(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=m(t,["durationSeconds"]);if(e!==void 0&&a!=null&&g(e,["parameters","durationSeconds"],a),m(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=m(t,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);const c=m(t,["resolution"]);e!==void 0&&c!=null&&g(e,["parameters","resolution"],c);const d=m(t,["personGeneration"]);if(e!==void 0&&d!=null&&g(e,["parameters","personGeneration"],d),m(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const p=m(t,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);const h=m(t,["enhancePrompt"]);if(e!==void 0&&h!=null&&g(e,["parameters","enhancePrompt"],h),m(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const x=m(t,["lastFrame"]);e!==void 0&&x!=null&&g(e,["instances[0]","lastFrame"],Bl(x));const v=m(t,["referenceImages"]);if(e!==void 0&&v!=null){let w=v;Array.isArray(w)&&(w=w.map(_=>U1(_))),g(e,["instances[0]","referenceImages"],w)}if(m(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(m(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function OC(t,e){const n={},r=m(t,["numberOfVideos"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["outputGcsUri"]);e!==void 0&&a!=null&&g(e,["parameters","storageUri"],a);const o=m(t,["fps"]);e!==void 0&&o!=null&&g(e,["parameters","fps"],o);const c=m(t,["durationSeconds"]);e!==void 0&&c!=null&&g(e,["parameters","durationSeconds"],c);const d=m(t,["seed"]);e!==void 0&&d!=null&&g(e,["parameters","seed"],d);const p=m(t,["aspectRatio"]);e!==void 0&&p!=null&&g(e,["parameters","aspectRatio"],p);const h=m(t,["resolution"]);e!==void 0&&h!=null&&g(e,["parameters","resolution"],h);const x=m(t,["personGeneration"]);e!==void 0&&x!=null&&g(e,["parameters","personGeneration"],x);const v=m(t,["pubsubTopic"]);e!==void 0&&v!=null&&g(e,["parameters","pubsubTopic"],v);const w=m(t,["negativePrompt"]);e!==void 0&&w!=null&&g(e,["parameters","negativePrompt"],w);const _=m(t,["enhancePrompt"]);e!==void 0&&_!=null&&g(e,["parameters","enhancePrompt"],_);const E=m(t,["generateAudio"]);e!==void 0&&E!=null&&g(e,["parameters","generateAudio"],E);const T=m(t,["lastFrame"]);e!==void 0&&T!=null&&g(e,["instances[0]","lastFrame"],Dn(T));const M=m(t,["referenceImages"]);if(e!==void 0&&M!=null){let C=M;Array.isArray(C)&&(C=C.map(I=>j1(I))),g(e,["instances[0]","referenceImages"],C)}const P=m(t,["mask"]);e!==void 0&&P!=null&&g(e,["instances[0]","mask"],P1(P));const k=m(t,["compressionQuality"]);return e!==void 0&&k!=null&&g(e,["parameters","compressionQuality"],k),n}function LC(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response","generateVideoResponse"]);return c!=null&&g(e,["response"],HC(c)),e}function qC(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],GC(c)),e}function BC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["image"]);o!=null&&g(n,["instances[0]","image"],Bl(o));const c=m(e,["video"]);c!=null&&g(n,["instances[0]","video"],Fx(c));const d=m(e,["source"]);d!=null&&zC(d,n);const p=m(e,["config"]);return p!=null&&jC(p,n),n}function VC(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["prompt"]);a!=null&&g(n,["instances[0]","prompt"],a);const o=m(e,["image"]);o!=null&&g(n,["instances[0]","image"],Dn(o));const c=m(e,["video"]);c!=null&&g(n,["instances[0]","video"],$x(c));const d=m(e,["source"]);d!=null&&FC(d,n);const p=m(e,["config"]);return p!=null&&OC(p,n),n}function HC(t){const e={},n=m(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>YC(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function GC(t){const e={},n=m(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(c=>KC(c))),g(e,["generatedVideos"],o)}const r=m(t,["raiMediaFilteredCount"]);r!=null&&g(e,["raiMediaFilteredCount"],r);const a=m(t,["raiMediaFilteredReasons"]);return a!=null&&g(e,["raiMediaFilteredReasons"],a),e}function zC(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Bl(a));const o=m(t,["video"]);return e!==void 0&&o!=null&&g(e,["instances[0]","video"],Fx(o)),n}function FC(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Dn(a));const o=m(t,["video"]);return e!==void 0&&o!=null&&g(e,["instances[0]","video"],$x(o)),n}function $C(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["image"],t1(n));const r=m(t,["raiFilteredReason"]);r!=null&&g(e,["raiFilteredReason"],r);const a=m(t,["_self"]);return a!=null&&g(e,["safetyAttributes"],Vx(a)),e}function ql(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["image"],Bx(n));const r=m(t,["raiFilteredReason"]);r!=null&&g(e,["raiFilteredReason"],r);const a=m(t,["_self"]);a!=null&&g(e,["safetyAttributes"],Hx(a));const o=m(t,["prompt"]);return o!=null&&g(e,["enhancedPrompt"],o),e}function JC(t){const e={},n=m(t,["_self"]);n!=null&&g(e,["mask"],Bx(n));const r=m(t,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(e,["labels"],a)}return e}function YC(t){const e={},n=m(t,["video"]);return n!=null&&g(e,["video"],M1(n)),e}function KC(t){const e={},n=m(t,["_self"]);return n!=null&&g(e,["video"],k1(n)),e}function QC(t){const e={},n=m(t,["modelSelectionConfig"]);n!=null&&g(e,["modelConfig"],n);const r=m(t,["responseJsonSchema"]);r!=null&&g(e,["responseJsonSchema"],r);const a=m(t,["audioTimestamp"]);a!=null&&g(e,["audioTimestamp"],a);const o=m(t,["candidateCount"]);o!=null&&g(e,["candidateCount"],o);const c=m(t,["enableAffectiveDialog"]);c!=null&&g(e,["enableAffectiveDialog"],c);const d=m(t,["frequencyPenalty"]);d!=null&&g(e,["frequencyPenalty"],d);const p=m(t,["logprobs"]);p!=null&&g(e,["logprobs"],p);const h=m(t,["maxOutputTokens"]);h!=null&&g(e,["maxOutputTokens"],h);const x=m(t,["mediaResolution"]);x!=null&&g(e,["mediaResolution"],x);const v=m(t,["presencePenalty"]);v!=null&&g(e,["presencePenalty"],v);const w=m(t,["responseLogprobs"]);w!=null&&g(e,["responseLogprobs"],w);const _=m(t,["responseMimeType"]);_!=null&&g(e,["responseMimeType"],_);const E=m(t,["responseModalities"]);E!=null&&g(e,["responseModalities"],E);const T=m(t,["responseSchema"]);T!=null&&g(e,["responseSchema"],T);const M=m(t,["routingConfig"]);M!=null&&g(e,["routingConfig"],M);const P=m(t,["seed"]);P!=null&&g(e,["seed"],P);const k=m(t,["speechConfig"]);k!=null&&g(e,["speechConfig"],Gx(k));const C=m(t,["stopSequences"]);C!=null&&g(e,["stopSequences"],C);const I=m(t,["temperature"]);I!=null&&g(e,["temperature"],I);const j=m(t,["thinkingConfig"]);j!=null&&g(e,["thinkingConfig"],j);const B=m(t,["topK"]);B!=null&&g(e,["topK"],B);const H=m(t,["topP"]);if(H!=null&&g(e,["topP"],H),m(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function XC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Ge(t,r)),n}function WC(t,e){const n={},r=m(e,["model"]);return r!=null&&g(n,["_url","name"],Ge(t,r)),n}function ZC(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function e1(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function t1(t){const e={},n=m(t,["bytesBase64Encoded"]);n!=null&&g(e,["imageBytes"],Hs(n));const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function Bx(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["imageBytes"],Hs(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function Bl(t){const e={};if(m(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=m(t,["imageBytes"]);n!=null&&g(e,["bytesBase64Encoded"],Hs(n));const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function Dn(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["imageBytes"]);r!=null&&g(e,["bytesBase64Encoded"],Hs(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function n1(t,e,n){const r={},a=m(e,["pageSize"]);n!==void 0&&a!=null&&g(n,["_query","pageSize"],a);const o=m(e,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const c=m(e,["filter"]);n!==void 0&&c!=null&&g(n,["_query","filter"],c);const d=m(e,["queryBase"]);return n!==void 0&&d!=null&&g(n,["_url","models_url"],Mx(t,d)),r}function s1(t,e,n){const r={},a=m(e,["pageSize"]);n!==void 0&&a!=null&&g(n,["_query","pageSize"],a);const o=m(e,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const c=m(e,["filter"]);n!==void 0&&c!=null&&g(n,["_query","filter"],c);const d=m(e,["queryBase"]);return n!==void 0&&d!=null&&g(n,["_url","models_url"],Mx(t,d)),r}function r1(t,e){const n={},r=m(e,["config"]);return r!=null&&n1(t,r,n),n}function i1(t,e){const n={},r=m(e,["config"]);return r!=null&&s1(t,r,n),n}function a1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["_self"]);if(a!=null){let o=kx(a);Array.isArray(o)&&(o=o.map(c=>Od(c))),g(e,["models"],o)}return e}function o1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["_self"]);if(a!=null){let o=kx(a);Array.isArray(o)&&(o=o.map(c=>Ld(c))),g(e,["models"],o)}return e}function l1(t){const e={},n=m(t,["maskMode"]);n!=null&&g(e,["maskMode"],n);const r=m(t,["segmentationClasses"]);r!=null&&g(e,["maskClasses"],r);const a=m(t,["maskDilation"]);return a!=null&&g(e,["dilation"],a),e}function Od(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);a!=null&&g(e,["description"],a);const o=m(t,["version"]);o!=null&&g(e,["version"],o);const c=m(t,["_self"]);c!=null&&g(e,["tunedModelInfo"],S1(c));const d=m(t,["inputTokenLimit"]);d!=null&&g(e,["inputTokenLimit"],d);const p=m(t,["outputTokenLimit"]);p!=null&&g(e,["outputTokenLimit"],p);const h=m(t,["supportedGenerationMethods"]);h!=null&&g(e,["supportedActions"],h);const x=m(t,["temperature"]);x!=null&&g(e,["temperature"],x);const v=m(t,["maxTemperature"]);v!=null&&g(e,["maxTemperature"],v);const w=m(t,["topP"]);w!=null&&g(e,["topP"],w);const _=m(t,["topK"]);_!=null&&g(e,["topK"],_);const E=m(t,["thinking"]);return E!=null&&g(e,["thinking"],E),e}function Ld(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["displayName"]);r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);a!=null&&g(e,["description"],a);const o=m(t,["versionId"]);o!=null&&g(e,["version"],o);const c=m(t,["deployedModels"]);if(c!=null){let v=c;Array.isArray(v)&&(v=v.map(w=>TC(w))),g(e,["endpoints"],v)}const d=m(t,["labels"]);d!=null&&g(e,["labels"],d);const p=m(t,["_self"]);p!=null&&g(e,["tunedModelInfo"],E1(p));const h=m(t,["defaultCheckpointId"]);h!=null&&g(e,["defaultCheckpointId"],h);const x=m(t,["checkpoints"]);if(x!=null){let v=x;Array.isArray(v)&&(v=v.map(w=>w)),g(e,["checkpoints"],v)}return e}function c1(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],NC(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],WN(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function u1(t){const e={},n=m(t,["productImage"]);return n!=null&&g(e,["image"],Dn(n)),e}function d1(t,e){const n={},r=m(t,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const a=m(t,["baseSteps"]);e!==void 0&&a!=null&&g(e,["parameters","baseSteps"],a);const o=m(t,["outputGcsUri"]);e!==void 0&&o!=null&&g(e,["parameters","storageUri"],o);const c=m(t,["seed"]);e!==void 0&&c!=null&&g(e,["parameters","seed"],c);const d=m(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&g(e,["parameters","safetySetting"],d);const p=m(t,["personGeneration"]);e!==void 0&&p!=null&&g(e,["parameters","personGeneration"],p);const h=m(t,["addWatermark"]);e!==void 0&&h!=null&&g(e,["parameters","addWatermark"],h);const x=m(t,["outputMimeType"]);e!==void 0&&x!=null&&g(e,["parameters","outputOptions","mimeType"],x);const v=m(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","compressionQuality"],v);const w=m(t,["enhancePrompt"]);e!==void 0&&w!=null&&g(e,["parameters","enhancePrompt"],w);const _=m(t,["labels"]);return e!==void 0&&_!=null&&g(e,["labels"],_),n}function f1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["source"]);a!=null&&p1(a,n);const o=m(e,["config"]);return o!=null&&d1(o,n),n}function h1(t){const e={},n=m(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>ql(a))),g(e,["generatedImages"],r)}return e}function p1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["personImage"]);e!==void 0&&a!=null&&g(e,["instances[0]","personImage","image"],Dn(a));const o=m(t,["productImages"]);if(e!==void 0&&o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>u1(d))),g(e,["instances[0]","productImages"],c)}return n}function m1(t){const e={},n=m(t,["referenceImage"]);n!=null&&g(e,["referenceImage"],Dn(n));const r=m(t,["referenceId"]);r!=null&&g(e,["referenceId"],r);const a=m(t,["referenceType"]);a!=null&&g(e,["referenceType"],a);const o=m(t,["maskImageConfig"]);o!=null&&g(e,["maskImageConfig"],l1(o));const c=m(t,["controlImageConfig"]);c!=null&&g(e,["controlImageConfig"],iC(c));const d=m(t,["styleImageConfig"]);d!=null&&g(e,["styleImageConfig"],d);const p=m(t,["subjectImageConfig"]);return p!=null&&g(e,["subjectImageConfig"],p),e}function Vx(t){const e={},n=m(t,["safetyAttributes","categories"]);n!=null&&g(e,["categories"],n);const r=m(t,["safetyAttributes","scores"]);r!=null&&g(e,["scores"],r);const a=m(t,["contentType"]);return a!=null&&g(e,["contentType"],a),e}function Hx(t){const e={},n=m(t,["safetyAttributes","categories"]);n!=null&&g(e,["categories"],n);const r=m(t,["safetyAttributes","scores"]);r!=null&&g(e,["scores"],r);const a=m(t,["contentType"]);return a!=null&&g(e,["contentType"],a),e}function g1(t){const e={},n=m(t,["category"]);if(n!=null&&g(e,["category"],n),m(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=m(t,["threshold"]);return r!=null&&g(e,["threshold"],r),e}function y1(t){const e={},n=m(t,["image"]);return n!=null&&g(e,["image"],Dn(n)),e}function x1(t,e){const n={},r=m(t,["mode"]);e!==void 0&&r!=null&&g(e,["parameters","mode"],r);const a=m(t,["maxPredictions"]);e!==void 0&&a!=null&&g(e,["parameters","maxPredictions"],a);const o=m(t,["confidenceThreshold"]);e!==void 0&&o!=null&&g(e,["parameters","confidenceThreshold"],o);const c=m(t,["maskDilation"]);e!==void 0&&c!=null&&g(e,["parameters","maskDilation"],c);const d=m(t,["binaryColorThreshold"]);e!==void 0&&d!=null&&g(e,["parameters","binaryColorThreshold"],d);const p=m(t,["labels"]);return e!==void 0&&p!=null&&g(e,["labels"],p),n}function v1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["source"]);a!=null&&w1(a,n);const o=m(e,["config"]);return o!=null&&x1(o,n),n}function b1(t){const e={},n=m(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>JC(a))),g(e,["generatedMasks"],r)}return e}function w1(t,e){const n={},r=m(t,["prompt"]);e!==void 0&&r!=null&&g(e,["instances[0]","prompt"],r);const a=m(t,["image"]);e!==void 0&&a!=null&&g(e,["instances[0]","image"],Dn(a));const o=m(t,["scribbleImage"]);return e!==void 0&&o!=null&&g(e,["instances[0]","scribble"],y1(o)),n}function Gx(t){const e={},n=m(t,["languageCode"]);n!=null&&g(e,["languageCode"],n);const r=m(t,["voiceConfig"]);if(r!=null&&g(e,["voiceConfig"],r),m(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function _1(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],ZC(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],e1(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}function zx(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let v=n;Array.isArray(v)&&(v=v.map(w=>CC(w))),g(e,["functionDeclarations"],v)}const r=m(t,["retrieval"]);r!=null&&g(e,["retrieval"],r);const a=m(t,["googleSearchRetrieval"]);a!=null&&g(e,["googleSearchRetrieval"],a);const o=m(t,["computerUse"]);if(o!=null&&g(e,["computerUse"],o),m(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const c=m(t,["codeExecution"]);c!=null&&g(e,["codeExecution"],c);const d=m(t,["enterpriseWebSearch"]);d!=null&&g(e,["enterpriseWebSearch"],d);const p=m(t,["googleMaps"]);p!=null&&g(e,["googleMaps"],p);const h=m(t,["googleSearch"]);h!=null&&g(e,["googleSearch"],h);const x=m(t,["urlContext"]);return x!=null&&g(e,["urlContext"],x),e}function S1(t){const e={},n=m(t,["baseModel"]);n!=null&&g(e,["baseModel"],n);const r=m(t,["createTime"]);r!=null&&g(e,["createTime"],r);const a=m(t,["updateTime"]);return a!=null&&g(e,["updateTime"],a),e}function E1(t){const e={},n=m(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&g(e,["baseModel"],n);const r=m(t,["createTime"]);r!=null&&g(e,["createTime"],r);const a=m(t,["updateTime"]);return a!=null&&g(e,["updateTime"],a),e}function T1(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);e!==void 0&&a!=null&&g(e,["description"],a);const o=m(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&g(e,["defaultCheckpointId"],o),n}function N1(t,e){const n={},r=m(t,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const a=m(t,["description"]);e!==void 0&&a!=null&&g(e,["description"],a);const o=m(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&g(e,["defaultCheckpointId"],o),n}function C1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","name"],Ge(t,r));const a=m(e,["config"]);return a!=null&&T1(a,n),n}function A1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["config"]);return a!=null&&N1(a,n),n}function I1(t,e){const n={},r=m(t,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const a=m(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);const o=m(t,["personGeneration"]);e!==void 0&&o!=null&&g(e,["parameters","personGeneration"],o);const c=m(t,["includeRaiReason"]);e!==void 0&&c!=null&&g(e,["parameters","includeRaiReason"],c);const d=m(t,["outputMimeType"]);e!==void 0&&d!=null&&g(e,["parameters","outputOptions","mimeType"],d);const p=m(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p);const h=m(t,["enhanceInputImage"]);e!==void 0&&h!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],h);const x=m(t,["imagePreservationFactor"]);e!==void 0&&x!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],x);const v=m(t,["labels"]);e!==void 0&&v!=null&&g(e,["labels"],v);const w=m(t,["numberOfImages"]);e!==void 0&&w!=null&&g(e,["parameters","sampleCount"],w);const _=m(t,["mode"]);return e!==void 0&&_!=null&&g(e,["parameters","mode"],_),n}function R1(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["_url","model"],Ge(t,r));const a=m(e,["image"]);a!=null&&g(n,["instances[0]","image"],Dn(a));const o=m(e,["upscaleFactor"]);o!=null&&g(n,["parameters","upscaleConfig","upscaleFactor"],o);const c=m(e,["config"]);return c!=null&&I1(c,n),n}function D1(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>ql(o))),g(e,["generatedImages"],a)}return e}function M1(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["encodedVideo"]);r!=null&&g(e,["videoBytes"],Hs(r));const a=m(t,["encoding"]);return a!=null&&g(e,["mimeType"],a),e}function k1(t){const e={},n=m(t,["gcsUri"]);n!=null&&g(e,["uri"],n);const r=m(t,["bytesBase64Encoded"]);r!=null&&g(e,["videoBytes"],Hs(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}function P1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["_self"],Dn(n));const r=m(t,["maskMode"]);return r!=null&&g(e,["maskMode"],r),e}function U1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["image"],Bl(n));const r=m(t,["referenceType"]);return r!=null&&g(e,["referenceType"],r),e}function j1(t){const e={},n=m(t,["image"]);n!=null&&g(e,["image"],Dn(n));const r=m(t,["referenceType"]);return r!=null&&g(e,["referenceType"],r),e}function Fx(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["uri"],n);const r=m(t,["videoBytes"]);r!=null&&g(e,["encodedVideo"],Hs(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["encoding"],a),e}function $x(t){const e={},n=m(t,["uri"]);n!=null&&g(e,["gcsUri"],n);const r=m(t,["videoBytes"]);r!=null&&g(e,["bytesBase64Encoded"],Hs(r));const a=m(t,["mimeType"]);return a!=null&&g(e,["mimeType"],a),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const O1="Content-Type",L1="X-Server-Timeout",q1="User-Agent",qd="x-goog-api-client",B1="1.29.1",V1=`google-genai-sdk/${B1}`,H1="v1beta1",G1="v1beta",by=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class z1{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:H1,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:G1,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const a=[this.getRequestUrlInternal(n)];return r&&a.push(this.getBaseResourcePath()),e!==""&&a.push(e),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[c,d]of Object.entries(e.queryParams))a.searchParams.append(c,String(d));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,a.toString(),e.abortSignal),this.unaryApiCall(a,o,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[a,o]of Object.entries(n))typeof o=="object"?r[a]=Object.assign(Object.assign({},r[a]),o):o!==void 0&&(r[a]=o);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,n,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,a.toString(),e.abortSignal),this.streamApiCall(a,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,a){if(n&&n.timeout||a){const o=new AbortController,c=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>o.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}a&&a.addEventListener("abort",()=>{o.abort()}),e.signal=c}return n&&n.extraBody!==null&&F1(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await wy(a),new Pd(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await wy(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(e){var n;return xi(this,arguments,function*(){const a=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let c="";for(;;){const{done:d,value:p}=yield st(a.read());if(d){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const h=o.decode(p,{stream:!0});try{const v=JSON.parse(h);if("error"in v){const w=JSON.parse(JSON.stringify(v.error)),_=w.status,E=w.code,T=`got status: ${_}. ${JSON.stringify(v)}`;if(E>=400&&E<600)throw new Ol({message:T,status:E})}}catch(v){if(v.name==="ApiError")throw v}c+=h;let x=c.match(by);for(;x;){const v=x[1];try{const w=new Response(v,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield st(new Pd(w)),c=c.slice(x[0].length),x=c.match(by)}catch(w){throw new Error(`exception parsing stream chunk ${v}. ${w}`)}}}}finally{a.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=V1+" "+this.clientOptions.userAgentExtra;return e[q1]=n,e[qd]=n,e[O1]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[a,o]of Object.entries(e.headers))r.append(a,o);e.timeout&&e.timeout>0&&r.append(L1,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const a={};n!=null&&(a.mimeType=n.mimeType,a.name=n.name,a.displayName=n.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const o=this.clientOptions.uploader,c=await o.stat(e);a.sizeBytes=String(c.size);const d=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:c.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=d;const p={file:a},h=this.getFileName(e),x=fe("upload/v1beta/files",p._url),v=await this.fetchUploadUrl(x,a.sizeBytes,a.mimeType,h,p,n==null?void 0:n.httpOptions);return o.upload(e,v,this)}async uploadFileToFileSearchStore(e,n,r){var a;const o=this.clientOptions.uploader,c=await o.stat(n),d=String(c.size),p=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:c.type;if(p===void 0||p==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${e}:uploadToFileSearchStore`,x=this.getFileName(n),v={};r!=null&&r.customMetadata&&(v.customMetadata=r.customMetadata),r!=null&&r.chunkingConfig&&(v.chunkingConfig=r.chunkingConfig);const w=await this.fetchUploadUrl(h,d,p,x,v,r==null?void 0:r.httpOptions);return o.uploadToFileSearchStore(n,w,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,a,o,c){var d;let p={};c?p=c:p={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const h=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:p});if(!h||!(h!=null&&h.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const x=(d=h==null?void 0:h.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(x===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return x}}async function wy(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const a=JSON.stringify(r);throw n>=400&&n<600?new Ol({message:a,status:n}):new Error(a)}}function F1(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(o,c){const d=Object.assign({},o);for(const p in c)if(Object.prototype.hasOwnProperty.call(c,p)){const h=c[p],x=d[p];h&&typeof h=="object"&&!Array.isArray(h)&&x&&typeof x=="object"&&!Array.isArray(x)?d[p]=r(x,h):(x&&h&&typeof x!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${p}". Original type: ${typeof x}, New type: ${typeof h}. Overwriting.`),d[p]=h)}return d}const a=r(n,e);t.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $1="mcp_used/unknown";let J1=!1;function Jx(t){for(const e of t)if(Y1(e)||typeof e=="object"&&"inputSchema"in e)return!0;return J1}function Yx(t){var e;const n=(e=t[qd])!==null&&e!==void 0?e:"";t[qd]=(n+` ${$1}`).trimStart()}function Y1(t){return t!==null&&typeof t=="object"&&t instanceof bf}function K1(t,e=100){return xi(this,arguments,function*(){let r,a=0;for(;a<e;){const o=yield st(t.listTools({cursor:r}));for(const c of o.tools)yield yield st(c),a++;if(!o.nextCursor)break;r=o.nextCursor}})}class bf{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new bf(e,n)}async initialize(){var e,n,r,a;if(this.mcpTools.length>0)return;const o={},c=[];for(const x of this.mcpClients)try{for(var d=!0,p=(n=void 0,Ia(K1(x))),h;h=await p.next(),e=h.done,!e;d=!0){a=h.value,d=!1;const v=a;c.push(v);const w=v.name;if(o[w])throw new Error(`Duplicate function name ${w} found in MCP tools. Please ensure function names are unique.`);o[w]=x}}catch(v){n={error:v}}finally{try{!d&&!e&&(r=p.return)&&await r.call(p)}finally{if(n)throw n.error}}this.mcpTools=c,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),eT(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const c=await a.callTool({name:r.name,arguments:r.args},void 0,o);n.push({functionResponse:{name:r.name,response:c.isError?{error:c}:c}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Q1(t,e,n){const r=new $E;let a;n.data instanceof Blob?a=JSON.parse(await n.data.text()):a=JSON.parse(n.data),Object.assign(r,a),e(r)}class X1{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),c=eA(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),p=`${a}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${d}`;let h=()=>{};const x=new Promise(C=>{h=C}),v=e.callbacks,w=function(){h({})},_=this.apiClient,E={onopen:w,onmessage:C=>{Q1(_,v.onmessage,C)},onerror:(n=v==null?void 0:v.onerror)!==null&&n!==void 0?n:function(C){},onclose:(r=v==null?void 0:v.onclose)!==null&&r!==void 0?r:function(C){}},T=this.webSocketFactory.create(p,Z1(c),E);T.connect(),await x;const k={setup:{model:Ge(this.apiClient,e.model)}};return T.send(JSON.stringify(k)),new W1(T,this.apiClient)}}class W1{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=GN(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=HN(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(gi.PLAY)}pause(){this.sendPlaybackControl(gi.PAUSE)}stop(){this.sendPlaybackControl(gi.STOP)}resetContext(){this.sendPlaybackControl(gi.RESET_CONTEXT)}close(){this.conn.close()}}function Z1(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function eA(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const tA="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function nA(t,e,n){const r=new FE;let a;n.data instanceof Blob?a=await n.data.text():n.data instanceof ArrayBuffer?a=new TextDecoder().decode(n.data):a=n.data;const o=JSON.parse(a);if(t.isVertexAI()){const c=$N(o);Object.assign(r,c)}else Object.assign(r,o);e(r)}class sA{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new X1(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,a,o,c,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const p=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let x;const v=this.apiClient.getHeaders();e.config&&e.config.tools&&Jx(e.config.tools)&&Yx(v);const w=oA(v);if(this.apiClient.isVertexAI())x=`${p}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(w,x);else{const Z=this.apiClient.getApiKey();let W="BidiGenerateContent",le="key";Z!=null&&Z.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),W="BidiGenerateContentConstrained",le="access_token"),x=`${p}/ws/google.ai.generativelanguage.${h}.GenerativeService.${W}?${le}=${Z}`}let _=()=>{};const E=new Promise(Z=>{_=Z}),T=e.callbacks,M=function(){var Z;(Z=T==null?void 0:T.onopen)===null||Z===void 0||Z.call(T),_({})},P=this.apiClient,k={onopen:M,onmessage:Z=>{nA(P,T.onmessage,Z)},onerror:(n=T==null?void 0:T.onerror)!==null&&n!==void 0?n:function(Z){},onclose:(r=T==null?void 0:T.onclose)!==null&&r!==void 0?r:function(Z){}},C=this.webSocketFactory.create(x,aA(w),k);C.connect(),await E;let I=Ge(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&I.startsWith("publishers/")){const Z=this.apiClient.getProject(),W=this.apiClient.getLocation();I=`projects/${Z}/locations/${W}/`+I}let j={};this.apiClient.isVertexAI()&&((a=e.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[_l.AUDIO]}:e.config.responseModalities=[_l.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const B=(d=(c=e.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[],H=[];for(const Z of B)if(this.isCallableTool(Z)){const W=Z;H.push(await W.tool())}else H.push(Z);H.length>0&&(e.config.tools=H);const Q={model:I,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?j=VN(this.apiClient,Q):j=BN(this.apiClient,Q),delete j.config,C.send(JSON.stringify(j)),new iA(C,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const rA={turnComplete:!0};class iA{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=wn(n.turns),e.isVertexAI()||(r=r.map(a=>Ll(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(tA)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},rA),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:FN(e)}:n={realtimeInput:zN(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function aA(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function oA(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _y=10;function Sy(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let a=!1;for(const c of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(vi(c)){a=!0;break}if(!a)return!0;const o=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function vi(t){return"callTool"in t&&typeof t.callTool=="function"}function lA(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(a=>vi(a)))!==null&&r!==void 0?r:!1}function Ey(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,a)=>{if(vi(r))return;const o=r;o.functionDeclarations&&o.functionDeclarations.length>0&&n.push(a)}),n}function Ty(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cA extends cs{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,a,o,c,d;const p=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!lA(n)||Sy(n.config))return await this.generateContentInternal(p);const h=Ey(n);if(h.length>0){const T=h.map(M=>`tools[${M}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${T}.`)}let x,v;const w=wn(p.contents),_=(o=(a=(r=p.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&o!==void 0?o:_y;let E=0;for(;E<_&&(x=await this.generateContentInternal(p),!(!x.functionCalls||x.functionCalls.length===0));){const T=x.candidates[0].content,M=[];for(const P of(d=(c=n.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[])if(vi(P)){const C=await P.callTool(x.functionCalls);M.push(...C)}E++,v={role:"user",parts:M},p.contents=wn(p.contents),p.contents.push(T),p.contents.push(v),Ty(p.config)&&(w.push(T),w.push(v))}return Ty(p.config)&&(x.automaticFunctionCallingHistory=w),x},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),Sy(n.config)){const a=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(a)}const r=Ey(n);if(r.length>0){const a=r.map(o=>`tools[${o}]`).join(", ");throw new Error(`Incompatible tools found at ${a}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var a;let o;const c=[];if(r!=null&&r.generatedImages)for(const p of r.generatedImages)p&&(p!=null&&p.safetyAttributes)&&((a=p==null?void 0:p.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?o=p==null?void 0:p.safetyAttributes:c.push(p);let d;return o?d={generatedImages:c,positivePromptSafetyAttributes:o,sdkHttpResponse:r.sdkHttpResponse}:d={generatedImages:c,sdkHttpResponse:r.sdkHttpResponse},d}),this.list=async n=>{var r;const c={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((r=c.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new br(os.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(c),c)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const a={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async n=>{var r,a,o,c,d,p;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((a=n.video)===null||a===void 0)&&a.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((c=(o=n.source)===null||o===void 0?void 0:o.video)===null||c===void 0)&&c.uri&&(!((p=(d=n.source)===null||d===void 0?void 0:d.video)===null||p===void 0)&&p.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,a;const o=(n=e.config)===null||n===void 0?void 0:n.tools;if(!o)return e;const c=await Promise.all(o.map(async p=>vi(p)?await p.tool():p)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:c})};if(d.config.tools=c,e.config&&e.config.tools&&Jx(e.config.tools)){const p=(a=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let h=Object.assign({},p);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),Yx(h),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return d}async initAfcToolsMap(e){var n,r,a;const o=new Map;for(const c of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(vi(c)){const d=c,p=await d.tool();for(const h of(a=p.functionDeclarations)!==null&&a!==void 0?a:[]){if(!h.name)throw new Error("Function declaration name is required.");if(o.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);o.set(h.name,d)}}return o}async processAfcStream(e){var n,r,a;const o=(a=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:_y;let c=!1,d=0;const p=await this.initAfcToolsMap(e);return(function(h,x,v){var w,_;return xi(this,arguments,function*(){for(var E,T,M,P;d<o;){c&&(d++,c=!1);const j=yield st(h.processParamsMaybeAddMcpUsage(v)),B=yield st(h.generateContentStreamInternal(j)),H=[],Q=[];try{for(var k=!0,C=(T=void 0,Ia(B)),I;I=yield st(C.next()),E=I.done,!E;k=!0){P=I.value,k=!1;const Z=P;if(yield yield st(Z),Z.candidates&&(!((w=Z.candidates[0])===null||w===void 0)&&w.content)){Q.push(Z.candidates[0].content);for(const W of(_=Z.candidates[0].content.parts)!==null&&_!==void 0?_:[])if(d<o&&W.functionCall){if(!W.functionCall.name)throw new Error("Function call name was not returned by the model.");if(x.has(W.functionCall.name)){const le=yield st(x.get(W.functionCall.name).callTool([W.functionCall]));H.push(...le)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${x.keys()}, mising tool: ${W.functionCall.name}`)}}}}catch(Z){T={error:Z}}finally{try{!k&&!E&&(M=C.return)&&(yield st(M.call(C)))}finally{if(T)throw T.error}}if(H.length>0){c=!0;const Z=new Ca;Z.candidates=[{content:{role:"user",parts:H}}],yield yield st(Z);const W=[];W.push(...Q),W.push({role:"user",parts:H});const le=wn(v.contents).concat(W);v.contents=le}else break}})})(this,p,e)}async generateContentInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=yy(this.apiClient,e);return d=fe("{model}:generateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=vy(x),w=new Ca;return Object.assign(w,v),w})}else{const h=gy(this.apiClient,e);return d=fe("{model}:generateContent",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=xy(x),w=new Ca;return Object.assign(w,v),w})}}async generateContentStreamInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=yy(this.apiClient,e);return d=fe("{model}:streamGenerateContent?alt=sse",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),c.then(function(v){return xi(this,arguments,function*(){var w,_,E,T;try{for(var M=!0,P=Ia(v),k;k=yield st(P.next()),w=k.done,!w;M=!0){T=k.value,M=!1;const C=T,I=vy(yield st(C.json()));I.sdkHttpResponse={headers:C.headers};const j=new Ca;Object.assign(j,I),yield yield st(j)}}catch(C){_={error:C}}finally{try{!M&&!w&&(E=P.return)&&(yield st(E.call(P)))}finally{if(_)throw _.error}}})})}else{const h=gy(this.apiClient,e);return d=fe("{model}:streamGenerateContent?alt=sse",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),c.then(function(v){return xi(this,arguments,function*(){var w,_,E,T;try{for(var M=!0,P=Ia(v),k;k=yield st(P.next()),w=k.done,!w;M=!0){T=k.value,M=!1;const C=T,I=xy(yield st(C.json()));I.sdkHttpResponse={headers:C.headers};const j=new Ca;Object.assign(j,I),yield yield st(j)}}catch(C){_={error:C}}finally{try{!M&&!w&&(E=P.return)&&(yield st(E.call(P)))}finally{if(_)throw _.error}}})})}}async embedContent(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=_C(this.apiClient,e);return d=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=EC(x),w=new ey;return Object.assign(w,v),w})}else{const h=wC(this.apiClient,e);return d=fe("{model}:batchEmbedContents",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=SC(x),w=new ey;return Object.assign(w,v),w})}}async generateImagesInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=kC(this.apiClient,e);return d=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=UC(x),w=new ty;return Object.assign(w,v),w})}else{const h=MC(this.apiClient,e);return d=fe("{model}:predict",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=PC(x),w=new ty;return Object.assign(w,v),w})}}async editImageInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=yC(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=xC(p),x=new PE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=R1(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=D1(p),x=new UE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=f1(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=h1(p),x=new jE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=v1(this.apiClient,e);return o=fe("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=b1(p),x=new OE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=WC(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Ld(x))}else{const h=XC(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Od(x))}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=i1(this.apiClient,e);return d=fe("{models_url}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=o1(x),w=new ny;return Object.assign(w,v),w})}else{const h=r1(this.apiClient,e);return d=fe("{models_url}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=a1(x),w=new ny;return Object.assign(w,v),w})}}async update(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=A1(this.apiClient,e);return d=fe("{model}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>Ld(x))}else{const h=C1(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>Od(x))}}async delete(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=hC(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=mC(x),w=new sy;return Object.assign(w,v),w})}else{const h=fC(this.apiClient,e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=pC(x),w=new sy;return Object.assign(w,v),w})}}async countTokens(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=cC(this.apiClient,e);return d=fe("{model}:countTokens",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=dC(x),w=new ry;return Object.assign(w,v),w})}else{const h=lC(this.apiClient,e);return d=fe("{model}:countTokens",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=uC(x),w=new ry;return Object.assign(w,v),w})}}async computeTokens(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=tC(this.apiClient,e);return o=fe("{model}:computeTokens",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>{const h=nC(p),x=new LE;return Object.assign(x,h),x})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=VC(this.apiClient,e);return d=fe("{model}:predictLongRunning",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c.then(x=>{const v=qC(x),w=new Sl;return Object.assign(w,v),w})}else{const h=BC(this.apiClient,e);return d=fe("{model}:predictLongRunning",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c.then(x=>{const v=LC(x),w=new Sl;return Object.assign(w,v),w})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uA extends cs{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=AE(e);return d=fe("{operationName}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json()),c}else{const h=CE(e);return d=fe("{operationName}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json()),c}}async fetchPredictVideosOperationInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=bE(e);return o=fe("{resourceName}:fetchPredictOperation",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dA(t){const e={},n=m(t,["data"]);if(n!=null&&g(e,["data"],n),m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function fA(t){const e={},n=m(t,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(o=>bA(o))),g(e,["parts"],a)}const r=m(t,["role"]);return r!=null&&g(e,["role"],r),e}function hA(t,e,n){const r={},a=m(e,["expireTime"]);n!==void 0&&a!=null&&g(n,["expireTime"],a);const o=m(e,["newSessionExpireTime"]);n!==void 0&&o!=null&&g(n,["newSessionExpireTime"],o);const c=m(e,["uses"]);n!==void 0&&c!=null&&g(n,["uses"],c);const d=m(e,["liveConnectConstraints"]);n!==void 0&&d!=null&&g(n,["bidiGenerateContentSetup"],vA(t,d));const p=m(e,["lockAdditionalFields"]);return n!==void 0&&p!=null&&g(n,["fieldMask"],p),r}function pA(t,e){const n={},r=m(e,["config"]);return r!=null&&g(n,["config"],hA(t,r,n)),n}function mA(t){const e={};if(m(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(t,["fileUri"]);n!=null&&g(e,["fileUri"],n);const r=m(t,["mimeType"]);return r!=null&&g(e,["mimeType"],r),e}function gA(t){const e={};if(m(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(t,["enableWidget"]);return n!=null&&g(e,["enableWidget"],n),e}function yA(t){const e={};if(m(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(t,["timeRangeFilter"]);return n!=null&&g(e,["timeRangeFilter"],n),e}function xA(t,e){const n={},r=m(t,["generationConfig"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig"],r);const a=m(t,["responseModalities"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","responseModalities"],a);const o=m(t,["temperature"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","temperature"],o);const c=m(t,["topP"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","topP"],c);const d=m(t,["topK"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","topK"],d);const p=m(t,["maxOutputTokens"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","maxOutputTokens"],p);const h=m(t,["mediaResolution"]);e!==void 0&&h!=null&&g(e,["setup","generationConfig","mediaResolution"],h);const x=m(t,["seed"]);e!==void 0&&x!=null&&g(e,["setup","generationConfig","seed"],x);const v=m(t,["speechConfig"]);e!==void 0&&v!=null&&g(e,["setup","generationConfig","speechConfig"],vf(v));const w=m(t,["thinkingConfig"]);e!==void 0&&w!=null&&g(e,["setup","generationConfig","thinkingConfig"],w);const _=m(t,["enableAffectiveDialog"]);e!==void 0&&_!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],_);const E=m(t,["systemInstruction"]);e!==void 0&&E!=null&&g(e,["setup","systemInstruction"],fA(jt(E)));const T=m(t,["tools"]);if(e!==void 0&&T!=null){let B=Ni(T);Array.isArray(B)&&(B=B.map(H=>_A(Ti(H)))),g(e,["setup","tools"],B)}const M=m(t,["sessionResumption"]);e!==void 0&&M!=null&&g(e,["setup","sessionResumption"],wA(M));const P=m(t,["inputAudioTranscription"]);e!==void 0&&P!=null&&g(e,["setup","inputAudioTranscription"],P);const k=m(t,["outputAudioTranscription"]);e!==void 0&&k!=null&&g(e,["setup","outputAudioTranscription"],k);const C=m(t,["realtimeInputConfig"]);e!==void 0&&C!=null&&g(e,["setup","realtimeInputConfig"],C);const I=m(t,["contextWindowCompression"]);e!==void 0&&I!=null&&g(e,["setup","contextWindowCompression"],I);const j=m(t,["proactivity"]);return e!==void 0&&j!=null&&g(e,["setup","proactivity"],j),n}function vA(t,e){const n={},r=m(e,["model"]);r!=null&&g(n,["setup","model"],Ge(t,r));const a=m(e,["config"]);return a!=null&&g(n,["config"],xA(a,n)),n}function bA(t){const e={},n=m(t,["functionCall"]);n!=null&&g(e,["functionCall"],n);const r=m(t,["codeExecutionResult"]);r!=null&&g(e,["codeExecutionResult"],r);const a=m(t,["executableCode"]);a!=null&&g(e,["executableCode"],a);const o=m(t,["fileData"]);o!=null&&g(e,["fileData"],mA(o));const c=m(t,["functionResponse"]);c!=null&&g(e,["functionResponse"],c);const d=m(t,["inlineData"]);d!=null&&g(e,["inlineData"],dA(d));const p=m(t,["text"]);p!=null&&g(e,["text"],p);const h=m(t,["thought"]);h!=null&&g(e,["thought"],h);const x=m(t,["thoughtSignature"]);x!=null&&g(e,["thoughtSignature"],x);const v=m(t,["videoMetadata"]);return v!=null&&g(e,["videoMetadata"],v),e}function wA(t){const e={},n=m(t,["handle"]);if(n!=null&&g(e,["handle"],n),m(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function _A(t){const e={},n=m(t,["functionDeclarations"]);if(n!=null){let x=n;Array.isArray(x)&&(x=x.map(v=>v)),g(e,["functionDeclarations"],x)}if(m(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=m(t,["googleSearchRetrieval"]);r!=null&&g(e,["googleSearchRetrieval"],r);const a=m(t,["computerUse"]);a!=null&&g(e,["computerUse"],a);const o=m(t,["fileSearch"]);o!=null&&g(e,["fileSearch"],o);const c=m(t,["codeExecution"]);if(c!=null&&g(e,["codeExecution"],c),m(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=m(t,["googleMaps"]);d!=null&&g(e,["googleMaps"],gA(d));const p=m(t,["googleSearch"]);p!=null&&g(e,["googleSearch"],yA(p));const h=m(t,["urlContext"]);return h!=null&&g(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SA(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(o=>`${n}.${o}`);e.push(...a)}else e.push(n)}return e.join(",")}function EA(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const o=r.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,n=o):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const a=t.fieldMask;if(n){const o=SA(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?t.fieldMask=o:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];a.length>0&&(d=a.map(h=>c.includes(h)?`generationConfig.${h}`:h));const p=[];o&&p.push(o),d.length>0&&p.push(...d),p.length>0?t.fieldMask=p.join(","):delete t.fieldMask}else delete t.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?t.fieldMask=a.join(","):delete t.fieldMask;return t}class TA extends cs{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=pA(this.apiClient,e);o=fe("auth_tokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query;const p=EA(d,e.config);return a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),a.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function NA(t,e){const n={},r=m(t,["displayName"]);return e!==void 0&&r!=null&&g(e,["displayName"],r),n}function CA(t){const e={},n=m(t,["config"]);return n!=null&&NA(n,e),e}function AA(t,e){const n={},r=m(t,["force"]);return e!==void 0&&r!=null&&g(e,["_query","force"],r),n}function IA(t){const e={},n=m(t,["name"]);n!=null&&g(e,["_url","name"],n);const r=m(t,["config"]);return r!=null&&AA(r,e),e}function RA(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","name"],n),e}function DA(t,e){const n={},r=m(t,["customMetadata"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["customMetadata"],o)}const a=m(t,["chunkingConfig"]);return e!==void 0&&a!=null&&g(e,["chunkingConfig"],a),n}function MA(t){const e={},n=m(t,["name"]);n!=null&&g(e,["name"],n);const r=m(t,["metadata"]);r!=null&&g(e,["metadata"],r);const a=m(t,["done"]);a!=null&&g(e,["done"],a);const o=m(t,["error"]);o!=null&&g(e,["error"],o);const c=m(t,["response"]);return c!=null&&g(e,["response"],PA(c)),e}function kA(t){const e={},n=m(t,["fileSearchStoreName"]);n!=null&&g(e,["_url","file_search_store_name"],n);const r=m(t,["fileName"]);r!=null&&g(e,["fileName"],r);const a=m(t,["config"]);return a!=null&&DA(a,e),e}function PA(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["parent"]);r!=null&&g(e,["parent"],r);const a=m(t,["documentName"]);return a!=null&&g(e,["documentName"],a),e}function UA(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function jA(t){const e={},n=m(t,["config"]);return n!=null&&UA(n,e),e}function OA(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["fileSearchStores"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["fileSearchStores"],o)}return e}function LA(t,e){const n={},r=m(t,["mimeType"]);e!==void 0&&r!=null&&g(e,["mimeType"],r);const a=m(t,["displayName"]);e!==void 0&&a!=null&&g(e,["displayName"],a);const o=m(t,["customMetadata"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>p)),g(e,["customMetadata"],d)}const c=m(t,["chunkingConfig"]);return e!==void 0&&c!=null&&g(e,["chunkingConfig"],c),n}function qA(t){const e={},n=m(t,["fileSearchStoreName"]);n!=null&&g(e,["_url","file_search_store_name"],n);const r=m(t,["config"]);return r!=null&&LA(r,e),e}function BA(t){const e={},n=m(t,["sdkHttpResponse"]);return n!=null&&g(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function VA(t,e){const n={},r=m(t,["force"]);return e!==void 0&&r!=null&&g(e,["_query","force"],r),n}function HA(t){const e={},n=m(t,["name"]);n!=null&&g(e,["_url","name"],n);const r=m(t,["config"]);return r!=null&&VA(r,e),e}function GA(t){const e={},n=m(t,["name"]);return n!=null&&g(e,["_url","name"],n),e}function zA(t,e){const n={},r=m(t,["pageSize"]);e!==void 0&&r!=null&&g(e,["_query","pageSize"],r);const a=m(t,["pageToken"]);return e!==void 0&&a!=null&&g(e,["_query","pageToken"],a),n}function FA(t){const e={},n=m(t,["parent"]);n!=null&&g(e,["_url","parent"],n);const r=m(t,["config"]);return r!=null&&zA(r,e),e}function $A(t){const e={},n=m(t,["sdkHttpResponse"]);n!=null&&g(e,["sdkHttpResponse"],n);const r=m(t,["nextPageToken"]);r!=null&&g(e,["nextPageToken"],r);const a=m(t,["documents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(c=>c)),g(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class JA extends cs{constructor(e){super(),this.apiClient=e,this.list=async n=>new br(os.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=GA(e);return o=fe("{name}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=HA(e);a=fe("{name}",c._url),o=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=FA(e);return o=fe("{parent}/documents",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=$A(p),x=new qE;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class YA extends cs{constructor(e,n=new JA(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new br(os.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=CA(e);return o=fe("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async get(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=RA(e);return o=fe("{name}",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>p)}}async delete(e){var n,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=IA(e);a=fe("{name}",c._url),o=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=jA(e);return o=fe("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=OA(p),x=new BE;return Object.assign(x,h),x})}}async uploadToFileSearchStoreInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=qA(e);return o=fe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=BA(p),x=new VE;return Object.assign(x,h),x})}}async importFile(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=kA(e);return o=fe("{file_search_store_name}:importFile",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json()),a.then(p=>{const h=MA(p),x=new pf;return Object.assign(x,h),x})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KA(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function QA(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function XA(t,e,n){const r={};if(m(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=m(t,["tunedModelDisplayName"]);if(e!==void 0&&a!=null&&g(e,["displayName"],a),m(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=m(t,["epochCount"]);e!==void 0&&o!=null&&g(e,["tuningTask","hyperparameters","epochCount"],o);const c=m(t,["learningRateMultiplier"]);if(c!=null&&g(r,["tuningTask","hyperparameters","learningRateMultiplier"],c),m(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(m(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(m(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=m(t,["batchSize"]);e!==void 0&&d!=null&&g(e,["tuningTask","hyperparameters","batchSize"],d);const p=m(t,["learningRate"]);if(e!==void 0&&p!=null&&g(e,["tuningTask","hyperparameters","learningRate"],p),m(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(m(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function WA(t,e,n){const r={};let a=m(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const _=m(t,["validationDataset"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec"],Ny(_))}else if(a==="PREFERENCE_TUNING"){const _=m(t,["validationDataset"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec"],Ny(_))}const o=m(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&g(e,["tunedModelDisplayName"],o);const c=m(t,["description"]);e!==void 0&&c!=null&&g(e,["description"],c);let d=m(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const _=m(t,["epochCount"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],_)}else if(d==="PREFERENCE_TUNING"){const _=m(t,["epochCount"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],_)}let p=m(n,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const _=m(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],_)}else if(p==="PREFERENCE_TUNING"){const _=m(t,["learningRateMultiplier"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],_)}let h=m(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const _=m(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],_)}else if(h==="PREFERENCE_TUNING"){const _=m(t,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],_)}let x=m(n,["config","method"]);if(x===void 0&&(x="SUPERVISED_FINE_TUNING"),x==="SUPERVISED_FINE_TUNING"){const _=m(t,["adapterSize"]);e!==void 0&&_!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],_)}else if(x==="PREFERENCE_TUNING"){const _=m(t,["adapterSize"]);e!==void 0&&_!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],_)}if(m(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(m(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const v=m(t,["labels"]);e!==void 0&&v!=null&&g(e,["labels"],v);const w=m(t,["beta"]);return e!==void 0&&w!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],w),r}function ZA(t,e){const n={},r=m(t,["baseModel"]);r!=null&&g(n,["baseModel"],r);const a=m(t,["preTunedModel"]);a!=null&&g(n,["preTunedModel"],a);const o=m(t,["trainingDataset"]);o!=null&&u2(o);const c=m(t,["config"]);return c!=null&&XA(c,n),n}function e2(t,e){const n={},r=m(t,["baseModel"]);r!=null&&g(n,["baseModel"],r);const a=m(t,["preTunedModel"]);a!=null&&g(n,["preTunedModel"],a);const o=m(t,["trainingDataset"]);o!=null&&d2(o,n,e);const c=m(t,["config"]);return c!=null&&WA(c,n,e),n}function t2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function n2(t,e){const n={},r=m(t,["name"]);return r!=null&&g(n,["_url","name"],r),n}function s2(t,e,n){const r={},a=m(t,["pageSize"]);e!==void 0&&a!=null&&g(e,["_query","pageSize"],a);const o=m(t,["pageToken"]);e!==void 0&&o!=null&&g(e,["_query","pageToken"],o);const c=m(t,["filter"]);return e!==void 0&&c!=null&&g(e,["_query","filter"],c),r}function r2(t,e,n){const r={},a=m(t,["pageSize"]);e!==void 0&&a!=null&&g(e,["_query","pageSize"],a);const o=m(t,["pageToken"]);e!==void 0&&o!=null&&g(e,["_query","pageToken"],o);const c=m(t,["filter"]);return e!==void 0&&c!=null&&g(e,["_query","filter"],c),r}function i2(t,e){const n={},r=m(t,["config"]);return r!=null&&s2(r,n),n}function a2(t,e){const n={},r=m(t,["config"]);return r!=null&&r2(r,n),n}function o2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["nextPageToken"]);a!=null&&g(n,["nextPageToken"],a);const o=m(t,["tunedModels"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>Kx(d))),g(n,["tuningJobs"],c)}return n}function l2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["nextPageToken"]);a!=null&&g(n,["nextPageToken"],a);const o=m(t,["tuningJobs"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>Bd(d))),g(n,["tuningJobs"],c)}return n}function c2(t,e){const n={},r=m(t,["name"]);r!=null&&g(n,["model"],r);const a=m(t,["name"]);return a!=null&&g(n,["endpoint"],a),n}function u2(t,e){const n={};if(m(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=m(t,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),g(n,["examples","examples"],a)}return n}function d2(t,e,n){const r={};let a=m(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const c=m(t,["gcsUri"]);e!==void 0&&c!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(a==="PREFERENCE_TUNING"){const c=m(t,["gcsUri"]);e!==void 0&&c!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}let o=m(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const c=m(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(o==="PREFERENCE_TUNING"){const c=m(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}if(m(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function Kx(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["state"]);o!=null&&g(n,["state"],Rx(o));const c=m(t,["createTime"]);c!=null&&g(n,["createTime"],c);const d=m(t,["tuningTask","startTime"]);d!=null&&g(n,["startTime"],d);const p=m(t,["tuningTask","completeTime"]);p!=null&&g(n,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(n,["updateTime"],h);const x=m(t,["description"]);x!=null&&g(n,["description"],x);const v=m(t,["baseModel"]);v!=null&&g(n,["baseModel"],v);const w=m(t,["_self"]);return w!=null&&g(n,["tunedModel"],c2(w)),n}function Bd(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["state"]);o!=null&&g(n,["state"],Rx(o));const c=m(t,["createTime"]);c!=null&&g(n,["createTime"],c);const d=m(t,["startTime"]);d!=null&&g(n,["startTime"],d);const p=m(t,["endTime"]);p!=null&&g(n,["endTime"],p);const h=m(t,["updateTime"]);h!=null&&g(n,["updateTime"],h);const x=m(t,["error"]);x!=null&&g(n,["error"],x);const v=m(t,["description"]);v!=null&&g(n,["description"],v);const w=m(t,["baseModel"]);w!=null&&g(n,["baseModel"],w);const _=m(t,["tunedModel"]);_!=null&&g(n,["tunedModel"],_);const E=m(t,["preTunedModel"]);E!=null&&g(n,["preTunedModel"],E);const T=m(t,["supervisedTuningSpec"]);T!=null&&g(n,["supervisedTuningSpec"],T);const M=m(t,["preferenceOptimizationSpec"]);M!=null&&g(n,["preferenceOptimizationSpec"],M);const P=m(t,["tuningDataStats"]);P!=null&&g(n,["tuningDataStats"],P);const k=m(t,["encryptionSpec"]);k!=null&&g(n,["encryptionSpec"],k);const C=m(t,["partnerModelTuningSpec"]);C!=null&&g(n,["partnerModelTuningSpec"],C);const I=m(t,["customBaseModel"]);I!=null&&g(n,["customBaseModel"],I);const j=m(t,["experiment"]);j!=null&&g(n,["experiment"],j);const B=m(t,["labels"]);B!=null&&g(n,["labels"],B);const H=m(t,["outputUri"]);H!=null&&g(n,["outputUri"],H);const Q=m(t,["pipelineJob"]);Q!=null&&g(n,["pipelineJob"],Q);const Z=m(t,["serviceAccount"]);Z!=null&&g(n,["serviceAccount"],Z);const W=m(t,["tunedModelDisplayName"]);W!=null&&g(n,["tunedModelDisplayName"],W);const le=m(t,["veoTuningSpec"]);return le!=null&&g(n,["veoTuningSpec"],le),n}function f2(t,e){const n={},r=m(t,["sdkHttpResponse"]);r!=null&&g(n,["sdkHttpResponse"],r);const a=m(t,["name"]);a!=null&&g(n,["name"],a);const o=m(t,["metadata"]);o!=null&&g(n,["metadata"],o);const c=m(t,["done"]);c!=null&&g(n,["done"],c);const d=m(t,["error"]);return d!=null&&g(n,["error"],d),n}function Ny(t,e){const n={},r=m(t,["gcsUri"]);r!=null&&g(n,["validationDatasetUri"],r);const a=m(t,["vertexDatasetResource"]);return a!=null&&g(n,["validationDatasetUri"],a),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class h2 extends cs{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new br(os.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const a={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=n.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},n),{preTunedModel:a});return o.baseModel=void 0,await this.tuneInternal(o)}else{const a=Object.assign({},n);return await this.tuneInternal(a)}else{const a=Object.assign({},n),o=await this.tuneMldevInternal(a);let c="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?c=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(c=o.name.split("/operations/")[0]),{name:c,state:kd.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=n2(e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>Bd(x))}else{const h=t2(e);return d=fe("{name}",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>Kx(x))}}async listInternal(e){var n,r,a,o;let c,d="",p={};if(this.apiClient.isVertexAI()){const h=a2(e);return d=fe("tuningJobs",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=l2(x),w=new iy;return Object.assign(w,v),w})}else{const h=i2(e);return d=fe("tunedModels",h._url),p=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(x=>x.json().then(v=>{const w=v;return w.sdkHttpResponse={headers:x.headers},w})),c.then(x=>{const v=o2(x),w=new iy;return Object.assign(w,v),w})}}async cancel(e){var n,r,a,o;let c="",d={};if(this.apiClient.isVertexAI()){const p=QA(e);c=fe("{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const p=KA(e);c=fe("{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI()){const d=e2(e,e);return o=fe("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>Bd(p))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let a,o="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=ZA(e);return o=fe("tunedModels",d._url),c=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(p=>p.json().then(h=>{const x=h;return x.sdkHttpResponse={headers:p.headers},x})),a.then(p=>f2(p))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class p2{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const m2=1024*1024*8,g2=3,y2=1e3,x2=2,Tl="x-goog-upload-status";async function v2(t,e,n){var r;const a=await Qx(t,e,n),o=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[Tl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function b2(t,e,n){var r;const a=await Qx(t,e,n),o=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[Tl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const c=Ex(o),d=new mf;return Object.assign(d,c),d}async function Qx(t,e,n){var r,a;let o=0,c=0,d=new Pd(new Response),p="upload";for(o=t.size;c<o;){const h=Math.min(m2,o-c),x=t.slice(c,c+h);c+h>=o&&(p+=", finalize");let v=0,w=y2;for(;v<g2&&(d=await n.request({path:"",body:x,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(c),"Content-Length":String(h)}}}),!(!((r=d==null?void 0:d.headers)===null||r===void 0)&&r[Tl]));)v++,await _2(w),w=w*x2;if(c+=h,((a=d==null?void 0:d.headers)===null||a===void 0?void 0:a[Tl])!=="active")break;if(o<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function w2(t){return{size:t.size,type:t.type}}function _2(t){return new Promise(e=>setTimeout(e,t))}class S2{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await v2(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await b2(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await w2(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class E2{create(e,n,r){return new T2(e,n,r)}}class T2{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cy="x-goog-api-key";class N2{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(Cy)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Cy,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const C2="gl-node/";class an{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=xE(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const a=new N2(this.apiKey);this.apiClient=new z1({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:C2+"web",uploader:new S2,downloader:new p2}),this.models=new cA(this.apiClient),this.live=new sA(this.apiClient,a,new E2),this.batches=new GT(this.apiClient),this.chats=new wN(this.models,this.apiClient),this.caches=new xN(this.apiClient),this.files=new DN(this.apiClient),this.operations=new uA(this.apiClient),this.authTokens=new TA(this.apiClient),this.tunings=new h2(this.apiClient),this.fileSearchStores=new YA(this.apiClient)}}const Xx="text-embedding-004",Vs=768,A2=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>{const o=r.result.split(",")[1];e({inlineData:{data:o,mimeType:t.type}})},r.onerror=a=>n(a)}),Mn=async t=>{var e,n;if(!t||t.trim()==="")return new Array(Vs).fill(0);try{const a=await new an({apiKey:"AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c"}).models.embedContent({model:Xx,contents:[{parts:[{text:t}]}]});if((n=(e=a.embeddings)==null?void 0:e[0])!=null&&n.values)return a.embeddings[0].values;throw new Error("No embedding values returned from embedding service.")}catch(r){return console.error("Error generating embedding:",r),new Array(Vs).fill(0)}},I2=async t=>{var e,n;try{const r=new an({apiKey:"AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c"}),a=await A2(t),o=await r.models.embedContent({model:Xx,contents:[{parts:[a]}]});if((n=(e=o.embeddings)==null?void 0:e[0])!=null&&n.values)return o.embeddings[0].values;throw new Error("No embedding values returned from image embedding service.")}catch(r){return console.error("Error generating image embedding:",r),new Array(Vs).fill(0)}},R2=async(t,e,n=.7,r=.3)=>{const a=await Mn(t);if(!e)return a;const o=await I2(e);return a.map((c,d)=>c*n+o[d]*r)},md=["users","shops","customers","suppliers","products","items","inventory","batches","sales","drivers","visual","marketplace","dan_inventory"],D2="58fc3ff2-2f13-11ef-b75e-0242ac110002",Nl={size:Vs,distance:"Cosine"},M2=t=>{let e=t.trim();for(;e.endsWith("/");)e=e.slice(0,-1);return e},Ay=M2("http://localhost:8787/qdrant"),pe=Ay?new pE({url:Ay}):null;let de=null,Ai=null,Ba=null;const Iy=t=>{const e=de;de=(t==null?void 0:t.id)||null,Ai=(t==null?void 0:t.name)||null,t!=null&&t.contactEmail,t!=null&&t.location,Ba=(t==null?void 0:t.qdrantNamespace)||null,e!==de&&console.log(`[Core] setActiveShopContext: ${e||"null"} -> ${de||"null"}`)},k2={users:{userId:{type:"keyword"},displayName:{type:"keyword"},contactEmail:{type:"keyword"},email:{type:"keyword"},shopId:{type:"keyword"},isVerified:{type:"bool"},isDriverVerified:{type:"bool"}},shops:{shopId:{type:"keyword"},userId:{type:"keyword"},name:{type:"keyword"}},suppliers:{supplierId:{type:"keyword"},shopId:{type:"keyword"},linkedUserId:{type:"keyword"},name:{type:"keyword"}},products:{productId:{type:"keyword"},category:{type:"keyword"},manufacturer:{type:"keyword"},defaultSupplierId:{type:"keyword"}},items:{inventoryUuid:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"},batchId:{type:"keyword"},supplierId:{type:"keyword"},status:{type:"keyword"},quantity:{type:"integer"},expiration:{type:"keyword"}},batches:{batchId:{type:"keyword"},shopId:{type:"keyword"},supplierId:{type:"keyword"},deliveryDate:{type:"keyword"},inventoryDate:{type:"keyword"}},sales:{saleId:{type:"keyword"},shopId:{type:"keyword"},timestamp:{type:"keyword"}},customers:{customerId:{type:"keyword"},userId:{type:"keyword"},name:{type:"keyword"}},drivers:{driverId:{type:"keyword"},userId:{type:"keyword"},status:{type:"keyword"}},visual:{shopId:{type:"keyword"},productId:{type:"keyword"},fieldName:{type:"keyword"}},marketplace:{listingId:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"}},dan_inventory:{inventoryUuid:{type:"keyword"},shopId:{type:"keyword"},productId:{type:"keyword"},productName:{type:"keyword"},locationBucket:{type:"keyword"},shareScope:{type:"keyword"},expirationDate:{type:"keyword"}}},Tn=new Map,bi=t=>t?typeof t=="string"?t:t.message||t.statusText||JSON.stringify(t):"Unknown error",Lt=(t,e)=>{new Date().toISOString();const n=`[Qdrant] ${e}`;t==="error"?console.error(n):t==="warn"?console.warn(n):console.info(n)},P2=t=>{if(!t)return{params:null,named:!1,vectorName:null};if(typeof t.size=="number")return{params:t,named:!1,vectorName:null};const e=Object.keys(t||{});if("default"in t&&t.default&&typeof t.default.size=="number"){const n=e.some(r=>r!=="default");return{params:t.default,named:n,vectorName:n?"default":null}}if(e.length>=1){const n=e.find(r=>t[r]&&typeof t[r].size=="number");if(n)return{params:t[n],named:n!=="default",vectorName:n}}return{params:null,named:!0,vectorName:null}},U2=async t=>{if(!pe)return!1;const e=k2[t];if(!e)return!0;try{const n=await pe.getCollection(t),r=(n==null?void 0:n.payload_schema)||{};for(const[a,o]of Object.entries(e)){const c=r==null?void 0:r[a],d=c==null?void 0:c.data_type;if(d!==o.type){if(c&&d!==o.type)try{await pe.deletePayloadIndex(t,a),Lt("info",`Deleted existing index '${t}.${a}' (wrong type)`)}catch(p){Lt("warn",`Failed to delete index '${t}.${a}': ${bi(p)}`)}try{await pe.createPayloadIndex(t,{field_name:a,field_schema:o}),Lt("info",`Created index '${t}.${a}' (${o.type})`)}catch(p){Lt("error",`Failed to create index '${t}.${a}': ${bi(p)}`)}}}return!0}catch(n){return Lt("error",`Failed to ensure indexes for '${t}': ${bi(n)}`),!1}},j2=async t=>{var e,n;if(!pe)return{exists:!1,valid:!1,vectorConfig:null};try{const r=await pe.getCollection(t),{params:a,named:o,vectorName:c}=P2((n=(e=r==null?void 0:r.config)==null?void 0:e.params)==null?void 0:n.vectors),d=(a==null?void 0:a.size)===Nl.size&&(a==null?void 0:a.distance)===Nl.distance;return{exists:!0,valid:d,vectorConfig:d?{named:o,vectorName:o?c||"default":null}:null}}catch(r){return r.status===404?{exists:!1,valid:!1,vectorConfig:null}:(Lt("error",`Error verifying collection '${t}': ${bi(r)}`),{exists:!1,valid:!1,vectorConfig:null})}},Wx=async t=>{if(!pe)return!1;const e=Tn.get(t);if(e!=null&&e.ready)return!0;if(e!=null&&e.promise)return e.promise;e||Tn.set(t,{ready:!1,promise:null,vectorConfig:null});const n=(async()=>{try{const{exists:r,valid:a,vectorConfig:o}=await j2(t);return r?a?(Tn.set(t,{ready:!1,promise:null,vectorConfig:o}),await U2(t)?(Tn.set(t,{ready:!0,promise:null,vectorConfig:o}),Lt("info",`Collection '${t}' is ready`),!0):(Tn.set(t,{ready:!1,promise:null,vectorConfig:o}),!1)):(Lt("error",`Collection '${t}' has invalid configuration. Expected: size=${Nl.size}, distance=${Nl.distance}`),Tn.set(t,{ready:!1,promise:null,vectorConfig:null}),!1):(Lt("error",`Collection '${t}' does not exist. Please run setup script first.`),Tn.set(t,{ready:!1,promise:null,vectorConfig:null}),!1)}catch(r){return Lt("error",`Failed to ensure collection '${t}': ${bi(r)}`),Tn.set(t,{ready:!1,promise:null,vectorConfig:null}),!1}finally{const r=Tn.get(t);r&&(r.promise=null)}})();return Tn.set(t,{ready:!1,promise:n,vectorConfig:null}),n},Zx=async()=>{if(!pe){Lt("warn","Qdrant client not available");return}Lt("info","Ensuring all base collections are ready...");const t=await Promise.allSettled(md.map(r=>Wx(r))),e=[],n=[];t.forEach((r,a)=>{const o=md[a];if(r.status==="fulfilled"&&r.value)e.push(o);else{n.push(o);const c=r.status==="rejected"?bi(r.reason):"Not ready";Lt("warn",`Collection '${o}' failed: ${c}`)}}),Lt("info",`Collections ready: ${e.length}/${md.length}. Ready: ${e.join(", ")}${n.length>0?` | Failed: ${n.join(", ")}`:""}`)},ev=t=>{var e;return((e=Tn.get(t))==null?void 0:e.vectorConfig)||null},We=async t=>{const e=await Wx(t);return e||Lt("warn",`Collection '${t}' is not ready  operation will be skipped`),e},O2=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function L2(t){return typeof t=="string"&&O2.test(t)}function Ry(t){if(!L2(t))throw TypeError("Invalid UUID");let e;return Uint8Array.of((e=parseInt(t.slice(0,8),16))>>>24,e>>>16&255,e>>>8&255,e&255,(e=parseInt(t.slice(9,13),16))>>>8,e&255,(e=parseInt(t.slice(14,18),16))>>>8,e&255,(e=parseInt(t.slice(19,23),16))>>>8,e&255,(e=parseInt(t.slice(24,36),16))/1099511627776&255,e/4294967296&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255)}const Dt=[];for(let t=0;t<256;++t)Dt.push((t+256).toString(16).slice(1));function tv(t,e=0){return(Dt[t[e+0]]+Dt[t[e+1]]+Dt[t[e+2]]+Dt[t[e+3]]+"-"+Dt[t[e+4]]+Dt[t[e+5]]+"-"+Dt[t[e+6]]+Dt[t[e+7]]+"-"+Dt[t[e+8]]+Dt[t[e+9]]+"-"+Dt[t[e+10]]+Dt[t[e+11]]+Dt[t[e+12]]+Dt[t[e+13]]+Dt[t[e+14]]+Dt[t[e+15]]).toLowerCase()}let gd;const q2=new Uint8Array(16);function B2(){if(!gd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");gd=crypto.getRandomValues.bind(crypto)}return gd(q2)}function V2(t){t=unescape(encodeURIComponent(t));const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e}const H2="6ba7b810-9dad-11d1-80b4-00c04fd430c8",G2="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function z2(t,e,n,r,a,o){const c=typeof n=="string"?V2(n):n,d=typeof r=="string"?Ry(r):r;if(typeof r=="string"&&(r=Ry(r)),(r==null?void 0:r.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let p=new Uint8Array(16+c.length);if(p.set(d),p.set(c,d.length),p=e(p),p[6]=p[6]&15|t,p[8]=p[8]&63|128,a){o=o||0;for(let h=0;h<16;++h)a[o+h]=p[h];return a}return tv(p)}const F2=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Dy={randomUUID:F2};function $2(t,e,n){var a;t=t||{};const r=t.random??((a=t.rng)==null?void 0:a.call(t))??B2();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,tv(r)}function Et(t,e,n){return Dy.randomUUID&&!t?Dy.randomUUID():$2(t)}function J2(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}}function yd(t,e){return t<<e|t>>>32-e}function Y2(t){const e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520],r=new Uint8Array(t.length+1);r.set(t),r[t.length]=128,t=r;const a=t.length/4+2,o=Math.ceil(a/16),c=new Array(o);for(let d=0;d<o;++d){const p=new Uint32Array(16);for(let h=0;h<16;++h)p[h]=t[d*64+h*4]<<24|t[d*64+h*4+1]<<16|t[d*64+h*4+2]<<8|t[d*64+h*4+3];c[d]=p}c[o-1][14]=(t.length-1)*8/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=(t.length-1)*8&4294967295;for(let d=0;d<o;++d){const p=new Uint32Array(80);for(let E=0;E<16;++E)p[E]=c[d][E];for(let E=16;E<80;++E)p[E]=yd(p[E-3]^p[E-8]^p[E-14]^p[E-16],1);let h=n[0],x=n[1],v=n[2],w=n[3],_=n[4];for(let E=0;E<80;++E){const T=Math.floor(E/20),M=yd(h,5)+J2(T,x,v,w)+_+e[T]+p[E]>>>0;_=w,w=v,v=yd(x,30)>>>0,x=h,h=M}n[0]=n[0]+h>>>0,n[1]=n[1]+x>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+w>>>0,n[4]=n[4]+_>>>0}return Uint8Array.of(n[0]>>24,n[0]>>16,n[0]>>8,n[0],n[1]>>24,n[1]>>16,n[1]>>8,n[1],n[2]>>24,n[2]>>16,n[2]>>8,n[2],n[3]>>24,n[3]>>16,n[3]>>8,n[3],n[4]>>24,n[4]>>16,n[4]>>8,n[4])}function wf(t,e,n,r){return z2(80,Y2,t,e,n,r)}wf.DNS=H2;wf.URL=G2;const qt=(t,e)=>wf(`${t}:${e}`,D2),qn=t=>{const e=String(t||"default"),n=new Array(Vs).fill(0);for(let r=0;r<Vs;r++)n[r]=(e.charCodeAt(r%e.length)||0)%100/1e3;return n},Bt=(t,e,n)=>{const r=()=>qn(e);if(!Array.isArray(t))return r();if(t.length!==Vs)return console.warn(`[Qdrant] ${n}: Vector length ${t.length} != ${Vs}. Using placeholder.`),r();for(let a=0;a<t.length;a++){const o=t[a];if(typeof o!="number"||!Number.isFinite(o))return console.warn(`[Qdrant] ${n}: Invalid vector value at index ${a}: ${o}. Using placeholder.`),r()}return t},on=(t,e)=>{const n=ev(t);return n!=null&&n.named?{vectors:{[n.vectorName||"default"]:e}}:{vector:e}},K2=(t,e)=>{const n=ev(t);return n!=null&&n.named?{name:n.vectorName||"default",vector:e}:e},nv=(t,e)=>e?t==="items"?{should:[{key:"shopId",match:{value:e}},{nested:{path:"shopId",filter:{must:[{key:"shopId.id",match:{value:e}}]}}}],minimum_should:1}:{key:"shopId",match:{value:e}}:null,ft=async(t,e)=>{if(!pe)return[];if(!await We(t))return[];const n=[];let r,a=3,o=null;e&&(typeof e=="string"?o=e:typeof e=="object"&&e!==null&&"id"in e?(o=e.id||null,console.warn(`[Qdrant] fetchAllPoints received shopFilter as object instead of string. Extracted id: ${o}`)):console.warn(`[Qdrant] fetchAllPoints received invalid shopFilter type: ${typeof e}`));const c=nv(t,o),d=c?{must:[c]}:void 0;o&&t==="items"&&console.log(`[Qdrant] fetchAllPoints: Querying 'items' collection with shopId filter: ${o}`);do{try{const p=await pe.scroll(t,{with_payload:!0,limit:100,offset:r??void 0,filter:d}),h=(p==null?void 0:p.points)??[];n.push(...h),r=(p==null?void 0:p.next_page_offset)??void 0,o&&t==="items"&&h.length>0&&console.log(`[Qdrant] fetchAllPoints: Fetched ${h.length} items in this batch (total so far: ${n.length})`)}catch(p){if(console.error(`[Qdrant] Scroll error in '${t}' (Retry ${a}, Filter: ${JSON.stringify(d)}):`,p),(p==null?void 0:p.status)===400&&o&&t==="items"&&a===3){console.warn("[Qdrant] Nested filter may not be supported. Falling back to JavaScript filtering...");const h=[];let x;do try{const w=await pe.scroll(t,{with_payload:!0,limit:100,offset:x??void 0});h.push(...(w==null?void 0:w.points)??[]),x=(w==null?void 0:w.next_page_offset)??void 0}catch(w){console.error("[Qdrant] Error fetching all items for fallback filter:",w);break}while(x);const v=h.filter(w=>{var E;const _=(E=w.payload)==null?void 0:E.shopId;return typeof _=="string"?_===o:_&&typeof _=="object"&&"id"in _?_.id===o:!1});return console.log(`[Qdrant] Fallback filter: Found ${v.length} items matching shopId ${o} out of ${h.length} total`),v}if((p==null?void 0:p.status)===400&&a>0){console.info(`[Qdrant] Retrying scroll in '${t}'...`),a--,await new Promise(h=>setTimeout(h,1e3));continue}r=void 0}if(!r||n.length>1e5)break}while(r);return o&&t==="items"?console.log(`[Qdrant] fetchAllPoints: Total ${n.length} items fetched for shopId: ${o}`):console.info(`[Qdrant] Successfully fetched ${n.length} points from '${t}'.`),n},Q2=async(t,e,n,r=10)=>{if(!pe)return[];if(!await We(t))return[];const a=[];if(n.shopId){const o=typeof n.shopId=="string"?n.shopId:n.shopId&&typeof n.shopId=="object"&&n.shopId!==null&&"id"in n.shopId?n.shopId.id:null;if(o){const c=nv(t,o);c&&a.push(c)}}n.status&&a.push({key:"status",match:{value:n.status}}),n.quantityMin!==void 0&&a.push({key:"quantity",range:{gt:n.quantityMin}}),Object.entries(n).forEach(([o,c])=>{!["shopId","status","quantityMin"].includes(o)&&c!==void 0&&a.push({key:o,match:{value:c}})});try{const o=await pe.search(t,{vector:e,limit:r,with_payload:!0,filter:a.length>0?{must:a}:void 0});return Array.isArray(o)?o:(o==null?void 0:o.points)??[]}catch(o){return console.error(`[Qdrant] Search failed in '${t}':`,o),[]}},sv=t=>{const e=t.payload;return{id:(e==null?void 0:e.productId)||String(t.id),name:(e==null?void 0:e.name)||"Unnamed Product",manufacturer:(e==null?void 0:e.manufacturer)||"",category:(e==null?void 0:e.category)||"",description:(e==null?void 0:e.description)||"",defaultSupplierId:(e==null?void 0:e.defaultSupplierId)||null,images:(e==null?void 0:e.images)||[],audit:(e==null?void 0:e.audit)||[],embeddings:(e==null?void 0:e.embeddings)||void 0}},Va=async()=>pe?(await ft("products",null)).map(sv):[],_f=async(t,e)=>{if(!pe||!await We("products"))return;const n=Array.isArray(t.embeddings)&&t.embeddings.length>0,r=Bt(n?t.embeddings:null,t.id,`products:${t.id}`),a=n&&r===t.embeddings?r:void 0,o=qt("products",t.id),c={productId:t.id,name:t.name,manufacturer:t.manufacturer,category:t.category,description:t.description||"",defaultSupplierId:t.defaultSupplierId||null,images:t.images||[],audit:e?[...t.audit||[],e]:t.audit||[],embeddings:a};await pe.upsert("products",{wait:!0,points:[{id:o,...on("products",r),payload:c}]})},Ii=async t=>{var r;const e={id:Et(),name:t.name.trim(),manufacturer:t.manufacturer.trim(),category:t.category.trim(),description:((r=t.description)==null?void 0:r.trim())||"",defaultSupplierId:t.defaultSupplierId||null,images:t.images||[],audit:[],embeddings:t.embeddings||(t.name?await Mn(t.name):qn(Et()))},n=de?{userId:de,shopId:de,action:"create",timestamp:new Date().toISOString()}:void 0;return await _f(e,n),e},rv=async(t,e)=>{var d,p,h;const r=(await Va()).find(x=>x.id===t);if(!r)throw new Error(`Product with ID ${t} not found`);const a=e.embeddings||(e.name&&e.name!==r.name?await Mn(e.name):r.embeddings),o={...r,name:((d=e.name)==null?void 0:d.trim())||r.name,manufacturer:((p=e.manufacturer)==null?void 0:p.trim())||r.manufacturer,category:((h=e.category)==null?void 0:h.trim())||r.category,description:e.description!==void 0?e.description.trim():r.description,defaultSupplierId:e.defaultSupplierId!==void 0?e.defaultSupplierId:r.defaultSupplierId,images:e.images!==void 0?e.images:r.images,embeddings:a},c=de?{userId:de,shopId:de,action:"update",timestamp:new Date().toISOString()}:void 0;return await _f(o,c),o},iv=async t=>{pe&&await We("products")&&await pe.delete("products",{wait:!0,points:[qt("products",t)]})},av=async(t,e=24)=>{if(!pe)return[];const n=t.trim();if(!n)return(await Va()).slice(0,e);if(!await We("products"))return[];const r=await Mn(n),a=Bt(r,`products:search:${n}`,`products-search:${Date.now()}`);return(await pe.search("products",{vector:a,limit:e,with_payload:!0})).map(sv).filter(c=>!!c.name)},ov=async t=>pe?(await ft("batches",t)).map(n=>{const r=n.payload;return{id:(r==null?void 0:r.batchId)||String(n.id),shopId:r==null?void 0:r.shopId,supplierId:r==null?void 0:r.supplierId,deliveryDate:r==null?void 0:r.deliveryDate,inventoryDate:r==null?void 0:r.inventoryDate,invoiceNumber:r==null?void 0:r.invoiceNumber,documents:(r==null?void 0:r.documents)||[],lineItems:(r==null?void 0:r.lineItems)||[],createdAt:r==null?void 0:r.createdAt,createdByUserId:r==null?void 0:r.createdByUserId}}):[],lv=async()=>de?ov(de):[],Sf=async t=>{if(!pe||!await We("batches"))return;const e=Bt(qn(t.id),t.id,`batches:${t.id}`),n=qt("batches",t.id),r={batchId:t.id,shopId:t.shopId,supplierId:t.supplierId||null,deliveryDate:t.deliveryDate,inventoryDate:t.inventoryDate||null,invoiceNumber:t.invoiceNumber||null,documents:t.documents||[],lineItems:t.lineItems||[],createdAt:t.createdAt,createdByUserId:t.createdByUserId};await pe.upsert("batches",{wait:!0,points:[{id:n,...on("batches",e),payload:r}]})},wr=async t=>{if(!pe||!await We("users"))return;const e=t.qdrantUserId||t.userId,n=qt("users",e);let r={};try{const c=await pe.retrieve("users",{ids:[n],with_payload:!0});if(c.points&&c.points.length>0){const d=c.points[0].payload;r={isVerified:d.isVerified,isDriverVerified:d.isDriverVerified}}}catch{}const a={userId:t.userId,displayName:t.displayName||t.email||t.userId,contactEmail:t.contactEmail||t.email||"",email:t.email||t.contactEmail||"",shopId:t.shopId||de||null,isVerified:t.isVerified!==void 0?t.isVerified:r.isVerified,isDriverVerified:t.isDriverVerified!==void 0?t.isDriverVerified:r.isDriverVerified},o=Bt(qn(e),e,`users:${e}`);await pe.upsert("users",{wait:!0,points:[{id:n,payload:a,...on("users",o)}]})},cv=async()=>{},uv=async t=>{if(!pe||!await We("shops"))return;const e=Bt(qn(t.id),t.id,`shops:${t.id}`),n=qt("shops",t.id),r={shopId:t.id,userId:t.userId||"",name:t.name,contact:t.contactEmail||"",contactEmail:t.contactEmail||"",qdrantNamespace:t.qdrantNamespace||null,metadata:t.location?{location:t.location}:{}};await pe.upsert("shops",{wait:!0,points:[{id:n,...on("shops",e),payload:r}]})},dv=async t=>{if(!pe||!await We("customers"))return;const e=Bt(qn(t.id),t.id,`customers:${t.id}`),n=qt("customers",t.id);await pe.upsert("customers",{wait:!0,points:[{id:n,...on("customers",e),payload:{customerId:t.id,userId:t.userId||null,name:t.fullName,contact:t.contactEmail||""}}]})},Vl=async t=>{if(!pe||!await We("drivers"))return;const e=Bt(qn(t.id),t.id,`drivers:${t.id}`),n=qt("drivers",t.id);await pe.upsert("drivers",{wait:!0,points:[{id:n,...on("drivers",e),payload:{driverId:t.id,userId:t.userId||null,name:t.fullName,contact:t.contactEmail||"",status:t.status||"pending"}}]})},Ef=async t=>{if(!pe||!await We("suppliers"))return;const e=t.name?await Mn(t.name):null,n=Bt(e,t.id,`suppliers:${t.id}`),r=qt("suppliers",t.id),a={supplierId:t.id,name:t.name,contact:t.contactEmail||"",contactEmail:t.contactEmail||"",shopId:t.shopId||null,linkedUserId:t.linkedUserId||t.userId||null,metadata:t.metadata||{},embeddings:n};await pe.upsert("suppliers",{wait:!0,points:[{id:r,...on("suppliers",n),payload:a}]})},Gs=async()=>!pe||!de?[]:(await ft("suppliers",null)).map(e=>{const n=e.payload;return{id:(n==null?void 0:n.supplierId)||String(e.id),shopId:(n==null?void 0:n.shopId)||null,linkedUserId:(n==null?void 0:n.linkedUserId)||(n==null?void 0:n.userId)||null,name:(n==null?void 0:n.name)||"Supplier",contact:(n==null?void 0:n.contact)||"",contactEmail:(n==null?void 0:n.contact)||(n==null?void 0:n.contactEmail)||"",metadata:(n==null?void 0:n.metadata)||{}}}).filter(e=>e.shopId===de||e.linkedUserId!==null),Ri=async t=>{if(!de)throw new Error("No shop selected.");const e=Et();return await Ef({id:e,name:t.name,contactEmail:t.contactEmail,shopId:de,linkedUserId:null}),{id:e,shopId:de,linkedUserId:null,name:t.name,contact:t.contactEmail,contactEmail:t.contactEmail,metadata:{}}},fv=async()=>pe?await We("shops")?(await ft("shops",null)).map(e=>{const n=e.payload;return{id:n.shopId,name:n.name,contactEmail:n.contactEmail||n.contact}}):[]:[],hv=async t=>{if(!pe||!await We("shops"))return null;try{const e=qt("shops",t),n=await pe.retrieve("shops",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;return{id:r.shopId,name:r.name,contactEmail:r.contactEmail||r.contact}}return null}catch(e){return console.error("[Users] Error validating shop:",e),null}},xd=new Map,pv=async t=>{if(xd.has(t))return xd.get(t).name;const n=(await ft("products",null)).find(r=>{var a;return((a=r.payload)==null?void 0:a.productId)===t});if(n){const r=n.payload;return xd.set(t,{name:r.name||"unknown product",manufacturer:r.manufacturer||"",category:r.category||""}),r.name||"unknown product"}return"unknown product"},Hl=async(t,e)=>{if(!pe||!de||!await We("items"))return;const n=t.inventoryUuid||t.qdrantId||Et();t.inventoryUuid||(t.inventoryUuid=n),t.qdrantId||(t.qdrantId=n);const r=new Date().toISOString(),a=t.status||(t.quantity>0?"ACTIVE":"EMPTY"),o=await pv(t.productId),c=await Mn(o),d=Bt(c,n,`items:${n}`),p=e||t.scanMetadata||null,h=t.buyPrice??t.costPerUnit??null,x=t.sellPrice??(h?h*1.4:null),v=t.shareScope||["local"],w={inventoryUuid:n,shopId:de,productId:t.productId,batchId:t.batchId||"",supplierId:t.supplierId||void 0,buyPrice:h??void 0,sellPrice:x??void 0,quantity:t.quantity||0,expiration:t.expirationDate||r,location:t.location||void 0,status:a,images:t.images||[],scanMetadata:p,createdByUserId:de,createdAt:t.createdAt||r,updatedAt:t.updatedAt||r,embeddings:d,shareScope:v,shareProofHash:t.shareProofHash};await pe.upsert("items",{wait:!0,points:[{id:n,...on("items",d),payload:w}]})},mv=async t=>{if(!pe)return;const e=t.inventoryUuid||t.qdrantId;if(e){await pe.delete("items",{wait:!0,points:[e]});return}de&&await pe.delete("items",{wait:!0,filter:{must:[{key:"shopId",match:{value:de}},{key:"productId",match:{value:t.productId}}]}})},X2=async(t,e,n)=>{if(!pe||!de||!await We("items"))return;const r=new Date().toISOString(),a=new Date(t.deliveryDate),o=new Date(a.setFullYear(a.getFullYear()+1)).toISOString().split("T")[0],c=await Promise.all(e.filter(d=>d.productId&&d.quantity>0).map(async d=>{const p=Et(),h=d.cost||0,x=h*1.4,v=await pv(d.productId),w=await Mn(v),_=Bt(w,p,`items:${p}`),E=n==null?void 0:n.get(d.productId),T={inventoryUuid:p,shopId:de,productId:d.productId,batchId:t.id,supplierId:t.supplierId||void 0,buyPrice:h,sellPrice:x,quantity:d.quantity,expiration:o,location:void 0,status:"ACTIVE",images:(E==null?void 0:E.images)||[],scanMetadata:(E==null?void 0:E.scanMetadata)||null,createdByUserId:de,createdAt:r,updatedAt:r,embeddings:_,shareScope:["local"]};return{id:p,...on("items",_),payload:T}}));c.length>0&&(await pe.upsert("items",{wait:!0,points:c}),console.log(`[Inventory] Added ${c.length} inventory items from batch ${t.id}`))},Tf=async(t,e,n=10)=>{if(!pe||!e)return[];if(!await We("items"))return[];const r=Bt(t,`${e}-query`,`search:${e}`),a=K2("items",r);return(await Q2("items",a,{shopId:e,quantityMin:0,status:"ACTIVE"},n)).map(c=>{const d=c.payload,p=d==null?void 0:d.shopId,h=typeof p=="string"?p:p&&typeof p=="object"&&p!==null&&"id"in p?p.id:e;return{id:Date.now()+Math.random(),inventoryUuid:d.inventoryUuid||String(c.id),shopId:h,productId:d.productId,batchId:d.batchId,expirationDate:d.expiration,quantity:d.quantity,costPerUnit:d.buyPrice||0,location:d.location||void 0,supplierId:d.supplierId||void 0,buyPrice:d.buyPrice,sellPrice:d.sellPrice,images:d.images||[],scanMetadata:d.scanMetadata,qdrantId:d.inventoryUuid||String(c.id),status:d.status,createdByUserId:d.createdByUserId,createdAt:d.createdAt,updatedAt:d.updatedAt,shareScope:d.shareScope||["local"],shareProofHash:d.shareProofHash}})},gv=async t=>(await ft("items",t)).map(n=>{const r=n.payload,a=r==null?void 0:r.shopId,o=typeof a=="string"?a:a&&typeof a=="object"&&a!==null&&"id"in a?a.id:t;return{id:Date.now()+Math.random(),inventoryUuid:r.inventoryUuid||String(n.id),shopId:o,productId:r.productId,batchId:r.batchId,expirationDate:r.expiration,quantity:r.quantity,costPerUnit:r.buyPrice||0,location:r.location||void 0,supplierId:r.supplierId||void 0,buyPrice:r.buyPrice,sellPrice:r.sellPrice,images:r.images||[],scanMetadata:r.scanMetadata,qdrantId:r.inventoryUuid||String(n.id),status:r.status,createdByUserId:r.createdByUserId,createdAt:r.createdAt,updatedAt:r.updatedAt,shareScope:r.shareScope||["local"],shareProofHash:r.shareProofHash}}).filter(n=>n.quantity>0&&n.status!=="EMPTY"&&n.status!=="EXPIRED"),Nf=async t=>{if(!pe||!de||!await We("sales"))return;const e=Bt(qn(t.id),t.id,`sales:${t.id}`),n=qt("sales",t.id),r=on("sales",e);await pe.upsert("sales",{wait:!0,points:[{id:n,...r,payload:{saleId:t.id,shopId:de,timestamp:t.timestamp,lineItems:t.items,totalAmount:t.totalAmount}}]})},W2=async(t,e)=>{if(!de)throw new Error("No shop selected.");const n=[];let r=0;const a=1.4,o=[],c=[],d=await gv(de);for(const h of t){let x=h.quantity;const v=e.get(h.productName);if(!v)continue;const w=d.filter(_=>_.productId===v.id&&_.quantity>0).sort((_,E)=>new Date(_.expirationDate).getTime()-new Date(E.expirationDate).getTime());for(const _ of w){if(x<=0)break;const E=Math.min(_.quantity,x);_.quantity-=E,x-=E;const T=_.costPerUnit*a;n.push({productId:v.id,quantity:E,priceAtSale:T}),r+=E*T,_.quantity===0?c.push(_):o.push(_)}}const p={id:Date.now(),timestamp:new Date().toISOString(),items:n,totalAmount:r};for(const h of o)await Hl(h);return await Promise.all(c.map(mv)),await Nf(p),console.log(`[Sales] Recorded sale ${p.id} with total $${r.toFixed(2)}.`),p},yv=async t=>(await ft("sales",t)).map(n=>{const r=n.payload;return{id:r.saleId,timestamp:r.timestamp,items:r.lineItems||[],totalAmount:r.totalAmount||0}}),Vd=new Map,Z2=async t=>{if(!pe||!de||!await We("marketplace"))return;const e=Bt(qn(t.id),t.id,`marketplace:${t.id}`),n=qt("marketplace",t.id);await pe.upsert("marketplace",{wait:!0,points:[{id:n,...on("marketplace",e),payload:{shopId:de,listingId:t.id,productId:t.productId,productName:t.productName,quantity:t.quantity,price:t.price}}]})},xv=async t=>{if(!de)throw new Error("No shop selected.");const e={...t,id:Date.now()};Vd.set(e.id,e),await Z2(e),console.info(`[Marketplace] Listed ${e.quantity} of ${e.productName}.`)},vv=async()=>Vd.size>0?Array.from(Vd.values()):de?(await ft("marketplace",de)).map(e=>{const n=e.payload;return{id:n.listingId||Date.now(),productId:n.productId,productName:n.productName,quantity:n.quantity,price:n.price}}):[],eI=async(t,e,n,r)=>{if(!de)throw new Error("No shop selected.");const a=new Date().toISOString().split("T")[0],o={supplier:t.seller.name,deliveryDate:a,inventoryDate:a},c={productName:t.productName,manufacturer:t.manufacturer,category:t.category,expirationDate:"2025-12-31",quantity:e,quantityType:t.quantityType,costPerUnit:t.price,location:"Marketplace Intake"};await n(o,[c]);const d={id:Date.now(),timestamp:new Date().toISOString(),items:[{productId:t.productName.toLowerCase().trim().replace(/\s+/g,"-"),quantity:e,priceAtSale:t.price}],totalAmount:t.price*e,source:{type:"marketplace",supplierName:t.seller.name,listingId:t.listingId}};await r(d),console.info(`[Marketplace] Purchased ${e} of ${t.productName} from ${t.seller.name}.`)},tI=new Map,bv=t=>t.toLowerCase().trim().replace(/\s+/g,"-"),nI=t=>`${de||"global"}:${t}`,sI=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(r.result.split(",")[1]),r.onerror=a=>n(a)}),rI=(t,e)=>t&&t.trim().length>0?t.trim():e?bv(e):"unlabeled-product",Cf=async(t,e,n,r)=>{const a=rI(r==null?void 0:r.productId,t),o=nI(a),c=await sI(n),d=`${o}-${e}`;if(tI.set(d,{imageBase64:c,mimeType:n.type}),!pe||!de||!await We("visual"))return d;const p=Bt(qn(d),d,`visual:${d}`);try{await pe.upsert("visual",{wait:!0,points:[{id:qt("visual",d),...on("visual",p),payload:{shopId:de,productId:o,fieldName:e,imageBase64:c,mimeType:n.type,source:(r==null?void 0:r.source)||"manual",batchId:(r==null?void 0:r.batchId)||null,metadata:(r==null?void 0:r.metadata)||null,capturedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}]})}catch(h){console.error("[Qdrant] Failed to upsert visual feature:",h)}return d},My=t=>{const e=de||"global";return t.startsWith(`${e}:`)?t:`${e}:${t}`},wv=async t=>{const e=new Map;if(!de||!pe)return e;const n=new Set;t.includes(":")?n.add(t):(n.add(My(t)),n.add(My(bv(t))));const r=async a=>{let o;do{const c=await pe.scroll("visual",{filter:{must:[{key:"shopId",match:{value:de}},{key:"productId",match:{value:a}}]},with_payload:!0,limit:50,offset:o??void 0});((c==null?void 0:c.points)??[]).forEach(p=>{const h=p.payload;h!=null&&h.fieldName&&(h!=null&&h.imageBase64)&&(h!=null&&h.mimeType)&&e.set(h.fieldName,{imageBase64:h.imageBase64,mimeType:h.mimeType})}),o=(c==null?void 0:c.next_page_offset)??void 0}while(o)};for(const a of n)if(await r(a),e.size>0)break;return e},gr="dan_inventory",_v=async t=>{if(!pe||!await We(gr))return;const e=t.vector||await Mn(`${t.productName} ${t.locationBucket||""} ${t.quantity}`),n=Bt(e,t.inventoryUuid,`${gr}:${t.inventoryUuid}`),r={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:t.productName,quantity:t.quantity,expirationDate:t.expirationDate,locationBucket:t.locationBucket||null,sellPrice:t.sellPrice??null,shopId:t.shopId,shopName:t.shopName||null,shareScope:t.shareScope,proofHash:t.proofHash,updatedAt:t.updatedAt||new Date().toISOString()};await pe.upsert(gr,{wait:!0,points:[{id:t.inventoryUuid,...on(gr,n),payload:r}]})},iI=async t=>{pe&&await We(gr)&&await pe.delete(gr,{wait:!0,points:[t]})},aI=async()=>(await ft(gr,null)).map(e=>{var r;const n=e.payload;return{inventoryUuid:(n==null?void 0:n.inventoryUuid)||String(e.id),shopId:(n==null?void 0:n.shopId)||"",shopName:(n==null?void 0:n.shopName)||null,productId:(n==null?void 0:n.productId)||"",productName:(n==null?void 0:n.productName)||"",quantity:(n==null?void 0:n.quantity)||0,expirationDate:(n==null?void 0:n.expirationDate)||"",locationBucket:(n==null?void 0:n.locationBucket)||null,sellPrice:(n==null?void 0:n.sellPrice)??null,shareScope:(n==null?void 0:n.shareScope)||["local"],proofHash:n==null?void 0:n.proofHash,updatedAt:(n==null?void 0:n.updatedAt)||((r=e.payload)==null?void 0:r.updatedAt)||""}}).filter(e=>e.quantity>0).sort((e,n)=>{const r=new Date(e.expirationDate).getTime(),a=new Date(n.expirationDate).getTime();return r-a}),Le={products:new Map,batches:new Map,stockItems:new Map,salesTransactions:new Map,productVisualFeatures:new Map,marketplaceListings:new Map};let Hd=!1;const Sv=t=>{Hd=t},Gd=t=>t.toLowerCase().trim().replace(/\s+/g,"-"),oI=async(t,e)=>{const n=new Map,r=await t();for(const d of r){if(d.quantity<=0||d.status==="EMPTY"||d.status==="EXPIRED"||d.status&&d.status!=="ACTIVE")continue;const p=Le.products.get(d.productId);if(!p)continue;const h=n.get(p.id);if(h)h.totalQuantity+=d.quantity,d.expirationDate<h.earliestExpiration&&(h.earliestExpiration=d.expirationDate),d.supplierId&&h.supplierIdsSet.add(d.supplierId),h.batches.push({batchId:String(d.batchId),quantity:d.quantity,expirationDate:d.expirationDate}),h.totalCost+=d.costPerUnit*d.quantity,h.itemCount+=d.quantity;else{const x=new Set;d.supplierId&&x.add(d.supplierId),n.set(p.id,{productId:p.id,productName:p.name,manufacturer:p.manufacturer,category:p.category,totalQuantity:d.quantity,quantityType:"units",earliestExpiration:d.expirationDate,supplierIdsSet:x,batches:[{batchId:String(d.batchId),quantity:d.quantity,expirationDate:d.expirationDate}],totalCost:d.costPerUnit*d.quantity,itemCount:d.quantity,averageCostPerUnit:0})}}const a=await e(),o=new Set(a.map(d=>d.id)),c=[];return n.forEach(d=>{if(!(d.supplierIdsSet.size===0||Array.from(d.supplierIdsSet).some(_=>o.has(_))))return;const{totalCost:h,itemCount:x,supplierIdsSet:v,...w}=d;c.push({...w,supplierIds:Array.from(v).filter(_=>o.has(_)),averageCostPerUnit:x>0?h/x:0})}),c.sort((d,p)=>d.productName.localeCompare(p.productName))},Ev=()=>{Le.products.clear(),Le.batches.clear(),Le.stockItems.clear(),Le.salesTransactions.clear(),Le.marketplaceListings.clear(),Le.productVisualFeatures.clear()},Cl=async()=>{if(console.log("[DataLoader] loadDataFromQdrant called, activeShopId:",de),!de){console.warn("[DataLoader] activeShopId is not set, cannot load data");return}const t=typeof de=="string"?de:de&&typeof de=="object"&&de!==null&&"id"in de?(()=>{const x=de;return console.warn(`[DataLoader] activeShopId is an object instead of string. Extracting id: ${x.id}`),x.id})():null;if(!t){console.warn("[DataLoader] Could not extract shopIdString from activeShopId");return}console.log(`[DataLoader] Loading data for shopId: ${t}`);const[e,n,r,a,o,c]=await Promise.all([ft("suppliers",t),ft("products",null),ft("batches",t),ft("items",t),ft("sales",t),ft("marketplace",t)]);if(console.log(`[DataLoader] Fetched from Qdrant: ${a.length} items, ${n.length} products, ${r.length} batches`),a.length===0){console.warn(`[DataLoader] No items found for shopId: ${t}. Checking all items in Qdrant...`);try{const x=await ft("items",null),v=new Set;x.forEach(w=>{var T;const _=(T=w.payload)==null?void 0:T.shopId,E=typeof _=="string"?_:_&&typeof _=="object"&&"id"in _?_.id:null;E&&v.add(E)}),console.warn(`[DataLoader] Found ${x.length} total items in Qdrant. ShopIds present:`,Array.from(v)),x.length>0&&!v.has(t)&&(console.error(`[DataLoader] CRITICAL: Items exist but none have shopId "${t}". Items have shopIds:`,Array.from(v)),console.error(`[DataLoader] Expected shopId: ${t}`),console.error("[DataLoader] Found shopIds:",Array.from(v)))}catch(x){console.error("[DataLoader] Error checking all items:",x)}}Ev(),n.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.productId)||String(x.id);w&&Le.products.set(w,{id:w,name:(v==null?void 0:v.name)||"Unnamed Product",manufacturer:(v==null?void 0:v.manufacturer)||"",category:(v==null?void 0:v.category)||""})}),r.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.batchId)||String(x.id);w&&Le.batches.set(String(w),{id:String(w),supplier:(v==null?void 0:v.supplierId)||"Unknown Supplier",deliveryDate:(v==null?void 0:v.deliveryDate)||"",inventoryDate:(v==null?void 0:v.inventoryDate)||(v==null?void 0:v.deliveryDate)||""})});let d=0,p=0;const h={};a.forEach(x=>{const v=x.payload,w=(v==null?void 0:v.productId)||(v==null?void 0:v.itemId),_=(v==null?void 0:v.inventoryUuid)||String(x.id);if(!_||!w){p++,h.missing_uuid_or_productId=(h.missing_uuid_or_productId||0)+1;return}const E=v.quantity||0,T=v.status||(E>0?"ACTIVE":"EMPTY");if(E<=0||T==="EMPTY"||T==="EXPIRED"){p++;const C=E<=0?"quantity_zero":T.toLowerCase();h[C]=(h[C]||0)+1;return}const M=typeof v.shopId=="string"?v.shopId:v.shopId&&typeof v.shopId=="object"&&"id"in v.shopId?v.shopId.id:null;M&&M!==t&&console.warn(`[DataLoader] Item ${_} has shopId "${M}" but expected "${t}"`);const k={id:v.inventoryId||Date.now()+Math.random(),inventoryUuid:_,shopId:M||t||"",productId:w,batchId:v.batchId,expirationDate:v.expiration||v.expirationDate||"",quantity:E,costPerUnit:v.costPerUnit||v.buyPrice||0,location:v.location||void 0,supplierId:v.supplierId||void 0,buyPrice:v.buyPrice??v.costPerUnit,sellPrice:v.sellPrice??void 0,images:v.images||[],scanMetadata:v.scanMetadata||null,createdByUserId:v.createdByUserId||void 0,createdAt:v.createdAt,updatedAt:v.updatedAt,qdrantId:_,status:T};Le.stockItems.set(k.id,k),d++}),console.log(`[DataLoader] Loaded ${d} items into cache, skipped ${p} items:`,h),o.forEach(x=>{const v=x.payload;v!=null&&v.saleId&&Le.salesTransactions.set(v.saleId,{id:v.saleId,timestamp:v.timestamp,items:v.lineItems||[],totalAmount:v.totalAmount||0})}),c.forEach(x=>{const v=x.payload;v!=null&&v.listingId&&Le.marketplaceListings.set(v.listingId,{id:v.listingId,productId:v.productId,productName:v.productName,quantity:v.quantity,price:v.price})})};var zd=function(t,e){return zd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])},zd(t,e)};function Tv(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zd(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Al=function(){return Al=Object.assign||function(e){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Al.apply(this,arguments)};function Di(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function Nv(t,e,n,r){var a=arguments.length,o=a<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,r);else for(var d=t.length-1;d>=0;d--)(c=t[d])&&(o=(a<3?c(o):a>3?c(e,n,o):c(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o}function Cv(t,e){return function(n,r){e(n,r,t)}}function Av(t,e,n,r,a,o){function c(P){if(P!==void 0&&typeof P!="function")throw new TypeError("Function expected");return P}for(var d=r.kind,p=d==="getter"?"get":d==="setter"?"set":"value",h=!e&&t?r.static?t:t.prototype:null,x=e||(h?Object.getOwnPropertyDescriptor(h,r.name):{}),v,w=!1,_=n.length-1;_>=0;_--){var E={};for(var T in r)E[T]=T==="access"?{}:r[T];for(var T in r.access)E.access[T]=r.access[T];E.addInitializer=function(P){if(w)throw new TypeError("Cannot add initializers after decoration has completed");o.push(c(P||null))};var M=(0,n[_])(d==="accessor"?{get:x.get,set:x.set}:x[p],E);if(d==="accessor"){if(M===void 0)continue;if(M===null||typeof M!="object")throw new TypeError("Object expected");(v=c(M.get))&&(x.get=v),(v=c(M.set))&&(x.set=v),(v=c(M.init))&&a.unshift(v)}else(v=c(M))&&(d==="field"?a.unshift(v):x[p]=v)}h&&Object.defineProperty(h,r.name,x),w=!0}function Iv(t,e,n){for(var r=arguments.length>2,a=0;a<e.length;a++)n=r?e[a].call(t,n):e[a].call(t);return r?n:void 0}function Rv(t){return typeof t=="symbol"?t:"".concat(t)}function Dv(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function Mv(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function be(t,e,n,r){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(x){try{h(r.next(x))}catch(v){c(v)}}function p(x){try{h(r.throw(x))}catch(v){c(v)}}function h(x){x.done?o(x.value):a(x.value).then(d,p)}h((r=r.apply(t,e||[])).next())})}function kv(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,a,o,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=d(0),c.throw=d(1),c.return=d(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function d(h){return function(x){return p([h,x])}}function p(h){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,h[0]&&(n=0)),n;)try{if(r=1,a&&(o=h[0]&2?a.return:h[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,h[1])).done)return o;switch(a=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,a=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){n.label=h[1];break}if(h[0]===6&&n.label<o[1]){n.label=o[1],o=h;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(h);break}o[2]&&n.ops.pop(),n.trys.pop();continue}h=e.call(t,n)}catch(x){h=[6,x],a=0}finally{r=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var Gl=Object.create?(function(t,e,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]});function Pv(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Gl(e,t,n)}function Il(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Af(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),a,o=[],c;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)o.push(a.value)}catch(d){c={error:d}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return o}function Uv(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Af(arguments[e]));return t}function jv(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),a=0,e=0;e<n;e++)for(var o=arguments[e],c=0,d=o.length;c<d;c++,a++)r[a]=o[c];return r}function Ov(t,e,n){if(n||arguments.length===2)for(var r=0,a=e.length,o;r<a;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function Ei(t){return this instanceof Ei?(this.v=t,this):new Ei(t)}function Lv(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",c),a[Symbol.asyncIterator]=function(){return this},a;function c(_){return function(E){return Promise.resolve(E).then(_,v)}}function d(_,E){r[_]&&(a[_]=function(T){return new Promise(function(M,P){o.push([_,T,M,P])>1||p(_,T)})},E&&(a[_]=E(a[_])))}function p(_,E){try{h(r[_](E))}catch(T){w(o[0][3],T)}}function h(_){_.value instanceof Ei?Promise.resolve(_.value.v).then(x,v):w(o[0][2],_)}function x(_){p("next",_)}function v(_){p("throw",_)}function w(_,E){_(E),o.shift(),o.length&&p(o[0][0],o[0][1])}}function qv(t){var e,n;return e={},r("next"),r("throw",function(a){throw a}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(a,o){e[a]=t[a]?function(c){return(n=!n)?{value:Ei(t[a](c)),done:!1}:o?o(c):c}:o}}function Bv(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Il=="function"?Il(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(d,p){c=t[o](c),a(d,p,c.done,c.value)})}}function a(o,c,d,p){Promise.resolve(p).then(function(h){o({value:h,done:d})},c)}}function Vv(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var lI=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},Fd=function(t){return Fd=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},Fd(t)};function Hv(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=Fd(t),r=0;r<n.length;r++)n[r]!=="default"&&Gl(e,t,n[r]);return lI(e,t),e}function Gv(t){return t&&t.__esModule?t:{default:t}}function zv(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function Fv(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n}function $v(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function Jv(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,a;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(a=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");a&&(r=function(){try{a.call(this)}catch(o){return Promise.reject(o)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var cI=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function Yv(t){function e(o){t.error=t.hasError?new cI(o,t.error,"An error was suppressed during disposal."):o,t.hasError=!0}var n,r=0;function a(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(a);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(o).then(a,function(c){return e(c),a()})}else r|=1}catch(c){e(c)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return a()}function Kv(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,a,o,c){return r?e?".jsx":".js":a&&(!o||!c)?n:a+o+"."+c.toLowerCase()+"js"}):t}const uI={__extends:Tv,__assign:Al,__rest:Di,__decorate:Nv,__param:Cv,__esDecorate:Av,__runInitializers:Iv,__propKey:Rv,__setFunctionName:Dv,__metadata:Mv,__awaiter:be,__generator:kv,__createBinding:Gl,__exportStar:Pv,__values:Il,__read:Af,__spread:Uv,__spreadArrays:jv,__spreadArray:Ov,__await:Ei,__asyncGenerator:Lv,__asyncDelegator:qv,__asyncValues:Bv,__makeTemplateObject:Vv,__importStar:Hv,__importDefault:Gv,__classPrivateFieldGet:zv,__classPrivateFieldSet:Fv,__classPrivateFieldIn:$v,__addDisposableResource:Jv,__disposeResources:Yv,__rewriteRelativeImportExtension:Kv},dI=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Jv,get __assign(){return Al},__asyncDelegator:qv,__asyncGenerator:Lv,__asyncValues:Bv,__await:Ei,__awaiter:be,__classPrivateFieldGet:zv,__classPrivateFieldIn:$v,__classPrivateFieldSet:Fv,__createBinding:Gl,__decorate:Nv,__disposeResources:Yv,__esDecorate:Av,__exportStar:Pv,__extends:Tv,__generator:kv,__importDefault:Gv,__importStar:Hv,__makeTemplateObject:Vv,__metadata:Mv,__param:Cv,__propKey:Rv,__read:Af,__rest:Di,__rewriteRelativeImportExtension:Kv,__runInitializers:Iv,__setFunctionName:Dv,__spread:Uv,__spreadArray:Ov,__spreadArrays:jv,__values:Il,default:uI},Symbol.toStringTag,{value:"Module"})),fI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class If extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class hI extends If{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ky extends If{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Py extends If{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var $d;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})($d||($d={}));class pI{constructor(e,{headers:n={},customFetch:r,region:a=$d.Any}={}){this.url=e,this.headers=n,this.region=a,this.fetch=fI(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return be(this,arguments,void 0,function*(n,r={}){var a;let o,c;try{const{headers:d,method:p,body:h,signal:x,timeout:v}=r;let w={},{region:_}=r;_||(_=this.region);const E=new URL(`${this.url}/${n}`);_&&_!=="any"&&(w["x-region"]=_,E.searchParams.set("forceFunctionRegion",_));let T;h&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(w["Content-Type"]="application/octet-stream",T=h):typeof h=="string"?(w["Content-Type"]="text/plain",T=h):typeof FormData<"u"&&h instanceof FormData?T=h:(w["Content-Type"]="application/json",T=JSON.stringify(h)):T=h;let M=x;v&&(c=new AbortController,o=setTimeout(()=>c.abort(),v),x?(M=c.signal,x.addEventListener("abort",()=>c.abort())):M=c.signal);const P=yield this.fetch(E.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},w),this.headers),d),body:T,signal:M}).catch(j=>{throw new hI(j)}),k=P.headers.get("x-relay-error");if(k&&k==="true")throw new ky(P);if(!P.ok)throw new Py(P);let C=((a=P.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),I;return C==="application/json"?I=yield P.json():C==="application/octet-stream"||C==="application/pdf"?I=yield P.blob():C==="text/event-stream"?I=P:C==="multipart/form-data"?I=yield P.formData():I=yield P.text(),{data:I,error:null,response:P}}catch(d){return{data:null,error:d,response:d instanceof Py||d instanceof ky?d.context:void 0}}finally{o&&clearTimeout(o)}})}}var Ut={};const Mi=PS(dI);var ol={},ll={},cl={},ul={},dl={},fl={},Uy;function Qv(){if(Uy)return fl;Uy=1,Object.defineProperty(fl,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return fl.default=t,fl}var jy;function Xv(){if(jy)return dl;jy=1,Object.defineProperty(dl,"__esModule",{value:!0});const e=Mi.__importDefault(Qv());class n{constructor(a){var o,c;this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=new Headers(a.headers),this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=(o=a.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=a.signal,this.isMaybeSingle=(c=a.isMaybeSingle)!==null&&c!==void 0?c:!1,a.fetch?this.fetch=a.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,o){return this.headers=new Headers(this.headers),this.headers.set(a,o),this}then(a,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const c=this.fetch;let d=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async p=>{var h,x,v,w;let _=null,E=null,T=null,M=p.status,P=p.statusText;if(p.ok){if(this.method!=="HEAD"){const j=await p.text();j===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((h=this.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text"))?E=j:E=JSON.parse(j))}const C=(x=this.headers.get("Prefer"))===null||x===void 0?void 0:x.match(/count=(exact|planned|estimated)/),I=(v=p.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");C&&I&&I.length>1&&(T=parseInt(I[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(E)&&(E.length>1?(_={code:"PGRST116",details:`Results contain ${E.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},E=null,T=null,M=406,P="Not Acceptable"):E.length===1?E=E[0]:E=null)}else{const C=await p.text();try{_=JSON.parse(C),Array.isArray(_)&&p.status===404&&(E=[],_=null,M=200,P="OK")}catch{p.status===404&&C===""?(M=204,P="No Content"):_={message:C}}if(_&&this.isMaybeSingle&&(!((w=_==null?void 0:_.details)===null||w===void 0)&&w.includes("0 rows"))&&(_=null,M=200,P="OK"),_&&this.shouldThrowOnError)throw new e.default(_)}return{error:_,data:E,count:T,status:M,statusText:P}});return this.shouldThrowOnError||(d=d.catch(p=>{var h,x,v;return{error:{message:`${(h=p==null?void 0:p.name)!==null&&h!==void 0?h:"FetchError"}: ${p==null?void 0:p.message}`,details:`${(x=p==null?void 0:p.stack)!==null&&x!==void 0?x:""}`,hint:"",code:`${(v=p==null?void 0:p.code)!==null&&v!==void 0?v:""}`},data:null,count:null,status:0,statusText:""}})),d.then(a,o)}returns(){return this}overrideTypes(){return this}}return dl.default=n,dl}var Oy;function Wv(){if(Oy)return ul;Oy=1,Object.defineProperty(ul,"__esModule",{value:!0});const e=Mi.__importDefault(Xv());class n extends e.default{select(a){let o=!1;const c=(a??"*").split("").map(d=>/\s/.test(d)&&!o?"":(d==='"'&&(o=!o),d)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:o=!0,nullsFirst:c,foreignTable:d,referencedTable:p=d}={}){const h=p?`${p}.order`:"order",x=this.url.searchParams.get(h);return this.url.searchParams.set(h,`${x?`${x},`:""}${a}.${o?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:o,referencedTable:c=o}={}){const d=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${a}`),this}range(a,o,{foreignTable:c,referencedTable:d=c}={}){const p=typeof d>"u"?"offset":`${d}.offset`,h=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(p,`${a}`),this.url.searchParams.set(h,`${o-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:o=!1,settings:c=!1,buffers:d=!1,wal:p=!1,format:h="text"}={}){var x;const v=[a?"analyze":null,o?"verbose":null,c?"settings":null,d?"buffers":null,p?"wal":null].filter(Boolean).join("|"),w=(x=this.headers.get("Accept"))!==null&&x!==void 0?x:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${h}; for="${w}"; options=${v};`),h==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}}return ul.default=n,ul}var Ly;function Rf(){if(Ly)return cl;Ly=1,Object.defineProperty(cl,"__esModule",{value:!0});const e=Mi.__importDefault(Wv()),n=new RegExp("[,()]");class r extends e.default{eq(o,c){return this.url.searchParams.append(o,`eq.${c}`),this}neq(o,c){return this.url.searchParams.append(o,`neq.${c}`),this}gt(o,c){return this.url.searchParams.append(o,`gt.${c}`),this}gte(o,c){return this.url.searchParams.append(o,`gte.${c}`),this}lt(o,c){return this.url.searchParams.append(o,`lt.${c}`),this}lte(o,c){return this.url.searchParams.append(o,`lte.${c}`),this}like(o,c){return this.url.searchParams.append(o,`like.${c}`),this}likeAllOf(o,c){return this.url.searchParams.append(o,`like(all).{${c.join(",")}}`),this}likeAnyOf(o,c){return this.url.searchParams.append(o,`like(any).{${c.join(",")}}`),this}ilike(o,c){return this.url.searchParams.append(o,`ilike.${c}`),this}ilikeAllOf(o,c){return this.url.searchParams.append(o,`ilike(all).{${c.join(",")}}`),this}ilikeAnyOf(o,c){return this.url.searchParams.append(o,`ilike(any).{${c.join(",")}}`),this}is(o,c){return this.url.searchParams.append(o,`is.${c}`),this}in(o,c){const d=Array.from(new Set(c)).map(p=>typeof p=="string"&&n.test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(o,`in.(${d})`),this}contains(o,c){return typeof c=="string"?this.url.searchParams.append(o,`cs.${c}`):Array.isArray(c)?this.url.searchParams.append(o,`cs.{${c.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(c)}`),this}containedBy(o,c){return typeof c=="string"?this.url.searchParams.append(o,`cd.${c}`):Array.isArray(c)?this.url.searchParams.append(o,`cd.{${c.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(c)}`),this}rangeGt(o,c){return this.url.searchParams.append(o,`sr.${c}`),this}rangeGte(o,c){return this.url.searchParams.append(o,`nxl.${c}`),this}rangeLt(o,c){return this.url.searchParams.append(o,`sl.${c}`),this}rangeLte(o,c){return this.url.searchParams.append(o,`nxr.${c}`),this}rangeAdjacent(o,c){return this.url.searchParams.append(o,`adj.${c}`),this}overlaps(o,c){return typeof c=="string"?this.url.searchParams.append(o,`ov.${c}`):this.url.searchParams.append(o,`ov.{${c.join(",")}}`),this}textSearch(o,c,{config:d,type:p}={}){let h="";p==="plain"?h="pl":p==="phrase"?h="ph":p==="websearch"&&(h="w");const x=d===void 0?"":`(${d})`;return this.url.searchParams.append(o,`${h}fts${x}.${c}`),this}match(o){return Object.entries(o).forEach(([c,d])=>{this.url.searchParams.append(c,`eq.${d}`)}),this}not(o,c,d){return this.url.searchParams.append(o,`not.${c}.${d}`),this}or(o,{foreignTable:c,referencedTable:d=c}={}){const p=d?`${d}.or`:"or";return this.url.searchParams.append(p,`(${o})`),this}filter(o,c,d){return this.url.searchParams.append(o,`${c}.${d}`),this}}return cl.default=r,cl}var qy;function Zv(){if(qy)return ll;qy=1,Object.defineProperty(ll,"__esModule",{value:!0});const e=Mi.__importDefault(Rf());class n{constructor(a,{headers:o={},schema:c,fetch:d}){this.url=a,this.headers=new Headers(o),this.schema=c,this.fetch=d}select(a,o){const{head:c=!1,count:d}=o??{},p=c?"HEAD":"GET";let h=!1;const x=(a??"*").split("").map(v=>/\s/.test(v)&&!h?"":(v==='"'&&(h=!h),v)).join("");return this.url.searchParams.set("select",x),d&&this.headers.append("Prefer",`count=${d}`),new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:o,defaultToNull:c=!0}={}){var d;const p="POST";if(o&&this.headers.append("Prefer",`count=${o}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const h=a.reduce((x,v)=>x.concat(Object.keys(v)),[]);if(h.length>0){const x=[...new Set(h)].map(v=>`"${v}"`);this.url.searchParams.set("columns",x.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}upsert(a,{onConflict:o,ignoreDuplicates:c=!1,count:d,defaultToNull:p=!0}={}){var h;const x="POST";if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),d&&this.headers.append("Prefer",`count=${d}`),p||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const v=a.reduce((w,_)=>w.concat(Object.keys(_)),[]);if(v.length>0){const w=[...new Set(v)].map(_=>`"${_}"`);this.url.searchParams.set("columns",w.join(","))}}return new e.default({method:x,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}update(a,{count:o}={}){var c;const d="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:a}={}){var o;const c="DELETE";return a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return ll.default=n,ll}var By;function mI(){if(By)return ol;By=1,Object.defineProperty(ol,"__esModule",{value:!0});const t=Mi,e=t.__importDefault(Zv()),n=t.__importDefault(Rf());class r{constructor(o,{headers:c={},schema:d,fetch:p}={}){this.url=o,this.headers=new Headers(c),this.schemaName=d,this.fetch=p}from(o){const c=new URL(`${this.url}/${o}`);return new e.default(c,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new r(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,c={},{head:d=!1,get:p=!1,count:h}={}){var x;let v;const w=new URL(`${this.url}/rpc/${o}`);let _;d||p?(v=d?"HEAD":"GET",Object.entries(c).filter(([T,M])=>M!==void 0).map(([T,M])=>[T,Array.isArray(M)?`{${M.join(",")}}`:`${M}`]).forEach(([T,M])=>{w.searchParams.append(T,M)})):(v="POST",_=c);const E=new Headers(this.headers);return h&&E.set("Prefer",`count=${h}`),new n.default({method:v,url:w,headers:E,schema:this.schemaName,body:_,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}}return ol.default=r,ol}var Vy;function gI(){if(Vy)return Ut;Vy=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.PostgrestError=Ut.PostgrestBuilder=Ut.PostgrestTransformBuilder=Ut.PostgrestFilterBuilder=Ut.PostgrestQueryBuilder=Ut.PostgrestClient=void 0;const t=Mi,e=t.__importDefault(mI());Ut.PostgrestClient=e.default;const n=t.__importDefault(Zv());Ut.PostgrestQueryBuilder=n.default;const r=t.__importDefault(Rf());Ut.PostgrestFilterBuilder=r.default;const a=t.__importDefault(Wv());Ut.PostgrestTransformBuilder=a.default;const o=t.__importDefault(Xv());Ut.PostgrestBuilder=o.default;const c=t.__importDefault(Qv());return Ut.PostgrestError=c.default,Ut.default={PostgrestClient:e.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:o.default,PostgrestError:c.default},Ut}var eb=gI();const tb=cf(eb),yI=kS({__proto__:null,default:tb},[eb]),{PostgrestClient:xI,PostgrestQueryBuilder:j3,PostgrestFilterBuilder:O3,PostgrestTransformBuilder:L3,PostgrestBuilder:q3,PostgrestError:B3}=tb||yI;class vI{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,a=parseInt(r.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const bI="2.81.1",wI=`realtime-js/${bI}`,nb="1.0.0",_I="2.0.0",Hy=nb,Jd=1e4,SI=1e3,EI=100;var hr;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(hr||(hr={}));var wt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(wt||(wt={}));var vn;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(vn||(vn={}));var Yd;(function(t){t.websocket="websocket"})(Yd||(Yd={}));var pr;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(pr||(pr={}));class TI{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,n){if(this._isArrayBuffer(e.payload))return n(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodePush(e){const{join_ref:n,ref:r,event:a,topic:o,payload:c}=e,d=this.META_LENGTH+n.length+r.length+o.length+a.length,p=new ArrayBuffer(this.HEADER_LENGTH+d);let h=new DataView(p),x=0;h.setUint8(x++,this.KINDS.push),h.setUint8(x++,n.length),h.setUint8(x++,r.length),h.setUint8(x++,o.length),h.setUint8(x++,a.length),Array.from(n,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(r,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(o,w=>h.setUint8(x++,w.charCodeAt(0))),Array.from(a,w=>h.setUint8(x++,w.charCodeAt(0)));var v=new Uint8Array(p.byteLength+c.byteLength);return v.set(new Uint8Array(p),0),v.set(new Uint8Array(c),p.byteLength),v.buffer}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const{join_ref:a,ref:o,topic:c}=e,d=e.payload.event,p=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0),h=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+c.length+d.length,x=new ArrayBuffer(this.HEADER_LENGTH+h);let v=new DataView(x),w=0;v.setUint8(w++,this.KINDS.userBroadcastPush),v.setUint8(w++,a.length),v.setUint8(w++,o.length),v.setUint8(w++,c.length),v.setUint8(w++,d.length),v.setUint8(w++,this.BINARY_ENCODING),Array.from(a,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(o,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(c,E=>v.setUint8(w++,E.charCodeAt(0))),Array.from(d,E=>v.setUint8(w++,E.charCodeAt(0)));var _=new Uint8Array(x.byteLength+p.byteLength);return _.set(new Uint8Array(x),0),_.set(new Uint8Array(p),x.byteLength),_.buffer}_encodeJsonUserBroadcastPush(e){var n,r;const{join_ref:a,ref:o,topic:c}=e,d=e.payload.event,p=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},x=new TextEncoder().encode(JSON.stringify(p)).buffer,v=this.USER_BROADCAST_PUSH_META_LENGTH+a.length+o.length+c.length+d.length,w=new ArrayBuffer(this.HEADER_LENGTH+v);let _=new DataView(w),E=0;_.setUint8(E++,this.KINDS.userBroadcastPush),_.setUint8(E++,a.length),_.setUint8(E++,o.length),_.setUint8(E++,c.length),_.setUint8(E++,d.length),_.setUint8(E++,this.JSON_ENCODING),Array.from(a,M=>_.setUint8(E++,M.charCodeAt(0))),Array.from(o,M=>_.setUint8(E++,M.charCodeAt(0))),Array.from(c,M=>_.setUint8(E++,M.charCodeAt(0))),Array.from(d,M=>_.setUint8(E++,M.charCodeAt(0)));var T=new Uint8Array(w.byteLength+x.byteLength);return T.set(new Uint8Array(w),0),T.set(new Uint8Array(x),w.byteLength),T.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[a,o,c,d,p]=r;return n({join_ref:a,ref:o,topic:c,event:d,payload:p})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),a=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(e,n,a);case this.KINDS.reply:return this._decodeReply(e,n,a);case this.KINDS.broadcast:return this._decodeBroadcast(e,n,a);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,a)}}_decodePush(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3);let d=this.HEADER_LENGTH+this.META_LENGTH-1;const p=r.decode(e.slice(d,d+a));d=d+a;const h=r.decode(e.slice(d,d+o));d=d+o;const x=r.decode(e.slice(d,d+c));d=d+c;const v=JSON.parse(r.decode(e.slice(d,e.byteLength)));return{join_ref:p,ref:null,topic:h,event:x,payload:v}}_decodeReply(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3),d=n.getUint8(4);let p=this.HEADER_LENGTH+this.META_LENGTH;const h=r.decode(e.slice(p,p+a));p=p+a;const x=r.decode(e.slice(p,p+o));p=p+o;const v=r.decode(e.slice(p,p+c));p=p+c;const w=r.decode(e.slice(p,p+d));p=p+d;const _=JSON.parse(r.decode(e.slice(p,e.byteLength))),E={status:w,response:_};return{join_ref:h,ref:x,topic:v,event:vn.reply,payload:E}}_decodeBroadcast(e,n,r){const a=n.getUint8(1),o=n.getUint8(2);let c=this.HEADER_LENGTH+2;const d=r.decode(e.slice(c,c+a));c=c+a;const p=r.decode(e.slice(c,c+o));c=c+o;const h=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{join_ref:null,ref:null,topic:d,event:p,payload:h}}_decodeUserBroadcast(e,n,r){const a=n.getUint8(1),o=n.getUint8(2),c=n.getUint8(3),d=n.getUint8(4);let p=this.HEADER_LENGTH+4;const h=r.decode(e.slice(p,p+a));p=p+a;const x=r.decode(e.slice(p,p+o));p=p+o;const v=r.decode(e.slice(p,p+c));p=p+c;const w=e.slice(p,e.byteLength),_=d===this.JSON_ENCODING?JSON.parse(r.decode(w)):w,E={type:this.BROADCAST,event:x,payload:_};return c>0&&(E.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST,payload:E}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}}class sb{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var et;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(et||(et={}));const Gy=(t,e,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((o,c)=>(o[c]=NI(c,t,e,a),o),{}):{}},NI=(t,e,n,r)=>{const a=e.find(d=>d.name===t),o=a==null?void 0:a.type,c=n[t];return o&&!r.includes(o)?rb(o,c):Kd(c)},rb=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return RI(e,n)}switch(t){case et.bool:return CI(e);case et.float4:case et.float8:case et.int2:case et.int4:case et.int8:case et.numeric:case et.oid:return AI(e);case et.json:case et.jsonb:return II(e);case et.timestamp:return DI(e);case et.abstime:case et.date:case et.daterange:case et.int4range:case et.int8range:case et.money:case et.reltime:case et.text:case et.time:case et.timestamptz:case et.timetz:case et.tsrange:case et.tstzrange:return Kd(e);default:return Kd(e)}},Kd=t=>t,CI=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},AI=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},II=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},RI=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let o;const c=t.slice(1,n);try{o=JSON.parse("["+c+"]")}catch{o=c?c.split(","):[]}return o.map(d=>rb(e,d))}return t},DI=t=>typeof t=="string"?t.replace(" ","T"):t,ib=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class vd{constructor(e,n,r={},a=Jd){this.channel=e,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var zy;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(zy||(zy={}));class Ra{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:o,onLeave:c,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ra.syncState(this.state,a,o,c),this.pendingDiffs.forEach(p=>{this.state=Ra.syncDiff(this.state,p,o,c)}),this.pendingDiffs=[],d()}),this.channel._on(r.diff,{},a=>{const{onJoin:o,onLeave:c,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Ra.syncDiff(this.state,a,o,c),d())}),this.onJoin((a,o,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:c})}),this.onLeave((a,o,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,a){const o=this.cloneDeep(e),c=this.transformState(n),d={},p={};return this.map(o,(h,x)=>{c[h]||(p[h]=x)}),this.map(c,(h,x)=>{const v=o[h];if(v){const w=x.map(M=>M.presence_ref),_=v.map(M=>M.presence_ref),E=x.filter(M=>_.indexOf(M.presence_ref)<0),T=v.filter(M=>w.indexOf(M.presence_ref)<0);E.length>0&&(d[h]=E),T.length>0&&(p[h]=T)}else d[h]=x}),this.syncDiff(o,{joins:d,leaves:p},r,a)}static syncDiff(e,n,r,a){const{joins:o,leaves:c}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(o,(d,p)=>{var h;const x=(h=e[d])!==null&&h!==void 0?h:[];if(e[d]=this.cloneDeep(p),x.length>0){const v=e[d].map(_=>_.presence_ref),w=x.filter(_=>v.indexOf(_.presence_ref)<0);e[d].unshift(...w)}r(d,x,p)}),this.map(c,(d,p)=>{let h=e[d];if(!h)return;const x=p.map(v=>v.presence_ref);h=h.filter(v=>x.indexOf(v.presence_ref)<0),e[d]=h,a(d,h,p),h.length===0&&delete e[d]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const a=e[r];return"metas"in a?n[r]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):n[r]=a,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Fy;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Fy||(Fy={}));var Da;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Da||(Da={}));var is;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(is||(is={}));class Df{constructor(e,n={config:{}},r){var a,o;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=wt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new vd(this,vn.join,this.params,this.timeout),this.rejoinTimer=new sb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=wt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=wt.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=wt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=wt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=wt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(vn.reply,{},(c,d)=>{this._trigger(this._replyEventName(d),c)}),this.presence=new Ra(this),this.broadcastEndpointURL=ib(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,a,o;if(this.socket.isConnected()||this.socket.connect(),this.state==wt.closed){const{config:{broadcast:c,presence:d,private:p}}=this.params,h=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(_=>_.filter))!==null&&a!==void 0?a:[],x=!!this.bindings[Da.PRESENCE]&&this.bindings[Da.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,v={},w={broadcast:c,presence:Object.assign(Object.assign({},d),{enabled:x}),postgres_changes:h,private:p};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(_=>e==null?void 0:e(is.CHANNEL_ERROR,_)),this._onClose(()=>e==null?void 0:e(is.CLOSED)),this.updateJoinPayload(Object.assign({config:w},v)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:_})=>{var E;if(this.socket.setAuth(),_===void 0){e==null||e(is.SUBSCRIBED);return}else{const T=this.bindings.postgres_changes,M=(E=T==null?void 0:T.length)!==null&&E!==void 0?E:0,P=[];for(let k=0;k<M;k++){const C=T[k],{filter:{event:I,schema:j,table:B,filter:H}}=C,Q=_&&_[k];if(Q&&Q.event===I&&Q.schema===j&&Q.table===B&&Q.filter===H)P.push(Object.assign(Object.assign({},C),{id:Q.id}));else{this.unsubscribe(),this.state=wt.errored,e==null||e(is.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=P,e&&e(is.SUBSCRIBED);return}}).receive("error",_=>{this.state=wt.errored,e==null||e(is.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(_).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(is.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===wt.joined&&e===Da.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var a;const o=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const c={method:"POST",headers:{Authorization:o,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(d.status===202)return{success:!0};let p=d.statusText;try{const h=await d.json();p=h.error||h.message||p}catch{}return Promise.reject(new Error(p))}async send(e,n={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:c}=e,p={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:c,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=h.body)===null||a===void 0?void 0:a.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var c,d,p;const h=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(d=(c=this.params)===null||c===void 0?void 0:c.config)===null||d===void 0?void 0:d.broadcast)===null||p===void 0)&&p.ack)&&o("ok"),h.receive("ok",()=>o("ok")),h.receive("error",()=>o("error")),h.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=wt.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(vn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new vd(this,vn.leave,{},e),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=wt.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const a=new AbortController,o=setTimeout(()=>a.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(o),c}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new vd(this,e,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>EI){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var a,o;const c=e.toLocaleLowerCase(),{close:d,error:p,leave:h,join:x}=vn;if(r&&[d,p,h,x].indexOf(c)>=0&&r!==this._joinRef())return;let w=this._onMessage(c,n,r);if(n&&!w)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(_=>{var E,T,M;return((E=_.filter)===null||E===void 0?void 0:E.event)==="*"||((M=(T=_.filter)===null||T===void 0?void 0:T.event)===null||M===void 0?void 0:M.toLocaleLowerCase())===c}).map(_=>_.callback(w,r)):(o=this.bindings[c])===null||o===void 0||o.filter(_=>{var E,T,M,P,k,C;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in _){const I=_.id,j=(E=_.filter)===null||E===void 0?void 0:E.event;return I&&((T=n.ids)===null||T===void 0?void 0:T.includes(I))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((M=n.data)===null||M===void 0?void 0:M.type.toLocaleLowerCase()))}else{const I=(k=(P=_==null?void 0:_.filter)===null||P===void 0?void 0:P.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return I==="*"||I===((C=n==null?void 0:n.event)===null||C===void 0?void 0:C.toLocaleLowerCase())}else return _.type.toLocaleLowerCase()===c}).map(_=>{if(typeof w=="object"&&"ids"in w){const E=w.data,{schema:T,table:M,commit_timestamp:P,type:k,errors:C}=E;w=Object.assign(Object.assign({},{schema:T,table:M,commit_timestamp:P,eventType:k,new:{},old:{},errors:C}),this._getPayloadRecords(E))}_.callback(w,r)})}_isClosed(){return this.state===wt.closed}_isJoined(){return this.state===wt.joined}_isJoining(){return this.state===wt.joining}_isLeaving(){return this.state===wt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const a=e.toLocaleLowerCase(),o={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Df.isEqual(a.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(vn.close,{},e)}_onError(e){this._on(vn.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=wt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Gy(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Gy(e.columns,e.old_record)),n}}const bd=()=>{},hl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},MI=[1e3,2e3,5e3,1e4],kI=1e4,PI=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class UI{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Jd,this.transport=null,this.heartbeatIntervalMs=hl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=bd,this.ref=0,this.reconnectTimer=null,this.vsn=Hy,this.logger=bd,this.conn=null,this.sendBuffer=[],this.serializer=new TI,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>a?(...o)=>a(...o):(...o)=>fetch(...o),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Yd.websocket}`,this.httpEndpoint=ib(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=vI.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case hr.connecting:return pr.Connecting;case hr.open:return pr.Open;case hr.closing:return pr.Closing;default:return pr.Closed}}isConnected(){return this.connectionState()===pr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(o=>o.topic===r);if(a)return a;{const o=new Df(`realtime:${e}`,n,this);return this.channels.push(o),o}}push(e){const{topic:n,event:r,payload:a,ref:o}=e,c=()=>{this.encode(e,d=>{var p;(p=this.conn)===null||p===void 0||p.send(d)})};this.log("push",`${n} ${r} (${o})`,a),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(SI,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},hl.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(h){this.log("error","error in heartbeat callback",h)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:o,ref:c}=n,d=c?`(${c})`:"",p=o.status||"";this.log("receive",`${p} ${r} ${a} ${d}`.trim(),o),this.channels.filter(h=>h._isMember(r)).forEach(h=>h._trigger(a,o,c)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===hr.open||this.conn.readyState===hr.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(vn.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${e}${r}${a}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([PI],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const a={access_token:n,version:wI};n&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(vn.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new sb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},hl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,a,o,c,d,p,h,x,v,w,_;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Jd,this.heartbeatIntervalMs=(a=e==null?void 0:e.heartbeatIntervalMs)!==null&&a!==void 0?a:hl.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(c=e==null?void 0:e.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(d=e==null?void 0:e.heartbeatCallback)!==null&&d!==void 0?d:bd,this.vsn=(p=e==null?void 0:e.vsn)!==null&&p!==void 0?p:Hy,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e==null?void 0:e.reconnectAfterMs)!==null&&h!==void 0?h:(E=>MI[E-1]||kI),this.vsn){case nb:this.encode=(x=e==null?void 0:e.encode)!==null&&x!==void 0?x:((E,T)=>T(JSON.stringify(E))),this.decode=(v=e==null?void 0:e.decode)!==null&&v!==void 0?v:((E,T)=>T(JSON.parse(E)));break;case _I:this.encode=(w=e==null?void 0:e.encode)!==null&&w!==void 0?w:this.serializer.encode.bind(this.serializer),this.decode=(_=e==null?void 0:e.decode)!==null&&_!==void 0?_:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Mf extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function at(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class jI extends Mf{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Qd extends Mf{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const kf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),OI=()=>Response,Xd=t=>{if(Array.isArray(t))return t.map(n=>Xd(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[a]=Xd(r)}),e},LI=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},wd=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},qI=(t,e,n)=>be(void 0,void 0,void 0,function*(){const r=yield OI();t instanceof r&&!(n!=null&&n.noResolveJson)?t.json().then(a=>{const o=t.status||500,c=(a==null?void 0:a.statusCode)||o+"";e(new jI(wd(a),o,c))}).catch(a=>{e(new Qd(wd(a),a))}):e(new Qd(wd(t),t))}),BI=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?a:(LI(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,e!=null&&e.duplex&&(a.duplex=e.duplex),Object.assign(Object.assign({},a),n))};function Ha(t,e,n,r,a,o){return be(this,void 0,void 0,function*(){return new Promise((c,d)=>{t(n,BI(e,r,a,o)).then(p=>{if(!p.ok)throw p;return r!=null&&r.noResolveJson?p:p.json()}).then(p=>c(p)).catch(p=>qI(p,d,r))})})}function Pa(t,e,n,r){return be(this,void 0,void 0,function*(){return Ha(t,"GET",e,n,r)})}function An(t,e,n,r,a){return be(this,void 0,void 0,function*(){return Ha(t,"POST",e,r,a,n)})}function Wd(t,e,n,r,a){return be(this,void 0,void 0,function*(){return Ha(t,"PUT",e,r,a,n)})}function VI(t,e,n,r){return be(this,void 0,void 0,function*(){return Ha(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Pf(t,e,n,r,a){return be(this,void 0,void 0,function*(){return Ha(t,"DELETE",e,r,a,n)})}class HI{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return be(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(at(e))return{data:null,error:e};throw e}})}}var ab;class GI{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[ab]="BlobDownloadBuilder",this.promise=null}asStream(){return new HI(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return be(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(at(e))return{data:null,error:e};throw e}})}}ab=Symbol.toStringTag;const zI={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$y={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class FI{constructor(e,n={},r,a){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=kf(a)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,a){return be(this,void 0,void 0,function*(){try{let o;const c=Object.assign(Object.assign({},$y),a);let d=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const p=c.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",c.cacheControl),p&&o.append("metadata",this.encodeMetadata(p)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.has("cacheControl")||o.append("cacheControl",c.cacheControl),p&&!o.has("metadata")&&o.append("metadata",this.encodeMetadata(p))):(o=r,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType,p&&(d["x-metadata"]=this.toBase64(this.encodeMetadata(p))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!c.duplex&&(c.duplex="half")),a!=null&&a.headers&&(d=Object.assign(Object.assign({},d),a.headers));const h=this._removeEmptyFolders(n),x=this._getFinalPath(h),v=yield(e=="PUT"?Wd:An)(this.fetch,`${this.url}/object/${x}`,o,Object.assign({headers:d},c!=null&&c.duplex?{duplex:c.duplex}:{}));return{data:{path:h,id:v.Id,fullPath:v.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(at(o))return{data:null,error:o};throw o}})}upload(e,n,r){return be(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,a){return be(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),c=this._getFinalPath(o),d=new URL(this.url+`/object/upload/sign/${c}`);d.searchParams.set("token",n);try{let p;const h=Object.assign({upsert:$y.upsert},a),x=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(p=new FormData,p.append("cacheControl",h.cacheControl),p.append("",r)):typeof FormData<"u"&&r instanceof FormData?(p=r,p.append("cacheControl",h.cacheControl)):(p=r,x["cache-control"]=`max-age=${h.cacheControl}`,x["content-type"]=h.contentType);const v=yield Wd(this.fetch,d.toString(),p,{headers:x});return{data:{path:o,fullPath:v.Key},error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(at(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e,n){return be(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const a=Object.assign({},this.headers);n!=null&&n.upsert&&(a["x-upsert"]="true");const o=yield An(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),c=new URL(this.url+o.url),d=c.searchParams.get("token");if(!d)throw new Mf("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:d},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(at(r))return{data:null,error:r};throw r}})}update(e,n,r){return be(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return be(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(at(a))return{data:null,error:a};throw a}})}copy(e,n,r){return be(this,void 0,void 0,function*(){try{return{data:{path:(yield An(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(at(a))return{data:null,error:a};throw a}})}createSignedUrl(e,n,r){return be(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),o=yield An(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${c}`)},{data:o,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(at(a))return{data:null,error:a};throw a}})}createSignedUrls(e,n,r){return be(this,void 0,void 0,function*(){try{const a=yield An(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${o}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(at(a))return{data:null,error:a};throw a}})}download(e,n){const a=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),c=o?`?${o}`:"",d=this._getFinalPath(e),p=()=>Pa(this.fetch,`${this.url}/${a}/${d}${c}`,{headers:this.headers,noResolveJson:!0});return new GI(p,this.shouldThrowOnError)}info(e){return be(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield Pa(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Xd(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(at(r))return{data:null,error:r};throw r}})}exists(e){return be(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield VI(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(at(r)&&r instanceof Qd){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),a=[],o=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";o!==""&&a.push(o);const d=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",p=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});p!==""&&a.push(p);let h=a.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${r}${h}`)}}}remove(e){return be(this,void 0,void 0,function*(){try{return{data:yield Pf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}list(e,n,r){return be(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},zI),n),{prefix:e||""});return{data:yield An(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(at(a))return{data:null,error:a};throw a}})}listV2(e,n){return be(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield An(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(at(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const ob="2.81.1",lb={"X-Client-Info":`storage-js/${ob}`};class $I{constructor(e,n={},r,a){this.shouldThrowOnError=!1;const o=new URL(e);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lb),n),this.fetch=kf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return be(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield Pa(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}getBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield Pa(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}createBucket(e){return be(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield An(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(at(a))return{data:null,error:a};throw a}})}updateBucket(e,n){return be(this,void 0,void 0,function*(){try{return{data:yield Wd(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(at(r))return{data:null,error:r};throw r}})}emptyBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}deleteBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield Pf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class JI{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lb),n),this.fetch=kf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield An(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}listBuckets(e){return be(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),a=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield Pa(this.fetch,a,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}deleteBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield Pf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(at(n))return{data:null,error:n};throw n}})}}const Uf={"X-Client-Info":`storage-js/${ob}`,"Content-Type":"application/json"};class cb extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function sn(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class _d extends cb{constructor(e,n,r){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class YI extends cb{constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var Jy;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(Jy||(Jy={}));const jf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),KI=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Yy=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),QI=(t,e,n)=>be(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const a=t.status||500,o=t;if(typeof o.json=="function")o.json().then(c=>{const d=(c==null?void 0:c.statusCode)||(c==null?void 0:c.code)||a+"";e(new _d(Yy(c),a,d))}).catch(()=>{const c=a+"",d=o.statusText||`HTTP ${a} error`;e(new _d(d,a,c))});else{const c=a+"",d=o.statusText||`HTTP ${a} error`;e(new _d(d,a,c))}}else e(new YI(Yy(t),t))}),XI=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return r?(KI(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,Object.assign(Object.assign({},a),n)):a};function WI(t,e,n,r,a,o){return be(this,void 0,void 0,function*(){return new Promise((c,d)=>{t(n,XI(e,r,a,o)).then(p=>{if(!p.ok)throw p;if(r!=null&&r.noResolveJson)return p;const h=p.headers.get("content-type");return!h||!h.includes("application/json")?{}:p.json()}).then(p=>c(p)).catch(p=>QI(p,d,r))})})}function rn(t,e,n,r,a){return be(this,void 0,void 0,function*(){return WI(t,"POST",e,r,a,n)})}class ZI{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Uf),n),this.fetch=jf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return be(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}getIndex(e,n){return be(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(sn(r))return{data:null,error:r};throw r}})}listIndexes(e){return be(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return be(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(sn(r))return{data:null,error:r};throw r}})}}class eR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Uf),n),this.fetch=jf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return be(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield rn(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}getVectors(e){return be(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}listVectors(e){return be(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield rn(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}queryVectors(e){return be(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}deleteVectors(e){return be(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield rn(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}}class tR{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Uf),n),this.fetch=jf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return be(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}getBucket(e){return be(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}listBuckets(){return be(this,arguments,void 0,function*(e={}){try{return{data:yield rn(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}deleteBucket(e){return be(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(sn(n))return{data:null,error:n};throw n}})}}class nR extends tR{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new sR(this.url,this.headers,e,this.fetch)}}class sR extends ZI{constructor(e,n,r,a){super(e,n,a),this.vectorBucketName=r}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return be(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return be(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return be(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return be(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new rR(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class rR extends eR{constructor(e,n,r,a,o){super(e,n,o),this.vectorBucketName=r,this.indexName=a}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return be(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return be(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return be(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return be(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return be(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class iR extends $I{constructor(e,n={},r,a){super(e,n,r,a)}from(e){return new FI(this.url,this.headers,e,this.fetch)}get vectors(){return new nR(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new JI(this.url+"/iceberg",this.headers,this.fetch)}}const aR="2.81.1";let Aa="";typeof Deno<"u"?Aa="deno":typeof document<"u"?Aa="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Aa="react-native":Aa="node";const oR={"X-Client-Info":`supabase-js-${Aa}/${aR}`},lR={headers:oR},cR={schema:"public"},uR={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},dR={},fR=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),hR=()=>Headers,pR=(t,e,n)=>{const r=fR(n),a=hR();return async(o,c)=>{var d;const p=(d=await e())!==null&&d!==void 0?d:t;let h=new a(c==null?void 0:c.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${p}`),r(o,Object.assign(Object.assign({},c),{headers:h}))}};function mR(t){return t.endsWith("/")?t:t+"/"}function gR(t,e){var n,r;const{db:a,auth:o,realtime:c,global:d}=t,{db:p,auth:h,realtime:x,global:v}=e,w={db:Object.assign(Object.assign({},p),a),auth:Object.assign(Object.assign({},h),o),realtime:Object.assign(Object.assign({},x),c),storage:{},global:Object.assign(Object.assign(Object.assign({},v),d),{headers:Object.assign(Object.assign({},(n=v==null?void 0:v.headers)!==null&&n!==void 0?n:{}),(r=d==null?void 0:d.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?w.accessToken=t.accessToken:delete w.accessToken,w}function yR(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(mR(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const ub="2.81.1",hi=30*1e3,Zd=3,Sd=Zd*hi,xR="http://localhost:9999",vR="supabase.auth.token",bR={"X-Client-Info":`gotrue-js/${ub}`},ef="X-Supabase-Api-Version",db={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},wR=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,_R=600*1e3;class Ua extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function we(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class SR extends Ua{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function ER(t){return we(t)&&t.name==="AuthApiError"}class mr extends Ua{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class zs extends Ua{constructor(e,n,r,a){super(e,r,a),this.name=n,this.status=r}}class Nn extends zs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function TR(t){return we(t)&&t.name==="AuthSessionMissingError"}class oi extends zs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class pl extends zs{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ml extends zs{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function NR(t){return we(t)&&t.name==="AuthImplicitGrantRedirectError"}class Ky extends zs{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tf extends zs{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Ed(t){return we(t)&&t.name==="AuthRetryableFetchError"}class Qy extends zs{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class nf extends zs{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Rl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Xy=` 	
\r=`.split(""),CR=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Xy.length;e+=1)t[Xy[e].charCodeAt(0)]=-2;for(let e=0;e<Rl.length;e+=1)t[Rl[e].charCodeAt(0)]=e;return t})();function Wy(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Rl[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Rl[r]),e.queuedBits-=6}}function fb(t,e,n){const r=CR[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Zy(t){const e=[],n=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},o=c=>{RR(c,r,n)};for(let c=0;c<t.length;c+=1)fb(t.charCodeAt(c),a,o);return e.join("")}function AR(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function IR(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}AR(r,e)}}function RR(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function wi(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<t.length;a+=1)fb(t.charCodeAt(a),n,r);return new Uint8Array(e)}function DR(t){const e=[];return IR(t,n=>e.push(n)),new Uint8Array(e)}function yr(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};return t.forEach(a=>Wy(a,n,r)),Wy(null,n,r),e.join("")}function MR(t){return Math.round(Date.now()/1e3)+t}function kR(){return Symbol("auth-callback")}const Mt=()=>typeof window<"u"&&typeof document<"u",cr={tested:!1,writable:!1},hb=()=>{if(!Mt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(cr.tested)return cr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),cr.tested=!0,cr.writable=!0}catch{cr.tested=!0,cr.writable=!1}return cr.writable};function PR(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,o)=>{e[o]=a})}catch{}return n.searchParams.forEach((r,a)=>{e[a]=r}),e}const pb=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),UR=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",pi=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},ur=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Ls=async(t,e)=>{await t.removeItem(e)};class zl{constructor(){this.promise=new zl.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}zl.promiseConstructor=Promise;function Td(t){const e=t.split(".");if(e.length!==3)throw new nf("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!wR.test(e[r]))throw new nf("JWT not in base64url format");return{header:JSON.parse(Zy(e[0])),payload:JSON.parse(Zy(e[1])),signature:wi(e[2]),raw:{header:e[0],payload:e[1]}}}async function jR(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function OR(t,e){return new Promise((r,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const c=await t(o);if(!e(o,null,c)){r(c);return}}catch(c){if(!e(o,c)){a(c);return}}})()})}function LR(t){return("0"+t.toString(16)).substr(-2)}function qR(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let o=0;o<56;o++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,LR).join("")}async function BR(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}async function VR(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await BR(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function li(t,e,n=!1){const r=qR();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await pi(t,`${e}-code-verifier`,a);const o=await VR(r);return[o,r===o?"plain":"s256"]}const HR=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function GR(t){const e=t.headers.get(ef);if(!e||!e.match(HR))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function zR(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function FR(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const $R=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ci(t){if(!$R.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Nd(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function JR(t,e){return new Proxy(t,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const o=r.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,a)}})}function ex(t){return JSON.parse(JSON.stringify(t))}const fr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),YR=[502,503,504];async function tx(t){var e;if(!UR(t))throw new tf(fr(t),0);if(YR.includes(t.status))throw new tf(fr(t),t.status);let n;try{n=await t.json()}catch(o){throw new mr(fr(o),o)}let r;const a=GR(t);if(a&&a.getTime()>=db["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Qy(fr(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Nn}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((o,c)=>o&&typeof c=="string",!0))throw new Qy(fr(n),t.status,n.weak_password.reasons);throw new SR(fr(n),t.status||500,r)}const KR=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function Te(t,e,n,r){var a;const o=Object.assign({},r==null?void 0:r.headers);o[ef]||(o[ef]=db["2024-01-01"].name),r!=null&&r.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const c=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(c.redirect_to=r.redirectTo);const d=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",p=await QR(t,e,n+d,{headers:o,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(p):{data:Object.assign({},p),error:null}}async function QR(t,e,n,r,a,o){const c=KR(e,r,a,o);let d;try{d=await t(n,Object.assign({},c))}catch(p){throw console.error(p),new tf(fr(p),0)}if(d.ok||await tx(d),r!=null&&r.noResolveJson)return d;try{return await d.json()}catch(p){await tx(p)}}function Cn(t){var e;let n=null;ZR(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=MR(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function nx(t){const e=Cn(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Bs(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function XR(t){return{data:t,error:null}}function WR(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:o}=t,c=Di(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),d={action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:o},p=Object.assign({},c);return{data:{properties:d,user:p},error:null}}function sx(t){return t}function ZR(t){return t.access_token&&t.refresh_token&&t.expires_in}const Cd=["global","local","others"];class e4{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=pb(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Cd[0]){if(Cd.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Cd.join(", ")}`);try{return await Te(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(we(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await Te(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Bs})}catch(r){if(we(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Di(e,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await Te(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:WR,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(we(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Te(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Bs})}catch(n){if(we(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,a,o,c,d,p;try{const h={nextPage:null,lastPage:0,total:0},x=await Te(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:sx});if(x.error)throw x.error;const v=await x.json(),w=(c=x.headers.get("x-total-count"))!==null&&c!==void 0?c:0,_=(p=(d=x.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&p!==void 0?p:[];return _.length>0&&(_.forEach(E=>{const T=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),M=JSON.parse(E.split(";")[1].split("=")[1]);h[`${M}Page`]=T}),h.total=parseInt(w)),{data:Object.assign(Object.assign({},v),h),error:null}}catch(h){if(we(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){ci(e);try{return await Te(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Bs})}catch(n){if(we(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){ci(e);try{return await Te(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Bs})}catch(r){if(we(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){ci(e);try{return await Te(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Bs})}catch(r){if(we(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ci(e.userId);try{const{data:n,error:r}=await Te(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(we(n))return{data:null,error:n};throw n}}async _deleteFactor(e){ci(e.userId),ci(e.id);try{return{data:await Te(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(we(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,a,o,c,d,p;try{const h={nextPage:null,lastPage:0,total:0},x=await Te(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:sx});if(x.error)throw x.error;const v=await x.json(),w=(c=x.headers.get("x-total-count"))!==null&&c!==void 0?c:0,_=(p=(d=x.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&p!==void 0?p:[];return _.length>0&&(_.forEach(E=>{const T=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),M=JSON.parse(E.split(";")[1].split("=")[1]);h[`${M}Page`]=T}),h.total=parseInt(w)),{data:Object.assign(Object.assign({},v),h),error:null}}catch(h){if(we(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await Te(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(we(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Te(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(we(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Te(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(we(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await Te(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(we(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Te(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(we(n))return{data:null,error:n};throw n}}}function rx(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const ui={debug:!!(globalThis&&hb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class mb extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class t4 extends mb{}async function n4(t,e,n){ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ui.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await n()}finally{ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(e===0)throw ui.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new t4(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(ui.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function s4(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function gb(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function r4(t){return parseInt(t,16)}function i4(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function a4(t){var e;const{chainId:n,domain:r,expirationTime:a,issuedAt:o=new Date,nonce:c,notBefore:d,requestId:p,resources:h,scheme:x,uri:v,version:w}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(w!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${w}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const _=gb(t.address),E=x?`${x}://${r}`:r,T=t.statement?`${t.statement}
`:"",M=`${E} wants you to sign in with your Ethereum account:
${_}

${T}`;let P=`URI: ${v}
Version: ${w}
Chain ID: ${n}${c?`
Nonce: ${c}`:""}
Issued At: ${o.toISOString()}`;if(a&&(P+=`
Expiration Time: ${a.toISOString()}`),d&&(P+=`
Not Before: ${d.toISOString()}`),p&&(P+=`
Request ID: ${p}`),h){let k=`
Resources:`;for(const C of h){if(!C||typeof C!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${C}`);k+=`
- ${C}`}P+=k}return`${M}
${P}`}class vt extends Error{constructor({message:e,code:n,cause:r,name:a}){var o;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(o=a??(r instanceof Error?r.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=n}}class Dl extends vt{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function o4({error:t,options:e}){var n,r,a;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new vt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=o.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new vt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new vt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=o.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new vt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new vt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new vt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return o.pubKeyCredParams.filter(d=>d.type==="public-key").length===0?new vt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new vt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const c=window.location.hostname;if(yb(c)){if(o.rp.id!==c)return new vt({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new vt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new vt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new vt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new vt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function l4({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new vt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new vt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(yb(r)){if(n.rpId!==r)return new vt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new vt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new vt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new vt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class c4{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const u4=new c4;function d4(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,a=Di(t,["challenge","user","excludeCredentials"]),o=wi(e).buffer,c=Object.assign(Object.assign({},n),{id:wi(n.id).buffer}),d=Object.assign(Object.assign({},a),{challenge:o,user:c});if(r&&r.length>0){d.excludeCredentials=new Array(r.length);for(let p=0;p<r.length;p++){const h=r[p];d.excludeCredentials[p]=Object.assign(Object.assign({},h),{id:wi(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return d}function f4(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Di(t,["challenge","allowCredentials"]),a=wi(e).buffer,o=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){o.allowCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const d=n[c];o.allowCredentials[c]=Object.assign(Object.assign({},d),{id:wi(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return o}function h4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:yr(new Uint8Array(t.response.attestationObject)),clientDataJSON:yr(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function p4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:yr(new Uint8Array(a.authenticatorData)),clientDataJSON:yr(new Uint8Array(a.clientDataJSON)),signature:yr(new Uint8Array(a.signature)),userHandle:a.userHandle?yr(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function yb(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function ix(){var t,e;return!!(Mt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function m4(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Dl("Browser returned unexpected credential type",e)}:{data:null,error:new Dl("Empty credential response",e)}}catch(e){return{data:null,error:o4({error:e,options:t})}}}async function g4(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Dl("Browser returned unexpected credential type",e)}:{data:null,error:new Dl("Empty credential response",e)}}catch(e){return{data:null,error:l4({error:e,options:t})}}}const y4={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},x4={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ml(...t){const e=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of t)if(a)for(const o in a){const c=a[o];if(c!==void 0)if(Array.isArray(c))r[o]=c;else if(n(c))r[o]=c;else if(e(c)){const d=r[o];e(d)?r[o]=Ml(d,c):r[o]=Ml(c)}else r[o]=c}return r}function v4(t,e){return Ml(y4,t,e||{})}function b4(t,e){return Ml(x4,t,e||{})}class w4{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:a},o){try{const{data:c,error:d}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!c)return{data:null,error:d};const p=a??u4.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:h}=c.webauthn.credential_options.publicKey;h.name||(h.name=`${h.id}:${r}`),h.displayName||(h.displayName=h.name)}switch(c.webauthn.type){case"create":{const h=v4(c.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:x,error:v}=await m4({publicKey:h,signal:p});return x?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:x}},error:null}:{data:null,error:v}}case"request":{const h=b4(c.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:x,error:v}=await g4(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:h,signal:p}));return x?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:x}},error:null}:{data:null,error:v}}}}catch(c){return we(c)?{data:null,error:c}:{data:null,error:new mr("Unexpected error in challenge",c)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!n)return{data:null,error:new Ua("rpId is required for WebAuthn authentication")};try{if(!ix())return{data:null,error:new mr("Browser does not support WebAuthn",null)};const{data:c,error:d}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:o});if(!c)return{data:null,error:d};const{webauthn:p}=c;return this._verify({factorId:e,challengeId:c.challengeId,webauthn:{type:p.type,rpId:n,rpOrigins:r,credential_response:p.credential_response}})}catch(c){return we(c)?{data:null,error:c}:{data:null,error:new mr("Unexpected error in authenticate",c)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},o){if(!n)return{data:null,error:new Ua("rpId is required for WebAuthn registration")};try{if(!ix())return{data:null,error:new mr("Browser does not support WebAuthn",null)};const{data:c,error:d}=await this._enroll({friendlyName:e});if(!c)return await this.client.mfa.listFactors().then(x=>{var v;return(v=x.data)===null||v===void 0?void 0:v.all.find(w=>w.factor_type==="webauthn"&&w.friendly_name===e&&w.status!=="unverified")}).then(x=>x?this.client.mfa.unenroll({factorId:x==null?void 0:x.id}):void 0),{data:null,error:d};const{data:p,error:h}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:o});return p?this._verify({factorId:c.id,challengeId:p.challengeId,webauthn:{rpId:n,rpOrigins:r,type:p.webauthn.type,credential_response:p.webauthn.credential_response}}):{data:null,error:h}}catch(c){return we(c)?{data:null,error:c}:{data:null,error:new mr("Unexpected error in register",c)}}}}s4();const _4={url:xR,storageKey:vR,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:bR,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function ax(t,e,n){return await n()}const di={};class ja{get jwks(){var e,n;return(n=(e=di[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){di[this.storageKey]=Object.assign(Object.assign({},di[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=di[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){di[this.storageKey]=Object.assign(Object.assign({},di[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},_4),e);if(this.storageKey=o.storageKey,this.instanceID=(n=ja.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,ja.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&Mt()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new e4({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=pb(o.fetch),this.lock=o.lock||ax,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:Mt()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=n4:this.lock=ax,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new w4(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:hb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=rx(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=rx(this.memoryStorage)),Mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c),await this._notifyAllSubscribers(c.data.event,c.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${ub}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Mt()&&(n=PR(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Mt()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:o}=await this._getSessionFromURL(n,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),NR(o)){const p=(e=o.details)===null||e===void 0?void 0:e.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:c,redirectType:d}=a;return this._debug("#_initialize()","detected session in URL",c,"redirect type",d),await this._saveSession(c),setTimeout(async()=>{d==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return we(n)?this._returnResult({error:n}):this._returnResult({error:new mr("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,a;try{const o=await Te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e==null?void 0:e.options)===null||a===void 0?void 0:a.captchaToken}},xform:Cn}),{data:c,error:d}=o;if(d||!c)return this._returnResult({data:{user:null,session:null},error:d});const p=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(o){if(we(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var n,r,a;try{let o;if("email"in e){const{email:x,password:v,options:w}=e;let _=null,E=null;this.flowType==="pkce"&&([_,E]=await li(this.storage,this.storageKey)),o=await Te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:w==null?void 0:w.emailRedirectTo,body:{email:x,password:v,data:(n=w==null?void 0:w.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},code_challenge:_,code_challenge_method:E},xform:Cn})}else if("phone"in e){const{phone:x,password:v,options:w}=e;o=await Te(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:x,password:v,data:(r=w==null?void 0:w.data)!==null&&r!==void 0?r:{},channel:(a=w==null?void 0:w.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken}},xform:Cn})}else throw new pl("You must provide either an email or phone number and a password");const{data:c,error:d}=o;if(d||!c)return this._returnResult({data:{user:null,session:null},error:d});const p=c.session,h=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(o){if(we(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let n;if("email"in e){const{email:o,password:c,options:d}=e;n=await Te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:nx})}else if("phone"in e){const{phone:o,password:c,options:d}=e;n=await Te(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:nx})}else throw new pl("You must provide either an email or phone number and a password");const{data:r,error:a}=n;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!r||!r.session||!r.user){const o=new oi;return this._returnResult({data:{user:null,session:null},error:o})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,a,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,a,o,c,d,p,h,x,v,w;let _,E;if("message"in e)_=e.message,E=e.signature;else{const{chain:T,wallet:M,statement:P,options:k}=e;let C;if(Mt())if(typeof M=="object")C=M;else{const Z=window;if("ethereum"in Z&&typeof Z.ethereum=="object"&&"request"in Z.ethereum&&typeof Z.ethereum.request=="function")C=Z.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof M!="object"||!(k!=null&&k.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=M}const I=new URL((n=k==null?void 0:k.url)!==null&&n!==void 0?n:window.location.href),j=await C.request({method:"eth_requestAccounts"}).then(Z=>Z).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!j||j.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const B=gb(j[0]);let H=(r=k==null?void 0:k.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!H){const Z=await C.request({method:"eth_chainId"});H=r4(Z)}const Q={domain:I.host,address:B,statement:P,uri:I.href,version:"1",chainId:H,nonce:(a=k==null?void 0:k.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(c=(o=k==null?void 0:k.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(d=k==null?void 0:k.signInWithEthereum)===null||d===void 0?void 0:d.expirationTime,notBefore:(p=k==null?void 0:k.signInWithEthereum)===null||p===void 0?void 0:p.notBefore,requestId:(h=k==null?void 0:k.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(x=k==null?void 0:k.signInWithEthereum)===null||x===void 0?void 0:x.resources};_=a4(Q),E=await C.request({method:"personal_sign",params:[i4(_),B]})}try{const{data:T,error:M}=await Te(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:_,signature:E},!((v=e.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(w=e.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Cn});if(M)throw M;if(!T||!T.session||!T.user){const P=new oi;return this._returnResult({data:{user:null,session:null},error:P})}return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),this._returnResult({data:Object.assign({},T),error:M})}catch(T){if(we(T))return this._returnResult({data:{user:null,session:null},error:T});throw T}}async signInWithSolana(e){var n,r,a,o,c,d,p,h,x,v,w,_;let E,T;if("message"in e)E=e.message,T=e.signature;else{const{chain:M,wallet:P,statement:k,options:C}=e;let I;if(Mt())if(typeof P=="object")I=P;else{const B=window;if("solana"in B&&typeof B.solana=="object"&&("signIn"in B.solana&&typeof B.solana.signIn=="function"||"signMessage"in B.solana&&typeof B.solana.signMessage=="function"))I=B.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof P!="object"||!(C!=null&&C.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");I=P}const j=new URL((n=C==null?void 0:C.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in I&&I.signIn){const B=await I.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},C==null?void 0:C.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),k?{statement:k}:null));let H;if(Array.isArray(B)&&B[0]&&typeof B[0]=="object")H=B[0];else if(B&&typeof B=="object"&&"signedMessage"in B&&"signature"in B)H=B;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in H&&"signature"in H&&(typeof H.signedMessage=="string"||H.signedMessage instanceof Uint8Array)&&H.signature instanceof Uint8Array)E=typeof H.signedMessage=="string"?H.signedMessage:new TextDecoder().decode(H.signedMessage),T=H.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in I)||typeof I.signMessage!="function"||!("publicKey"in I)||typeof I!="object"||!I.publicKey||!("toBase58"in I.publicKey)||typeof I.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${j.host} wants you to sign in with your Solana account:`,I.publicKey.toBase58(),...k?["",k,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(a=(r=C==null?void 0:C.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((o=C==null?void 0:C.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${C.signInWithSolana.notBefore}`]:[],...!((c=C==null?void 0:C.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${C.signInWithSolana.expirationTime}`]:[],...!((d=C==null?void 0:C.signInWithSolana)===null||d===void 0)&&d.chainId?[`Chain ID: ${C.signInWithSolana.chainId}`]:[],...!((p=C==null?void 0:C.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${C.signInWithSolana.nonce}`]:[],...!((h=C==null?void 0:C.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${C.signInWithSolana.requestId}`]:[],...!((v=(x=C==null?void 0:C.signInWithSolana)===null||x===void 0?void 0:x.resources)===null||v===void 0)&&v.length?["Resources",...C.signInWithSolana.resources.map(H=>`- ${H}`)]:[]].join(`
`);const B=await I.signMessage(new TextEncoder().encode(E),"utf8");if(!B||!(B instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");T=B}}try{const{data:M,error:P}=await Te(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:yr(T)},!((w=e.options)===null||w===void 0)&&w.captchaToken?{gotrue_meta_security:{captcha_token:(_=e.options)===null||_===void 0?void 0:_.captchaToken}}:null),xform:Cn});if(P)throw P;if(!M||!M.session||!M.user){const k=new oi;return this._returnResult({data:{user:null,session:null},error:k})}return M.session&&(await this._saveSession(M.session),await this._notifyAllSubscribers("SIGNED_IN",M.session)),this._returnResult({data:Object.assign({},M),error:P})}catch(M){if(we(M))return this._returnResult({data:{user:null,session:null},error:M});throw M}}async _exchangeCodeForSession(e){const n=await ur(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{const{data:o,error:c}=await Te(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Cn});if(await Ls(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!o||!o.session||!o.user){const d=new oi;return this._returnResult({data:{user:null,session:null,redirectType:null},error:d})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:c})}catch(o){if(we(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:n,provider:r,token:a,access_token:o,nonce:c}=e,d=await Te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:o,nonce:c,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Cn}),{data:p,error:h}=d;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!p||!p.session||!p.user){const x=new oi;return this._returnResult({data:{user:null,session:null},error:x})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:p,error:h})}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,a,o,c;try{if("email"in e){const{email:d,options:p}=e;let h=null,x=null;this.flowType==="pkce"&&([h,x]=await li(this.storage,this.storageKey));const{error:v}=await Te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},create_user:(r=p==null?void 0:p.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:h,code_challenge_method:x},redirectTo:p==null?void 0:p.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in e){const{phone:d,options:p}=e,{data:h,error:x}=await Te(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:d,data:(a=p==null?void 0:p.data)!==null&&a!==void 0?a:{},create_user:(o=p==null?void 0:p.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},channel:(c=p==null?void 0:p.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:x})}throw new pl("You must provide either an email or phone number.")}catch(d){if(we(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async verifyOtp(e){var n,r;try{let a,o;"options"in e&&(a=(n=e.options)===null||n===void 0?void 0:n.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:d}=await Te(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:Cn});if(d)throw d;if(!c)throw new Error("An error occurred on token verification.");const p=c.session,h=c.user;return p!=null&&p.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),this._returnResult({data:{user:h,session:p},error:null})}catch(a){if(we(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(e){var n,r,a,o,c;try{let d=null,p=null;this.flowType==="pkce"&&([d,p]=await li(this.storage,this.storageKey));const h=await Te(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e==null?void 0:e.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:d,code_challenge_method:p}),headers:this.headers,xform:XR});return!((o=h.data)===null||o===void 0)&&o.url&&Mt()&&!(!((c=e.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(d){if(we(d))return this._returnResult({data:null,error:d});throw d}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Nn;const{error:a}=await Te(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(e){if(we(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:o}=e,{error:c}=await Te(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in e){const{phone:r,type:a,options:o}=e,{data:c,error:d}=await Te(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new pl("You must provide either an email or phone number and a type")}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await ur(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Sd:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await ur(this.userStorage,this.storageKey+"-user");c!=null&&c.user?e.user=c.user:e.user=Nd()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};e.user=JR(e.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Bs}):await this._useSession(async n=>{var r,a,o;const{data:c,error:d}=n;if(d)throw d;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Nn}:await Te(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:Bs})})}catch(n){if(we(n))return TR(n)&&(await this._removeSession(),await Ls(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:a,error:o}=r;if(o)throw o;if(!a.session)throw new Nn;const c=a.session;let d=null,p=null;this.flowType==="pkce"&&e.email!=null&&([d,p]=await li(this.storage,this.storageKey));const{data:h,error:x}=await Te(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:d,code_challenge_method:p}),jwt:c.access_token,xform:Bs});if(x)throw x;return c.user=h.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(r){if(we(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Nn;const n=Date.now()/1e3;let r=n,a=!0,o=null;const{payload:c}=Td(e.access_token);if(c.exp&&(r=c.exp,a=r<=n),a){const{data:d,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!d)return{data:{user:null,session:null},error:null};o=d}else{const{data:d,error:p}=await this._getUser(e.access_token);if(p)throw p;o={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(n){if(we(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:c,error:d}=n;if(d)throw d;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Nn;const{data:a,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(we(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Mt())throw new ml("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ml(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Ky("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ml("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ky("No code detected.");const{data:k,error:C}=await this._exchangeCodeForSession(e.code);if(C)throw C;const I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:o,refresh_token:c,expires_in:d,expires_at:p,token_type:h}=e;if(!o||!d||!c||!h)throw new ml("No session defined in URL");const x=Math.round(Date.now()/1e3),v=parseInt(d);let w=x+v;p&&(w=parseInt(p));const _=w-x;_*1e3<=hi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${_}s, should have been closer to ${v}s`);const E=w-v;x-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,w,x):x-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,w,x);const{data:T,error:M}=await this._getUser(o);if(M)throw M;const P={provider_token:r,provider_refresh_token:a,access_token:o,expires_in:v,expires_at:w,refresh_token:c,token_type:h,user:T.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:P,redirectType:e.type},error:null})}catch(r){if(we(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await ur(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({error:o});const c=(r=a.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:d}=await this.admin.signOut(c,e);if(d&&!(ER(d)&&(d.status===404||d.status===401||d.status===403)))return this._returnResult({error:d})}return e!=="others"&&(await this._removeSession(),await Ls(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=kR(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,a;try{const{data:{session:o},error:c}=n;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await li(this.storage,this.storageKey,!0));try{return await Te(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(o){if(we(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:a}=await this._useSession(async o=>{var c,d,p,h,x;const{data:v,error:w}=o;if(w)throw w;const _=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(d=e.options)===null||d===void 0?void 0:d.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await Te(this.fetch,"GET",_,{headers:this.headers,jwt:(x=(h=v.session)===null||h===void 0?void 0:h.access_token)!==null&&x!==void 0?x:void 0})});if(a)throw a;return Mt()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(we(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:o}}=n;if(a)throw a;const{options:c,provider:d,token:p,access_token:h,nonce:x}=e,v=await Te(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=o==null?void 0:o.access_token)!==null&&r!==void 0?r:void 0,body:{provider:d,id_token:p,access_token:h,nonce:x,link_identity:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Cn}),{data:w,error:_}=v;return _?this._returnResult({data:{user:null,session:null},error:_}):!w||!w.session||!w.user?this._returnResult({data:{user:null,session:null},error:new oi}):(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("USER_UPDATED",w.session)),this._returnResult({data:w,error:_}))}catch(a){if(we(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,a;const{data:o,error:c}=n;if(c)throw c;return await Te(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await OR(async a=>(a>0&&await jR(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await Te(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Cn})),(a,o)=>{const c=200*Math.pow(2,a);return o&&Ed(o)&&Date.now()+c-r<hi})}catch(r){if(this._debug(n,"error",r),we(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Mt()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await ur(this.storage,this.storageKey);if(a&&this.userStorage){let c=await ur(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:a.user},await pi(this.userStorage,this.storageKey+"-user",c)),a.user=(e=c==null?void 0:c.user)!==null&&e!==void 0?e:Nd()}else if(a&&!a.user&&!a.user){const c=await ur(this.storage,this.storageKey+"-user");c&&(c!=null&&c.user)?(a.user=c.user,await Ls(this.storage,this.storageKey+"-user"),await pi(this.storage,this.storageKey,a)):a.user=Nd()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const o=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Sd;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Sd}s`),o){if(this.autoRefreshToken&&a.refresh_token){const{error:c}=await this._callRefreshToken(a.refresh_token);c&&(console.error(c),Ed(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:d}=await this._getUser(a.access_token);!d&&(c!=null&&c.user)?(a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Nn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new zl;const{data:o,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!o.session)throw new Nn;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const d={data:o.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(o){if(this._debug(a,"error",o),we(o)){const c={data:null,error:o};return Ed(o)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,n,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const o=[],c=Array.from(this.stateChangeEmitters.values()).map(async d=>{try{await d.callback(e,n)}catch(p){o.push(p)}});if(await Promise.all(c),o.length>0){for(let d=0;d<o.length;d+=1)console.error(o[d]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await pi(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const o=ex(a);await pi(this.storage,this.storageKey,o)}else{const a=ex(n);await pi(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await Ls(this.storage,this.storageKey),await Ls(this.storage,this.storageKey+"-code-verifier"),await Ls(this.storage,this.storageKey+"-user"),this.userStorage&&await Ls(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Mt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),hi);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/hi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${hi}ms, refresh threshold is ${Zd} ticks`),a<=Zd&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof mb)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Mt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,c]=await li(this.storage,this.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(c)}`});a.push(d.toString())}if(r!=null&&r.queryParams){const o=new URLSearchParams(r.queryParams);a.push(o.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;return o?this._returnResult({data:null,error:o}):await Te(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,a;const{data:o,error:c}=n;if(c)return this._returnResult({data:null,error:c});const d=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:p,error:h}=await Te(this.fetch,"POST",`${this.url}/factors`,{body:d,headers:this.headers,jwt:(r=o==null?void 0:o.session)===null||r===void 0?void 0:r.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&p.type==="totp"&&(!((a=p==null?void 0:p.totp)===null||a===void 0)&&a.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),this._returnResult({data:p,error:null}))})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({data:null,error:o});const c=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?h4(e.webauthn.credential_response):p4(e.webauthn.credential_response)})}:{code:e.code}),{data:d,error:p}=await Te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:c,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return p?this._returnResult({data:null,error:p}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+d.expires_in},d)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",d),this._returnResult({data:d,error:p}))})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:o}=n;if(o)return this._returnResult({data:null,error:o});const c=await Te(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});if(c.error)return c;const{data:d}=c;if(d.type!=="webauthn")return{data:d,error:null};switch(d.webauthn.type){case"create":return{data:Object.assign(Object.assign({},d),{webauthn:Object.assign(Object.assign({},d.webauthn),{credential_options:Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:d4(d.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},d),{webauthn:Object.assign(Object.assign({},d.webauthn),{credential_options:Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:f4(d.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])a.all.push(o),o.status==="verified"&&a[o.factor_type].push(o);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Td(r.access_token);let c=null;o.aal&&(c=o.aal);let d=c;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(x=>x.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(d="aal2");const h=o.amr||[];return{data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?await Te(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Nn})})}catch(n){if(we(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new Nn});const c=await Te(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:d=>({data:d,error:null})});return c.data&&c.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(r){if(we(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!a)return this._returnResult({data:null,error:new Nn});const c=await Te(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:d=>({data:d,error:null})});return c.data&&c.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(c.data.redirect_url),c})}catch(r){if(we(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(d=>d.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(d=>d.kid===e),r&&this.jwks_cached_at+_R>a)return r;const{data:o,error:c}=await Te(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=a,r=o.keys.find(d=>d.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:_,error:E}=await this.getSession();if(E||!_.session)return this._returnResult({data:null,error:E});r=_.session.access_token}const{header:a,payload:o,signature:c,raw:{header:d,payload:p}}=Td(r);n!=null&&n.allowExpired||zR(o.exp);const h=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!h){const{error:_}=await this.getUser(r);if(_)throw _;return{data:{claims:o,header:a,signature:c},error:null}}const x=FR(a.alg),v=await crypto.subtle.importKey("jwk",h,x,!0,["verify"]);if(!await crypto.subtle.verify(x,v,c,DR(`${d}.${p}`)))throw new nf("Invalid JWT signature");return{data:{claims:o,header:a,signature:c},error:null}}catch(r){if(we(r))return this._returnResult({data:null,error:r});throw r}}}ja.nextInstanceID={};const S4=ja;class E4 extends S4{constructor(e){super(e)}}class T4{constructor(e,n,r){var a,o,c;this.supabaseUrl=e,this.supabaseKey=n;const d=yR(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",d),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",d),this.storageUrl=new URL("storage/v1",d),this.functionsUrl=new URL("functions/v1",d);const p=`sb-${d.hostname.split(".")[0]}-auth-token`,h={db:cR,realtime:dR,auth:Object.assign(Object.assign({},uR),{storageKey:p}),global:lR},x=gR(r??{},h);this.storageKey=(a=x.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=x.global.headers)!==null&&o!==void 0?o:{},x.accessToken?(this.accessToken=x.accessToken,this.auth=new Proxy({},{get:(v,w)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(w)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=x.auth)!==null&&c!==void 0?c:{},this.headers,x.global.fetch),this.fetch=pR(n,this._getAccessToken.bind(this),x.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},x.realtime)),this.accessToken&&this.accessToken().then(v=>this.realtime.setAuth(v)).catch(v=>console.warn("Failed to set initial Realtime auth token:",v)),this.rest=new xI(new URL("rest/v1",d).href,{headers:this.headers,schema:x.db.schema,fetch:this.fetch}),this.storage=new iR(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),x.accessToken||this._listenForAuthEvents()}get functions(){return new pI(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:o,storageKey:c,flowType:d,lock:p,debug:h,throwOnError:x},v,w){const _={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new E4({url:this.authUrl.href,headers:Object.assign(Object.assign({},_),v),storageKey:c,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:o,flowType:d,lock:p,debug:h,throwOnError:x,fetch:w,hasCustomAuthorizationHeader:Object.keys(this.headers).some(E=>E.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new UI(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const N4=(t,e,n)=>new T4(t,e,n);function C4(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}C4()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const A4="https://xzlqxctmgygpghaubsvt.supabase.co",I4="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6bHF4Y3RtZ3lncGdoYXVic3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxODk3MDUsImV4cCI6MjA3ODc2NTcwNX0.SJKSgc4fwoS9mLamnU75DNmxilBqho-Hi6OgZWEgiO4";let xb=null;xb=N4(A4,I4,{auth:{persistSession:!1}});const ls=xb,ox={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var lx={};const R4="simulated_local",D4=R4==="simulated_local",vr=(t,e)=>{const n=typeof import.meta<"u"&&ox?ox[t]:void 0,r=typeof process<"u"&&lx?lx[t]:void 0;return(n??r??e??"").toString()},as=(()=>{const t=vr("VITE_ENABLE_DAN","false").toLowerCase();return t==="1"||t==="true"||t==="yes"})(),M4=vr("VITE_DAN_DERIVATION_SALT","dan-dev-salt");vr("VITE_DAN_REALTIME_CHANNEL","dan_events");const k4=vr("VITE_SUPABASE_URL",vr("SUPABASE_URL","")),P4=vr("VITE_SUPABASE_ANON_KEY",vr("SUPABASE_ANON_KEY",""));as&&(!k4||!P4)&&console.warn("[Config] DAN is enabled but Supabase credentials are missing. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY (or SUPABASE_URL/SUPABASE_ANON_KEY) in your environment.");const vb="dan:keypairs:v1",kl="dan:event-buffer:v1",bb=()=>typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null,Of=(t,e)=>{const n=bb();if(!n)return e;try{const r=n.getItem(t);return r?JSON.parse(r):e}catch{return e}},Lf=(t,e)=>{const n=bb();if(n)try{n.setItem(t,JSON.stringify(e))}catch{}},U4=t=>Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join(""),j4=()=>{if(typeof globalThis>"u")return null;const t=globalThis.crypto;return t&&t.subtle?t.subtle:null},Pl=async t=>{const e=j4();if(!e){let a=0;for(let o=0;o<t.length;o+=1)a=(a<<5)-a+t.charCodeAt(o),a|=0;return`fallback-${Math.abs(a).toString(16)}`}const n=new TextEncoder().encode(t),r=await e.digest("SHA-256",n);return U4(r)},Fl=async t=>{const e=typeof t=="string"?t:JSON.stringify(t??{});return Pl(e)},O4=async t=>{const e=`${t}:${Ba||"global"}:${M4}`,n=await Pl(`${e}:private`),r=await Pl(`${n}:public`),a=r.slice(0,16);return{publicKey:r,fingerprint:a,derivedAt:new Date().toISOString(),privateKey:n}},wb=()=>Of(vb,{}),L4=t=>Lf(vb,t),q4=t=>wb()[t]||null,_b=(t,e)=>{const n=wb();n[t]=e,L4(n)},B4=async(t,e)=>{if(!ls)return!1;try{const n=new Date().toISOString(),{error:r}=await ls.from("dan_keys").upsert({shop_id:t,namespace:Ba,public_key:e.publicKey,fingerprint:e.fingerprint,capability_scope:["local","dan"],last_seen_at:n},{onConflict:"shop_id"});return r?(console.warn("[DAN] Failed to register key with control plane",r),!1):(_b(t,{...e,lastRegisteredAt:n}),!0)}catch(n){return console.warn("[DAN] Error registering key",n),!1}},V4=async()=>{const t=de;if(!t||!as)return null;let e=q4(t);return e||(e=await O4(t),_b(t,e)),ls&&await B4(t,e),e},H4=async()=>{if(!ls)return;const t=Of(kl,[]);if(t.length)try{const e=t.map(r=>({event_id:r.eventId,shop_id:r.shopId,namespace:r.namespace,event_type:r.eventType,payload:r.payload,share_scope:r.shareScope,vector_context:r.vectorContext,proofs:r.proofs,actor_public_key:r.actor.publicKey,actor_fingerprint:r.actor.fingerprint,actor_signature:r.actor.signature,created_at:r.createdAt})),{error:n}=await ls.from("dan_events").insert(e);n||Lf(kl,[])}catch(e){console.warn("[DAN] Failed to flush buffered events",e)}},qf=t=>{const e=new Set(["local"]);return(t||[]).forEach(n=>{n&&e.add(n)}),Array.from(e)},G4=t=>qf(t).includes("dan"),Sb=()=>as,Ad=t=>{const e=Of(kl,[]);e.push(t),Lf(kl,e)},Bf=async t=>{if(!as)return null;const e=de;if(!e)return null;const n=await V4();if(!n)return null;const r=qf(t.shareScope),a=JSON.parse(JSON.stringify(t.payload||{})),o=await Fl(a),c=await Pl(`${n.privateKey}:${o}`),d={eventId:Et(),eventType:t.eventType,shopId:e,namespace:Ba||null,payload:a,shareScope:r,vectorContext:t.vectorContext||null,proofs:{...t.proofs||{},hash:o},actor:{publicKey:n.publicKey,fingerprint:n.fingerprint,signature:c},createdAt:new Date().toISOString()};if(await H4(),!ls)return Ad(d),d;try{const{error:p}=await ls.from("dan_events").insert({event_id:d.eventId,shop_id:d.shopId,namespace:d.namespace,event_type:d.eventType,payload:d.payload,share_scope:d.shareScope,vector_context:d.vectorContext,proofs:d.proofs,actor_public_key:d.actor.publicKey,actor_fingerprint:d.actor.fingerprint,actor_signature:d.actor.signature,created_at:d.createdAt});p&&(console.warn("[DAN] Failed to send event to Supabase, buffering",p),Ad(d))}catch(p){console.warn("[DAN] Error publishing event, buffering instead",p),Ad(d)}return d},Eb="dan:policies:v1",Tb="dan:policy-runs:v1",Nb=()=>typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null,Cb=(t,e)=>{const n=Nb();if(!n)return e;try{const r=n.getItem(t);return r?JSON.parse(r):e}catch{return e}},Ab=(t,e)=>{const n=Nb();if(n)try{n.setItem(t,JSON.stringify(e))}catch{}},Ib=()=>Cb(Eb,{}),z4=t=>Ab(Eb,t),F4=()=>Cb(Tb,{}),$4=t=>Ab(Tb,t),Rb=async(t,e)=>{var a;const n=Ib();if((a=n[t])!=null&&a.length)return;const r={id:Et(),shopId:t,name:"Auto-flag low inventory offers",description:"Warns when a DAN offer is created with quantity below 10 units so the shop can replenish locally before sharing.",eventType:"inventory.offer.created",scope:"inventory",version:"1.0",enabled:!0,conditions:[{field:"quantity",operator:"lt",value:10},{field:"shareScope",operator:"includes",value:"dan"}],actions:[{type:"notify",params:{message:"DAN offer shared while stock is below 10 units. Confirm replenishment or adjust sharing scope."}},{type:"create_dan_event",params:{trigger:"policy.auto-alert",shopName:e||"unknown shop"}}],author:"system",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};n[t]=[r],z4(n)},cx=async t=>{const e=t||de;return e?Ib()[e]||[]:[]},J4=t=>{const e=F4(),n=e[t.shopId]||[];n.unshift(t),e[t.shopId]=n.slice(0,50),$4(e)},Y4=(t,e)=>e.split(".").reduce((n,r)=>{if(n&&typeof n=="object"&&r in n)return n[r]},t),K4=(t,e)=>{const n=Y4(e,t.field),r=t.value;switch(t.operator){case"eq":return n===r;case"neq":return n!==r;case"gt":return typeof n=="number"&&n>Number(r);case"gte":return typeof n=="number"&&n>=Number(r);case"lt":return typeof n=="number"&&n<Number(r);case"lte":return typeof n=="number"&&n<=Number(r);case"includes":case"contains":return Array.isArray(n)?n.includes(r):typeof n=="string"?n.toLowerCase().includes(String(r).toLowerCase()):!1;default:return!1}},Q4=async(t,e,n)=>{var r,a,o;switch(t.type){case"notify":{const c=((r=t.params)==null?void 0:r.message)||`Policy "${e.name}" triggered for event ${n.eventType}`;console.info(`[PolicyEngine] ${c}`,{policyId:e.id,payload:n.payload});break}case"create_dan_event":{await Bf({eventType:"policy.trigger.executed",payload:{policyId:e.id,policyName:e.name,scope:e.scope,trigger:((a=t.params)==null?void 0:a.trigger)||"policy.action",eventPayload:n.payload}});break}case"tag_inventory":{console.debug("[PolicyEngine] tag_inventory action queued",{policyId:e.id,params:t.params});break}case"call_webhook":{const c=(o=t.params)==null?void 0:o.url;if(!c||typeof fetch>"u")break;try{await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({policyId:e.id,policyName:e.name,payload:n.payload})})}catch(d){console.warn("[PolicyEngine] call_webhook failed",d)}break}default:console.warn("[PolicyEngine] Unknown action type",t.type)}},Db=async t=>{var o,c,d;const e=((o=t.payload)==null?void 0:o.shopId)||de||((d=(c=t.payload)==null?void 0:c.shop)==null?void 0:d.id)||null;if(!e)return;(await cx(e)).length||await Rb(e,Ai);const a=(await cx(e)).filter(p=>p.enabled&&p.eventType===t.eventType);if(a.length)for(const p of a){const h=p.conditions.every(v=>K4(v,t.payload)),x={id:Et(),policyId:p.id,shopId:e,eventType:t.eventType,eventPayload:t.payload,outcome:h?"triggered":"skipped",notes:h?`Policy ${p.name} triggered`:"Condition check failed",createdAt:new Date().toISOString()};if(h)try{for(const v of p.actions)await Q4(v,p,t)}catch(v){x.outcome="error",x.notes=`Action error: ${(v==null?void 0:v.message)||"unknown"}`}J4(x)}},Mb=()=>de||null,X4=t=>{const e=Mb();return e?t.filter(n=>n.shopId===e):t},W4=t=>t.quantity>0&&t.status!=="EMPTY"&&t.status!=="EXPIRED"&&(!t.status||t.status==="ACTIVE"),kb=()=>{const t=Array.from(Le.stockItems.values()).filter(W4);return X4(t)},Vf=t=>qf(t),$l=t=>Sb()&&G4(t),Z4=t=>t?t.split("T")[0]:new Date().toISOString().split("T")[0],Pb=t=>{if(!t)return null;const e=t.trim();if(!e)return null;const n=e.split(/[\s-]/)[0];return n?n.toUpperCase():null},eD=(t,e)=>{const n=Le.products.get(t);return e||(n==null?void 0:n.name)||t},Ub=t=>{for(const e of Le.stockItems.values())if(e.inventoryUuid===t||e.qdrantId===t||String(e.id)===t)return e},tD=async(t,e,n)=>{if($l(e.shareScope||t.shareScope))try{const r=Vf(e.shareScope||t.shareScope),a={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:eD(t.productId,e.productName),quantity:t.quantity,expirationDate:Z4(t.expirationDate),locationBucket:Pb(t.location),sellPrice:t.sellPrice??e.sellPrice??null,batchId:n.batchId,supplierId:t.supplierId||n.supplierId||null,supplierName:n.supplierName||null,shopId:t.shopId,shareScope:r},o=await Fl(a),c=await Mn(`${a.productName} ${a.quantity} ${a.locationBucket||""}`);await Bf({eventType:"inventory.offer.created",payload:{...a,proofHash:o},shareScope:r,vectorContext:c,proofs:{hash:o,link:`qdrant://items/${t.inventoryUuid}`}}),await Db({eventType:"inventory.offer.created",payload:{...a},proofs:{hash:o}}),await _v({inventoryUuid:t.inventoryUuid,productId:t.productId,productName:a.productName,quantity:t.quantity,expirationDate:a.expirationDate,locationBucket:a.locationBucket,sellPrice:a.sellPrice??null,shopId:t.shopId,shopName:Ai,shareScope:r,proofHash:o,vector:c})}catch(r){console.warn("[DAN] Failed to publish inventory.offer.created",r)}},nD=async(t,e,n)=>{if($l(t.shareScope))try{const r=Vf(t.shareScope),a=Math.max((t.quantity||0)-n,0),o={inventoryUuid:t.inventoryUuid,productId:t.productId,productName:e,fulfilledQuantity:n,remainingQuantity:a,saleTimestamp:new Date().toISOString(),batchId:t.batchId,shopId:t.shopId,shareScope:r},c=await Fl(o),d=await Mn(`${o.productName} fulfilled ${n}`);await Bf({eventType:"inventory.offer.fulfilled",payload:{...o,proofHash:c},shareScope:r,vectorContext:d,proofs:{hash:c,link:`qdrant://items/${t.inventoryUuid}`}}),await Db({eventType:"inventory.offer.fulfilled",payload:o,proofs:{hash:c}}),a<=0?await iI(t.inventoryUuid):await _v({inventoryUuid:t.inventoryUuid,productId:t.productId,productName:e,quantity:a,expirationDate:t.expirationDate,locationBucket:Pb(t.location),sellPrice:t.sellPrice,shopId:t.shopId,shopName:Ai,shareScope:r,proofHash:c})}catch(r){console.warn("[DAN] Failed to publish inventory.offer.fulfilled",r)}},sD=async t=>{if(!Sb())return;const e=Array.from(Le.stockItems.values()).filter(n=>$l(n.shareScope));if(e.length)for(const n of t){const r=Array.from(Le.products.values()).find(o=>o.name.toLowerCase()===n.productName.toLowerCase());if(!r)continue;const a=e.find(o=>o.productId===r.id);a&&await nD(a,n.productName,n.quantity)}},Jl=Va,sf=av,jb=()=>aI(),Oa=t=>{const e=de,n=(t==null?void 0:t.id)||null;Iy(n?{...t,id:n}:null),e!==n&&(Ev(),Sv(!1),console.log(`[VectorDB] Shop context changed: ${e||"null"} -> ${n||"null"}, resetting initialization`))},Hf=()=>Mb(),Ob=async()=>{if(console.log(`[VectorDB] initializeAndSeedDatabase called, _activeShopId: ${de}, _initialized: ${Hd}`),!de){console.warn("[VectorDB] initializeAndSeedDatabase: _activeShopId is not set, cannot initialize");return}if(Hd){console.log("[VectorDB] initializeAndSeedDatabase: Already initialized, skipping");return}console.log(`[VectorDB] Initializing database for shopId: ${de}`),await Zx(),await Cl(),console.log(`[VectorDB] After loadDataFromQdrant: ${Le.products.size} products, ${Le.stockItems.size} stock items`),Le.products.size===0&&Le.stockItems.size===0&&(console.log("[VectorDB] No data found, seeding local store..."),await rD(de),await Cl(),console.log(`[VectorDB] After seeding: ${Le.products.size} products, ${Le.stockItems.size} stock items`)),await Rb(de,Ai),Sv(!0),console.log("[VectorDB] Database initialization complete")},rD=async t=>{const n=(await Ri({name:"Organic Foods Dist."})).id,r=[{supplier:"Organic Foods Dist.",deliveryDate:"2024-06-05",inventoryDate:"2024-06-05"}],a=[{batchIndex:0,productName:"Organic Oat Milk",manufacturer:"Oatly",category:"Beverages",expirationDate:"2024-12-15",quantity:50,quantityType:"cartons",costPerUnit:2.5,location:"Shelf A"}],o=[];r.forEach(c=>{const d=Et(),p={...c,id:d};Le.batches.set(d,p),o.push(p)});for(const c of a){const d=o[c.batchIndex],p=Gd(c.productName),h={id:p,name:c.productName,manufacturer:c.manufacturer,category:c.category};Le.products.set(p,h),await Ii({name:c.productName,manufacturer:c.manufacturer,category:c.category});const x=Et(),v={id:Date.now()+Math.random(),inventoryUuid:x,shopId:t,productId:p,batchId:d.id,expirationDate:c.expirationDate,quantity:c.quantity,costPerUnit:c.costPerUnit,location:c.location,supplierId:n||void 0,buyPrice:c.costPerUnit,sellPrice:c.costPerUnit*1.4,images:c.images,scanMetadata:c.scanMetadata||null,createdByUserId:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),qdrantId:x,status:"ACTIVE",shareScope:["local"]};Le.stockItems.set(v.id,v),await Hl(v)}console.info(`[Data Service] Seeded starter data for shop ${t}`)},_i=async(t,e)=>{if(!de)throw new Error("No shop selected. Shop role/ID required.");await Zx();let r=(await Gs()).find(v=>{var w;return v.name.toLowerCase()===((w=t.supplier)==null?void 0:w.toLowerCase())});!r&&t.supplier&&(r=await Ri({name:t.supplier}));const a=r==null?void 0:r.id;(await Va()).forEach(v=>{Le.products.has(v.id)||Le.products.set(v.id,{id:v.id,name:v.name,manufacturer:v.manufacturer,category:v.category})});const c=new Map;for(const v of e){let w=Array.from(Le.products.values()).find(_=>_.name.toLowerCase()===v.productName.toLowerCase());if(w)c.set(v.productName,w.id);else{const _=await Ii({name:v.productName,manufacturer:v.manufacturer,category:v.category});Le.products.set(_.id,{id:_.id,name:_.name,manufacturer:_.manufacturer,category:_.category}),c.set(v.productName,_.id)}}const d=Et(),p={...t,id:d};Le.batches.set(d,p);const h=new Date().toISOString(),x={id:d,shopId:de||"",supplierId:a||null,deliveryDate:t.deliveryDate||h.split("T")[0],inventoryDate:t.inventoryDate||t.deliveryDate||h.split("T")[0],invoiceNumber:void 0,documents:[],lineItems:e.map(v=>({productId:c.get(v.productName)||Gd(v.productName),productName:v.productName,quantity:v.quantity||0,cost:v.buyPrice??v.costPerUnit??0})),createdAt:h,createdByUserId:de||""};await Sf(x);for(const v of e){const w=c.get(v.productName)||Gd(v.productName),_=Et(),E=Vf(v.shareScope),T=$l(E),M={id:Date.now()+Math.random(),inventoryUuid:_,shopId:de||"",productId:w,batchId:d,expirationDate:v.expirationDate,quantity:v.quantity,costPerUnit:v.costPerUnit,location:v.location,supplierId:v.supplierId||a||void 0,buyPrice:v.buyPrice??v.costPerUnit,sellPrice:v.sellPrice??void 0,images:v.images,scanMetadata:v.scanMetadata||null,createdByUserId:de||void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),qdrantId:_,status:"ACTIVE",shareScope:E};T&&(M.shareProofHash=await Fl({inventoryUuid:_,productId:w,batchId:d,quantity:M.quantity})),Le.stockItems.set(M.id,M),await Hl(M,M.scanMetadata||void 0),T&&await tD(M,v,{batchId:d,supplierId:M.supplierId,supplierName:t.supplier})}console.log(`[Data Service] Added batch ${p.id} with ${e.length} item types.`)},Lb=async(t,e)=>{if(!de)throw new Error("No shop selected. Shop role/ID required.");const n=Ub(t);if(!n)throw new Error(`Inventory item ${t} not found`);const r=e.quantity??n.quantity,a={...n,quantity:r,expirationDate:e.expirationDate??n.expirationDate,costPerUnit:e.costPerUnit??n.costPerUnit,buyPrice:e.buyPrice??e.costPerUnit??n.buyPrice??n.costPerUnit,sellPrice:e.sellPrice??n.sellPrice,location:e.location??n.location,updatedAt:new Date().toISOString(),status:r>0?"ACTIVE":"EMPTY"};return Le.stockItems.set(a.id,a),await Hl(a),a},qb=async t=>{if(!de)throw new Error("No shop selected. Shop role/ID required.");const e=Ub(t);if(!e)throw new Error(`Inventory item ${t} not found`);Le.stockItems.delete(e.id),await mv(e)},Gf=async t=>{if(!de)throw new Error("No shop selected.");const e=new Map;for(const n of Le.products.values())e.set(n.name,{id:n.id,name:n.name});await W2(t,e),await Cl(),await sD(t)},Yl=async()=>oI(()=>Promise.resolve(kb()),Gs),Bb=async()=>Array.from(Le.batches.values()),zf=async()=>kb(),Ma=async t=>{if(!de)throw new Error("No shop selected.");const e=new Date().toISOString(),n={id:Et(),shopId:de,supplierId:t.supplierId,deliveryDate:t.deliveryDate,inventoryDate:t.inventoryDate,invoiceNumber:t.invoiceNumber,documents:t.documents||[],lineItems:t.lineItems||[],createdAt:e,createdByUserId:de};return await Sf(n),t.lineItems&&t.lineItems.length>0&&await X2(n,t.lineItems),n},Vb=async(t,e)=>{await eI(t,e,async(n,r)=>{await _i(n,r)},async n=>{await Nf(n)}),await Cl()},iD=Object.freeze(Object.defineProperty({__proto__:null,get activeNamespace(){return Ba},get activeShopId(){return de},get activeShopName(){return Ai},addImageForField:Cf,addInventoryBatch:_i,createBatchForShop:Ma,createCanonicalProduct:Ii,createShopNamespace:cv,deleteCanonicalProduct:iv,fetchBatchRecords:lv,fetchCanonicalProducts:Jl,fetchSuppliersForActiveShop:Gs,getActiveShopId:Hf,getAllBatches:Bb,getAllSales:yv,getAllShops:fv,getAllStockItems:zf,getBatchRecords:ov,getCanonicalProducts:Va,getDanInventoryOffers:jb,getLearnedFieldsForProduct:wv,getMyMarketplaceListings:vv,getProductSummaries:Yl,initializeAndSeedDatabase:Ob,listProductOnMarketplace:xv,persistSale:Nf,purchaseFromMarketplace:Vb,recordSale:Gf,registerLocalSupplier:Ri,removeInventoryItem:qb,searchCanonicalProducts:av,searchCatalogProducts:sf,searchRelevantInventoryItems:Tf,setActiveShopContext:Oa,updateCanonicalProduct:rv,updateInventoryItem:Lb,upsertBatchRecord:Sf,upsertCustomerRecord:dv,upsertDriverRecord:Vl,upsertProductDefinition:_f,upsertShopRecord:uv,upsertSupplierProfile:Ef,upsertUserProfile:wr,validateShopExists:hv},Symbol.toStringTag,{value:"Module"})),aD=async t=>{var e;(e=t.roles)!=null&&e.shop&&await wr({userId:t.clientId,displayName:t.companyName,email:t.email,contactEmail:t.email,shopId:t.shopId||null,isVerified:!1})},oD=async t=>{var e;(e=t.roles)!=null&&e.driver&&(await wr({userId:t.clientId,displayName:t.companyName,email:t.email,contactEmail:t.email,isDriverVerified:!1}),t.driverId&&await Vl({id:t.driverId,fullName:t.companyName,contactEmail:t.email,status:"pending",userId:t.clientId}))},lD=async(t,e)=>{if(!pe||!await We("users"))return{isVerified:!0,isDriverVerified:!0};try{const n=qt("users",t),r=await pe.retrieve("users",{ids:[n],with_payload:!0});if(r.points&&r.points.length>0){const a=r.points[0].payload;return{isVerified:e!=null&&e.requiresShopVerification?a.isVerified??!1:!0,isDriverVerified:e!=null&&e.requiresDriverVerification?a.isDriverVerified??!1:!0}}}catch(n){console.error("[Backend] Error fetching verification status:",n)}return{isVerified:!(e!=null&&e.requiresShopVerification),isDriverVerified:!(e!=null&&e.requiresDriverVerification)}},cD=async()=>{if(!pe||!await We("users"))return[];try{return(await ft("users",null)).map(e=>{const n=e.payload;return n.shopId&&n.isVerified===!1?{clientId:n.userId,companyName:n.displayName,contactPerson:n.displayName,address:"",email:n.email,role:"shop",isVerified:!1,isDriverVerified:n.isDriverVerified??!1,shopId:n.shopId,roles:{shop:!0,customer:!1,driver:!1,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching pending clients:",t),[]}},uD=async()=>{if(!pe||!await We("users"))return[];try{return(await ft("users",null)).map(e=>{const n=e.payload;return n.shopId&&n.isVerified===!0?{clientId:n.userId,companyName:n.displayName,contactPerson:n.displayName,address:"",email:n.email,role:"shop",isVerified:!0,isDriverVerified:n.isDriverVerified??!1,shopId:n.shopId,roles:{shop:!0,customer:!1,driver:!1,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching verified clients:",t),[]}},dD=async()=>{if(!pe||!await We("drivers"))return[];try{return(await ft("drivers",null)).map(e=>{const n=e.payload;return n.status==="pending"&&n.userId?{clientId:n.userId,companyName:n.name||"Driver",contactPerson:n.name||"Driver",address:"",email:n.contact||n.contactEmail||"",role:"driver",isVerified:!0,isDriverVerified:!1,driverId:n.driverId,roles:{shop:!1,customer:!1,driver:!0,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching pending drivers:",t),[]}},fD=async()=>{if(!pe||!await We("drivers"))return[];try{return(await ft("drivers",null)).map(e=>{const n=e.payload;return n.status==="verified"&&n.userId?{clientId:n.userId,companyName:n.name||"Driver",contactPerson:n.name||"Driver",address:"",email:n.contact||n.contactEmail||"",role:"driver",isVerified:!0,isDriverVerified:!0,driverId:n.driverId,roles:{shop:!1,customer:!1,driver:!0,supplier:!1}}:null}).filter(e=>e!==null)}catch(t){return console.error("[Backend] Error fetching verified drivers:",t),[]}},hD=async t=>{if(!pe||!await We("users")){console.warn("[Backend] Qdrant not available for verification");return}try{const e=qt("users",t),n=await pe.retrieve("users",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;await wr({userId:t,displayName:r.displayName,email:r.email,contactEmail:r.contactEmail,shopId:r.shopId,isVerified:!0,isDriverVerified:r.isDriverVerified}),console.log(`[Backend] Verified shop client: ${r.displayName}`)}else console.warn(`[Backend] User not found for verification: ${t}`)}catch(e){console.error("[Backend] Error verifying client:",e)}},pD=async t=>{if(!pe||!await We("users")){console.warn("[Backend] Qdrant not available for driver verification");return}try{const e=qt("users",t),n=await pe.retrieve("users",{ids:[e],with_payload:!0});if(n.points&&n.points.length>0){const r=n.points[0].payload;await wr({userId:t,displayName:r.displayName,email:r.email,contactEmail:r.contactEmail,shopId:r.shopId,isVerified:r.isVerified,isDriverVerified:!0});const o=(await ft("drivers",null)).find(c=>c.payload.userId===t);if(o){const c=o.payload;await Vl({id:c.driverId,fullName:c.name||r.displayName,contactEmail:c.contact||c.contactEmail||r.email,status:"verified",userId:t})}console.log(`[Backend] Verified driver: ${r.displayName}`)}else console.warn(`[Backend] User not found for driver verification: ${t}`)}catch(e){console.error("[Backend] Error verifying driver:",e)}},mD=[{id:"peer_1",name:"Gourmet Goods",listings:[{listingId:"gg_1",productName:"Artisanal Cheese",manufacturer:"Cheese Masters",category:"Dairy",quantity:20,quantityType:"kg",price:25.5,seller:{id:"peer_1",name:"Gourmet Goods"}},{listingId:"gg_2",productName:"Truffle Oil",manufacturer:"Italian Imports",category:"Pantry",quantity:50,quantityType:"bottles",price:15,seller:{id:"peer_1",name:"Gourmet Goods"}}]},{id:"peer_2",name:"The Fresh Market",listings:[{listingId:"tfm_1",productName:"Organic Avocados",manufacturer:"Fresh Farms",category:"Produce",quantity:100,quantityType:"units",price:1.5,seller:{id:"peer_2",name:"The Fresh Market"}}]}],gD=async t=>{if(!t.isVerified)throw new Error("User is not verified.");return Promise.resolve(mD.filter(e=>e.id!==t.clientId))},yD=async(t,e)=>{console.log(`[Backend] Consuming listing ${t}, quantity: ${e}`)},xD={};var rf=null;function vD(t){try{return crypto.getRandomValues(new Uint8Array(t))}catch{}try{return xD.randomBytes(t)}catch{}if(!rf)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return rf(t)}function bD(t){rf=t}function Ff(t,e){if(t=t||$f,typeof t!="number")throw Error("Illegal arguments: "+typeof t+", "+typeof e);t<4?t=4:t>31&&(t=31);var n=[];return n.push("$2b$"),t<10&&n.push("0"),n.push(t.toString()),n.push("$"),n.push(Ul(vD(La),La)),n.join("")}function Hb(t,e,n){if(typeof e=="function"&&(n=e,e=void 0),typeof t=="function"&&(n=t,t=void 0),typeof t>"u")t=$f;else if(typeof t!="number")throw Error("illegal arguments: "+typeof t);function r(a){In(function(){try{a(null,Ff(t))}catch(o){a(o)}})}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);r(n)}else return new Promise(function(a,o){r(function(c,d){if(c){o(c);return}a(d)})})}function Gb(t,e){if(typeof e>"u"&&(e=$f),typeof e=="number"&&(e=Ff(e)),typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return af(t,e)}function zb(t,e,n,r){function a(o){typeof t=="string"&&typeof e=="number"?Hb(e,function(c,d){af(t,d,o,r)}):typeof t=="string"&&typeof e=="string"?af(t,e,o,r):In(o.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)))}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);a(n)}else return new Promise(function(o,c){a(function(d,p){if(d){c(d);return}o(p)})})}function Fb(t,e){for(var n=t.length^e.length,r=0;r<t.length;++r)n|=t.charCodeAt(r)^e.charCodeAt(r);return n===0}function wD(t,e){if(typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return e.length!==60?!1:Fb(Gb(t,e.substring(0,e.length-31)),e)}function _D(t,e,n,r){function a(o){if(typeof t!="string"||typeof e!="string"){In(o.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)));return}if(e.length!==60){In(o.bind(this,null,!1));return}zb(t,e.substring(0,29),function(c,d){c?o(c):o(null,Fb(d,e))},r)}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);a(n)}else return new Promise(function(o,c){a(function(d,p){if(d){c(d);return}o(p)})})}function SD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return parseInt(t.split("$")[2],10)}function ED(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);if(t.length!==60)throw Error("Illegal hash length: "+t.length+" != 60");return t.substring(0,29)}function TD(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return $b(t)>72}var In=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function $b(t){for(var e=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?e+=1:n<2048?e+=2:(n&64512)===55296&&(t.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e}function ND(t){for(var e=0,n,r,a=new Array($b(t)),o=0,c=t.length;o<c;++o)n=t.charCodeAt(o),n<128?a[e++]=n:n<2048?(a[e++]=n>>6|192,a[e++]=n&63|128):(n&64512)===55296&&((r=t.charCodeAt(o+1))&64512)===56320?(n=65536+((n&1023)<<10)+(r&1023),++o,a[e++]=n>>18|240,a[e++]=n>>12&63|128,a[e++]=n>>6&63|128,a[e++]=n&63|128):(a[e++]=n>>12|224,a[e++]=n>>6&63|128,a[e++]=n&63|128);return a}var fi="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),qs=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function Ul(t,e){var n=0,r=[],a,o;if(e<=0||e>t.length)throw Error("Illegal len: "+e);for(;n<e;){if(a=t[n++]&255,r.push(fi[a>>2&63]),a=(a&3)<<4,n>=e){r.push(fi[a&63]);break}if(o=t[n++]&255,a|=o>>4&15,r.push(fi[a&63]),a=(o&15)<<2,n>=e){r.push(fi[a&63]);break}o=t[n++]&255,a|=o>>6&3,r.push(fi[a&63]),r.push(fi[o&63])}return r.join("")}function Jb(t,e){var n=0,r=t.length,a=0,o=[],c,d,p,h,x,v;if(e<=0)throw Error("Illegal len: "+e);for(;n<r-1&&a<e&&(v=t.charCodeAt(n++),c=v<qs.length?qs[v]:-1,v=t.charCodeAt(n++),d=v<qs.length?qs[v]:-1,!(c==-1||d==-1||(x=c<<2>>>0,x|=(d&48)>>4,o.push(String.fromCharCode(x)),++a>=e||n>=r)||(v=t.charCodeAt(n++),p=v<qs.length?qs[v]:-1,p==-1)||(x=(d&15)<<4>>>0,x|=(p&60)>>2,o.push(String.fromCharCode(x)),++a>=e||n>=r)));)v=t.charCodeAt(n++),h=v<qs.length?qs[v]:-1,x=(p&3)<<6>>>0,x|=h,o.push(String.fromCharCode(x)),++a;var w=[];for(n=0;n<a;n++)w.push(o[n].charCodeAt(0));return w}var La=16,$f=10,CD=16,AD=100,ux=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],dx=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],Yb=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function qa(t,e,n,r){var a,o=t[e],c=t[e+1];return o^=n[0],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[1],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[2],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[3],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[4],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[5],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[6],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[7],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[8],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[9],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[10],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[11],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[12],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[13],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[14],a=r[o>>>24],a+=r[256|o>>16&255],a^=r[512|o>>8&255],a+=r[768|o&255],c^=a^n[15],a=r[c>>>24],a+=r[256|c>>16&255],a^=r[512|c>>8&255],a+=r[768|c&255],o^=a^n[16],t[e]=c^n[CD+1],t[e+1]=o,t}function mi(t,e){for(var n=0,r=0;n<4;++n)r=r<<8|t[e]&255,e=(e+1)%t.length;return{key:r,offp:e}}function fx(t,e,n){for(var r=0,a=[0,0],o=e.length,c=n.length,d,p=0;p<o;p++)d=mi(t,r),r=d.offp,e[p]=e[p]^d.key;for(p=0;p<o;p+=2)a=qa(a,0,e,n),e[p]=a[0],e[p+1]=a[1];for(p=0;p<c;p+=2)a=qa(a,0,e,n),n[p]=a[0],n[p+1]=a[1]}function ID(t,e,n,r){for(var a=0,o=[0,0],c=n.length,d=r.length,p,h=0;h<c;h++)p=mi(e,a),a=p.offp,n[h]=n[h]^p.key;for(a=0,h=0;h<c;h+=2)p=mi(t,a),a=p.offp,o[0]^=p.key,p=mi(t,a),a=p.offp,o[1]^=p.key,o=qa(o,0,n,r),n[h]=o[0],n[h+1]=o[1];for(h=0;h<d;h+=2)p=mi(t,a),a=p.offp,o[0]^=p.key,p=mi(t,a),a=p.offp,o[1]^=p.key,o=qa(o,0,n,r),r[h]=o[0],r[h+1]=o[1]}function hx(t,e,n,r,a){var o=Yb.slice(),c=o.length,d;if(n<4||n>31)if(d=Error("Illegal number of rounds (4-31): "+n),r){In(r.bind(this,d));return}else throw d;if(e.length!==La)if(d=Error("Illegal salt length: "+e.length+" != "+La),r){In(r.bind(this,d));return}else throw d;n=1<<n>>>0;var p,h,x=0,v;typeof Int32Array=="function"?(p=new Int32Array(ux),h=new Int32Array(dx)):(p=ux.slice(),h=dx.slice()),ID(e,t,p,h);function w(){if(a&&a(x/n),x<n)for(var E=Date.now();x<n&&(x=x+1,fx(t,p,h),fx(e,p,h),!(Date.now()-E>AD)););else{for(x=0;x<64;x++)for(v=0;v<c>>1;v++)qa(o,v<<1,p,h);var T=[];for(x=0;x<c;x++)T.push((o[x]>>24&255)>>>0),T.push((o[x]>>16&255)>>>0),T.push((o[x]>>8&255)>>>0),T.push((o[x]&255)>>>0);if(r){r(null,T);return}else return T}r&&In(w)}if(typeof r<"u")w();else for(var _;;)if(typeof(_=w())<"u")return _||[]}function af(t,e,n,r){var a;if(typeof t!="string"||typeof e!="string")if(a=Error("Invalid string / salt: Not a string"),n){In(n.bind(this,a));return}else throw a;var o,c;if(e.charAt(0)!=="$"||e.charAt(1)!=="2")if(a=Error("Invalid salt version: "+e.substring(0,2)),n){In(n.bind(this,a));return}else throw a;if(e.charAt(2)==="$")o="\0",c=3;else{if(o=e.charAt(2),o!=="a"&&o!=="b"&&o!=="y"||e.charAt(3)!=="$")if(a=Error("Invalid salt revision: "+e.substring(2,4)),n){In(n.bind(this,a));return}else throw a;c=4}if(e.charAt(c+2)>"$")if(a=Error("Missing salt rounds"),n){In(n.bind(this,a));return}else throw a;var d=parseInt(e.substring(c,c+1),10)*10,p=parseInt(e.substring(c+1,c+2),10),h=d+p,x=e.substring(c+3,c+25);t+=o>="a"?"\0":"";var v=ND(t),w=Jb(x,La);function _(E){var T=[];return T.push("$2"),o>="a"&&T.push(o),T.push("$"),h<10&&T.push("0"),T.push(h.toString()),T.push("$"),T.push(Ul(w,w.length)),T.push(Ul(E,Yb.length*4-1)),T.join("")}if(typeof n>"u")return _(hx(v,w,h));hx(v,w,h,function(E,T){E?n(E,null):n(null,_(T))},r)}function RD(t,e){return Ul(t,e)}function DD(t,e){return Jb(t,e)}const Kb={setRandomFallback:bD,genSaltSync:Ff,genSalt:Hb,hashSync:Gb,hash:zb,compareSync:wD,compare:_D,getRounds:SD,getSalt:ED,truncates:TD,encodeBase64:RD,decodeBase64:DD},Jf=()=>{if(!ls)throw new Error("Supabase is not configured.");return ls},Qb=t=>t.shop?"shop":t.customer?"customer":t.driver?"driver":"supplier",Xb=async t=>{const e={shop:t.is_shop,customer:t.is_customer,driver:t.is_driver,supplier:t.is_supplier},n=await lD(t.id,{requiresShopVerification:t.is_shop,requiresDriverVerification:t.is_driver}),r={clientId:t.id,companyName:t.display_name,contactPerson:t.display_name,address:"",email:t.email,role:Qb(e),isVerified:n.isVerified,isDriverVerified:n.isDriverVerified,shopId:t.shop_qdrant_id||void 0,customerId:t.customer_qdrant_id||void 0,driverId:t.driver_qdrant_id||void 0,supplierId:t.supplier_qdrant_id||void 0,roles:e};let a=null;return t.is_shop&&t.shop_qdrant_id&&(a={id:t.shop_qdrant_id,name:t.display_name,contactEmail:t.contact_email,qdrantNamespace:t.qdrant_namespace||void 0}),Oa(a),wr({userId:t.id,qdrantUserId:t.qdrant_user_id||t.id,displayName:t.display_name,email:t.contact_email||t.email,contactEmail:t.contact_email||t.email,shopId:t.shop_qdrant_id||null}).catch(o=>console.error("[Auth] Failed to sync user to Qdrant:",o)),{user:r,shopContext:a}},MD=async t=>{const e=Jf(),{error:n}=await e.from("users").insert([t]);if(n)throw n},kD=async t=>{Jf();const e=t.roles;if(!e.shop&&!e.customer&&!e.driver&&!e.supplier)throw new Error("Please select at least one role.");const n=await Kb.hash(t.password,10),r=Et(),a=e.shop?Et():null,o=e.customer?Et():null,c=e.driver?Et():null,d=e.supplier?Et():null;await MD({id:r,username:t.username.trim(),email:t.email.trim(),contact_email:t.email.trim(),display_name:t.displayName.trim(),password_hash:n,is_shop:e.shop,is_customer:e.customer,is_driver:e.driver,is_supplier:e.supplier,qdrant_user_id:r,shop_qdrant_id:a,qdrant_namespace:a?`shop-${a}`:null,customer_qdrant_id:o,driver_qdrant_id:c,supplier_qdrant_id:d,metadata:e.driver&&t.licenseId?{licenseId:t.licenseId}:{}}),await wr({userId:r,qdrantUserId:r,displayName:t.displayName.trim(),email:t.email.trim(),contactEmail:t.email.trim(),shopId:a}),e.shop&&a&&(await cv(),await uv({id:a,name:t.displayName.trim(),contactEmail:t.email.trim(),userId:r,qdrantNamespace:`shop-${a}`})),e.customer&&o&&await dv({id:o,fullName:t.displayName.trim(),contactEmail:t.email.trim()}),e.driver&&c&&await Vl({id:c,fullName:t.displayName.trim(),contactEmail:t.email.trim(),status:"pending"}),e.supplier&&d&&await Ef({id:d,name:t.displayName.trim(),contactEmail:t.email.trim(),shopId:t.supplierShopId||null,linkedUserId:t.supplierShopId?null:r});const p={id:r,username:t.username.trim(),email:t.email.trim(),display_name:t.displayName.trim(),contact_email:t.email.trim(),is_shop:e.shop,is_customer:e.customer,is_driver:e.driver,is_supplier:e.supplier,qdrant_user_id:r,shop_qdrant_id:a,qdrant_namespace:a?`shop-${a}`:null,customer_qdrant_id:o,driver_qdrant_id:c,supplier_qdrant_id:d,metadata:{...e.driver&&t.licenseId?{licenseId:t.licenseId}:{},...e.supplier&&t.supplierShopId?{linkedShop:t.supplierShopId}:{}}},h={clientId:r,companyName:t.displayName.trim(),contactPerson:t.displayName.trim(),email:t.email.trim(),role:Qb(e),isVerified:!e.shop,isDriverVerified:!e.driver,shopId:a||void 0,driverId:c||void 0,roles:e};return e.shop&&await aD(h),e.driver&&await oD(h),await Xb(p)},PD=async t=>{const e=Jf(),{data:n,error:r}=await e.from("users").select("*").eq("username",t.username.trim()).single();if(r||!n)throw new Error("Invalid username or password.");if(!await Kb.compare(t.password,n.password_hash??""))throw new Error("Invalid username or password.");return await Xb(n)},UD=({onSuccess:t})=>{const[e,n]=A.useState(""),[r,a]=A.useState(""),[o,c]=A.useState(null),[d,p]=A.useState(!1),h=async x=>{x.preventDefault(),p(!0),c(null);try{const v=await PD({username:e.trim(),password:r});t(v)}catch(v){c(v instanceof Error?v.message:"Login failed")}finally{p(!1)}};return f.jsxs("form",{onSubmit:h,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),f.jsx("input",{type:"text",value:e,onChange:x=>n(x.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",autoComplete:"username",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),f.jsx("input",{type:"password",value:r,onChange:x=>a(x.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",autoComplete:"current-password",required:!0})]}),o&&f.jsx("div",{className:"text-sm text-red-400 bg-red-900/30 border border-red-700 rounded-md px-3 py-2",children:o}),f.jsx("button",{type:"submit",disabled:d,className:"w-full py-2.5 rounded-md bg-cyan-600 hover:bg-cyan-700 text-white font-semibold transition disabled:opacity-60",children:d?"Signing in...":"Sign In"})]})},jD=({onSuccess:t})=>{const[e,n]=A.useState(""),[r,a]=A.useState(""),[o,c]=A.useState(""),[d,p]=A.useState(""),[h,x]=A.useState(""),[v,w]=A.useState({shop:!1,customer:!1,driver:!1,supplier:!1}),[_,E]=A.useState(""),[T,M]=A.useState(null),[P,k]=A.useState(!1),C=j=>{w(B=>({...B,[j]:!B[j]}))},I=async j=>{j.preventDefault(),k(!0),M(null);try{if(!(v.shop||v.customer||v.driver||v.supplier))throw new Error("Please select at least one role.");if(v.shop&&!e.trim())throw new Error("Shop owners must provide a shop name.");if(!v.shop&&!e.trim())throw new Error("Please provide your display name.");const H=await kD({username:r.trim(),email:o.trim(),password:d,displayName:e.trim(),roles:v,licenseId:v.driver?h.trim():void 0,supplierShopId:v.supplier&&_.trim()||void 0});t(H)}catch(B){M(B instanceof Error?B.message:"Registration failed")}finally{k(!1)}};return f.jsxs("form",{onSubmit:I,className:"space-y-4",children:[f.jsx("div",{className:"flex space-x-2",children:["shop","customer","driver","supplier"].map(j=>f.jsx("button",{type:"button",onClick:()=>C(j),className:`flex-1 py-2 rounded-md text-sm font-semibold capitalize ${v[j]?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:j},j))}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:v.shop?"Shop Name":"Display Name"}),f.jsx("input",{type:"text",value:e,onChange:j=>n(j.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),f.jsx("input",{type:"email",value:o,onChange:j=>c(j.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),f.jsx("input",{type:"text",value:r,onChange:j=>a(j.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),f.jsx("input",{type:"password",value:d,onChange:j=>p(j.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),v.driver&&f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"License ID (optional)"}),f.jsx("input",{type:"text",value:h,onChange:j=>x(j.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),v.supplier&&f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Associated Shop ID (optional)"}),f.jsx("input",{type:"text",value:_,onChange:j=>E(j.target.value),className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Link yourself to a shop UUID if applicable"})]}),T&&f.jsx("div",{className:"text-sm text-red-400 bg-red-900/30 border border-red-700 rounded-md px-3 py-2",children:T}),f.jsx("button",{type:"submit",disabled:P,className:"w-full py-2.5 rounded-md bg-cyan-600 hover:bg-cyan-700 text-white font-semibold transition disabled:opacity-60",children:P?"Creating...":"Create Account"})]})},Wb=({onAuthenticated:t})=>{const[e,n]=A.useState("login");return f.jsx("div",{className:"min-h-screen bg-gray-900 flex flex-col items-center justify-center p-6",children:f.jsxs("div",{className:"w-full max-w-lg bg-gray-800 border border-gray-700 rounded-xl p-6 shadow-2xl",children:[f.jsxs("div",{className:"flex space-x-2 mb-6",children:[f.jsx("button",{onClick:()=>n("login"),className:`flex-1 py-2 rounded-md font-semibold ${e==="login"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Login"}),f.jsx("button",{onClick:()=>n("register"),className:`flex-1 py-2 rounded-md font-semibold ${e==="register"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Create Account"})]}),e==="login"?f.jsx(UD,{onSuccess:t}):f.jsx(jD,{onSuccess:r=>{t(r),n("login")}})]})})},Yf=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M12 2L9 9l-7 3 7 3 3 7 3-7 7-3-7-3-3-7z"}),f.jsx("path",{d:"M22 12l-3-1-1-3-1 3-3 1 3 1 1 3 1-3 3-1z"}),f.jsx("path",{d:"M5 3l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z"})]}),OD=({activeTab:t,onTabChange:e,user:n,onLogout:r,isBackendAvailable:a})=>{var _,E,T,M;const[o,c]=A.useState(!1),d=!!((_=n.roles)!=null&&_.shop||n.shopId),p=!!((E=n.roles)!=null&&E.customer||n.customerId),h=!!((T=n.roles)!=null&&T.driver||n.driverId),x=!!((M=n.roles)!=null&&M.supplier||n.supplierId),v=(P,k=!1)=>{let C="px-3 py-2 rounded-md text-sm font-medium transition-colors";return k?`${C} text-gray-500 cursor-not-allowed`:(C+=" cursor-pointer",t===P?`${C} bg-cyan-600 text-white`:`${C} text-gray-300 hover:bg-gray-700 hover:text-white`)},w=!n.isVerified;return f.jsx("header",{className:"bg-gray-800/50 backdrop-blur-sm sticky top-0 z-10",children:f.jsx("div",{className:"container mx-auto px-4 md:px-8",children:f.jsxs("div",{className:"flex items-center justify-between h-20 border-b border-gray-700",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(Yf,{className:"w-8 h-8 text-cyan-400"}),f.jsx("h1",{className:"text-2xl font-bold tracking-tight text-white",children:"Autonomous Shop AI"})]}),f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("nav",{className:"hidden md:flex items-center space-x-2 p-1 bg-gray-900/50 rounded-lg border border-gray-700",children:[f.jsx("a",{onClick:()=>e("dashboard"),className:v("dashboard"),children:"Dashboard"}),d&&f.jsxs(f.Fragment,{children:[f.jsx("a",{onClick:()=>e("inventory"),className:v("inventory"),children:"Inventory"}),f.jsx("a",{onClick:()=>e("catalog"),className:v("catalog"),children:"Products"}),f.jsx("a",{onClick:()=>e("batches"),className:v("batches"),children:"Batches"}),f.jsx("a",{onClick:()=>!w&&e("marketplace"),className:v("marketplace",w),title:w?"Verification Pending":"Marketplace",children:"Marketplace"}),f.jsx("a",{onClick:()=>e("kiosk"),className:v("kiosk"),children:"Kiosk"})]}),p&&f.jsx("a",{onClick:()=>e("customer"),className:v("customer"),children:"Customer"}),x&&f.jsx("a",{onClick:()=>e("supplier"),className:v("supplier"),children:"Supplier"}),a&&f.jsx("a",{onClick:()=>e("backend"),className:v("backend"),children:"Backend"})]}),f.jsxs("div",{className:"relative",children:[f.jsxs("button",{onClick:()=>c(!o),className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-700",children:[f.jsx("div",{className:"w-8 h-8 bg-cyan-800 rounded-full flex items-center justify-center text-cyan-300 font-bold",children:n.companyName.charAt(0)}),f.jsx("span",{className:"hidden lg:inline text-sm font-medium text-white",children:n.companyName})]}),o&&f.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-gray-800 border border-gray-700 rounded-md shadow-lg z-20",children:[f.jsxs("div",{className:"px-4 py-3 border-b border-gray-700",children:[f.jsx("p",{className:"text-sm font-semibold text-white truncate",children:n.companyName}),f.jsx("p",{className:"text-xs text-gray-400 capitalize",children:n.role})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Shop: ",d?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.shopId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.shopId.slice(0,8),"...)"]})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Customer: ",p?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.customerId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.customerId.slice(0,8),"...)"]})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400",children:["Driver: ",h?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.driverId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.driverId.slice(0,8),"...)"]})]}),f.jsxs("div",{className:"px-4 py-2 text-xs text-gray-400 border-b border-gray-700",children:["Supplier: ",x?f.jsx("span",{className:"text-green-400",children:"Enabled"}):f.jsx("span",{className:"text-gray-500",children:"Off"}),n.supplierId&&f.jsxs("span",{className:"text-gray-500 ml-2",children:["(ID: ",n.supplierId.slice(0,8),"...)"]})]}),f.jsx("a",{onClick:r,className:"block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Logout"})]})]})]}),f.jsx("button",{className:"md:hidden text-gray-300",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]})})})},LD="modulepreload",qD=function(t){return"/"+t},px={},BD=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(x=>Promise.resolve(x).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),p=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));a=c(n.map(h=>{if(h=qD(h),h in px)return;px[h]=!0;const x=h.endsWith(".css"),v=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${v}`))return;const w=document.createElement("link");if(w.rel=x?"stylesheet":LD,x||(w.as="script"),w.crossOrigin="",w.href=h,p&&w.setAttribute("nonce",p),document.head.appendChild(w),x)return new Promise((_,E)=>{w.addEventListener("load",_),w.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return a.then(c=>{for(const d of c||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},VD=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),f.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),Zb=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),f.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),f.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),of=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),f.jsx("polyline",{points:"12 6 12 12 16 14"})]}),HD=({toast:t,onRemove:e})=>{const[n,r]=A.useState(!1);A.useEffect(()=>{setTimeout(()=>r(!0),10);const c=t.duration??5e3,d=setTimeout(()=>{r(!1),setTimeout(()=>e(t.id),300)},c);return()=>clearTimeout(d)},[t.id,t.duration,e]);const a=()=>{switch(t.type){case"success":return"bg-green-900/90 border-green-700 text-green-100";case"error":return"bg-red-900/90 border-red-700 text-red-100";case"warning":return"bg-yellow-900/90 border-yellow-700 text-yellow-100";case"info":return"bg-cyan-900/90 border-cyan-700 text-cyan-100";default:return"bg-gray-900/90 border-gray-700 text-gray-100"}},o=()=>{switch(t.type){case"success":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})});case"error":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})});case"warning":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});case"info":return f.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}};return f.jsxs("div",{className:`
        ${a()}
        border rounded-lg shadow-lg p-4 flex items-start space-x-3
        transition-all duration-300 ease-in-out
        ${n?"opacity-100 translate-x-0":"opacity-0 translate-x-full"}
      `,children:[f.jsx("div",{className:"flex-shrink-0 mt-0.5",children:o()}),f.jsx("div",{className:"flex-1 min-w-0",children:f.jsx("p",{className:"text-sm font-medium",children:t.message})}),f.jsx("button",{onClick:()=>{r(!1),setTimeout(()=>e(t.id),300)},className:"flex-shrink-0 text-current opacity-70 hover:opacity-100 transition-opacity","aria-label":"Close",children:f.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})},GD=({toasts:t,onRemove:e})=>f.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-md",children:t.map(n=>f.jsx(HD,{toast:n,onRemove:e},n.id))});let zD=0;const gl=new Set,dr=[],ds=()=>{const[t,e]=A.useState(dr);return A.useEffect(()=>{const a=o=>e([...o]);return gl.add(a),a(dr),()=>{gl.delete(a)}},[]),{toasts:t,showToast:(a,o="info",c)=>{const p={id:`toast-${zD++}`,message:a,type:o,duration:c};dr.push(p),gl.forEach(h=>h([...dr]))},removeToast:a=>{const o=dr.findIndex(c=>c.id===a);o!==-1&&(dr.splice(o,1),gl.forEach(c=>c([...dr])))}}},kn="AIzaSyBHhPZpibYHsSLYsCGHiavENU_zu2ccR3c",bn={productId:{displayName:"Product ID",description:"Canonical product identifier",type:"string"},productName:{displayName:"Product Name",description:"Name of the product",type:"string"},manufacturer:{displayName:"Manufacturer",description:"Manufacturer of the product",type:"string"},category:{displayName:"Category",description:"Product category (e.g., Beverages, Snacks, Produce)",type:"string"},productDescription:{displayName:"Product Description",description:"Detailed description of the product",type:"string"},expirationDate:{displayName:"Exp. Date",description:"Expiration date in YYYY-MM-DD format",type:"string"},quantity:{displayName:"Quantity",description:"Quantity of the product",type:"number"},quantityType:{displayName:"Quantity Type",description:"Unit of measurement (e.g., units, kg, lbs, liters)",type:"string"},costPerUnit:{displayName:"Cost/Unit",description:"Cost per single unit of the product",type:"number"},supplier:{displayName:"Supplier",description:"Supplier or distributor name",type:"string"},deliveryDate:{displayName:"Delivery Date",description:"Delivery date in YYYY-MM-DD format",type:"string"},inventoryDate:{displayName:"Inventory Date",description:"Today's date in YYYY-MM-DD format",type:"string"}},FD={type:Ce.OBJECT,properties:{productName:{type:Ce.STRING,description:"Name of the product"},manufacturer:{type:Ce.STRING,description:"Manufacturer of the product"},category:{type:Ce.STRING,description:"A suitable category for the product (e.g., Beverages, Snacks, Dairy, Produce)"},expirationDate:{type:Ce.STRING,description:"Expiration date in YYYY-MM-DD format"},quantity:{type:Ce.NUMBER,description:"Quantity of the product"},quantityType:{type:Ce.STRING,description:"Unit of measurement (e.g., units, kg, lbs, liters)"},costPerUnit:{type:Ce.NUMBER,description:"Cost per single unit of the product"},supplier:{type:Ce.STRING,description:"Supplier or distributor name, if visible"},deliveryDate:{type:Ce.STRING,description:"Delivery date in YYYY-MM-DD format, if visible"}},required:["productName","manufacturer","category","expirationDate","quantity","quantityType","costPerUnit"]},$D={type:Ce.OBJECT,properties:{supplierName:{type:Ce.STRING,description:"The name of the supplier or vendor."},invoiceNumber:{type:Ce.STRING,description:"The invoice or reference number for the delivery."},deliveryDate:{type:Ce.STRING,description:"The delivery date in YYYY-MM-DD format."},items:{type:Ce.ARRAY,description:"A complete list of all line items from the document.",items:{type:Ce.OBJECT,properties:{productName:{type:Ce.STRING,description:"The full name of the product as written on the document."},quantity:{type:Ce.NUMBER,description:"The quantity of the product delivered."},costPerUnit:{type:Ce.NUMBER,description:"The cost for a single unit of the product."}},required:["productName","quantity","costPerUnit"]}}}},Rn=t=>new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>{const o=r.result.split(",")[1];e({inlineData:{data:o,mimeType:t.type}})},r.onerror=a=>n(a)}),JD=async t=>{if(t.length===0)throw new Error("No documents provided for analysis.");try{const e=new an({apiKey:kn}),n=await Promise.all(t.map(d=>Rn(d))),o=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[...n,{text:"Analyze these images of shipping documents (e.g., invoice, packing slip). Extract the supplier name, invoice number, delivery date, and a complete list of all line items. For each line item, provide the product name, quantity, and cost per unit. If a value isn't clearly present, omit it. Consolidate information if multiple documents are provided."}]},config:{responseMimeType:"application/json",responseSchema:$D}})).text.trim(),c=JSON.parse(o);if(typeof c!="object"||c===null)throw new Error("Invalid JSON structure received from API");return{supplierName:c.supplierName,invoiceNumber:c.invoiceNumber,deliveryDate:c.deliveryDate,items:c.items||[]}}catch(e){throw console.error("Error analyzing batch documents with Gemini:",e),new Error("Failed to extract batch data from the documents.")}},Kf=async t=>{try{const e=new an({apiKey:kn}),n=await Rn(t),a=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[n,{text:"Analyze this image of a product or delivery note. Extract inventory details. If a value isn't present, make a reasonable guess or use 'N/A' for strings and 0 for numbers. For dates, use YYYY-MM-DD format."}]},config:{responseMimeType:"application/json",responseSchema:FD}})).text.trim(),o=JSON.parse(a);if(typeof o!="object"||o===null)throw new Error("Invalid JSON structure received from API");return{productName:o.productName||"N/A",manufacturer:o.manufacturer||"N/A",category:o.category||"General",expirationDate:o.expirationDate||"N/A",quantity:Number(o.quantity)||0,quantityType:o.quantityType||"units",costPerUnit:Number(o.costPerUnit)||0,supplier:o.supplier,deliveryDate:o.deliveryDate}}catch(e){throw console.error("Error analyzing image with Gemini:",e),new Error("Failed to extract inventory data from the image.")}},ew=async(t,e)=>{try{const n=new an({apiKey:kn}),r=await Rn(t),a=bn[e],o=`This image contains the ${a.displayName}. Extract ONLY the value for this field. Do not add any extra text, labels, or explanations. Return just the raw value. For dates, use YYYY-MM-DD format.`,d=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:o}]}})).text.trim();if(a.type==="number"){const p=parseFloat(d.replace(/[^0-9.-]+/g,""));return isNaN(p)?0:p}return d}catch(n){throw console.error(`Error analyzing cropped image for field ${e}:`,n),new Error(`Failed to extract data for ${e}.`)}},YD=async(t,e,n)=>{if(t.length===0&&!de)return"The inventory is currently empty. Please add items to generate a report.";const r=new an({apiKey:kn});try{let a="",o=[];if(de&&n.trim().length>0){const p=await Mn(n);if(o=await Tf(p,de,20),o.length>0){const h=o.map(x=>{const v=e.find(_=>_.id===x.batchId),w=t.find(_=>_.productId===x.productId&&String(_.batchId)===String(x.batchId));return{inventoryUuid:x.inventoryUuid,productName:(w==null?void 0:w.productName)||"N/A",manufacturer:(w==null?void 0:w.manufacturer)||"N/A",category:(w==null?void 0:w.category)||"General",expirationDate:x.expirationDate,quantity:x.quantity,quantityType:(w==null?void 0:w.quantityType)||"units",costPerUnit:x.costPerUnit,supplier:v==null?void 0:v.supplier,deliveryDate:v==null?void 0:v.deliveryDate,inventoryDate:v==null?void 0:v.inventoryDate,location:x.location,buyPrice:x.buyPrice,sellPrice:x.sellPrice}});a=JSON.stringify(h,null,2),console.log("RAG applied: sending relevant inventory data to Gemini.")}else a=JSON.stringify(t.map(h=>{const x=e.find(v=>v.id===h.batchId);return{...h,supplier:x==null?void 0:x.supplier,deliveryDate:x==null?void 0:x.deliveryDate,inventoryDate:x==null?void 0:x.inventoryDate}}),null,2),console.warn("No relevant items found via RAG for the given prompt, falling back to full inventory context.")}else a=JSON.stringify(t.map(p=>{const h=e.find(x=>x.id===p.batchId);return{...p,supplier:h==null?void 0:h.supplier,deliveryDate:h==null?void 0:h.deliveryDate,inventoryDate:h==null?void 0:h.inventoryDate}}),null,2),console.log("RAG skipped: using full inventory context for analysis.");const c=`
      Based on the following inventory data, please provide an analysis for the request: "${n}".
      
      Inventory Data:
      ${a}
      
      Please format your response in clear, easy-to-read markdown.
    `;return(await r.models.generateContent({model:"gemini-2.5-pro",contents:c,config:{thinkingConfig:{thinkingBudget:32768}}})).text}catch(a){throw console.error("Error generating inventory report with Gemini Pro:",a),new Error("Failed to generate the inventory report.")}},Qf=async(t,e)=>{if(e.length===0)return null;try{const n=new an({apiKey:kn}),r=await Rn(t),a=`
      Analyze this image. Identify the main product visible.
      From the following list of known products, which one is it?
      Product list: [${e.join(", ")}]
      Respond with ONLY the name of the product from the list that matches best.
      If no product from the list is clearly identifiable, respond with the exact text "NO_PRODUCT".
    `,c=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:a}]}})).text.trim();return c==="NO_PRODUCT"||!e.includes(c)?null:c}catch(n){return console.error("Error identifying product:",n),null}},KD=t=>{const e=t.split(","),n=e[0].match(/:(.*?);/);if(!n)throw new Error("Invalid data URL");const r=n[1],a=atob(e[1]);let o=a.length;const c=new Uint8Array(o);for(;o--;)c[o]=a.charCodeAt(o);return new Blob([c],{type:r})},QD=async(t,e,n)=>{try{const r=new an({apiKey:kn}),a=await Rn(t),o=await Rn(e),c=bn[n],d=`The first image is a close-up of a '${c.displayName}'. The second image is a wider view of a product. Find the exact feature from the first image within the second image and extract ONLY its value. Do not add any extra text, labels, or explanations. Return just the raw value. If you cannot find the feature, return the text "NOT_FOUND". For dates, use YYYY-MM-DD format.`,h=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[o,a,{text:d}]}})).text.trim();if(h==="NOT_FOUND")return null;if(c.type==="number"){const x=parseFloat(h.replace(/[^0-9.-]+/g,""));return isNaN(x)?null:x}return h}catch(r){return console.error(`Error finding feature for field ${n}:`,r),null}},XD={type:Ce.OBJECT,properties:{estimatedQuantity:{type:Ce.NUMBER,description:"Estimated total quantity including hidden units"},confidence:{type:Ce.NUMBER,description:"Confidence score from 0 to 1"},reasoning:{type:Ce.STRING,description:"Explanation of the estimation"},visualAnalysis:{type:Ce.STRING,description:"Detailed visual observations"},shelfFullness:{type:Ce.NUMBER,description:"Shelf fullness percentage (0-100)"},visibleUnits:{type:Ce.NUMBER,description:"Number of units clearly visible"},hiddenUnits:{type:Ce.NUMBER,description:"Estimated units hidden behind others"}},required:["estimatedQuantity","confidence","reasoning","visualAnalysis","shelfFullness","visibleUnits"]},WD=async(t,e,n)=>{try{const r=new an({apiKey:kn}),a=await Rn(t),o=n?`Expected shelf capacity: ${n} units.`:"No expected capacity provided.",c=`Analyze this shelf photo for ${e}.
        
        Tasks:
        1. Count visible units of the product
        2. Estimate if there are units hidden behind others
        3. Assess shelf fullness (0-100%)
        4. Identify any damage or quality issues
        5. Check expiration dates if visible
        
        ${o}
        
        Provide detailed analysis with confidence score.`,d=await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[a,{text:c}]},config:{responseMimeType:"application/json",responseSchema:XD}}),p=JSON.parse(d.text.trim());return{estimatedQuantity:p.estimatedQuantity||0,confidence:Math.max(0,Math.min(1,p.confidence||.5)),reasoning:p.reasoning||"",visualAnalysis:p.visualAnalysis||"",shelfFullness:Math.max(0,Math.min(100,p.shelfFullness||0)),visibleUnits:p.visibleUnits||0,hiddenUnits:p.hiddenUnits}}catch(r){throw console.error("Error estimating stock from shelf photo:",r),new Error("Failed to estimate stock from shelf photo.")}},ZD={type:Ce.OBJECT,properties:{qualityScore:{type:Ce.NUMBER,description:"Overall quality score from 0 to 100"},issues:{type:Ce.ARRAY,items:{type:Ce.STRING},description:"List of quality issues found"},recommendations:{type:Ce.ARRAY,items:{type:Ce.STRING},description:"Recommendations for action"},expirationVisible:{type:Ce.BOOLEAN,description:"Whether expiration date is visible"},expirationDate:{type:Ce.STRING,description:"Detected expiration date in YYYY-MM-DD format if visible"},damageDetected:{type:Ce.BOOLEAN,description:"Whether any damage was detected"},damageDescription:{type:Ce.STRING,description:"Description of damage if found"},packagingIntegrity:{type:Ce.STRING,description:"Packaging condition: good, fair, or poor"}},required:["qualityScore","issues","recommendations","expirationVisible","damageDetected","packagingIntegrity"]},e3=async(t,e,n)=>{try{const r=new an({apiKey:kn}),a=await Rn(t),o=n?`Expected expiration: ${n}. Compare detected date with expected.`:"",c=`Analyze this image of ${e} for quality assessment.
        
        Check for:
        - Physical damage (dents, tears, broken seals)
        - Expiration date visibility and validity
        - Packaging integrity
        - Signs of spoilage (for perishables)
        - Overall condition
        
        ${o}
        
        Provide detailed quality assessment with actionable recommendations.`,d=await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[a,{text:c}]},config:{responseMimeType:"application/json",responseSchema:ZD}}),p=JSON.parse(d.text.trim());return{qualityScore:Math.max(0,Math.min(100,p.qualityScore||50)),issues:p.issues||[],recommendations:p.recommendations||[],expirationVisible:p.expirationVisible||!1,expirationDate:p.expirationDate,damageDetected:p.damageDetected||!1,damageDescription:p.damageDescription,packagingIntegrity:p.packagingIntegrity||"fair"}}catch(r){throw console.error("Error assessing product quality:",r),new Error("Failed to assess product quality.")}},tw=async(t,e)=>{try{const n=new an({apiKey:kn}),r=await Rn(t),c=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[r,{text:`Describe this product in detail. Include:
        - Product name/brand
        - Category
        - Key visual features
        - Packaging type
        - Any text visible on packaging
        
        Return a concise product description suitable for search.`}]}})).text.trim(),d=await R2(c,t,.5,.5);return await Tf(d,e,10)}catch(n){return console.error("Error searching inventory by image:",n),[]}},t3=async t=>{try{const e=new an({apiKey:kn});return await Promise.all(t.map(async({image:r,expectedExpiration:a,productName:o})=>{try{const c=await Rn(r),d=`Find and read the expiration date on this ${o}.
                    
                    Expected expiration: ${a}
                    
                    Return ONLY the expiration date in YYYY-MM-DD format if visible, or "NOT_VISIBLE" if not found.
                    Also indicate your confidence (0-1) in the detection.`,h=(await e.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[c,{text:d}]}})).text.trim();if(h.includes("NOT_VISIBLE")||h.includes("not visible"))return{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Expiration date not visible in image"};const v=h.match(/\d{4}-\d{2}-\d{2}/),w=v?v[0]:null;if(!w)return{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Could not parse date from image"};const _=w===a||w.split("-")[0]===a.split("-")[0];return{productName:o,expectedExpiration:a,detectedExpiration:w,match:_,discrepancy:_?void 0:`Expected ${a}, found ${w}`,confidence:_?.9:.7}}catch(c){return console.error(`Error verifying expiration for ${o}:`,c),{productName:o,expectedExpiration:a,match:!1,confidence:0,discrepancy:"Error processing image"}}}))}catch(e){throw console.error("Error verifying expiration dates:",e),new Error("Failed to verify expiration dates.")}},n3=async(t,e,n)=>{try{if(t.length===0)throw new Error("No shelf images provided.");const r=new an({apiKey:kn}),a=await Promise.all(t.map(Rn)),c=`Analyze these shelf photos combined with inventory data.
        
        Inventory Data:
        ${JSON.stringify({inventory:e.slice(0,50).map(x=>({productId:x.productId,quantity:x.quantity,expirationDate:x.expirationDate})),recentSales:n.slice(-20).map(x=>({timestamp:x.timestamp,items:x.items,totalAmount:x.totalAmount}))},null,2)}
        
        Tasks:
        1. Compare visual stock levels with recorded inventory
        2. Identify discrepancies (visual vs recorded)
        3. Find products that look expired/damaged
        4. Suggest reordering based on visual stock levels
        5. Identify layout optimization opportunities
        6. Flag high-risk items (expiring soon, low stock, damaged)
        
        Provide actionable insights combining visual and data analysis.
        Format as structured recommendations with severity levels.`;return{insights:(await r.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[...a,{text:c}]},config:{thinkingConfig:{thinkingBudget:32768}}})).text.split(`
`).filter(x=>x.trim().length>0&&(x.includes("insight")||x.includes("finding")||x.match(/^\d+\./))).slice(0,10),visualFindings:[],recommendations:[],riskItems:[],dataDiscrepancies:[]}}catch(r){throw console.error("Error generating visual insights:",r),new Error("Failed to generate visual inventory insights.")}},nw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v1a2.5 2.5 0 0 1-2.5 2.5h-1A2.5 2.5 0 0 1 6 5.5v-1A2.5 2.5 0 0 1 8.5 2h1Z"}),f.jsx("path",{d:"M14.5 2A2.5 2.5 0 0 1 17 4.5v1a2.5 2.5 0 0 1-2.5 2.5h-1a2.5 2.5 0 0 1-2.5-2.5v-1A2.5 2.5 0 0 1 12.5 2h2Z"}),f.jsx("path",{d:"M18 12a4.5 4.5 0 0 1-4.5 4.5h-3A4.5 4.5 0 0 1 6 12v-2a4.5 4.5 0 0 1 4.5-4.5h3A4.5 4.5 0 0 1 18 10v2Z"}),f.jsx("path",{d:"M6 12a2.5 2.5 0 0 0-2.5 2.5v1A2.5 2.5 0 0 0 6 18h1a2.5 2.5 0 0 0 2.5-2.5v-1A2.5 2.5 0 0 0 7 12h-1Z"}),f.jsx("path",{d:"M18 12a2.5 2.5 0 0 1 2.5 2.5v1a2.5 2.5 0 0 1-2.5 2.5h-1a2.5 2.5 0 0 1-2.5-2.5v-1a2.5 2.5 0 0 1 2.5-2.5h1Z"}),f.jsx("path",{d:"M12 11v1"}),f.jsx("path",{d:"M12 18v2"})]}),Si=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),f.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),s3=({inventoryData:t,salesHistory:e,productCatalog:n})=>{const[r,a]=A.useState("insights"),[o,c]=A.useState(!1),[d,p]=A.useState(null),[h,x]=A.useState([]),[v,w]=A.useState(null),_=A.useRef(null),{showToast:E}=ds(),T=k=>{const C=Array.from(k.target.files||[]);if(C.length===0)return;const I=C.map(j=>new Blob([j],{type:j.type}));x(I),p(null)},M=async()=>{if(h.length===0){p("Please select at least one image.");return}c(!0),p(null),w(null);try{switch(r){case"insights":const k=await n3(h,t,e);w(k),E("Visual insights generated successfully!","success");break;case"stock-estimation":if(h.length>1){p("Stock estimation works with a single image. Please select one image."),c(!1);return}const C=prompt("Enter product name for stock estimation:")||"Unknown Product",I=prompt("Enter expected shelf capacity (optional):"),j=await WD(h[0],C,I?parseInt(I):void 0);w(j),E("Stock estimation completed!","success");break;case"quality-assessment":if(h.length>1){p("Quality assessment works with a single image. Please select one image."),c(!1);return}const B=prompt("Enter product name:")||"Unknown Product",H=prompt("Enter expected expiration date (YYYY-MM-DD, optional):"),Q=await e3(h[0],B,H||void 0);w(Q),E("Quality assessment completed!","success");break;case"visual-search":if(h.length>1){p("Visual search works with a single image. Please select one image."),c(!1);return}{const le=Hf();if(!le){p("No active shop context. Please ensure you are logged in."),c(!1);return}const ue=await tw(h[0],le);w({items:ue,count:ue.length}),E(`Found ${ue.length} matching items!`,"success")}break;case"expiration-verify":const Z=await Promise.all(h.map(async(le,ue)=>{const Re=prompt(`Enter product name for image ${ue+1}:`)||"Unknown Product",Ne=prompt(`Enter expected expiration (YYYY-MM-DD) for image ${ue+1}:`)||"";return{image:le,productName:Re,expectedExpiration:Ne}})),W=await t3(Z);w({verifications:W}),E("Expiration verification completed!","success");break}}catch(k){const C=k instanceof Error?k.message:"An unknown error occurred.";p(C),E(`Error: ${C}`,"error")}finally{c(!1)}},P=()=>{if(!v)return null;switch(r){case"insights":const k=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Visual Insights"}),k.insights.length>0&&f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Key Insights"}),f.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:k.insights.map((Q,Z)=>f.jsx("li",{children:Q},Z))})]}),k.riskItems.length>0&&f.jsxs("div",{className:"bg-red-900/20 p-4 rounded-lg border border-red-700",children:[f.jsx("h4",{className:"text-red-400 font-medium mb-2",children:"Risk Items"}),f.jsx("ul",{className:"space-y-2",children:k.riskItems.map((Q,Z)=>f.jsxs("li",{className:"text-sm text-gray-300",children:[f.jsx("span",{className:"font-semibold",children:Q.product}),": ",Q.issue,f.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs ${Q.severity==="high"?"bg-red-600":Q.severity==="medium"?"bg-yellow-600":"bg-gray-600"}`,children:Q.severity})]},Z))})]})]});case"stock-estimation":const C=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Stock Estimation Results"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Estimated Quantity"}),f.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:C.estimatedQuantity})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Confidence"}),f.jsxs("p",{className:"text-2xl font-bold text-cyan-400",children:[(C.confidence*100).toFixed(0),"%"]})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Visible Units"}),f.jsx("p",{className:"text-2xl font-bold text-white",children:C.visibleUnits})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Shelf Fullness"}),f.jsxs("p",{className:"text-2xl font-bold text-white",children:[C.shelfFullness,"%"]})]})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Reasoning"}),f.jsx("p",{className:"text-gray-300 text-sm",children:C.reasoning})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Visual Analysis"}),f.jsx("p",{className:"text-gray-300 text-sm",children:C.visualAnalysis})]})]});case"quality-assessment":const I=v,j=I.qualityScore>=80?"text-green-400":I.qualityScore>=60?"text-yellow-400":"text-red-400";return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Quality Assessment"}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Quality Score"}),f.jsxs("p",{className:`text-4xl font-bold ${j}`,children:[I.qualityScore,"/100"]})]}),I.issues.length>0&&f.jsxs("div",{className:"bg-red-900/20 p-4 rounded-lg border border-red-700",children:[f.jsx("h4",{className:"text-red-400 font-medium mb-2",children:"Issues Found"}),f.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:I.issues.map((Q,Z)=>f.jsx("li",{children:Q},Z))})]}),I.recommendations.length>0&&f.jsxs("div",{className:"bg-cyan-900/20 p-4 rounded-lg border border-cyan-700",children:[f.jsx("h4",{className:"text-cyan-400 font-medium mb-2",children:"Recommendations"}),f.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:I.recommendations.map((Q,Z)=>f.jsx("li",{children:Q},Z))})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Packaging"}),f.jsx("p",{className:"text-lg font-semibold text-white capitalize",children:I.packagingIntegrity})]}),f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Damage Detected"}),f.jsx("p",{className:`text-lg font-semibold ${I.damageDetected?"text-red-400":"text-green-400"}`,children:I.damageDetected?"Yes":"No"})]})]}),I.expirationDate&&f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsx("p",{className:"text-sm text-gray-400",children:"Detected Expiration"}),f.jsx("p",{className:"text-lg font-semibold text-white",children:I.expirationDate})]})]});case"visual-search":const B=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Search Results (",B.count," items found)"]}),B.items.length>0?f.jsx("div",{className:"space-y-2",children:B.items.map((Q,Z)=>f.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg",children:[f.jsxs("p",{className:"font-semibold text-white",children:["Product ID: ",Q.productId]}),f.jsxs("p",{className:"text-sm text-gray-400",children:["Quantity: ",Q.quantity," | Expiration: ",Q.expirationDate]})]},Z))}):f.jsx("p",{className:"text-gray-400",children:"No matching items found in inventory."})]});case"expiration-verify":const H=v;return f.jsxs("div",{className:"mt-6 space-y-4",children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Expiration Verification Results"}),f.jsx("div",{className:"space-y-3",children:H.verifications.map((Q,Z)=>f.jsxs("div",{className:`p-4 rounded-lg border ${Q.match?"bg-green-900/20 border-green-700":"bg-red-900/20 border-red-700"}`,children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsx("p",{className:"font-semibold text-white",children:Q.productName}),f.jsx("span",{className:`px-2 py-1 rounded text-xs ${Q.match?"bg-green-600":"bg-red-600"}`,children:Q.match?"Match":"Mismatch"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Expected"}),f.jsx("p",{className:"text-white",children:Q.expectedExpiration})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Detected"}),f.jsx("p",{className:"text-white",children:Q.detectedExpiration||"Not visible"})]})]}),Q.discrepancy&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:Q.discrepancy})]},Z))})]});default:return null}};return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("h2",{className:"text-xl font-semibold mb-4 text-white flex items-center",children:[f.jsx(nw,{className:"w-6 h-6 mr-2 text-cyan-400"}),"Multi-Modal AI Visual Analysis"]}),f.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use AI-powered visual analysis to gain insights from shelf photos, assess product quality, estimate stock levels, and more."}),f.jsx("div",{className:"mb-4 flex flex-wrap gap-2",children:["insights","stock-estimation","quality-assessment","visual-search","expiration-verify"].map(k=>f.jsx("button",{onClick:()=>{a(k),w(null),x([]),p(null)},className:`px-3 py-2 rounded-md text-sm font-medium transition ${r===k?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:k.split("-").map(C=>C.charAt(0).toUpperCase()+C.slice(1)).join(" ")},k))}),f.jsxs("div",{className:"mb-4",children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Select Images ",r==="insights"||r==="expiration-verify"?"(Multiple)":"(Single)"]}),f.jsx("input",{ref:_,type:"file",accept:"image/*",multiple:r==="insights"||r==="expiration-verify",onChange:T,className:"hidden"}),f.jsxs("button",{onClick:()=>{var k;return(k=_.current)==null?void 0:k.click()},className:"w-full flex items-center justify-center gap-2 py-3 px-4 border border-gray-600 rounded-md text-sm font-medium text-gray-200 bg-gray-700/50 hover:bg-gray-700 transition",children:[f.jsx(Si,{className:"w-5 h-5"}),h.length>0?`${h.length} image(s) selected`:"Choose Images"]}),h.length>0&&f.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[h.length," image(s) ready for analysis"]})]}),f.jsx("button",{onClick:M,disabled:o||h.length===0,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:o?"Analyzing...":"Analyze Images"}),d&&f.jsx("div",{className:"mt-4 p-3 bg-red-900/50 border border-red-700 rounded-lg",children:f.jsx("p",{className:"text-red-400 text-sm",children:d})}),o&&f.jsxs("div",{className:"flex items-center justify-center my-4 p-4 bg-gray-900/50 rounded-lg",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"}),f.jsx("p",{className:"ml-3 text-cyan-400",children:"AI is analyzing your images..."})]}),P()]})},r3=({summaries:t,onNavigateToInventory:e,onRefreshData:n})=>{const[r,a]=A.useState(!1),[o,c]=A.useState([]),[d,p]=A.useState([]),{showToast:h}=ds();A.useEffect(()=>{(async()=>{try{const _=await zf();c(_);try{const{getActiveShopId:E}=await BD(async()=>{const{getActiveShopId:M}=await Promise.resolve().then(()=>iD);return{getActiveShopId:M}},void 0),T=E();if(T){const M=await yv(T);p(M)}}catch(E){console.warn("Could not load sales history:",E)}}catch(_){console.error("Error loading inventory data:",_)}})()},[t]);const x=async()=>{var w,_,E,T,M,P,k,C,I;if(confirm("This will create sample products, suppliers, batches, and inventory items. Continue?")){a(!0);try{const j=[{name:"Organic Milk - Whole",manufacturer:"Fresh Dairy Co.",category:"Dairy",description:"Fresh organic whole milk, 1 gallon",imageUrl:"https://images.unsplash.com/photo-1563636619-e9143da7973b?w=200"},{name:"Whole Wheat Bread",manufacturer:"Baker's Delight",category:"Bakery",description:"Fresh baked whole wheat bread, 1 loaf",imageUrl:"https://images.unsplash.com/photo-1509440159596-0249088772ff?w=200"},{name:"Bananas - Organic",manufacturer:"Tropical Farms",category:"Produce",description:"Organic bananas, 1 bunch (~2 lbs)",imageUrl:"https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=200"},{name:"Chicken Breast - Free Range",manufacturer:"Farm Fresh Poultry",category:"Meat",description:"Free range chicken breast, 1 lb",imageUrl:"https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=200"},{name:"Organic Eggs - Large",manufacturer:"Happy Hens Farm",category:"Dairy",description:"Organic large eggs, 12 count",imageUrl:"https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?w=200"},{name:"Tomatoes - Roma",manufacturer:"Garden Fresh",category:"Produce",description:"Fresh Roma tomatoes, 1 lb",imageUrl:"https://images.unsplash.com/photo-1546470427-e26264be0b01?w=200"}],B=[{name:"Fresh Dairy Co.",contactEmail:"orders@fresherdairy.com"},{name:"Baker's Delight",contactEmail:"supply@bakersdelight.com"},{name:"Tropical Farms",contactEmail:"sales@tropicalfarms.com"},{name:"Farm Fresh Poultry",contactEmail:"info@farmfreshpoultry.com"},{name:"Happy Hens Farm",contactEmail:"orders@happyhens.com"},{name:"Garden Fresh",contactEmail:"wholesale@gardenfresh.com"},{name:"Organic Foods Dist.",contactEmail:"sales@organicfoods.com"},{name:"Premium Meats Co.",contactEmail:"orders@premiummeats.com"}],H=[];for(const D of B)try{const J=await Ri(D);H.push(J)}catch(J){console.warn("Failed to create supplier:",J)}const Q=[];for(let D=0;D<j.length;D++){const J=j[D],ne=H.find($=>$.name.toLowerCase().includes(J.manufacturer.toLowerCase().split(" ")[0]))||H[D]||H[0];try{const $=J.imageUrl?[{url:J.imageUrl,type:"manual",source:"user",addedAt:new Date().toISOString()}]:[],oe=await Ii({...J,defaultSupplierId:ne==null?void 0:ne.id,images:$});Q.push(oe)}catch($){console.warn("Failed to create product:",$)}}const Z=new Date,W=new Date(Z);W.setDate(W.getDate()-7);const le=new Date(Z);le.setDate(le.getDate()-5);const ue=Q.slice(0,3).map(D=>({productId:D.id,productName:D.name,quantity:Math.floor(Math.random()*80)+20,cost:Math.random()*8+2})),Re=await Ma({supplierId:(w=H[0])==null?void 0:w.id,deliveryDate:W.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-1`,documents:[],lineItems:ue}),Ne=Q.slice(0,2).map(D=>({productId:D.id,productName:D.name,quantity:Math.floor(Math.random()*60)+15,cost:Math.random()*10+3})),Ie=await Ma({supplierId:(_=H[1])==null?void 0:_.id,deliveryDate:le.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-2`,documents:[],lineItems:Ne}),R=Q.slice(3,6).map(D=>({productId:D.id,productName:D.name,quantity:Math.floor(Math.random()*70)+20,cost:Math.random()*9+2})),O=await Ma({supplierId:((E=H[3])==null?void 0:E.id)||((T=H[2])==null?void 0:T.id)||((M=H[0])==null?void 0:M.id),deliveryDate:W.toISOString().split("T")[0],invoiceNumber:`INV-${Date.now()}-3`,documents:[],lineItems:R}),Y=ue.map((D,J)=>{var V;const ne=Q[J],$=[7,14,21,30][Math.floor(Math.random()*4)],oe=new Date(Z);oe.setDate(oe.getDate()+$);const he=D.cost,ye=he*1.5;return{productName:ne.name,manufacturer:ne.manufacturer,category:ne.category,quantity:D.quantity,quantityType:"units",costPerUnit:he,buyPrice:he,sellPrice:ye,expirationDate:oe.toISOString().split("T")[0],location:["A-1","B-2","C-3"][Math.floor(Math.random()*3)],images:ne.images||[],supplierId:(V=H[0])==null?void 0:V.id,scanMetadata:null}}),re=Ne.map((D,J)=>{var V;const ne=Q[J],$=[10,17,24,31][Math.floor(Math.random()*4)],oe=new Date(Z);oe.setDate(oe.getDate()+$);const he=D.cost,ye=he*1.5;return{productName:ne.name,manufacturer:ne.manufacturer,category:ne.category,quantity:D.quantity,quantityType:"units",costPerUnit:he,buyPrice:he,sellPrice:ye,expirationDate:oe.toISOString().split("T")[0],location:["D-1","E-2","F-3"][Math.floor(Math.random()*3)],images:ne.images||[],supplierId:(V=H[1])==null?void 0:V.id,scanMetadata:null}}),ae=R.map((D,J)=>{var V,se,xe;const ne=Q[3+J],$=[7,14,21,30][Math.floor(Math.random()*4)],oe=new Date(Z);oe.setDate(oe.getDate()+$);const he=D.cost,ye=he*1.5;return{productName:ne.name,manufacturer:ne.manufacturer,category:ne.category,quantity:D.quantity,quantityType:"units",costPerUnit:he,buyPrice:he,sellPrice:ye,expirationDate:oe.toISOString().split("T")[0],location:["G-1","H-2","I-3"][Math.floor(Math.random()*3)],images:ne.images||[],supplierId:((V=H[3])==null?void 0:V.id)||((se=H[2])==null?void 0:se.id)||((xe=H[0])==null?void 0:xe.id),scanMetadata:null}});await _i({supplier:((P=H[0])==null?void 0:P.name)||"Test Supplier",deliveryDate:W.toISOString().split("T")[0],inventoryDate:Z.toISOString().split("T")[0]},Y),await _i({supplier:((k=H[1])==null?void 0:k.name)||"Test Supplier 2",deliveryDate:le.toISOString().split("T")[0],inventoryDate:Z.toISOString().split("T")[0]},re),await _i({supplier:((C=H[3])==null?void 0:C.name)||((I=H[2])==null?void 0:I.name)||"Test Supplier 3",deliveryDate:W.toISOString().split("T")[0],inventoryDate:Z.toISOString().split("T")[0]},ae),h(`Test data created: ${H.length} suppliers, ${Q.length} products, 3 batches, ${Y.length+re.length+ae.length} inventory items`,"success"),n&&await n()}catch(j){console.error("Error creating test data:",j),h("Failed to create test data: "+(j instanceof Error?j.message:"Unknown error"),"error")}finally{a(!1)}}},v=A.useMemo(()=>{const w=t.reduce((k,C)=>{const I=C.averageCostPerUnit||0;return k+C.totalQuantity*I},0),_=t.length,E=new Date;E.setHours(0,0,0,0);const T=new Date;T.setDate(E.getDate()+30),T.setHours(23,59,59,999);const M=t.filter(k=>{const C=new Date(k.earliestExpiration);return C.setHours(0,0,0,0),C>=E&&C<=T}),P=t.filter(k=>{const C=new Date(k.earliestExpiration);return C.setHours(0,0,0,0),C<E});return{totalValue:w,uniqueProducts:_,expiringSoon:M.length,expired:P.length,expiringSoonList:M,expiredList:P}},[t]);return f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Dashboard"}),f.jsx("p",{className:"text-lg text-gray-400",children:"A high-level overview of your inventory status."})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[f.jsx("div",{className:"p-3 bg-cyan-900/50 rounded-lg",children:f.jsx(VD,{className:"w-8 h-8 text-cyan-400"})}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Total Inventory Value"}),f.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",v.totalValue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[f.jsx("div",{className:"p-3 bg-cyan-900/50 rounded-lg",children:f.jsx(Zb,{className:"w-8 h-8 text-cyan-400"})}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Unique Products"}),f.jsx("p",{className:"text-2xl font-bold text-white",children:v.uniqueProducts})]})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 flex items-center space-x-4",children:[f.jsx("div",{className:"p-3 bg-red-900/50 rounded-lg",children:f.jsx(of,{className:"w-8 h-8 text-red-400"})}),f.jsxs("div",{className:"flex-1",children:[f.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Expiring in 30 Days"}),f.jsxs("p",{className:"text-2xl font-bold text-white",children:[v.expiringSoon," items"]}),v.expired>0&&f.jsxs("p",{className:"text-xs text-red-400 mt-1",children:[v.expired," expired"]})]})]})]}),(v.expired>0||v.expiringSoon>0)&&f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-red-700",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(of,{className:"w-6 h-6 text-red-400"}),"Expiration Alerts"]}),v.expired>0&&f.jsxs("div",{className:"mb-4",children:[f.jsxs("p",{className:"text-red-400 font-semibold mb-2",children:[" Expired Items (",v.expired,")"]}),f.jsx("ul",{className:"space-y-2",children:v.expiredList.slice(0,5).map(w=>f.jsxs("li",{className:"text-sm p-2 bg-red-900/30 rounded-md",children:[f.jsx("span",{className:"text-white font-medium",children:w.productName}),f.jsxs("span",{className:"text-red-300 ml-2",children:["Expired: ",w.earliestExpiration]})]},w.productName))})]}),v.expiringSoon>0&&f.jsxs("div",{children:[f.jsxs("p",{className:"text-yellow-400 font-semibold mb-2",children:[" Expiring Soon (",v.expiringSoon,")"]}),f.jsx("ul",{className:"space-y-2",children:v.expiringSoonList.slice(0,5).map(w=>{const _=new Date(w.earliestExpiration),E=Math.ceil((_.getTime()-new Date().getTime())/(1e3*60*60*24));return f.jsxs("li",{className:"text-sm p-2 bg-yellow-900/30 rounded-md",children:[f.jsx("span",{className:"text-white font-medium",children:w.productName}),f.jsxs("span",{className:"text-yellow-300 ml-2",children:["Expires in ",E," days: ",w.earliestExpiration]})]},w.productName)})})]})]}),f.jsx(s3,{inventoryData:o,salesHistory:d,productCatalog:t}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Quick Actions"}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("button",{onClick:e,className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Add New Inventory Batch"}),t.length===0&&f.jsx("button",{onClick:x,disabled:r,className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Creating Test Data...":" Create Test Data"})]})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Recently Added Products"}),t.length>0?f.jsx("ul",{className:"space-y-3",children:t.slice(0,3).map(w=>f.jsxs("li",{className:"flex justify-between items-center text-sm p-3 bg-gray-900/50 rounded-md",children:[f.jsxs("div",{children:[f.jsx("p",{className:"font-medium text-white",children:w.productName}),f.jsx("p",{className:"text-gray-400",children:w.manufacturer})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("p",{className:"font-bold text-white",children:[w.totalQuantity," ",w.quantityType]}),f.jsxs("p",{className:"text-gray-400",children:["Exp: ",w.earliestExpiration]})]})]},w.productName))}):f.jsx("p",{className:"text-center text-gray-500 py-4",children:"No inventory data available."})]})]})]})},xr=t=>{if(!t)return"N/A";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toISOString().split("T")[0]},i3=t=>{const e=t.trim().split(" ");return e.length===1?e[0].slice(0,2).toUpperCase():(e[0][0]+e[e.length-1][0]).toUpperCase()},mx=7,gx=10,a3=({summaries:t,inventoryItems:e,onSelectProduct:n,onEditItem:r,onDeleteItem:a})=>{var C;const[o,c]=A.useState([]),[d,p]=A.useState(""),[h,x]=A.useState("all"),[v,w]=A.useState({});A.useEffect(()=>{(async()=>{try{const j=await Gs();c(j)}catch(j){console.error("Failed to load suppliers:",j)}})()},[]);const _=A.useMemo(()=>d?t.filter(I=>I.supplierIds&&I.supplierIds.includes(d)):t,[t,d]),E=A.useMemo(()=>{if(h==="all")return _;const I=new Date,j=1e3*60*60*24;return _.filter(B=>{if(h==="expiringSoon"){const H=new Date(B.earliestExpiration);if(Number.isNaN(H.getTime()))return!1;const Q=Math.ceil((H.getTime()-I.getTime())/j);return Q>=0&&Q<=mx}return h==="lowStock"?B.totalQuantity<=gx:!0})},[_,h]);if(!t.length)return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[f.jsx("p",{className:"mb-4",children:"Your inventory is empty. Products need inventory items (stock) to appear here."}),f.jsxs("div",{className:"mt-4 p-4 bg-gray-900/50 rounded-lg text-left text-sm",children:[f.jsx("p",{className:"text-yellow-400 font-semibold mb-2",children:" How to add inventory:"}),f.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-gray-300",children:[f.jsx("li",{children:"Use the form on the left to add inventory items for existing products"}),f.jsx("li",{children:'Or use the "Batches" tab to log a delivery batch with multiple items'}),f.jsx("li",{children:"Products from Product Catalog need inventory items added to show up here"})]})]})]});if(t.length>0&&!E.length)return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[f.jsx("p",{className:"mb-2",children:"No products match the current filters."}),f.jsx("p",{className:"text-sm text-gray-400",children:"Try clearing the supplier or inventory filter above to see the full inventory list."})]});const M=I=>!I||I.length===0?[]:I.map(j=>{var B;return(B=o.find(H=>H.id===j))==null?void 0:B.name}).filter(j=>!!j),P=A.useMemo(()=>{const I=new Map;return e.forEach(j=>{const B=I.get(j.productId)||[];B.push(j),I.set(j.productId,B)}),I},[e]),k=I=>{w(j=>({...j,[I]:!j[I]}))};return f.jsxs("div",{children:[f.jsx("div",{className:"flex items-center justify-end mb-4",children:f.jsxs("div",{className:"flex flex-col gap-3 text-sm text-gray-300 md:flex-row md:items-center",children:[o.length>0&&f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("label",{children:"Supplier:"}),f.jsxs("select",{value:d,onChange:I=>p(I.target.value),className:"px-3 py-1.5 rounded-md bg-gray-900 border border-gray-700 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"",children:"All Suppliers"}),o.map(I=>f.jsx("option",{value:I.id,children:I.name},I.id))]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("label",{children:"Inventory filter:"}),f.jsxs("select",{value:h,onChange:I=>x(I.target.value),className:"px-3 py-1.5 rounded-md bg-gray-900 border border-gray-700 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[f.jsx("option",{value:"all",children:"All items"}),f.jsxs("option",{value:"expiringSoon",children:["Expiring in  ",mx," days"]}),f.jsxs("option",{value:"lowStock",children:["Low stock ( ",gx,")"]})]})]})]})}),d&&f.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Showing ",E.length," product(s) from ",((C=o.find(I=>I.id===d))==null?void 0:C.name)||"selected supplier"]}),f.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:E.map(I=>{const j=M(I.supplierIds),B=P.get(I.productId)||[],H=v[I.productId];return f.jsxs("button",{onClick:()=>n(I),className:"bg-gray-800/60 border border-gray-700 rounded-xl overflow-hidden text-left hover:border-cyan-500 transition",children:[f.jsx("div",{className:"h-32 bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-3xl font-bold text-gray-300",children:i3(I.productName)}),f.jsxs("div",{className:"p-4 space-y-2",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-lg font-semibold text-white",children:I.productName}),f.jsx("p",{className:"text-sm text-gray-400",children:I.manufacturer})]}),f.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300",children:[f.jsxs("span",{className:"font-medium text-white",children:[I.totalQuantity," ",I.quantityType]}),f.jsxs("span",{className:"text-xs uppercase tracking-wide text-gray-400",children:["Exp: ",xr(I.earliestExpiration)]})]}),j.length>0&&f.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[f.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Suppliers:"}),f.jsx("div",{className:"flex flex-wrap gap-1",children:j.map((Q,Z)=>f.jsx("span",{className:"px-2 py-0.5 text-xs bg-cyan-900/30 text-cyan-300 rounded border border-cyan-700/50",children:Q},Z))})]}),f.jsx("p",{className:"text-xs text-gray-500",children:"Location: Not set"}),B.length>0&&f.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700",children:[f.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-2",children:[f.jsxs("span",{children:[B.length," inventory item",B.length>1?"s":""]}),f.jsx("button",{onClick:Q=>{Q.stopPropagation(),k(I.productId)},className:"text-cyan-300 hover:text-cyan-200",children:H?"Hide items":"Manage items"})]}),H&&f.jsx("div",{className:"space-y-2",children:B.map(Q=>f.jsxs("div",{className:"p-2 bg-gray-900/60 rounded text-xs text-gray-300 border border-gray-800 flex flex-col gap-1",onClick:Z=>Z.stopPropagation(),children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsxs("span",{children:["Qty: ",Q.quantity," ",Q.quantityType]}),f.jsxs("span",{children:["Exp: ",xr(Q.expirationDate)]})]}),f.jsxs("div",{className:"flex justify-between text-gray-400",children:[f.jsx("span",{children:Q.location?`Loc: ${Q.location}`:"Location N/A"}),f.jsxs("span",{children:["$",Q.costPerUnit.toFixed(2),"/unit"]})]}),f.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[f.jsx("button",{onClick:Z=>{Z.stopPropagation(),r(Q)},disabled:!Q.inventoryUuid,className:"px-2 py-1 rounded bg-gray-700 text-white disabled:opacity-40 disabled:cursor-not-allowed",children:"Edit"}),f.jsx("button",{onClick:Z=>{Z.stopPropagation(),a(Q)},disabled:!Q.inventoryUuid,className:"px-2 py-1 rounded bg-red-700/80 text-white disabled:opacity-40 disabled:cursor-not-allowed",children:"Delete"})]})]},Q.inventoryUuid||Q.id))})]})]})]},I.productId)})})]})},o3=({inventory:t,batches:e,onEditRequest:n,onDeleteRequest:r})=>t.length===0?f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:[f.jsx("h2",{className:"text-xl font-semibold mb-2 text-white",children:"Current Inventory"}),f.jsx("p",{children:"Your inventory is empty. Add items using the form to see them here."})]}):f.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700 overflow-hidden",children:[f.jsx("h2",{className:"text-xl font-semibold text-white p-6",children:"Current Inventory"}),f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[f.jsx("thead",{className:"bg-gray-800",children:f.jsxs("tr",{children:[f.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-6",children:"Product Name"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Manufacturer"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Exp. Date"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Quantity"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Supplier"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Cost/Unit"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-right text-sm font-semibold text-gray-300",children:"Actions"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700 bg-gray-900/50",children:t.map(a=>{var o;return f.jsxs("tr",{className:"hover:bg-gray-800 transition-colors",children:[f.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-6",children:a.productName}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:a.manufacturer}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:xr(a.expirationDate)}),f.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:[a.quantity," ",a.quantityType]}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:((o=e.find(c=>c.id===a.batchId))==null?void 0:o.supplier)||"N/A"}),f.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:["$",a.costPerUnit.toFixed(2)]}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-right text-gray-400",children:f.jsxs("div",{className:"flex justify-end gap-2",children:[f.jsx("button",{onClick:()=>n(a),disabled:!a.inventoryUuid,className:"px-3 py-1 rounded-md bg-gray-700 text-white text-xs hover:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed",children:"Edit"}),f.jsx("button",{onClick:()=>r(a),disabled:!a.inventoryUuid,className:"px-3 py-1 rounded-md bg-red-700/70 text-white text-xs hover:bg-red-700 disabled:opacity-40 disabled:cursor-not-allowed",children:"Delete"})]})})]},a.id)})})]})})]}),l3=({items:t,batches:e})=>{const[n,r]=A.useState(""),[a,o]=A.useState(null),[c,d]=A.useState(!1),[p,h]=A.useState(null),x=["Which items expire in the next 30 days?","What is the total value of my current inventory?","Summarize stock levels by supplier.","Identify my most expensive items per unit."],v=async()=>{if(!n){h("Please enter a query for the report.");return}d(!0),h(null),o(null);try{const w=await YD(t,e,n);o(w)}catch(w){h(w instanceof Error?w.message:"An unknown error occurred.")}finally{d(!1)}};return f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("h2",{className:"text-xl font-semibold mb-4 text-white flex items-center",children:[f.jsx(nw,{className:"w-6 h-6 mr-2 text-cyan-400"}),"Advanced Inventory Analysis (Gemini Pro)"]}),f.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use our most powerful model to get deep insights into your inventory. Ask complex questions to make better business decisions."}),f.jsxs("div",{className:"mb-4",children:[f.jsx("label",{htmlFor:"analysis-prompt",className:"block text-sm font-medium text-gray-300 mb-2",children:"Your Analysis Request"}),f.jsx("textarea",{id:"analysis-prompt",rows:3,className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm",placeholder:"e.g., What is the total value of my current stock?",value:n,onChange:w=>r(w.target.value)})]}),f.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[f.jsx("span",{className:"text-sm text-gray-400 self-center",children:"Try:"}),x.map(w=>f.jsx("button",{onClick:()=>r(w),className:"px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded-md hover:bg-cyan-800 hover:text-white transition-colors",children:w},w))]}),f.jsx("button",{onClick:v,disabled:c||t.length===0,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:c?"Thinking...":"Generate Report"}),t.length===0&&f.jsx("p",{className:"text-yellow-400 text-sm mt-2 text-center",children:"Add items to inventory to enable analysis."}),p&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:p}),c&&f.jsxs("div",{className:"flex items-center justify-center my-4 p-4 bg-gray-900/50 rounded-lg",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"}),f.jsx("p",{className:"ml-3 text-cyan-400",children:"Gemini Pro is processing your request..."})]}),a&&f.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[f.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Analysis Report"}),f.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-gray-300",dangerouslySetInnerHTML:{__html:a.replace(/\n/g,"<br />")}})]})]})},c3=({product:t,allItems:e,allBatches:n,onClose:r})=>{const a=h=>typeof h!="number"||Number.isNaN(h)?"N/A":`$${h.toFixed(2)}`,o=e.filter(h=>h.productName===t.productName).map(h=>{const x=n.find(v=>v.id===h.batchId);return{...h,batch:x}}).sort((h,x)=>new Date(h.expirationDate).getTime()-new Date(x.expirationDate).getTime()),c=A.useMemo(()=>o.reduce((h,x)=>{const v=typeof x.costPerUnit=="number"?x.costPerUnit:0;return h+v*x.quantity},0),[o]),d=t.totalQuantity>0?c/t.totalQuantity:0,p=A.useMemo(()=>{const h=new Map;return o.forEach(x=>{var P,k,C;const v=((P=x.batch)==null?void 0:P.id)??x.batchId??`line-${x.id}`,w=String(v),_=((k=x.batch)==null?void 0:k.supplier)??"N/A",E=(C=x.batch)==null?void 0:C.inventoryDate,T=typeof x.costPerUnit=="number"?x.costPerUnit:0,M=h.get(w)??{batchId:w,supplier:_,inventoryDate:E,quantity:0,totalValue:0};M.quantity+=x.quantity,M.totalValue+=T*x.quantity,M.supplier=_,M.inventoryDate=E,h.set(w,M)}),Array.from(h.values()).sort((x,v)=>x.batchId.localeCompare(v.batchId))},[o]);return f.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-center justify-center p-4",onClick:r,children:f.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",onClick:h=>h.stopPropagation(),children:[f.jsxs("div",{className:"p-6 border-b border-gray-700",children:[f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold text-white",children:t.productName}),f.jsx("p",{className:"text-sm text-gray-400",children:t.manufacturer})]}),f.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white transition-colors",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f.jsxs("div",{className:"mt-4 flex space-x-8 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Total Quantity"}),f.jsxs("p",{className:"text-white font-semibold text-lg",children:[t.totalQuantity," ",t.quantityType]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Earliest Expiration"}),f.jsx("p",{className:"text-yellow-400 font-semibold text-lg",children:xr(t.earliestExpiration)})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Average Unit Cost"}),f.jsx("p",{className:"text-cyan-400 font-semibold text-lg",children:a(d)})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Inventory Value"}),f.jsx("p",{className:"text-green-400 font-semibold text-lg",children:a(c)})]})]})]}),f.jsxs("div",{className:"p-6 overflow-y-auto",children:[f.jsx("h3",{className:"text-lg font-semibold text-cyan-400 mb-3",children:"Batch Details (First-Expired, First-Out)"}),f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[f.jsx("thead",{className:"bg-gray-800",children:f.jsxs("tr",{children:[f.jsx("th",{scope:"col",className:"py-3 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-0",children:"Quantity"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Exp. Date"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Supplier"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Inventory Date"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Cost / Unit"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Buy Price"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Sell Price"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Line Value"}),f.jsx("th",{scope:"col",className:"px-3 py-3 text-left text-sm font-semibold text-gray-300",children:"Batch"})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700",children:o.map(h=>{var x,v,w;return f.jsxs("tr",{children:[f.jsxs("td",{className:"py-3 pl-4 pr-3 text-sm text-white sm:pl-0",children:[h.quantity," ",h.quantityType]}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:xr(h.expirationDate)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-400",children:((x=h.batch)==null?void 0:x.supplier)??"N/A"}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-400",children:xr((v=h.batch)==null?void 0:v.inventoryDate)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a(h.costPerUnit)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a(h.buyPrice)}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:typeof h.sellPrice=="number"?a(h.sellPrice):""}),f.jsx("td",{className:"px-3 py-3 text-sm text-gray-300",children:a((h.costPerUnit||0)*h.quantity)}),f.jsx("td",{className:"px-3 py-3 text-xs text-gray-500",children:((w=h.batch)==null?void 0:w.id)??String(h.batchId)})]},h.id)})})]})}),p.length>0&&f.jsxs("div",{className:"mt-6",children:[f.jsx("h4",{className:"text-md font-semibold text-gray-200 mb-3",children:"Cost Overview by Batch"}),f.jsx("div",{className:"space-y-3",children:p.map(h=>f.jsxs("div",{className:"p-4 bg-gray-900/40 border border-gray-700 rounded-lg flex flex-wrap gap-4 text-sm",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Batch"}),f.jsx("p",{className:"text-white font-semibold",children:h.batchId})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Supplier"}),f.jsx("p",{className:"text-white",children:h.supplier})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Inventory Date"}),f.jsx("p",{className:"text-white",children:xr(h.inventoryDate)})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Quantity"}),f.jsxs("p",{className:"text-white",children:[h.quantity," ",t.quantityType]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400",children:"Batch Value"}),f.jsx("p",{className:"text-green-400 font-semibold",children:a(h.totalValue)})]})]},h.batchId))})]}),f.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-cyan-800/50",children:[f.jsx("h4",{className:"font-semibold text-cyan-500",children:"POS Integration Note"}),f.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'The list above is sorted by expiration date. For a "First-Expired, First-Out" (FEFO) strategy, a Point-of-Sale system would automatically deduct sold items from the top of this list, ensuring optimal stock rotation and minimizing waste.'})]})]})]})})},sw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),f.jsx("polyline",{points:"17 8 12 3 7 8"}),f.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),rw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),f.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),iw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M12 5a3 3 0 1 0-5.993.142"}),f.jsx("path",{d:"M12 5a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M15 13a3 3 0 1 0-5.993.142"}),f.jsx("path",{d:"M15 13a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M9 13a3 3 0 1 0-5.993.142"}),f.jsx("path",{d:"M9 13a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M12 21a3 3 0 1 0-5.993-.142"}),f.jsx("path",{d:"M12 21a3 3 0 1 1 5.993.142"}),f.jsx("path",{d:"M12 13h.01"}),f.jsx("path",{d:"M12 5h.01"}),f.jsx("path",{d:"M12 21h.01"}),f.jsx("path",{d:"M18 13h.01"}),f.jsx("path",{d:"M6 13h.01"}),f.jsx("path",{d:"M18 5h.01"}),f.jsx("path",{d:"M6 5h.01"}),f.jsx("path",{d:"m18 5-3 4"}),f.jsx("path",{d:"m6 5 3 4"}),f.jsx("path",{d:"m18 13-3-4"}),f.jsx("path",{d:"m6 13 3-4"}),f.jsx("path",{d:"m15 21-3-4"}),f.jsx("path",{d:"m9 21 3-4"})]}),aw=({onDataScanned:t,onClose:e,productOptions:n})=>{const r=A.useRef(null),a=A.useRef(null),o=A.useRef(null),c=A.useRef(null),[d,p]=A.useState(null),[h,x]=A.useState({}),[v,w]=A.useState(new Map),[_,E]=A.useState(new Map),[T,M]=A.useState("auto-scanning"),[P,k]=A.useState(null),[C,I]=A.useState(null),[j,B]=A.useState(null),[H,Q]=A.useState(new Set),[Z,W]=A.useState(new Map),[le,ue]=A.useState(null),[Re,Ne]=A.useState(new Set),Ie=A.useMemo(()=>{const V=new Map;return n.forEach(se=>{V.has(se.productName)||V.set(se.productName,se)}),V},[n]),R=A.useMemo(()=>Array.from(Ie.keys()),[Ie]),O=A.useRef(h),Y=A.useRef(_);A.useEffect(()=>{O.current=h},[h]),A.useEffect(()=>{Y.current=_},[_]);const re=A.useCallback((V,se,xe,rt)=>{if(se==null||typeof se=="string"&&se.trim()==="")return;const ot=Y.current.get(V)??0;O.current[V]!==void 0&&O.current[V]!==null&&String(O.current[V]).length>0&&ot>=rt||(x(ze=>({...ze,[V]:se})),w(ze=>{const ht=new Map(ze);return ht.set(V,xe),ht}),E(ze=>{const ht=new Map(ze);return ht.set(V,rt),ht}))},[]),ae=A.useCallback(()=>{c.current&&(clearInterval(c.current),c.current=null)},[]),D=A.useCallback(()=>{if(r.current&&o.current){const V=r.current,se=o.current,xe=V.getBoundingClientRect();se.width=xe.width,se.height=xe.height}},[]);A.useEffect(()=>{let V=null;return(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){p("Camera not supported on this browser. Please use a modern browser on a secure (HTTPS) connection.");return}try{V=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),r.current&&(r.current.srcObject=V,r.current.onloadedmetadata=()=>D())}catch(xe){console.error("Error accessing camera:",xe),p("Could not access the camera. Please ensure permissions are granted and you are on a secure (HTTPS) site.")}})(),window.addEventListener("resize",D),()=>{window.removeEventListener("resize",D),ae(),V&&V.getTracks().forEach(xe=>xe.stop())}},[D,ae]);const J=A.useCallback(async()=>{if(!r.current||!a.current||document.hidden||T!=="auto-scanning")return;const V=r.current,se=a.current;se.width=V.videoWidth,se.height=V.videoHeight;const xe=se.getContext("2d");if(!xe)return;xe.drawImage(V,0,0,V.videoWidth,V.videoHeight);const rt=await new Promise($e=>se.toBlob($e,"image/jpeg",.8));if(!rt||T!=="auto-scanning")return;let ot=null;try{const $e=await Qf(rt,R);ot=$e&&Ie.get($e)||null,(ot==null?void 0:ot.productId)!==(le==null?void 0:le.productId)&&ue(ot)}catch($e){console.warn("Product identification failed:",$e)}if(ot)try{const $e=await wv(ot.productId);$e.size>0&&await Promise.all(Array.from($e.entries()).map(async([ze,ht])=>{const Tt=ze;if(H.has(Tt)||Re.has(Tt)||(Y.current.get(Tt)??0)>=.85)return;const Bn=KD(`data:${ht.mimeType};base64,${ht.imageBase64}`),ln=await QD(rt,Bn,Tt);ln!==null&&(re(Tt,ln,"learned",.85),Ne(ie=>new Set(ie).add(Tt)))}))}catch($e){console.warn("Learned field scan failed:",$e)}try{const $e=await Kf(rt);for(const ze in $e){const ht=ze;H.has(ht)||re(ht,$e[ht],"auto",.6)}}catch($e){console.warn("Generic auto-scan analysis failed:",$e)}},[le,H,T,Ie,R,re,Re]);A.useEffect(()=>{T==="auto-scanning"&&!c.current?c.current=window.setInterval(J,4e3):T!=="auto-scanning"&&ae()},[T,J,ae]),A.useEffect(()=>{const V=o.current,se=V==null?void 0:V.getContext("2d");se&&V&&(se.clearRect(0,0,V.width,V.height),C&&(se.fillStyle="#06b6d4",se.beginPath(),se.arc(C.x,C.y,10,0,2*Math.PI),se.fill(),se.strokeStyle="white",se.lineWidth=2,se.stroke()),j&&(se.strokeStyle="#06b6d4",se.lineWidth=3,se.strokeRect(j.x,j.y,j.width,j.height)))},[C,j]);const ne=V=>{k(V),M("manual-capture"),I(null),B(null)},$=V=>{var se;if(T==="auto-scanning"){M("selecting-field");return}if(T==="manual-capture"&&P){const xe=(se=o.current)==null?void 0:se.getBoundingClientRect();if(!xe)return;const rt=V.clientX-xe.left,ot=V.clientY-xe.top;if(!C)I({x:rt,y:ot});else{const $e={x:Math.min(C.x,rt),y:Math.min(C.y,ot),width:Math.abs(rt-C.x),height:Math.abs(ot-C.y)};$e.width>10&&$e.height>10?(B($e),oe($e)):I(null)}}},oe=A.useCallback(async V=>{if(!r.current||!a.current||!P)return;M("analyzing"),I(null);const se=r.current,xe=a.current,rt=se.getBoundingClientRect(),ot=se.videoWidth/rt.width,$e=se.videoHeight/rt.height,ze=V.x*ot,ht=V.y*$e,Tt=V.width*ot,fs=V.height*$e;xe.width=Tt,xe.height=fs;const Bn=xe.getContext("2d");Bn&&(Bn.drawImage(se,ze,ht,Tt,fs,0,0,Tt,fs),xe.toBlob(async ln=>{if(ln)try{W(ce=>new Map(ce).set(P,ln));const ie=await ew(ln,P);re(P,ie,"manual",1),Q(ce=>new Set(ce).add(P)),Ne(ce=>{const Ee=new Set(ce);return Ee.delete(P),Ee})}catch(ie){console.error(ie),p(ie instanceof Error?ie.message:"Analysis failed")}k(null),B(null),M("auto-scanning")},"image/jpeg",.9))},[P,re]),he=()=>{t({data:{...h},blobs:new Map(Z),identifiedProductId:le==null?void 0:le.productId,fieldSources:new Map(v),fieldConfidences:new Map(_)}),e()},ye=()=>{switch(T){case"auto-scanning":return le?`Identified: ${le.productName}. Using learned fields to scan.`:"Scanning automatically... Tap screen to select a field manually.";case"selecting-field":return"Select a field to capture manually.";case"manual-capture":return P?C?"Tap the opposite corner.":`Tap the first corner for ${bn[P].displayName}.`:"Select a field.";case"analyzing":return`Analyzing ${bn[P].displayName}...`;default:return"Ready to scan."}};return f.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center","aria-modal":"true",children:[f.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),f.jsx("canvas",{ref:a,className:"hidden"}),f.jsx("canvas",{ref:o,className:"absolute inset-0 w-full h-full object-cover z-10 cursor-pointer",onClick:$}),T==="selecting-field"&&f.jsxs("div",{className:"absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20 p-4",children:[f.jsx("h3",{className:"text-xl font-bold mb-6 text-white",children:"Select a field to capture"}),f.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 w-full max-w-2xl",children:Object.keys(bn).map(V=>f.jsx("button",{onClick:()=>ne(V),className:"p-3 bg-gray-700 text-white rounded-lg hover:bg-cyan-600 transition-colors text-sm",children:bn[V].displayName},V))}),f.jsx("button",{onClick:()=>M("auto-scanning"),className:"mt-8 bg-gray-600 px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors",children:"Cancel & Resume Auto-Scan"})]}),d&&f.jsx("div",{className:"absolute top-4 bg-red-800/80 text-white p-3 rounded-lg text-center z-30 max-w-md mx-auto",children:d}),f.jsx("div",{className:"absolute top-4 bg-black/50 text-white px-4 py-2 rounded-full z-20 text-center",children:f.jsx("p",{children:ye()})}),T==="analyzing"&&f.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"})}),f.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-30","aria-label":"Close scanner",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),f.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 backdrop-blur-sm p-4 text-white rounded-t-lg shadow-2xl shadow-black z-20",children:[f.jsx("h3",{className:"text-lg font-bold text-cyan-400 mb-2",children:"Scanned Data"}),f.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 text-sm max-h-32 overflow-y-auto",children:Object.keys(h).length>0?Object.entries(h).map(([V,se])=>{const xe=V,rt=v.get(xe);return f.jsxs("div",{className:"truncate flex items-center",children:[f.jsxs("span",{className:"font-semibold capitalize text-gray-400",children:[bn[xe].displayName,": "]}),f.jsx("span",{className:"text-gray-100 ml-1",children:String(se)}),rt==="manual"&&f.jsx(rw,{className:"w-3 h-3 ml-2 text-cyan-400 flex-shrink-0"}),rt==="learned"&&f.jsx(iw,{className:"w-4 h-4 ml-2 text-indigo-400 flex-shrink-0"})]},V)}):f.jsx("p",{className:"col-span-full text-gray-500 text-center py-4",children:"Data will appear here as it's scanned..."})}),f.jsx("button",{onClick:he,disabled:Object.keys(h).length===0||T==="analyzing",className:"mt-4 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:"Confirm & Use This Data"})]})]})},Id={supplier:"",deliveryDate:"",inventoryDate:new Date().toISOString().split("T")[0]},yx={productName:"",manufacturer:"",category:"",productDescription:"",productId:void 0,supplierId:void 0,expirationDate:"",quantity:0,quantityType:"units",costPerUnit:0,location:"",buyPrice:0,sellPrice:void 0,images:[],scanMetadata:null,shareScope:["local"]},u3=({onAddBatch:t,summaries:e})=>{const[n,r]=A.useState(Id),[a,o]=A.useState(yx),[c,d]=A.useState([]),[p,h]=A.useState(!1),[x,v]=A.useState(null),[w,_]=A.useState(null),[E,T]=A.useState(!1),M=A.useRef(null),[P,k]=A.useState(new Map),[C,I]=A.useState(new Map),[j,B]=A.useState([]),[H,Q]=A.useState([]),[Z,W]=A.useState(""),[le,ue]=A.useState(""),[Re,Ne]=A.useState("existing"),[Ie,R]=A.useState("existing"),[O,Y]=A.useState({name:"",email:""}),[re,ae]=A.useState(!1),[D,J]=A.useState(null),[ne,$]=A.useState(!1),oe=A.useMemo(()=>{const ie=new Map;return j.forEach(ce=>{ie.set(ce.name,{productId:ce.id,productName:ce.name})}),e.forEach(ce=>{ie.has(ce.productName)||ie.set(ce.productName,{productId:ce.productId,productName:ce.productName})}),Array.from(ie.values())},[j,e]),he=A.useCallback(ie=>{const ce=new Set(["local"]);return(ie||[]).forEach(Ee=>Ee&&ce.add(Ee)),Array.from(ce)},[]),ye=A.useCallback(ie=>ie?ie.toLowerCase().trim().replace(/[^a-z0-9]+/gi,"-"):"unlabeled-product",[]),V=A.useCallback((ie,ce)=>{o(Ee=>{const Be=new Set(he(Ee.shareScope));return ce?Be.add(ie):Be.delete(ie),Be.size||Be.add("local"),{...Ee,shareScope:Array.from(Be)}})},[he]);A.useEffect(()=>()=>{C.forEach(ie=>URL.revokeObjectURL(ie))},[C]),A.useEffect(()=>{Re==="new"&&(W(""),o(ie=>({...ie,productId:void 0})))},[Re]),A.useEffect(()=>{Ie==="new"&&(ue(""),o(ie=>({...ie,supplierId:void 0})))},[Ie]);const se=A.useCallback(async()=>{try{const[ie,ce]=await Promise.all([Jl(),Gs()]);B(ie),Q(ce)}catch(ie){console.error("Failed to load reference data",ie)}},[]);A.useEffect(()=>{se()},[se]);const xe=A.useCallback(async ie=>{_(URL.createObjectURL(ie)),h(!0),v(null);try{const ce=await Kf(ie);r(Ee=>({...Ee,supplier:Ee.supplier||ce.supplier||"",deliveryDate:Ee.deliveryDate||ce.deliveryDate||""})),o(Ee=>({...Ee,productName:ce.productName||"",manufacturer:ce.manufacturer||"",category:ce.category||"",expirationDate:ce.expirationDate||"",quantity:ce.quantity||0,quantityType:ce.quantityType||"units",costPerUnit:ce.costPerUnit||0}))}catch(ce){v(ce instanceof Error?ce.message:"An unknown error occurred.")}finally{h(!1)}},[]),rt=A.useCallback(ie=>{var Ee;const ce=(Ee=ie.target.files)==null?void 0:Ee[0];ce&&xe(ce)},[xe]),ot=A.useCallback(ie=>{const{data:ce,blobs:Ee,identifiedProductId:Be}=ie;T(!1),_(null),M.current&&(M.current.value=""),J(ie),C.forEach(ke=>URL.revokeObjectURL(ke));const pt=new Map;if(Ee.forEach((ke,kt)=>pt.set(kt,URL.createObjectURL(ke))),I(pt),k(Ee),r(ke=>({...ke,supplier:ke.supplier||ce.supplier||"",deliveryDate:ke.deliveryDate||ce.deliveryDate||""})),Be){const ke=j.find(kt=>kt.id===Be);if(ke){$(!1),Ne("existing"),W(ke.id),o(kt=>({...kt,productId:ke.id,productName:ke.name,manufacturer:ke.manufacturer,category:ke.category,productDescription:ke.description||"",expirationDate:ce.expirationDate||kt.expirationDate||"",quantity:ce.quantity||kt.quantity||1,quantityType:ce.quantityType||kt.quantityType||"units",costPerUnit:ce.costPerUnit||kt.costPerUnit||0}));return}}Ne("new"),$(!0),o(ke=>({...ke,productName:ce.productName||ke.productName||"",manufacturer:ce.manufacturer||ke.manufacturer||"",category:ce.category||ke.category||"",expirationDate:ce.expirationDate||ke.expirationDate||"",quantity:ce.quantity||ke.quantity||0,quantityType:ce.quantityType||ke.quantityType||"units",costPerUnit:ce.costPerUnit||ke.costPerUnit||0}))},[C,j]),$e=ie=>{const{name:ce,value:Ee}=ie.target;r(Be=>({...Be,[ce]:Ee}))},ze=ie=>{const{name:ce,value:Ee,type:Be}=ie.target,pt=Be==="number";o(ke=>({...ke,[ce]:pt?parseFloat(Ee)||0:Ee}))},ht=ie=>{var Ee;ue(ie),o(Be=>({...Be,supplierId:ie||void 0}));const ce=(Ee=H.find(Be=>Be.id===ie))==null?void 0:Ee.name;ce&&r(Be=>({...Be,supplier:ce}))},Tt=ie=>{const{name:ce,value:Ee}=ie.target;Y(Be=>({...Be,[ce]:Ee}))},fs=async ie=>{if(ie.preventDefault(),!O.name.trim()){v("Supplier name is required.");return}ae(!0),v(null);try{const ce=await Ri({name:O.name.trim(),contactEmail:O.email.trim()||void 0});await se(),R("existing"),ue(ce.id),o(Ee=>({...Ee,supplierId:ce.id})),r(Ee=>({...Ee,supplier:ce.name||ce.id})),Y({name:"",email:""})}catch(ce){v(ce instanceof Error?ce.message:"Failed to create supplier.")}finally{ae(!1)}},Bn=async ie=>{if(ie.preventDefault(),a.productName&&a.quantity>0){let ce=[];if(P.size>0&&a.productName){h(!0),v(null);try{const ke=await Promise.all(Array.from(P.entries()).map(async([Pn,_r])=>{const Kl=await Cf(a.productName,Pn,_r,{productId:Z||a.productId||ye(a.productName),source:(D==null?void 0:D.fieldSources.get(Pn))||"manual"});return{field:String(Pn),captureId:Kl,source:(D==null?void 0:D.fieldSources.get(Pn))||"manual",confidence:D==null?void 0:D.fieldConfidences.get(Pn)}})),kt=new Date().toISOString();ce=ke.map(Pn=>({...Pn,capturedAt:kt}))}catch(ke){console.error(ke),v("Could not save scan images.")}finally{h(!1)}}const Ee=D?Array.from(D.fieldConfidences.values()).filter(ke=>typeof ke=="number"):[],Be=Ee.length>0?Ee.reduce((ke,kt)=>ke+kt,0)/Ee.length:void 0,pt=ce.length?{confidence:Be,fieldCaptures:ce}:Be!==void 0?{confidence:Be}:null;d(ke=>[...ke,{...a,productId:Z||a.productId,supplierId:le||a.supplierId,shareScope:he(a.shareScope),scanMetadata:pt}]),o(yx),W(""),ue(""),_(null),J(null),$(!1),M.current&&(M.current.value=""),k(new Map),C.forEach(ke=>URL.revokeObjectURL(ke)),I(new Map)}},ln=()=>{c.length>0&&n.supplier&&n.deliveryDate?(t(n,c),r(Id),d([])):v("Please add at least one item and fill in all batch details (Supplier, Delivery Date).")};return f.jsxs(f.Fragment,{children:[E&&f.jsx(aw,{onDataScanned:ot,onClose:()=>T(!1),productOptions:oe}),f.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-sm p-8 rounded-xl border border-gray-700/50 shadow-2xl",children:[f.jsxs("h2",{className:"text-2xl font-bold mb-6 text-white flex items-center gap-3",children:[f.jsx("div",{className:"p-2 bg-cyan-500/20 rounded-lg",children:f.jsx(Yf,{className:"w-6 h-6 text-cyan-400"})}),"Add New Inventory Batch"]}),f.jsxs("div",{className:"space-y-6 p-6 bg-gray-900/40 border border-gray-700/50 rounded-xl mb-6 backdrop-blur-sm shadow-inner",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx("div",{className:"w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center",children:f.jsx("span",{className:"text-cyan-400 font-bold text-sm",children:"1"})}),f.jsx("h3",{className:"font-bold text-xl text-gray-100",children:"Batch Details"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[f.jsxs("div",{className:"space-y-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700/30",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-semibold text-gray-200 mb-3",children:"Product Selection"}),f.jsx("div",{className:"flex gap-2 mb-4",children:["existing","new"].map(ie=>f.jsx("button",{type:"button",onClick:()=>Ne(ie),className:`flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 ${Re===ie?"bg-gradient-to-r from-cyan-600 to-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:ie==="existing"?"Existing Product":"New Product"},ie))})]}),ne&&Re==="new"&&f.jsx("div",{className:"p-3 bg-amber-500/10 border border-amber-500/40 rounded-lg text-sm text-amber-100",children:"New product detected. Review the static fields below so we can register it in the catalog when this batch is saved."}),Re==="existing"?f.jsx("div",{children:f.jsxs("select",{className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",value:Z,onChange:ie=>{const ce=ie.target.value;if(W(ce),!ce){o(Be=>({...Be,productId:void 0,productName:"",manufacturer:"",category:"",productDescription:""}));return}const Ee=j.find(Be=>Be.id===ce);Ee&&o(Be=>({...Be,productId:Ee.id,productName:Ee.name,manufacturer:Ee.manufacturer,category:Ee.category,productDescription:Ee.description||""}))},children:[f.jsx("option",{value:"",children:"Select from catalog"}),j.map(ie=>f.jsxs("option",{value:ie.id,children:[ie.name,"  ",ie.manufacturer]},ie.id))]})}):f.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:f.jsx("p",{className:"text-sm text-blue-300",children:"Manual entry enabled. Fill in the product fields below to register a new product as you scan it."})})]}),f.jsxs("div",{className:"space-y-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700/30",children:[f.jsx("div",{className:"flex items-center justify-between gap-2 mb-2",children:f.jsx("p",{className:"text-sm font-semibold text-gray-200",children:"Supplier Management"})}),f.jsx("div",{className:"flex gap-2 mb-4",children:["existing","new"].map(ie=>f.jsx("button",{type:"button",onClick:()=>R(ie),className:`flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 ${Ie===ie?"bg-gradient-to-r from-cyan-600 to-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:ie==="existing"?"Choose Supplier":"Create Supplier"},ie))}),Ie==="existing"?f.jsxs("select",{className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",value:le,onChange:ie=>ht(ie.target.value),children:[f.jsx("option",{value:"",children:"Select Supplier"}),H.map(ie=>f.jsx("option",{value:ie.id,children:ie.name},ie.id))]}):f.jsxs("form",{onSubmit:fs,className:"space-y-3",children:[f.jsx("input",{name:"name",value:O.name,onChange:Tt,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",placeholder:"Supplier name"}),f.jsx("input",{type:"email",name:"email",value:O.email,onChange:Tt,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",placeholder:"Contact email (optional)"}),f.jsx("button",{type:"submit",disabled:re,className:"w-full px-4 py-2.5 rounded-lg bg-gradient-to-r from-cyan-600 to-cyan-500 text-white text-sm font-semibold disabled:opacity-60 hover:from-cyan-500 hover:to-cyan-400 transition-all shadow-lg shadow-cyan-500/20",children:re?"Creating...":"Create & Use Supplier"})]})]})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-700/50",children:Object.keys(Id).map(ie=>f.jsxs("div",{children:[f.jsx("label",{htmlFor:`batch-${ie}`,className:"block text-sm font-medium text-gray-300 mb-2 capitalize",children:ie.replace(/([A-Z])/g," $1")}),f.jsx("input",{type:ie.includes("Date")?"date":"text",name:ie,id:`batch-${ie}`,value:n[ie],onChange:$e,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all shadow-sm"})]},ie))})]}),f.jsxs("div",{className:"space-y-6 p-6 bg-gray-900/40 border border-gray-700/50 rounded-xl backdrop-blur-sm shadow-inner",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx("div",{className:"w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center",children:f.jsx("span",{className:"text-cyan-400 font-bold text-sm",children:"2"})}),f.jsx("h3",{className:"font-bold text-xl text-gray-100",children:"Add Items to Batch"})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("div",{className:"flex justify-center px-6 pt-6 pb-6 border-2 border-gray-600/50 border-dashed rounded-xl cursor-pointer hover:border-cyan-400/50 hover:bg-cyan-500/5 transition-all duration-200 group",onClick:()=>{var ie;return(ie=M.current)==null?void 0:ie.click()},children:f.jsxs("div",{className:"space-y-2 text-center",children:[w?f.jsx("img",{src:w,alt:"Preview",className:"mx-auto h-32 w-auto rounded-lg object-cover shadow-lg"}):f.jsx("div",{className:"mx-auto p-4 bg-gray-800/50 rounded-full group-hover:bg-cyan-500/10 transition-all",children:f.jsx(sw,{className:"h-10 w-10 text-gray-400 group-hover:text-cyan-400 transition-colors"})}),f.jsx("p",{className:"text-sm text-gray-400 group-hover:text-cyan-300 transition-colors",children:p?"Analyzing...":"Click to upload image"})]})}),f.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:rt,ref:M,accept:"image/*"}),f.jsxs("button",{type:"button",onClick:()=>T(!0),className:"w-full flex items-center justify-center gap-2 py-3 px-4 border border-gray-600/50 rounded-lg text-sm font-semibold text-gray-200 bg-gray-700/30 hover:bg-gray-700/50 hover:border-cyan-500/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all shadow-sm",children:[f.jsx(Si,{className:"w-5 h-5"}),"Live Scan Item"]})]}),p&&f.jsxs("div",{className:"flex items-center justify-center py-4",children:[f.jsx("div",{className:"animate-spin rounded-full h-7 w-7 border-2 border-cyan-400 border-t-transparent"}),f.jsx("p",{className:"ml-3 text-cyan-400 font-medium",children:"Extracting data..."})]}),x&&f.jsx("div",{className:"p-3 bg-red-900/30 border border-red-700/50 rounded-lg",children:f.jsx("p",{className:"text-red-400 text-sm",children:x})}),f.jsxs("form",{onSubmit:Bn,className:"space-y-5 pt-2",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Product Name"}),f.jsx("input",{name:"productName",value:a.productName,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!Z})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Manufacturer"}),f.jsx("input",{name:"manufacturer",value:a.manufacturer,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!Z})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),f.jsx("input",{name:"category",value:a.category,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",disabled:!!Z})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Expiration Date"}),f.jsx("input",{type:"date",name:"expirationDate",value:a.expirationDate,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Product Description"}),f.jsx("textarea",{name:"productDescription",value:a.productDescription,onChange:ze,rows:3,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white disabled:bg-gray-800/50 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all resize-none",disabled:!!Z})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quantity"}),f.jsx("input",{type:"number",name:"quantity",value:a.quantity,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quantity Type"}),f.jsx("input",{name:"quantityType",value:a.quantityType,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),f.jsx("input",{name:"location",value:a.location,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all"})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Cost Per Unit"}),f.jsx("input",{type:"number",name:"costPerUnit",value:a.costPerUnit,onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Buy Price"}),f.jsx("input",{type:"number",name:"buyPrice",value:a.buyPrice??"",onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Sell Price"}),f.jsx("input",{type:"number",name:"sellPrice",value:a.sellPrice??"",onChange:ze,className:"w-full px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 transition-all",step:"0.01"})]})]}),as&&f.jsxs("div",{className:"p-4 bg-cyan-900/10 border border-cyan-800/40 rounded-lg space-y-2",children:[f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx("input",{id:"dan-sharing",type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-500 text-cyan-500 focus:ring-cyan-400 bg-gray-900",checked:(a.shareScope||[]).includes("dan"),onChange:ie=>V("dan",ie.target.checked)}),f.jsxs("label",{htmlFor:"dan-sharing",className:"text-sm text-gray-200",children:[f.jsx("span",{className:"font-semibold text-cyan-200",children:"Share with DAN network (beta)"}),f.jsx("span",{className:"block text-gray-400",children:"Broadcast anonymized surplus signals (product, quantity, expiration bucket, aisle zone) so trusted partners can discover this offer."})]})]}),f.jsx("p",{className:"text-xs text-gray-500 pl-7",children:"Provenance proofs are signed with your shop key. Disable anytime to keep inventory local-only."})]}),f.jsx("button",{type:"submit",disabled:p,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-indigo-600 to-indigo-500 hover:from-indigo-500 hover:to-indigo-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 disabled:from-gray-600 disabled:to-gray-600 disabled:cursor-not-allowed transition-all shadow-lg shadow-indigo-500/20",children:p?"Saving Scan...":"Add This Item"})]})]}),c.length>0&&f.jsxs("div",{className:"mt-6",children:[f.jsxs("h3",{className:"font-semibold text-lg text-gray-200 mb-2",children:["Items in this Batch (",c.length,")"]}),f.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto p-2 bg-gray-900/50 rounded-md",children:c.map((ie,ce)=>{var Ee;return f.jsxs("li",{className:"text-sm text-gray-300 p-2 bg-gray-700/50 rounded-md flex justify-between items-center gap-3",children:[f.jsxs("span",{children:[ie.quantity,"x ",ie.productName]}),f.jsxs("span",{className:"flex items-center gap-2",children:[f.jsxs("span",{children:["Exp: ",ie.expirationDate]}),((Ee=ie.shareScope)==null?void 0:Ee.includes("dan"))&&f.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border border-cyan-600/40 bg-cyan-900/40 text-cyan-200",children:"DAN"})]})]},ce)})})]}),f.jsx("button",{onClick:ln,disabled:c.length===0,className:"mt-6 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all",children:"Finish and Save Batch"})]})]})},d3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),f.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),f.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),f.jsx("rect",{x:"14",y:"14",width:"7",height:"7"})]}),f3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),f.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),f.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),f.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),f.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),f.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),h3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),f.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),f.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),f.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),f.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),p3=({summaries:t,items:e,batches:n,onAddBatch:r,onDataRefresh:a})=>{const[o,c]=A.useState(null),[d,p]=A.useState("grid"),[h,x]=A.useState("overview"),[v,w]=A.useState(!1),[_,E]=A.useState(null),[T,M]=A.useState(!1),P=A.useRef(null),{showToast:k}=ds(),[C,I]=A.useState(null),[j,B]=A.useState({}),[H,Q]=A.useState(null),[Z,W]=A.useState(null),[le,ue]=A.useState(!1),Re=A.useMemo(()=>t.map($=>({productId:$.productId,productName:$.productName})),[t]),Ne=A.useMemo(()=>{const $=new Date,oe=new Date($.getTime()+10080*60*1e3);return t.filter(he=>{const ye=new Date(he.earliestExpiration);return ye<=oe&&ye>=$})},[t]),Ie=A.useMemo(()=>{const $=new Date;return t.filter(oe=>new Date(oe.earliestExpiration)<$)},[t]);A.useCallback(()=>{a(),k("New product successfully learned and added to catalog!","success")},[a,k]);const R=A.useCallback($=>{w(!1),x("manual"),k("Scan complete! Review and complete the form below.","success")},[k]),O=A.useCallback(()=>{x("overview"),a(),k("Inventory batch added successfully!","success")},[a,k]),Y=A.useCallback(async $=>{var he;const oe=(he=$.target.files)==null?void 0:he[0];if(oe){M(!0),E(null);try{const ye=Hf();if(!ye){k("No active shop context. Please ensure you are logged in.","error"),M(!1);return}const V=new Blob([oe],{type:oe.type}),se=await tw(V,ye);E(se),se.length>0?k(`Found ${se.length} matching items!`,"success"):k("No matching items found in inventory.","info")}catch(ye){k("Visual search failed: "+(ye instanceof Error?ye.message:"Unknown error"),"error")}finally{M(!1),P.current&&(P.current.value="")}}},[k]),re=A.useCallback($=>{if(!$.inventoryUuid){k("This entry was imported without a Qdrant reference and cannot be edited.","error");return}W(null),B({quantity:$.quantity,expirationDate:$.expirationDate,location:$.location||"",costPerUnit:$.costPerUnit,sellPrice:$.sellPrice??void 0}),I($)},[k]),ae=A.useCallback($=>{if(!$.inventoryUuid){k("This entry was imported without a Qdrant reference and cannot be deleted.","error");return}W(null),Q($)},[k]),D=A.useCallback(($,oe)=>{if($==="quantity"||$==="costPerUnit"||$==="sellPrice"){B(he=>({...he,[$]:oe===""?void 0:Number(oe)}));return}B(he=>({...he,[$]:oe}))},[]),J=A.useCallback(async $=>{if($.preventDefault(),!!(C!=null&&C.inventoryUuid)){ue(!0),W(null);try{await Lb(C.inventoryUuid,j),await Promise.resolve(a()),k("Inventory item updated.","success"),I(null)}catch(oe){W(oe instanceof Error?oe.message:"Failed to update inventory item.")}finally{ue(!1)}}},[C,j,a,k]),ne=A.useCallback(async()=>{if(H!=null&&H.inventoryUuid){ue(!0),W(null);try{await qb(H.inventoryUuid),await Promise.resolve(a()),k("Inventory item deleted.","success"),Q(null)}catch($){W($ instanceof Error?$.message:"Failed to delete inventory item.")}finally{ue(!1)}}},[H,a,k]);return f.jsxs(f.Fragment,{children:[o&&f.jsx(c3,{product:o,allItems:e,allBatches:n,onClose:()=>c(null)}),v&&f.jsx(aw,{onDataScanned:R,onClose:()=>w(!1),productOptions:Re}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h1",{className:"text-2xl font-bold text-white",children:"Inventory Management"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:()=>x("overview"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${h==="overview"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Overview"}),f.jsx("button",{onClick:()=>x("scan"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${h==="scan"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Scan Item"}),f.jsx("button",{onClick:()=>x("manual"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${h==="manual"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Manual Entry"})]})]}),(Ne.length>0||Ie.length>0)&&f.jsxs("div",{className:"mt-4 p-4 rounded-lg border-l-4 bg-yellow-900/20 border-yellow-500",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(of,{className:"w-5 h-5 text-yellow-400"}),f.jsxs("h3",{className:"font-semibold text-yellow-300",children:[Ie.length>0&&`${Ie.length} Expired`,Ie.length>0&&Ne.length>0&&"  ",Ne.length>0&&`${Ne.length} Expiring Soon`]})]}),f.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[Ie.slice(0,5).map($=>f.jsxs("span",{className:"px-2 py-1 bg-red-900/50 text-red-300 rounded text-xs",children:[$.productName," (Expired)"]},$.productId)),Ne.slice(0,5).map($=>f.jsxs("span",{className:"px-2 py-1 bg-yellow-900/50 text-yellow-300 rounded text-xs",children:[$.productName," (Expires: ",new Date($.earliestExpiration).toLocaleDateString(),")"]},$.productId))]})]})]}),h==="overview"&&f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[f.jsxs("div",{className:"lg:col-span-4 space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 shadow-lg",children:[f.jsx("h2",{className:"text-xl font-semibold mb-4 text-white",children:"Quick Actions"}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("button",{onClick:()=>w(!0),className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:[f.jsx(Si,{className:"w-6 h-6"}),"Live Scan Item"]}),f.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Use your camera to automatically extract product data"}),f.jsxs("div",{children:[f.jsx("input",{ref:P,type:"file",accept:"image/*",onChange:Y,className:"hidden"}),f.jsxs("button",{onClick:()=>{var $;return($=P.current)==null?void 0:$.click()},disabled:T,className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[f.jsx(Si,{className:"w-6 h-6"}),T?"Searching...":"Visual Search"]}),f.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Upload a product photo to find it in inventory"})]}),f.jsxs("button",{onClick:()=>x("manual"),className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-gray-600 rounded-md shadow-sm text-base font-medium text-gray-200 bg-gray-700/50 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:[f.jsx(h3,{className:"w-6 h-6"}),"Manual Entry"]}),f.jsx("p",{className:"text-xs text-gray-400 text-center px-2",children:"Enter inventory details manually or complete a scan"})]}),_&&_.length>0&&f.jsxs("div",{className:"mt-4 p-4 bg-purple-900/20 border border-purple-700 rounded-lg",children:[f.jsxs("h3",{className:"text-sm font-semibold text-purple-300 mb-2",children:["Visual Search Results (",_.length," found)"]}),f.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:_.map(($,oe)=>f.jsxs("div",{className:"text-xs p-2 bg-gray-900/50 rounded",children:[f.jsxs("p",{className:"text-white font-medium",children:["Product ID: ",$.productId]}),f.jsxs("p",{className:"text-gray-400",children:["Qty: ",$.quantity," | Exp: ",$.expirationDate]})]},oe))}),f.jsx("button",{onClick:()=>E(null),className:"mt-2 text-xs text-purple-400 hover:text-purple-300",children:"Clear results"})]})]}),f.jsx(l3,{items:e,batches:n})]}),f.jsxs("div",{className:"lg:col-span-8 space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Current Inventory"}),f.jsxs("div",{className:"flex items-center p-1 bg-gray-900/50 rounded-lg border border-gray-700",children:[f.jsx("button",{onClick:()=>p("grid"),className:`p-2 rounded-md transition-colors ${d==="grid"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,"aria-label":"Grid view",title:"Grid View",children:f.jsx(d3,{className:"w-5 h-5"})}),f.jsx("button",{onClick:()=>p("table"),className:`p-2 rounded-md transition-colors ${d==="table"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,"aria-label":"Table view",title:"Table View",children:f.jsx(f3,{className:"w-5 h-5"})})]})]}),d==="grid"?f.jsx(a3,{summaries:t,inventoryItems:e,onSelectProduct:c,onEditItem:re,onDeleteItem:ae}):f.jsx(o3,{inventory:e,batches:n,onEditRequest:re,onDeleteRequest:ae})]})]}),h==="scan"&&f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:f.jsxs("div",{className:"text-center space-y-4",children:[f.jsx("h2",{className:"text-2xl font-bold text-white",children:"Live Scan Item"}),f.jsx("p",{className:"text-gray-400",children:"Use your camera to automatically extract product information. You can also draw rectangles on the screen to focus on specific areas."}),f.jsxs("button",{onClick:()=>w(!0),className:"mx-auto flex items-center justify-center gap-3 py-4 px-8 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:[f.jsx(Si,{className:"w-8 h-8"}),"Start Live Scan"]}),f.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"After scanning, you'll be able to review and complete the form with the extracted data."})]})}),h==="manual"&&f.jsx(u3,{onAddBatch:($,oe)=>{r($,oe),O()},summaries:t}),C&&f.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-lg",children:[f.jsxs("div",{className:"flex justify-between items-center border-b border-gray-700 p-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Edit Inventory Item"}),f.jsx("p",{className:"text-sm text-gray-400",children:C.productName})]}),f.jsx("button",{onClick:()=>{I(null),W(null)},className:"text-gray-400 hover:text-white text-2xl leading-5","aria-label":"Close edit item modal",children:""})]}),f.jsxs("form",{onSubmit:J,className:"p-4 space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[f.jsxs("label",{className:"text-sm text-gray-300",children:["Quantity",f.jsx("input",{type:"number",min:0,className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:j.quantity??"",onChange:$=>D("quantity",$.target.value)})]}),f.jsxs("label",{className:"text-sm text-gray-300",children:["Expiration Date",f.jsx("input",{type:"date",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:j.expirationDate??"",onChange:$=>D("expirationDate",$.target.value)})]}),f.jsxs("label",{className:"text-sm text-gray-300",children:["Cost / Unit",f.jsx("input",{type:"number",step:"0.01",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:j.costPerUnit??"",onChange:$=>D("costPerUnit",$.target.value)})]}),f.jsxs("label",{className:"text-sm text-gray-300",children:["Sell Price",f.jsx("input",{type:"number",step:"0.01",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:j.sellPrice??"",onChange:$=>D("sellPrice",$.target.value)})]})]}),f.jsxs("label",{className:"text-sm text-gray-300 block",children:["Location",f.jsx("input",{type:"text",className:"mt-1 w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white",value:j.location??"",onChange:$=>D("location",$.target.value)})]}),Z&&f.jsx("p",{className:"text-sm text-red-400",children:Z}),f.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[f.jsx("button",{type:"button",onClick:()=>{I(null),W(null)},className:"px-4 py-2 rounded-md bg-gray-700 text-white hover:bg-gray-600",children:"Cancel"}),f.jsx("button",{type:"submit",disabled:le,className:"px-4 py-2 rounded-md bg-cyan-600 text-white hover:bg-cyan-500 disabled:opacity-60",children:le?"Saving...":"Save Changes"})]})]})]})}),H&&f.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-md p-6",children:[f.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Delete Inventory Item"}),f.jsxs("p",{className:"text-sm text-gray-300",children:["Are you sure you want to remove ",f.jsx("span",{className:"text-white font-semibold",children:H.productName})," from inventory? This action cannot be undone."]}),Z&&f.jsx("p",{className:"text-sm text-red-400 mt-3",children:Z}),f.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[f.jsx("button",{onClick:()=>{Q(null),W(null)},className:"px-4 py-2 rounded-md bg-gray-700 text-white hover:bg-gray-600",children:"Cancel"}),f.jsx("button",{onClick:ne,disabled:le,className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-500 disabled:opacity-60",children:le?"Deleting...":"Delete"})]})]})})]})]})},lf=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("circle",{cx:"9",cy:"21",r:"1"}),f.jsx("circle",{cx:"20",cy:"21",r:"1"}),f.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"})]}),ow=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),f.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),lw=t=>f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:f.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})}),jl=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("polyline",{points:"3 6 5 6 21 6"}),f.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),f.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),f.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),cw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2"}),f.jsx("path",{d:"M17 3h2a2 2 0 0 1 2 2v2"}),f.jsx("path",{d:"M21 17v2a2 2 0 0 1-2 2h-2"}),f.jsx("path",{d:"M7 21H5a2 2 0 0 1-2-2v-2"}),f.jsx("line",{x1:"7",y1:"12",x2:"17",y2:"12"})]}),m3=({summaries:t,onProductScanned:e,onClose:n})=>{const r=A.useRef(null),a=A.useRef(null),o=A.useRef(null),[c,d]=A.useState("SCANNING"),[p,h]=A.useState(null),[x,v]=A.useState(null),w=A.useMemo(()=>t.map(k=>k.productName),[t]),_=A.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=null)},[]),E=A.useCallback(async()=>{if(!r.current||!a.current||document.hidden)return;const k=r.current,C=a.current;C.width=k.videoWidth,C.height=k.videoHeight;const I=C.getContext("2d");I&&(I.drawImage(k,0,0,k.videoWidth,k.videoHeight),C.toBlob(async j=>{if(j&&o.current)try{const B=await Qf(j,w);B?(h(B),d("DETECTED"),e(B),_(),setTimeout(()=>{d("SCANNING"),h(null),o.current=window.setInterval(E,2e3)},2500)):d("NO_PRODUCT")}catch(B){console.warn("Scan failed:",B),d("ERROR")}},"image/jpeg",.8))},[w,e,_]);A.useEffect(()=>{let k=null;return(async()=>{try{k=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),r.current&&(r.current.srcObject=k),_(),o.current=window.setInterval(E,2e3)}catch(I){console.error("Error accessing camera:",I),v("Could not access the camera. Please ensure permissions are granted."),d("ERROR")}})(),()=>{_(),k&&k.getTracks().forEach(I=>I.stop())}},[E,_]);const T=()=>{switch(c){case"SCANNING":return{message:"Point camera at a product",color:"border-gray-500"};case"DETECTED":return{message:`${p} added to cart!`,color:"border-green-500 animate-pulse-border"};case"NO_PRODUCT":return{message:"Searching for product...",color:"border-yellow-500"};case"ERROR":return{message:"Scanner error. Please try again.",color:"border-red-500"};default:return{message:"",color:"border-transparent"}}},{message:M,color:P}=T();return f.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center","aria-modal":"true",children:[f.jsx("style",{children:`
            @keyframes pulse-border {
                0%, 100% { box-shadow: 0 0 0 0 rgba(4, 120, 87, 0.7); }
                50% { box-shadow: 0 0 0 10px rgba(4, 120, 87, 0); }
            }
            .animate-pulse-border {
                animation: pulse-border 1.5s infinite;
            }
        `}),f.jsxs("div",{className:`relative w-full max-w-4xl aspect-video bg-black rounded-lg overflow-hidden border-4 ${P} transition-all`,children:[f.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),f.jsx("canvas",{ref:a,className:"hidden"})]}),f.jsxs("div",{className:"mt-4 text-center",children:[f.jsx("p",{className:"text-white text-lg font-semibold",children:M}),x&&f.jsx("p",{className:"text-red-400 text-sm mt-1",children:x})]}),f.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/80 transition-colors z-30","aria-label":"Close scanner",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),f.jsx("button",{onClick:n,className:"mt-8 px-8 py-3 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition-colors shadow-lg",children:"Done Scanning"})]})},xx=1.4,g3=({summaries:t,onPurchase:e})=>{const[n,r]=A.useState([]),[a,o]=A.useState(!1),[c,d]=A.useState("All"),[p,h]=A.useState(!1),x=A.useMemo(()=>t.map(I=>({...I,price:I.averageCostPerUnit*xx})).filter(I=>c==="All"?!0:I.category===c),[t,c]),v=A.useMemo(()=>{const I=new Set(t.map(j=>j.category));return["All",...Array.from(I)]},[t]),w=I=>{r(j=>{const B=j.find(H=>H.productName===I.productName);if(B){const H=P(I.productName);return B.quantity>=H?j:j.map(Q=>Q.productName===I.productName?{...Q,quantity:Q.quantity+1}:Q)}return[...j,{productName:I.productName,quantity:1,price:I.price}]})},_=(I,j)=>{r(B=>B.map(Q=>Q.productName===I?{...Q,quantity:Q.quantity+j}:Q).filter(Q=>Q.quantity>0))},E=I=>{r(j=>j.filter(B=>B.productName!==I))},T=A.useMemo(()=>n.reduce((I,j)=>I+j.price*j.quantity,0),[n]),M=()=>{e(n.map(({productName:I,quantity:j})=>({productName:I,quantity:j}))),r([]),o(!0),setTimeout(()=>o(!1),4e3)},P=I=>{var j;return((j=t.find(B=>B.productName===I))==null?void 0:j.totalQuantity)||0},k=I=>{var j;return((j=n.find(B=>B.productName===I))==null?void 0:j.quantity)||0},C=I=>{const j=t.find(B=>B.productName===I);if(j){const B={...j,price:j.averageCostPerUnit*xx};w(B)}};return f.jsxs(f.Fragment,{children:[p&&f.jsx(m3,{summaries:t,onProductScanned:C,onClose:()=>h(!1)}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"lg:col-span-2",children:[f.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4",children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Welcome to the Kiosk"}),f.jsxs("button",{onClick:()=>h(!0),className:"flex items-center justify-center gap-2 py-2 px-4 border border-cyan-600 rounded-md shadow-sm text-sm font-medium text-cyan-400 bg-cyan-900/30 hover:bg-cyan-900/60 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:[f.jsx(cw,{className:"w-5 h-5"}),"Scan Item to Add"]})]}),f.jsx("div",{className:"mb-6",children:f.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(I=>f.jsx("button",{onClick:()=>d(I),className:`px-4 py-2 text-sm font-medium rounded-full transition-colors ${c===I?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:I},I))})}),x.length===0?f.jsx("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 text-center text-gray-400",children:f.jsx("p",{children:"There are no products available in this category. Please check back later."})}):f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:x.map(I=>{const j=k(I.productName),B=I.totalQuantity,H=j<B;return f.jsxs("div",{className:"bg-gray-800/50 rounded-lg border border-gray-700 overflow-hidden flex flex-col",children:[f.jsxs("div",{className:"p-4 flex-grow",children:[f.jsx("div",{className:"flex justify-center items-center h-24 w-24 bg-gray-700/50 rounded-lg mx-auto mb-4",children:f.jsx(Zb,{className:"w-12 h-12 text-gray-500"})}),f.jsx("h3",{className:"font-semibold text-white truncate",children:I.productName}),f.jsx("p",{className:"text-sm text-gray-400 mb-2 truncate",children:I.manufacturer}),f.jsxs("p",{className:"text-xl font-bold text-cyan-400",children:["$",I.price.toFixed(2)]})]}),f.jsx("div",{className:"p-4 bg-gray-900/50",children:f.jsxs("button",{onClick:()=>w(I),disabled:!H,className:"w-full flex items-center justify-center gap-2 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all disabled:bg-gray-600 disabled:cursor-not-allowed",children:[f.jsx(lf,{className:"w-5 h-5"}),H?"Add to Cart":"Out of Stock"]})})]},I.productName)})})]}),f.jsx("div",{className:"lg:col-span-1",children:f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700 sticky top-28",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(lf,{className:"w-6 h-6 text-cyan-400"}),"Your Cart"]}),a&&f.jsxs("div",{className:"bg-green-800/50 border border-green-600 text-green-300 p-4 rounded-lg mb-4 text-center",children:[f.jsx("h3",{className:"font-bold",children:"Purchase Successful!"}),f.jsx("p",{className:"text-sm",children:"Thank you for your order."})]}),n.length>0?f.jsxs("div",{className:"space-y-4",children:[f.jsx("ul",{className:"space-y-3 max-h-80 overflow-y-auto pr-2 -mr-2",children:n.map(I=>f.jsxs("li",{className:"flex items-center gap-4 text-sm",children:[f.jsxs("div",{className:"flex-grow",children:[f.jsx("p",{className:"font-medium text-white truncate",children:I.productName}),f.jsxs("p",{className:"text-gray-400",children:["$",I.price.toFixed(2)]})]}),f.jsxs("div",{className:"flex items-center gap-1 bg-gray-700/50 rounded-md",children:[f.jsx("button",{onClick:()=>_(I.productName,-1),className:"p-1 text-gray-300 hover:text-white",children:f.jsx(lw,{className:"w-4 h-4"})}),f.jsx("span",{className:"font-bold text-white px-1",children:I.quantity}),f.jsx("button",{onClick:()=>_(I.productName,1),disabled:I.quantity>=P(I.productName),className:"p-1 text-gray-300 hover:text-white disabled:text-gray-600",children:f.jsx(ow,{className:"w-4 h-4"})})]}),f.jsx("button",{onClick:()=>E(I.productName),className:"p-1 text-gray-400 hover:text-red-400",children:f.jsx(jl,{className:"w-4 h-4"})})]},I.productName))}),f.jsxs("div",{className:"border-t border-gray-700 pt-4 space-y-4",children:[f.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[f.jsx("span",{className:"text-gray-300",children:"Total:"}),f.jsxs("span",{className:"text-white",children:["$",T.toFixed(2)]})]}),f.jsx("button",{onClick:M,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Checkout"})]})]}):f.jsx("p",{className:"text-center text-gray-500 py-8",children:"Your cart is empty."})]})})]})]})},y3=({summaries:t,onClose:e,onListProduct:n})=>{const[r,a]=A.useState(""),[o,c]=A.useState(1),[d,p]=A.useState(0),[h,x]=A.useState(""),v=t.find(E=>E.productName===r),w=(v==null?void 0:v.totalQuantity)||0,_=E=>{if(E.preventDefault(),x(""),!r||o<=0||d<=0){x("Please fill all fields with valid values.");return}if(o>w){x(`Quantity cannot exceed available stock of ${w}.`);return}n(r,o,d)};return f.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-center justify-center p-4",onClick:e,children:f.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-2xl w-full max-w-lg",onClick:E=>E.stopPropagation(),children:[f.jsxs("div",{className:"p-6 border-b border-gray-700 flex justify-between items-center",children:[f.jsx("h2",{className:"text-2xl font-bold text-white",children:"List Product on Marketplace"}),f.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f.jsxs("form",{onSubmit:_,className:"p-6 space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"product",className:"block text-sm font-medium text-gray-300",children:"Product"}),f.jsxs("select",{id:"product",value:r,onChange:E=>a(E.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm",children:[f.jsx("option",{value:"",children:"Select a product..."}),t.map(E=>f.jsxs("option",{value:E.productName,children:[E.productName," (In Stock: ",E.totalQuantity,")"]},E.productName))]})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-300",children:"Quantity to List"}),f.jsx("input",{type:"number",id:"quantity",value:o,onChange:E=>c(Math.max(1,parseInt(E.target.value)||1)),min:"1",max:w,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm"})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-300",children:"Price per Unit ($)"}),f.jsx("input",{type:"number",id:"price",value:d,onChange:E=>p(parseFloat(E.target.value)||0),min:"0.01",step:"0.01",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm"})]}),h&&f.jsx("p",{className:"text-red-400 text-sm",children:h}),f.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[f.jsx("button",{type:"button",onClick:e,className:"py-2 px-4 border border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-300 bg-gray-700/50 hover:bg-gray-700",children:"Cancel"}),f.jsx("button",{type:"submit",className:"py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700",children:"List Product"})]})]})]})})},x3=({summaries:t,user:e,onPurchase:n})=>{const[r,a]=A.useState([]),[o,c]=A.useState([]),[d,p]=A.useState(!0),[h,x]=A.useState(null),[v,w]=A.useState(!1),[_,E]=A.useState("peer"),[T,M]=A.useState([]),[P,k]=A.useState(!1),[C,I]=A.useState(null),j=A.useCallback(async()=>{if(!e.isVerified){p(!1);return}p(!0),x(null);try{const[W,le]=await Promise.all([gD(e),vv()]);a(W),c(le)}catch(W){x(W instanceof Error?W.message:"Failed to load marketplace data.")}finally{p(!1)}},[e]),B=A.useCallback(async()=>{if(as){k(!0),I(null);try{const W=await jb();M(W)}catch(W){I(W instanceof Error?W.message:"Failed to load DAN offers.")}finally{k(!1)}}},[]);A.useEffect(()=>{j()},[j]),A.useEffect(()=>{as&&_==="dan"&&B()},[_,B]);const H=async(W,le,ue)=>{if(!t.find(Ie=>Ie.productName===W))return;const Ne=W.toLowerCase().replace(/ /g,"-");await xv({productId:Ne,productName:W,quantity:le,price:ue}),w(!1),j()},Q=W=>{alert(`Signal sent! Coordinate with ${W.shopName||W.shopId} to fulfill ${W.productName}.`)},Z=W=>{const le=prompt(`How many units of ${W.productName} would you like to buy? (Available: ${W.quantity})`,"1");if(le){const ue=parseInt(le,10);!isNaN(ue)&&ue>0&&ue<=W.quantity?(n(W,ue),alert(`Successfully purchased ${ue} ${W.productName}! It has been added to your inventory.`)):alert("Invalid quantity entered.")}};return e.isVerified?f.jsxs(f.Fragment,{children:[v&&f.jsx(y3,{summaries:t,onClose:()=>w(!1),onListProduct:H}),f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Marketplace"}),f.jsx("p",{className:"text-lg text-gray-400",children:"Buy and sell inventory with other verified shops in the network."})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[f.jsx("div",{className:"lg:col-span-4",children:f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"My Listings"}),f.jsx("button",{onClick:()=>w(!0),className:"w-full text-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:"List a Product"}),f.jsx("div",{className:"mt-4 space-y-3 max-h-96 overflow-y-auto",children:o.length>0?o.map(W=>f.jsxs("div",{className:"p-3 bg-gray-900/50 rounded-md text-sm",children:[f.jsx("p",{className:"font-semibold text-white",children:W.productName}),f.jsxs("p",{className:"text-gray-400",children:[W.quantity," units at $",W.price.toFixed(2),"/each"]})]},W.id)):f.jsx("p",{className:"text-center text-gray-500 py-4",children:"You haven't listed any products."})})]})}),f.jsx("div",{className:"lg:col-span-8",children:f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:_==="dan"?"DAN Offers":"Peer Offerings"}),as&&f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>E("peer"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${_==="peer"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Peer Network"}),f.jsx("button",{onClick:()=>E("dan"),className:`px-4 py-2 rounded-md text-sm font-semibold transition ${_==="dan"?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"DAN Offers Only"})]})]}),_==="peer"&&f.jsxs(f.Fragment,{children:[d&&f.jsx("p",{className:"text-cyan-400 mt-4",children:"Loading peer listings..."}),h&&f.jsx("p",{className:"text-red-400 mt-4",children:h}),!d&&!h&&f.jsx("div",{className:"space-y-6 mt-4",children:r.map(W=>f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-bold text-cyan-400",children:W.name}),f.jsx("div",{className:"mt-2 divide-y divide-gray-700 border-t border-b border-gray-700",children:W.listings.map(le=>f.jsxs("div",{className:"p-3 grid grid-cols-1 md:grid-cols-4 gap-4 items-center",children:[f.jsxs("div",{children:[f.jsx("p",{className:"font-semibold text-white",children:le.productName}),f.jsx("p",{className:"text-xs text-gray-400",children:le.manufacturer})]}),f.jsx("div",{className:"text-sm",children:f.jsxs("p",{className:"text-gray-300",children:[le.quantity," ",le.quantityType]})}),f.jsx("div",{className:"text-sm font-bold",children:f.jsxs("p",{className:"text-white",children:["$",le.price.toFixed(2)]})}),f.jsx("div",{children:f.jsx("button",{onClick:()=>Z(le),className:"w-full md:w-auto text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-cyan-500 transition-all",children:"Buy"})})]},le.listingId))})]},W.id))})]}),_==="dan"&&as&&f.jsxs("div",{className:"mt-4 space-y-4",children:[P&&f.jsx("p",{className:"text-indigo-300",children:"Syncing DAN offers..."}),C&&f.jsx("p",{className:"text-red-400",children:C}),!P&&!C&&f.jsx(f.Fragment,{children:T.filter(W=>W.shopId!==(e.shopId||e.clientId)).length===0?f.jsx("p",{className:"text-gray-400",children:"No external DAN offers yet. Encourage peers to opt-in sharing from Inventory > Manual Entry."}):f.jsx("div",{className:"grid grid-cols-1 gap-4",children:T.filter(W=>W.shopId!==(e.shopId||e.clientId)).map(W=>{var le;return f.jsxs("div",{className:"p-4 rounded-lg border border-gray-700 bg-gray-900/40",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-lg font-semibold text-white",children:W.productName}),f.jsxs("p",{className:"text-xs text-gray-400",children:["From ",W.shopName||W.shopId]})]}),f.jsx("span",{className:"text-xs px-2 py-1 rounded-full border border-indigo-400 text-indigo-300",children:"DAN"})]}),f.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-3 text-sm text-gray-300",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Quantity"}),f.jsxs("p",{children:[W.quantity," units"]})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Expires"}),f.jsx("p",{children:new Date(W.expirationDate).toLocaleDateString()})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Aisle Zone"}),f.jsx("p",{children:W.locationBucket||"Hidden"})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-400 text-xs uppercase",children:"Signal Hash"}),f.jsx("p",{className:"font-mono text-xs",children:((le=W.proofHash)==null?void 0:le.slice(0,12))??""})]})]}),f.jsxs("div",{className:"mt-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[f.jsx("div",{className:"text-sm text-gray-400",children:W.sellPrice?`Listed at $${W.sellPrice.toFixed(2)} / unit`:"Price shared privately"}),f.jsx("button",{onClick:()=>Q(W),className:"w-full md:w-auto text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:"Signal Interest"})]})]},W.inventoryUuid)})})})]})]})})]})]})]}):f.jsxs("div",{className:"text-center bg-gray-800/50 p-12 rounded-lg border border-gray-700",children:[f.jsx("h1",{className:"text-2xl font-bold text-yellow-400",children:"Verification Pending"}),f.jsx("p",{className:"text-lg text-gray-400 mt-2",children:"Your shop is awaiting verification by the network admin."}),f.jsx("p",{className:"text-gray-500 mt-4",children:"Once verified, you will be able to access the peer-to-peer marketplace here."}),f.jsx("p",{className:"text-gray-500 mt-1",children:'Navigate to the "Backend" tab to simulate the admin view and verify this shop.'})]})},v3=()=>{const[t,e]=A.useState([]),[n,r]=A.useState([]),[a,o]=A.useState([]),[c,d]=A.useState([]),[p,h]=A.useState(!0),[x,v]=A.useState(new Date),w=A.useCallback(async()=>{h(!0);const[T,M,P,k]=await Promise.all([cD(),uD(),dD(),fD()]);e(T),r(M),o(P),d(k),h(!1)},[]);A.useEffect(()=>{w()},[w,x]);const _=async T=>{await hD(T),v(new Date)},E=async T=>{await pD(T),v(new Date)};return f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-3xl font-bold text-white",children:"Backend Admin Panel"}),f.jsx("p",{className:"text-lg text-gray-400",children:"Simulated proxy server for verifying new shops and drivers."})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white",children:["Pending Shop Verifications (",t.length,")"]}),f.jsx("button",{onClick:()=>v(new Date),className:"text-sm text-cyan-400 hover:text-cyan-300",children:"Refresh"})]}),p?f.jsx("p",{className:"text-center text-gray-400",children:"Loading..."}):t.length===0?f.jsx("p",{className:"text-center text-gray-500 py-8",children:"No shops are awaiting verification."}):f.jsx(yl,{users:t,onVerify:_})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4",children:["Pending Driver Verifications (",a.length,")"]}),p?f.jsx("p",{className:"text-center text-gray-400",children:"Loading..."}):a.length===0?f.jsx("p",{className:"text-center text-gray-500 py-8",children:"No drivers are awaiting verification."}):f.jsx(yl,{users:a,onVerify:E,isDriverTable:!0})]}),f.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-lg border border-gray-700",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Active Network Participants"}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("h3",{className:"text-lg font-semibold text-cyan-400",children:["Verified Shops (",n.length,")"]}),n.length>0?f.jsx(yl,{users:n}):f.jsx("p",{className:"text-gray-500 text-sm",children:"No verified shops."}),f.jsxs("h3",{className:"text-lg font-semibold text-cyan-400 mt-6",children:["Verified Drivers (",c.length,")"]}),c.length>0?f.jsx(yl,{users:c,isDriverTable:!0}):f.jsx("p",{className:"text-gray-500 text-sm",children:"No verified drivers."})]})]}),f.jsxs("div",{className:"mt-6 p-4 bg-gray-900/50 rounded-lg border border-cyan-800/50",children:[f.jsx("h4",{className:"font-semibold text-cyan-500",children:"How this simulation works:"}),f.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'When a new user registers, they appear in the appropriate "Pending" list. Clicking "Verify" updates a shared `localStorage` value. The main application is continuously polling for this change. Once it detects it has been verified, it will automatically unlock the relevant features (Marketplace, Orders, or Driver panel).'})]})]})},yl=({users:t,onVerify:e,isDriverTable:n})=>f.jsx("div",{className:"overflow-x-auto",children:f.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[f.jsx("thead",{className:"bg-gray-800",children:f.jsxs("tr",{children:[f.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-300 sm:pl-6",children:n?"Name":"Company"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Email"}),f.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-300",children:"Client ID"}),e&&f.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:f.jsx("span",{className:"sr-only",children:"Verify"})})]})}),f.jsx("tbody",{className:"divide-y divide-gray-700 bg-gray-900/50",children:t.map(r=>f.jsxs("tr",{children:[f.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-6",children:r.companyName}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-400",children:r.email}),f.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500 font-mono text-xs",children:r.clientId}),e&&f.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:f.jsx("button",{onClick:()=>e(r.clientId),className:"py-1 px-3 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-green-600 hover:bg-green-700",children:"Verify"})})]},r.clientId))})]})}),uw=A.createContext(void 0),b3=({children:t})=>{const[e,n]=A.useState(()=>{if(typeof window<"u"){const r=sessionStorage.getItem("current_shop");return r?JSON.parse(r):null}return null});return A.useEffect(()=>{typeof window<"u"&&(e?sessionStorage.setItem("current_shop",JSON.stringify(e)):sessionStorage.removeItem("current_shop"))},[e]),f.jsx(uw.Provider,{value:{currentShop:e,setCurrentShop:n},children:t})},Xf=()=>{const t=A.useContext(uw);if(t===void 0)throw new Error("useShopContext must be used within a ShopContextProvider");return t},dw=A.createContext(void 0),w3=({children:t,initialCustomer:e})=>{const[n,r]=A.useState(()=>{if(e)return e;if(typeof window<"u"){const c=sessionStorage.getItem("customer_profile");return c?JSON.parse(c):null}return null});A.useEffect(()=>{e&&r(c=>(c==null?void 0:c.user.clientId)===e.user.clientId?c:e)},[e]),A.useEffect(()=>{typeof window<"u"&&(n?sessionStorage.setItem("customer_profile",JSON.stringify(n)):sessionStorage.removeItem("customer_profile"))},[n]);const a=c=>{r(c)},o=()=>{r(null)};return f.jsx(dw.Provider,{value:{customer:n,setCustomer:a,clearCustomer:o},children:t})},fw=()=>{const t=A.useContext(dw);if(t===void 0)throw new Error("useCustomerContext must be used within a CustomerContextProvider");return t},vx=({onShopSelected:t})=>{const{currentShop:e,setCurrentShop:n}=Xf(),[r,a]=A.useState([]),[o,c]=A.useState(!0),[d,p]=A.useState(!1),[h,x]=A.useState(""),{showToast:v}=ds();A.useEffect(()=>{w()},[]);const w=async()=>{try{c(!0);const T=await fv();a(T)}catch(T){console.error("Failed to load shops:",T),v("Failed to load shops","error")}finally{c(!1)}},_=T=>{n(T),v(`Selected shop: ${T.name}`,"success"),t&&t()},E=async()=>{if(!h.trim()){v("Please enter a shop ID","error");return}try{const T=await hv(h.trim());T?(_(T),x(""),p(!1)):v("Shop not found. Please check the QR code.","error")}catch(T){console.error("Error validating shop:",T),v("Failed to validate shop","error")}};return e?f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-white",children:"Current Shop"}),f.jsx("p",{className:"text-gray-300",children:e.name})]}),f.jsx("button",{onClick:()=>n(null),className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Change Shop"})]})}):f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Select a Shop"}),f.jsxs("div",{className:"mb-6",children:[f.jsxs("button",{onClick:()=>p(!d),className:"w-full flex items-center justify-center gap-3 py-3 px-6 border border-transparent rounded-lg shadow-lg text-base font-semibold text-white bg-cyan-600 hover:bg-cyan-700 transition-all mb-4",children:[f.jsx(cw,{className:"w-5 h-5"}),d?"Hide QR Scanner":"Scan Shop QR Code"]}),d&&f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4",children:[f.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Enter shop ID from QR code:"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"text",value:h,onChange:T=>x(T.target.value),onKeyPress:T=>T.key==="Enter"&&E(),placeholder:"Shop ID",className:"flex-1 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsx("button",{onClick:E,className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold transition",children:"Go"})]})]})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Or Browse Shops"}),o?f.jsxs("div",{className:"text-center py-8",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400 mx-auto"}),f.jsx("p",{className:"text-gray-400 mt-2",children:"Loading shops..."})]}):r.length===0?f.jsx("div",{className:"text-center py-8",children:f.jsx("p",{className:"text-gray-400",children:"No shops available"})}):f.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:r.map(T=>f.jsxs("button",{onClick:()=>_(T),className:"w-full text-left px-4 py-3 bg-gray-900/50 border border-gray-700 rounded-lg hover:bg-gray-900 hover:border-cyan-600 transition text-white",children:[f.jsx("div",{className:"font-semibold",children:T.name}),T.contactEmail&&f.jsx("div",{className:"text-sm text-gray-400",children:T.contactEmail})]},T.id))})]})]})},hw=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),f.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),_3=({cart:t,totalPrice:e,shopId:n,customerId:r,onComplete:a,onCancel:o})=>{const[c,d]=A.useState(!1),[p,h]=A.useState(!1),{showToast:x}=ds(),v=async()=>{try{d(!0);const w=await Yl(),_=new Map(w.map(T=>[T.productName,{id:T.productId,name:T.productName}])),E=t.map(T=>({productName:T.productName,quantity:T.quantity}));Oa({id:n,name:null,contactEmail:null,location:null,qdrantNamespace:null});try{await Gf(E,_)}finally{Oa(null)}h(!0),x("Purchase completed successfully!","success"),setTimeout(()=>{a()},2e3)}catch(w){console.error("Purchase error:",w),x("Purchase failed: "+(w instanceof Error?w.message:"Unknown error"),"error"),d(!1)}};return p?f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:[f.jsx(hw,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),f.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Purchase Complete!"}),f.jsx("p",{className:"text-gray-400",children:"Thank you for your purchase"})]}):f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Checkout"}),f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4 mb-4",children:[f.jsx("h3",{className:"font-semibold text-white mb-3",children:"Order Summary"}),f.jsx("div",{className:"space-y-2",children:t.map(w=>f.jsxs("div",{className:"flex justify-between text-sm",children:[f.jsxs("span",{className:"text-gray-300",children:[w.productName," x ",w.quantity]}),f.jsxs("span",{className:"text-white font-semibold",children:["$",(w.price*w.quantity).toFixed(2)]})]},w.productId))}),f.jsxs("div",{className:"border-t border-gray-700 mt-3 pt-3 flex justify-between",children:[f.jsx("span",{className:"text-lg font-semibold text-white",children:"Total"}),f.jsxs("span",{className:"text-xl font-bold text-cyan-400",children:["$",e.toFixed(2)]})]})]}),f.jsxs("div",{className:"mb-4",children:[f.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Payment Method"}),f.jsx("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-3",children:f.jsx("p",{className:"text-gray-300 text-sm",children:"Cash / Card at pickup"})})]}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("button",{onClick:o,disabled:c,className:"flex-1 py-3 px-4 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition disabled:opacity-50",children:"Cancel"}),f.jsx("button",{onClick:v,disabled:c,className:"flex-1 py-3 px-4 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition disabled:opacity-50",children:c?"Processing...":"Complete Purchase"})]})]})},S3=({cart:t,onUpdateQuantity:e,onRemoveItem:n,totalPrice:r,shopId:a,onPurchaseComplete:o})=>{const{customer:c}=fw(),[d,p]=A.useState(!1);return d?f.jsx(_3,{cart:t,totalPrice:r,shopId:a,customerId:(c==null?void 0:c.user.customerId)||(c==null?void 0:c.user.clientId),onComplete:o,onCancel:()=>p(!1)}):f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 sticky top-4",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(lf,{className:"w-6 h-6 text-cyan-400"}),f.jsx("h2",{className:"text-xl font-bold text-white",children:"Cart"}),t.length>0&&f.jsx("span",{className:"bg-cyan-600 text-white text-xs font-semibold px-2 py-1 rounded-full",children:t.length})]}),t.length===0?f.jsxs("div",{className:"text-center py-8",children:[f.jsx("p",{className:"text-gray-400",children:"Your cart is empty"}),f.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Add items to get started"})]}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto mb-4",children:t.map(h=>f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-3",children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"font-semibold text-white text-sm",children:h.productName}),f.jsxs("p",{className:"text-xs text-gray-400",children:["$",h.price.toFixed(2)," each"]})]}),f.jsx("button",{onClick:()=>n(h.productId),className:"text-gray-400 hover:text-red-400 transition","aria-label":"Remove item",children:f.jsx(jl,{className:"w-4 h-4"})})]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:()=>e(h.productId,-1),className:"p-1 bg-gray-700 hover:bg-gray-600 rounded text-white transition","aria-label":"Decrease quantity",children:f.jsx(lw,{className:"w-4 h-4"})}),f.jsx("span",{className:"text-white font-semibold w-8 text-center",children:h.quantity}),f.jsx("button",{onClick:()=>e(h.productId,1),className:"p-1 bg-gray-700 hover:bg-gray-600 rounded text-white transition","aria-label":"Increase quantity",children:f.jsx(ow,{className:"w-4 h-4"})})]}),f.jsxs("p",{className:"text-cyan-400 font-semibold",children:["$",(h.price*h.quantity).toFixed(2)]})]})]},h.productId))}),f.jsxs("div",{className:"border-t border-gray-700 pt-4 space-y-3",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("span",{className:"text-lg font-semibold text-white",children:"Total"}),f.jsxs("span",{className:"text-2xl font-bold text-cyan-400",children:["$",r.toFixed(2)]})]}),f.jsx("button",{onClick:()=>{if(!c){alert("Please log in to checkout");return}p(!0)},className:"w-full py-3 px-4 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg transition",children:c?"Checkout":"Login to Checkout"})]})]})]})},E3=({products:t,onClose:e,onMatch:n})=>{const r=A.useRef(null),a=A.useRef(null),[o,c]=A.useState(null),[d,p]=A.useState(!1),[h,x]=A.useState("Align the product and tap capture to search."),v=A.useMemo(()=>new Map(t.map(E=>[E.name,E])),[t]),w=A.useMemo(()=>t.map(E=>E.name),[t]);A.useEffect(()=>{let E=null;return(async()=>{try{E=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),r.current&&(r.current.srcObject=E,await r.current.play())}catch{c("Unable to access camera. Please grant permission or try a different device.")}})(),()=>{E&&E.getTracks().forEach(M=>M.stop())}},[]);const _=async()=>{if(!(!r.current||!a.current||w.length===0)){p(!0),x("Analyzing photo...");try{const E=r.current,T=a.current;T.width=E.videoWidth,T.height=E.videoHeight;const M=T.getContext("2d");if(!M)throw new Error("Camera unavailable");M.drawImage(E,0,0,E.videoWidth,E.videoHeight);const P=await new Promise(C=>T.toBlob(C,"image/jpeg",.85));if(!P)throw new Error("Failed to capture photo");const k=await Qf(P,w);if(k){const C=v.get(k)||null;x(C?`Matched ${C.name}`:"No matching product found."),n(C),e()}else x("No matching product found. Try again."),n(null)}catch(E){c(E instanceof Error?E.message:"Failed to analyze photo.")}finally{p(!1)}}};return f.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4","aria-modal":"true",children:f.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 w-full max-w-xl overflow-hidden",children:[f.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-800",children:[f.jsx("h2",{className:"text-white text-lg font-semibold",children:"Scan Product"}),f.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white text-2xl leading-5","aria-label":"Close scanner",children:""})]}),f.jsxs("div",{className:"p-4 space-y-4",children:[o&&f.jsx("p",{className:"text-sm text-red-400 bg-red-900/20 p-2 rounded",children:o}),f.jsxs("div",{className:"relative aspect-[4/3] bg-black rounded-lg overflow-hidden",children:[f.jsx("video",{ref:r,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0,muted:!0,autoPlay:!0}),f.jsx("canvas",{ref:a,className:"hidden"})]}),f.jsx("p",{className:"text-sm text-gray-300",children:h}),f.jsx("button",{onClick:_,disabled:d,className:"w-full py-3 rounded-lg bg-cyan-600 text-white font-semibold hover:bg-cyan-500 disabled:opacity-60",children:d?"Scanning...":"Capture & Search"})]})]})})},T3=()=>{const{currentShop:t,setCurrentShop:e}=Xf(),[n,r]=A.useState([]),[a,o]=A.useState([]),[c,d]=A.useState([]),[p,h]=A.useState(!0),{showToast:x}=ds();A.useEffect(()=>{t&&v()},[t]);const v=async()=>{if(t)try{h(!0);const k=(await gv(t.id)).filter(I=>I.quantity>0&&(!I.status||I.status==="ACTIVE"));r(k);const C=await Yl();o(C)}catch(P){console.error("Failed to load inventory:",P),x("Failed to load inventory","error")}finally{h(!1)}},w=P=>{const k=a.find(C=>C.productId===P);return(k==null?void 0:k.productName)||"Unknown Product"},_=P=>{const k=w(P.productId),C=c.find(I=>I.productId===P.productId);if(C)C.quantity<P.quantity?(d(c.map(I=>I.productId===P.productId?{...I,quantity:I.quantity+1}:I)),x(`Added ${k} to cart`,"success")):x(`Only ${P.quantity} available`,"warning");else{const I=P.sellPrice||P.costPerUnit*1.4;d([...c,{productId:P.productId,productName:k,quantity:1,price:I,stockItem:P}]),x(`Added ${k} to cart`,"success")}},E=(P,k)=>{d(c.map(C=>{if(C.productId===P){const I=C.quantity+k,j=C.stockItem.quantity;return I<=0?null:I>j?(x(`Only ${j} available`,"warning"),C):{...C,quantity:I}}return C}).filter(Boolean))},T=P=>{d(c.filter(k=>k.productId!==P))};if(!t)return f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-gray-400",children:"Please select a shop to start shopping"})});const M=c.reduce((P,k)=>P+k.price*k.quantity,0);return f.jsxs("div",{className:"space-y-6",children:[f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold text-white",children:t.name}),t.contactEmail&&f.jsx("p",{className:"text-gray-400 text-sm",children:t.contactEmail})]}),f.jsx("button",{onClick:()=>{e(null),d([])},className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition whitespace-nowrap",children:"Change Shop"})]})}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx("div",{className:"lg:col-span-2",children:f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Available Products"}),p?f.jsxs("div",{className:"text-center py-12",children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto"}),f.jsx("p",{className:"text-gray-400 mt-4",children:"Loading inventory..."})]}):n.length===0?f.jsx("div",{className:"text-center py-12",children:f.jsx("p",{className:"text-gray-400",children:"No products available at this shop"})}):f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(P=>{const k=w(P.productId),C=P.sellPrice||P.costPerUnit*1.4,I=c.find(B=>B.productId===P.productId),j=I!==void 0;return f.jsxs("div",{className:"bg-gray-900/50 border border-gray-700 rounded-lg p-4 hover:border-cyan-600 transition",children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"font-semibold text-white",children:k}),f.jsxs("p",{className:"text-sm text-gray-400",children:[P.quantity," ",P.quantityType||"units"," available"]})]}),f.jsxs("div",{className:"text-right",children:[f.jsxs("p",{className:"text-lg font-bold text-cyan-400",children:["$",C.toFixed(2)]}),P.expirationDate&&f.jsxs("p",{className:"text-xs text-gray-500",children:["Exp: ",new Date(P.expirationDate).toLocaleDateString()]})]})]}),f.jsx("button",{onClick:()=>_(P),disabled:P.quantity===0||j&&I.quantity>=P.quantity,className:`w-full py-2 px-4 rounded-lg font-semibold transition ${P.quantity===0||j&&I.quantity>=P.quantity?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-cyan-600 hover:bg-cyan-700 text-white"}`,children:j?`In Cart (${I.quantity})`:"Add to Cart"})]},P.id)})})]})}),f.jsx("div",{className:"lg:col-span-1",children:f.jsx(S3,{cart:c,onUpdateQuantity:E,onRemoveItem:T,totalPrice:M,shopId:t.id,onPurchaseComplete:()=>{d([]),v()}})})]})]})},N3=({name:t})=>{const[e,n]=A.useState([]),[r,a]=A.useState([]),[o,c]=A.useState(""),[d,p]=A.useState(!0),[h,x]=A.useState(!1),[v,w]=A.useState(null),[_,E]=A.useState(!1),[T,M]=A.useState(null),P=A.useRef(!1);A.useEffect(()=>{let C=!1;const I=setTimeout(async()=>{const j=o.trim();x(!!j),!j&&!P.current&&p(!0);try{const B=await sf(j,30);if(C)return;n(B),w(null),P.current=!0}catch(B){C||w(B instanceof Error?B.message:"Failed to load products.")}finally{C||(p(!1),x(!1))}},250);return()=>{C=!0,clearTimeout(I)}},[o]),A.useEffect(()=>{(async()=>{try{const I=await sf("",200);a(I)}catch(I){console.warn("Failed to preload scanner catalog",I)}})()},[]);const k=C=>{M(C),C&&c(C.name)};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("h1",{className:"text-3xl font-bold text-white mb-2",children:["Welcome, ",t,"!"]}),f.jsx("p",{className:"text-gray-300",children:"Search the live catalog to see if a product is available in nearby autonomous shops. You can search by name, manufacturer, category, or use the live camera scanner to identify an item instantly."}),f.jsxs("div",{className:"mt-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[f.jsx("input",{type:"search",value:o,onChange:C=>c(C.target.value),placeholder:"Search products by name, category, or manufacturer...",className:"flex-1 px-4 py-2.5 rounded-lg bg-gray-900/80 border border-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),f.jsxs("button",{onClick:()=>E(!0),className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-indigo-600 text-white font-semibold hover:bg-indigo-500",children:[f.jsx(Si,{className:"w-5 h-5"}),"Live Scan Product"]})]}),T&&f.jsxs("p",{className:"mt-3 text-sm text-cyan-300",children:["Showing matches for ",f.jsx("span",{className:"font-semibold",children:T.name})," based on the latest scan."]}),v&&f.jsx("p",{className:"mt-3 text-sm text-red-400",children:v})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Product Catalog"}),d?f.jsx("span",{className:"text-sm text-gray-400",children:"Loading catalog..."}):h?f.jsx("span",{className:"text-sm text-gray-400",children:"Searching"}):f.jsxs("span",{className:"text-sm text-gray-400",children:[e.length," result(s)"]})]}),d?f.jsx("p",{className:"text-gray-400",children:"Fetching catalog..."}):e.length===0?f.jsx("p",{className:"text-gray-400",children:"No products match your search. Try a different keyword or use the live scanner."}):f.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.map(C=>f.jsxs("div",{className:"p-4 rounded-lg bg-gray-900/60 border border-gray-700",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsx("h3",{className:"text-lg font-semibold text-white truncate",title:C.name,children:C.name}),C.category&&f.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-cyan-900/40 text-cyan-200 border border-cyan-700/40",children:C.category})]}),f.jsx("p",{className:"text-sm text-gray-400 mb-2",children:C.manufacturer||"Unknown manufacturer"}),C.description&&f.jsx("p",{className:"text-xs text-gray-400 line-clamp-3",children:C.description})]},C.id))})]}),_&&f.jsx(E3,{products:r.length?r:e,onClose:()=>E(!1),onMatch:k})]})},C3=({onLogout:t,name:e})=>{const{currentShop:n,setCurrentShop:r}=Xf(),{customer:a,setCustomer:o,clearCustomer:c}=fw(),[d,p]=A.useState(!1),[h,x]=A.useState("discovery"),{showToast:v}=ds(),w=E=>{var M;const T=E.user;if((M=T.roles)!=null&&M.shop||T.shopId){v("Shop account detected. Please sign in via the shop dashboard.","info"),p(!1);return}o(E),p(!1),v("Welcome! You can now checkout.","success")},_=()=>{c(),v("Logged out successfully","success"),t==null||t(),p(!1)};return A.useEffect(()=>{n&&x("shop")},[n]),f.jsxs("div",{className:"min-h-screen bg-gray-900",children:[f.jsx("div",{className:"bg-gray-800/50 border-b border-gray-700 p-4",children:f.jsxs("div",{className:"container mx-auto flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("h1",{className:"text-xl font-bold text-white",children:"ShopNexus Customer"}),a&&f.jsxs("p",{className:"text-sm text-gray-400",children:["Logged in as ",a.user.companyName||a.user.email]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[n&&f.jsx("button",{onClick:()=>{r(null),x("discovery")},className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Change Shop"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>x("discovery"),className:`px-4 py-2 text-sm border rounded-lg transition ${h==="discovery"?"bg-cyan-600 text-white border-cyan-600":"text-gray-300 border-gray-600 hover:bg-gray-700"}`,children:"Browse Catalog"}),n&&f.jsx("button",{onClick:()=>x("shop"),className:`px-4 py-2 text-sm border rounded-lg transition ${h==="shop"?"bg-cyan-600 text-white border-cyan-600":"text-gray-300 border-gray-600 hover:bg-gray-700"}`,children:"Shop View"})]}),a?f.jsx("button",{onClick:_,className:"px-4 py-2 text-sm text-gray-300 hover:text-white border border-gray-600 rounded-lg hover:bg-gray-700 transition",children:"Logout"}):f.jsx("button",{onClick:()=>p(!0),className:"px-4 py-2 text-sm text-cyan-400 hover:text-cyan-300 border border-cyan-600 rounded-lg hover:bg-cyan-900/30 transition",children:"Login"})]})]})}),f.jsx("div",{className:"container mx-auto p-4 md:p-8",children:d?f.jsxs("div",{className:"max-w-lg mx-auto",children:[f.jsx(Wb,{onAuthenticated:w}),f.jsx("button",{onClick:()=>p(!1),className:"mt-4 w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition",children:"Cancel"})]}):h==="discovery"?f.jsxs(f.Fragment,{children:[!n&&f.jsx(vx,{}),n&&f.jsx("div",{className:"mb-6",children:f.jsx(vx,{})}),f.jsx(N3,{name:e||"Guest"})]}):f.jsx(T3,{})})]})},bx=({name:t,initialProfile:e,onLogout:n})=>f.jsx(b3,{children:f.jsx(w3,{initialCustomer:e,children:f.jsx(C3,{name:t,onLogout:n})})}),A3=({name:t})=>{const[e,n]=A.useState([]),[r,a]=A.useState(!0),[o,c]=A.useState(""),[d,p]=A.useState(""),[h,x]=A.useState(null),v=async()=>{a(!0),x(null);try{const _=await Gs();n(_)}catch(_){x(_ instanceof Error?_.message:"Failed to load suppliers.")}finally{a(!1)}};A.useEffect(()=>{v()},[]);const w=async _=>{if(_.preventDefault(),!o.trim()){x("Supplier name is required.");return}x(null);try{await Ri({name:o.trim(),contactEmail:d.trim()||void 0}),c(""),p(""),await v()}catch(E){x(E instanceof Error?E.message:"Failed to create supplier.")}};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Supplier Console"}),f.jsxs("p",{className:"text-gray-300",children:["Hello ",t,"! Manage your supplier network here. Register local suppliers (created by your shop) or review existing ones (local or global suppliers linked to registered users)."]})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Register Local Supplier"}),f.jsxs("form",{onSubmit:w,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Supplier Name"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:o,onChange:_=>c(_.target.value),required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Contact Email (optional)"}),f.jsx("input",{type:"email",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:d,onChange:_=>p(_.target.value)})]}),f.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold",children:"Add Supplier"})]}),h&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:h})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Suppliers"}),f.jsx("button",{onClick:v,className:"px-3 py-1.5 bg-gray-700 rounded-md text-sm text-white hover:bg-gray-600",children:"Refresh"})]}),r?f.jsx("p",{className:"text-gray-400",children:"Loading suppliers..."}):e.length===0?f.jsx("p",{className:"text-gray-500",children:"No suppliers yet. Add a local supplier above."}):f.jsx("div",{className:"space-y-3",children:e.map(_=>f.jsx("div",{className:"p-3 bg-gray-900/40 rounded-lg border border-gray-700 hover:bg-gray-900/60 transition-colors",children:f.jsx("div",{className:"flex items-start justify-between",children:f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("p",{className:"text-white font-semibold",children:_.name}),_.shopId?f.jsx("span",{className:"text-xs bg-cyan-600/20 text-cyan-400 px-2 py-1 rounded",children:"Local"}):_.linkedUserId?f.jsx("span",{className:"text-xs bg-green-600/20 text-green-400 px-2 py-1 rounded",children:"Global"}):null]}),_.contact&&f.jsx("p",{className:"text-sm text-gray-400 mt-1",children:_.contact}),_.linkedUserId&&f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Linked User ID: ",_.linkedUserId]}),_.shopId&&f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Shop ID: ",_.shopId]})]})})},_.id))})]})]})},I3=({onClose:t,onProductCreated:e})=>{const n=A.useRef(null),r=A.useRef(null),a=A.useRef(null),o=A.useRef(null),[c,d]=A.useState("scanning"),[p,h]=A.useState(null),[x,v]=A.useState({}),[w,_]=A.useState(new Set),[E,T]=A.useState(new Map),[M,P]=A.useState(null),[k,C]=A.useState(null),[I,j]=A.useState(null),[B,H]=A.useState(!1),Q=A.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=null)},[]),Z=A.useCallback(()=>{if(n.current&&a.current){const R=n.current,O=a.current,Y=R.getBoundingClientRect();O.width=Y.width,O.height=Y.height}},[]);A.useEffect(()=>{let R=null;return(async()=>{try{R=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),n.current&&(n.current.srcObject=R,n.current.onloadedmetadata=()=>Z())}catch{h("Could not access camera. Please grant permissions.")}})(),window.addEventListener("resize",Z),()=>{window.removeEventListener("resize",Z),Q(),R==null||R.getTracks().forEach(Y=>Y.stop())}},[Z,Q]);const W=A.useCallback(async()=>{if(!n.current||!r.current||document.hidden||c!=="scanning")return;const R=n.current,O=r.current;O.width=R.videoWidth,O.height=R.videoHeight;const Y=O.getContext("2d");if(!Y)return;Y.drawImage(R,0,0,R.videoWidth,R.videoHeight);const re=await new Promise(ae=>O.toBlob(ae,"image/jpeg",.8));if(!(!re||c!=="scanning"))try{const ae=await Kf(re);v(D=>{const J={...D};for(const ne in ae){const $=ne;w.has($)||(J[$]=ae[$])}return J})}catch(ae){console.warn("Auto-scan failed:",ae)}},[c,w]);A.useEffect(()=>{c==="scanning"&&!o.current?o.current=window.setInterval(W,3500):c!=="scanning"&&Q()},[c,W,Q]);const le=R=>{P(R),d("drawingBox"),C(null),j(null)},ue=R=>{var ae;if(c!=="drawingBox"||!M)return;const O=(ae=a.current)==null?void 0:ae.getBoundingClientRect();if(!O)return;const Y=R.clientX-O.left,re=R.clientY-O.top;if(!k)C({x:Y,y:re});else{const D={x:Math.min(k.x,Y),y:Math.min(k.y,re),width:Math.abs(Y-k.x),height:Math.abs(re-k.y)};D.width>5&&D.height>5&&(j(D),Re(D)),C(null)}},Re=A.useCallback(async R=>{if(!n.current||!r.current||!M)return;d("analyzing");const O=n.current,Y=r.current,re=O.videoWidth/O.clientWidth,ae=O.videoHeight/O.clientHeight,D=R.x*re,J=R.y*ae,ne=R.width*re,$=R.height*ae;Y.width=ne,Y.height=$;const oe=Y.getContext("2d");if(oe){oe.drawImage(O,D,J,ne,$,0,0,ne,$);const he=await new Promise(ye=>Y.toBlob(ye,"image/jpeg",.9));if(he){T(ye=>new Map(ye).set(M,he));try{const ye=await ew(he,M);v(V=>({...V,[M]:ye})),_(V=>new Set(V).add(M))}catch(ye){h(ye instanceof Error?ye.message:"Analysis failed")}}}P(null),j(null),d("scanning")},[M]),Ne=async()=>{const R=x;if(!R.productName||!R.manufacturer||!R.category){h("Product Name, Manufacturer, and Category are required to save."),d("scanning");return}H(!0),h(null);try{const O=await Ii({name:R.productName,manufacturer:R.manufacturer,category:R.category,description:R.productDescription||""}),Y=Array.from(E.entries()).map(([re,ae])=>Cf(O.name,re,ae,{productId:O.id,source:"manual"}));await Promise.all(Y),e(),t()}catch(O){h(O instanceof Error?O.message:"Failed to save product.")}finally{H(!1)}},Ie=()=>c==="scanning"?"Auto-scanning product... Tap screen to manually select a field.":c==="drawingBox"?k?"Tap the opposite corner to create a selection.":`Tap the first corner for ${bn[M].displayName}.`:c==="analyzing"?`Analyzing ${bn[M].displayName}...`:c==="verifying"?"Review the extracted data and confirm to save the new product.":"";return c==="verifying"?f.jsxs("div",{className:"fixed inset-0 bg-gray-900 z-50 p-4 sm:p-8 flex flex-col","aria-modal":"true",children:[f.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Verify New Product"}),p&&f.jsx("p",{className:"bg-red-900/50 text-red-300 p-3 rounded-md mb-4",children:p}),f.jsx("div",{className:"flex-grow overflow-y-auto space-y-4 bg-gray-800/50 p-4 rounded-lg",children:Object.entries(x).map(([R,O])=>{var ae;const Y=R,re=E.get(Y);return f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-400",children:((ae=bn[Y])==null?void 0:ae.displayName)||R}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("input",{value:String(O),onChange:D=>v(J=>({...J,[Y]:D.target.value})),className:"flex-grow px-3 py-2 rounded-md bg-gray-700 border border-gray-600 text-white"}),re&&f.jsx("img",{src:URL.createObjectURL(re),alt:`Crop of ${R}`,className:"w-24 h-12 object-contain rounded-md bg-black"})]})]},R)})}),f.jsxs("div",{className:"flex-shrink-0 pt-6 flex justify-end gap-4",children:[f.jsx("button",{onClick:()=>d("scanning"),disabled:B,className:"px-6 py-2 rounded-md bg-gray-600 text-white font-semibold",children:"Back to Scanner"}),f.jsx("button",{onClick:Ne,disabled:B,className:"px-6 py-2 rounded-md bg-cyan-600 text-white font-semibold",children:B?"Saving...":"Confirm & Save Product"})]})]}):f.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex","aria-modal":"true",children:[f.jsxs("div",{className:"flex-grow relative",children:[f.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),f.jsx("canvas",{ref:r,className:"hidden"}),f.jsx("canvas",{ref:a,className:"absolute inset-0 w-full h-full z-10",onClick:ue}),p&&f.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-red-800/80 text-white p-3 rounded-lg text-center z-30 max-w-md mx-auto",children:p}),f.jsx("div",{className:"absolute top-4 left-4 bg-black/50 text-white px-4 py-2 rounded-full z-20 text-center text-sm",children:Ie()})]}),f.jsxs("div",{className:"w-full md:w-96 bg-gray-900/80 backdrop-blur-sm border-l border-gray-700 flex flex-col p-4 space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("h2",{className:"text-xl font-bold text-white",children:"Learn Product"}),f.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:""})]}),f.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 pr-2",children:Object.keys(bn).map(R=>{const O=w.has(R),Y=x[R]!==void 0&&x[R]!==""&&x[R]!==0;return f.jsxs("button",{onClick:()=>le(R),className:`w-full text-left p-3 rounded-md transition-colors flex items-center justify-between ${O?"bg-indigo-800/50":"bg-gray-700/50 hover:bg-gray-700"}`,children:[f.jsxs("div",{children:[f.jsx("span",{className:"font-semibold text-white",children:bn[R].displayName}),Y&&f.jsx("p",{className:"text-sm text-cyan-300 truncate",children:String(x[R])})]}),O&&f.jsx(rw,{className:"w-5 h-5 text-indigo-300 flex-shrink-0"})]},R)})}),f.jsx("div",{className:"flex-shrink-0",children:f.jsxs("button",{onClick:()=>d("verifying"),className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-cyan-600 text-white font-semibold rounded-md hover:bg-cyan-700 transition-colors",children:[f.jsx(hw,{className:"w-6 h-6"}),"Verify & Save"]})})]})]})},R3=t=>f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[f.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),f.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),D3=()=>{const[t,e]=A.useState([]),[n,r]=A.useState([]),[a,o]=A.useState(!0),[c,d]=A.useState(null),[p,h]=A.useState(""),[x,v]=A.useState(""),[w,_]=A.useState(""),[E,T]=A.useState(""),[M,P]=A.useState(void 0),[k,C]=A.useState(""),[I,j]=A.useState(!1),[B,H]=A.useState([]),[Q,Z]=A.useState(""),[W,le]=A.useState(""),[ue,Re]=A.useState(""),[Ne,Ie]=A.useState(null),[R,O]=A.useState(null),[Y,re]=A.useState(!1),{showToast:ae}=ds(),D=async()=>{o(!0),d(null);try{const[V,se]=await Promise.all([Jl(),Gs()]);e(V),r(V),H(se.map(xe=>({id:xe.id,name:xe.name||xe.id})))}catch(V){d(V instanceof Error?V.message:"Failed to load products.")}finally{o(!1)}};wx.useEffect(()=>{let V=t;if(Q.trim()){const se=Q.toLowerCase();V=V.filter(xe=>xe.name.toLowerCase().includes(se)||xe.manufacturer.toLowerCase().includes(se)||xe.category.toLowerCase().includes(se)||xe.description&&xe.description.toLowerCase().includes(se))}W&&(V=V.filter(se=>se.category===W)),ue&&(V=V.filter(se=>se.manufacturer===ue)),r(V)},[t,Q,W,ue]),A.useEffect(()=>{D()},[]);const J=()=>{D(),ae("New product successfully learned and added to catalog!","success")},ne=async V=>{if(V.preventDefault(),!p.trim()){d("Name is required.");return}j(!0),d(null);try{const se=k?[{url:k.trim(),type:"manual",source:"user",addedAt:new Date().toISOString()}]:[];await Ii({name:p,manufacturer:x,category:w,description:E,defaultSupplierId:M,images:se}),h(""),v(""),_(""),T(""),C(""),P(void 0),await D(),ae("Product created successfully!","success")}catch(se){const xe=se instanceof Error?se.message:"Failed to create product.";d(xe),ae(xe,"error")}finally{j(!1)}},$=V=>{var se,xe;Ie(V),h(V.name),v(V.manufacturer),_(V.category),T(V.description||""),C(((xe=(se=V.images)==null?void 0:se[0])==null?void 0:xe.url)||""),P(V.defaultSupplierId||void 0)},oe=()=>{Ie(null),h(""),v(""),_(""),T(""),C(""),P(void 0),d(null)},he=async V=>{if(V.preventDefault(),!Ne||!p.trim()){d("Name is required.");return}j(!0),d(null);try{const se=k?[{url:k.trim(),type:"manual",source:"user",addedAt:new Date().toISOString()}]:[];await rv(Ne.id,{name:p,manufacturer:x,category:w,description:E,defaultSupplierId:M,images:se}),oe(),await D(),ae("Product updated successfully!","success")}catch(se){const xe=se instanceof Error?se.message:"Failed to update product.";d(xe),ae(xe,"error")}finally{j(!1)}},ye=async V=>{try{await iv(V),O(null),await D(),ae("Product deleted successfully!","success")}catch(se){const xe=se instanceof Error?se.message:"Failed to delete product.";ae(xe,"error")}};return f.jsxs(f.Fragment,{children:[Y&&f.jsx(I3,{onClose:()=>re(!1),onProductCreated:J}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h1",{className:"text-2xl font-bold text-white",children:"Product Catalog"}),f.jsxs("button",{onClick:()=>re(!0),className:"flex items-center justify-center gap-3 py-3 px-6 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-indigo-500 transition-all",children:[f.jsx(iw,{className:"w-6 h-6"}),"Scan & Train New Product"]})]}),f.jsx("p",{className:"text-gray-400 text-sm",children:"Use the AI scanner to learn new products. The system will extract all relevant information sections from the product image and learn where to look for specific data fields for future scans."})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:Ne?"Edit Product":"Create Product Manually"}),f.jsxs("form",{onSubmit:Ne?he:ne,className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Name"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:p,onChange:V=>h(V.target.value),required:!0})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Manufacturer"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:x,onChange:V=>v(V.target.value)})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Category"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:w,onChange:V=>_(V.target.value)})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Description"}),f.jsx("textarea",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:E,onChange:V=>T(V.target.value),rows:3})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Default Supplier"}),f.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:M||"",onChange:V=>P(V.target.value||void 0),children:[f.jsx("option",{value:"",children:"None"}),B.map(V=>f.jsx("option",{value:V.id,children:V.name},V.id))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Image URL"}),f.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:k,onChange:V=>C(V.target.value),placeholder:"https://example.com/photo.jpg"})]})]}),f.jsxs("div",{className:"flex space-x-3",children:[f.jsx("button",{type:"submit",disabled:I,className:"px-4 py-2 rounded-md bg-cyan-600 text-white font-semibold disabled:opacity-60 hover:bg-cyan-700 transition-colors",children:I?Ne?"Updating...":"Creating...":Ne?"Update Product":"Create Product"}),Ne&&f.jsx("button",{type:"button",onClick:oe,disabled:I,className:"px-4 py-2 rounded-md bg-gray-700 text-white font-semibold disabled:opacity-60 hover:bg-gray-600 transition-colors",children:"Cancel"})]})]}),c&&f.jsx("p",{className:"text-red-400 text-sm mt-2",children:c})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"All Products"}),f.jsx("button",{onClick:D,className:"px-3 py-1.5 rounded-md bg-gray-700 text-sm text-white hover:bg-gray-600",children:"Refresh"})]}),f.jsxs("div",{className:"mb-6 space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Search Products"}),f.jsx("input",{type:"text",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",placeholder:"Search by name, manufacturer, category, or description...",value:Q,onChange:V=>Z(V.target.value)})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Filter by Category"}),f.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:W,onChange:V=>le(V.target.value),children:[f.jsx("option",{value:"",children:"All Categories"}),Array.from(new Set(t.map(V=>V.category).filter(Boolean))).sort().map(V=>f.jsx("option",{value:V,children:V},V))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Filter by Manufacturer"}),f.jsxs("select",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700 text-white",value:ue,onChange:V=>Re(V.target.value),children:[f.jsx("option",{value:"",children:"All Manufacturers"}),Array.from(new Set(t.map(V=>V.manufacturer).filter(Boolean))).sort().map(V=>f.jsx("option",{value:V,children:V},V))]})]})]})]}),a?f.jsx("p",{className:"text-gray-400",children:"Loading products..."}):n.length===0?f.jsxs("div",{className:"text-center py-12",children:[f.jsx(R3,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),f.jsx("p",{className:"text-gray-500 text-lg mb-2",children:t.length===0?"No products yet.":"No products match your filters."}),t.length===0&&f.jsx("button",{onClick:()=>re(!0),className:"mt-4 px-6 py-3 rounded-md bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition-colors",children:"Scan Your First Product"})]}):f.jsxs("div",{className:"space-y-3",children:[f.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",n.length," of ",t.length," products"]}),n.map(V=>{var se;return f.jsxs("div",{className:"p-4 bg-gray-900/40 rounded-lg border border-gray-700 hover:bg-gray-900/60 transition-colors",children:[f.jsxs("div",{className:"flex items-start justify-between gap-4",children:[f.jsx("div",{className:"flex-1 min-w-0",children:f.jsxs("div",{className:"flex items-start gap-3",children:[V.images&&V.images[0]&&f.jsx("img",{src:V.images[0].url,alt:V.name,className:"w-16 h-16 object-cover rounded-md flex-shrink-0",onError:xe=>{xe.target.style.display="none"}}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:"text-white font-semibold text-lg",children:V.name}),f.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[V.manufacturer,"  ",V.category]}),V.description&&f.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:V.description}),V.defaultSupplierId&&f.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700",children:[f.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Default Supplier:"}),f.jsx("span",{className:"inline-block px-2 py-0.5 text-xs bg-blue-900/30 text-blue-300 rounded border border-blue-700/50",children:((se=B.find(xe=>xe.id===V.defaultSupplierId))==null?void 0:se.name)||V.defaultSupplierId})]})]})]})}),f.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[f.jsx("button",{onClick:()=>$(V),className:"px-3 py-1.5 rounded-md bg-blue-600/80 text-white text-sm hover:bg-blue-600 transition-colors",title:"Edit product",children:"Edit"}),f.jsx("button",{onClick:()=>O(V.id),className:"px-3 py-1.5 rounded-md bg-red-600/80 text-white text-sm hover:bg-red-600 transition-colors",title:"Delete product",children:"Delete"})]})]}),R===V.id&&f.jsxs("div",{className:"mt-4 p-3 bg-red-900/30 border border-red-700 rounded-md",children:[f.jsxs("p",{className:"text-red-300 text-sm mb-3",children:['Are you sure you want to delete "',V.name,'"?']}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsx("button",{onClick:()=>ye(V.id),className:"px-3 py-1.5 rounded-md bg-red-600 text-white text-sm hover:bg-red-700 transition-colors",children:"Yes, Delete"}),f.jsx("button",{onClick:()=>O(null),className:"px-3 py-1.5 rounded-md bg-gray-700 text-white text-sm hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]},V.id)})]})]})]})]})},M3=()=>{const[t,e]=A.useState([]),[n,r]=A.useState([]),[a,o]=A.useState([]),[c,d]=A.useState(!0),[p,h]=A.useState({deliveryDate:new Date().toISOString().split("T")[0],lineItems:[],documents:[]}),[x,v]=A.useState([]),[w,_]=A.useState(!1),[E,T]=A.useState(!1),[M,P]=A.useState(!1),[k,C]=A.useState(null),I=A.useRef(null),j=A.useMemo(()=>new Map(a.map(R=>[R.id,R])),[a]),B=A.useMemo(()=>new Map(n.map(R=>[R.id,R.name||R.id])),[n]),H=async()=>{d(!0),C(null);try{const[R,O,Y]=await Promise.all([lv(),Gs(),Jl()]);e(R.sort((re,ae)=>new Date(ae.deliveryDate).getTime()-new Date(re.deliveryDate).getTime())),r(O),o(Y)}catch(R){C(R instanceof Error?R.message:"Failed to load data.")}finally{d(!1)}};A.useEffect(()=>{H()},[]);const Q=()=>{h({deliveryDate:new Date().toISOString().split("T")[0],lineItems:[],documents:[]}),v([]),I.current&&(I.current.value="")},Z=R=>{R.target.files&&v(O=>[...O,...Array.from(R.target.files)])},W=R=>{v(O=>O.filter((Y,re)=>re!==R))},le=async()=>{if(x.length!==0){T(!0),C(null);try{const R=await JD(x),O=n.find(re=>R.supplierName&&re.name.toLowerCase().includes(R.supplierName.toLowerCase())),Y=R.items.map(re=>{const ae=a.find(D=>D.name.toLowerCase()===re.productName.toLowerCase());return{productId:(ae==null?void 0:ae.id)||"",productName:re.productName,quantity:re.quantity,cost:re.costPerUnit}});h(re=>({...re,supplierId:(O==null?void 0:O.id)||re.supplierId,invoiceNumber:R.invoiceNumber||re.invoiceNumber,deliveryDate:R.deliveryDate||re.deliveryDate,lineItems:Y}))}catch(R){C(R instanceof Error?R.message:"Failed to analyze documents.")}finally{T(!1)}}},ue=(R,O,Y)=>{const re=[...p.lineItems||[]];if(re[R]={...re[R],[O]:Y},O==="productId"){const ae=j.get(Y);ae&&(re[R].productName=ae.name)}h(ae=>({...ae,lineItems:re}))},Re=()=>{const R={productId:"",productName:"Manual Entry",quantity:1,cost:0};h(O=>({...O,lineItems:[...O.lineItems||[],R]}))},Ne=R=>{h(O=>{var Y;return{...O,lineItems:(Y=O.lineItems)==null?void 0:Y.filter((re,ae)=>ae!==R)}})},Ie=async R=>{if(R.preventDefault(),!p.deliveryDate||!p.lineItems||p.lineItems.length===0){C("Delivery date and at least one valid line item are required.");return}const O=p.lineItems.filter(Y=>Y.productId&&Y.quantity>0);if(O.length===0){C("At least one line item must be assigned to a product.");return}_(!0),C(null);try{await Ma({...p,deliveryDate:p.deliveryDate,lineItems:O}),Q(),await H()}catch(Y){C(Y instanceof Error?Y.message:"Failed to create batch.")}finally{_(!1)}};return f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[f.jsx(Yf,{className:"w-6 h-6 text-cyan-400"}),"Log New Delivery Batch"]}),f.jsxs("form",{onSubmit:Ie,className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Delivery Date"}),f.jsx("input",{type:"date",className:"form-input",value:p.deliveryDate||"",onChange:R=>h(O=>({...O,deliveryDate:R.target.value})),required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Supplier"}),f.jsxs("select",{className:"form-input",value:p.supplierId||"",onChange:R=>h(O=>({...O,supplierId:R.target.value||void 0})),children:[f.jsx("option",{value:"",children:"Select Supplier..."}),n.map(R=>f.jsx("option",{value:R.id,children:R.name},R.id))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Invoice Number"}),f.jsx("input",{className:"form-input",value:p.invoiceNumber||"",onChange:R=>h(O=>({...O,invoiceNumber:R.target.value}))})]})]}),f.jsxs("div",{className:"p-4 border border-gray-700 rounded-lg space-y-3",children:[f.jsx("h3",{className:"text-base font-semibold text-gray-200",children:"Upload Documents"}),f.jsx("input",{type:"file",ref:I,onChange:Z,accept:"image/*",className:"hidden",multiple:!0}),f.jsxs("button",{type:"button",onClick:()=>{var R;return(R=I.current)==null?void 0:R.click()},className:"button-secondary w-full",children:[f.jsx(sw,{className:"w-5 h-5"})," Add Document(s)"]}),f.jsx("div",{className:"space-y-2",children:x.map((R,O)=>f.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 p-2 rounded text-sm",children:[f.jsx("span",{className:"truncate text-gray-300",children:R.name}),f.jsx("button",{type:"button",onClick:()=>W(O),className:"text-red-400 hover:text-red-300",children:f.jsx(jl,{className:"w-4 h-4"})})]},O))}),x.length>0&&f.jsx("button",{type:"button",onClick:le,disabled:E,className:"button-primary w-full",children:E?"Analyzing...":`Analyze ${x.length} Document(s) with AI`})]})]}),f.jsxs("div",{className:"space-y-4 p-4 border border-gray-700 rounded-lg bg-gray-900/20",children:[f.jsx("h3",{className:"text-base font-semibold text-gray-200",children:"Line Items"}),f.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(p.lineItems||[]).map((R,O)=>f.jsxs("div",{className:"p-2 rounded-md bg-gray-800/50 grid grid-cols-12 gap-2 items-center",children:[f.jsxs("div",{className:"col-span-6",children:[f.jsxs("select",{className:"form-input text-sm",value:R.productId,onChange:Y=>ue(O,"productId",Y.target.value),required:!0,children:[f.jsx("option",{value:"",children:"Match Product..."}),a.map(Y=>f.jsx("option",{value:Y.id,children:Y.name},Y.id))]}),R.productId===""&&f.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:['Unmatched: "',R.productName,'"']})]}),f.jsx("div",{className:"col-span-2",children:f.jsx("input",{type:"number",placeholder:"Qty",className:"form-input text-sm",value:R.quantity,onChange:Y=>ue(O,"quantity",Number(Y.target.value))})}),f.jsx("div",{className:"col-span-3",children:f.jsx("input",{type:"number",placeholder:"Cost",step:"0.01",className:"form-input text-sm",value:R.cost,onChange:Y=>ue(O,"cost",Number(Y.target.value))})}),f.jsx("div",{className:"col-span-1",children:f.jsx("button",{type:"button",onClick:()=>Ne(O),className:"text-red-400 hover:text-red-300",children:f.jsx(jl,{className:"w-4 h-4"})})})]},O))}),f.jsx("button",{type:"button",onClick:Re,className:"button-secondary text-sm",children:"Add Manual Item"}),f.jsx("button",{type:"submit",disabled:w,className:"button-primary w-full",children:w?"Saving Batch...":"Save Batch"})]})]}),k&&f.jsx("p",{className:"text-red-400 text-sm mt-4",children:k})]}),f.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-xl font-semibold text-white",children:"Logged Batches"}),f.jsx("button",{onClick:H,className:"button-secondary text-sm",children:"Refresh"})]}),c?f.jsx("p",{className:"text-gray-400",children:"Loading batches..."}):t.length===0?f.jsx("p",{className:"text-gray-500 text-center py-4",children:"No batches logged yet."}):f.jsx("div",{className:"space-y-3",children:t.map(R=>{var O,Y;return f.jsxs("details",{className:"p-3 bg-gray-900/40 rounded-lg border border-gray-700 transition-colors",children:[f.jsx("summary",{className:"cursor-pointer",children:f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{children:[f.jsxs("p",{className:"text-white font-semibold",children:["Delivery: ",R.deliveryDate]}),f.jsxs("p",{className:"text-sm text-gray-400",children:["Supplier: ",B.get(R.supplierId||"")||R.supplierId||"N/A"]}),f.jsxs("p",{className:"text-xs text-gray-500",children:["Invoice #: ",R.invoiceNumber||"N/A"]})]}),f.jsx("div",{className:"text-right text-sm",children:f.jsxs("span",{className:"text-gray-300",children:[((O=R.lineItems)==null?void 0:O.length)||0," items"]})})]})}),f.jsx("div",{className:"mt-3 pt-3 border-t border-gray-700",children:f.jsx("ul",{className:"space-y-1 text-sm",children:(Y=R.lineItems)==null?void 0:Y.map((re,ae)=>{var D;return f.jsxs("li",{className:"flex justify-between text-gray-300",children:[f.jsxs("span",{children:[re.quantity,"x ",((D=j.get(re.productId))==null?void 0:D.name)||re.productName]}),f.jsxs("span",{className:"text-gray-400",children:["$",re.cost.toFixed(2),"/unit"]})]},ae)})})})]},R.id)})})]}),f.jsx("style",{children:`
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            background-color: #1f2937;
            border: 1px solid #4b5563;
            color: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #22d3ee;
            box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.4);
        }
        .button-primary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            border-radius: 0.375rem;
            background-color: #0891b2;
            color: white;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .button-primary:hover {
            background-color: #0e7490;
        }
        .button-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .button-secondary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #4b5563;
            color: white;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .button-secondary:hover {
            background-color: #6b7280;
        }
      `})]})},k3=()=>{var Re,Ne,Ie;console.log("[App] Component rendering...");const[t,e]=A.useState(null),{toasts:n,removeToast:r}=ds(),a=(t==null?void 0:t.user)??null;console.log("[App] Current user:",a?"logged in":"not logged in");const o=!!((Re=a==null?void 0:a.roles)!=null&&Re.shop||a!=null&&a.shopId),c=!!((Ne=a==null?void 0:a.roles)!=null&&Ne.customer||a!=null&&a.customerId),d=!!((Ie=a==null?void 0:a.roles)!=null&&Ie.supplier||a!=null&&a.supplierId),[p,h]=A.useState([]),[x,v]=A.useState([]),[w,_]=A.useState([]),[E,T]=A.useState("dashboard"),[M,P]=A.useState(!0),k=!a,C=A.useMemo(()=>{if(console.log("[App] Computing activeShopContextValue - session?.shopContext:",t==null?void 0:t.shopContext,"currentUser:",a==null?void 0:a.shopId),!(t!=null&&t.shopContext)||!a)return console.log("[App] activeShopContextValue: Returning null (no shopContext or currentUser)"),null;let R;if(typeof t.shopContext=="string")R=t.shopContext;else if(t.shopContext&&typeof t.shopContext=="object"&&"id"in t.shopContext)R=t.shopContext.id,console.warn("[App] shopContext is an object, extracting id:",R);else return console.error("[App] shopContext is not a string or object with id:",t.shopContext),null;const O={id:R,name:a.companyName,contactEmail:a.email,location:a.address,qdrantNamespace:R};return console.log("[App] activeShopContextValue computed:",O),O},[t,a]);A.useEffect(()=>{console.log("[App] Setting active shop context:",(C==null?void 0:C.id)||"null"),Oa(C)},[C]);const I=A.useCallback(async R=>{var Y;if(!R){P(!1);return}const O=!!((Y=R.roles)!=null&&Y.shop||R.shopId);if(P(!0),O){const re=await Yl(),ae=await Bb(),D=await zf();console.log(`[App] refreshData: Loaded ${D.length} stock items, ${re.length} product summaries`),v(re),h(ae),_(D)}else v([]),h([]),_([]);P(!1)},[]);A.useEffect(()=>{var Y;if(k||!a)return;const R=!!((Y=a.roles)!=null&&Y.shop||a.shopId);(async()=>{R&&await Ob(),await I(a)})()},[k,a,I,C]),A.useEffect(()=>{if(!a||!o)return;const R=setInterval(()=>{I(a)},6e4);return()=>clearInterval(R)},[a,o,I]);const j=A.useCallback(R=>{var Y,re,ae;e(R),P(!1);const O=R.user;O.shopId||(Y=O.roles)!=null&&Y.shop?T("dashboard"):O.supplierId||(re=O.roles)!=null&&re.supplier?T("supplier"):O.customerId||(ae=O.roles)!=null&&ae.customer?T("customer"):T("dashboard")},[]),B=A.useCallback(()=>{e(null),h([]),v([]),_([]),T("dashboard")},[]),H=async(R,O)=>{await _i(R,O),a&&await I(a)},Q=async R=>{await Gf(R),a&&await I(a)},Z=async(R,O)=>{await Vb(R,O),await yD(R.listingId,O),a&&await I(a)},W=R=>T(R),le=A.useMemo(()=>{if(!a||!o)return console.log("[App] legacyItems: No user or no shop role"),[];console.log(`[App] legacyItems: Processing ${w.length} items from allItems`);const R=w.filter(O=>O.quantity>0&&(!O.status||O.status==="ACTIVE"));return console.log(`[App] legacyItems: ${R.length} items after filtering`),R.map(O=>{const Y=x.find(re=>re.productId===O.productId);return{id:O.id,batchId:String(O.batchId),productId:O.productId,inventoryUuid:O.inventoryUuid,productName:(Y==null?void 0:Y.productName)||"N/A",manufacturer:(Y==null?void 0:Y.manufacturer)||"N/A",category:(Y==null?void 0:Y.category)||"N/A",expirationDate:O.expirationDate,quantity:O.quantity,quantityType:(Y==null?void 0:Y.quantityType)||"units",costPerUnit:O.costPerUnit,location:O.location||void 0,createdAt:O.createdAt,updatedAt:O.updatedAt,supplierId:O.supplierId||null,buyPrice:O.buyPrice??O.costPerUnit,sellPrice:O.sellPrice??void 0}})},[w,x,a,o]);return console.log("[App] requiresLogin:",k),a&&c&&!o?f.jsx(bx,{name:a.companyName||"Guest",initialProfile:t??void 0,onLogout:B}):k?(console.log("[App] Showing AuthPage"),f.jsx(Wb,{onAuthenticated:j})):!a||o&&M?f.jsxs("div",{className:"min-h-screen bg-gray-900 flex flex-col items-center justify-center text-white",children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"}),f.jsx("p",{className:"mt-4 text-lg",children:"Initializing Application..."})]}):f.jsxs("div",{className:"min-h-screen bg-gray-900 text-gray-100 font-sans",children:[f.jsx(OD,{activeTab:E,onTabChange:W,user:a,onLogout:B,isBackendAvailable:D4}),f.jsxs("main",{className:"container mx-auto p-4 md:p-8",children:[E==="dashboard"&&f.jsx(r3,{summaries:o?x:[],onNavigateToInventory:()=>o&&W("inventory"),onRefreshData:a?()=>I(a):void 0}),E==="inventory"&&o&&f.jsx(p3,{summaries:x,items:le,batches:p,onAddBatch:H,onDataRefresh:()=>a&&I(a)}),E==="catalog"&&o&&f.jsx(D3,{}),E==="batches"&&o&&f.jsx(M3,{}),E==="kiosk"&&o&&f.jsx(g3,{summaries:x,onPurchase:Q}),E==="marketplace"&&o&&f.jsx(x3,{summaries:x,user:a,onPurchase:Z}),E==="customer"&&c&&f.jsx(bx,{name:a.companyName}),E==="supplier"&&d&&f.jsx(A3,{name:a.companyName}),E==="backend"&&f.jsx(v3,{}),!o&&["inventory","catalog","batches","kiosk","marketplace"].includes(E)&&f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-red-400",children:"Access Denied: Shop role required"})}),!c&&E==="customer"&&f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-red-400",children:"Access Denied: Customer role required"})}),!d&&E==="supplier"&&f.jsx("div",{className:"bg-gray-800/50 border border-gray-700 rounded-xl p-6 text-center",children:f.jsx("p",{className:"text-red-400",children:"Access Denied: Supplier role required"})})]}),f.jsx("footer",{className:"text-center p-4 mt-8 text-gray-500 text-sm",children:f.jsx("p",{children:"Built for the modern autonomous shop.  2024 Inventory AI"})}),f.jsx(GD,{toasts:n,onRemove:r})]})};console.log("[index.tsx] Starting app initialization...");const pw=document.getElementById("root");if(!pw)throw console.error("[index.tsx] Root element not found!"),new Error("Could not find root element to mount to");console.log("[index.tsx] Root element found, creating React root...");const P3=FS.createRoot(pw);console.log("[index.tsx] Rendering App component...");P3.render(f.jsx(wx.StrictMode,{children:f.jsx(k3,{})}));console.log("[index.tsx] App rendered successfully");
